var _STRINGS={Ad:{Mobile:{Preroll:{ReadyIn:"The game is ready in ",Loading:"Your game is loading...",Close:"Close"},Header:{ReadyIn:"The game is ready in ",Loading:"Your game is loading...",Close:"Close"},End:{ReadyIn:"Advertisement ends in ",Loading:"Please wait ...",Close:"Close"}}},Splash:{Loading:"Loading ...",LogoLine1:"Some text here",LogoLine2:"powered by MarketJS",LogoLine3:"none"},Game:{SelectPlayer:"Select Player",Win:"You win!",Lose:"You lose!",Score:"Score",Time:"Time",metricTimeLeft:"TimeLeft:",
metricScore:"Score:",more:"MORE GAMES",RAINBOW:"RAINBOW",STACKER:"STACKER"},Results:{Title:"High score"}};var _SETTINGS={API:{Enabled:!1,Log:{Events:{InitializeGame:!0,EndGame:!0,Level:{Begin:!0,End:!0,Win:!0,Lose:!0,Draw:!0}}}},Ad:{Mobile:{Preroll:{Enabled:!1,Duration:5,Width:300,Height:250,Rotation:{Enabled:!1,Weight:{MobileAdInGamePreroll:40,MobileAdInGamePreroll2:40,MobileAdInGamePreroll3:20}}},Header:{Enabled:!1,Duration:5,Width:320,Height:50,Rotation:{Enabled:!1,Weight:{MobileAdInGameHeader:40,MobileAdInGameHeader2:40,MobileAdInGameHeader3:20}}},Footer:{Enabled:!1,Duration:5,Width:320,Height:50,
Rotation:{Enabled:!1,Weight:{MobileAdInGameFooter:40,MobileAdInGameFooter2:40,MobileAdInGameFooter3:20}}},End:{Enabled:!1,Duration:1,Width:300,Height:250,Rotation:{Enabled:!1,Weight:{MobileAdInGameEnd:40,MobileAdInGameEnd2:40,MobileAdInGameEnd3:20}}}}},Language:{Default:"en"},DeveloperBranding:{Splash:{Enabled:!1},Logo:{Enabled:!1,Link:"http://google.com",LinkEnabled:!0,NewWindow:!0,Width:166,Height:61}},Branding:{Splash:{Enabled:!0},Logo:{Enabled:!0,Link:"http://kiz10.com",LinkEnabled:!0,NewWindow:!0,
Width:146,Height:32}},MoreGames:{Enabled:!1,Link:"http://kiz10.com/",NewWindow:!0},Gamecenter:{Enabled:!1}};var MobileAdInGamePreroll={ad_duration:_SETTINGS.Ad.Mobile.Preroll.Duration,ad_width:_SETTINGS.Ad.Mobile.Preroll.Width,ad_height:_SETTINGS.Ad.Mobile.Preroll.Height,ready_in:_STRINGS.Ad.Mobile.Preroll.ReadyIn,loading:_STRINGS.Ad.Mobile.Preroll.Loading,close:_STRINGS.Ad.Mobile.Preroll.Close+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",Initialize:function(){if(_SETTINGS.Ad.Mobile.Preroll.Rotation.Enabled){var b=_SETTINGS.Ad.Mobile.Preroll.Rotation.Weight,f=b.MobileAdInGamePreroll,e=
f+b.MobileAdInGamePreroll2,b=e+b.MobileAdInGamePreroll3,c=Math.floor(100*Math.random());console.log("seed: ",c);c<=f?this.selectedOverlayName="MobileAdInGamePreroll":c<=e?this.selectedOverlayName="MobileAdInGamePreroll2":c<=b&&(this.selectedOverlayName="MobileAdInGamePreroll3");console.log("Ad rotating preroll enabled")}else this.selectedOverlayName="MobileAdInGamePreroll",console.log("Ad rotating preroll disabled");console.log("selected:",this.selectedOverlayName);this.overlay=$("#"+this.selectedOverlayName);
this.box=$("#"+this.selectedOverlayName+"-Box");this.game=$("#game");this.boxContents={footer:$("#"+this.selectedOverlayName+"-Box-Footer"),header:$("#"+this.selectedOverlayName+"-Box-Header"),close:$("#"+this.selectedOverlayName+"-Box-Close"),body:$("#"+this.selectedOverlayName+"-Box-Body")};this.box.width(this.ad_width);this.box.height(this.ad_height);this.box.css("left",(this.overlay.width()-this.box.width())/2);this.box.css("top",(this.overlay.height()-this.box.height()-this.boxContents.header.height()-
this.boxContents.footer.height())/2);this.overlay.show(this.Timer(this.ad_duration))},Timer:function(b){var f=b,e=setInterval(function(){MobileAdInGamePreroll.boxContents.header.text(MobileAdInGamePreroll.ready_in+f+"...");MobileAdInGamePreroll.boxContents.footer.text(MobileAdInGamePreroll.loading);f--;0>f&&(clearInterval(e),MobileAdInGamePreroll.boxContents.close.css("left",MobileAdInGamePreroll.boxContents.body.width()-23),MobileAdInGamePreroll.boxContents.close.show(),MobileAdInGamePreroll.boxContents.header.html(MobileAdInGamePreroll.close),
MobileAdInGamePreroll.boxContents.footer.text(""))},1E3)},Close:function(){this.boxContents.close.hide();this.overlay.hide()}};var MobileAdInGameHeader={ad_duration:_SETTINGS.Ad.Mobile.Header.Duration,ad_width:_SETTINGS.Ad.Mobile.Header.Width,ad_height:_SETTINGS.Ad.Mobile.Header.Height,Initialize:function(){if(_SETTINGS.Ad.Mobile.Header.Rotation.Enabled){var b=_SETTINGS.Ad.Mobile.Header.Rotation.Weight,f=b.MobileAdInGameHeader,e=f+b.MobileAdInGameHeader2,b=e+b.MobileAdInGameHeader3,c=Math.floor(100*Math.random());console.log("seed: ",c);c<=f?this.selectedOverlayName="MobileAdInGameHeader":c<=e?this.selectedOverlayName="MobileAdInGameHeader2":
c<=b&&(this.selectedOverlayName="MobileAdInGameHeader3");console.log("Ad rotating header enabled")}else this.selectedOverlayName="MobileAdInGameHeader",console.log("Ad rotating header disabled");this.div=$("#"+this.selectedOverlayName);this.game=$("#game");this.div.width(this.ad_width);this.div.height(this.ad_height);this.div.css("left",this.game.position().left+(this.game.width()-this.div.width())/2);this.div.css("top",0);this.div.show(this.Timer(this.ad_duration))},Timer:function(b){var f=setInterval(function(){b--;
0>b&&(MobileAdInGameHeader.div.hide(),clearInterval(f))},1E3)}};var MobileAdInGameFooter={ad_duration:_SETTINGS.Ad.Mobile.Footer.Duration,ad_width:_SETTINGS.Ad.Mobile.Footer.Width,ad_height:_SETTINGS.Ad.Mobile.Footer.Height,Initialize:function(){if(_SETTINGS.Ad.Mobile.Footer.Rotation.Enabled){var b=_SETTINGS.Ad.Mobile.Footer.Rotation.Weight,f=b.MobileAdInGameFooter,e=f+b.MobileAdInGameFooter2,b=e+b.MobileAdInGameFooter3,c=Math.floor(100*Math.random());console.log("seed: ",c);c<=f?this.selectedOverlayName="MobileAdInGameFooter":c<=e?this.selectedOverlayName="MobileAdInGameFooter2":
c<=b&&(this.selectedOverlayName="MobileAdInGameFooter3");console.log("Ad rotating footer enabled")}else this.selectedOverlayName="MobileAdInGameFooter",console.log("Ad rotating footer disabled");this.div=$("#"+this.selectedOverlayName);this.game=$("#game");this.div.width(this.ad_width);this.div.height(this.ad_height);this.div.css("left",this.game.position().left+(this.game.width()-this.div.width())/2);this.div.css("top",this.game.height()-this.div.height()-5);this.div.show(this.Timer(this.ad_duration))},
Timer:function(b){var f=setInterval(function(){b--;0>b&&(MobileAdInGameFooter.div.hide(),clearInterval(f))},1E3)}};var MobileAdInGameEnd={ad_duration:_SETTINGS.Ad.Mobile.End.Duration,ad_width:_SETTINGS.Ad.Mobile.End.Width,ad_height:_SETTINGS.Ad.Mobile.End.Height,ready_in:_STRINGS.Ad.Mobile.End.ReadyIn,loading:_STRINGS.Ad.Mobile.End.Loading,close:_STRINGS.Ad.Mobile.End.Close+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",Initialize:function(){if(_SETTINGS.Ad.Mobile.End.Rotation.Enabled){var b=_SETTINGS.Ad.Mobile.End.Rotation.Weight,f=b.MobileAdInGameEnd,e=f+b.MobileAdInGameEnd2,b=e+b.MobileAdInGameEnd3,
c=Math.floor(100*Math.random());console.log("seed: ",c);c<=f?this.selectedOverlayName="MobileAdInGameEnd":c<=e?this.selectedOverlayName="MobileAdInGameEnd2":c<=b&&(this.selectedOverlayName="MobileAdInGameEnd3");console.log("Ad rotating end enabled")}else this.selectedOverlayName="MobileAdInGameEnd",console.log("Ad rotating end disabled");console.log("selected:",this.selectedOverlayName);this.overlay=$("#"+this.selectedOverlayName);this.box=$("#"+this.selectedOverlayName+"-Box");this.game=$("#game");
this.boxContents={footer:$("#"+this.selectedOverlayName+"-Box-Footer"),header:$("#"+this.selectedOverlayName+"-Box-Header"),close:$("#"+this.selectedOverlayName+"-Box-Close"),body:$("#"+this.selectedOverlayName+"-Box-Body")};this.box.width(this.ad_width);this.box.height(this.ad_height);this.box.css("left",(this.overlay.width()-this.box.width())/2);this.box.css("top",(this.overlay.height()-this.box.height()-this.boxContents.header.height()-this.boxContents.footer.height())/2);this.overlay.show(this.Timer(this.ad_duration))},
Timer:function(b){var f=b,e=setInterval(function(){MobileAdInGameEnd.boxContents.header.text(MobileAdInGameEnd.ready_in+f+"...");MobileAdInGameEnd.boxContents.footer.text(MobileAdInGameEnd.loading);f--;0>f&&(clearInterval(e),MobileAdInGameEnd.boxContents.close.css("left",MobileAdInGameEnd.boxContents.body.width()-23),MobileAdInGameEnd.boxContents.close.show(),MobileAdInGameEnd.boxContents.header.html(MobileAdInGameEnd.close),MobileAdInGameEnd.boxContents.footer.text(""))},1E3)},Close:function(){this.boxContents.close.hide();
this.overlay.hide()}};(function(b,f){function e(b,c,d){if(d===f&&1===b.nodeType)if(d="data-"+c.replace(wa,"-$1").toLowerCase(),d=b.getAttribute(d),"string"==typeof d){try{d="true"===d?!0:"false"===d?!1:"null"===d?null:+d+""===d?+d:rb.test(d)?v.parseJSON(d):d}catch(g){}v.data(b,c,d)}else d=f;return d}function c(b){for(var c in b)if(!("data"===c&&v.isEmptyObject(b[c]))&&"toJSON"!==c)return!1;return!0}function d(){return!1}function g(){return!0}function m(b){return!b||!b.parentNode||11===b.parentNode.nodeType}function j(b,
c){do b=b[c];while(b&&1!==b.nodeType);return b}function l(b,c,d){c=c||0;if(v.isFunction(c))return v.grep(b,function(b,g){return!!c.call(b,g,b)===d});if(c.nodeType)return v.grep(b,function(b){return b===c===d});if("string"==typeof c){var g=v.grep(b,function(b){return 1===b.nodeType});if(Ac.test(c))return v.filter(c,g,!d);c=v.filter(c,g)}return v.grep(b,function(b){return 0<=v.inArray(b,c)===d})}function n(b){var c=Bc.split("|");b=b.createDocumentFragment();if(b.createElement)for(;c.length;)b.createElement(c.pop());
return b}function q(b,c){if(1===c.nodeType&&v.hasData(b)){var d,g,e;g=v._data(b);var l=v._data(c,g),j=g.events;if(j)for(d in delete l.handle,l.events={},j){g=0;for(e=j[d].length;g<e;g++)v.event.add(c,d,j[d][g])}l.data&&(l.data=v.extend({},l.data))}}function p(b,c){var d;1===c.nodeType&&(c.clearAttributes&&c.clearAttributes(),c.mergeAttributes&&c.mergeAttributes(b),d=c.nodeName.toLowerCase(),"object"===d?(c.parentNode&&(c.outerHTML=b.outerHTML),v.support.html5Clone&&b.innerHTML&&!v.trim(c.innerHTML)&&
(c.innerHTML=b.innerHTML)):"input"===d&&mc.test(b.type)?(c.defaultChecked=c.checked=b.checked,c.value!==b.value&&(c.value=b.value)):"option"===d?c.selected=b.defaultSelected:"input"===d||"textarea"===d?c.defaultValue=b.defaultValue:"script"===d&&c.text!==b.text&&(c.text=b.text),c.removeAttribute(v.expando))}function r(b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName("*"):"undefined"!=typeof b.querySelectorAll?b.querySelectorAll("*"):[]}function t(b){mc.test(b.type)&&(b.defaultChecked=
b.checked)}function s(b,c){if(c in b)return c;for(var d=c.charAt(0).toUpperCase()+c.slice(1),g=c,e=Nc.length;e--;)if(c=Nc[e]+d,c in b)return c;return g}function u(b,c){return b=c||b,"none"===v.css(b,"display")||!v.contains(b.ownerDocument,b)}function x(b,c){for(var d,g,e=[],l=0,j=b.length;l<j;l++)d=b[l],d.style&&(e[l]=v._data(d,"olddisplay"),c?(!e[l]&&"none"===d.style.display&&(d.style.display=""),""===d.style.display&&u(d)&&(e[l]=v._data(d,"olddisplay",B(d.nodeName)))):(g=pa(d,"display"),!e[l]&&
"none"!==g&&v._data(d,"olddisplay",g)));for(l=0;l<j;l++)if(d=b[l],d.style&&(!c||"none"===d.style.display||""===d.style.display))d.style.display=c?e[l]||"":"none";return b}function y(b,c,d){return(b=Ua.exec(c))?Math.max(0,b[1]-(d||0))+(b[2]||"px"):c}function z(b,c,d,g){c=d===(g?"border":"content")?4:"width"===c?1:0;for(var e=0;4>c;c+=2)"margin"===d&&(e+=v.css(b,d+Lc[c],!0)),g?("content"===d&&(e-=parseFloat(pa(b,"padding"+Lc[c]))||0),"margin"!==d&&(e-=parseFloat(pa(b,"border"+Lc[c]+"Width"))||0)):(e+=
parseFloat(pa(b,"padding"+Lc[c]))||0,"padding"!==d&&(e+=parseFloat(pa(b,"border"+Lc[c]+"Width"))||0));return e}function A(b,c,d){var g="width"===c?b.offsetWidth:b.offsetHeight,e=!0,l=v.support.boxSizing&&"border-box"===v.css(b,"boxSizing");if(0>=g||null==g){g=pa(b,c);if(0>g||null==g)g=b.style[c];if(Tc.test(g))return g;e=l&&(v.support.boxSizingReliable||g===b.style[c]);g=parseFloat(g)||0}return g+z(b,c,d||(l?"border":"content"),e)+"px"}function B(b){if(Pc[b])return Pc[b];var c=v("<"+b+">").appendTo(K.body),
d=c.css("display");c.remove();if("none"===d||""===d){V=K.body.appendChild(V||v.extend(K.createElement("iframe"),{frameBorder:0,width:0,height:0}));if(!oa||!V.createElement)oa=(V.contentWindow||V.contentDocument).document,oa.write("<!doctype html><html><body>"),oa.close();c=oa.body.appendChild(oa.createElement(b));d=pa(c,"display");K.body.removeChild(V)}return Pc[b]=d,d}function C(b,c,d,g){var e;if(v.isArray(c))v.each(c,function(c,e){d||qd.test(b)?g(b,e):C(b+"["+("object"==typeof e?c:"")+"]",e,d,g)});
else if(!d&&"object"===v.type(c))for(e in c)C(b+"["+e+"]",c[e],d,g);else g(b,c)}function D(b){return function(c,d){"string"!=typeof c&&(d=c,c="*");var g,e,l=c.toLowerCase().split(ba),j=0,f=l.length;if(v.isFunction(d))for(;j<f;j++)g=l[j],(e=/^\+/.test(g))&&(g=g.substr(1)||"*"),g=b[g]=b[g]||[],g[e?"unshift":"push"](d)}}function E(b,c,d,g,e,l){e=e||c.dataTypes[0];l=l||{};l[e]=!0;var j;e=b[e];for(var m=0,n=e?e.length:0,p=b===ed;m<n&&(p||!j);m++)j=e[m](c,d,g),"string"==typeof j&&(!p||l[j]?j=f:(c.dataTypes.unshift(j),
j=E(b,c,d,g,j,l)));return(p||!j)&&!l["*"]&&(j=E(b,c,d,g,"*",l)),j}function I(b,c){var d,g,e=v.ajaxSettings.flatOptions||{};for(d in c)c[d]!==f&&((e[d]?b:g||(g={}))[d]=c[d]);g&&v.extend(!0,b,g)}function H(){try{return new b.XMLHttpRequest}catch(c){}}function F(){return setTimeout(function(){Yc=f},0),Yc=v.now()}function J(b,c,d){var g,e=0,l=Zc.length,j=v.Deferred().always(function(){delete f.elem}),f=function(){for(var c=Yc||F(),c=Math.max(0,m.startTime+m.duration-c),d=1-(c/m.duration||0),g=0,e=m.tweens.length;g<
e;g++)m.tweens[g].run(d);return j.notifyWith(b,[m,d,c]),1>d&&e?c:(j.resolveWith(b,[m]),!1)},m=j.promise({elem:b,props:v.extend({},c),opts:v.extend(!0,{specialEasing:{}},d),originalProperties:c,originalOptions:d,startTime:Yc||F(),duration:d.duration,tweens:[],createTween:function(c,d){var g=v.Tween(b,m.opts,c,d,m.opts.specialEasing[c]||m.opts.easing);return m.tweens.push(g),g},stop:function(c){for(var d=0,g=c?m.tweens.length:0;d<g;d++)m.tweens[d].run(1);return c?j.resolveWith(b,[m,c]):j.rejectWith(b,
[m,c]),this}});c=m.props;d=m.opts.specialEasing;var n,p,q,r;for(g in c)if(n=v.camelCase(g),p=d[n],q=c[g],v.isArray(q)&&(p=q[1],q=c[g]=q[0]),g!==n&&(c[n]=q,delete c[g]),(r=v.cssHooks[n])&&"expand"in r)for(g in q=r.expand(q),delete c[n],q)g in c||(c[g]=q[g],d[g]=p);else d[n]=p;for(;e<l;e++)if(g=Zc[e].call(m,b,c,m.opts))return g;var s=m;v.each(c,function(b,c){for(var d=(Xc[b]||[]).concat(Xc["*"]),g=0,e=d.length;g<e&&!d[g].call(s,b,c);g++);});return v.isFunction(m.opts.start)&&m.opts.start.call(b,m),
v.fx.timer(v.extend(f,{anim:m,queue:m.opts.queue,elem:b})),m.progress(m.opts.progress).done(m.opts.done,m.opts.complete).fail(m.opts.fail).always(m.opts.always)}function G(b,c,d,g,e){return new G.prototype.init(b,c,d,g,e)}function L(b,c){var d,g={height:b},e=0;for(c=c?1:0;4>e;e+=2-c)d=Lc[e],g["margin"+d]=g["padding"+d]=b;return c&&(g.opacity=g.width=b),g}function N(b){return v.isWindow(b)?b:9===b.nodeType?b.defaultView||b.parentWindow:!1}var R,P,K=b.document,O=b.location,M=b.navigator,W=b.jQuery,
Ga=b.$,qa=Array.prototype.push,fa=Array.prototype.slice,Ba=Array.prototype.indexOf,Va=Object.prototype.toString,Ra=Object.prototype.hasOwnProperty,Z=String.prototype.trim,v=function(b,c){return new v.fn.init(b,c,R)},U=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,X=/\S/,ba=/\s+/,da=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,ra=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,ga=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,xa=/^[\],:{}\s]*$/,ya=/(?:^|:|,)(?:\s*\[)+/g,ma=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,na=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,
aa=/^-ms-/,ea=/-([\da-z])/gi,Ha=function(b,c){return(c+"").toUpperCase()},Ca=function(){K.addEventListener?(K.removeEventListener("DOMContentLoaded",Ca,!1),v.ready()):"complete"===K.readyState&&(K.detachEvent("onreadystatechange",Ca),v.ready())},Ia={};v.fn=v.prototype={constructor:v,init:function(b,c,d){var g,e;if(!b)return this;if(b.nodeType)return this.context=this[0]=b,this.length=1,this;if("string"==typeof b){"<"===b.charAt(0)&&">"===b.charAt(b.length-1)&&3<=b.length?g=[null,b,null]:g=ra.exec(b);
if(g&&(g[1]||!c)){if(g[1])return c=c instanceof v?c[0]:c,e=c&&c.nodeType?c.ownerDocument||c:K,b=v.parseHTML(g[1],e,!0),ga.test(g[1])&&v.isPlainObject(c)&&this.attr.call(b,c,!0),v.merge(this,b);if((c=K.getElementById(g[2]))&&c.parentNode){if(c.id!==g[2])return d.find(b);this.length=1;this[0]=c}return this.context=K,this.selector=b,this}return!c||c.jquery?(c||d).find(b):this.constructor(c).find(b)}return v.isFunction(b)?d.ready(b):(b.selector!==f&&(this.selector=b.selector,this.context=b.context),v.makeArray(b,
this))},selector:"",jquery:"1.8.2",length:0,size:function(){return this.length},toArray:function(){return fa.call(this)},get:function(b){return null==b?this.toArray():0>b?this[this.length+b]:this[b]},pushStack:function(b,c,d){b=v.merge(this.constructor(),b);return b.prevObject=this,b.context=this.context,"find"===c?b.selector=this.selector+(this.selector?" ":"")+d:c&&(b.selector=this.selector+"."+c+"("+d+")"),b},each:function(b,c){return v.each(this,b,c)},ready:function(b){return v.ready.promise().done(b),
this},eq:function(b){return b=+b,-1===b?this.slice(b):this.slice(b,b+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(fa.apply(this,arguments),"slice",fa.call(arguments).join(","))},map:function(b){return this.pushStack(v.map(this,function(c,d){return b.call(c,d,c)}))},end:function(){return this.prevObject||this.constructor(null)},push:qa,sort:[].sort,splice:[].splice};v.fn.init.prototype=v.fn;v.extend=v.fn.extend=function(){var b,
c,d,g,e,l,j=arguments[0]||{},m=1,n=arguments.length,p=!1;"boolean"==typeof j&&(p=j,j=arguments[1]||{},m=2);"object"!=typeof j&&!v.isFunction(j)&&(j={});for(n===m&&(j=this,--m);m<n;m++)if(null!=(b=arguments[m]))for(c in b)d=j[c],g=b[c],j!==g&&(p&&g&&(v.isPlainObject(g)||(e=v.isArray(g)))?(e?(e=!1,l=d&&v.isArray(d)?d:[]):l=d&&v.isPlainObject(d)?d:{},j[c]=v.extend(p,l,g)):g!==f&&(j[c]=g));return j};v.extend({noConflict:function(c){return b.$===v&&(b.$=Ga),c&&b.jQuery===v&&(b.jQuery=W),v},isReady:!1,
readyWait:1,holdReady:function(b){b?v.readyWait++:v.ready(!0)},ready:function(b){if(!(!0===b?--v.readyWait:v.isReady)){if(!K.body)return setTimeout(v.ready,1);v.isReady=!0;!0!==b&&0<--v.readyWait||(P.resolveWith(K,[v]),v.fn.trigger&&v(K).trigger("ready").off("ready"))}},isFunction:function(b){return"function"===v.type(b)},isArray:Array.isArray||function(b){return"array"===v.type(b)},isWindow:function(b){return null!=b&&b==b.window},isNumeric:function(b){return!isNaN(parseFloat(b))&&isFinite(b)},type:function(b){return null==
b?String(b):Ia[Va.call(b)]||"object"},isPlainObject:function(b){if(!b||"object"!==v.type(b)||b.nodeType||v.isWindow(b))return!1;try{if(b.constructor&&!Ra.call(b,"constructor")&&!Ra.call(b.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}for(var d in b);return d===f||Ra.call(b,d)},isEmptyObject:function(b){for(var c in b)return!1;return!0},error:function(b){throw Error(b);},parseHTML:function(b,c,d){var g;return!b||"string"!=typeof b?null:("boolean"==typeof c&&(d=c,c=0),c=c||K,(g=
ga.exec(b))?[c.createElement(g[1])]:(g=v.buildFragment([b],c,d?null:[]),v.merge([],(g.cacheable?v.clone(g.fragment):g.fragment).childNodes)))},parseJSON:function(c){if(!c||"string"!=typeof c)return null;c=v.trim(c);if(b.JSON&&b.JSON.parse)return b.JSON.parse(c);if(xa.test(c.replace(ma,"@").replace(na,"]").replace(ya,"")))return(new Function("return "+c))();v.error("Invalid JSON: "+c)},parseXML:function(c){var d,g;if(!c||"string"!=typeof c)return null;try{b.DOMParser?(g=new DOMParser,d=g.parseFromString(c,
"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(e){d=f}return(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&v.error("Invalid XML: "+c),d},noop:function(){},globalEval:function(c){c&&X.test(c)&&(b.execScript||function(c){b.eval.call(b,c)})(c)},camelCase:function(b){return b.replace(aa,"ms-").replace(ea,Ha)},nodeName:function(b,c){return b.nodeName&&b.nodeName.toLowerCase()===c.toLowerCase()},each:function(b,c,d){var g,e=0,l=b.length,
j=l===f||v.isFunction(b);if(d)if(j)for(g in b){if(!1===c.apply(b[g],d))break}else for(;e<l&&!1!==c.apply(b[e++],d););else if(j)for(g in b){if(!1===c.call(b[g],g,b[g]))break}else for(;e<l&&!1!==c.call(b[e],e,b[e++]););return b},trim:Z&&!Z.call("\ufeff\u00a0")?function(b){return null==b?"":Z.call(b)}:function(b){return null==b?"":(b+"").replace(da,"")},makeArray:function(b,c){var d,g=c||[];return null!=b&&(d=v.type(b),null==b.length||"string"===d||"function"===d||"regexp"===d||v.isWindow(b)?qa.call(g,
b):v.merge(g,b)),g},inArray:function(b,c,d){var g;if(c){if(Ba)return Ba.call(c,b,d);g=c.length;for(d=d?0>d?Math.max(0,g+d):d:0;d<g;d++)if(d in c&&c[d]===b)return d}return-1},merge:function(b,c){var d=c.length,g=b.length,e=0;if("number"==typeof d)for(;e<d;e++)b[g++]=c[e];else for(;c[e]!==f;)b[g++]=c[e++];return b.length=g,b},grep:function(b,c,d){var g,e=[],l=0,j=b.length;for(d=!!d;l<j;l++)g=!!c(b[l],l),d!==g&&e.push(b[l]);return e},map:function(b,c,d){var g,e,l=[],j=0,m=b.length;if(b instanceof v||
m!==f&&"number"==typeof m&&(0<m&&b[0]&&b[m-1]||0===m||v.isArray(b)))for(;j<m;j++)g=c(b[j],j,d),null!=g&&(l[l.length]=g);else for(e in b)g=c(b[e],e,d),null!=g&&(l[l.length]=g);return l.concat.apply([],l)},guid:1,proxy:function(b,c){var d,g,e;return"string"==typeof c&&(d=b[c],c=b,b=d),v.isFunction(b)?(g=fa.call(arguments,2),e=function(){return b.apply(c,g.concat(fa.call(arguments)))},e.guid=b.guid=b.guid||v.guid++,e):f},access:function(b,c,d,g,e,l,j){var m,n=null==d,p=0,q=b.length;if(d&&"object"==typeof d){for(p in d)v.access(b,
c,p,d[p],1,l,g);e=1}else if(g!==f){m=j===f&&v.isFunction(g);n&&(m?(m=c,c=function(b,c,d){return m.call(v(b),d)}):(c.call(b,g),c=null));if(c)for(;p<q;p++)c(b[p],d,m?g.call(b[p],p,c(b[p],d)):g,j);e=1}return e?b:n?c.call(b):q?c(b[0],d):l},now:function(){return(new Date).getTime()}});v.ready.promise=function(c){if(!P)if(P=v.Deferred(),"complete"===K.readyState)setTimeout(v.ready,1);else if(K.addEventListener)K.addEventListener("DOMContentLoaded",Ca,!1),b.addEventListener("load",v.ready,!1);else{K.attachEvent("onreadystatechange",
Ca);b.attachEvent("onload",v.ready);var d=!1;try{d=null==b.frameElement&&K.documentElement}catch(g){}d&&d.doScroll&&function pd(){if(!v.isReady){try{d.doScroll("left")}catch(b){return setTimeout(pd,50)}v.ready()}}()}return P.promise(c)};v.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(b,c){Ia["[object "+c+"]"]=c.toLowerCase()});R=v(K);var Ja={};v.Callbacks=function(b){var c;if("string"==typeof b){if(!(c=Ja[b])){c=b;var d=Ja[c]={};c=(v.each(c.split(ba),function(b,
c){d[c]=!0}),d)}}else c=v.extend({},b);b=c;var g,e,l,j,m,n,p=[],q=!b.once&&[],r=function(c){g=b.memory&&c;e=!0;n=j||0;j=0;m=p.length;for(l=!0;p&&n<m;n++)if(!1===p[n].apply(c[0],c[1])&&b.stopOnFalse){g=!1;break}l=!1;p&&(q?q.length&&r(q.shift()):g?p=[]:s.disable())},s={add:function(){if(p){var c=p.length;(function rd(c){v.each(c,function(c,d){var g=v.type(d);"function"===g&&(!b.unique||!s.has(d))?p.push(d):d&&d.length&&"string"!==g&&rd(d)})})(arguments);l?m=p.length:g&&(j=c,r(g))}return this},remove:function(){return p&&
v.each(arguments,function(b,c){for(var d;-1<(d=v.inArray(c,p,d));)p.splice(d,1),l&&(d<=m&&m--,d<=n&&n--)}),this},has:function(b){return-1<v.inArray(b,p)},empty:function(){return p=[],this},disable:function(){return p=q=g=f,this},disabled:function(){return!p},lock:function(){return q=f,g||s.disable(),this},locked:function(){return!q},fireWith:function(b,c){return c=c||[],c=[b,c.slice?c.slice():c],p&&(!e||q)&&(l?q.push(c):r(c)),this},fire:function(){return s.fireWith(this,arguments),this},fired:function(){return!!e}};
return s};v.extend({Deferred:function(b){var c=[["resolve","done",v.Callbacks("once memory"),"resolved"],["reject","fail",v.Callbacks("once memory"),"rejected"],["notify","progress",v.Callbacks("memory")]],d="pending",g={state:function(){return d},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var b=arguments;return v.Deferred(function(d){v.each(c,function(c,g){var l=g[0],j=b[c];e[g[1]](v.isFunction(j)?function(){var b=j.apply(this,arguments);b&&v.isFunction(b.promise)?
b.promise().done(d.resolve).fail(d.reject).progress(d.notify):d[l+"With"](this===e?d:this,[b])}:d[l])});b=null}).promise()},promise:function(b){return null!=b?v.extend(b,g):g}},e={};return g.pipe=g.then,v.each(c,function(b,l){var j=l[2],f=l[3];g[l[1]]=j.add;f&&j.add(function(){d=f},c[b^1][2].disable,c[2][2].lock);e[l[0]]=j.fire;e[l[0]+"With"]=j.fireWith}),g.promise(e),b&&b.call(e,e),e},when:function(b){var c=0,d=fa.call(arguments),g=d.length,e=1!==g||b&&v.isFunction(b.promise)?g:0,l=1===e?b:v.Deferred(),
j=function(b,c,d){return function(g){c[b]=this;d[b]=1<arguments.length?fa.call(arguments):g;d===f?l.notifyWith(c,d):--e||l.resolveWith(c,d)}},f,m,n;if(1<g){f=Array(g);m=Array(g);for(n=Array(g);c<g;c++)d[c]&&v.isFunction(d[c].promise)?d[c].promise().done(j(c,n,d)).fail(l.reject).progress(j(c,m,f)):--e}return e||l.resolveWith(n,d),l.promise()}});var Ma=v,Fb;var Wa,Ub,Kb,Lb,cc,ob,Ob,dc,Xa,Ta,$a,ca=K.createElement("div");ca.setAttribute("className","t");ca.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";
Ub=ca.getElementsByTagName("*");Kb=ca.getElementsByTagName("a")[0];Kb.style.cssText="top:1px;float:left;opacity:.5";if(!Ub||!Ub.length)Fb={};else{Lb=K.createElement("select");cc=Lb.appendChild(K.createElement("option"));ob=ca.getElementsByTagName("input")[0];Wa={leadingWhitespace:3===ca.firstChild.nodeType,tbody:!ca.getElementsByTagName("tbody").length,htmlSerialize:!!ca.getElementsByTagName("link").length,style:/top/.test(Kb.getAttribute("style")),hrefNormalized:"/a"===Kb.getAttribute("href"),opacity:/^0.5/.test(Kb.style.opacity),
cssFloat:!!Kb.style.cssFloat,checkOn:"on"===ob.value,optSelected:cc.selected,getSetAttribute:"t"!==ca.className,enctype:!!K.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==K.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===K.compatMode,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1};ob.checked=!0;Wa.noCloneChecked=ob.cloneNode(!0).checked;
Lb.disabled=!0;Wa.optDisabled=!cc.disabled;try{delete ca.test}catch(kb){Wa.deleteExpando=!1}!ca.addEventListener&&ca.attachEvent&&ca.fireEvent&&(ca.attachEvent("onclick",$a=function(){Wa.noCloneEvent=!1}),ca.cloneNode(!0).fireEvent("onclick"),ca.detachEvent("onclick",$a));ob=K.createElement("input");ob.value="t";ob.setAttribute("type","radio");Wa.radioValue="t"===ob.value;ob.setAttribute("checked","checked");ob.setAttribute("name","t");ca.appendChild(ob);Ob=K.createDocumentFragment();Ob.appendChild(ca.lastChild);
Wa.checkClone=Ob.cloneNode(!0).cloneNode(!0).lastChild.checked;Wa.appendChecked=ob.checked;Ob.removeChild(ob);Ob.appendChild(ca);if(ca.attachEvent)for(Xa in{submit:!0,change:!0,focusin:!0})dc="on"+Xa,(Ta=dc in ca)||(ca.setAttribute(dc,"return;"),Ta="function"==typeof ca[dc]),Wa[Xa+"Bubbles"]=Ta;Fb=(v(function(){var c,d,g,e,l=K.getElementsByTagName("body")[0];l&&(c=K.createElement("div"),c.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",l.insertBefore(c,
l.firstChild),d=K.createElement("div"),c.appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",g=d.getElementsByTagName("td"),g[0].style.cssText="padding:0;margin:0;border:0;display:none",Ta=0===g[0].offsetHeight,g[0].style.display="",g[1].style.display="none",Wa.reliableHiddenOffsets=Ta&&0===g[0].offsetHeight,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",
Wa.boxSizing=4===d.offsetWidth,Wa.doesNotIncludeMarginInBodyOffset=1!==l.offsetTop,b.getComputedStyle&&(Wa.pixelPosition="1%"!==(b.getComputedStyle(d,null)||{}).top,Wa.boxSizingReliable="4px"===(b.getComputedStyle(d,null)||{width:"4px"}).width,e=K.createElement("div"),e.style.cssText=d.style.cssText="padding:0;margin:0;border:0;display:block;overflow:hidden;",e.style.marginRight=e.style.width="0",d.style.width="1px",d.appendChild(e),Wa.reliableMarginRight=!parseFloat((b.getComputedStyle(e,null)||
{}).marginRight)),"undefined"!=typeof d.style.zoom&&(d.innerHTML="",d.style.cssText="padding:0;margin:0;border:0;display:block;overflow:hidden;width:1px;padding:1px;display:inline;zoom:1",Wa.inlineBlockNeedsLayout=3===d.offsetWidth,d.style.display="block",d.style.overflow="visible",d.innerHTML="<div></div>",d.firstChild.style.width="5px",Wa.shrinkWrapBlocks=3!==d.offsetWidth,c.style.zoom=1),l.removeChild(c))}),Ob.removeChild(ca),Ub=Kb=Lb=cc=ob=Ob=ca=null,Wa)}Ma.support=Fb;var rb=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,
wa=/([A-Z])/g;v.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(v.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(b){return b=b.nodeType?v.cache[b[v.expando]]:b[v.expando],!!b&&!c(b)},data:function(b,c,d,g){if(v.acceptData(b)){var e,l,j=v.expando,m="string"==typeof c,n=b.nodeType,p=n?v.cache:b,q=n?b[j]:b[j]&&j;if(q&&p[q]&&(g||p[q].data)||!(m&&d===f)){q||(n?b[j]=q=v.deletedIds.pop()||v.guid++:q=j);p[q]||
(p[q]={},n||(p[q].toJSON=v.noop));if("object"==typeof c||"function"==typeof c)g?p[q]=v.extend(p[q],c):p[q].data=v.extend(p[q].data,c);return e=p[q],g||(e.data||(e.data={}),e=e.data),d!==f&&(e[v.camelCase(c)]=d),m?(l=e[c],null==l&&(l=e[v.camelCase(c)])):l=e,l}}},removeData:function(b,d,g){if(v.acceptData(b)){var e,l,j,f=b.nodeType,m=f?v.cache:b,n=f?b[v.expando]:v.expando;if(m[n]){if(d&&(e=g?m[n]:m[n].data)){v.isArray(d)||(d in e?d=[d]:(d=v.camelCase(d),d in e?d=[d]:d=d.split(" ")));l=0;for(j=d.length;l<
j;l++)delete e[d[l]];if(!(g?c:v.isEmptyObject)(e))return}if(!g&&(delete m[n].data,!c(m[n])))return;f?v.cleanData([b],!0):v.support.deleteExpando||m!=m.window?delete m[n]:m[n]=null}}},_data:function(b,c,d){return v.data(b,c,d,!0)},acceptData:function(b){var c=b.nodeName&&v.noData[b.nodeName.toLowerCase()];return!c||!0!==c&&b.getAttribute("classid")===c}});v.fn.extend({data:function(b,c){var d,g,l,j,m,n=this[0],p=0,q=null;if(b===f){if(this.length&&(q=v.data(n),1===n.nodeType&&!v._data(n,"parsedAttrs"))){l=
n.attributes;for(m=l.length;p<m;p++)j=l[p].name,j.indexOf("data-")||(j=v.camelCase(j.substring(5)),e(n,j,q[j]));v._data(n,"parsedAttrs",!0)}return q}return"object"==typeof b?this.each(function(){v.data(this,b)}):(d=b.split(".",2),d[1]=d[1]?"."+d[1]:"",g=d[1]+"!",v.access(this,function(c){if(c===f)return q=this.triggerHandler("getData"+g,[d[0]]),q===f&&n&&(q=v.data(n,b),q=e(n,b,q)),q===f&&d[1]?this.data(d[0]):q;d[1]=c;this.each(function(){var e=v(this);e.triggerHandler("setData"+g,d);v.data(this,b,
c);e.triggerHandler("changeData"+g,d)})},null,c,1<arguments.length,null,!1))},removeData:function(b){return this.each(function(){v.removeData(this,b)})}});v.extend({queue:function(b,c,d){var g;if(b)return c=(c||"fx")+"queue",g=v._data(b,c),d&&(!g||v.isArray(d)?g=v._data(b,c,v.makeArray(d)):g.push(d)),g||[]},dequeue:function(b,c){c=c||"fx";var d=v.queue(b,c),g=d.length,e=d.shift(),l=v._queueHooks(b,c),j=function(){v.dequeue(b,c)};"inprogress"===e&&(e=d.shift(),g--);e&&("fx"===c&&d.unshift("inprogress"),
delete l.stop,e.call(b,j,l));!g&&l&&l.empty.fire()},_queueHooks:function(b,c){var d=c+"queueHooks";return v._data(b,d)||v._data(b,d,{empty:v.Callbacks("once memory").add(function(){v.removeData(b,c+"queue",!0);v.removeData(b,d,!0)})})}});v.fn.extend({queue:function(b,c){var d=2;return"string"!=typeof b&&(c=b,b="fx",d--),arguments.length<d?v.queue(this[0],b):c===f?this:this.each(function(){var d=v.queue(this,b,c);v._queueHooks(this,b);"fx"===b&&"inprogress"!==d[0]&&v.dequeue(this,b)})},dequeue:function(b){return this.each(function(){v.dequeue(this,
b)})},delay:function(b,c){return b=v.fx?v.fx.speeds[b]||b:b,c=c||"fx",this.queue(c,function(c,d){var g=setTimeout(c,b);d.stop=function(){clearTimeout(g)}})},clearQueue:function(b){return this.queue(b||"fx",[])},promise:function(b,c){var d,g=1,e=v.Deferred(),l=this,j=this.length,m=function(){--g||e.resolveWith(l,[l])};"string"!=typeof b&&(c=b,b=f);for(b=b||"fx";j--;)(d=v._data(l[j],b+"queueHooks"))&&d.empty&&(g++,d.empty.add(m));return m(),e.promise(c)}});var ha,va,pb,sb=/[\t\r\n]/g,xb=/\r/g,yb=/^(?:button|input)$/i,
Vb=/^(?:button|input|object|select|textarea)$/i,Wb=/^a(?:rea|)$/i,Pb=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,Qb=v.support.getSetAttribute;v.fn.extend({attr:function(b,c){return v.access(this,v.attr,b,c,1<arguments.length)},removeAttr:function(b){return this.each(function(){v.removeAttr(this,b)})},prop:function(b,c){return v.access(this,v.prop,b,c,1<arguments.length)},removeProp:function(b){return b=v.propFix[b]||
b,this.each(function(){try{this[b]=f,delete this[b]}catch(c){}})},addClass:function(b){var c,d,g,e,l,j,f;if(v.isFunction(b))return this.each(function(c){v(this).addClass(b.call(this,c,this.className))});if(b&&"string"==typeof b){c=b.split(ba);d=0;for(g=this.length;d<g;d++)if(e=this[d],1===e.nodeType)if(!e.className&&1===c.length)e.className=b;else{l=" "+e.className+" ";j=0;for(f=c.length;j<f;j++)0>l.indexOf(" "+c[j]+" ")&&(l+=c[j]+" ");e.className=v.trim(l)}}return this},removeClass:function(b){var c,
d,g,e,l,j,m;if(v.isFunction(b))return this.each(function(c){v(this).removeClass(b.call(this,c,this.className))});if(b&&"string"==typeof b||b===f){c=(b||"").split(ba);j=0;for(m=this.length;j<m;j++)if(g=this[j],1===g.nodeType&&g.className){d=(" "+g.className+" ").replace(sb," ");e=0;for(l=c.length;e<l;e++)for(;0<=d.indexOf(" "+c[e]+" ");)d=d.replace(" "+c[e]+" "," ");g.className=b?v.trim(d):""}}return this},toggleClass:function(b,c){var d=typeof b,g="boolean"==typeof c;return v.isFunction(b)?this.each(function(d){v(this).toggleClass(b.call(this,
d,this.className,c),c)}):this.each(function(){if("string"===d)for(var e,l=0,j=v(this),f=c,m=b.split(ba);e=m[l++];)f=g?f:!j.hasClass(e),j[f?"addClass":"removeClass"](e);else if("undefined"===d||"boolean"===d)this.className&&v._data(this,"__className__",this.className),this.className=this.className||!1===b?"":v._data(this,"__className__")||""})},hasClass:function(b){b=" "+b+" ";for(var c=0,d=this.length;c<d;c++)if(1===this[c].nodeType&&0<=(" "+this[c].className+" ").replace(sb," ").indexOf(b))return!0;
return!1},val:function(b){var c,d,g,e=this[0];if(arguments.length)return g=v.isFunction(b),this.each(function(d){var e,l=v(this);if(1===this.nodeType&&(g?e=b.call(this,d,l.val()):e=b,null==e?e="":"number"==typeof e?e+="":v.isArray(e)&&(e=v.map(e,function(b){return null==b?"":b+""})),c=v.valHooks[this.type]||v.valHooks[this.nodeName.toLowerCase()],!c||!("set"in c)||c.set(this,e,"value")===f))this.value=e});if(e)return c=v.valHooks[e.type]||v.valHooks[e.nodeName.toLowerCase()],c&&"get"in c&&(d=c.get(e,
"value"))!==f?d:(d=e.value,"string"==typeof d?d.replace(xb,""):null==d?"":d)}});v.extend({valHooks:{option:{get:function(b){var c=b.attributes.value;return!c||c.specified?b.value:b.text}},select:{get:function(b){var c,d,g=b.selectedIndex,e=[],l=b.options,j="select-one"===b.type;if(0>g)return null;b=j?g:0;for(d=j?g+1:l.length;b<d;b++)if(c=l[b],c.selected&&(v.support.optDisabled?!c.disabled:null===c.getAttribute("disabled"))&&(!c.parentNode.disabled||!v.nodeName(c.parentNode,"optgroup"))){c=v(c).val();
if(j)return c;e.push(c)}return j&&!e.length&&l.length?v(l[g]).val():e},set:function(b,c){var d=v.makeArray(c);return v(b).find("option").each(function(){this.selected=0<=v.inArray(v(this).val(),d)}),d.length||(b.selectedIndex=-1),d}}},attrFn:{},attr:function(b,c,d,g){var e,l,j=b.nodeType;if(b&&!(3===j||8===j||2===j)){if(g&&v.isFunction(v.fn[c]))return v(b)[c](d);if("undefined"==typeof b.getAttribute)return v.prop(b,c,d);(g=1!==j||!v.isXMLDoc(b))&&(c=c.toLowerCase(),l=v.attrHooks[c]||(Pb.test(c)?va:
ha));if(d!==f){if(null===d){v.removeAttr(b,c);return}return l&&"set"in l&&g&&(e=l.set(b,d,c))!==f?e:(b.setAttribute(c,d+""),d)}return l&&"get"in l&&g&&null!==(e=l.get(b,c))?e:(e=b.getAttribute(c),null===e?f:e)}},removeAttr:function(b,c){var d,g,e,l,j=0;if(c&&1===b.nodeType)for(g=c.split(ba);j<g.length;j++)(e=g[j])&&(d=v.propFix[e]||e,l=Pb.test(e),l||v.attr(b,e,""),b.removeAttribute(Qb?e:d),l&&d in b&&(b[d]=!1))},attrHooks:{type:{set:function(b,c){if(yb.test(b.nodeName)&&b.parentNode)v.error("type property can't be changed");
else if(!v.support.radioValue&&"radio"===c&&v.nodeName(b,"input")){var d=b.value;return b.setAttribute("type",c),d&&(b.value=d),c}}},value:{get:function(b,c){return ha&&v.nodeName(b,"button")?ha.get(b,c):c in b?b.value:null},set:function(b,c,d){if(ha&&v.nodeName(b,"button"))return ha.set(b,c,d);b.value=c}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",
usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(b,c,d){var g,e,l,j=b.nodeType;if(b&&!(3===j||8===j||2===j))return l=1!==j||!v.isXMLDoc(b),l&&(c=v.propFix[c]||c,e=v.propHooks[c]),d!==f?e&&"set"in e&&(g=e.set(b,d,c))!==f?g:b[c]=d:e&&"get"in e&&null!==(g=e.get(b,c))?g:b[c]},propHooks:{tabIndex:{get:function(b){var c=b.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):Vb.test(b.nodeName)||Wb.test(b.nodeName)&&b.href?0:f}}}});va={get:function(b,
c){var d,g=v.prop(b,c);return!0===g||"boolean"!=typeof g&&(d=b.getAttributeNode(c))&&!1!==d.nodeValue?c.toLowerCase():f},set:function(b,c,d){var g;return!1===c?v.removeAttr(b,d):(g=v.propFix[d]||d,g in b&&(b[g]=!0),b.setAttribute(d,d.toLowerCase())),d}};Qb||(pb={name:!0,id:!0,coords:!0},ha=v.valHooks.button={get:function(b,c){var d;return d=b.getAttributeNode(c),d&&(pb[c]?""!==d.value:d.specified)?d.value:f},set:function(b,c,d){var g=b.getAttributeNode(d);return g||(g=K.createAttribute(d),b.setAttributeNode(g)),
g.value=c+""}},v.each(["width","height"],function(b,c){v.attrHooks[c]=v.extend(v.attrHooks[c],{set:function(b,d){if(""===d)return b.setAttribute(c,"auto"),d}})}),v.attrHooks.contenteditable={get:ha.get,set:function(b,c,d){""===c&&(c="false");ha.set(b,c,d)}});v.support.hrefNormalized||v.each(["href","src","width","height"],function(b,c){v.attrHooks[c]=v.extend(v.attrHooks[c],{get:function(b){b=b.getAttribute(c,2);return null===b?f:b}})});v.support.style||(v.attrHooks.style={get:function(b){return b.style.cssText.toLowerCase()||
f},set:function(b,c){return b.style.cssText=c+""}});v.support.optSelected||(v.propHooks.selected=v.extend(v.propHooks.selected,{get:function(b){b=b.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}}));v.support.enctype||(v.propFix.enctype="encoding");v.support.checkOn||v.each(["radio","checkbox"],function(){v.valHooks[this]={get:function(b){return null===b.getAttribute("value")?"on":b.value}}});v.each(["radio","checkbox"],function(){v.valHooks[this]=v.extend(v.valHooks[this],
{set:function(b,c){if(v.isArray(c))return b.checked=0<=v.inArray(v(b).val(),c)}})});var Mb=/^(?:textarea|input|select)$/i,wc=/^([^\.]*|)(?:\.(.+)|)$/,ab=/(?:^|\s)hover(\.\S+|)\b/,bb=/^key/,cb=/^(?:mouse|contextmenu)|click/,sa=/^(?:focusinfocus|focusoutblur)$/,zb=function(b){return v.event.special.hover?b:b.replace(ab,"mouseenter$1 mouseleave$1")};v.event={add:function(b,c,d,g,e){var l,j,m,n,p,q,r,s,t;if(!(3===b.nodeType||8===b.nodeType||!c||!d||!(l=v._data(b)))){d.handler&&(r=d,d=r.handler,e=r.selector);
d.guid||(d.guid=v.guid++);(m=l.events)||(l.events=m={});(j=l.handle)||(l.handle=j=function(b){return"undefined"!=typeof v&&(!b||v.event.triggered!==b.type)?v.event.dispatch.apply(j.elem,arguments):f},j.elem=b);c=v.trim(zb(c)).split(" ");for(l=0;l<c.length;l++){n=wc.exec(c[l])||[];p=n[1];q=(n[2]||"").split(".").sort();t=v.event.special[p]||{};p=(e?t.delegateType:t.bindType)||p;t=v.event.special[p]||{};n=v.extend({type:p,origType:n[1],data:g,handler:d,guid:d.guid,selector:e,needsContext:e&&v.expr.match.needsContext.test(e),
namespace:q.join(".")},r);s=m[p];if(!s&&(s=m[p]=[],s.delegateCount=0,!t.setup||!1===t.setup.call(b,g,q,j)))b.addEventListener?b.addEventListener(p,j,!1):b.attachEvent&&b.attachEvent("on"+p,j);t.add&&(t.add.call(b,n),n.handler.guid||(n.handler.guid=d.guid));e?s.splice(s.delegateCount++,0,n):s.push(n);v.event.global[p]=!0}b=null}},global:{},remove:function(b,c,d,g,e){var l,j,f,m,n,p,q,r,s,t,K=v.hasData(b)&&v._data(b);if(K&&(q=K.events)){c=v.trim(zb(c||"")).split(" ");for(l=0;l<c.length;l++)if(j=wc.exec(c[l])||
[],f=m=j[1],j=j[2],f){r=v.event.special[f]||{};f=(g?r.delegateType:r.bindType)||f;s=q[f]||[];n=s.length;j=j?RegExp("(^|\\.)"+j.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(p=0;p<s.length;p++)t=s[p],(e||m===t.origType)&&(!d||d.guid===t.guid)&&(!j||j.test(t.namespace))&&(!g||g===t.selector||"**"===g&&t.selector)&&(s.splice(p--,1),t.selector&&s.delegateCount--,r.remove&&r.remove.call(b,t));0===s.length&&n!==s.length&&((!r.teardown||!1===r.teardown.call(b,j,K.handle))&&v.removeEvent(b,
f,K.handle),delete q[f])}else for(f in q)v.event.remove(b,f+c[l],d,g,!0);v.isEmptyObject(q)&&(delete K.handle,v.removeData(b,"events",!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,g,e){if(!g||3!==g.nodeType&&8!==g.nodeType){var l,j,m,n,p,q,r,s=c.type||c;n=[];if(!sa.test(s+v.event.triggered)&&(0<=s.indexOf("!")&&(s=s.slice(0,-1),l=!0),0<=s.indexOf(".")&&(n=s.split("."),s=n.shift(),n.sort()),g&&!v.event.customEvent[s]||v.event.global[s]))if(c="object"==typeof c?c[v.expando]?
c:new v.Event(s,c):new v.Event(s),c.type=s,c.isTrigger=!0,c.exclusive=l,c.namespace=n.join("."),c.namespace_re=c.namespace?RegExp("(^|\\.)"+n.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n=0>s.indexOf(":")?"on"+s:"",g){if(c.result=f,c.target||(c.target=g),d=null!=d?v.makeArray(d):[],d.unshift(c),p=v.event.special[s]||{},!(p.trigger&&!1===p.trigger.apply(g,d))){r=[[g,p.bindType||s]];if(!e&&!p.noBubble&&!v.isWindow(g)){j=p.delegateType||s;l=sa.test(j+s)?g:g.parentNode;for(m=g;l;l=l.parentNode)r.push([l,j]),
m=l;m===(g.ownerDocument||K)&&r.push([m.defaultView||m.parentWindow||b,j])}for(j=0;j<r.length&&!c.isPropagationStopped();j++)l=r[j][0],c.type=r[j][1],(q=(v._data(l,"events")||{})[c.type]&&v._data(l,"handle"))&&q.apply(l,d),(q=n&&l[n])&&v.acceptData(l)&&q.apply&&!1===q.apply(l,d)&&c.preventDefault();return c.type=s,!e&&!c.isDefaultPrevented()&&(!p._default||!1===p._default.apply(g.ownerDocument,d))&&("click"!==s||!v.nodeName(g,"a"))&&v.acceptData(g)&&n&&g[s]&&("focus"!==s&&"blur"!==s||0!==c.target.offsetWidth)&&
!v.isWindow(g)&&(m=g[n],m&&(g[n]=null),v.event.triggered=s,g[s](),v.event.triggered=f,m&&(g[n]=m)),c.result}}else for(j in g=v.cache,g)g[j].events&&g[j].events[s]&&v.event.trigger(c,d,g[j].handle.elem,!0)}},dispatch:function(c){c=v.event.fix(c||b.event);var d,g,e,l,j,m,n=(v._data(this,"events")||{})[c.type]||[],p=n.delegateCount,q=fa.call(arguments),r=!c.exclusive&&!c.namespace,s=v.event.special[c.type]||{},t=[];q[0]=c;c.delegateTarget=this;if(!(s.preDispatch&&!1===s.preDispatch.call(this,c))){if(p&&
(!c.button||"click"!==c.type))for(g=c.target;g!=this;g=g.parentNode||this)if(!0!==g.disabled||"click"!==c.type){l={};j=[];for(d=0;d<p;d++)e=n[d],m=e.selector,l[m]===f&&(l[m]=e.needsContext?0<=v(m,this).index(g):v.find(m,this,null,[g]).length),l[m]&&j.push(e);j.length&&t.push({elem:g,matches:j})}n.length>p&&t.push({elem:this,matches:n.slice(p)});for(d=0;d<t.length&&!c.isPropagationStopped();d++){l=t[d];c.currentTarget=l.elem;for(g=0;g<l.matches.length&&!c.isImmediatePropagationStopped();g++)if(e=l.matches[g],
r||!c.namespace&&!e.namespace||c.namespace_re&&c.namespace_re.test(e.namespace))c.data=e.data,c.handleObj=e,e=((v.event.special[e.origType]||{}).handle||e.handler).apply(l.elem,q),e!==f&&(c.result=e,!1===e&&(c.preventDefault(),c.stopPropagation()))}return s.postDispatch&&s.postDispatch.call(this,c),c.result}},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},
keyHooks:{props:["char","charCode","key","keyCode"],filter:function(b,c){return null==b.which&&(b.which=null!=c.charCode?c.charCode:c.keyCode),b}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(b,c){var d,g,e,l=c.button,j=c.fromElement;return null==b.pageX&&null!=c.clientX&&(d=b.target.ownerDocument||K,g=d.documentElement,e=d.body,b.pageX=c.clientX+(g&&g.scrollLeft||e&&e.scrollLeft||0)-(g&&g.clientLeft||
e&&e.clientLeft||0),b.pageY=c.clientY+(g&&g.scrollTop||e&&e.scrollTop||0)-(g&&g.clientTop||e&&e.clientTop||0)),!b.relatedTarget&&j&&(b.relatedTarget=j===b.target?c.toElement:j),!b.which&&l!==f&&(b.which=l&1?1:l&2?3:l&4?2:0),b}},fix:function(b){if(b[v.expando])return b;var c,d,g=b,e=v.event.fixHooks[b.type]||{},l=e.props?this.props.concat(e.props):this.props;b=v.Event(g);for(c=l.length;c;)d=l[--c],b[d]=g[d];return b.target||(b.target=g.srcElement||K),3===b.target.nodeType&&(b.target=b.target.parentNode),
b.metaKey=!!b.metaKey,e.filter?e.filter(b,g):b},special:{load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(b,c,d){v.isWindow(this)&&(this.onbeforeunload=d)},teardown:function(b,c){this.onbeforeunload===c&&(this.onbeforeunload=null)}}},simulate:function(b,c,d,g){b=v.extend(new v.Event,d,{type:b,isSimulated:!0,originalEvent:{}});g?v.event.trigger(b,null,c):v.event.dispatch.call(c,b);b.isDefaultPrevented()&&d.preventDefault()}};v.event.handle=
v.event.dispatch;v.removeEvent=K.removeEventListener?function(b,c,d){b.removeEventListener&&b.removeEventListener(c,d,!1)}:function(b,c,d){c="on"+c;b.detachEvent&&("undefined"==typeof b[c]&&(b[c]=null),b.detachEvent(c,d))};v.Event=function(b,c){if(this instanceof v.Event)b&&b.type?(this.originalEvent=b,this.type=b.type,this.isDefaultPrevented=b.defaultPrevented||!1===b.returnValue||b.getPreventDefault&&b.getPreventDefault()?g:d):this.type=b,c&&v.extend(this,c),this.timeStamp=b&&b.timeStamp||v.now(),
this[v.expando]=!0;else return new v.Event(b,c)};v.Event.prototype={preventDefault:function(){this.isDefaultPrevented=g;var b=this.originalEvent;b&&(b.preventDefault?b.preventDefault():b.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=g;var b=this.originalEvent;b&&(b.stopPropagation&&b.stopPropagation(),b.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=g;this.stopPropagation()},isDefaultPrevented:d,isPropagationStopped:d,isImmediatePropagationStopped:d};
v.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(b,c){v.event.special[b]={delegateType:c,bindType:c,handle:function(b){var d,g=b.relatedTarget,e=b.handleObj;if(!g||g!==this&&!v.contains(this,g))b.type=e.origType,d=e.handler.apply(this,arguments),b.type=c;return d}}});v.support.submitBubbles||(v.event.special.submit={setup:function(){if(v.nodeName(this,"form"))return!1;v.event.add(this,"click._submit keypress._submit",function(b){b=b.target;(b=v.nodeName(b,"input")||v.nodeName(b,"button")?
b.form:f)&&!v._data(b,"_submit_attached")&&(v.event.add(b,"submit._submit",function(b){b._submit_bubble=!0}),v._data(b,"_submit_attached",!0))})},postDispatch:function(b){b._submit_bubble&&(delete b._submit_bubble,this.parentNode&&!b.isTrigger&&v.event.simulate("submit",this.parentNode,b,!0))},teardown:function(){if(v.nodeName(this,"form"))return!1;v.event.remove(this,"._submit")}});v.support.changeBubbles||(v.event.special.change={setup:function(){if(Mb.test(this.nodeName)){if("checkbox"===this.type||
"radio"===this.type)v.event.add(this,"propertychange._change",function(b){"checked"===b.originalEvent.propertyName&&(this._just_changed=!0)}),v.event.add(this,"click._change",function(b){this._just_changed&&!b.isTrigger&&(this._just_changed=!1);v.event.simulate("change",this,b,!0)});return!1}v.event.add(this,"beforeactivate._change",function(b){b=b.target;Mb.test(b.nodeName)&&!v._data(b,"_change_attached")&&(v.event.add(b,"change._change",function(b){this.parentNode&&!b.isSimulated&&!b.isTrigger&&
v.event.simulate("change",this.parentNode,b,!0)}),v._data(b,"_change_attached",!0))})},handle:function(b){var c=b.target;if(this!==c||b.isSimulated||b.isTrigger||"radio"!==c.type&&"checkbox"!==c.type)return b.handleObj.handler.apply(this,arguments)},teardown:function(){return v.event.remove(this,"._change"),!Mb.test(this.nodeName)}});v.support.focusinBubbles||v.each({focus:"focusin",blur:"focusout"},function(b,c){var d=0,g=function(b){v.event.simulate(c,b.target,v.event.fix(b),!0)};v.event.special[c]=
{setup:function(){0===d++&&K.addEventListener(b,g,!0)},teardown:function(){0===--d&&K.removeEventListener(b,g,!0)}}});v.fn.extend({on:function(b,c,g,e,l){var j,m;if("object"==typeof b){"string"!=typeof c&&(g=g||c,c=f);for(m in b)this.on(m,c,g,b[m],l);return this}null==g&&null==e?(e=c,g=c=f):null==e&&("string"==typeof c?(e=g,g=f):(e=g,g=c,c=f));if(!1===e)e=d;else if(!e)return this;return 1===l&&(j=e,e=function(b){return v().off(b),j.apply(this,arguments)},e.guid=j.guid||(j.guid=v.guid++)),this.each(function(){v.event.add(this,
b,e,g,c)})},one:function(b,c,d,g){return this.on(b,c,d,g,1)},off:function(b,c,g){var e,l;if(b&&b.preventDefault&&b.handleObj)return e=b.handleObj,v(b.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler),this;if("object"==typeof b){for(l in b)this.off(l,c,b[l]);return this}if(!1===c||"function"==typeof c)g=c,c=f;return!1===g&&(g=d),this.each(function(){v.event.remove(this,b,g,c)})},bind:function(b,c,d){return this.on(b,null,c,d)},unbind:function(b,c){return this.off(b,
null,c)},live:function(b,c,d){return v(this.context).on(b,this.selector,c,d),this},die:function(b,c){return v(this.context).off(b,this.selector||"**",c),this},delegate:function(b,c,d,g){return this.on(c,b,d,g)},undelegate:function(b,c,d){return 1===arguments.length?this.off(b,"**"):this.off(c,b||"**",d)},trigger:function(b,c){return this.each(function(){v.event.trigger(b,c,this)})},triggerHandler:function(b,c){if(this[0])return v.event.trigger(b,c,this[0],!0)},toggle:function(b){var c=arguments,d=
b.guid||v.guid++,g=0,e=function(d){var e=(v._data(this,"lastToggle"+b.guid)||0)%g;return v._data(this,"lastToggle"+b.guid,e+1),d.preventDefault(),c[e].apply(this,arguments)||!1};for(e.guid=d;g<c.length;)c[g++].guid=d;return this.click(e)},hover:function(b,c){return this.mouseenter(b).mouseleave(c||b)}});v.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),
function(b,c){v.fn[c]=function(b,d){return null==d&&(d=b,b=null),0<arguments.length?this.on(c,null,b,d):this.trigger(c)};bb.test(c)&&(v.event.fixHooks[c]=v.event.keyHooks);cb.test(c)&&(v.event.fixHooks[c]=v.event.mouseHooks)});var Ab=b,ta=function(b,c,d,g){d=d||[];c=c||xc;var e,l,j,f,m=c.nodeType;if(!b||"string"!=typeof b)return d;if(1!==m&&9!==m)return[];j=ac(c);if(!j&&!g&&(e=Gb.exec(b)))if(f=e[1])if(9===m){l=c.getElementById(f);if(!l||!l.parentNode)return d;if(l.id===f)return d.push(l),d}else{if(c.ownerDocument&&
(l=c.ownerDocument.getElementById(f))&&ic(c,l)&&l.id===f)return d.push(l),d}else{if(e[2])return Mc.apply(d,T.call(c.getElementsByTagName(b),0)),d;if((f=e[3])&&Cc&&c.getElementsByClassName)return Mc.apply(d,T.call(c.getElementsByClassName(f),0)),d}return tb(b.replace(Hb,"$1"),c,d,g,j)},Aa=function(b){return function(c){return"input"===c.nodeName.toLowerCase()&&c.type===b}},Ka=function(b){return function(c){var d=c.nodeName.toLowerCase();return("input"===d||"button"===d)&&c.type===b}},gb=function(b){return Oa(function(c){return c=
+c,Oa(function(d,g){for(var e,l=b([],d.length,c),j=l.length;j--;)d[e=l[j]]&&(d[e]=!(g[e]=d[e]))})})},Da=function(b,c,d){if(b===c)return d;for(b=b.nextSibling;b;){if(b===c)return-1;b=b.nextSibling}return 1},Rb=function(b,c){var d,g,e,l,j,f,m;if(j=db[hb][b])return c?0:j.slice(0);j=b;f=[];for(m=Qa.preFilter;j;){if(!d||(g=ia.exec(j)))g&&(j=j.slice(g[0].length)),f.push(e=[]);d=!1;if(g=ja.exec(j))e.push(d=new Y(g.shift())),j=j.slice(d.length),d.type=g[0].replace(Hb," ");for(l in Qa.filter)(g=ub[l].exec(j))&&
(!m[l]||(g=m[l](g,xc,!0)))&&(e.push(d=new Y(g.shift())),j=j.slice(d.length),d.type=l,d.matches=g);if(!d)break}return c?j.length:j?ta.error(b):db(b,f).slice(0)},Xb=function(b,c,d){var g=c.dir,e=d&&"parentNode"===c.dir,l=$c++;return c.first?function(c,d,l){for(;c=c[g];)if(e||1===c.nodeType)return b(c,d,l)}:function(c,d,j){if(j)for(;c=c[g];){if((e||1===c.nodeType)&&b(c,d,j))return c}else for(var f,m=Oc+" "+l+" ",n=m+nc;c=c[g];)if(e||1===c.nodeType){if((f=c[hb])===n)return c.sizset;if("string"==typeof f&&
0===f.indexOf(m)){if(c.sizset)return c}else{c[hb]=n;if(b(c,d,j))return c.sizset=!0,c;c.sizset=!1}}}},Yb=function(b){return 1<b.length?function(c,d,g){for(var e=b.length;e--;)if(!b[e](c,d,g))return!1;return!0}:b[0]},Nb=function(b,c,d,g,e){for(var l,j=[],f=0,m=b.length,n=null!=c;f<m;f++)if(l=b[f])if(!d||d(l,g,e))j.push(l),n&&c.push(f);return j},Sb=function(b,c,d,g,e,l){return g&&!g[hb]&&(g=Sb(g)),e&&!e[hb]&&(e=Sb(e,l)),Oa(function(l,j,f,m){if(!l||!e){var n,p,q=[],r=[],s=j.length;if(!(p=l)){p=c||"*";
var t=f.nodeType?[f]:f,K=[];n=0;for(var x=t.length;n<x;n++)ta(p,t[n],K,l);p=K}t=b&&(l||!c)?Nb(p,q,b,f,m):p;K=d?e||(l?b:s||g)?[]:j:t;d&&d(t,K,f,m);if(g){p=Nb(K,r);g(p,[],f,m);for(f=p.length;f--;)if(n=p[f])K[r[f]]=!(t[r[f]]=n)}if(l)for(f=b&&K.length;f--;){if(n=K[f])l[q[f]]=!(j[q[f]]=n)}else K=Nb(K===j?K.splice(s,K.length):K),e?e(null,j,K,m):Mc.apply(j,K)}})},Tb=function(b){var c,d,g,e=b.length,l=Qa.relative[b[0].type];d=l||Qa.relative[" "];for(var j=l?1:0,f=Xb(function(b){return b===c},d,!0),m=Xb(function(b){return-1<
eb.call(c,b)},d,!0),n=[function(b,d,g){return!l&&(g||d!==ec)||((c=d).nodeType?f(b,d,g):m(b,d,g))}];j<e;j++)if(d=Qa.relative[b[j].type])n=[Xb(Yb(n),d)];else{d=Qa.filter[b[j].type].apply(null,b[j].matches);if(d[hb]){for(g=++j;g<e&&!Qa.relative[b[g].type];g++);return Sb(1<j&&Yb(n),1<j&&b.slice(0,j-1).join("").replace(Hb,"$1"),d,j<g&&Tb(b.slice(j,g)),g<e&&Tb(b=b.slice(g)),g<e&&b.join(""))}n.push(d)}return Yb(n)},tb=function(b,c,d,g,e){var l,j,f,m,n=Rb(b);if(!g&&1===n.length){j=n[0]=n[0].slice(0);if(2<
j.length&&"ID"===(f=j[0]).type&&9===c.nodeType&&!e&&Qa.relative[j[1].type]){c=Qa.find.ID(f.matches[0].replace(ib,""),c,e)[0];if(!c)return d;b=b.slice(j.shift().length)}for(l=ub.POS.test(b)?-1:j.length-1;0<=l;l--){f=j[l];if(Qa.relative[m=f.type])break;if(m=Qa.find[m])if(g=m(f.matches[0].replace(ib,""),vb.test(j[0].type)&&c.parentNode||c,e)){j.splice(l,1);b=g.length&&j.join("");if(!b)return Mc.apply(d,T.call(g,0)),d;break}}}return fc(b,n)(g,c,e,d,vb.test(b)),d},Bb=function(){},nc,gc,Qa,bc,ac,ic,fc,
hc,Zb,ec,yc=!0,hb=("sizcache"+Math.random()).replace(".",""),Y=String,xc=Ab.document,vc=xc.documentElement,Oc=0,$c=0,ad=[].pop,Mc=[].push,T=[].slice,eb=[].indexOf||function(b){for(var c=0,d=this.length;c<d;c++)if(this[c]===b)return c;return-1},Oa=function(b,c){return b[hb]=null==c||c,b},Q=function(){var b={},c=[];return Oa(function(d,g){return c.push(d)>Qa.cacheLength&&delete b[c.shift()],b[d]=g},b)},S=Q(),db=Q(),$b=Q(),lb="\\[[\\x20\\t\\r\\n\\f]*((?:\\\\.|[-\\w]|[^\\x00-\\xa0])+)[\\x20\\t\\r\\n\\f]*(?:([*^$|!~]?=)[\\x20\\t\\r\\n\\f]*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+
"(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+".replace("w","w#")+")|)|)[\\x20\\t\\r\\n\\f]*\\]",Ya=":((?:\\\\.|[-\\w]|[^\\x00-\\xa0])+)(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+lb+")|[^:]|\\\\.)*|.*))\\)|)",Hb=/^[\x20\t\r\n\f]+|((?:^|[^\\])(?:\\.)*)[\x20\t\r\n\f]+$/g,ia=/^[\x20\t\r\n\f]*,[\x20\t\r\n\f]*/,ja=/^[\x20\t\r\n\f]*([\x20\t\r\n\f>+~])[\x20\t\r\n\f]*/,ka=RegExp(Ya),Gb=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,vb=/[\x20\t\r\n\f]*[+~]/,Ib=/h\d/i,Jb=/input|select|textarea|button/i,ib=/\\(?!\\)/g,
ub={ID:/^#((?:\\.|[-\w]|[^\x00-\xa0])+)/,CLASS:/^\.((?:\\.|[-\w]|[^\x00-\xa0])+)/,NAME:/^\[name=['"]?((?:\\.|[-\w]|[^\x00-\xa0])+)['"]?\]/,TAG:RegExp("^("+"(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+".replace("w","w*")+")"),ATTR:RegExp("^"+lb),PSEUDO:RegExp("^"+Ya),POS:/:(even|odd|eq|gt|lt|nth|first|last)(?:\([\x20\t\r\n\f]*((?:-\d)?\d*)[\x20\t\r\n\f]*\)|)(?=[^-]|$)/i,CHILD:RegExp("^:(only|nth|first|last)-child(?:\\([\\x20\\t\\r\\n\\f]*(even|odd|(([+-]|)(\\d*)n|)[\\x20\\t\\r\\n\\f]*(?:([+-]|)[\\x20\\t\\r\\n\\f]*(\\d+)|))[\\x20\\t\\r\\n\\f]*\\)|)",
"i"),needsContext:RegExp("^[\\x20\\t\\r\\n\\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\([\\x20\\t\\r\\n\\f]*((?:-\\d)?\\d*)[\\x20\\t\\r\\n\\f]*\\)|)(?=[^-]|$)","i")},Za=function(b){var c=xc.createElement("div");try{return b(c)}catch(d){return!1}finally{}},Cb=Za(function(b){return b.appendChild(xc.createComment("")),!b.getElementsByTagName("*").length}),Db=Za(function(b){return b.innerHTML="<a href='#'></a>",b.firstChild&&"undefined"!==typeof b.firstChild.getAttribute&&"#"===b.firstChild.getAttribute("href")}),
Fc=Za(function(b){b.innerHTML="<select></select>";b=typeof b.lastChild.getAttribute("multiple");return"boolean"!==b&&"string"!==b}),Cc=Za(function(b){return b.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!b.getElementsByClassName||!b.getElementsByClassName("e").length?!1:(b.lastChild.className="e",2===b.getElementsByClassName("e").length)}),Gc=Za(function(b){b.id=hb+0;b.innerHTML="<a name='"+hb+"'></a><div name='"+hb+"'></div>";vc.insertBefore(b,vc.firstChild);var c=xc.getElementsByName&&
xc.getElementsByName(hb).length===2+xc.getElementsByName(hb+0).length;return gc=!xc.getElementById(hb),vc.removeChild(b),c});try{T.call(vc.childNodes,0)[0].nodeType}catch(Kc){T=function(b){for(var c,d=[];c=this[b];b++)d.push(c);return d}}ta.matches=function(b,c){return ta(b,null,null,c)};ta.matchesSelector=function(b,c){return 0<ta(c,null,null,[b]).length};bc=ta.getText=function(b){var c,d="",g=0;if(c=b.nodeType)if(1===c||9===c||11===c){if("string"==typeof b.textContent)return b.textContent;for(b=
b.firstChild;b;b=b.nextSibling)d+=bc(b)}else{if(3===c||4===c)return b.nodeValue}else for(;c=b[g];g++)d+=bc(c);return d};ac=ta.isXML=function(b){return(b=b&&(b.ownerDocument||b).documentElement)?"HTML"!==b.nodeName:!1};ic=ta.contains=vc.contains?function(b,c){var d=9===b.nodeType?b.documentElement:b,g=c&&c.parentNode;return b===g||!(!g||!(1===g.nodeType&&d.contains&&d.contains(g)))}:vc.compareDocumentPosition?function(b,c){return c&&!!(b.compareDocumentPosition(c)&16)}:function(b,c){for(;c=c.parentNode;)if(c===
b)return!0;return!1};ta.attr=function(b,c){var d,g=ac(b);return g||(c=c.toLowerCase()),(d=Qa.attrHandle[c])?d(b):g||Fc?b.getAttribute(c):(d=b.getAttributeNode(c),d?"boolean"==typeof b[c]?b[c]?c:null:d.specified?d.value:null:null)};Qa=ta.selectors={cacheLength:50,createPseudo:Oa,match:ub,attrHandle:Db?{}:{href:function(b){return b.getAttribute("href",2)},type:function(b){return b.getAttribute("type")}},find:{ID:gc?function(b,c,d){if("undefined"!==typeof c.getElementById&&!d)return(b=c.getElementById(b))&&
b.parentNode?[b]:[]}:function(b,c,d){if("undefined"!==typeof c.getElementById&&!d)return(c=c.getElementById(b))?c.id===b||"undefined"!==typeof c.getAttributeNode&&c.getAttributeNode("id").value===b?[c]:void 0:[]},TAG:Cb?function(b,c){if("undefined"!==typeof c.getElementsByTagName)return c.getElementsByTagName(b)}:function(b,c){var d=c.getElementsByTagName(b);if("*"===b){for(var g,e=[],l=0;g=d[l];l++)1===g.nodeType&&e.push(g);return e}return d},NAME:Gc&&function(b,c){if("undefined"!==typeof c.getElementsByName)return c.getElementsByName(name)},
CLASS:Cc&&function(b,c,d){if("undefined"!==typeof c.getElementsByClassName&&!d)return c.getElementsByClassName(b)}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(b){return b[1]=b[1].replace(ib,""),b[3]=(b[4]||b[5]||"").replace(ib,""),"~="===b[2]&&(b[3]=" "+b[3]+" "),b.slice(0,4)},CHILD:function(b){return b[1]=b[1].toLowerCase(),"nth"===b[1]?(b[2]||ta.error(b[0]),b[3]=+(b[3]?b[4]+(b[5]||1):
2*("even"===b[2]||"odd"===b[2])),b[4]=+(b[6]+b[7]||"odd"===b[2])):b[2]&&ta.error(b[0]),b},PSEUDO:function(b){var c,d;if(ub.CHILD.test(b[0]))return null;if(b[3])b[2]=b[3];else if(c=b[4])ka.test(c)&&(d=Rb(c,!0))&&(d=c.indexOf(")",c.length-d)-c.length)&&(c=c.slice(0,d),b[0]=b[0].slice(0,d)),b[2]=c;return b.slice(0,3)}},filter:{ID:gc?function(b){return b=b.replace(ib,""),function(c){return c.getAttribute("id")===b}}:function(b){return b=b.replace(ib,""),function(c){return(c="undefined"!==typeof c.getAttributeNode&&
c.getAttributeNode("id"))&&c.value===b}},TAG:function(b){return"*"===b?function(){return!0}:(b=b.replace(ib,"").toLowerCase(),function(c){return c.nodeName&&c.nodeName.toLowerCase()===b})},CLASS:function(b){var c=S[hb][b];return c||(c=S(b,RegExp("(^|[\\x20\\t\\r\\n\\f])"+b+"([\\x20\\t\\r\\n\\f]|$)"))),function(b){return c.test(b.className||"undefined"!==typeof b.getAttribute&&b.getAttribute("class")||"")}},ATTR:function(b,c,d){return function(g){g=ta.attr(g,b);return null==g?"!="===c:c?(g+="","="===
c?g===d:"!="===c?g!==d:"^="===c?d&&0===g.indexOf(d):"*="===c?d&&-1<g.indexOf(d):"$="===c?d&&g.substr(g.length-d.length)===d:"~="===c?-1<(" "+g+" ").indexOf(d):"|="===c?g===d||g.substr(0,d.length+1)===d+"-":!1):!0}},CHILD:function(b,c,d,g){return"nth"===b?function(b){var c,e;c=b.parentNode;if(1===d&&0===g)return!0;if(c){e=0;for(c=c.firstChild;c&&!(1===c.nodeType&&(e++,b===c));c=c.nextSibling);}return e-=g,e===d||0===e%d&&0<=e/d}:function(c){var d=c;switch(b){case "only":case "first":for(;d=d.previousSibling;)if(1===
d.nodeType)return!1;if("first"===b)return!0;d=c;case "last":for(;d=d.nextSibling;)if(1===d.nodeType)return!1;return!0}}},PSEUDO:function(b,c){var d,g=Qa.pseudos[b]||Qa.setFilters[b.toLowerCase()]||ta.error("unsupported pseudo: "+b);return g[hb]?g(c):1<g.length?(d=[b,b,"",c],Qa.setFilters.hasOwnProperty(b.toLowerCase())?Oa(function(b,d){for(var e,l=g(b,c),j=l.length;j--;)e=eb.call(b,l[j]),b[e]=!(d[e]=l[j])}):function(b){return g(b,0,d)}):g}},pseudos:{not:Oa(function(b){var c=[],d=[],g=fc(b.replace(Hb,
"$1"));return g[hb]?Oa(function(b,c,d,e){e=g(b,null,e,[]);for(var l=b.length;l--;)if(d=e[l])b[l]=!(c[l]=d)}):function(b,e,l){return c[0]=b,g(c,null,l,d),!d.pop()}}),has:Oa(function(b){return function(c){return 0<ta(b,c).length}}),contains:Oa(function(b){return function(c){return-1<(c.textContent||c.innerText||bc(c)).indexOf(b)}}),enabled:function(b){return!1===b.disabled},disabled:function(b){return!0===b.disabled},checked:function(b){var c=b.nodeName.toLowerCase();return"input"===c&&!!b.checked||
"option"===c&&!!b.selected},selected:function(b){return b.parentNode&&b.parentNode.selectedIndex,!0===b.selected},parent:function(b){return!Qa.pseudos.empty(b)},empty:function(b){var c;for(b=b.firstChild;b;){if("@"<b.nodeName||3===(c=b.nodeType)||4===c)return!1;b=b.nextSibling}return!0},header:function(b){return Ib.test(b.nodeName)},text:function(b){var c,d;return"input"===b.nodeName.toLowerCase()&&"text"===(c=b.type)&&(null==(d=b.getAttribute("type"))||d.toLowerCase()===c)},radio:Aa("radio"),checkbox:Aa("checkbox"),
file:Aa("file"),password:Aa("password"),image:Aa("image"),submit:Ka("submit"),reset:Ka("reset"),button:function(b){var c=b.nodeName.toLowerCase();return"input"===c&&"button"===b.type||"button"===c},input:function(b){return Jb.test(b.nodeName)},focus:function(b){var c=b.ownerDocument;return b===c.activeElement&&(!c.hasFocus||c.hasFocus())&&(!!b.type||!!b.href)},active:function(b){return b===b.ownerDocument.activeElement},first:gb(function(){return[0]}),last:gb(function(b,c){return[c-1]}),eq:gb(function(b,
c,d){return[0>d?d+c:d]}),even:gb(function(b,c){for(var d=0;d<c;d+=2)b.push(d);return b}),odd:gb(function(b,c){for(var d=1;d<c;d+=2)b.push(d);return b}),lt:gb(function(b,c,d){for(c=0>d?d+c:d;0<=--c;)b.push(c);return b}),gt:gb(function(b,c,d){for(d=0>d?d+c:d;++d<c;)b.push(d);return b})}};hc=vc.compareDocumentPosition?function(b,c){return b===c?(Zb=!0,0):(!b.compareDocumentPosition||!c.compareDocumentPosition?b.compareDocumentPosition:b.compareDocumentPosition(c)&4)?-1:1}:function(b,c){if(b===c)return Zb=
!0,0;if(b.sourceIndex&&c.sourceIndex)return b.sourceIndex-c.sourceIndex;var d,g,e=[],l=[];d=b.parentNode;g=c.parentNode;var j=d;if(d===g)return Da(b,c);if(!d)return-1;if(!g)return 1;for(;j;)e.unshift(j),j=j.parentNode;for(j=g;j;)l.unshift(j),j=j.parentNode;d=e.length;g=l.length;for(j=0;j<d&&j<g;j++)if(e[j]!==l[j])return Da(e[j],l[j]);return j===d?Da(b,l[j],-1):Da(e[j],c,1)};[0,0].sort(hc);yc=!Zb;ta.uniqueSort=function(b){var c,d=1;Zb=yc;b.sort(hc);if(Zb)for(;c=b[d];d++)c===b[d-1]&&b.splice(d--,1);
return b};ta.error=function(b){throw Error("Syntax error, unrecognized expression: "+b);};fc=ta.compile=function(b,c){var d,g=[],e=[],l=$b[hb][b];if(!l){c||(c=Rb(b));for(d=c.length;d--;)l=Tb(c[d]),l[hb]?g.push(l):e.push(l);var j=0<g.length,f=0<e.length,m=function(b,c,d,l,n){var p,q,r=[],s=0,t="0",K=b&&[],x=null!=n,u=ec,y=b||f&&Qa.find.TAG("*",n&&c.parentNode||c),O=Oc+=null==u?1:Math.E;for(x&&(ec=c!==xc&&c,nc=m.el);null!=(n=y[t]);t++){if(f&&n){for(p=0;q=e[p];p++)if(q(n,c,d)){l.push(n);break}x&&(Oc=
O,nc=++m.el)}j&&((n=!q&&n)&&s--,b&&K.push(n))}s+=t;if(j&&t!==s){for(p=0;q=g[p];p++)q(K,r,c,d);if(b){if(0<s)for(;t--;)!K[t]&&!r[t]&&(r[t]=ad.call(l));r=Nb(r)}Mc.apply(l,r);x&&!b&&0<r.length&&1<s+g.length&&ta.uniqueSort(l)}return x&&(Oc=O,ec=u),K};d=(m.el=0,j?Oa(m):m);l=$b(b,d)}return l};if(xc.querySelectorAll){var Dc,Hc=tb,Qc=/'|\\/g,Na=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,Pa=[":focus"],Ea=[":active",":focus"],Fa=vc.matchesSelector||vc.mozMatchesSelector||vc.webkitMatchesSelector||vc.oMatchesSelector||
vc.msMatchesSelector;Za(function(b){b.innerHTML="<select><option selected=''></option></select>";b.querySelectorAll("[selected]").length||Pa.push("\\[[\\x20\\t\\r\\n\\f]*(?:checked|disabled|ismap|multiple|readonly|selected|value)");b.querySelectorAll(":checked").length||Pa.push(":checked")});Za(function(b){b.innerHTML="<p test=''></p>";b.querySelectorAll("[test^='']").length&&Pa.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:\"\"|'')");b.innerHTML="<input type='hidden'/>";b.querySelectorAll(":enabled").length||
Pa.push(":enabled",":disabled")});Pa=RegExp(Pa.join("|"));tb=function(b,c,d,g,e){if(!g&&!e&&(!Pa||!Pa.test(b))){var l,j,f=!0,m=hb;j=c;l=9===c.nodeType&&b;if(1===c.nodeType&&"object"!==c.nodeName.toLowerCase()){l=Rb(b);(f=c.getAttribute("id"))?m=f.replace(Qc,"\\$&"):c.setAttribute("id",m);m="[id='"+m+"'] ";for(j=l.length;j--;)l[j]=m+l[j].join("");j=vb.test(b)&&c.parentNode||c;l=l.join(",")}if(l)try{return Mc.apply(d,T.call(j.querySelectorAll(l),0)),d}catch(n){}finally{f||c.removeAttribute("id")}}return Hc(b,
c,d,g,e)};Fa&&(Za(function(b){Dc=Fa.call(b,"div");try{Fa.call(b,"[test!='']:sizzle"),Ea.push("!=",Ya)}catch(c){}}),Ea=RegExp(Ea.join("|")),ta.matchesSelector=function(b,c){c=c.replace(Na,"='$1']");if(!ac(b)&&!Ea.test(c)&&(!Pa||!Pa.test(c)))try{var d=Fa.call(b,c);if(d||Dc||b.document&&11!==b.document.nodeType)return d}catch(g){}return 0<ta(c,null,null,[b]).length})}Qa.pseudos.nth=Qa.pseudos.eq;Qa.filters=Bb.prototype=Qa.pseudos;Qa.setFilters=new Bb;ta.attr=v.attr;v.find=ta;v.expr=ta.selectors;v.expr[":"]=
v.expr.pseudos;v.unique=ta.uniqueSort;v.text=ta.getText;v.isXMLDoc=ta.isXML;v.contains=ta.contains;var La=/Until$/,Ec=/^(?:parents|prev(?:Until|All))/,Ac=/^.[^:#\[\.,]*$/,zc=v.expr.match.needsContext,Ic={children:!0,contents:!0,next:!0,prev:!0};v.fn.extend({find:function(b){var c,d,g,e,l,j,f=this;if("string"!=typeof b)return v(b).filter(function(){c=0;for(d=f.length;c<d;c++)if(v.contains(f[c],this))return!0});j=this.pushStack("","find",b);c=0;for(d=this.length;c<d;c++)if(g=j.length,v.find(b,this[c],
j),0<c)for(e=g;e<j.length;e++)for(l=0;l<g;l++)if(j[l]===j[e]){j.splice(e--,1);break}return j},has:function(b){var c,d=v(b,this),g=d.length;return this.filter(function(){for(c=0;c<g;c++)if(v.contains(this,d[c]))return!0})},not:function(b){return this.pushStack(l(this,b,!1),"not",b)},filter:function(b){return this.pushStack(l(this,b,!0),"filter",b)},is:function(b){return!!b&&("string"==typeof b?zc.test(b)?0<=v(b,this.context).index(this[0]):0<v.filter(b,this).length:0<this.filter(b).length)},closest:function(b,
c){for(var d,g=0,e=this.length,l=[],j=zc.test(b)||"string"!=typeof b?v(b,c||this.context):0;g<e;g++)for(d=this[g];d&&d.ownerDocument&&d!==c&&11!==d.nodeType;){if(j?-1<j.index(d):v.find.matchesSelector(d,b)){l.push(d);break}d=d.parentNode}return l=1<l.length?v.unique(l):l,this.pushStack(l,"closest",b)},index:function(b){return b?"string"==typeof b?v.inArray(this[0],v(b)):v.inArray(b.jquery?b[0]:b,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(b,c){var d="string"==typeof b?
v(b,c):v.makeArray(b&&b.nodeType?[b]:b),g=v.merge(this.get(),d);return this.pushStack(m(d[0])||m(g[0])?g:v.unique(g))},addBack:function(b){return this.add(null==b?this.prevObject:this.prevObject.filter(b))}});v.fn.andSelf=v.fn.addBack;v.each({parent:function(b){return(b=b.parentNode)&&11!==b.nodeType?b:null},parents:function(b){return v.dir(b,"parentNode")},parentsUntil:function(b,c,d){return v.dir(b,"parentNode",d)},next:function(b){return j(b,"nextSibling")},prev:function(b){return j(b,"previousSibling")},
nextAll:function(b){return v.dir(b,"nextSibling")},prevAll:function(b){return v.dir(b,"previousSibling")},nextUntil:function(b,c,d){return v.dir(b,"nextSibling",d)},prevUntil:function(b,c,d){return v.dir(b,"previousSibling",d)},siblings:function(b){return v.sibling((b.parentNode||{}).firstChild,b)},children:function(b){return v.sibling(b.firstChild)},contents:function(b){return v.nodeName(b,"iframe")?b.contentDocument||b.contentWindow.document:v.merge([],b.childNodes)}},function(b,c){v.fn[b]=function(d,
g){var e=v.map(this,c,d);return La.test(b)||(g=d),g&&"string"==typeof g&&(e=v.filter(g,e)),e=1<this.length&&!Ic[b]?v.unique(e):e,1<this.length&&Ec.test(b)&&(e=e.reverse()),this.pushStack(e,b,fa.call(arguments).join(","))}});v.extend({filter:function(b,c,d){return d&&(b=":not("+b+")"),1===c.length?v.find.matchesSelector(c[0],b)?[c[0]]:[]:v.find.matches(b,c)},dir:function(b,c,d){var g=[];for(b=b[c];b&&9!==b.nodeType&&(d===f||1!==b.nodeType||!v(b).is(d));)1===b.nodeType&&g.push(b),b=b[c];return g},sibling:function(b,
c){for(var d=[];b;b=b.nextSibling)1===b.nodeType&&b!==c&&d.push(b);return d}});var Bc="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Jc=/ jQuery\d+="(?:null|\d+)"/g,Sa=/^\s+/,jc=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,kc=/<([\w:]+)/,oc=/<tbody/i,pc=/<|&#?\w+;/,qc=/<(?:script|style|link)/i,rc=/<(?:script|object|embed|option|style)/i,lc=RegExp("<(?:"+Bc+")[\\s/>]",
"i"),mc=/^(?:checkbox|radio)$/,sc=/checked\s*(?:[^=]|=\s*.checked.)/i,tc=/\/(java|ecma)script/i,uc=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,wb={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},fb=n(K),la=fb.appendChild(K.createElement("div"));
wb.optgroup=wb.option;wb.tbody=wb.tfoot=wb.colgroup=wb.caption=wb.thead;wb.th=wb.td;v.support.htmlSerialize||(wb._default=[1,"X<div>","</div>"]);v.fn.extend({text:function(b){return v.access(this,function(b){return b===f?v.text(this):this.empty().append((this[0]&&this[0].ownerDocument||K).createTextNode(b))},null,b,arguments.length)},wrapAll:function(b){if(v.isFunction(b))return this.each(function(c){v(this).wrapAll(b.call(this,c))});if(this[0]){var c=v(b,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&
c.insertBefore(this[0]);c.map(function(){for(var b=this;b.firstChild&&1===b.firstChild.nodeType;)b=b.firstChild;return b}).append(this)}return this},wrapInner:function(b){return v.isFunction(b)?this.each(function(c){v(this).wrapInner(b.call(this,c))}):this.each(function(){var c=v(this),d=c.contents();d.length?d.wrapAll(b):c.append(b)})},wrap:function(b){var c=v.isFunction(b);return this.each(function(d){v(this).wrapAll(c?b.call(this,d):b)})},unwrap:function(){return this.parent().each(function(){v.nodeName(this,
"body")||v(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(b){(1===this.nodeType||11===this.nodeType)&&this.appendChild(b)})},prepend:function(){return this.domManip(arguments,!0,function(b){(1===this.nodeType||11===this.nodeType)&&this.insertBefore(b,this.firstChild)})},before:function(){if(!m(this[0]))return this.domManip(arguments,!1,function(b){this.parentNode.insertBefore(b,this)});if(arguments.length){var b=v.clean(arguments);return this.pushStack(v.merge(b,
this),"before",this.selector)}},after:function(){if(!m(this[0]))return this.domManip(arguments,!1,function(b){this.parentNode.insertBefore(b,this.nextSibling)});if(arguments.length){var b=v.clean(arguments);return this.pushStack(v.merge(this,b),"after",this.selector)}},remove:function(b,c){for(var d,g=0;null!=(d=this[g]);g++)if(!b||v.filter(b,[d]).length)!c&&1===d.nodeType&&(v.cleanData(d.getElementsByTagName("*")),v.cleanData([d])),d.parentNode&&d.parentNode.removeChild(d);return this},empty:function(){for(var b,
c=0;null!=(b=this[c]);c++)for(1===b.nodeType&&v.cleanData(b.getElementsByTagName("*"));b.firstChild;)b.removeChild(b.firstChild);return this},clone:function(b,c){return b=null==b?!1:b,c=null==c?b:c,this.map(function(){return v.clone(this,b,c)})},html:function(b){return v.access(this,function(b){var c=this[0]||{},d=0,g=this.length;if(b===f)return 1===c.nodeType?c.innerHTML.replace(Jc,""):f;if("string"==typeof b&&!qc.test(b)&&(v.support.htmlSerialize||!lc.test(b))&&(v.support.leadingWhitespace||!Sa.test(b))&&
!wb[(kc.exec(b)||["",""])[1].toLowerCase()]){b=b.replace(jc,"<$1></$2>");try{for(;d<g;d++)c=this[d]||{},1===c.nodeType&&(v.cleanData(c.getElementsByTagName("*")),c.innerHTML=b);c=0}catch(e){}}c&&this.empty().append(b)},null,b,arguments.length)},replaceWith:function(b){return m(this[0])?this.length?this.pushStack(v(v.isFunction(b)?b():b),"replaceWith",b):this:v.isFunction(b)?this.each(function(c){var d=v(this),g=d.html();d.replaceWith(b.call(this,c,g))}):("string"!=typeof b&&(b=v(b).detach()),this.each(function(){var c=
this.nextSibling,d=this.parentNode;v(this).remove();c?v(c).before(b):v(d).append(b)}))},detach:function(b){return this.remove(b,!0)},domManip:function(b,c,d){b=[].concat.apply([],b);var g,e,l,j=0,m=b[0],n=[],p=this.length;if(!v.support.checkClone&&1<p&&"string"==typeof m&&sc.test(m))return this.each(function(){v(this).domManip(b,c,d)});if(v.isFunction(m))return this.each(function(g){var e=v(this);b[0]=m.call(this,g,c?e.html():f);e.domManip(b,c,d)});if(this[0]){g=v.buildFragment(b,this,n);l=g.fragment;
e=l.firstChild;1===l.childNodes.length&&(l=e);if(e){c=c&&v.nodeName(e,"tr");for(g=g.cacheable||p-1;j<p;j++)d.call(c&&v.nodeName(this[j],"table")?this[j].getElementsByTagName("tbody")[0]||this[j].appendChild(this[j].ownerDocument.createElement("tbody")):this[j],j===g?l:v.clone(l,!0,!0))}l=e=null;n.length&&v.each(n,function(b,c){c.src?v.ajax?v.ajax({url:c.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):v.error("no ajax"):v.globalEval((c.text||c.textContent||c.innerHTML||"").replace(uc,
""));c.parentNode&&c.parentNode.removeChild(c)})}return this}});v.buildFragment=function(b,c,d){var g,e,l,j=b[0];return c=c||K,c=!c.nodeType&&c[0]||c,c=c.ownerDocument||c,1===b.length&&"string"==typeof j&&512>j.length&&c===K&&"<"===j.charAt(0)&&!rc.test(j)&&(v.support.checkClone||!sc.test(j))&&(v.support.html5Clone||!lc.test(j))&&(e=!0,g=v.fragments[j],l=g!==f),g||(g=c.createDocumentFragment(),v.clean(b,c,g,d),e&&(v.fragments[j]=l&&g)),{fragment:g,cacheable:e}};v.fragments={};v.each({appendTo:"append",
prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(b,c){v.fn[b]=function(d){var g,e=0,l=[];d=v(d);var j=d.length;g=1===this.length&&this[0].parentNode;if((null==g||g&&11===g.nodeType&&1===g.childNodes.length)&&1===j)return d[c](this[0]),this;for(;e<j;e++)g=(0<e?this.clone(!0):this).get(),v(d[e])[c](g),l=l.concat(g);return this.pushStack(l,b,d.selector)}});v.extend({clone:function(b,c,d){var g,e,l,j;v.support.html5Clone||v.isXMLDoc(b)||!lc.test("<"+b.nodeName+
">")?j=b.cloneNode(!0):(la.innerHTML=b.outerHTML,la.removeChild(j=la.firstChild));if((!v.support.noCloneEvent||!v.support.noCloneChecked)&&(1===b.nodeType||11===b.nodeType)&&!v.isXMLDoc(b)){p(b,j);g=r(b);e=r(j);for(l=0;g[l];++l)e[l]&&p(g[l],e[l])}if(c&&(q(b,j),d)){g=r(b);e=r(j);for(l=0;g[l];++l)q(g[l],e[l])}return j},clean:function(b,c,d,g){var e,l,j,f,m,p,q,r=c===K&&fb,s=[];if(!c||"undefined"==typeof c.createDocumentFragment)c=K;for(e=0;null!=(j=b[e]);e++)if("number"==typeof j&&(j+=""),j){if("string"==
typeof j)if(pc.test(j)){r=r||n(c);p=c.createElement("div");r.appendChild(p);j=j.replace(jc,"<$1></$2>");l=(kc.exec(j)||["",""])[1].toLowerCase();f=wb[l]||wb._default;m=f[0];for(p.innerHTML=f[1]+j+f[2];m--;)p=p.lastChild;if(!v.support.tbody){m=oc.test(j);f="table"===l&&!m?p.firstChild&&p.firstChild.childNodes:"<table>"===f[1]&&!m?p.childNodes:[];for(l=f.length-1;0<=l;--l)v.nodeName(f[l],"tbody")&&!f[l].childNodes.length&&f[l].parentNode.removeChild(f[l])}!v.support.leadingWhitespace&&Sa.test(j)&&p.insertBefore(c.createTextNode(Sa.exec(j)[0]),
p.firstChild);j=p.childNodes;p.parentNode.removeChild(p)}else j=c.createTextNode(j);j.nodeType?s.push(j):v.merge(s,j)}p&&(j=p=r=null);if(!v.support.appendChecked)for(e=0;null!=(j=s[e]);e++)v.nodeName(j,"input")?t(j):"undefined"!=typeof j.getElementsByTagName&&v.grep(j.getElementsByTagName("input"),t);if(d){b=function(b){if(!b.type||tc.test(b.type))return g?g.push(b.parentNode?b.parentNode.removeChild(b):b):d.appendChild(b)};for(e=0;null!=(j=s[e]);e++)if(!v.nodeName(j,"script")||!b(j))d.appendChild(j),
"undefined"!=typeof j.getElementsByTagName&&(q=v.grep(v.merge([],j.getElementsByTagName("script")),b),s.splice.apply(s,[e+1,0].concat(q)),e+=q.length)}return s},cleanData:function(b,c){for(var d,g,e,l,j=0,f=v.expando,m=v.cache,n=v.support.deleteExpando,p=v.event.special;null!=(e=b[j]);j++)if(c||v.acceptData(e))if(d=(g=e[f])&&m[g]){if(d.events)for(l in d.events)p[l]?v.event.remove(e,l):v.removeEvent(e,l,d.handle);m[g]&&(delete m[g],n?delete e[f]:e.removeAttribute?e.removeAttribute(f):e[f]=null,v.deletedIds.push(g))}}});
var qb,Eb;v.uaMatch=function(b){b=b.toLowerCase();b=/(chrome)[ \/]([\w.]+)/.exec(b)||/(webkit)[ \/]([\w.]+)/.exec(b)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(b)||/(msie) ([\w.]+)/.exec(b)||0>b.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(b)||[];return{browser:b[1]||"",version:b[2]||"0"}};qb=v.uaMatch(M.userAgent);Eb={};qb.browser&&(Eb[qb.browser]=!0,Eb.version=qb.version);Eb.chrome?Eb.webkit=!0:Eb.webkit&&(Eb.safari=!0);v.browser=Eb;v.sub=function(){function b(c,d){return new b.fn.init(c,
d)}v.extend(!0,b,this);b.superclass=this;b.fn=b.prototype=this();b.fn.constructor=b;b.sub=this.sub;b.fn.init=function(d,g){return g&&g instanceof v&&!(g instanceof b)&&(g=b(g)),v.fn.init.call(this,d,g,c)};b.fn.init.prototype=b.fn;var c=b(K);return b};var pa,V,oa,ua=/alpha\([^)]*\)/i,za=/opacity=([^)]*)/,mb=/^(top|right|bottom|left)$/,nb=/^(none|table(?!-c[ea]).+)/,jb=/^margin/,Ua=RegExp("^("+U+")(.*)$","i"),Tc=RegExp("^("+U+")(?!px)[a-z%]+$","i"),Rc=RegExp("^([-+])=("+U+")","i"),Pc={},bd={position:"absolute",
visibility:"hidden",display:"block"},Uc={letterSpacing:0,fontWeight:400},Lc=["Top","Right","Bottom","Left"],Nc=["Webkit","O","Moz","ms"],sd=v.fn.toggle;v.fn.extend({css:function(b,c){return v.access(this,function(b,c,d){return d!==f?v.style(b,c,d):v.css(b,c)},b,c,1<arguments.length)},show:function(){return x(this,!0)},hide:function(){return x(this)},toggle:function(b,c){var d="boolean"==typeof b;return v.isFunction(b)&&v.isFunction(c)?sd.apply(this,arguments):this.each(function(){(d?b:u(this))?v(this).show():
v(this).hide()})}});v.extend({cssHooks:{opacity:{get:function(b,c){if(c){var d=pa(b,"opacity");return""===d?"1":d}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":v.support.cssFloat?"cssFloat":"styleFloat"},style:function(b,c,d,g){if(b&&!(3===b.nodeType||8===b.nodeType||!b.style)){var e,l,j,m=v.camelCase(c),n=b.style;c=v.cssProps[m]||(v.cssProps[m]=s(n,m));j=v.cssHooks[c]||v.cssHooks[m];if(d===f)return j&&"get"in j&&(e=
j.get(b,!1,g))!==f?e:n[c];l=typeof d;"string"===l&&(e=Rc.exec(d))&&(d=(e[1]+1)*e[2]+parseFloat(v.css(b,c)),l="number");if(!(null==d||"number"===l&&isNaN(d)))if("number"===l&&!v.cssNumber[m]&&(d+="px"),!j||!("set"in j)||(d=j.set(b,d,g))!==f)try{n[c]=d}catch(p){}}},css:function(b,c,d,g){var e,l,j,m=v.camelCase(c);return c=v.cssProps[m]||(v.cssProps[m]=s(b.style,m)),j=v.cssHooks[c]||v.cssHooks[m],j&&"get"in j&&(e=j.get(b,!0,g)),e===f&&(e=pa(b,c)),"normal"===e&&c in Uc&&(e=Uc[c]),d||g!==f?(l=parseFloat(e),
d||v.isNumeric(l)?l||0:e):e},swap:function(b,c,d){var g,e={};for(g in c)e[g]=b.style[g],b.style[g]=c[g];d=d.call(b);for(g in c)b.style[g]=e[g];return d}});b.getComputedStyle?pa=function(c,d){var g,e,l,j,f=b.getComputedStyle(c,null),m=c.style;return f&&(g=f[d],""===g&&!v.contains(c.ownerDocument,c)&&(g=v.style(c,d)),Tc.test(g)&&jb.test(d)&&(e=m.width,l=m.minWidth,j=m.maxWidth,m.minWidth=m.maxWidth=m.width=g,g=f.width,m.width=e,m.minWidth=l,m.maxWidth=j)),g}:K.documentElement.currentStyle&&(pa=function(b,
c){var d,g,e=b.currentStyle&&b.currentStyle[c],l=b.style;return null==e&&l&&l[c]&&(e=l[c]),Tc.test(e)&&!mb.test(c)&&(d=l.left,g=b.runtimeStyle&&b.runtimeStyle.left,g&&(b.runtimeStyle.left=b.currentStyle.left),l.left="fontSize"===c?"1em":e,e=l.pixelLeft+"px",l.left=d,g&&(b.runtimeStyle.left=g)),""===e?"auto":e});v.each(["height","width"],function(b,c){v.cssHooks[c]={get:function(b,d,g){if(d)return 0===b.offsetWidth&&nb.test(pa(b,"display"))?v.swap(b,bd,function(){return A(b,c,g)}):A(b,c,g)},set:function(b,
d,g){return y(b,d,g?z(b,c,g,v.support.boxSizing&&"border-box"===v.css(b,"boxSizing")):0)}}});v.support.opacity||(v.cssHooks.opacity={get:function(b,c){return za.test((c&&b.currentStyle?b.currentStyle.filter:b.style.filter)||"")?0.01*parseFloat(RegExp.$1)+"":c?"1":""},set:function(b,c){var d=b.style,g=b.currentStyle,e=v.isNumeric(c)?"alpha(opacity="+100*c+")":"",l=g&&g.filter||d.filter||"";d.zoom=1;if(1<=c&&(""===v.trim(l.replace(ua,""))&&d.removeAttribute)&&(d.removeAttribute("filter"),g&&!g.filter))return;
d.filter=ua.test(l)?l.replace(ua,e):l+" "+e}});v(function(){v.support.reliableMarginRight||(v.cssHooks.marginRight={get:function(b,c){return v.swap(b,{display:"inline-block"},function(){if(c)return pa(b,"marginRight")})}});!v.support.pixelPosition&&v.fn.position&&v.each(["top","left"],function(b,c){v.cssHooks[c]={get:function(b,d){if(d){var g=pa(b,c);return Tc.test(g)?v(b).position()[c]+"px":g}}}})});v.expr&&v.expr.filters&&(v.expr.filters.hidden=function(b){return 0===b.offsetWidth&&0===b.offsetHeight||
!v.support.reliableHiddenOffsets&&"none"===(b.style&&b.style.display||pa(b,"display"))},v.expr.filters.visible=function(b){return!v.expr.filters.hidden(b)});v.each({margin:"",padding:"",border:"Width"},function(b,c){v.cssHooks[b+c]={expand:function(d){var g="string"==typeof d?d.split(" "):[d],e={};for(d=0;4>d;d++)e[b+Lc[d]+c]=g[d]||g[d-2]||g[0];return e}};jb.test(b)||(v.cssHooks[b+c].set=y)});var td=/%20/g,qd=/\[\]$/,hd=/\r?\n/g,ud=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,
vd=/^(?:select|textarea)/i;v.fn.extend({serialize:function(){return v.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?v.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||vd.test(this.nodeName)||ud.test(this.type))}).map(function(b,c){var d=v(this).val();return null==d?null:v.isArray(d)?v.map(d,function(b){return{name:c.name,value:b.replace(hd,"\r\n")}}):{name:c.name,value:d.replace(hd,"\r\n")}}).get()}});
v.param=function(b,c){var d,g=[],e=function(b,c){c=v.isFunction(c)?c():null==c?"":c;g[g.length]=encodeURIComponent(b)+"="+encodeURIComponent(c)};c===f&&(c=v.ajaxSettings&&v.ajaxSettings.traditional);if(v.isArray(b)||b.jquery&&!v.isPlainObject(b))v.each(b,function(){e(this.name,this.value)});else for(d in b)C(d,b[d],c,e);return g.join("&").replace(td,"+")};var Vc,Sc,wd=/#.*$/,xd=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,yd=/^(?:GET|HEAD)$/,zd=/^\/\//,id=/\?/,Ad=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,
Bd=/([?&])_=[^&]*/,jd=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,kd=v.fn.load,ed={},ld={},md=["*/"]+["*"];try{Sc=O.href}catch(Id){Sc=K.createElement("a"),Sc.href="",Sc=Sc.href}Vc=jd.exec(Sc.toLowerCase())||[];v.fn.load=function(b,c,d){if("string"!=typeof b&&kd)return kd.apply(this,arguments);if(!this.length)return this;var g,e,l,j=this,m=b.indexOf(" ");return 0<=m&&(g=b.slice(m,b.length),b=b.slice(0,m)),v.isFunction(c)?(d=c,c=f):c&&"object"==typeof c&&(e="POST"),v.ajax({url:b,type:e,dataType:"html",
data:c,complete:function(b,c){d&&j.each(d,l||[b.responseText,c,b])}}).done(function(b){l=arguments;j.html(g?v("<div>").append(b.replace(Ad,"")).find(g):b)}),this};v.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(b,c){v.fn[c]=function(b){return this.on(c,b)}});v.each(["get","post"],function(b,c){v[c]=function(b,d,g,e){return v.isFunction(d)&&(e=e||g,g=d,d=f),v.ajax({type:c,url:b,data:d,success:g,dataType:e})}});v.extend({getScript:function(b,c){return v.get(b,
f,c,"script")},getJSON:function(b,c,d){return v.get(b,c,d,"json")},ajaxSetup:function(b,c){return c?I(b,v.ajaxSettings):(c=b,b=v.ajaxSettings),I(b,c),b},ajaxSettings:{url:Sc,isLocal:/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/.test(Vc[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":md},contents:{xml:/xml/,
html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":b.String,"text html":!0,"text json":v.parseJSON,"text xml":v.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:D(ed),ajaxTransport:D(ld),ajax:function(b,c){function d(b,c,l,n){var q,y,O,A,C,B=c;if(2!==z){z=2;m&&clearTimeout(m);j=f;e=n||"";M.readyState=0<b?4:0;if(l){A=r;n=M;var D,W,E,H,I=A.contents,F=A.dataTypes,J=A.responseFields;for(W in J)W in l&&(n[J[W]]=l[W]);for(;"*"===F[0];)F.shift(),
D===f&&(D=A.mimeType||n.getResponseHeader("content-type"));if(D)for(W in I)if(I[W]&&I[W].test(D)){F.unshift(W);break}if(F[0]in l)E=F[0];else{for(W in l){if(!F[0]||A.converters[W+" "+F[0]]){E=W;break}H||(H=W)}E=E||H}l=E?(E!==F[0]&&F.unshift(E),l[E]):void 0;A=l}if(200<=b&&300>b||304===b)if(r.ifModified&&(C=M.getResponseHeader("Last-Modified"),C&&(v.lastModified[g]=C),C=M.getResponseHeader("Etag"),C&&(v.etag[g]=C)),304===b)B="notmodified",q=!0;else{var G;a:{q=r;y=A;var Ga,B=q.dataTypes.slice();l=B[0];
D={};W=0;q.dataFilter&&(y=q.dataFilter(y,q.dataType));if(B[1])for(G in q.converters)D[G.toLowerCase()]=q.converters[G];for(;O=B[++W];)if("*"!==O){if("*"!==l&&l!==O){G=D[l+" "+O]||D["* "+O];if(!G)for(Ga in D)if(C=Ga.split(" "),C[1]===O&&(G=D[l+" "+C[0]]||D["* "+C[0]])){!0===G?G=D[Ga]:!0!==D[Ga]&&(O=C[0],B.splice(W--,0,O));break}if(!0!==G)if(G&&q["throws"])y=G(y);else try{y=G(y)}catch(qa){G={state:"parsererror",error:G?qa:"No conversion from "+l+" to "+O};break a}}l=O}G={state:"success",data:y}}q=G;
B=q.state;y=q.data;O=q.error;q=!O}else if(O=B,!B||b)B="error",0>b&&(b=0);M.status=b;M.statusText=(c||B)+"";q?K.resolveWith(s,[y,B,M]):K.rejectWith(s,[M,B,O]);M.statusCode(u);u=f;p&&t.trigger("ajax"+(q?"Success":"Error"),[M,r,q?y:O]);x.fireWith(s,[M,B]);p&&(t.trigger("ajaxComplete",[M,r]),--v.active||v.event.trigger("ajaxStop"))}}"object"==typeof b&&(c=b,b=f);c=c||{};var g,e,l,j,m,n,p,q,r=v.ajaxSetup({},c),s=r.context||r,t=s!==r&&(s.nodeType||s instanceof v)?v(s):v.event,K=v.Deferred(),x=v.Callbacks("once memory"),
u=r.statusCode||{},y={},O={},z=0,A="canceled",M={readyState:0,setRequestHeader:function(b,c){if(!z){var d=b.toLowerCase();b=O[d]=O[d]||b;y[b]=c}return this},getAllResponseHeaders:function(){return 2===z?e:null},getResponseHeader:function(b){var c;if(2===z){if(!l)for(l={};c=xd.exec(e);)l[c[1].toLowerCase()]=c[2];c=l[b.toLowerCase()]}return c===f?null:c},overrideMimeType:function(b){return z||(r.mimeType=b),this},abort:function(b){return b=b||A,j&&j.abort(b),d(0,b),this}};K.promise(M);M.success=M.done;
M.error=M.fail;M.complete=x.add;M.statusCode=function(b){if(b){var c;if(2>z)for(c in b)u[c]=[u[c],b[c]];else c=b[M.status],M.always(c)}return this};r.url=((b||r.url)+"").replace(wd,"").replace(zd,Vc[1]+"//");r.dataTypes=v.trim(r.dataType||"*").toLowerCase().split(ba);null==r.crossDomain&&(n=jd.exec(r.url.toLowerCase())||!1,r.crossDomain=n&&n.join(":")+(n[3]?"":"http:"===n[1]?80:443)!==Vc.join(":")+(Vc[3]?"":"http:"===Vc[1]?80:443));r.data&&r.processData&&"string"!=typeof r.data&&(r.data=v.param(r.data,
r.traditional));E(ed,r,c,M);if(2===z)return M;p=r.global;r.type=r.type.toUpperCase();r.hasContent=!yd.test(r.type);p&&0===v.active++&&v.event.trigger("ajaxStart");if(!r.hasContent&&(r.data&&(r.url+=(id.test(r.url)?"&":"?")+r.data,delete r.data),g=r.url,!1===r.cache)){n=v.now();var C=r.url.replace(Bd,"$1_="+n);r.url=C+(C===r.url?(id.test(r.url)?"&":"?")+"_="+n:"")}(r.data&&r.hasContent&&!1!==r.contentType||c.contentType)&&M.setRequestHeader("Content-Type",r.contentType);r.ifModified&&(g=g||r.url,v.lastModified[g]&&
M.setRequestHeader("If-Modified-Since",v.lastModified[g]),v.etag[g]&&M.setRequestHeader("If-None-Match",v.etag[g]));M.setRequestHeader("Accept",r.dataTypes[0]&&r.accepts[r.dataTypes[0]]?r.accepts[r.dataTypes[0]]+("*"!==r.dataTypes[0]?", "+md+"; q=0.01":""):r.accepts["*"]);for(q in r.headers)M.setRequestHeader(q,r.headers[q]);if(!r.beforeSend||!1!==r.beforeSend.call(s,M,r)&&2!==z){A="abort";for(q in{success:1,error:1,complete:1})M[q](r[q]);if(j=E(ld,r,c,M)){M.readyState=1;p&&t.trigger("ajaxSend",[M,
r]);r.async&&0<r.timeout&&(m=setTimeout(function(){M.abort("timeout")},r.timeout));try{z=1,j.send(y,d)}catch(B){if(2>z)d(-1,B);else throw B;}}else d(-1,"No Transport");return M}return M.abort()},active:0,lastModified:{},etag:{}});var nd=[],Cd=/\?/,cd=/(=)\?(?=&|$)|\?\?/,Dd=v.now();v.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var b=nd.pop()||v.expando+"_"+Dd++;return this[b]=!0,b}});v.ajaxPrefilter("json jsonp",function(c,d,g){var e,l,j,m=c.data,n=c.url,p=!1!==c.jsonp,q=p&&cd.test(n),r=p&&
!q&&"string"==typeof m&&!(c.contentType||"").indexOf("application/x-www-form-urlencoded")&&cd.test(m);if("jsonp"===c.dataTypes[0]||q||r)return e=c.jsonpCallback=v.isFunction(c.jsonpCallback)?c.jsonpCallback():c.jsonpCallback,l=b[e],q?c.url=n.replace(cd,"$1"+e):r?c.data=m.replace(cd,"$1"+e):p&&(c.url+=(Cd.test(n)?"&":"?")+c.jsonp+"="+e),c.converters["script json"]=function(){return j||v.error(e+" was not called"),j[0]},c.dataTypes[0]="json",b[e]=function(){j=arguments},g.always(function(){b[e]=l;c[e]&&
(c.jsonpCallback=d.jsonpCallback,nd.push(e));j&&v.isFunction(l)&&l(j[0]);j=l=f}),"script"});v.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(b){return v.globalEval(b),b}}});v.ajaxPrefilter("script",function(b){b.cache===f&&(b.cache=!1);b.crossDomain&&(b.type="GET",b.global=!1)});v.ajaxTransport("script",function(b){if(b.crossDomain){var c,d=K.head||
K.getElementsByTagName("head")[0]||K.documentElement;return{send:function(g,e){c=K.createElement("script");c.async="async";b.scriptCharset&&(c.charset=b.scriptCharset);c.src=b.url;c.onload=c.onreadystatechange=function(b,g){if(g||!c.readyState||/loaded|complete/.test(c.readyState))c.onload=c.onreadystatechange=null,d&&c.parentNode&&d.removeChild(c),c=f,g||e(200,"success")};d.insertBefore(c,d.firstChild)},abort:function(){c&&c.onload(0,1)}}}});var Wc,fd=b.ActiveXObject?function(){for(var b in Wc)Wc[b](0,
1)}:!1,Ed=0;v.ajaxSettings.xhr=b.ActiveXObject?function(){var c;if(!(c=!this.isLocal&&H()))a:{try{c=new b.ActiveXObject("Microsoft.XMLHTTP");break a}catch(d){}c=void 0}return c}:H;var gd=v.ajaxSettings.xhr();v.extend(v.support,{ajax:!!gd,cors:!!gd&&"withCredentials"in gd});v.support.ajax&&v.ajaxTransport(function(c){if(!c.crossDomain||v.support.cors){var d;return{send:function(g,e){var l,j,m=c.xhr();c.username?m.open(c.type,c.url,c.async,c.username,c.password):m.open(c.type,c.url,c.async);if(c.xhrFields)for(j in c.xhrFields)m[j]=
c.xhrFields[j];c.mimeType&&m.overrideMimeType&&m.overrideMimeType(c.mimeType);!c.crossDomain&&!g["X-Requested-With"]&&(g["X-Requested-With"]="XMLHttpRequest");try{for(j in g)m.setRequestHeader(j,g[j])}catch(n){}m.send(c.hasContent&&c.data||null);d=function(b,g){var j,n,p,q,r;try{if(d&&(g||4===m.readyState))if(d=f,l&&(m.onreadystatechange=v.noop,fd&&delete Wc[l]),g)4!==m.readyState&&m.abort();else{j=m.status;p=m.getAllResponseHeaders();q={};(r=m.responseXML)&&r.documentElement&&(q.xml=r);try{q.text=
m.responseText}catch(s){}try{n=m.statusText}catch(t){n=""}!j&&c.isLocal&&!c.crossDomain?j=q.text?200:404:1223===j&&(j=204)}}catch(K){g||e(-1,K)}q&&e(j,n,q,p)};c.async?4===m.readyState?setTimeout(d,0):(l=++Ed,fd&&(Wc||(Wc={},v(b).unload(fd)),Wc[l]=d),m.onreadystatechange=d):d()},abort:function(){d&&d(0,1)}}}});var Yc,dd,Fd=/^(?:toggle|show|hide)$/,Gd=RegExp("^(?:([-+])=|)("+U+")([a-z%]*)$","i"),Hd=/queueHooks$/,Zc=[function(b,c,d){var g,e,l,j,m,f,n=this,p=b.style,q={},r=[],s=b.nodeType&&u(b);d.queue||
(m=v._queueHooks(b,"fx"),null==m.unqueued&&(m.unqueued=0,f=m.empty.fire,m.empty.fire=function(){m.unqueued||f()}),m.unqueued++,n.always(function(){n.always(function(){m.unqueued--;v.queue(b,"fx").length||m.empty.fire()})}));1===b.nodeType&&("height"in c||"width"in c)&&(d.overflow=[p.overflow,p.overflowX,p.overflowY],"inline"===v.css(b,"display")&&"none"===v.css(b,"float")&&(!v.support.inlineBlockNeedsLayout||"inline"===B(b.nodeName)?p.display="inline-block":p.zoom=1));d.overflow&&(p.overflow="hidden",
v.support.shrinkWrapBlocks||n.done(function(){p.overflow=d.overflow[0];p.overflowX=d.overflow[1];p.overflowY=d.overflow[2]}));for(g in c)e=c[g],Fd.exec(e)&&(delete c[g],e!==(s?"hide":"show")&&r.push(g));if(e=r.length){l=v._data(b,"fxshow")||v._data(b,"fxshow",{});s?v(b).show():n.done(function(){v(b).hide()});n.done(function(){var c;v.removeData(b,"fxshow",!0);for(c in q)v.style(b,c,q[c])});for(g=0;g<e;g++)c=r[g],j=n.createTween(c,s?l[c]:0),q[c]=l[c]||v.style(b,c),c in l||(l[c]=j.start,s&&(j.end=j.start,
j.start="width"===c||"height"===c?1:0))}}],Xc={"*":[function(b,c){var d,g,e=this.createTween(b,c),l=Gd.exec(c),j=e.cur(),m=+j||0,f=1,n=20;if(l){d=+l[2];g=l[3]||(v.cssNumber[b]?"":"px");if("px"!==g&&m){m=v.css(e.elem,b,!0)||d||1;do f=f||".5",m/=f,v.style(e.elem,b,m+g);while(f!==(f=e.cur()/j)&&1!==f&&--n)}e.unit=g;e.start=m;e.end=l[1]?m+(l[1]+1)*d:d}return e}]};v.Animation=v.extend(J,{tweener:function(b,c){v.isFunction(b)?(c=b,b=["*"]):b=b.split(" ");for(var d,g=0,e=b.length;g<e;g++)d=b[g],Xc[d]=Xc[d]||
[],Xc[d].unshift(c)},prefilter:function(b,c){c?Zc.unshift(b):Zc.push(b)}});v.Tween=G;G.prototype={constructor:G,init:function(b,c,d,g,e,l){this.elem=b;this.prop=d;this.easing=e||"swing";this.options=c;this.start=this.now=this.cur();this.end=g;this.unit=l||(v.cssNumber[d]?"":"px")},cur:function(){var b=G.propHooks[this.prop];return b&&b.get?b.get(this):G.propHooks._default.get(this)},run:function(b){var c,d=G.propHooks[this.prop];return this.options.duration?this.pos=c=v.easing[this.easing](b,this.options.duration*
b,0,1,this.options.duration):this.pos=c=b,this.now=(this.end-this.start)*c+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),d&&d.set?d.set(this):G.propHooks._default.set(this),this}};G.prototype.init.prototype=G.prototype;G.propHooks={_default:{get:function(b){var c;return null==b.elem[b.prop]||b.elem.style&&null!=b.elem.style[b.prop]?(c=v.css(b.elem,b.prop,!1,""),!c||"auto"===c?0:c):b.elem[b.prop]},set:function(b){v.fx.step[b.prop]?v.fx.step[b.prop](b):b.elem.style&&
(null!=b.elem.style[v.cssProps[b.prop]]||v.cssHooks[b.prop])?v.style(b.elem,b.prop,b.now+b.unit):b.elem[b.prop]=b.now}}};G.propHooks.scrollTop=G.propHooks.scrollLeft={set:function(b){b.elem.nodeType&&b.elem.parentNode&&(b.elem[b.prop]=b.now)}};v.each(["toggle","show","hide"],function(b,c){var d=v.fn[c];v.fn[c]=function(g,e,l){return null==g||"boolean"==typeof g||!b&&v.isFunction(g)&&v.isFunction(e)?d.apply(this,arguments):this.animate(L(c,!0),g,e,l)}});v.fn.extend({fadeTo:function(b,c,d,g){return this.filter(u).css("opacity",
0).show().end().animate({opacity:c},b,d,g)},animate:function(b,c,d,g){var e=v.isEmptyObject(b),l=v.speed(c,d,g);c=function(){var c=J(this,v.extend({},b),l);e&&c.stop(!0)};return e||!1===l.queue?this.each(c):this.queue(l.queue,c)},stop:function(b,c,d){var g=function(b){var c=b.stop;delete b.stop;c(d)};return"string"!=typeof b&&(d=c,c=b,b=f),c&&!1!==b&&this.queue(b||"fx",[]),this.each(function(){var c=!0,e=null!=b&&b+"queueHooks",l=v.timers,j=v._data(this);if(e)j[e]&&j[e].stop&&g(j[e]);else for(e in j)j[e]&&
j[e].stop&&Hd.test(e)&&g(j[e]);for(e=l.length;e--;)l[e].elem===this&&(null==b||l[e].queue===b)&&(l[e].anim.stop(d),c=!1,l.splice(e,1));(c||!d)&&v.dequeue(this,b)})}});v.each({slideDown:L("show"),slideUp:L("hide"),slideToggle:L("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(b,c){v.fn[b]=function(b,d,g){return this.animate(c,b,d,g)}});v.speed=function(b,c,d){var g=b&&"object"==typeof b?v.extend({},b):{complete:d||!d&&c||v.isFunction(b)&&b,duration:b,
easing:d&&c||c&&!v.isFunction(c)&&c};g.duration=v.fx.off?0:"number"==typeof g.duration?g.duration:g.duration in v.fx.speeds?v.fx.speeds[g.duration]:v.fx.speeds._default;if(null==g.queue||!0===g.queue)g.queue="fx";return g.old=g.complete,g.complete=function(){v.isFunction(g.old)&&g.old.call(this);g.queue&&v.dequeue(this,g.queue)},g};v.easing={linear:function(b){return b},swing:function(b){return 0.5-Math.cos(b*Math.PI)/2}};v.timers=[];v.fx=G.prototype.init;v.fx.tick=function(){for(var b,c=v.timers,
d=0;d<c.length;d++)b=c[d],!b()&&c[d]===b&&c.splice(d--,1);c.length||v.fx.stop()};v.fx.timer=function(b){b()&&v.timers.push(b)&&!dd&&(dd=setInterval(v.fx.tick,v.fx.interval))};v.fx.interval=13;v.fx.stop=function(){clearInterval(dd);dd=null};v.fx.speeds={slow:600,fast:200,_default:400};v.fx.step={};v.expr&&v.expr.filters&&(v.expr.filters.animated=function(b){return v.grep(v.timers,function(c){return b===c.elem}).length});var od=/^(?:body|html)$/i;v.fn.offset=function(b){if(arguments.length)return b===
f?this:this.each(function(c){v.offset.setOffset(this,b,c)});var c,d,g,e,l,j,m,n={top:0,left:0},p=this[0],q=p&&p.ownerDocument;if(q)return(d=q.body)===p?v.offset.bodyOffset(p):(c=q.documentElement,v.contains(c,p)?("undefined"!=typeof p.getBoundingClientRect&&(n=p.getBoundingClientRect()),g=N(q),e=c.clientTop||d.clientTop||0,l=c.clientLeft||d.clientLeft||0,j=g.pageYOffset||c.scrollTop,m=g.pageXOffset||c.scrollLeft,{top:n.top+j-e,left:n.left+m-l}):n)};v.offset={bodyOffset:function(b){var c=b.offsetTop,
d=b.offsetLeft;return v.support.doesNotIncludeMarginInBodyOffset&&(c+=parseFloat(v.css(b,"marginTop"))||0,d+=parseFloat(v.css(b,"marginLeft"))||0),{top:c,left:d}},setOffset:function(b,c,d){var g=v.css(b,"position");"static"===g&&(b.style.position="relative");var e=v(b),l=e.offset(),j=v.css(b,"top"),m=v.css(b,"left"),f={},n={},p,q;("absolute"===g||"fixed"===g)&&-1<v.inArray("auto",[j,m])?(n=e.position(),p=n.top,q=n.left):(p=parseFloat(j)||0,q=parseFloat(m)||0);v.isFunction(c)&&(c=c.call(b,d,l));null!=
c.top&&(f.top=c.top-l.top+p);null!=c.left&&(f.left=c.left-l.left+q);"using"in c?c.using.call(b,f):e.css(f)}};v.fn.extend({position:function(){if(this[0]){var b=this[0],c=this.offsetParent(),d=this.offset(),g=od.test(c[0].nodeName)?{top:0,left:0}:c.offset();return d.top-=parseFloat(v.css(b,"marginTop"))||0,d.left-=parseFloat(v.css(b,"marginLeft"))||0,g.top+=parseFloat(v.css(c[0],"borderTopWidth"))||0,g.left+=parseFloat(v.css(c[0],"borderLeftWidth"))||0,{top:d.top-g.top,left:d.left-g.left}}},offsetParent:function(){return this.map(function(){for(var b=
this.offsetParent||K.body;b&&!od.test(b.nodeName)&&"static"===v.css(b,"position");)b=b.offsetParent;return b||K.body})}});v.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(b,c){var d=/Y/.test(c);v.fn[b]=function(g){return v.access(this,function(b,g,e){var l=N(b);if(e===f)return l?c in l?l[c]:l.document.documentElement[g]:b[g];l?l.scrollTo(d?v(l).scrollLeft():e,d?e:v(l).scrollTop()):b[g]=e},b,g,arguments.length,null)}});v.each({Height:"height",Width:"width"},function(b,c){v.each({padding:"inner"+
b,content:c,"":"outer"+b},function(d,g){v.fn[g]=function(g,e){var l=arguments.length&&(d||"boolean"!=typeof g),j=d||(!0===g||!0===e?"margin":"border");return v.access(this,function(c,d,g){var e;return v.isWindow(c)?c.document.documentElement["client"+b]:9===c.nodeType?(e=c.documentElement,Math.max(c.body["scroll"+b],e["scroll"+b],c.body["offset"+b],e["offset"+b],e["client"+b])):g===f?v.css(c,d,g,j):v.style(c,d,g,j)},c,l?g:f,l,null)}})});b.jQuery=b.$=v;"function"==typeof define&&define.amd&&define.amd.jQuery&&
define("jquery",[],function(){return v})})(window);var HANDJS=HANDJS||{};
(function(){function b(){A=!0;clearTimeout(B);B=setTimeout(function(){A=!1},700)}function f(b){var c=[];if(b)for(c.unshift(b);b.parentNode;)c.unshift(b.parentNode),b=b.parentNode;return c}function e(b,c){for(var d=f(b),g=f(c),e=null;0<d.length&&d[0]==g.shift();)e=d.shift();return e}function c(b,c,d){c=e(b,c);for(var g=[];b&&b!=c;)b.__handjsGlobalRegisteredEvents&&b.__handjsGlobalRegisteredEvents.pointerenter&&g.push(b),b=b.parentNode;for(;0<g.length;)d(g.pop())}function d(b,c,d){for(c=e(b,c);b&&b!=
c;)b.__handjsGlobalRegisteredEvents&&b.__handjsGlobalRegisteredEvents.pointerleave&&d(b),b=b.parentNode}function g(b,g){["pointerdown","pointermove","pointerup","pointerover","pointerout"].forEach(function(c){window.addEventListener(b(c),function(b){!A&&r(b.target,c)&&g(b,c,!0)})});void 0===window["on"+b("pointerenter").toLowerCase()]&&window.addEventListener(b("pointerover"),function(b){if(!A){var d=r(b.target,"pointerenter");d&&d!==window&&(d.contains(b.relatedTarget)||c(d,b.relatedTarget,function(c){g(b,
"pointerenter",!1,c)}))}});void 0===window["on"+b("pointerleave").toLowerCase()]&&window.addEventListener(b("pointerout"),function(b){if(!A){var c=r(b.target,"pointerleave");c&&c!==window&&(c.contains(b.relatedTarget)||d(c,b.relatedTarget,function(c){g(b,"pointerleave",!1,c)}))}})}if(!window.PointerEvent){Array.prototype.indexOf||(Array.prototype.indexOf=function(b){var c=Object(this),d=c.length>>>0;if(0===d)return-1;var g=0;0<arguments.length&&(g=Number(arguments[1]),g!=g?g=0:0!=g&&(Infinity!=g&&
-Infinity!=g)&&(g=(0<g||-1)*Math.floor(Math.abs(g))));if(g>=d)return-1;for(g=0<=g?g:Math.max(d-Math.abs(g),0);g<d;g++)if(g in c&&c[g]===b)return g;return-1});String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/,"")});var m="pointerdown pointerup pointermove pointerover pointerout pointercancel pointerenter pointerleave".split(" "),j="PointerDown PointerUp PointerMove PointerOver PointerOut PointerCancel PointerEnter PointerLeave".split(" "),l={},n=function(b,c,
d,g){var e;document.createEvent?(e=document.createEvent("MouseEvents"),e.initMouseEvent(c,d,!0,window,1,b.screenX,b.screenY,b.clientX,b.clientY,b.ctrlKey,b.altKey,b.shiftKey,b.metaKey,b.button,null)):(e=document.createEventObject(),e.screenX=b.screenX,e.screenY=b.screenY,e.clientX=b.clientX,e.clientY=b.clientY,e.ctrlKey=b.ctrlKey,e.altKey=b.altKey,e.shiftKey=b.shiftKey,e.metaKey=b.metaKey,e.button=b.button);void 0===e.offsetX&&(void 0!==b.offsetX?(Object&&void 0!==Object.defineProperty&&(Object.defineProperty(e,
"offsetX",{writable:!0}),Object.defineProperty(e,"offsetY",{writable:!0})),e.offsetX=b.offsetX,e.offsetY=b.offsetY):Object&&void 0!==Object.defineProperty?(Object.defineProperty(e,"offsetX",{get:function(){return this.currentTarget&&this.currentTarget.offsetLeft?b.clientX-this.currentTarget.offsetLeft:b.clientX}}),Object.defineProperty(e,"offsetY",{get:function(){return this.currentTarget&&this.currentTarget.offsetTop?b.clientY-this.currentTarget.offsetTop:b.clientY}})):void 0!==b.layerX&&(e.offsetX=
b.layerX-b.currentTarget.offsetLeft,e.offsetY=b.layerY-b.currentTarget.offsetTop));e.isPrimary=void 0!==b.isPrimary?b.isPrimary:!0;b.pressure?e.pressure=b.pressure:(d=0,void 0!==b.which?d=b.which:void 0!==b.button&&(d=b.button),e.pressure=0==d?0:0.5);e.rotation=b.rotation?b.rotation:0;e.hwTimestamp=b.hwTimestamp?b.hwTimestamp:0;e.tiltX=b.tiltX?b.tiltX:0;e.tiltY=b.tiltY?b.tiltY:0;e.height=b.height?b.height:0;e.width=b.width?b.width:0;e.preventDefault=function(){void 0!==b.preventDefault&&b.preventDefault()};
if(void 0!==e.stopPropagation){var l=e.stopPropagation;e.stopPropagation=function(){void 0!==b.stopPropagation&&b.stopPropagation();l.call(this)}}e.pointerId=b.pointerId;e.pointerType=b.pointerType;switch(e.pointerType){case 2:e.pointerType="touch";break;case 3:e.pointerType="pen";break;case 4:e.pointerType="mouse"}g?g.dispatchEvent(e):b.target?b.target.dispatchEvent(e):b.srcElement.fireEvent("on"+s(c),e)},q=function(b,c,d,g){b.pointerId=1;b.pointerType="mouse";n(b,c,d,g)},p=function(b,c,d,g,e){c.pointerId=
c.identifier+2;c.pointerType="touch";c.currentTarget=d;void 0!==g.preventDefault&&(c.preventDefault=function(){g.preventDefault()});n(c,b,e,d)},r=function(b,c){for(;b&&(!b.__handjsGlobalRegisteredEvents||!b.__handjsGlobalRegisteredEvents[c]);)b=b.parentNode;if(b)return b;if(window.__handjsGlobalRegisteredEvents&&window.__handjsGlobalRegisteredEvents[c])return window},t=function(b,c,d,g,e){r(d,b)&&p(b,c,d,g,e)},s=function(b){return b.toLowerCase().replace("pointer","mouse")},u=function(b,c,d,g){void 0===
b.__handjsRegisteredEvents&&(b.__handjsRegisteredEvents=[]);if(g)void 0!==b.__handjsRegisteredEvents[c]?b.__handjsRegisteredEvents[c]++:(b.__handjsRegisteredEvents[c]=1,b.addEventListener(c,d,!1));else{if(-1!==b.__handjsRegisteredEvents.indexOf(c)&&(b.__handjsRegisteredEvents[c]--,0!=b.__handjsRegisteredEvents[c]))return;b.removeEventListener(c,d);b.__handjsRegisteredEvents[c]=0}},x=function(b,c,d){b.__handjsGlobalRegisteredEvents||(b.__handjsGlobalRegisteredEvents=[]);if(d){if(void 0!==b.__handjsGlobalRegisteredEvents[c]){b.__handjsGlobalRegisteredEvents[c]++;
return}b.__handjsGlobalRegisteredEvents[c]=1}else void 0!==b.__handjsGlobalRegisteredEvents[c]&&(b.__handjsGlobalRegisteredEvents[c]--,0>b.__handjsGlobalRegisteredEvents[c]&&(b.__handjsGlobalRegisteredEvents[c]=0));if(!window.MSPointerEvent)switch(c){case "pointerenter":void 0!==b.onmouseenter&&u(b,"mouseenter",function(b){q(b,c)},d);break;case "pointerleave":void 0!==b.onmouseleave&&u(b,"mouseleave",function(b){q(b,c)},d)}},y=function(b){var c=b.prototype?b.prototype.addEventListener:b.addEventListener,
d=function(b,d,g){-1!=m.indexOf(b)&&x(this,b,!0);void 0===c?this.attachEvent("on"+s(b),d):c.call(this,b,d,g)};b.prototype?b.prototype.addEventListener=d:b.addEventListener=d},z=function(b){var c=b.prototype?b.prototype.removeEventListener:b.removeEventListener,d=function(b,d,g){-1!=m.indexOf(b)&&x(this,b,!1);void 0===c?this.detachEvent(s(b),d):c.call(this,b,d,g)};b.prototype?b.prototype.removeEventListener=d:b.removeEventListener=d};y(window);y(window.HTMLElement||window.Element);y(document);y(HTMLBodyElement);
y(HTMLDivElement);y(HTMLImageElement);y(HTMLUListElement);y(HTMLAnchorElement);y(HTMLLIElement);y(HTMLTableElement);window.HTMLSpanElement&&y(HTMLSpanElement);window.HTMLCanvasElement&&y(HTMLCanvasElement);window.SVGElement&&y(SVGElement);z(window);z(window.HTMLElement||window.Element);z(document);z(HTMLBodyElement);z(HTMLDivElement);z(HTMLImageElement);z(HTMLUListElement);z(HTMLAnchorElement);z(HTMLLIElement);z(HTMLTableElement);window.HTMLSpanElement&&z(HTMLSpanElement);window.HTMLCanvasElement&&
z(HTMLCanvasElement);window.SVGElement&&z(SVGElement);var A=!1,B=-1;window.MSPointerEvent?g(function(b){b=m.indexOf(b);return"MS"+j[b]},n):(g(s,q),void 0!==window.ontouchstart&&(window.addEventListener("touchstart",function(d){for(var g=0;g<d.changedTouches.length;++g){var e=d.changedTouches[g];l[e.identifier]=e.target;t("pointerover",e,e.target,d,!0);c(e.target,null,function(b){p("pointerenter",e,b,d,!1)});t("pointerdown",e,e.target,d,!0)}b()}),window.addEventListener("touchend",function(c){for(var g=
0;g<c.changedTouches.length;++g){var e=c.changedTouches[g],j=l[e.identifier];t("pointerup",e,j,c,!0);t("pointerout",e,j,c,!0);d(j,null,function(b){p("pointerleave",e,b,c,!1)})}b()}),window.addEventListener("touchmove",function(g){for(var e=0;e<g.changedTouches.length;++e){var j=g.changedTouches[e],m=document.elementFromPoint(j.clientX,j.clientY),f=l[j.identifier],n;if(n=f){for(n=f;n&&!n.handjs_forcePreventDefault;)n=n.parentNode;n=!0===(!!n||window.handjs_forcePreventDefault)}n&&g.preventDefault();
t("pointermove",j,f,g,!0);f!==m&&(f&&(t("pointerout",j,f,g,!0),f.contains(m)||d(f,m,function(b){p("pointerleave",j,b,g,!1)})),m&&(t("pointerover",j,m,g,!0),m.contains(f)||c(m,f,function(b){p("pointerenter",j,b,g,!1)})),l[j.identifier]=m)}b()}),window.addEventListener("touchcancel",function(b){for(var c=0;c<b.changedTouches.length;++c){var d=b.changedTouches[c];t("pointercancel",d,l[d.identifier],b,!0)}})));void 0===navigator.pointerEnabled&&(navigator.pointerEnabled=!0,navigator.msPointerEnabled&&
(navigator.maxTouchPoints=navigator.msMaxTouchPoints));document.styleSheets&&document.addEventListener&&document.addEventListener("DOMContentLoaded",function(){if(!(HANDJS.doNotProcessCSS||void 0!==document.body.style.touchAction)){var b=/.+?{.*?}/m,c=/.+?{/m,d=function(d){var g=b.exec(d);if(g){g=g[0];d=d.replace(g,"").trim();var e=c.exec(g)[0].replace("{","").trim();if(-1!=g.replace(/\s/g,"").indexOf("touch-action:none")){g=document.querySelectorAll(e);for(e=0;e<g.length;e++){var l=g[e];void 0!==
l.style.msTouchAction?l.style.msTouchAction="none":l.handjs_forcePreventDefault=!0}}return d}},g=function(b){if(window.setImmediate)b&&setImmediate(g,d(b));else for(;b;)b=d(b)};try{for(var e=0;e<document.styleSheets.length;e++){var l=document.styleSheets[e];if(void 0!=l.href){var j=new XMLHttpRequest;j.open("get",l.href,!1);j.send();var m=j.responseText.replace(/(\n|\r)/g,"");g(m)}}}catch(f){}l=document.getElementsByTagName("style");for(e=0;e<l.length;e++)j=l[e].innerHTML.replace(/(\n|\r)/g,"").trim(),
g(j)}},!1)}})();window.wgl={modules:{}};var __decorate=this&&this.__decorate||function(b,f,e,c){var d,g=arguments.length,m=3>g?f:null===c?c=Object.getOwnPropertyDescriptor(f,e):c;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(b,f,e,c);else for(var j=b.length-1;0<=j;j--)(d=b[j])&&(m=(3>g?d(m):3<g?d(f,e,m):d(f,e))||m);return 3<g&&m&&Object.defineProperty(f,e,m),m},__extends=this&&this.__extends||function(b,f){function e(){this.constructor=b}for(var c in f)f.hasOwnProperty(c)&&(b[c]=f[c]);e.prototype=f.prototype;
b.prototype=new e},BABYLON;
!function(b){b.ToGammaSpace=1/2.2;b.ToLinearSpace=2.2;b.Epsilon=0.0010;var f,e=function(){};f=(e.WithinEpsilon=function(b,c,d){void 0===d&&(d=1.401298E-45);b-=c;return b>=-d&&d>=b},e.ToHex=function(b){var c=b.toString(16);return 15>=b?("0"+c).toUpperCase():c.toUpperCase()},e.Sign=function(b){return b=+b,0===b||isNaN(b)?b:0<b?1:-1},e.Clamp=function(b,c,d){return void 0===c&&(c=0),void 0===d&&(d=1),Math.min(d,Math.max(c,b))},e);b.MathTools=f;var c=function(b,c,d){void 0===b&&(b=0);void 0===c&&(c=0);
void 0===d&&(d=0);this.r=b;this.g=c;this.b=d},e=(c.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},c.prototype.getClassName=function(){return"Color3"},c.prototype.getHashCode=function(){var b=this.r||0;return b=397*b^(this.g||0),397*b^(this.b||0)},c.prototype.toArray=function(b,c){return void 0===c&&(c=0),b[c]=this.r,b[c+1]=this.g,b[c+2]=this.b,this},c.prototype.toColor4=function(b){return void 0===b&&(b=1),new d(this.r,this.g,this.b,b)},c.prototype.asArray=function(){var b=
[];return this.toArray(b,0),b},c.prototype.toLuminance=function(){return 0.3*this.r+0.59*this.g+0.11*this.b},c.prototype.multiply=function(b){return new c(this.r*b.r,this.g*b.g,this.b*b.b)},c.prototype.multiplyToRef=function(b,c){return c.r=this.r*b.r,c.g=this.g*b.g,c.b=this.b*b.b,this},c.prototype.equals=function(b){return b&&this.r===b.r&&this.g===b.g&&this.b===b.b},c.prototype.equalsFloats=function(b,c,d){return this.r===b&&this.g===c&&this.b===d},c.prototype.scale=function(b){return new c(this.r*
b,this.g*b,this.b*b)},c.prototype.scaleToRef=function(b,c){return c.r=this.r*b,c.g=this.g*b,c.b=this.b*b,this},c.prototype.add=function(b){return new c(this.r+b.r,this.g+b.g,this.b+b.b)},c.prototype.addToRef=function(b,c){return c.r=this.r+b.r,c.g=this.g+b.g,c.b=this.b+b.b,this},c.prototype.subtract=function(b){return new c(this.r-b.r,this.g-b.g,this.b-b.b)},c.prototype.subtractToRef=function(b,c){return c.r=this.r-b.r,c.g=this.g-b.g,c.b=this.b-b.b,this},c.prototype.clone=function(){return new c(this.r,
this.g,this.b)},c.prototype.copyFrom=function(b){return this.r=b.r,this.g=b.g,this.b=b.b,this},c.prototype.copyFromFloats=function(b,c,d){return this.r=b,this.g=c,this.b=d,this},c.prototype.toHexString=function(){var b=255*this.g|0,c=255*this.b|0;return"#"+f.ToHex(255*this.r|0)+f.ToHex(b)+f.ToHex(c)},c.prototype.toLinearSpace=function(){var b=new c;return this.toLinearSpaceToRef(b),b},c.prototype.toLinearSpaceToRef=function(c){return c.r=Math.pow(this.r,b.ToLinearSpace),c.g=Math.pow(this.g,b.ToLinearSpace),
c.b=Math.pow(this.b,b.ToLinearSpace),this},c.prototype.toGammaSpace=function(){var b=new c;return this.toGammaSpaceToRef(b),b},c.prototype.toGammaSpaceToRef=function(c){return c.r=Math.pow(this.r,b.ToGammaSpace),c.g=Math.pow(this.g,b.ToGammaSpace),c.b=Math.pow(this.b,b.ToGammaSpace),this},c.FromHexString=function(b){if("#"!==b.substring(0,1)||7!==b.length)return new c(0,0,0);var d=parseInt(b.substring(1,3),16),g=parseInt(b.substring(3,5),16);b=parseInt(b.substring(5,7),16);return c.FromInts(d,g,b)},
c.FromArray=function(b,d){return void 0===d&&(d=0),new c(b[d],b[d+1],b[d+2])},c.FromInts=function(b,d,g){return new c(b/255,d/255,g/255)},c.Lerp=function(b,d,g){return new c(b.r+(d.r-b.r)*g,b.g+(d.g-b.g)*g,b.b+(d.b-b.b)*g)},c.Red=function(){return new c(1,0,0)},c.Green=function(){return new c(0,1,0)},c.Blue=function(){return new c(0,0,1)},c.Black=function(){return new c(0,0,0)},c.White=function(){return new c(1,1,1)},c.Purple=function(){return new c(0.5,0,0.5)},c.Magenta=function(){return new c(1,
0,1)},c.Yellow=function(){return new c(1,1,0)},c.Gray=function(){return new c(0.5,0.5,0.5)},c);b.Color3=e;var d,g=function(b,c,d,g){this.r=b;this.g=c;this.b=d;this.a=g};d=(g.prototype.addInPlace=function(b){return this.r+=b.r,this.g+=b.g,this.b+=b.b,this.a+=b.a,this},g.prototype.asArray=function(){var b=[];return this.toArray(b,0),b},g.prototype.toArray=function(b,c){return void 0===c&&(c=0),b[c]=this.r,b[c+1]=this.g,b[c+2]=this.b,b[c+3]=this.a,this},g.prototype.add=function(b){return new g(this.r+
b.r,this.g+b.g,this.b+b.b,this.a+b.a)},g.prototype.subtract=function(b){return new g(this.r-b.r,this.g-b.g,this.b-b.b,this.a-b.a)},g.prototype.subtractToRef=function(b,c){return c.r=this.r-b.r,c.g=this.g-b.g,c.b=this.b-b.b,c.a=this.a-b.a,this},g.prototype.scale=function(b){return new g(this.r*b,this.g*b,this.b*b,this.a*b)},g.prototype.scaleToRef=function(b,c){return c.r=this.r*b,c.g=this.g*b,c.b=this.b*b,c.a=this.a*b,this},g.prototype.multiply=function(b){return new g(this.r*b.r,this.g*b.g,this.b*
b.b,this.a*b.a)},g.prototype.multiplyToRef=function(b,c){return c.r=this.r*b.r,c.g=this.g*b.g,c.b=this.b*b.b,c.a=this.a*b.a,c},g.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},g.prototype.getClassName=function(){return"Color4"},g.prototype.getHashCode=function(){var b=this.r||0;return b=397*b^(this.g||0),b=397*b^(this.b||0),397*b^(this.a||0)},g.prototype.clone=function(){return new g(this.r,this.g,this.b,this.a)},g.prototype.copyFrom=function(b){return this.r=
b.r,this.g=b.g,this.b=b.b,this.a=b.a,this},g.prototype.toHexString=function(){var b=255*this.g|0,c=255*this.b|0,d=255*this.a|0;return"#"+f.ToHex(255*this.r|0)+f.ToHex(b)+f.ToHex(c)+f.ToHex(d)},g.FromHexString=function(b){if("#"!==b.substring(0,1)||9!==b.length)return new g(0,0,0,0);var c=parseInt(b.substring(1,3),16),d=parseInt(b.substring(3,5),16),e=parseInt(b.substring(5,7),16);b=parseInt(b.substring(7,9),16);return g.FromInts(c,d,e,b)},g.Lerp=function(b,c,d){var e=new g(0,0,0,0);return g.LerpToRef(b,
c,d,e),e},g.LerpToRef=function(b,c,d,g){g.r=b.r+(c.r-b.r)*d;g.g=b.g+(c.g-b.g)*d;g.b=b.b+(c.b-b.b)*d;g.a=b.a+(c.a-b.a)*d},g.FromArray=function(b,c){return void 0===c&&(c=0),new g(b[c],b[c+1],b[c+2],b[c+3])},g.FromInts=function(b,c,d,e){return new g(b/255,c/255,d/255,e/255)},g.CheckColors4=function(b,c){if(b.length===3*c){for(var d=[],g=0;g<b.length;g+=3){var e=4*(g/3);d[e]=b[g];d[e+1]=b[g+1];d[e+2]=b[g+2];d[e+3]=1}return d}return b},g);b.Color4=d;var m,j=function(b,c){this.x=b;this.y=c};m=(j.prototype.toString=
function(){return"{X: "+this.x+" Y:"+this.y+"}"},j.prototype.getClassName=function(){return"Vector2"},j.prototype.getHashCode=function(){return 397*(this.x||0)^(this.y||0)},j.prototype.toArray=function(b,c){return void 0===c&&(c=0),b[c]=this.x,b[c+1]=this.y,this},j.prototype.asArray=function(){var b=[];return this.toArray(b,0),b},j.prototype.copyFrom=function(b){return this.x=b.x,this.y=b.y,this},j.prototype.copyFromFloats=function(b,c){return this.x=b,this.y=c,this},j.prototype.add=function(b){return new j(this.x+
b.x,this.y+b.y)},j.prototype.addToRef=function(b,c){return c.x=this.x+b.x,c.y=this.y+b.y,this},j.prototype.addVector3=function(b){return new j(this.x+b.x,this.y+b.y)},j.prototype.subtract=function(b){return new j(this.x-b.x,this.y-b.y)},j.prototype.subtractToRef=function(b,c){return c.x=this.x-b.x,c.y=this.y-b.y,this},j.prototype.subtractInPlace=function(b){return this.x-=b.x,this.y-=b.y,this},j.prototype.multiplyInPlace=function(b){return this.x*=b.x,this.y*=b.y,this},j.prototype.multiply=function(b){return new j(this.x*
b.x,this.y*b.y)},j.prototype.multiplyToRef=function(b,c){return c.x=this.x*b.x,c.y=this.y*b.y,this},j.prototype.multiplyByFloats=function(b,c){return new j(this.x*b,this.y*c)},j.prototype.divide=function(b){return new j(this.x/b.x,this.y/b.y)},j.prototype.divideToRef=function(b,c){return c.x=this.x/b.x,c.y=this.y/b.y,this},j.prototype.negate=function(){return new j(-this.x,-this.y)},j.prototype.scaleInPlace=function(b){return this.x*=b,this.y*=b,this},j.prototype.scale=function(b){return new j(this.x*
b,this.y*b)},j.prototype.equals=function(b){return b&&this.x===b.x&&this.y===b.y},j.prototype.equalsWithEpsilon=function(c,d){return void 0===d&&(d=b.Epsilon),c&&f.WithinEpsilon(this.x,c.x,d)&&f.WithinEpsilon(this.y,c.y,d)},j.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},j.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},j.prototype.normalize=function(){var b=this.length();if(0===b)return this;b=1/b;return this.x*=b,this.y*=b,this},j.prototype.clone=
function(){return new j(this.x,this.y)},j.Zero=function(){return new j(0,0)},j.FromArray=function(b,c){return void 0===c&&(c=0),new j(b[c],b[c+1])},j.FromArrayToRef=function(b,c,d){d.x=b[c];d.y=b[c+1]},j.CatmullRom=function(b,c,d,g,e){var l=e*e,m=e*l;return new j(0.5*(2*c.x+(-b.x+d.x)*e+(2*b.x-5*c.x+4*d.x-g.x)*l+(-b.x+3*c.x-3*d.x+g.x)*m),0.5*(2*c.y+(-b.y+d.y)*e+(2*b.y-5*c.y+4*d.y-g.y)*l+(-b.y+3*c.y-3*d.y+g.y)*m))},j.Clamp=function(b,c,d){var g=b.x,g=g>d.x?d.x:g,g=g<c.x?c.x:g;b=b.y;return b=b>d.y?
d.y:b,b=b<c.y?c.y:b,new j(g,b)},j.Hermite=function(b,c,d,g,e){var l=e*e,m=e*l,f=2*m-3*l+1,n=-2*m+3*l;e=m-2*l+e;l=m-l;return new j(b.x*f+d.x*n+c.x*e+g.x*l,b.y*f+d.y*n+c.y*e+g.y*l)},j.Lerp=function(b,c,d){return new j(b.x+(c.x-b.x)*d,b.y+(c.y-b.y)*d)},j.Dot=function(b,c){return b.x*c.x+b.y*c.y},j.Normalize=function(b){b=b.clone();return b.normalize(),b},j.Minimize=function(b,c){return new j(b.x<c.x?b.x:c.x,b.y<c.y?b.y:c.y)},j.Maximize=function(b,c){return new j(b.x>c.x?b.x:c.x,b.y>c.y?b.y:c.y)},j.Transform=
function(b,c){var d=j.Zero();return j.TransformToRef(b,c,d),d},j.TransformToRef=function(b,c,d){var g=b.x*c.m[1]+b.y*c.m[5]+c.m[13];d.x=b.x*c.m[0]+b.y*c.m[4]+c.m[12];d.y=g},j.PointInTriangle=function(b,c,d,g){var e=0.5*(-d.y*g.x+c.y*(-d.x+g.x)+c.x*(d.y-g.y)+d.x*g.y),l=0>e?-1:1;g=(c.y*g.x-c.x*g.y+(g.y-c.y)*b.x+(c.x-g.x)*b.y)*l;b=(c.x*d.y-c.y*d.x+(c.y-d.y)*b.x+(d.x-c.x)*b.y)*l;return 0<g&&0<b&&2*e*l>g+b},j.Distance=function(b,c){return Math.sqrt(j.DistanceSquared(b,c))},j.DistanceSquared=function(b,
c){var d=b.x-c.x,g=b.y-c.y;return d*d+g*g},j.DistanceOfPointFromSegment=function(b,c,d){var g=j.DistanceSquared(c,d);if(0===g)return j.Distance(b,c);d=d.subtract(c);g=Math.max(0,Math.min(1,j.Dot(b.subtract(c),d)/g));c=c.add(d.multiplyByFloats(g,g));return j.Distance(b,c)},j);b.Vector2=m;var l,n=function(b,c,d){this.x=b;this.y=c;this.z=d};l=(n.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}"},n.prototype.getClassName=function(){return"Vector3"},n.prototype.getHashCode=
function(){var b=this.x||0;return b=397*b^(this.y||0),397*b^(this.z||0)},n.prototype.asArray=function(){var b=[];return this.toArray(b,0),b},n.prototype.toArray=function(b,c){return void 0===c&&(c=0),b[c]=this.x,b[c+1]=this.y,b[c+2]=this.z,this},n.prototype.toQuaternion=function(){var b=new s(0,0,0,1),c=Math.cos(0.5*(this.x+this.z)),d=Math.sin(0.5*(this.x+this.z)),g=Math.cos(0.5*(this.z-this.x)),e=Math.sin(0.5*(this.z-this.x)),l=Math.cos(0.5*this.y),j=Math.sin(0.5*this.y);return b.x=g*j,b.y=-e*j,
b.z=d*l,b.w=c*l,b},n.prototype.addInPlace=function(b){return this.x+=b.x,this.y+=b.y,this.z+=b.z,this},n.prototype.add=function(b){return new n(this.x+b.x,this.y+b.y,this.z+b.z)},n.prototype.addToRef=function(b,c){return c.x=this.x+b.x,c.y=this.y+b.y,c.z=this.z+b.z,this},n.prototype.subtractInPlace=function(b){return this.x-=b.x,this.y-=b.y,this.z-=b.z,this},n.prototype.subtract=function(b){return new n(this.x-b.x,this.y-b.y,this.z-b.z)},n.prototype.subtractToRef=function(b,c){return c.x=this.x-b.x,
c.y=this.y-b.y,c.z=this.z-b.z,this},n.prototype.subtractFromFloats=function(b,c,d){return new n(this.x-b,this.y-c,this.z-d)},n.prototype.subtractFromFloatsToRef=function(b,c,d,g){return g.x=this.x-b,g.y=this.y-c,g.z=this.z-d,this},n.prototype.negate=function(){return new n(-this.x,-this.y,-this.z)},n.prototype.scaleInPlace=function(b){return this.x*=b,this.y*=b,this.z*=b,this},n.prototype.scale=function(b){return new n(this.x*b,this.y*b,this.z*b)},n.prototype.scaleToRef=function(b,c){c.x=this.x*b;
c.y=this.y*b;c.z=this.z*b},n.prototype.equals=function(b){return b&&this.x===b.x&&this.y===b.y&&this.z===b.z},n.prototype.equalsWithEpsilon=function(c,d){return void 0===d&&(d=b.Epsilon),c&&f.WithinEpsilon(this.x,c.x,d)&&f.WithinEpsilon(this.y,c.y,d)&&f.WithinEpsilon(this.z,c.z,d)},n.prototype.equalsToFloats=function(b,c,d){return this.x===b&&this.y===c&&this.z===d},n.prototype.multiplyInPlace=function(b){return this.x*=b.x,this.y*=b.y,this.z*=b.z,this},n.prototype.multiply=function(b){return new n(this.x*
b.x,this.y*b.y,this.z*b.z)},n.prototype.multiplyToRef=function(b,c){return c.x=this.x*b.x,c.y=this.y*b.y,c.z=this.z*b.z,this},n.prototype.multiplyByFloats=function(b,c,d){return new n(this.x*b,this.y*c,this.z*d)},n.prototype.divide=function(b){return new n(this.x/b.x,this.y/b.y,this.z/b.z)},n.prototype.divideToRef=function(b,c){return c.x=this.x/b.x,c.y=this.y/b.y,c.z=this.z/b.z,this},n.prototype.MinimizeInPlace=function(b){return b.x<this.x&&(this.x=b.x),b.y<this.y&&(this.y=b.y),b.z<this.z&&(this.z=
b.z),this},n.prototype.MaximizeInPlace=function(b){return b.x>this.x&&(this.x=b.x),b.y>this.y&&(this.y=b.y),b.z>this.z&&(this.z=b.z),this},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},n.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},n.prototype.normalize=function(){var b=this.length();if(0===b||1===b)return this;b=1/b;return this.x*=b,this.y*=b,this.z*=b,this},n.prototype.clone=function(){return new n(this.x,this.y,
this.z)},n.prototype.copyFrom=function(b){return this.x=b.x,this.y=b.y,this.z=b.z,this},n.prototype.copyFromFloats=function(b,c,d){return this.x=b,this.y=c,this.z=d,this},n.GetClipFactor=function(b,c,d,g){b=n.Dot(b,d)-g;c=n.Dot(c,d)-g;return b/(b-c)},n.FromArray=function(b,c){return c||(c=0),new n(b[c],b[c+1],b[c+2])},n.FromFloatArray=function(b,c){return c||(c=0),new n(b[c],b[c+1],b[c+2])},n.FromArrayToRef=function(b,c,d){d.x=b[c];d.y=b[c+1];d.z=b[c+2]},n.FromFloatArrayToRef=function(b,c,d){d.x=
b[c];d.y=b[c+1];d.z=b[c+2]},n.FromFloatsToRef=function(b,c,d,g){g.x=b;g.y=c;g.z=d},n.Zero=function(){return new n(0,0,0)},n.Up=function(){return new n(0,1,0)},n.TransformCoordinates=function(b,c){var d=n.Zero();return n.TransformCoordinatesToRef(b,c,d),d},n.TransformCoordinatesToRef=function(b,c,d){var g=b.x*c.m[1]+b.y*c.m[5]+b.z*c.m[9]+c.m[13],e=b.x*c.m[2]+b.y*c.m[6]+b.z*c.m[10]+c.m[14],l=b.x*c.m[3]+b.y*c.m[7]+b.z*c.m[11]+c.m[15];d.x=(b.x*c.m[0]+b.y*c.m[4]+b.z*c.m[8]+c.m[12])/l;d.y=g/l;d.z=e/l},
n.TransformCoordinatesFromFloatsToRef=function(b,c,d,g,e){var l=b*g.m[1]+c*g.m[5]+d*g.m[9]+g.m[13],j=b*g.m[2]+c*g.m[6]+d*g.m[10]+g.m[14],m=b*g.m[3]+c*g.m[7]+d*g.m[11]+g.m[15];e.x=(b*g.m[0]+c*g.m[4]+d*g.m[8]+g.m[12])/m;e.y=l/m;e.z=j/m},n.TransformNormal=function(b,c){var d=n.Zero();return n.TransformNormalToRef(b,c,d),d},n.TransformNormalToRef=function(b,c,d){d.x=b.x*c.m[0]+b.y*c.m[4]+b.z*c.m[8];d.y=b.x*c.m[1]+b.y*c.m[5]+b.z*c.m[9];d.z=b.x*c.m[2]+b.y*c.m[6]+b.z*c.m[10]},n.TransformNormalFromFloatsToRef=
function(b,c,d,g,e){e.x=b*g.m[0]+c*g.m[4]+d*g.m[8];e.y=b*g.m[1]+c*g.m[5]+d*g.m[9];e.z=b*g.m[2]+c*g.m[6]+d*g.m[10]},n.CatmullRom=function(b,c,d,g,e){var l=e*e,j=e*l;return new n(0.5*(2*c.x+(-b.x+d.x)*e+(2*b.x-5*c.x+4*d.x-g.x)*l+(-b.x+3*c.x-3*d.x+g.x)*j),0.5*(2*c.y+(-b.y+d.y)*e+(2*b.y-5*c.y+4*d.y-g.y)*l+(-b.y+3*c.y-3*d.y+g.y)*j),0.5*(2*c.z+(-b.z+d.z)*e+(2*b.z-5*c.z+4*d.z-g.z)*l+(-b.z+3*c.z-3*d.z+g.z)*j))},n.Clamp=function(b,c,d){var g=b.x,g=g>d.x?d.x:g,g=g<c.x?c.x:g,e=b.y,e=e>d.y?d.y:e,e=e<c.y?c.y:
e;b=b.z;return b=b>d.z?d.z:b,b=b<c.z?c.z:b,new n(g,e,b)},n.Hermite=function(b,c,d,g,e){var l=e*e,j=e*l,m=2*j-3*l+1,f=-2*j+3*l;e=j-2*l+e;l=j-l;return new n(b.x*m+d.x*f+c.x*e+g.x*l,b.y*m+d.y*f+c.y*e+g.y*l,b.z*m+d.z*f+c.z*e+g.z*l)},n.Lerp=function(b,c,d){return new n(b.x+(c.x-b.x)*d,b.y+(c.y-b.y)*d,b.z+(c.z-b.z)*d)},n.Dot=function(b,c){return b.x*c.x+b.y*c.y+b.z*c.z},n.Cross=function(b,c){var d=n.Zero();return n.CrossToRef(b,c,d),d},n.CrossToRef=function(b,c,d){P.Vector3[0].x=b.y*c.z-b.z*c.y;P.Vector3[0].y=
b.z*c.x-b.x*c.z;P.Vector3[0].z=b.x*c.y-b.y*c.x;d.copyFrom(P.Vector3[0])},n.Normalize=function(b){var c=n.Zero();return n.NormalizeToRef(b,c),c},n.NormalizeToRef=function(b,c){c.copyFrom(b);c.normalize()},n.Project=function(b,c,d,g){var e=g.width,l=g.height;g=x.FromValues(e/2,0,0,0,0,-l/2,0,0,0,0,1,0,g.x+e/2,l/2+g.y,0,1);c=c.multiply(d).multiply(g);return n.TransformCoordinates(b,c)},n.UnprojectFromTransform=function(b,c,d,g,e){g=g.multiply(e);g.invert();b.x=2*(b.x/c)-1;b.y=-(2*(b.y/d)-1);c=n.TransformCoordinates(b,
g);b=b.x*g.m[3]+b.y*g.m[7]+b.z*g.m[11]+g.m[15];return f.WithinEpsilon(b,1)&&(c=c.scale(1/b)),c},n.Unproject=function(b,c,d,g,e,l){g=g.multiply(e).multiply(l);g.invert();c=new n(2*(b.x/c)-1,-(2*(b.y/d)-1),b.z);b=n.TransformCoordinates(c,g);c=c.x*g.m[3]+c.y*g.m[7]+c.z*g.m[11]+g.m[15];return f.WithinEpsilon(c,1)&&(b=b.scale(1/c)),b},n.Minimize=function(b,c){var d=b.clone();return d.MinimizeInPlace(c),d},n.Maximize=function(b,c){var d=b.clone();return d.MaximizeInPlace(c),d},n.Distance=function(b,c){return Math.sqrt(n.DistanceSquared(b,
c))},n.DistanceSquared=function(b,c){var d=b.x-c.x,g=b.y-c.y,e=b.z-c.z;return d*d+g*g+e*e},n.Center=function(b,c){var d=b.add(c);return d.scaleInPlace(0.5),d},n.RotationFromAxis=function(b,c,d){var g=n.Zero();return n.RotationFromAxisToRef(b,c,d,g),g},n.RotationFromAxisToRef=function(c,d,g,e){var l=c.normalize();g=g.normalize();c=D.X;d=D.Y;var j=0,m=0,p=0,q=m=0,r=0,s=0,j=-1,t=0,x=P.Vector3[0],u=0,y=P.Vector3[1];f.WithinEpsilon(g.z,0,b.Epsilon)?r=1:f.WithinEpsilon(g.x,0,b.Epsilon)?m=1:(s=g.z/g.x,m=
-s*Math.sqrt(1/(1+s*s)),r=Math.sqrt(1/(1+s*s)));y.x=m;y.y=q;y.z=r;y.normalize();n.CrossToRef(l,y,x);x.normalize();0>n.Dot(g,x)&&(j=1);u=n.Dot(l,y);u=Math.min(1,Math.max(-1,u));p=Math.acos(u)*j;0>n.Dot(y,c)&&(p=Math.PI+p,y=y.scaleInPlace(-1),t++);u=P.Vector3[2];l=P.Vector3[3];r=q=0;j=-1;f.WithinEpsilon(g.z,0,b.Epsilon)?m=1:(s=y.z/y.x,m=-s*Math.sqrt(1/(1+s*s)),r=Math.sqrt(1/(1+s*s)));u.x=m;u.y=q;u.z=r;u.normalize();n.CrossToRef(u,y,l);l.normalize();n.CrossToRef(g,u,x);x.normalize();0>n.Dot(y,x)&&(j=
1);u=n.Dot(g,u);u=Math.min(1,Math.max(-1,u));m=Math.acos(u)*j;0>n.Dot(l,d)&&(m=Math.PI+m,t++);j=-1;n.CrossToRef(c,y,x);x.normalize();0>n.Dot(x,d)&&(j=1);u=n.Dot(y,c);u=Math.min(1,Math.max(-1,u));j*=-Math.acos(u);0>u&&2>t&&(j=Math.PI+j);e.x=m;e.y=j;e.z=p},n);b.Vector3=l;var q,p=function(b,c,d,g){this.x=b;this.y=c;this.z=d;this.w=g};q=(p.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"W:"+this.w+"}"},p.prototype.getClassName=function(){return"Vector4"},p.prototype.getHashCode=
function(){var b=this.x||0;return b=397*b^(this.y||0),b=397*b^(this.z||0),397*b^(this.w||0)},p.prototype.asArray=function(){var b=[];return this.toArray(b,0),b},p.prototype.toArray=function(b,c){return void 0===c&&(c=0),b[c]=this.x,b[c+1]=this.y,b[c+2]=this.z,b[c+3]=this.w,this},p.prototype.addInPlace=function(b){return this.x+=b.x,this.y+=b.y,this.z+=b.z,this.w+=b.w,this},p.prototype.add=function(b){return new p(this.x+b.x,this.y+b.y,this.z+b.z,this.w+b.w)},p.prototype.addToRef=function(b,c){return c.x=
this.x+b.x,c.y=this.y+b.y,c.z=this.z+b.z,c.w=this.w+b.w,this},p.prototype.subtractInPlace=function(b){return this.x-=b.x,this.y-=b.y,this.z-=b.z,this.w-=b.w,this},p.prototype.subtract=function(b){return new p(this.x-b.x,this.y-b.y,this.z-b.z,this.w-b.w)},p.prototype.subtractToRef=function(b,c){return c.x=this.x-b.x,c.y=this.y-b.y,c.z=this.z-b.z,c.w=this.w-b.w,this},p.prototype.subtractFromFloats=function(b,c,d,g){return new p(this.x-b,this.y-c,this.z-d,this.w-g)},p.prototype.subtractFromFloatsToRef=
function(b,c,d,g,e){return e.x=this.x-b,e.y=this.y-c,e.z=this.z-d,e.w=this.w-g,this},p.prototype.negate=function(){return new p(-this.x,-this.y,-this.z,-this.w)},p.prototype.scaleInPlace=function(b){return this.x*=b,this.y*=b,this.z*=b,this.w*=b,this},p.prototype.scale=function(b){return new p(this.x*b,this.y*b,this.z*b,this.w*b)},p.prototype.scaleToRef=function(b,c){c.x=this.x*b;c.y=this.y*b;c.z=this.z*b;c.w=this.w*b},p.prototype.equals=function(b){return b&&this.x===b.x&&this.y===b.y&&this.z===
b.z&&this.w===b.w},p.prototype.equalsWithEpsilon=function(c,d){return void 0===d&&(d=b.Epsilon),c&&f.WithinEpsilon(this.x,c.x,d)&&f.WithinEpsilon(this.y,c.y,d)&&f.WithinEpsilon(this.z,c.z,d)&&f.WithinEpsilon(this.w,c.w,d)},p.prototype.equalsToFloats=function(b,c,d,g){return this.x===b&&this.y===c&&this.z===d&&this.w===g},p.prototype.multiplyInPlace=function(b){return this.x*=b.x,this.y*=b.y,this.z*=b.z,this.w*=b.w,this},p.prototype.multiply=function(b){return new p(this.x*b.x,this.y*b.y,this.z*b.z,
this.w*b.w)},p.prototype.multiplyToRef=function(b,c){return c.x=this.x*b.x,c.y=this.y*b.y,c.z=this.z*b.z,c.w=this.w*b.w,this},p.prototype.multiplyByFloats=function(b,c,d,g){return new p(this.x*b,this.y*c,this.z*d,this.w*g)},p.prototype.divide=function(b){return new p(this.x/b.x,this.y/b.y,this.z/b.z,this.w/b.w)},p.prototype.divideToRef=function(b,c){return c.x=this.x/b.x,c.y=this.y/b.y,c.z=this.z/b.z,c.w=this.w/b.w,this},p.prototype.MinimizeInPlace=function(b){return b.x<this.x&&(this.x=b.x),b.y<
this.y&&(this.y=b.y),b.z<this.z&&(this.z=b.z),b.w<this.w&&(this.w=b.w),this},p.prototype.MaximizeInPlace=function(b){return b.x>this.x&&(this.x=b.x),b.y>this.y&&(this.y=b.y),b.z>this.z&&(this.z=b.z),b.w>this.w&&(this.w=b.w),this},p.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},p.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},p.prototype.normalize=function(){var b=this.length();if(0===b)return this;
b=1/b;return this.x*=b,this.y*=b,this.z*=b,this.w*=b,this},p.prototype.toVector3=function(){return new l(this.x,this.y,this.z)},p.prototype.clone=function(){return new p(this.x,this.y,this.z,this.w)},p.prototype.copyFrom=function(b){return this.x=b.x,this.y=b.y,this.z=b.z,this.w=b.w,this},p.prototype.copyFromFloats=function(b,c,d,g){return this.x=b,this.y=c,this.z=d,this.w=g,this},p.FromArray=function(b,c){return c||(c=0),new p(b[c],b[c+1],b[c+2],b[c+3])},p.FromArrayToRef=function(b,c,d){d.x=b[c];
d.y=b[c+1];d.z=b[c+2];d.w=b[c+3]},p.FromFloatArrayToRef=function(b,c,d){d.x=b[c];d.y=b[c+1];d.z=b[c+2];d.w=b[c+3]},p.FromFloatsToRef=function(b,c,d,g,e){e.x=b;e.y=c;e.z=d;e.w=g},p.Zero=function(){return new p(0,0,0,0)},p.Normalize=function(b){var c=p.Zero();return p.NormalizeToRef(b,c),c},p.NormalizeToRef=function(b,c){c.copyFrom(b);c.normalize()},p.Minimize=function(b,c){var d=b.clone();return d.MinimizeInPlace(c),d},p.Maximize=function(b,c){var d=b.clone();return d.MaximizeInPlace(c),d},p.Distance=
function(b,c){return Math.sqrt(p.DistanceSquared(b,c))},p.DistanceSquared=function(b,c){var d=b.x-c.x,g=b.y-c.y,e=b.z-c.z,l=b.w-c.w;return d*d+g*g+e*e+l*l},p.Center=function(b,c){var d=b.add(c);return d.scaleInPlace(0.5),d},p);b.Vector4=q;var r,t=function(b,c){this.width=b;this.height=c};r=(t.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},t.prototype.getClassName=function(){return"Size"},t.prototype.getHashCode=function(){return 397*(this.width||0)^(this.height||0)},
t.prototype.copyFrom=function(b){this.width=b.width;this.height=b.height},t.prototype.clone=function(){return new t(this.width,this.height)},t.prototype.equals=function(b){return b?this.width===b.width&&this.height===b.height:!1},Object.defineProperty(t.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),t.Zero=function(){return new t(0,0)},t.prototype.add=function(b){return new t(this.width+b.width,this.height+b.height)},t.prototype.substract=function(b){return new t(this.width-
b.width,this.height-b.height)},t.Lerp=function(b,c,d){return new t(b.width+(c.width-b.width)*d,b.height+(c.height-b.height)*d)},t);b.Size=r;var s,u=function(b,c,d,g){void 0===b&&(b=0);void 0===c&&(c=0);void 0===d&&(d=0);void 0===g&&(g=1);this.x=b;this.y=c;this.z=d;this.w=g};s=(u.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},u.prototype.getClassName=function(){return"Quaternion"},u.prototype.getHashCode=function(){var b=this.x||0;return b=397*b^(this.y||
0),b=397*b^(this.z||0),397*b^(this.w||0)},u.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},u.prototype.equals=function(b){return b&&this.x===b.x&&this.y===b.y&&this.z===b.z&&this.w===b.w},u.prototype.clone=function(){return new u(this.x,this.y,this.z,this.w)},u.prototype.copyFrom=function(b){return this.x=b.x,this.y=b.y,this.z=b.z,this.w=b.w,this},u.prototype.copyFromFloats=function(b,c,d,g){return this.x=b,this.y=c,this.z=d,this.w=g,this},u.prototype.add=function(b){return new u(this.x+
b.x,this.y+b.y,this.z+b.z,this.w+b.w)},u.prototype.subtract=function(b){return new u(this.x-b.x,this.y-b.y,this.z-b.z,this.w-b.w)},u.prototype.scale=function(b){return new u(this.x*b,this.y*b,this.z*b,this.w*b)},u.prototype.multiply=function(b){var c=new u(0,0,0,1);return this.multiplyToRef(b,c),c},u.prototype.multiplyToRef=function(b,c){return c.copyFromFloats(this.x*b.w+this.y*b.z-this.z*b.y+this.w*b.x,-this.x*b.z+this.y*b.w+this.z*b.x+this.w*b.y,this.x*b.y-this.y*b.x+this.z*b.w+this.w*b.z,-this.x*
b.x-this.y*b.y-this.z*b.z+this.w*b.w),this},u.prototype.multiplyInPlace=function(b){return this.multiplyToRef(b,this),this},u.prototype.conjugateToRef=function(b){return b.copyFromFloats(-this.x,-this.y,-this.z,this.w),this},u.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},u.prototype.conjugate=function(){return new u(-this.x,-this.y,-this.z,this.w)},u.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},u.prototype.normalize=
function(){var b=1/this.length();return this.x*=b,this.y*=b,this.z*=b,this.w*=b,this},u.prototype.toEulerAngles=function(b){void 0===b&&(b="YZX");var c=l.Zero();return this.toEulerAnglesToRef(c,b),c},u.prototype.toEulerAnglesToRef=function(b,c){void 0===c&&(c="YZX");var d,g,e,l=this.x,j=this.y,m=this.z,f=this.w;switch(c){case "YZX":var n=l*j+m*f;if(0.499<n&&(d=2*Math.atan2(l,f),g=Math.PI/2,e=0),-0.499>n&&(d=-2*Math.atan2(l,f),g=-Math.PI/2,e=0),isNaN(d)){e=l*l;var p=m*m;d=Math.atan2(2*j*f-2*l*m,1-
2*j*j-2*p);g=Math.asin(2*n);e=Math.atan2(2*l*f-2*j*m,1-2*e-2*p)}break;default:throw Error("Euler order "+c+" not supported yet.");}return b.y=d,b.z=g,b.x=e,this},u.prototype.toRotationMatrix=function(b){var c=this.x*this.x,d=this.y*this.y,g=this.z*this.z,e=this.x*this.y,l=this.z*this.w,j=this.z*this.x,m=this.y*this.w,f=this.y*this.z,n=this.x*this.w;return b.m[0]=1-2*(d+g),b.m[1]=2*(e+l),b.m[2]=2*(j-m),b.m[3]=0,b.m[4]=2*(e-l),b.m[5]=1-2*(g+c),b.m[6]=2*(f+n),b.m[7]=0,b.m[8]=2*(j+m),b.m[9]=2*(f-n),b.m[10]=
1-2*(d+c),b.m[11]=0,b.m[12]=0,b.m[13]=0,b.m[14]=0,b.m[15]=1,this},u.prototype.fromRotationMatrix=function(b){return u.FromRotationMatrixToRef(b,this),this},u.FromRotationMatrix=function(b){var c=new u;return u.FromRotationMatrixToRef(b,c),c},u.FromRotationMatrixToRef=function(b,c){var d,g=b.m,e=g[0],l=g[4],j=g[8],m=g[1],f=g[5],n=g[9],p=g[2],q=g[6],g=g[10],r=e+f+g;0<r?(d=0.5/Math.sqrt(r+1),c.w=0.25/d,c.x=(q-n)*d,c.y=(j-p)*d,c.z=(m-l)*d):e>f&&e>g?(d=2*Math.sqrt(1+e-f-g),c.w=(q-n)/d,c.x=0.25*d,c.y=(l+
m)/d,c.z=(j+p)/d):f>g?(d=2*Math.sqrt(1+f-e-g),c.w=(j-p)/d,c.x=(l+m)/d,c.y=0.25*d,c.z=(n+q)/d):(d=2*Math.sqrt(1+g-e-f),c.w=(m-l)/d,c.x=(j+p)/d,c.y=(n+q)/d,c.z=0.25*d)},u.Inverse=function(b){return new u(-b.x,-b.y,-b.z,b.w)},u.Identity=function(){return new u(0,0,0,1)},u.RotationAxis=function(b,c){var d=new u,g=Math.sin(c/2);return b.normalize(),d.w=Math.cos(c/2),d.x=b.x*g,d.y=b.y*g,d.z=b.z*g,d},u.FromArray=function(b,c){return c||(c=0),new u(b[c],b[c+1],b[c+2],b[c+3])},u.RotationYawPitchRoll=function(b,
c,d){var g=new u;return u.RotationYawPitchRollToRef(b,c,d,g),g},u.RotationYawPitchRollToRef=function(b,c,d,g){d*=0.5;var e=0.5*c;c=0.5*b;b=Math.sin(d);d=Math.cos(d);var l=Math.sin(e),e=Math.cos(e),j=Math.sin(c);c=Math.cos(c);g.x=c*l*d+j*e*b;g.y=j*e*d-c*l*b;g.z=c*e*b-j*l*d;g.w=c*e*d+j*l*b},u.RotationAlphaBetaGamma=function(b,c,d){var g=new u;return u.RotationAlphaBetaGammaToRef(b,c,d,g),g},u.RotationAlphaBetaGammaToRef=function(b,c,d,g){var e=0.5*(d+b);b=0.5*(d-b);c*=0.5;g.x=Math.cos(b)*Math.sin(c);
g.y=Math.sin(b)*Math.sin(c);g.z=Math.sin(e)*Math.cos(c);g.w=Math.cos(e)*Math.cos(c)},u.Slerp=function(b,c,d){var g;g=b.x*c.x+b.y*c.y+b.z*c.z+b.w*c.w;var e=!1;if(0>g&&(e=!0,g=-g),0.999999<g)g=1-d,d=e?-d:d;else{var l=Math.acos(g),j=1/Math.sin(l);g=Math.sin((1-d)*l)*j;d=e?-Math.sin(d*l)*j:Math.sin(d*l)*j}return new u(g*b.x+d*c.x,g*b.y+d*c.y,g*b.z+d*c.z,g*b.w+d*c.w)},u);b.Quaternion=s;var x,y=function(){this.m=new Float32Array(16)};x=(y.prototype.isIdentity=function(){return 1!==this.m[0]||1!==this.m[5]||
1!==this.m[10]||1!==this.m[15]?!1:0===this.m[1]&&0===this.m[2]&&0===this.m[3]&&0===this.m[4]&&0===this.m[6]&&0===this.m[7]&&0===this.m[8]&&0===this.m[9]&&0===this.m[11]&&0===this.m[12]&&0===this.m[13]&&0===this.m[14]},y.prototype.determinant=function(){var b=this.m[10]*this.m[15]-this.m[11]*this.m[14],c=this.m[9]*this.m[15]-this.m[11]*this.m[13],d=this.m[9]*this.m[14]-this.m[10]*this.m[13],g=this.m[8]*this.m[15]-this.m[11]*this.m[12],e=this.m[8]*this.m[14]-this.m[10]*this.m[12],l=this.m[8]*this.m[13]-
this.m[9]*this.m[12];return this.m[0]*(this.m[5]*b-this.m[6]*c+this.m[7]*d)-this.m[1]*(this.m[4]*b-this.m[6]*g+this.m[7]*e)+this.m[2]*(this.m[4]*c-this.m[5]*g+this.m[7]*l)-this.m[3]*(this.m[4]*d-this.m[5]*e+this.m[6]*l)},y.prototype.toArray=function(){return this.m},y.prototype.asArray=function(){return this.toArray()},y.prototype.invert=function(){return this.invertToRef(this),this},y.prototype.reset=function(){for(var b=0;16>b;b++)this.m[b]=0;return this},y.prototype.add=function(b){var c=new y;
return this.addToRef(b,c),c},y.prototype.addToRef=function(b,c){for(var d=0;16>d;d++)c.m[d]=this.m[d]+b.m[d];return this},y.prototype.addToSelf=function(b){for(var c=0;16>c;c++)this.m[c]+=b.m[c];return this},y.prototype.invertToRef=function(b){var c=this.m[0],d=this.m[1],g=this.m[2],e=this.m[3],l=this.m[4],j=this.m[5],m=this.m[6],f=this.m[7],n=this.m[8],p=this.m[9],q=this.m[10],r=this.m[11],s=this.m[12],t=this.m[13],x=this.m[14],u=this.m[15],y=q*u-r*x,z=p*u-r*t,A=p*x-q*t,B=n*u-r*s,C=n*x-q*s,D=n*t-
p*s,E=j*y-m*z+f*A,F=-(l*y-m*B+f*C),H=l*z-j*B+f*D,I=-(l*A-j*C+m*D),G=1/(c*E+d*F+g*H+e*I),J=m*u-f*x,L=j*u-f*t,N=j*x-m*t,u=l*u-f*s,x=l*x-m*s,s=l*t-j*s,t=m*r-f*q,R=j*r-f*p,P=j*q-m*p,f=l*r-f*n,m=l*q-m*n,l=l*p-j*n;return b.m[0]=E*G,b.m[4]=F*G,b.m[8]=H*G,b.m[12]=I*G,b.m[1]=-(d*y-g*z+e*A)*G,b.m[5]=(c*y-g*B+e*C)*G,b.m[9]=-(c*z-d*B+e*D)*G,b.m[13]=(c*A-d*C+g*D)*G,b.m[2]=(d*J-g*L+e*N)*G,b.m[6]=-(c*J-g*u+e*x)*G,b.m[10]=(c*L-d*u+e*s)*G,b.m[14]=-(c*N-d*x+g*s)*G,b.m[3]=-(d*t-g*R+e*P)*G,b.m[7]=(c*t-g*f+e*m)*G,b.m[11]=
-(c*R-d*f+e*l)*G,b.m[15]=(c*P-d*m+g*l)*G,this},y.prototype.setTranslation=function(b){return this.m[12]=b.x,this.m[13]=b.y,this.m[14]=b.z,this},y.prototype.getTranslation=function(){return new l(this.m[12],this.m[13],this.m[14])},y.prototype.multiply=function(b){var c=new y;return this.multiplyToRef(b,c),c},y.prototype.copyFrom=function(b){for(var c=0;16>c;c++)this.m[c]=b.m[c];return this},y.prototype.copyToArray=function(b,c){void 0===c&&(c=0);for(var d=0;16>d;d++)b[c+d]=this.m[d];return this},y.prototype.multiplyToRef=
function(b,c){return this.multiplyToArray(b,c.m,0),this},y.prototype.multiplyToArray=function(b,c,d){var g=this.m[0],e=this.m[1],l=this.m[2],j=this.m[3],m=this.m[4],f=this.m[5],n=this.m[6],p=this.m[7],q=this.m[8],r=this.m[9],s=this.m[10],t=this.m[11],x=this.m[12],u=this.m[13],y=this.m[14],z=this.m[15],A=b.m[0],B=b.m[1],C=b.m[2],D=b.m[3],E=b.m[4],F=b.m[5],H=b.m[6],I=b.m[7],G=b.m[8],J=b.m[9],L=b.m[10],N=b.m[11],R=b.m[12],P=b.m[13],Lb=b.m[14];b=b.m[15];return c[d]=g*A+e*E+l*G+j*R,c[d+1]=g*B+e*F+l*J+
j*P,c[d+2]=g*C+e*H+l*L+j*Lb,c[d+3]=g*D+e*I+l*N+j*b,c[d+4]=m*A+f*E+n*G+p*R,c[d+5]=m*B+f*F+n*J+p*P,c[d+6]=m*C+f*H+n*L+p*Lb,c[d+7]=m*D+f*I+n*N+p*b,c[d+8]=q*A+r*E+s*G+t*R,c[d+9]=q*B+r*F+s*J+t*P,c[d+10]=q*C+r*H+s*L+t*Lb,c[d+11]=q*D+r*I+s*N+t*b,c[d+12]=x*A+u*E+y*G+z*R,c[d+13]=x*B+u*F+y*J+z*P,c[d+14]=x*C+u*H+y*L+z*Lb,c[d+15]=x*D+u*I+y*N+z*b,this},y.prototype.equals=function(b){return b&&this.m[0]===b.m[0]&&this.m[1]===b.m[1]&&this.m[2]===b.m[2]&&this.m[3]===b.m[3]&&this.m[4]===b.m[4]&&this.m[5]===b.m[5]&&
this.m[6]===b.m[6]&&this.m[7]===b.m[7]&&this.m[8]===b.m[8]&&this.m[9]===b.m[9]&&this.m[10]===b.m[10]&&this.m[11]===b.m[11]&&this.m[12]===b.m[12]&&this.m[13]===b.m[13]&&this.m[14]===b.m[14]&&this.m[15]===b.m[15]},y.prototype.clone=function(){return y.FromValues(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5],this.m[6],this.m[7],this.m[8],this.m[9],this.m[10],this.m[11],this.m[12],this.m[13],this.m[14],this.m[15])},y.prototype.getClassName=function(){return"Matrix"},y.prototype.getHashCode=
function(){for(var b=this.m[0]||0,c=1;16>c;c++)b=397*b^(this.m[c]||0);return b},y.prototype.decompose=function(b,c,d){d.x=this.m[12];d.y=this.m[13];d.z=this.m[14];d=0>f.Sign(this.m[0]*this.m[1]*this.m[2]*this.m[3])?-1:1;var g=0>f.Sign(this.m[4]*this.m[5]*this.m[6]*this.m[7])?-1:1,e=0>f.Sign(this.m[8]*this.m[9]*this.m[10]*this.m[11])?-1:1;if(b.x=d*Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),b.y=g*Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),b.z=
e*Math.sqrt(this.m[8]*this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),0===b.x||0===b.y||0===b.z)return c.x=0,c.y=0,c.z=0,c.w=1,!1;b=y.FromValues(this.m[0]/b.x,this.m[1]/b.x,this.m[2]/b.x,0,this.m[4]/b.y,this.m[5]/b.y,this.m[6]/b.y,0,this.m[8]/b.z,this.m[9]/b.z,this.m[10]/b.z,0,0,0,0,1);return s.FromRotationMatrixToRef(b,c),!0},y.FromArray=function(b,c){var d=new y;return c||(c=0),y.FromArrayToRef(b,c,d),d},y.FromArrayToRef=function(b,c,d){for(var g=0;16>g;g++)d.m[g]=b[g+c]},y.FromFloat32ArrayToRefScaled=
function(b,c,d,g){for(var e=0;16>e;e++)g.m[e]=b[e+c]*d},y.FromValuesToRef=function(b,c,d,g,e,l,j,m,f,n,p,q,r,s,t,x,u){u.m[0]=b;u.m[1]=c;u.m[2]=d;u.m[3]=g;u.m[4]=e;u.m[5]=l;u.m[6]=j;u.m[7]=m;u.m[8]=f;u.m[9]=n;u.m[10]=p;u.m[11]=q;u.m[12]=r;u.m[13]=s;u.m[14]=t;u.m[15]=x},y.prototype.getRow=function(b){if(0>b||3<b)return null;b*=4;return new q(this.m[b+0],this.m[b+1],this.m[b+2],this.m[b+3])},y.prototype.setRow=function(b,c){if(0>b||3<b)return this;var d=4*b;return this.m[d+0]=c.x,this.m[d+1]=c.y,this.m[d+
2]=c.z,this.m[d+3]=c.w,this},y.FromValues=function(b,c,d,g,e,l,j,m,f,n,p,q,r,s,t,x){var u=new y;return u.m[0]=b,u.m[1]=c,u.m[2]=d,u.m[3]=g,u.m[4]=e,u.m[5]=l,u.m[6]=j,u.m[7]=m,u.m[8]=f,u.m[9]=n,u.m[10]=p,u.m[11]=q,u.m[12]=r,u.m[13]=s,u.m[14]=t,u.m[15]=x,u},y.Compose=function(b,c,d){b=y.FromValues(b.x,0,0,0,0,b.y,0,0,0,0,b.z,0,0,0,0,1);var g=y.Identity();return c.toRotationMatrix(g),b=b.multiply(g),b.setTranslation(d),b},y.Identity=function(){return y.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},y.IdentityToRef=
function(b){y.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,b)},y.Zero=function(){return y.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},y.RotationX=function(b){var c=new y;return y.RotationXToRef(b,c),c},y.Invert=function(b){var c=new y;return b.invertToRef(c),c},y.RotationXToRef=function(b,c){var d=Math.sin(b),g=Math.cos(b);c.m[0]=1;c.m[15]=1;c.m[5]=g;c.m[10]=g;c.m[9]=-d;c.m[6]=d;c.m[1]=0;c.m[2]=0;c.m[3]=0;c.m[4]=0;c.m[7]=0;c.m[8]=0;c.m[11]=0;c.m[12]=0;c.m[13]=0;c.m[14]=0},y.RotationY=function(b){var c=
new y;return y.RotationYToRef(b,c),c},y.RotationYToRef=function(b,c){var d=Math.sin(b),g=Math.cos(b);c.m[5]=1;c.m[15]=1;c.m[0]=g;c.m[2]=-d;c.m[8]=d;c.m[10]=g;c.m[1]=0;c.m[3]=0;c.m[4]=0;c.m[6]=0;c.m[7]=0;c.m[9]=0;c.m[11]=0;c.m[12]=0;c.m[13]=0;c.m[14]=0},y.RotationZ=function(b){var c=new y;return y.RotationZToRef(b,c),c},y.RotationZToRef=function(b,c){var d=Math.sin(b),g=Math.cos(b);c.m[10]=1;c.m[15]=1;c.m[0]=g;c.m[1]=d;c.m[4]=-d;c.m[5]=g;c.m[2]=0;c.m[3]=0;c.m[6]=0;c.m[7]=0;c.m[8]=0;c.m[9]=0;c.m[11]=
0;c.m[12]=0;c.m[13]=0;c.m[14]=0},y.RotationAxis=function(b,c){var d=y.Zero();return y.RotationAxisToRef(b,c,d),d},y.RotationAxisToRef=function(b,c,d){var g=Math.sin(-c);c=Math.cos(-c);var e=1-c;b.normalize();d.m[0]=b.x*b.x*e+c;d.m[1]=b.x*b.y*e-b.z*g;d.m[2]=b.x*b.z*e+b.y*g;d.m[3]=0;d.m[4]=b.y*b.x*e+b.z*g;d.m[5]=b.y*b.y*e+c;d.m[6]=b.y*b.z*e-b.x*g;d.m[7]=0;d.m[8]=b.z*b.x*e-b.y*g;d.m[9]=b.z*b.y*e+b.x*g;d.m[10]=b.z*b.z*e+c;d.m[11]=0;d.m[15]=1},y.RotationYawPitchRoll=function(b,c,d){var g=new y;return y.RotationYawPitchRollToRef(b,
c,d,g),g},y.RotationYawPitchRollToRef=function(b,c,d,g){s.RotationYawPitchRollToRef(b,c,d,this._tempQuaternion);this._tempQuaternion.toRotationMatrix(g)},y.Scaling=function(b,c,d){var g=y.Zero();return y.ScalingToRef(b,c,d,g),g},y.ScalingToRef=function(b,c,d,g){g.m[0]=b;g.m[1]=0;g.m[2]=0;g.m[3]=0;g.m[4]=0;g.m[5]=c;g.m[6]=0;g.m[7]=0;g.m[8]=0;g.m[9]=0;g.m[10]=d;g.m[11]=0;g.m[12]=0;g.m[13]=0;g.m[14]=0;g.m[15]=1},y.Translation=function(b,c,d){var g=y.Identity();return y.TranslationToRef(b,c,d,g),g},y.TranslationToRef=
function(b,c,d,g){y.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,b,c,d,1,g)},y.Lerp=function(b,c,d){for(var g=y.Zero(),e=0;16>e;e++)g.m[e]=b.m[e]*(1-d)+c.m[e]*d;return g},y.DecomposeLerp=function(b,c,d){var g=new l(0,0,0),e=new s,j=new l(0,0,0);b.decompose(g,e,j);var m=new l(0,0,0),f=new s;b=new l(0,0,0);c.decompose(m,f,b);c=l.Lerp(g,m,d);e=s.Slerp(e,f,d);d=l.Lerp(j,b,d);return y.Compose(c,e,d)},y.LookAtLH=function(b,c,d){var g=y.Zero();return y.LookAtLHToRef(b,c,d,g),g},y.LookAtLHToRef=function(b,c,d,
g){c.subtractToRef(b,this._zAxis);this._zAxis.normalize();l.CrossToRef(d,this._zAxis,this._xAxis);0===this._xAxis.lengthSquared()?this._xAxis.x=1:this._xAxis.normalize();l.CrossToRef(this._zAxis,this._xAxis,this._yAxis);this._yAxis.normalize();c=-l.Dot(this._xAxis,b);d=-l.Dot(this._yAxis,b);b=-l.Dot(this._zAxis,b);return y.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,c,d,b,1,g)},y.OrthoLH=function(b,
c,d,g){var e=y.Zero();return y.OrthoLHToRef(b,c,d,g,e),e},y.OrthoLHToRef=function(b,c,d,g,e){y.FromValuesToRef(2/b,0,0,0,0,2/c,0,0,0,0,1/(g-d),0,0,0,d/(d-g),1,e)},y.OrthoOffCenterLH=function(b,c,d,g,e,l){var j=y.Zero();return y.OrthoOffCenterLHToRef(b,c,d,g,e,l,j),j},y.OrthoOffCenterLHToRef=function(b,c,d,g,e,l,j){j.m[0]=2/(c-b);j.m[1]=j.m[2]=j.m[3]=0;j.m[5]=2/(g-d);j.m[4]=j.m[6]=j.m[7]=0;j.m[10]=-1/(e-l);j.m[8]=j.m[9]=j.m[11]=0;j.m[12]=(b+c)/(b-c);j.m[13]=(g+d)/(d-g);j.m[14]=e/(e-l);j.m[15]=1},y.PerspectiveLH=
function(b,c,d,g){var e=y.Zero();return e.m[0]=2*d/b,e.m[1]=e.m[2]=e.m[3]=0,e.m[5]=2*d/c,e.m[4]=e.m[6]=e.m[7]=0,e.m[10]=-g/(d-g),e.m[8]=e.m[9]=0,e.m[11]=1,e.m[12]=e.m[13]=e.m[15]=0,e.m[14]=d*g/(d-g),e},y.PerspectiveFovLH=function(b,c,d,g){var e=y.Zero();return y.PerspectiveFovLHToRef(b,c,d,g,e),e},y.PerspectiveFovLHToRef=function(b,c,d,g,e,l){void 0===l&&(l=!0);b=1/Math.tan(0.5*b);l?e.m[0]=b/c:e.m[0]=b;e.m[1]=e.m[2]=e.m[3]=0;l?e.m[5]=b:e.m[5]=b*c;e.m[4]=e.m[6]=e.m[7]=0;e.m[8]=e.m[9]=0;e.m[10]=-g/
(d-g);e.m[11]=1;e.m[12]=e.m[13]=e.m[15]=0;e.m[14]=d*g/(d-g)},y.GetFinalMatrix=function(b,c,d,g,e,l){var j=b.width,m=b.height;b=y.FromValues(j/2,0,0,0,0,-m/2,0,0,0,0,l-e,0,b.x+j/2,m/2+b.y,e,1);return c.multiply(d).multiply(g).multiply(b)},y.GetAsMatrix2x2=function(b){return new Float32Array([b.m[0],b.m[1],b.m[4],b.m[5]])},y.GetAsMatrix3x3=function(b){return new Float32Array([b.m[0],b.m[1],b.m[2],b.m[4],b.m[5],b.m[6],b.m[8],b.m[9],b.m[10]])},y.Transpose=function(b){var c=new y;return c.m[0]=b.m[0],
c.m[1]=b.m[4],c.m[2]=b.m[8],c.m[3]=b.m[12],c.m[4]=b.m[1],c.m[5]=b.m[5],c.m[6]=b.m[9],c.m[7]=b.m[13],c.m[8]=b.m[2],c.m[9]=b.m[6],c.m[10]=b.m[10],c.m[11]=b.m[14],c.m[12]=b.m[3],c.m[13]=b.m[7],c.m[14]=b.m[11],c.m[15]=b.m[15],c},y.Reflection=function(b){var c=new y;return y.ReflectionToRef(b,c),c},y.ReflectionToRef=function(b,c){b.normalize();var d=b.normal.x,g=b.normal.y,e=b.normal.z,l=-2*d,j=-2*g,m=-2*e;c.m[0]=l*d+1;c.m[1]=j*d;c.m[2]=m*d;c.m[3]=0;c.m[4]=l*g;c.m[5]=j*g+1;c.m[6]=m*g;c.m[7]=0;c.m[8]=l*
e;c.m[9]=j*e;c.m[10]=m*e+1;c.m[11]=0;c.m[12]=l*b.d;c.m[13]=j*b.d;c.m[14]=m*b.d;c.m[15]=1},y._tempQuaternion=new s,y._xAxis=l.Zero(),y._yAxis=l.Zero(),y._zAxis=l.Zero(),y);b.Matrix=x;var z,A=function(b,c,d,g){this.normal=new l(b,c,d);this.d=g};z=(A.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},A.prototype.clone=function(){return new A(this.normal.x,this.normal.y,this.normal.z,this.d)},A.prototype.getClassName=function(){return"Plane"},A.prototype.getHashCode=
function(){return 397*this.normal.getHashCode()^(this.d||0)},A.prototype.normalize=function(){var b=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),c=0;return 0!==b&&(c=1/b),this.normal.x*=c,this.normal.y*=c,this.normal.z*=c,this.d*=c,this},A.prototype.transform=function(b){b=x.Transpose(b);var c=this.normal.x,d=this.normal.y,g=this.normal.z,e=this.d;return new A(c*b.m[0]+d*b.m[1]+g*b.m[2]+e*b.m[3],c*b.m[4]+d*b.m[5]+g*b.m[6]+e*b.m[7],c*b.m[8]+d*b.m[9]+
g*b.m[10]+e*b.m[11],c*b.m[12]+d*b.m[13]+g*b.m[14]+e*b.m[15])},A.prototype.dotCoordinate=function(b){return this.normal.x*b.x+this.normal.y*b.y+this.normal.z*b.z+this.d},A.prototype.copyFromPoints=function(b,c,d){var g,e=c.x-b.x,l=c.y-b.y,j=c.z-b.z;c=d.x-b.x;var m=d.y-b.y,f=d.z-b.z;d=l*f-j*m;j=j*c-e*f;e=e*m-l*c;l=Math.sqrt(d*d+j*j+e*e);return g=0!==l?1/l:0,this.normal.x=d*g,this.normal.y=j*g,this.normal.z=e*g,this.d=-(this.normal.x*b.x+this.normal.y*b.y+this.normal.z*b.z),this},A.prototype.isFrontFacingTo=
function(b,c){var d=l.Dot(this.normal,b);return c>=d},A.prototype.signedDistanceTo=function(b){return l.Dot(b,this.normal)+this.d},A.FromArray=function(b){return new A(b[0],b[1],b[2],b[3])},A.FromPoints=function(b,c,d){var g=new A(0,0,0,0);return g.copyFromPoints(b,c,d),g},A.FromPositionAndNormal=function(b,c){var d=new A(0,0,0,0);return c.normalize(),d.normal=c,d.d=-(c.x*b.x+c.y*b.y+c.z*b.z),d},A.SignedDistanceToPlaneFromPositionAndNormal=function(b,c,d){b=-(c.x*b.x+c.y*b.y+c.z*b.z);return l.Dot(d,
c)+b},A);b.Plane=z;var B=function(b,c,d,g){this.x=b;this.y=c;this.width=d;this.height=g};r=(B.prototype.toGlobal=function(b,c){return new B(this.x*b,this.y*c,this.width*b,this.height*c)},B);b.Viewport=r;var C=function(){};r=(C.GetPlanes=function(b){for(var c=[],d=0;6>d;d++)c.push(new z(0,0,0,0));return C.GetPlanesToRef(b,c),c},C.GetPlanesToRef=function(b,c){c[0].normal.x=b.m[3]+b.m[2];c[0].normal.y=b.m[7]+b.m[6];c[0].normal.z=b.m[11]+b.m[10];c[0].d=b.m[15]+b.m[14];c[0].normalize();c[1].normal.x=b.m[3]-
b.m[2];c[1].normal.y=b.m[7]-b.m[6];c[1].normal.z=b.m[11]-b.m[10];c[1].d=b.m[15]-b.m[14];c[1].normalize();c[2].normal.x=b.m[3]+b.m[0];c[2].normal.y=b.m[7]+b.m[4];c[2].normal.z=b.m[11]+b.m[8];c[2].d=b.m[15]+b.m[12];c[2].normalize();c[3].normal.x=b.m[3]-b.m[0];c[3].normal.y=b.m[7]-b.m[4];c[3].normal.z=b.m[11]-b.m[8];c[3].d=b.m[15]-b.m[12];c[3].normalize();c[4].normal.x=b.m[3]-b.m[1];c[4].normal.y=b.m[7]-b.m[5];c[4].normal.z=b.m[11]-b.m[9];c[4].d=b.m[15]-b.m[13];c[4].normalize();c[5].normal.x=b.m[3]+
b.m[1];c[5].normal.y=b.m[7]+b.m[5];c[5].normal.z=b.m[11]+b.m[9];c[5].d=b.m[15]+b.m[13];c[5].normalize()},C);b.Frustum=r;r=b.Space||(b.Space={});r[r.LOCAL=0]="LOCAL";r[r.WORLD=1]="WORLD";b.Space;r=function(){};var D=(r.X=new l(1,0,0),r.Y=new l(0,1,0),r.Z=new l(0,0,1),r);b.Axis=D;r=function(){};r=(r.interpolate=function(b,c,d,g,e){var l=1-3*g+3*c;g=3*g-6*c;c*=3;for(var j=b,m=0;5>m;m++)var f=j*j,j=j-(l*f*j+g*f+c*j-b)*(1/(3*l*f+2*g*j+c)),j=Math.min(1,Math.max(0,j));return 3*Math.pow(1-j,2)*j*d+3*(1-j)*
Math.pow(j,2)*e+Math.pow(j,3)},r);b.BezierCurve=r;r=b.Orientation||(b.Orientation={});r[r.CW=0]="CW";r[r.CCW=1]="CCW";var E=b.Orientation,I,H=function(b){var c=this;this.degrees=function(){return 180*c._radians/Math.PI};this.radians=function(){return c._radians};this._radians=b;0>this._radians&&(this._radians+=2*Math.PI)};I=(H.BetweenTwoPoints=function(b,c){var d=c.subtract(b),d=Math.atan2(d.y,d.x);return new H(d)},H.FromRadians=function(b){return new H(b)},H.FromDegrees=function(b){return new H(b*
Math.PI/180)},H);b.Angle=I;var F;F=function(b,c,d){this.startPoint=b;this.midPoint=c;this.endPoint=d;var g=Math.pow(c.x,2)+Math.pow(c.y,2),e=(Math.pow(b.x,2)+Math.pow(b.y,2)-g)/2,g=(g-Math.pow(d.x,2)-Math.pow(d.y,2))/2,l=(b.x-c.x)*(c.y-d.y)-(c.x-d.x)*(b.y-c.y);this.centerPoint=new m((e*(c.y-d.y)-g*(b.y-c.y))/l,((b.x-c.x)*g-(c.x-d.x)*e)/l);this.radius=this.centerPoint.subtract(this.startPoint).length();this.startAngle=I.BetweenTwoPoints(this.centerPoint,this.startPoint);b=this.startAngle.degrees();
c=I.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees();d=I.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();180<c-b&&(c-=360);-180>c-b&&(c+=360);180<d-c&&(d-=360);-180>d-c&&(d+=360);this.orientation=0>c-b?E.CW:E.CCW;this.angle=I.FromDegrees(this.orientation===E.CW?b-d:d-b)};b.Arc2=F;var J=function(b,c){this._points=[];this._length=0;this.closed=!1;this._points.push(new m(b,c))};r=(J.prototype.addLineTo=function(b,c){if(closed)return this;var d=new m(b,c),g=this._points[this._points.length-
1];return this._points.push(d),this._length+=d.subtract(g).length(),this},J.prototype.addArcTo=function(b,c,d,g,e){if(void 0===e&&(e=36),closed)return this;var l=this._points[this._points.length-1];b=new m(b,c);d=new m(d,g);l=new F(l,b,d);d=l.angle.radians()/e;l.orientation===E.CW&&(d*=-1);g=l.startAngle.radians()+d;for(b=0;e>b;b++){c=Math.cos(g)*l.radius+l.centerPoint.x;var j=Math.sin(g)*l.radius+l.centerPoint.y;this.addLineTo(c,j);g+=d}return this},J.prototype.close=function(){return this.closed=
!0,this},J.prototype.length=function(){var b=this._length;this.closed||(b+=this._points[0].subtract(this._points[this._points.length-1]).length());return b},J.prototype.getPoints=function(){return this._points},J.prototype.getPointAtLengthPosition=function(b){if(0>b||1<b)return m.Zero();for(var c=b*this.length(),d=0,g=0;g<this._points.length;g++){b=this._points[g];var e=this._points[(g+1)%this._points.length].subtract(b),l=e.length()+d;if(c>=d&&l>=c)return g=e.normalize(),c-=d,new m(b.x+g.x*c,b.y+
g.y*c);d=l}return m.Zero()},J.StartingAt=function(b,c){return new J(b,c)},J);b.Path2=r;r=function(b,c,d){this.path=b;this._curve=[];this._distances=[];this._tangents=[];this._normals=[];this._binormals=[];for(var g=0;g<b.length;g++)this._curve[g]=b[g].clone();this._raw=d||!1;this._compute(c)};r=(r.prototype.getCurve=function(){return this._curve},r.prototype.getTangents=function(){return this._tangents},r.prototype.getNormals=function(){return this._normals},r.prototype.getBinormals=function(){return this._binormals},
r.prototype.getDistances=function(){return this._distances},r.prototype.update=function(b,c){for(var d=0;d<b.length;d++)this._curve[d].x=b[d].x,this._curve[d].y=b[d].y,this._curve[d].z=b[d].z;return this._compute(c),this},r.prototype._compute=function(b){var c=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0);this._raw||this._tangents[0].normalize();this._tangents[c-1]=this._curve[c-1].subtract(this._curve[c-2]);this._raw||this._tangents[c-1].normalize();var d=this._tangents[0];
b=this._normalVector(this._curve[0],d,b);this._normals[0]=b;this._raw||this._normals[0].normalize();this._binormals[0]=l.Cross(d,this._normals[0]);this._raw||this._binormals[0].normalize();this._distances[0]=0;for(var g,e,d=1;c>d;d++)b=this._getLastNonNullVector(d),c-1>d&&(g=this._getFirstNonNullVector(d),this._tangents[d]=b.add(g),this._tangents[d].normalize()),this._distances[d]=this._distances[d-1]+b.length(),b=this._tangents[d],e=this._binormals[d-1],this._normals[d]=l.Cross(e,b),this._raw||this._normals[d].normalize(),
this._binormals[d]=l.Cross(b,this._normals[d]),this._raw||this._binormals[d].normalize()},r.prototype._getFirstNonNullVector=function(b){for(var c=1,d=this._curve[b+c].subtract(this._curve[b]);0===d.length()&&b+c+1<this._curve.length;)c++,d=this._curve[b+c].subtract(this._curve[b]);return d},r.prototype._getLastNonNullVector=function(b){for(var c=1,d=this._curve[b].subtract(this._curve[b-c]);0===d.length()&&b>c+1;)c++,d=this._curve[b].subtract(this._curve[b-c]);return d},r.prototype._normalVector=
function(c,d,g){if(void 0===g||null===g){var e;f.WithinEpsilon(d.y,1,b.Epsilon)?f.WithinEpsilon(d.x,1,b.Epsilon)?f.WithinEpsilon(d.z,1,b.Epsilon)||(e=new l(0,0,1)):e=new l(1,0,0):e=new l(0,-1,0);c=l.Cross(d,e)}else c=l.Cross(d,g),l.CrossToRef(c,d,c);return c.normalize(),c},r);b.Path3D=r;var G=function(b){this._length=0;this._points=b;this._length=this._computeLength(b)};r=(G.CreateQuadraticBezier=function(b,c,d,g){g=2<g?g:3;for(var e=[],j=0;g>=j;j++)e.push(new l((1-j/g)*(1-j/g)*b.x+2*(j/g)*(1-j/g)*
c.x+j/g*(j/g)*d.x,(1-j/g)*(1-j/g)*b.y+2*(j/g)*(1-j/g)*c.y+j/g*(j/g)*d.y,(1-j/g)*(1-j/g)*b.z+2*(j/g)*(1-j/g)*c.z+j/g*(j/g)*d.z));return new G(e)},G.CreateCubicBezier=function(b,c,d,g,e){e=3<e?e:4;for(var j=[],m=function(b,c,d,g,e){return(1-b)*(1-b)*(1-b)*c+3*b*(1-b)*(1-b)*d+3*b*b*(1-b)*g+b*b*b*e},f=0;e>=f;f++)j.push(new l(m(f/e,b.x,c.x,d.x,g.x),m(f/e,b.y,c.y,d.y,g.y),m(f/e,b.z,c.z,d.z,g.z)));return new G(j)},G.CreateHermiteSpline=function(b,c,d,g,e){for(var j=[],m=1/e,f=0;e>=f;f++)j.push(l.Hermite(b,
c,d,g,f*m));return new G(j)},G.prototype.getPoints=function(){return this._points},G.prototype.length=function(){return this._length},G.prototype["continue"]=function(b){var c=this._points[this._points.length-1],d=this._points.slice();b=b.getPoints();for(var g=1;g<b.length;g++)d.push(b[g].subtract(b[0]).add(c));return new G(d)},G.prototype._computeLength=function(b){for(var c=0,d=1;d<b.length;d++)c+=b[d].subtract(b[d-1]).length();return c},G);b.Curve3=r;r=function(){this.L00=l.Zero();this.L1_1=l.Zero();
this.L10=l.Zero();this.L11=l.Zero();this.L2_2=l.Zero();this.L2_1=l.Zero();this.L20=l.Zero();this.L21=l.Zero();this.L22=l.Zero()};r=(r.prototype.addLight=function(b,c,d){c=(new l(c.r,c.g,c.b)).scale(d);this.L00=this.L00.add(c.scale(0.282095));this.L1_1=this.L1_1.add(c.scale(0.488603*b.y));this.L10=this.L10.add(c.scale(0.488603*b.z));this.L11=this.L11.add(c.scale(0.488603*b.x));this.L2_2=this.L2_2.add(c.scale(1.092548*b.x*b.y));this.L2_1=this.L2_1.add(c.scale(1.092548*b.y*b.z));this.L21=this.L21.add(c.scale(1.092548*
b.x*b.z));this.L20=this.L20.add(c.scale(0.315392*(3*b.z*b.z-1)));this.L22=this.L22.add(c.scale(0.546274*(b.x*b.x-b.y*b.y)))},r.prototype.scale=function(b){this.L00=this.L00.scale(b);this.L1_1=this.L1_1.scale(b);this.L10=this.L10.scale(b);this.L11=this.L11.scale(b);this.L2_2=this.L2_2.scale(b);this.L2_1=this.L2_1.scale(b);this.L20=this.L20.scale(b);this.L21=this.L21.scale(b);this.L22=this.L22.scale(b)},r);b.SphericalHarmonics=r;var L=function(){this.x=l.Zero();this.y=l.Zero();this.z=l.Zero();this.xx=
l.Zero();this.yy=l.Zero();this.zz=l.Zero();this.xy=l.Zero();this.yz=l.Zero();this.zx=l.Zero()};r=(L.prototype.addAmbient=function(b){b=new l(b.r,b.g,b.b);this.xx=this.xx.add(b);this.yy=this.yy.add(b);this.zz=this.zz.add(b)},L.getSphericalPolynomialFromHarmonics=function(b){var c=new L;return c.x=b.L11.scale(1.02333),c.y=b.L1_1.scale(1.02333),c.z=b.L10.scale(1.02333),c.xx=b.L00.scale(0.886277).subtract(b.L20.scale(0.247708)).add(b.L22.scale(0.429043)),c.yy=b.L00.scale(0.886277).subtract(b.L20.scale(0.247708)).subtract(b.L22.scale(0.429043)),
c.zz=b.L00.scale(0.886277).add(b.L20.scale(0.495417)),c.yz=b.L2_1.scale(0.858086),c.zx=b.L21.scale(0.858086),c.xy=b.L2_2.scale(0.858086),c},L);b.SphericalPolynomial=r;var N=function(b,c){void 0===b&&(b=l.Zero());void 0===c&&(c=l.Up());this.position=b;this.normal=c};r=(N.prototype.clone=function(){return new N(this.position.clone(),this.normal.clone())},N);b.PositionNormalVertex=r;var R=function(b,c,d){void 0===b&&(b=l.Zero());void 0===c&&(c=l.Up());void 0===d&&(d=m.Zero());this.position=b;this.normal=
c;this.uv=d};r=(R.prototype.clone=function(){return new R(this.position.clone(),this.normal.clone(),this.uv.clone())},R);b.PositionNormalTextureVertex=r;var P;r=function(){};P=(r.Color3=[e.Black(),e.Black(),e.Black()],r.Vector2=[m.Zero(),m.Zero(),m.Zero()],r.Vector3=[l.Zero(),l.Zero(),l.Zero(),l.Zero(),l.Zero(),l.Zero(),l.Zero(),l.Zero(),l.Zero()],r.Vector4=[q.Zero(),q.Zero(),q.Zero()],r.Quaternion=[new s(0,0,0,0)],r.Matrix=[x.Zero(),x.Zero(),x.Zero(),x.Zero(),x.Zero(),x.Zero(),x.Zero(),x.Zero()],
r);b.Tmp=P}(BABYLON||(BABYLON={}));
!function(b){function f(b,d){return function(g,e){g.__serializableMembers||(g.__serializableMembers={});g.__serializableMembers[e]={type:b,sourceName:d}}}b.serialize=function(b){return f(0,b)};b.serializeAsTexture=function(b){return f(1,b)};b.serializeAsColor3=function(b){return f(2,b)};b.serializeAsFresnelParameters=function(b){return f(3,b)};b.serializeAsVector2=function(b){return f(4,b)};b.serializeAsVector3=function(b){return f(5,b)};b.serializeAsMeshReference=function(b){return f(6,b)};b.serializeAsColorCurves=
function(b){return f(7,b)};var e;e=function(){};e=(e.Serialize=function(c,d){d||(d={});d.tags=b.Tags.GetTags(c);for(var g in c.__serializableMembers){var e=c.__serializableMembers[g],j=e.sourceName||g,e=e.type,l=c[g];if(void 0!==l&&null!==l)switch(e){case 0:d[j]=l;break;case 1:d[j]=l.serialize();break;case 2:d[j]=l.asArray();break;case 3:d[j]=l.serialize();break;case 4:d[j]=l.asArray();break;case 5:d[j]=l.asArray();break;case 6:d[j]=l.id;break;case 7:d[j]=l.serialize()}}return d},e.Parse=function(c,
d,g,e){c=c();b.Tags.AddTagsTo(c,d.tags);for(var j in c.__serializableMembers){var l=c.__serializableMembers[j],f=d[l.sourceName||j],l=l.type;if(void 0!==f&&null!==f)switch(l){case 0:c[j]=f;break;case 1:c[j]=b.Texture.Parse(f,g,e);break;case 2:c[j]=b.Color3.FromArray(f);break;case 3:c[j]=b.FresnelParameters.Parse(f);break;case 4:c[j]=b.Vector2.FromArray(f);break;case 5:c[j]=b.Vector3.FromArray(f);break;case 6:c[j]=g.getLastMeshByID(f);break;case 7:c[j]=b.ColorCurves.Parse(f)}}return c},e.Clone=function(c,
d){var g=c();b.Tags.AddTagsTo(g,d.tags);for(var e in g.__serializableMembers){var j=d[e],l=g.__serializableMembers[e].type;if(void 0!==j&&null!==j)switch(l){case 0:case 6:g[e]=j;break;case 1:case 2:case 3:case 4:case 5:case 7:g[e]=j.clone()}}return g},e);b.SerializationHelper=e}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(b,c){void 0===c&&(c=!1);this.mask=b;this.skipNextObservers=c};b.EventState=f;var e;e=function(b,c){this.callback=b;this.mask=c};b.Observer=e;var c,d=function(){this._observers=[]};c=(d.prototype.add=function(b,c,d){if(void 0===c&&(c=-1),void 0===d&&(d=!1),!b)return null;b=new e(b,c);return d?this._observers.unshift(b):this._observers.push(b),b},d.prototype.remove=function(b){b=this._observers.indexOf(b);return-1!==b?(this._observers.splice(b,1),!0):!1},d.prototype.removeCallback=
function(b){for(var c=0;c<this._observers.length;c++)if(this._observers[c].callback===b)return this._observers.splice(c,1),!0;return!1},d.prototype.notifyObservers=function(b,c){void 0===c&&(c=-1);for(var d=new f(c),e=0,n=this._observers;e<n.length;e++){var q=n[e];if(q.mask&c&&q.callback(b,d),d.skipNextObservers)break}},d.prototype.hasObservers=function(){return 0<this._observers.length},d.prototype.clear=function(){this._observers=[]},d.prototype.clone=function(){var b=new d;return b._observers=
this._observers.slice(0),b},d);b.Observable=c}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(b,d){this.idbFactory=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;this.callbackManifestChecked=d;this.currentSceneUrl=e.ReturnFullUrlLocation(b);this.db=null;this.enableTexturesOffline=this.enableSceneOffline=!1;this.manifestVersionFound=0;this.hasReachedQuota=this.mustUpdateRessources=!1;e.IDBStorageEnabled?this.checkManifestFile():this.callbackManifestChecked(!0)};f=(e.prototype.checkManifestFile=function(){function c(){g.enableSceneOffline=
!1;g.enableTexturesOffline=!1;g.callbackManifestChecked(!1)}var d=this,g=this,e=!1,j=this.currentSceneUrl+".manifest",l=new XMLHttpRequest;navigator.onLine&&(e=!0,j=j+(null==j.match(/\?/)?"?":"&")+(new Date).getTime());l.open("GET",j,!0);l.addEventListener("load",function(){if(200===l.status||b.Tools.ValidateXHRData(l,1))try{var g=JSON.parse(l.response);d.enableSceneOffline=g.enableSceneOffline;d.enableTexturesOffline=g.enableTexturesOffline;g.version&&!isNaN(parseInt(g.version))&&(d.manifestVersionFound=
g.version);d.callbackManifestChecked&&d.callbackManifestChecked(!0)}catch(e){c()}else c()},!1);l.addEventListener("error",function(){e?(e=!1,l.open("GET",d.currentSceneUrl+".manifest",!0),l.send()):c()},!1);try{l.send()}catch(f){b.Tools.Error("Error on XHR send request."),g.callbackManifestChecked(!1)}},e.prototype.openAsync=function(c,d){function g(){j.isSupported=!1;d&&d()}var e=this,j=this;if(this.idbFactory&&(this.enableSceneOffline||this.enableTexturesOffline))if(this.db)c&&c();else{this.hasReachedQuota=
!1;this.isSupported=!0;var l=this.idbFactory.open("babylonjs",1);l.onerror=function(){g()};l.onblocked=function(){b.Tools.Error("IDB request blocked. Please reload the page.");g()};l.onsuccess=function(){e.db=l.result;c()};l.onupgradeneeded=function(c){e.db=c.target.result;try{e.db.createObjectStore("scenes",{keyPath:"sceneUrl"}),e.db.createObjectStore("versions",{keyPath:"sceneUrl"}),e.db.createObjectStore("textures",{keyPath:"textureUrl"})}catch(d){b.Tools.Error("Error while creating object stores. Exception: "+
d.message),g()}}}else this.isSupported=!1,d&&d()},e.prototype.loadImageFromDB=function(b,d){var g=this,f=e.ReturnFullUrlLocation(b),j=function(){g.hasReachedQuota||null===g.db?d.src=b:g._saveImageIntoDBAsync(f,d)};this.mustUpdateRessources?j():this._loadImageFromDBAsync(f,d,j)},e.prototype._loadImageFromDBAsync=function(c,d,g){if(this.isSupported&&null!==this.db){var e,j=this.db.transaction(["textures"]);j.onabort=function(){d.src=c};j.oncomplete=function(){var l;e?(l=(window.URL||window.webkitURL).createObjectURL(e.data,
{oneTimeOnly:!0}),d.onerror=function(){b.Tools.Error("Error loading image from blob URL: "+l+" switching back to web url: "+c);d.src=c},d.src=l):g()};j=j.objectStore("textures").get(c);j.onsuccess=function(b){e=b.target.result};j.onerror=function(){b.Tools.Error("Error loading texture "+c+" from DB.");d.src=c}}else b.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),d.src=c},e.prototype._saveImageIntoDBAsync=function(c,d){var g=this;if(this.isSupported){var f=
function(){var b;if(j){var c=window.URL||window.webkitURL;try{b=c.createObjectURL(j,{oneTimeOnly:!0})}catch(g){b=c.createObjectURL(j)}}d.src=b};if(e.IsUASupportingBlobStorage){var j,l=new XMLHttpRequest;l.open("GET",c,!0);l.responseType="blob";l.addEventListener("load",function(){if(200===l.status){j=l.response;var b=g.db.transaction(["textures"],"readwrite");b.onabort=function(b){try{b.srcElement.error&&"QuotaExceededError"===b.srcElement.error.name&&(this.hasReachedQuota=!0)}catch(c){}f()};b.oncomplete=
function(){f()};var q={textureUrl:c,data:j};try{var p=b.objectStore("textures").put(q);p.onsuccess=function(){};p.onerror=function(){f()}}catch(r){25===r.code&&(e.IsUASupportingBlobStorage=!1),d.src=c}}else d.src=c},!1);l.addEventListener("error",function(){b.Tools.Error("Error in XHR request in BABYLON.Database.");d.src=c},!1);l.send()}else d.src=c}else b.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),d.src=c},e.prototype._checkVersionFromDB=function(b,
d){var g=this;this._loadVersionFromDBAsync(b,d,function(){g._saveVersionIntoDBAsync(b,d)})},e.prototype._loadVersionFromDBAsync=function(c,d,g){var e=this;if(this.isSupported){var j;try{var l=this.db.transaction(["versions"]);l.oncomplete=function(){j?e.manifestVersionFound>j.data?(e.mustUpdateRessources=!0,g()):d(j.data):(e.mustUpdateRessources=!0,g())};l.onabort=function(){d(-1)};var f=l.objectStore("versions").get(c);f.onsuccess=function(b){j=b.target.result};f.onerror=function(){b.Tools.Error("Error loading version for scene "+
c+" from DB.");d(-1)}}catch(q){b.Tools.Error("Error while accessing 'versions' object store (READ OP). Exception: "+q.message),d(-1)}}else b.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),d(-1)},e.prototype._saveVersionIntoDBAsync=function(c,d){var g=this;if(this.isSupported&&!this.hasReachedQuota)try{var e=this.db.transaction(["versions"],"readwrite");e.onabort=function(b){try{b.srcElement.error&&"QuotaExceededError"===b.srcElement.error.name&&(g.hasReachedQuota=
!0)}catch(c){}d(-1)};e.oncomplete=function(){d(g.manifestVersionFound)};var j={sceneUrl:c,data:this.manifestVersionFound},l=e.objectStore("versions").put(j);l.onsuccess=function(){};l.onerror=function(){b.Tools.Error("Error in DB add version request in BABYLON.Database.")}}catch(f){b.Tools.Error("Error while accessing 'versions' object store (WRITE OP). Exception: "+f.message),d(-1)}else d(-1)},e.prototype.loadFileFromDB=function(b,d,g,f,j){var l=this,n=e.ReturnFullUrlLocation(b),q=function(){l._saveFileIntoDBAsync(n,
d,g)};this._checkVersionFromDB(n,function(b){-1!==b?l.mustUpdateRessources?l._saveFileIntoDBAsync(n,d,g,j):l._loadFileFromDBAsync(n,d,q,j):f()})},e.prototype._loadFileFromDBAsync=function(c,d,g){if(this.isSupported){var e;e=-1!==c.indexOf(".babylon")?"scenes":"textures";var j,l=this.db.transaction([e]);l.oncomplete=function(){j?d(j.data):g()};l.onabort=function(){g()};e=l.objectStore(e).get(c);e.onsuccess=function(b){j=b.target.result};e.onerror=function(){b.Tools.Error("Error loading file "+c+" from DB.");
g()}}else b.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),d()},e.prototype._saveFileIntoDBAsync=function(c,d,g,e){var j=this;if(this.isSupported){var l;l=-1!==c.indexOf(".babylon")?"scenes":"textures";var f,q=new XMLHttpRequest;q.open("GET",c,!0);e&&(q.responseType="arraybuffer");q.onprogress=g;q.addEventListener("load",function(){if(200===q.status||b.Tools.ValidateXHRData(q,e?6:1))if(f=e?q.response:q.responseText,j.hasReachedQuota)d(f);else{var g=
j.db.transaction([l],"readwrite");g.onabort=function(b){try{b.srcElement.error&&"QuotaExceededError"===b.srcElement.error.name&&(this.hasReachedQuota=!0)}catch(c){}d(f)};g.oncomplete=function(){d(f)};var r;r="scenes"===l?{sceneUrl:c,data:f,version:j.manifestVersionFound}:{textureUrl:c,data:f};try{var t=g.objectStore(l).put(r);t.onsuccess=function(){};t.onerror=function(){b.Tools.Error("Error in DB add file request in BABYLON.Database.")}}catch(s){d(f)}}else d()},!1);q.addEventListener("error",function(){b.Tools.Error("error on XHR request.");
d()},!1);q.send()}else b.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),d()},e.IsUASupportingBlobStorage=!0,e.IDBStorageEnabled=!0,e.parseURL=function(b){document.createElement("a").href=b;var d=b.substring(0,b.lastIndexOf("#")),d=b.substring(d.lastIndexOf("/")+1,b.length);return b.substring(0,b.indexOf(d,0))},e.ReturnFullUrlLocation=function(b){return-1===b.indexOf("http:/")?e.parseURL(window.location.href)+b:b},e);b.Database=f}(BABYLON||(BABYLON=
{}));
!function(b){var f=b.Internals||(b.Internals={}),e,c=function(){};e=(c.GetTGAHeader=function(b){var c=0;return{id_length:b[c++],colormap_type:b[c++],image_type:b[c++],colormap_index:b[c++]|b[c++]<<8,colormap_length:b[c++]|b[c++]<<8,colormap_size:b[c++],origin:[b[c++]|b[c++]<<8,b[c++]|b[c++]<<8],width:b[c++]|b[c++]<<8,height:b[c++]|b[c++]<<8,pixel_size:b[c++],flags:b[c++]}},c.UploadContent=function(d,g){if(19>g.length)return void b.Tools.Error("Unable to load TGA file - Not enough data to contain header");var e=
18,j=c.GetTGAHeader(g);if(j.id_length+e>g.length)return void b.Tools.Error("Unable to load TGA file - Not enough data");var e=e+j.id_length,l=!1,f=!1,q=!1;switch(j.image_type){case c._TYPE_RLE_INDEXED:l=!0;case c._TYPE_INDEXED:f=!0;break;case c._TYPE_RLE_RGB:l=!0;case c._TYPE_RGB:break;case c._TYPE_RLE_GREY:l=!0;case c._TYPE_GREY:q=!0}var p,r=(15&j.flags,j.pixel_size>>3),t=j.width*j.height*r;if(f&&(p=g.subarray(e,e+=j.colormap_length*(j.colormap_size>>3))),l)for(var l=new Uint8Array(t),s,u,x=0,y=
new Uint8Array(r);t>e&&t>x;)if(s=g[e++],f=(127&s)+1,128&s){for(u=0;r>u;++u)y[u]=g[e++];for(u=0;f>u;++u)l.set(y,x+u*r);x+=r*f}else{f*=r;for(u=0;f>u;++u)l[x+u]=g[e++];x+=f}else l=g.subarray(e,e+(f?j.width*j.height:t));switch((j.flags&c._ORIGIN_MASK)>>c._ORIGIN_SHIFT){default:case c._ORIGIN_UL:e=0;t=1;u=j.width;r=0;s=1;f=j.height;break;case c._ORIGIN_BL:e=0;t=1;u=j.width;r=j.height-1;f=s=-1;break;case c._ORIGIN_UR:e=j.width-1;u=t=-1;r=0;s=1;f=j.height;break;case c._ORIGIN_BR:e=j.width-1,u=t=-1,r=j.height-
1,f=s=-1}q=c["_getImageData"+(q?"Grey":"")+j.pixel_size+"bits"](j,p,l,r,s,f,e,t,u);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,j.width,j.height,0,d.RGBA,d.UNSIGNED_BYTE,q)},c._getImageData8bits=function(b,c,e,j,l,f,q,p,r){var t,s,u=b.width,x=0;b=new Uint8Array(4*u*b.height);for(s=j;s!==f;s+=l)for(t=q;t!==r;t+=p,x++)j=e[x],b[4*(t+u*s)+3]=255,b[4*(t+u*s)+2]=c[3*j+0],b[4*(t+u*s)+1]=c[3*j+1],b[4*(t+u*s)+0]=c[3*j+2];return b},c._getImageData16bits=function(b,c,e,j,l,f,q,p,r){var t,s;c=b.width;var u=0;b=new Uint8Array(4*
c*b.height);for(s=j;s!==f;s+=l)for(t=q;t!==r;t+=p,u+=2)j=e[u+0]+(e[u+1]<<8),b[4*(t+c*s)+0]=(31744&j)>>7,b[4*(t+c*s)+1]=(992&j)>>2,b[4*(t+c*s)+2]=(31&j)>>3,b[4*(t+c*s)+3]=32768&j?0:255;return b},c._getImageData24bits=function(b,c,e,j,l,f,q,p,r){var t;c=b.width;var s=0;b=new Uint8Array(4*c*b.height);for(t=j;t!==f;t+=l)for(j=q;j!==r;j+=p,s+=3)b[4*(j+c*t)+3]=255,b[4*(j+c*t)+2]=e[s+0],b[4*(j+c*t)+1]=e[s+1],b[4*(j+c*t)+0]=e[s+2];return b},c._getImageData32bits=function(b,c,e,j,l,f,q,p,r){var t;c=b.width;
var s=0;b=new Uint8Array(4*c*b.height);for(t=j;t!==f;t+=l)for(j=q;j!==r;j+=p,s+=4)b[4*(j+c*t)+2]=e[s+0],b[4*(j+c*t)+1]=e[s+1],b[4*(j+c*t)+0]=e[s+2],b[4*(j+c*t)+3]=e[s+3];return b},c._getImageDataGrey8bits=function(b,c,e,j,l,f,q,p,r){var t,s;c=b.width;var u=0;b=new Uint8Array(4*c*b.height);for(s=j;s!==f;s+=l)for(t=q;t!==r;t+=p,u++)j=e[u],b[4*(t+c*s)+0]=j,b[4*(t+c*s)+1]=j,b[4*(t+c*s)+2]=j,b[4*(t+c*s)+3]=255;return b},c._getImageDataGrey16bits=function(b,c,e,j,l,f,q,p,r){var t;c=b.width;var s=0;b=new Uint8Array(4*
c*b.height);for(t=j;t!==f;t+=l)for(j=q;j!==r;j+=p,s+=2)b[4*(j+c*t)+0]=e[s+0],b[4*(j+c*t)+1]=e[s+0],b[4*(j+c*t)+2]=e[s+0],b[4*(j+c*t)+3]=e[s+1];return b},c._TYPE_NO_DATA=0,c._TYPE_INDEXED=1,c._TYPE_RGB=2,c._TYPE_GREY=3,c._TYPE_RLE_INDEXED=9,c._TYPE_RLE_RGB=10,c._TYPE_RLE_GREY=11,c._ORIGIN_MASK=48,c._ORIGIN_SHIFT=4,c._ORIGIN_BL=0,c._ORIGIN_BR=1,c._ORIGIN_UL=2,c._ORIGIN_UR=3,c);f.TGATools=e;!0}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(b){this._duplicateId=this.length=0;this.data=Array(b);this._id=e._GlobalId++};f=(e.prototype.push=function(b){this.data[this.length++]=b;this.length>this.data.length&&(this.data.length*=2);b.__smartArrayFlags||(b.__smartArrayFlags={});b.__smartArrayFlags[this._id]=this._duplicateId},e.prototype.pushNoDuplicate=function(b){return b.__smartArrayFlags&&b.__smartArrayFlags[this._id]===this._duplicateId?!1:(this.push(b),!0)},e.prototype.sort=function(b){this.data.sort(b)},
e.prototype.reset=function(){this.length=0;this._duplicateId++},e.prototype.concat=function(b){if(0!==b.length){this.length+b.length>this.data.length&&(this.data.length=2*(this.length+b.length));for(var d=0;d<b.length;d++)this.data[this.length++]=(b.data||b)[d]}},e.prototype.concatWithNoDuplicate=function(b){if(0!==b.length){this.length+b.length>this.data.length&&(this.data.length=2*(this.length+b.length));for(var d=0;d<b.length;d++)this.pushNoDuplicate((b.data||b)[d])}},e.prototype.indexOf=function(b){b=
this.data.indexOf(b);return b>=this.length?-1:b},e._GlobalId=0,e);b.SmartArray=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(){this._count=0;this._data={}};f=(f.prototype.get=function(b){b=this._data[b];return void 0!==b?b:void 0},f.prototype.getOrAddWithFactory=function(b,c){var d=this.get(b);return void 0!==d?d:(d=c(b),d&&this.add(b,d),d)},f.prototype.getOrAdd=function(b,c){var d=this.get(b);return void 0!==d?d:(this.add(b,c),c)},f.prototype.contains=function(b){return void 0!==this._data[b]},f.prototype.add=function(b,c){return void 0!==this._data[b]?!1:(this._data[b]=c,++this._count,!0)},
f.prototype.set=function(b,c){return void 0===this._data[b]?!1:(this._data[b]=c,!0)},f.prototype.remove=function(b){return this.contains(b)?(delete this._data[b],--this._count,!0):!1},f.prototype.clear=function(){this._data={};this._count=0},Object.defineProperty(f.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),f.prototype.forEach=function(b){for(var c in this._data)b(c,this._data[c])},f.prototype.first=function(b){for(var c in this._data){var d=b(c,this._data[c]);
if(d)return d}return null},f);b.StringDictionary=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(c,d){return c?c instanceof b.Mesh?null:c instanceof b.SubMesh?c.clone(d):c.clone?c.clone():null:null},c,d=function(){};c=(d.Instantiate=function(b){b=b.split(".");for(var c=window||this,d=0,g=b.length;g>d;d++)c=c[b[d]];return"function"!=typeof c?null:c},d.SetImmediate=function(b){window.setImmediate?window.setImmediate(b):setTimeout(b,1)},d.IsExponentOfTwo=function(b){var c=1;do c*=2;while(b>c);return c===b},d.GetExponentOfTwo=function(b,c){var d=1;do d*=2;while(b>d);
return d>c&&(d=c),d},d.GetFilename=function(b){var c=b.lastIndexOf("/");return 0>c?b:b.substring(c+1)},d.GetDOMTextContent=function(b){var c="";for(b=b.firstChild;b;)3===b.nodeType&&(c+=b.textContent),b=b.nextSibling;return c},d.ToDegrees=function(b){return 180*b/Math.PI},d.ToRadians=function(b){return b*Math.PI/180},d.EncodeArrayBufferTobase64=function(b){for(var c,d,g,e,f,r="",t=0,s=new Uint8Array(b);t<s.length;)c=s[t++],b=t<s.length?s[t++]:Number.NaN,d=t<s.length?s[t++]:Number.NaN,g=c>>2,c=(3&
c)<<4|b>>4,e=(15&b)<<2|d>>6,f=63&d,isNaN(b)?e=f=64:isNaN(d)&&(f=64),r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f);return"data:image/png;base64,"+r},d.ExtractMinAndMaxIndexed=function(c,d,g,e,f){void 0===f&&(f=null);for(var p=new b.Vector3(Number.MAX_VALUE,
Number.MAX_VALUE,Number.MAX_VALUE),r=new b.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),t=g;g+e>t;t++)var s=new b.Vector3(c[3*d[t]],c[3*d[t]+1],c[3*d[t]+2]),p=b.Vector3.Minimize(s,p),r=b.Vector3.Maximize(s,r);return f&&(p.x-=p.x*f.x+f.y,p.y-=p.y*f.x+f.y,p.z-=p.z*f.x+f.y,r.x+=r.x*f.x+f.y,r.y+=r.y*f.x+f.y,r.z+=r.z*f.x+f.y),{minimum:p,maximum:r}},d.ExtractMinAndMax=function(c,d,g,e,f){void 0===e&&(e=null);var p=new b.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new b.Vector3(-Number.MAX_VALUE,
-Number.MAX_VALUE,-Number.MAX_VALUE);f||(f=3);for(var t=d;d+g>t;t++)var s=new b.Vector3(c[t*f],c[t*f+1],c[t*f+2]),p=b.Vector3.Minimize(s,p),r=b.Vector3.Maximize(s,r);return e&&(p.x-=p.x*e.x+e.y,p.y-=p.y*e.x+e.y,p.z-=p.z*e.x+e.y,r.x+=r.x*e.x+e.y,r.y+=r.y*e.x+e.y,r.z+=r.z*e.x+e.y),{minimum:p,maximum:r}},d.Vector2ArrayFeeder=function(c){return function(d){var g=void 0!==c.BYTES_PER_ELEMENT;return d>=(g?c.length/2:c.length)?null:g?new b.Vector2(c[2*d+0],c[2*d+1]):c[d]}},d.ExtractMinAndMaxVector2=function(c,
d){void 0===d&&(d=null);for(var g=new b.Vector2(Number.MAX_VALUE,Number.MAX_VALUE),e=new b.Vector2(-Number.MAX_VALUE,-Number.MAX_VALUE),f=0,p=c(f++);p;)g=b.Vector2.Minimize(p,g),e=b.Vector2.Maximize(p,e),p=c(f++);return d&&(g.x-=g.x*d.x+d.y,g.y-=g.y*d.x+d.y,e.x+=e.x*d.x+d.y,e.y+=e.y*d.x+d.y),{minimum:g,maximum:e}},d.MakeArray=function(b,c){return!0===c||void 0!==b&&null!=b?Array.isArray(b)?b:[b]:void 0},d.GetPointerPrefix=function(){return"pointer"},d.QueueNewFrame=function(b){window.requestAnimationFrame?
window.requestAnimationFrame(b):window.msRequestAnimationFrame?window.msRequestAnimationFrame(b):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(b):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(b):window.oRequestAnimationFrame?window.oRequestAnimationFrame(b):window.setTimeout(b,16)},d.RequestFullscreen=function(b,c){var d=b.requestFullscreen||b.msRequestFullscreen||b.webkitRequestFullscreen||b.mozRequestFullScreen;d&&d.call(b,c)},d.ExitFullscreen=function(){document.exitFullscreen?
document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msCancelFullScreen&&document.msCancelFullScreen()},d.CleanUrl=function(b){return b.replace(/#/gm,"%23")},d.LoadImage=function(c,g,e,f){c instanceof ArrayBuffer&&(c=d.EncodeArrayBufferTobase64(c));c=d.CleanUrl(c);var q=new Image;if("data:"!==c.substr(0,5)&&d.CorsBehavior)switch(typeof d.CorsBehavior){case "function":var p=d.CorsBehavior(c);
p&&(q.crossOrigin=p);break;default:q.crossOrigin=d.CorsBehavior}q.onload=function(){g(q)};q.onerror=function(){d.Error("Error while trying to load texture: "+c);d.UseFallbackTexture?(q.src="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z",
g(q)):e()};var p=function(){q.src=c},r=function(){f.loadImageFromDB(c,q)};if("data:"!==c.substr(0,5)&&f&&f.enableTexturesOffline&&b.Database.IsUASupportingBlobStorage)f.openAsync(r,p);else if(-1===c.indexOf("file:"))p();else try{var t,s=c.substring(5).toLowerCase();try{t=URL.createObjectURL(b.FilesInput.FilesTextures[s],{oneTimeOnly:!0})}catch(u){t=URL.createObjectURL(b.FilesInput.FilesTextures[s])}q.src=t}catch(x){q.src=null}return q},d.LoadFile=function(c,g,e,f,q,p){c=d.CleanUrl(c);var r=function(){var b=
new XMLHttpRequest,f=d.BaseUrl+c;b.open("GET",f,!0);q&&(b.responseType="arraybuffer");b.onprogress=e;b.onreadystatechange=function(){if(4===b.readyState)if(200===b.status||d.ValidateXHRData(b,q?6:1))g(q?b.response:b.responseText);else{if(!p)throw Error("Error status: "+b.status+" - Unable to load "+f);p()}};b.send(null)},t=function(){f.loadFileFromDB(c,g,e,r,q)};-1!==c.indexOf("file:")?(t=c.substring(5).toLowerCase(),d.ReadFile(b.FilesInput.FilesToLoad[t],g,e,q)):f&&f.enableSceneOffline?f.openAsync(t,
r):r()},d.ReadFileAsDataURL=function(b,c,d){var g=new FileReader;g.onload=function(b){c(b.target.result)};g.onprogress=d;g.readAsDataURL(b)},d.ReadFile=function(b,c,g,e){var f=new FileReader;f.onerror=function(){d.Log("Error while reading file: "+b.name);c(JSON.stringify({autoClear:!0,clearColor:[1,0,0],ambientColor:[0,0,0],gravity:[0,-9.807,0],meshes:[],cameras:[],lights:[]}))};f.onload=function(b){c(b.target.result)};f.onprogress=g;e?f.readAsArrayBuffer(b):f.readAsText(b)},d.FileAsURL=function(b){b=
new Blob([b]);return(window.URL||window.webkitURL).createObjectURL(b)},d.Format=function(b,c){return void 0===c&&(c=2),b.toFixed(c)},d.CheckExtends=function(b,c,d){b.x<c.x&&(c.x=b.x);b.y<c.y&&(c.y=b.y);b.z<c.z&&(c.z=b.z);b.x>d.x&&(d.x=b.x);b.y>d.y&&(d.y=b.y);b.z>d.z&&(d.z=b.z)},d.DeepCopy=function(b,c,d,g){for(var f in b)if(("_"!==f[0]||g&&-1!==g.indexOf(f))&&(!d||-1===d.indexOf(f))){var p=b[f],r=typeof p;if("function"!==r)if("object"===r)if(p instanceof Array){if(c[f]=[],0<p.length)if("object"==
typeof p[0])for(r=0;r<p.length;r++){var t=e(p[r],c);-1===c[f].indexOf(t)&&c[f].push(t)}else c[f]=p.slice(0)}else c[f]=e(p,c);else c[f]=p}},d.IsEmpty=function(b){for(var c in b)return!1;return!0},d.RegisterTopRootEvents=function(b){for(var c=0;c<b.length;c++){var d=b[c];window.addEventListener(d.name,d.handler,!1);try{window.parent&&window.parent.addEventListener(d.name,d.handler,!1)}catch(g){}}},d.UnregisterTopRootEvents=function(b){for(var c=0;c<b.length;c++){var d=b[c];window.removeEventListener(d.name,
d.handler);try{window.parent&&window.parent.removeEventListener(d.name,d.handler)}catch(g){}}},d.DumpFramebuffer=function(b,c,d,g){var e=4*b,p=c/2;d=d.readPixels(0,0,b,c);for(var r=0;p>r;r++)for(var t=0;e>t;t++){var s=t+r*e,u=t+(c-r-1)*e,x=d[s];d[s]=d[u];d[u]=x}f||(f=document.createElement("canvas"));f.width=b;f.height=c;e=f.getContext("2d");b=e.createImageData(b,c);b.data.set(d);e.putImageData(b,0,0);b=f.toDataURL();if(g)g(b);else if("download"in document.createElement("a")){var y=window.document.createElement("a");
y.href=b;g=new Date;g=(g.getFullYear()+"-"+(g.getMonth()+1)).slice(-2)+"-"+g.getDate()+"_"+g.getHours()+"-"+("0"+g.getMinutes()).slice(-2);y.setAttribute("download","screenshot_"+g+".png");window.document.body.appendChild(y);y.addEventListener("click",function(){y.parentElement.removeChild(y)});y.click()}else g=window.open(""),c=g.document.createElement("img"),c.src=b,g.document.body.appendChild(c)},d.CreateScreenshot=function(c,g,e,f){var q,p;if(e.precision)q=Math.round(c.getRenderWidth()*e.precision),
p=Math.round(q/c.getAspectRatio(g)),e={width:q,height:p};else if(e.width&&e.height)q=e.width,p=e.height;else if(e.width&&!e.height)q=e.width,p=Math.round(q/c.getAspectRatio(g)),e={width:q,height:p};else if(e.height&&!e.width)p=e.height,q=Math.round(p*c.getAspectRatio(g)),e={width:q,height:p};else{if(isNaN(e))return void d.Error("Invalid 'size' parameter !");q=p=e}var r=g.getScene(),t=null;r.activeCamera!==g&&(t=r.activeCamera,r.activeCamera=g);e=new b.RenderTargetTexture("screenShot",e,r,!1,!1);e.renderList=
r.meshes;e.onAfterRenderObservable.add(function(){d.DumpFramebuffer(q,p,c,f)});r.incrementRenderId();r.resetCachedMaterial();e.render(!0);e.dispose();t&&(r.activeCamera=t);g.getProjectionMatrix(!0)},d.ValidateXHRData=function(c,d){void 0===d&&(d=7);try{if(1&d){if(c.responseText&&0<c.responseText.length)return!0;if(1===d)return!1}if(2&d){var g=b.Internals.TGATools.GetTGAHeader(c.response);if(g.width&&g.height&&0<g.width&&0<g.height)return!0;if(2===d)return!1}if(4&d){var e=new Uint8Array(c.response,
0,3);return 68===e[0]&&68===e[1]&&83===e[2]}}catch(f){}return!1},Object.defineProperty(d,"NoneLogLevel",{get:function(){return d._NoneLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(d,"MessageLogLevel",{get:function(){return d._MessageLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(d,"WarningLogLevel",{get:function(){return d._WarningLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(d,"ErrorLogLevel",{get:function(){return d._ErrorLogLevel},enumerable:!0,
configurable:!0}),Object.defineProperty(d,"AllLogLevel",{get:function(){return d._MessageLogLevel|d._WarningLogLevel|d._ErrorLogLevel},enumerable:!0,configurable:!0}),d._AddLogEntry=function(b){d._LogCache=b+d._LogCache;d.OnNewCacheEntry&&d.OnNewCacheEntry(b)},d._FormatMessage=function(b){var c=function(b){return 10>b?"0"+b:""+b},d=new Date;return"["+c(d.getHours())+":"+c(d.getMinutes())+":"+c(d.getSeconds())+"]: "+b},d._LogDisabled=function(){},d._LogEnabled=function(b){b=d._FormatMessage(b);console.log("BJS - "+
b);d._AddLogEntry("<div style='color:white'>"+b+"</div><br>")},d._WarnDisabled=function(){},d._WarnEnabled=function(b){b=d._FormatMessage(b);console.warn("BJS - "+b);d._AddLogEntry("<div style='color:orange'>"+b+"</div><br>")},d._ErrorDisabled=function(){},d._ErrorEnabled=function(b){d.errorsCount++;b=d._FormatMessage(b);console.error("BJS - "+b);d._AddLogEntry("<div style='color:red'>"+b+"</div><br>")},Object.defineProperty(d,"LogCache",{get:function(){return d._LogCache},enumerable:!0,configurable:!0}),
d.ClearLogCache=function(){d._LogCache="";d.errorsCount=0},Object.defineProperty(d,"LogLevels",{set:function(b){(b&d.MessageLogLevel)===d.MessageLogLevel?d.Log=d._LogEnabled:d.Log=d._LogDisabled;(b&d.WarningLogLevel)===d.WarningLogLevel?d.Warn=d._WarnEnabled:d.Warn=d._WarnDisabled;(b&d.ErrorLogLevel)===d.ErrorLogLevel?d.Error=d._ErrorEnabled:d.Error=d._ErrorDisabled},enumerable:!0,configurable:!0}),Object.defineProperty(d,"PerformanceNoneLogLevel",{get:function(){return d._PerformanceNoneLogLevel},
enumerable:!0,configurable:!0}),Object.defineProperty(d,"PerformanceUserMarkLogLevel",{get:function(){return d._PerformanceUserMarkLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(d,"PerformanceConsoleLogLevel",{get:function(){return d._PerformanceConsoleLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(d,"PerformanceLogLevel",{set:function(b){return(b&d.PerformanceUserMarkLogLevel)===d.PerformanceUserMarkLogLevel?(d.StartPerformanceCounter=d._StartUserMark,void(d.EndPerformanceCounter=
d._EndUserMark)):(b&d.PerformanceConsoleLogLevel)===d.PerformanceConsoleLogLevel?(d.StartPerformanceCounter=d._StartPerformanceConsole,void(d.EndPerformanceCounter=d._EndPerformanceConsole)):(d.StartPerformanceCounter=d._StartPerformanceCounterDisabled,void(d.EndPerformanceCounter=d._EndPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),d._StartPerformanceCounterDisabled=function(){},d._EndPerformanceCounterDisabled=function(){},d._StartUserMark=function(b,c){void 0===c&&(c=!0);c&&d._performance.mark&&
d._performance.mark(b+"-Begin")},d._EndUserMark=function(b,c){void 0===c&&(c=!0);c&&d._performance.mark&&(d._performance.mark(b+"-End"),d._performance.measure(b,b+"-Begin",b+"-End"))},d._StartPerformanceConsole=function(b,c){void 0===c&&(c=!0);c&&(d._StartUserMark(b,c),console.time&&console.time(b))},d._EndPerformanceConsole=function(b,c){void 0===c&&(c=!0);c&&(d._EndUserMark(b,c),console.time&&console.timeEnd(b))},Object.defineProperty(d,"Now",{get:function(){return window.performance&&window.performance.now?
window.performance.now():(new Date).getTime()},enumerable:!0,configurable:!0}),d.getClassName=function(b,c){void 0===c&&(c=!1);var d=null;!c&&b.getClassName?d=b.getClassName():(b instanceof Object&&(d=(c?b:Object.getPrototypeOf(b)).constructor.__bjsclassName__),d||(d=typeof b));return d},d.first=function(b,c){for(var d=0;d<b.length;d++){var g=b[d];if(c(g))return g}},d.arrayOrStringFeeder=function(b){return function(c){if(c>=b.length)return null;c=b.charCodeAt?b.charCodeAt(c):b[c];return c&&c.getHashCode&&
(c=c.getHashCode()),"string"==typeof c?d.hashCodeFromStream(d.arrayOrStringFeeder(c)):c}},d.hashCodeFromStream=function(b){for(var c=0,d=0,g=b(d++);null!=g;)c=(c<<5)-c+g,c|=0,g=b(d++);return c},d.BaseUrl="",d.CorsBehavior="anonymous",d.UseFallbackTexture=!0,d._NoneLogLevel=0,d._MessageLogLevel=1,d._WarningLogLevel=2,d._ErrorLogLevel=4,d._LogCache="",d.errorsCount=0,d.Log=d._LogEnabled,d.Warn=d._WarnEnabled,d.Error=d._ErrorEnabled,d._PerformanceNoneLogLevel=0,d._PerformanceUserMarkLogLevel=1,d._PerformanceConsoleLogLevel=
2,d._performance=window.performance,d.StartPerformanceCounter=d._StartPerformanceCounterDisabled,d.EndPerformanceCounter=d._EndPerformanceCounterDisabled,d);b.Tools=c;b.className=function(b){return function(c){c.__bjsclassName__=b}};var g=function(b,c,d,g){void 0===g&&(g=0);this.iterations=b;this._fn=c;this._successCallback=d;this.index=g-1;this._done=!1};c=(g.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},g.prototype.breakLoop=
function(){this._done=!0;this._successCallback()},g.Run=function(b,c,d,e){void 0===e&&(e=0);b=new g(b,c,d,e);return b.executeNext(),b},g.SyncAsyncForLoop=function(b,c,d,e,f,p){void 0===p&&(p=0);g.Run(Math.ceil(b/c),function(g){f&&f()?g.breakLoop():setTimeout(function(){for(var e=0;c>e;++e){var n=g.index*c+e;if(n>=b)break;if(d(n),f&&f()){g.breakLoop();break}}g.executeNext()},p)},e)},g);b.AsyncLoop=c}(BABYLON||(BABYLON={}));
!function(b){b=b.Internals||(b.Internals={});var f;f=function(){this._alphaBlend=this._isBlendFunctionParametersDirty=this._isAlphaBlendDirty=!1;this._blendFunctionParameters=Array(4)};f=(Object.defineProperty(f.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(b){this._alphaBlend!==b&&(this._alphaBlend=b,this._isAlphaBlendDirty=
!0)},enumerable:!0,configurable:!0}),f.prototype.setAlphaBlendFunctionParameters=function(b,c,d,g){this._blendFunctionParameters[0]===b&&this._blendFunctionParameters[1]===c&&this._blendFunctionParameters[2]===d&&this._blendFunctionParameters[3]===g||(this._blendFunctionParameters[0]=b,this._blendFunctionParameters[1]=c,this._blendFunctionParameters[2]=d,this._blendFunctionParameters[3]=g,this._isBlendFunctionParametersDirty=!0)},f.prototype.reset=function(){this._alphaBlend=!1;this._blendFunctionParameters[0]=
null;this._blendFunctionParameters[1]=null;this._blendFunctionParameters[2]=null;this._blendFunctionParameters[3]=null;this._isAlphaBlendDirty=!0;this._isBlendFunctionParametersDirty=!1},f.prototype.apply=function(b){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?b.enable(b.BLEND):b.disable(b.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(b.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),
this._isBlendFunctionParametersDirty=!1))},f);b._AlphaState=f;!0}(BABYLON||(BABYLON={}));
!function(b){b=b.Internals||(b.Internals={});var f;f=function(){this._isZOffsetDirty=this._isCullDirty=this._isCullFaceDirty=this._isDepthFuncDirty=this._isDepthMaskDirty=this._isDepthTestDirty=!1};f=(Object.defineProperty(f.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"zOffset",{get:function(){return this._zOffset},
set:function(b){this._zOffset!==b&&(this._zOffset=b,this._isZOffsetDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"cullFace",{get:function(){return this._cullFace},set:function(b){this._cullFace!==b&&(this._cullFace=b,this._isCullFaceDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"cull",{get:function(){return this._cull},set:function(b){this._cull!==b&&(this._cull=b,this._isCullDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,
"depthFunc",{get:function(){return this._depthFunc},set:function(b){this._depthFunc!==b&&(this._depthFunc=b,this._isDepthFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"depthMask",{get:function(){return this._depthMask},set:function(b){this._depthMask!==b&&(this._depthMask=b,this._isDepthMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"depthTest",{get:function(){return this._depthTest},set:function(b){this._depthTest!==b&&(this._depthTest=
b,this._isDepthTestDirty=!0)},enumerable:!0,configurable:!0}),f.prototype.reset=function(){this._depthTest=this._depthMask=!0;this._cull=this._cullFace=this._depthFunc=null;this._zOffset=0;this._isDepthMaskDirty=this._isDepthTestDirty=!0;this._isZOffsetDirty=this._isCullDirty=this._isCullFaceDirty=this._isDepthFuncDirty=!1},f.prototype.apply=function(b){this.isDirty&&(this._isCullDirty&&(this.cull?b.enable(b.CULL_FACE):b.disable(b.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(b.cullFace(this.cullFace),
this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(b.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?b.enable(b.DEPTH_TEST):b.disable(b.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(b.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(b.enable(b.POLYGON_OFFSET_FILL),b.polygonOffset(this.zOffset,0)):b.disable(b.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1))},f);b._DepthCullingState=f;!0}(BABYLON||
(BABYLON={}));
!function(b){var f=function(b,c,d,g){d=b.createShader("vertex"===d?b.VERTEX_SHADER:b.FRAGMENT_SHADER);if(b.shaderSource(d,(g?g+"\n":"")+c),b.compileShader(d),!b.getShaderParameter(d,b.COMPILE_STATUS))throw Error(b.getShaderInfoLog(d));return d},e=function(b,c){var d=b.UNSIGNED_BYTE;return c===j.TEXTURETYPE_FLOAT&&(d=b.FLOAT),d},c=function(c,d,g){var e=g.NEAREST,l=g.NEAREST;return c===b.Texture.BILINEAR_SAMPLINGMODE?(e=g.LINEAR,l=d?g.LINEAR_MIPMAP_NEAREST:g.LINEAR):c===b.Texture.TRILINEAR_SAMPLINGMODE?(e=
g.LINEAR,l=d?g.LINEAR_MIPMAP_LINEAR:g.LINEAR):c===b.Texture.NEAREST_SAMPLINGMODE&&(e=g.NEAREST,l=d?g.NEAREST_MIPMAP_LINEAR:g.NEAREST),{min:l,mag:e}},d=function(d,g,e,l,j,f,m,x,y,z,A){void 0===A&&(A=b.Texture.TRILINEAR_SAMPLINGMODE);var B=e.getEngine(),C=b.Tools.GetExponentOfTwo(l,B.getCaps().maxTextureSize),D=b.Tools.GetExponentOfTwo(j,B.getCaps().maxTextureSize);g.bindTexture(g.TEXTURE_2D,d);g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,void 0===f?1:f?1:0);d._baseWidth=l;d._baseHeight=j;d._width=C;d._height=
D;d.isReady=!0;y(C,D);l=c(A,!m,g);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,l.mag);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,l.min);m||x||g.generateMipmap(g.TEXTURE_2D);g.bindTexture(g.TEXTURE_2D,null);B.resetTextureCache();e._removePendingData(d);z&&z()},g=function(c,d,g,e,l){var j;j=b.Tools.LoadImage(c,function(){g[d]=j;g._internalCount++;e._removePendingData(j);6===g._internalCount&&l(g)},function(){e._removePendingData(j)},e.database);e._addPendingData(j)};b.InstancingAttributeInfo=
function(){};var m;m=function(){};b.EngineCapabilities=m;var j,l=function(c,d,g,e){var j=this;if(void 0===e&&(e=!0),this.isFullscreen=!1,this.isPointerLock=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.enableOfflineSupport=!0,this.scenes=[],this._windowIsBackground=!1,this._webGLVersion="1.0",this._drawCalls=0,this._renderingQueueLaunched=!1,this._activeRenderLoops=[],this.fpsRange=60,this.previousFramesDuration=[],this.fps=60,this.deltaTime=0,this._depthCullingState=new b.Internals._DepthCullingState,
this._alphaState=new b.Internals._AlphaState,this._alphaMode=l.ALPHA_DISABLE,this._loadedTexturesCache=[],this._maxTextureChannels=16,this._activeTexturesCache=Array(this._maxTextureChannels),this._compiledEffects={},this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=[],this._currentInstanceLocations=[],this._currentInstanceBuffers=[],this._renderingCanvas=c,this._externalData=new b.StringDictionary,g=g||{},g.antialias=d,void 0===g.preserveDrawingBuffer&&(g.preserveDrawingBuffer=!1),!this._gl)try{this._gl=
c.getContext("webgl",g)||c.getContext("experimental-webgl",g)}catch(f){throw Error("WebGL not supported");}if(!this._gl)throw Error("WebGL not supported");this._onBlur=function(){j._windowIsBackground=!0};this._onFocus=function(){j._windowIsBackground=!1};window.addEventListener("blur",this._onBlur);window.addEventListener("focus",this._onFocus);d=g.limitDeviceRatio||window.devicePixelRatio||1;this._hardwareScalingLevel=e?1/Math.min(d,window.devicePixelRatio||1):1;this.resize();this._caps=new m;this._caps.maxTexturesImageUnits=
this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS);this._caps.maxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE);this._caps.maxCubemapTextureSize=this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE);this._caps.maxRenderTextureSize=this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE);this._glVersion=this._gl.getParameter(this._gl.VERSION);e=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=e&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=
this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),this._caps.standardDerivatives=null!==this._gl.getExtension("OES_standard_derivatives"),this._caps.s3tc=this._gl.getExtension("WEBGL_compressed_texture_s3tc"),this._caps.textureFloat=null!==this._gl.getExtension("OES_texture_float"),this._caps.textureAnisotropicFilterExtension=this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||
this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.instancedArrays=this._gl.getExtension("ANGLE_instanced_arrays"),this._caps.uintIndices=null!==this._gl.getExtension("OES_element_index_uint"),this._caps.fragmentDepthSupported=null!==this._gl.getExtension("EXT_frag_depth"),this._caps.highPrecisionShaderSupported=
!0,this._caps.drawBuffersExtension=this._gl.getExtension("WEBGL_draw_buffers"),this._caps.textureFloatLinearFiltering=this._gl.getExtension("OES_texture_float_linear"),this._caps.textureLOD=this._gl.getExtension("EXT_shader_texture_lod"),this._gl.getShaderPrecisionFormat)e=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT),this._caps.highPrecisionShaderSupported=0!==e.precision;this.setDepthBuffer(!0);this.setDepthFunctionToLessOrEqual();this.setDepthWrite(!0);this._onFullscreenChange=
function(){void 0!==document.fullscreen?j.isFullscreen=document.fullscreen:void 0!==document.mozFullScreen?j.isFullscreen=document.mozFullScreen:void 0!==document.webkitIsFullScreen?j.isFullscreen=document.webkitIsFullScreen:void 0!==document.msIsFullScreen&&(j.isFullscreen=document.msIsFullScreen);j.isFullscreen&&j._pointerLockRequested&&(c.requestPointerLock=c.requestPointerLock||c.msRequestPointerLock||c.mozRequestPointerLock||c.webkitRequestPointerLock,c.requestPointerLock&&c.requestPointerLock())};
document.addEventListener("fullscreenchange",this._onFullscreenChange,!1);document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1);document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1);document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1);this._onPointerLockChange=function(){j.isPointerLock=document.mozPointerLockElement===c||document.webkitPointerLockElement===c||document.msPointerLockElement===c||document.pointerLockElement===c};
document.addEventListener("pointerlockchange",this._onPointerLockChange,!1);document.addEventListener("mspointerlockchange",this._onPointerLockChange,!1);document.addEventListener("mozpointerlockchange",this._onPointerLockChange,!1);document.addEventListener("webkitpointerlockchange",this._onPointerLockChange,!1);b.AudioEngine&&!l.audioEngine&&(l.audioEngine=new b.AudioEngine);this._loadingScreen=new b.DefaultLoadingScreen(this._renderingCanvas);b.Tools.Log("Babylon.js engine (v"+l.Version+") launched")};
j=(Object.defineProperty(l,"ALPHA_DISABLE",{get:function(){return l._ALPHA_DISABLE},enumerable:!0,configurable:!0}),Object.defineProperty(l,"ALPHA_ONEONE",{get:function(){return l._ALPHA_ONEONE},enumerable:!0,configurable:!0}),Object.defineProperty(l,"ALPHA_ADD",{get:function(){return l._ALPHA_ADD},enumerable:!0,configurable:!0}),Object.defineProperty(l,"ALPHA_COMBINE",{get:function(){return l._ALPHA_COMBINE},enumerable:!0,configurable:!0}),Object.defineProperty(l,"ALPHA_SUBTRACT",{get:function(){return l._ALPHA_SUBTRACT},
enumerable:!0,configurable:!0}),Object.defineProperty(l,"ALPHA_MULTIPLY",{get:function(){return l._ALPHA_MULTIPLY},enumerable:!0,configurable:!0}),Object.defineProperty(l,"ALPHA_MAXIMIZED",{get:function(){return l._ALPHA_MAXIMIZED},enumerable:!0,configurable:!0}),Object.defineProperty(l,"DELAYLOADSTATE_NONE",{get:function(){return l._DELAYLOADSTATE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(l,"DELAYLOADSTATE_LOADED",{get:function(){return l._DELAYLOADSTATE_LOADED},enumerable:!0,configurable:!0}),
Object.defineProperty(l,"DELAYLOADSTATE_LOADING",{get:function(){return l._DELAYLOADSTATE_LOADING},enumerable:!0,configurable:!0}),Object.defineProperty(l,"DELAYLOADSTATE_NOTLOADED",{get:function(){return l._DELAYLOADSTATE_NOTLOADED},enumerable:!0,configurable:!0}),Object.defineProperty(l,"TEXTUREFORMAT_ALPHA",{get:function(){return l._TEXTUREFORMAT_ALPHA},enumerable:!0,configurable:!0}),Object.defineProperty(l,"TEXTUREFORMAT_LUMINANCE",{get:function(){return l._TEXTUREFORMAT_LUMINANCE},enumerable:!0,
configurable:!0}),Object.defineProperty(l,"TEXTUREFORMAT_LUMINANCE_ALPHA",{get:function(){return l._TEXTUREFORMAT_LUMINANCE_ALPHA},enumerable:!0,configurable:!0}),Object.defineProperty(l,"TEXTUREFORMAT_RGB",{get:function(){return l._TEXTUREFORMAT_RGB},enumerable:!0,configurable:!0}),Object.defineProperty(l,"TEXTUREFORMAT_RGBA",{get:function(){return l._TEXTUREFORMAT_RGBA},enumerable:!0,configurable:!0}),Object.defineProperty(l,"TEXTURETYPE_UNSIGNED_INT",{get:function(){return l._TEXTURETYPE_UNSIGNED_INT},
enumerable:!0,configurable:!0}),Object.defineProperty(l,"TEXTURETYPE_FLOAT",{get:function(){return l._TEXTURETYPE_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(l,"Version",{get:function(){return"2.4.0"},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!0,configurable:!0}),l.prototype._prepareWorkingCanvas=function(){this._workingCanvas||(this._workingCanvas=document.createElement("canvas"),this._workingContext=
this._workingCanvas.getContext("2d"))},l.prototype.resetTextureCache=function(){for(var b=0;b<this._maxTextureChannels;b++)this._activeTexturesCache[b]=null},l.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},l.prototype.getAspectRatio=function(b,c){void 0===c&&(c=!1);var d=b.viewport;return this.getRenderWidth(c)*d.width/(this.getRenderHeight(c)*d.height)},l.prototype.getRenderWidth=function(b){return void 0===b&&(b=!1),!b&&this._currentRenderTarget?
this._currentRenderTarget._width:this._renderingCanvas.width},l.prototype.getRenderHeight=function(b){return void 0===b&&(b=!1),!b&&this._currentRenderTarget?this._currentRenderTarget._height:this._renderingCanvas.height},l.prototype.getRenderingCanvas=function(){return this._renderingCanvas},l.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas.getBoundingClientRect()},l.prototype.setHardwareScalingLevel=function(b){this._hardwareScalingLevel=b;this.resize()},l.prototype.getHardwareScalingLevel=
function(){return this._hardwareScalingLevel},l.prototype.getLoadedTexturesCache=function(){return this._loadedTexturesCache},l.prototype.getCaps=function(){return this._caps},Object.defineProperty(l.prototype,"drawCalls",{get:function(){return this._drawCalls},enumerable:!0,configurable:!0}),l.prototype.resetDrawCalls=function(){this._drawCalls=0},l.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},l.prototype.setDepthFunction=function(b){this._depthCullingState.depthFunc=
b},l.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},l.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},l.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},l.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},l.prototype.stopRenderLoop=function(b){if(!b)return void(this._activeRenderLoops=[]);b=this._activeRenderLoops.indexOf(b);
0<=b&&this._activeRenderLoops.splice(b,1)},l.prototype._renderLoop=function(){this.beginFrame();for(var c=0;c<this._activeRenderLoops.length;c++)(0,this._activeRenderLoops[c])();this.endFrame();0<this._activeRenderLoops.length?b.Tools.QueueNewFrame(this._bindedRenderFunction):this._renderingQueueLaunched=!1},l.prototype.runRenderLoop=function(c){-1===this._activeRenderLoops.indexOf(c)&&(this._activeRenderLoops.push(c),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._bindedRenderFunction=
this._renderLoop.bind(this),b.Tools.QueueNewFrame(this._bindedRenderFunction)))},l.prototype.switchFullscreen=function(c,d){this.isFullscreen?b.Tools.ExitFullscreen():(this._pointerLockRequested=c,b.Tools.RequestFullscreen(this._renderingCanvas,d))},l.prototype.clear=function(b,c,d){this.applyStates();c&&this._gl.clearColor(b.r,b.g,b.b,void 0!==b.a?b.a:1);d&&this._depthCullingState.depthMask&&this._gl.clearDepth(1);b=0;c&&(b|=this._gl.COLOR_BUFFER_BIT);d&&this._depthCullingState.depthMask&&(b|=this._gl.DEPTH_BUFFER_BIT);
this._gl.clear(b)},l.prototype.scissorClear=function(b,c,d,g,e){var l=this._gl,j=l.getParameter(l.SCISSOR_TEST),f=l.getParameter(l.SCISSOR_BOX);l.enable(l.SCISSOR_TEST);l.scissor(b,c,d,g);this.clear(e,!0,!0);l.scissor(f[0],f[1],f[2],f[3]);!0===j?l.enable(l.SCISSOR_TEST):l.disable(l.SCISSOR_TEST)},l.prototype.setViewport=function(b,c,d){c=c||(navigator.isCocoonJS?window.innerWidth:this._renderingCanvas.width);d=d||(navigator.isCocoonJS?window.innerHeight:this._renderingCanvas.height);var g=b.x||0,
e=b.y||0;this._cachedViewport=b;this._gl.viewport(g*c,e*d,c*b.width,d*b.height)},l.prototype.setDirectViewport=function(b,c,d,g){var e=this._cachedViewport;return this._cachedViewport=null,this._gl.viewport(b,c,d,g),e},l.prototype.beginFrame=function(){this._measureFps()},l.prototype.endFrame=function(){},l.prototype.resize=function(){this.setSize((navigator.isCocoonJS?window.innerWidth:this._renderingCanvas.clientWidth)/this._hardwareScalingLevel,(navigator.isCocoonJS?window.innerHeight:this._renderingCanvas.clientHeight)/
this._hardwareScalingLevel);for(var b=0;b<this.scenes.length;b++){var c=this.scenes[b];c.debugLayer.isVisible()&&c.debugLayer._syncPositions()}},l.prototype.setSize=function(b,c){this._renderingCanvas.width=b;this._renderingCanvas.height=c;for(var d=0;d<this.scenes.length;d++)for(var g=this.scenes[d],e=0;e<g.cameras.length;e++)g.cameras[e]._currentRenderId=0},l.prototype.bindFramebuffer=function(b,c,d,g){this._currentRenderTarget=b;var e=this._gl;e.bindFramebuffer(e.FRAMEBUFFER,b._framebuffer);b.isCube?
e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+c,b,0):e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,b,0);this._gl.viewport(0,0,d||b._width,g||b._height);this.wipeCaches()},l.prototype.unBindFramebuffer=function(b,c){if(void 0===c&&(c=!1),this._currentRenderTarget=null,b.generateMipMaps&&!c){var d=this._gl;d.bindTexture(d.TEXTURE_2D,b);d.generateMipmap(d.TEXTURE_2D);d.bindTexture(d.TEXTURE_2D,null)}this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,
null)},l.prototype.generateMipMapsForCubemap=function(b){if(b.generateMipMaps){var c=this._gl;c.bindTexture(c.TEXTURE_CUBE_MAP,b);c.generateMipmap(c.TEXTURE_CUBE_MAP);c.bindTexture(c.TEXTURE_CUBE_MAP,null)}},l.prototype.flushFramebuffer=function(){this._gl.flush()},l.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget=null;this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null);this.setViewport(this._cachedViewport);this.wipeCaches()},l.prototype._resetVertexBufferBinding=function(){this.bindBuffer(null,
this._gl.ARRAY_BUFFER);this._cachedVertexBuffers=null},l.prototype.createVertexBuffer=function(b){var c=this._gl.createBuffer();return this.bindBuffer(c,this._gl.ARRAY_BUFFER),b instanceof Float32Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,b,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(b),this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),c.references=1,c},l.prototype.createDynamicVertexBuffer=function(b){var c=this._gl.createBuffer();return this.bindBuffer(c,
this._gl.ARRAY_BUFFER),b instanceof Float32Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,b,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(b),this._gl.DYNAMIC_DRAW),this._resetVertexBufferBinding(),c.references=1,c},l.prototype.updateDynamicVertexBuffer=function(b,c,d,g){this.bindBuffer(b,this._gl.ARRAY_BUFFER);void 0===d&&(d=0);void 0===g?c instanceof Float32Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,d,c):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,d,
new Float32Array(c)):c instanceof Float32Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,c.subarray(d,d+g)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,(new Float32Array(c)).subarray(d,d+g));this._resetVertexBufferBinding()},l.prototype._resetIndexBufferBinding=function(){this.bindBuffer(null,this._gl.ELEMENT_ARRAY_BUFFER);this._cachedIndexBuffer=null},l.prototype.createIndexBuffer=function(b){var c=this._gl.createBuffer();this.bindBuffer(c,this._gl.ELEMENT_ARRAY_BUFFER);var d=!1;if(this._caps.uintIndices){for(var g=
0;g<b.length;g++)if(65535<b[g]){d=!0;break}b=d?new Uint32Array(b):new Uint16Array(b)}else b=new Uint16Array(b);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,b,this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),c.references=1,c.is32Bits=d,c},l.prototype.bindArrayBuffer=function(b){this.bindBuffer(b,this._gl.ARRAY_BUFFER)},l.prototype.updateArrayBuffer=function(b){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,b)},l.prototype.bindBuffer=function(b,c){this._currentBoundBuffer[c]!==b&&(this._gl.bindBuffer(c,
b),this._currentBoundBuffer[c]=b)},l.prototype.bindBuffersDirectly=function(b,c,d,g,e){if(this._cachedVertexBuffers!==b||this._cachedEffectForVertexBuffers!==e){this._cachedVertexBuffers=b;this._cachedEffectForVertexBuffers=e;this.bindBuffer(b,this._gl.ARRAY_BUFFER);for(var l=b=0;l<d.length;l++){var j=e.getAttributeLocation(l);0<=j&&this._gl.vertexAttribPointer(j,d[l],this._gl.FLOAT,!1,g,b);b+=4*d[l]}}this._cachedIndexBuffer!==c&&(this._cachedIndexBuffer=c,this.bindBuffer(c,this._gl.ELEMENT_ARRAY_BUFFER),
this._uintIndicesCurrentlySet=c.is32Bits)},l.prototype.bindBuffers=function(b,c,d){if(this._cachedVertexBuffers!==b||this._cachedEffectForVertexBuffers!==d){this._cachedVertexBuffers=b;this._cachedEffectForVertexBuffers=d;for(var g=d.getAttributesNames(),e=0;e<g.length;e++){var l=d.getAttributeLocation(e);if(0<=l){var j=b[g[e]];if(j){var f=j.getBuffer();this.bindBuffer(f,this._gl.ARRAY_BUFFER);this._gl.vertexAttribPointer(l,j.getSize(),this._gl.FLOAT,!1,4*j.getStrideSize(),4*j.getOffset());j.getIsInstanced()&&
(this._caps.instancedArrays.vertexAttribDivisorANGLE(l,1),this._currentInstanceLocations.push(l),this._currentInstanceBuffers.push(f))}}}}null!=c&&this._cachedIndexBuffer!==c&&(this._cachedIndexBuffer=c,this.bindBuffer(c,this._gl.ELEMENT_ARRAY_BUFFER),this._uintIndicesCurrentlySet=c.is32Bits)},l.prototype.unbindInstanceAttributes=function(){for(var b,c=0,d=this._currentInstanceLocations.length;d>c;c++){var g=this._currentInstanceBuffers[c];b!=g&&(b=g,this.bindBuffer(g,this._gl.ARRAY_BUFFER));this._caps.instancedArrays.vertexAttribDivisorANGLE(this._currentInstanceLocations[c],
0)}this._currentInstanceBuffers.length=0;this._currentInstanceLocations.length=0},l.prototype._releaseBuffer=function(b){return b.references--,0===b.references?(this._gl.deleteBuffer(b),!0):!1},l.prototype.createInstancesBuffer=function(b){var c=this._gl.createBuffer();return c.capacity=b,this.bindBuffer(c,this._gl.ARRAY_BUFFER),this._gl.bufferData(this._gl.ARRAY_BUFFER,b,this._gl.DYNAMIC_DRAW),c},l.prototype.deleteInstancesBuffer=function(b){this._gl.deleteBuffer(b)},l.prototype.updateAndBindInstancesBuffer=
function(b,c,d){if(this.bindBuffer(b,this._gl.ARRAY_BUFFER),c&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,c),void 0!==d[0].index){for(var g=c=0;g<d.length;g++){var e=d[g];c+=4*e.attributeSize}for(g=0;g<d.length;g++)e=d[g],this._gl.enableVertexAttribArray(e.index),this._gl.vertexAttribPointer(e.index,e.attributeSize,e.attribyteType||this._gl.FLOAT,e.normalized||!1,c,e.offset),this._caps.instancedArrays.vertexAttribDivisorANGLE(e.index,1),this._currentInstanceLocations.push(e.index),this._currentInstanceBuffers.push(b)}else for(c=
0;4>c;c++)g=d[c],this._gl.enableVertexAttribArray(g),this._gl.vertexAttribPointer(g,4,this._gl.FLOAT,!1,64,16*c),this._caps.instancedArrays.vertexAttribDivisorANGLE(g,1),this._currentInstanceLocations.push(g),this._currentInstanceBuffers.push(b)},l.prototype.applyStates=function(){this._depthCullingState.apply(this._gl);this._alphaState.apply(this._gl)},l.prototype.draw=function(b,c,d,g){this.applyStates();this._drawCalls++;var e=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,
l=this._uintIndicesCurrentlySet?4:2;return g?void this._caps.instancedArrays.drawElementsInstancedANGLE(b?this._gl.TRIANGLES:this._gl.LINES,d,e,c*l,g):void this._gl.drawElements(b?this._gl.TRIANGLES:this._gl.LINES,d,e,c*l)},l.prototype.drawPointClouds=function(b,c,d){return this.applyStates(),this._drawCalls++,d?void this._caps.instancedArrays.drawArraysInstancedANGLE(this._gl.POINTS,b,c,d):void this._gl.drawArrays(this._gl.POINTS,b,c)},l.prototype.drawUnIndexed=function(b,c,d,g){return this.applyStates(),
this._drawCalls++,g?void this._caps.instancedArrays.drawArraysInstancedANGLE(b?this._gl.TRIANGLES:this._gl.LINES,c,d,g):void this._gl.drawArrays(b?this._gl.TRIANGLES:this._gl.LINES,c,d)},l.prototype._releaseEffect=function(b){this._compiledEffects[b._key]&&(delete this._compiledEffects[b._key],b.getProgram()&&this._gl.deleteProgram(b.getProgram()))},l.prototype.createEffect=function(c,d,g,e,l,j,f,m,y){var z=(c.vertexElement||c.vertex||c)+"+"+(c.fragmentElement||c.fragment||c)+"@"+l;if(this._compiledEffects[z])return this._compiledEffects[z];
c=new b.Effect(c,d,g,e,this,l,j,f,m,y);return c._key=z,this._compiledEffects[z]=c,c},l.prototype.createEffectForParticles=function(b,c,d,g,e,l,j){return void 0===c&&(c=[]),void 0===d&&(d=[]),void 0===g&&(g=""),this.createEffect({vertex:"particles",fragmentElement:b},["position","color","options"],["view","projection"].concat(c),["diffuseSampler"].concat(d),g,e,l,j)},l.prototype.createShaderProgram=function(b,c,d){b=f(this._gl,b,"vertex",d);c=f(this._gl,c,"fragment",d);d=this._gl.createProgram();this._gl.attachShader(d,
b);this._gl.attachShader(d,c);this._gl.linkProgram(d);if(!this._gl.getProgramParameter(d,this._gl.LINK_STATUS)){var g=this._gl.getProgramInfoLog(d);if(g)throw Error(g);}return this._gl.deleteShader(b),this._gl.deleteShader(c),d},l.prototype.getUniforms=function(b,c){for(var d=[],g=0;g<c.length;g++)d.push(this._gl.getUniformLocation(b,c[g]));return d},l.prototype.getAttributes=function(b,c){for(var d=[],g=0;g<c.length;g++)try{d.push(this._gl.getAttribLocation(b,c[g]))}catch(e){d.push(-1)}return d},
l.prototype.enableEffect=function(b){if(!b||!b.getAttributesCount()||this._currentEffect===b)return void(b&&b.onBind&&b.onBind(b));this._vertexAttribArraysToUse=this._vertexAttribArraysToUse||[];this._vertexAttribArraysEnabled=this._vertexAttribArraysEnabled||[];this._gl.useProgram(b.getProgram());var c,d;c=0;for(d=this._vertexAttribArraysToUse.length;d>c;c++)this._vertexAttribArraysToUse[c]=!1;d=b.getAttributesCount();for(c=0;d>c;c++){var g=b.getAttributeLocation(c);0<=g&&(this._vertexAttribArraysToUse[g]=
!0)}c=0;for(d=this._vertexAttribArraysEnabled.length;d>c;c++)c>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArraysEnabled[c]||this._vertexAttribArraysToUse[c]||(this._vertexAttribArraysEnabled[c]=!1,this._gl.disableVertexAttribArray(c));c=0;for(d=this._vertexAttribArraysToUse.length;d>c;c++)this._vertexAttribArraysToUse[c]&&!this._vertexAttribArraysEnabled[c]&&(this._vertexAttribArraysEnabled[c]=!0,this._gl.enableVertexAttribArray(c));this._currentEffect=b;b.onBind&&b.onBind(b)},l.prototype.setArray=
function(b,c){b&&this._gl.uniform1fv(b,c)},l.prototype.setArray2=function(b,c){b&&0===c.length%2&&this._gl.uniform2fv(b,c)},l.prototype.setArray3=function(b,c){b&&0===c.length%3&&this._gl.uniform3fv(b,c)},l.prototype.setArray4=function(b,c){b&&0===c.length%4&&this._gl.uniform4fv(b,c)},l.prototype.setMatrices=function(b,c){b&&this._gl.uniformMatrix4fv(b,!1,c)},l.prototype.setMatrix=function(b,c){b&&this._gl.uniformMatrix4fv(b,!1,c.toArray())},l.prototype.setMatrix3x3=function(b,c){b&&this._gl.uniformMatrix3fv(b,
!1,c)},l.prototype.setMatrix2x2=function(b,c){b&&this._gl.uniformMatrix2fv(b,!1,c)},l.prototype.setFloat=function(b,c){b&&this._gl.uniform1f(b,c)},l.prototype.setFloat2=function(b,c,d){b&&this._gl.uniform2f(b,c,d)},l.prototype.setFloat3=function(b,c,d,g){b&&this._gl.uniform3f(b,c,d,g)},l.prototype.setBool=function(b,c){b&&this._gl.uniform1i(b,c)},l.prototype.setFloat4=function(b,c,d,g,e){b&&this._gl.uniform4f(b,c,d,g,e)},l.prototype.setColor3=function(b,c){b&&this._gl.uniform3f(b,c.r,c.g,c.b)},l.prototype.setColor4=
function(b,c,d){b&&this._gl.uniform4f(b,c.r,c.g,c.b,d)},l.prototype.setState=function(b,c,d,g){void 0===c&&(c=0);void 0===g&&(g=!1);var e=g?this._gl.FRONT:this._gl.BACK;g=g?this._gl.BACK:this._gl.FRONT;e=this.cullBackFaces?e:g;(this._depthCullingState.cull!==b||d||this._depthCullingState.cullFace!==e)&&(b?(this._depthCullingState.cullFace=e,this._depthCullingState.cull=!0):this._depthCullingState.cull=!1);this._depthCullingState.zOffset=c},l.prototype.setDepthBuffer=function(b){this._depthCullingState.depthTest=
b},l.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},l.prototype.setDepthWrite=function(b){this._depthCullingState.depthMask=b},l.prototype.setColorWrite=function(b){this._gl.colorMask(b,b,b,b)},l.prototype.setAlphaMode=function(b,c){if(void 0===c&&(c=!1),this._alphaMode!==b){switch(b){case l.ALPHA_DISABLE:this._alphaState.alphaBlend=!1;break;case l.ALPHA_COMBINE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,
this._gl.ONE);this._alphaState.alphaBlend=!0;break;case l.ALPHA_ONEONE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE);this._alphaState.alphaBlend=!0;break;case l.ALPHA_ADD:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE);this._alphaState.alphaBlend=!0;break;case l.ALPHA_SUBTRACT:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,
this._gl.ONE);this._alphaState.alphaBlend=!0;break;case l.ALPHA_MULTIPLY:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE);this._alphaState.alphaBlend=!0;break;case l.ALPHA_MAXIMIZED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0}c||this.setDepthWrite(b===l.ALPHA_DISABLE);this._alphaMode=b}},l.prototype.getAlphaMode=function(){return this._alphaMode},
l.prototype.setAlphaTesting=function(b){this._alphaTest=b},l.prototype.getAlphaTesting=function(){return this._alphaTest},l.prototype.wipeCaches=function(){this.resetTextureCache();this._currentEffect=null;this._depthCullingState.reset();this.setDepthFunctionToLessOrEqual();this._alphaState.reset();this._cachedEffectForVertexBuffers=this._cachedIndexBuffer=this._cachedVertexBuffers=null},l.prototype.setSamplingMode=function(c,d){var g=this._gl;g.bindTexture(g.TEXTURE_2D,c);var e=g.NEAREST,l=g.NEAREST;
d===b.Texture.BILINEAR_SAMPLINGMODE?(e=g.LINEAR,l=g.LINEAR):d===b.Texture.TRILINEAR_SAMPLINGMODE&&(e=g.LINEAR,l=g.LINEAR_MIPMAP_LINEAR);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,e);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,l);g.bindTexture(g.TEXTURE_2D,null);c.samplingMode=d},l.prototype.createTexture=function(c,g,e,l,j,f,m,x){var y=this;void 0===j&&(j=b.Texture.TRILINEAR_SAMPLINGMODE);void 0===f&&(f=null);void 0===m&&(m=null);void 0===x&&(x=null);var z,A=this._gl.createTexture(),
B=!1;("data:"===c.substr(0,5)&&(B=!0),B)?(B=c.split(":"),z=B[1].substr(B[1].length-4,4).toLowerCase()):z=c.substr(c.length-4,4).toLowerCase();var C=this.getCaps().s3tc&&".dds"===z,D=".tga"===z;l._addPendingData(A);A.url=c;A.noMipmap=g;A.references=1;A.samplingMode=j;this._loadedTexturesCache.push(A);var E;z=function(){l._removePendingData(A);m&&m()};D?(E=function(c){var m=new Uint8Array(c);c=b.Internals.TGATools.GetTGAHeader(m);d(A,y._gl,l,c.width,c.height,e,g,!1,function(){b.Internals.TGATools.UploadContent(y._gl,
m)},f,j)},B instanceof Array?E(x):b.Tools.LoadFile(c,function(b){E(b)},z,l.database,!0)):C?(E=function(c){var m=b.Internals.DDSTools.GetDDSInfo(c),n=(m.isRGB||m.isLuminance||1<m.mipmapCount)&&!g&&1===m.width>>m.mipmapCount-1;d(A,y._gl,l,m.width,m.height,e,!n,m.isFourCC,function(){b.Internals.DDSTools.UploadDDSLevels(y._gl,y.getCaps().s3tc,c,m,n,1)},f,j)},B instanceof Array?E(x):b.Tools.LoadFile(c,function(b){E(b)},z,l.database,!0)):(C=function(c){d(A,y._gl,l,c.width,c.height,e,g,!1,function(d,g){var e=
c.width===d&&c.height===g;e||(y._prepareWorkingCanvas(),y._workingCanvas.width=d,y._workingCanvas.height=g,j===b.Texture.NEAREST_SAMPLINGMODE&&(y._workingContext.imageSmoothingEnabled=!1,y._workingContext.mozImageSmoothingEnabled=!1,y._workingContext.oImageSmoothingEnabled=!1,y._workingContext.webkitImageSmoothingEnabled=!1,y._workingContext.msImageSmoothingEnabled=!1),y._workingContext.drawImage(c,0,0,c.width,c.height,0,0,d,g),j===b.Texture.NEAREST_SAMPLINGMODE&&(y._workingContext.imageSmoothingEnabled=
!0,y._workingContext.mozImageSmoothingEnabled=!0,y._workingContext.oImageSmoothingEnabled=!0,y._workingContext.webkitImageSmoothingEnabled=!0,y._workingContext.msImageSmoothingEnabled=!0));y._gl.texImage2D(y._gl.TEXTURE_2D,0,y._gl.RGBA,y._gl.RGBA,y._gl.UNSIGNED_BYTE,e?c:y._workingCanvas)},f,j)},B instanceof Array?b.Tools.LoadImage(x,C,z,l.database):b.Tools.LoadImage(c,C,z,l.database));return A},l.prototype._getInternalFormat=function(b){var c=this._gl.RGBA;switch(b){case l.TEXTUREFORMAT_ALPHA:c=this._gl.ALPHA;
break;case l.TEXTUREFORMAT_LUMINANCE:c=this._gl.LUMINANCE;break;case l.TEXTUREFORMAT_LUMINANCE_ALPHA:c=this._gl.LUMINANCE_ALPHA;break;case l.TEXTUREFORMAT_RGB:c=this._gl.RGB;break;case l.TEXTUREFORMAT_RGBA:c=this._gl.RGBA}return c},l.prototype.updateRawTexture=function(b,c,d,g,e){void 0===e&&(e=null);d=this._getInternalFormat(d);this._gl.bindTexture(this._gl.TEXTURE_2D,b);this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,void 0===g?1:g?1:0);0!==b._width%4&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,
1);e?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[e],b._width,b._height,0,c):this._gl.texImage2D(this._gl.TEXTURE_2D,0,d,b._width,b._height,0,d,this._gl.UNSIGNED_BYTE,c);b.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D);this._gl.bindTexture(this._gl.TEXTURE_2D,null);this.resetTextureCache();b.isReady=!0},l.prototype.createRawTexture=function(b,d,g,e,l,j,f,m){void 0===m&&(m=null);var y=this._gl.createTexture();y._baseWidth=d;y._baseHeight=g;y._width=d;y._height=
g;y.references=1;this.updateRawTexture(y,b,e,j,m);this._gl.bindTexture(this._gl.TEXTURE_2D,y);b=c(f,l,this._gl);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,b.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,b.min),this._gl.bindTexture(this._gl.TEXTURE_2D,null),y.samplingMode=f,this._loadedTexturesCache.push(y),y},l.prototype.createDynamicTexture=function(c,d,g,e){var l=this._gl.createTexture();return l._baseWidth=c,l._baseHeight=d,g&&(c=
b.Tools.GetExponentOfTwo(c,this._caps.maxTextureSize),d=b.Tools.GetExponentOfTwo(d,this._caps.maxTextureSize)),this.resetTextureCache(),l._width=c,l._height=d,l.isReady=!1,l.generateMipMaps=g,l.references=1,l.samplingMode=e,this.updateTextureSamplingMode(e,l),this._loadedTexturesCache.push(l),l},l.prototype.updateTextureSamplingMode=function(b,d){var g=c(b,d.generateMipMaps,this._gl);d.isCube?(this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,d),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MAG_FILTER,
g.mag),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MIN_FILTER,g.min),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null)):(this._gl.bindTexture(this._gl.TEXTURE_2D,d),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,g.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,g.min),this._gl.bindTexture(this._gl.TEXTURE_2D,null))},l.prototype.updateDynamicTexture=function(b,c,d,g){void 0===g&&(g=!1);this._gl.bindTexture(this._gl.TEXTURE_2D,
b);this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,d?1:0);g&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,c);b.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D);this._gl.bindTexture(this._gl.TEXTURE_2D,null);this.resetTextureCache();b.isReady=!0},l.prototype.updateVideoTexture=function(b,c,d){if(!b._isDisabled){this._gl.bindTexture(this._gl.TEXTURE_2D,b);this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,
d?0:1);try{void 0===this._videoTextureSupported&&(this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,c),0!==this._gl.getError()?this._videoTextureSupported=!1:this._videoTextureSupported=!0),this._videoTextureSupported?this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,c):(b._workingCanvas||(b._workingCanvas=document.createElement("canvas"),b._workingContext=b._workingCanvas.getContext("2d"),b._workingCanvas.width=
b._width,b._workingCanvas.height=b._height),b._workingContext.drawImage(c,0,0,c.videoWidth,c.videoHeight,0,0,b._width,b._height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,b._workingCanvas)),b.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this.resetTextureCache(),b.isReady=!0}catch(g){b._isDisabled=!0}}},l.prototype.createRenderTargetTexture=function(d,g){var j=!1,f=!0,m=l.TEXTURETYPE_UNSIGNED_INT,
s=b.Texture.TRILINEAR_SAMPLINGMODE;void 0!==g&&(j=void 0===g.generateMipMaps?g:g.generateMipMaps,f=void 0===g.generateDepthBuffer?!0:g.generateDepthBuffer,m=void 0===g.type?m:g.type,void 0!==g.samplingMode&&(s=g.samplingMode),m===l.TEXTURETYPE_FLOAT&&(s=b.Texture.NEAREST_SAMPLINGMODE));var u=this._gl,x=u.createTexture();u.bindTexture(u.TEXTURE_2D,x);var y=d.width||d,z=d.height||d,A=c(s,j,u);m!==l.TEXTURETYPE_FLOAT||this._caps.textureFloat||(m=l.TEXTURETYPE_UNSIGNED_INT,b.Tools.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));
u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,A.mag);u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,A.min);u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE);u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE);u.texImage2D(u.TEXTURE_2D,0,u.RGBA,y,z,0,u.RGBA,e(u,m),null);var B;f&&(B=u.createRenderbuffer(),u.bindRenderbuffer(u.RENDERBUFFER,B),u.renderbufferStorage(u.RENDERBUFFER,u.DEPTH_COMPONENT16,y,z));m=u.createFramebuffer();return u.bindFramebuffer(u.FRAMEBUFFER,m),
f&&u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,B),j&&this._gl.generateMipmap(this._gl.TEXTURE_2D),u.bindTexture(u.TEXTURE_2D,null),u.bindRenderbuffer(u.RENDERBUFFER,null),u.bindFramebuffer(u.FRAMEBUFFER,null),x._framebuffer=m,f&&(x._depthBuffer=B),x._baseWidth=y,x._baseHeight=z,x._width=y,x._height=z,x.isReady=!0,x.generateMipMaps=j,x.references=1,x.samplingMode=s,this.resetTextureCache(),this._loadedTexturesCache.push(x),x},l.prototype.createRenderTargetCubeTexture=
function(d,g){var e=this._gl,l=e.createTexture(),j=!0,f=b.Texture.TRILINEAR_SAMPLINGMODE;void 0!==g&&(j=void 0===g.generateMipMaps?g:g.generateMipMaps,void 0!==g.samplingMode&&(f=g.samplingMode));l.isCube=!0;l.references=1;l.generateMipMaps=j;l.references=1;l.samplingMode=f;j=c(f,j,e);e.bindTexture(e.TEXTURE_CUBE_MAP,l);for(f=0;6>f;f++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,e.RGBA,d,d,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,j.mag);e.texParameteri(e.TEXTURE_CUBE_MAP,
e.TEXTURE_MIN_FILTER,j.min);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);j=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,j);e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,d,d);f=e.createFramebuffer();return e.bindFramebuffer(e.FRAMEBUFFER,f),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,j),l.generateMipMaps&&(e.bindTexture(e.TEXTURE_CUBE_MAP,l),e.generateMipmap(e.TEXTURE_CUBE_MAP)),
e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),l._framebuffer=f,l._depthBuffer=j,this.resetTextureCache(),l._width=d,l._height=d,l.isReady=!0,l},l.prototype.createCubeTexture=function(c,d,e,l){var j=this,f=this._gl,m=f.createTexture();m.isCube=!0;m.url=c;m.references=1;var x=c.substr(c.length-4,4).toLowerCase();if(this.getCaps().s3tc&&".dds"===x)b.Tools.LoadFile(c,function(c){var d=b.Internals.DDSTools.GetDDSInfo(c),g=(d.isRGB||
d.isLuminance||1<d.mipmapCount)&&!l;f.bindTexture(f.TEXTURE_CUBE_MAP,m);f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,1);b.Internals.DDSTools.UploadDDSLevels(j._gl,j.getCaps().s3tc,c,d,g,6);l||d.isFourCC||1!==d.mipmapCount||f.generateMipmap(f.TEXTURE_CUBE_MAP);f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_MAG_FILTER,f.LINEAR);f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_MIN_FILTER,g?f.LINEAR_MIPMAP_LINEAR:f.LINEAR);f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(f.TEXTURE_CUBE_MAP,
f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);f.bindTexture(f.TEXTURE_CUBE_MAP,null);j.resetTextureCache();m._width=d.width;m._height=d.height;m.isReady=!0},null,null,!0);else{c=function(c){var d=b.Tools.GetExponentOfTwo(c[0].width,j._caps.maxCubemapTextureSize);j._prepareWorkingCanvas();j._workingCanvas.width=d;j._workingCanvas.height=d;var g=[f.TEXTURE_CUBE_MAP_POSITIVE_X,f.TEXTURE_CUBE_MAP_POSITIVE_Y,f.TEXTURE_CUBE_MAP_POSITIVE_Z,f.TEXTURE_CUBE_MAP_NEGATIVE_X,f.TEXTURE_CUBE_MAP_NEGATIVE_Y,f.TEXTURE_CUBE_MAP_NEGATIVE_Z];
f.bindTexture(f.TEXTURE_CUBE_MAP,m);f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,0);for(var e=0;e<g.length;e++)j._workingContext.drawImage(c[e],0,0,c[e].width,c[e].height,0,0,d,d),f.texImage2D(g[e],0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,j._workingCanvas);l||f.generateMipmap(f.TEXTURE_CUBE_MAP);f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_MAG_FILTER,f.LINEAR);f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_MIN_FILTER,l?f.LINEAR:f.LINEAR_MIPMAP_LINEAR);f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);
f.texParameteri(f.TEXTURE_CUBE_MAP,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);f.bindTexture(f.TEXTURE_CUBE_MAP,null);j.resetTextureCache();m._width=d;m._height=d;m.isReady=!0};for(var x=[],y=x._internalCount=0;6>y;y++)g(e[y],y,x,d,c)}return m},l.prototype.updateTextureSize=function(b,c,d){b._width=c;b._height=d;b._size=c*d;b._baseWidth=c;b._baseHeight=d},l.prototype.createRawCubeTexture=function(c,d,g,e,j,f,m,x){var y=this,z=this._gl,A=z.createTexture();d._addPendingData(A);A.isCube=!0;A.references=1;A.url=
c;var B=this._getInternalFormat(e),C=z.UNSIGNED_BYTE;j===l.TEXTURETYPE_FLOAT&&(C=z.FLOAT);var D=g,E=D,I=b.Tools.IsExponentOfTwo(D)&&b.Tools.IsExponentOfTwo(E);A._width=D;A._height=E;return b.Tools.LoadFile(c,function(c){var g=m(c);c=[z.TEXTURE_CUBE_MAP_POSITIVE_X,z.TEXTURE_CUBE_MAP_POSITIVE_Y,z.TEXTURE_CUBE_MAP_POSITIVE_Z,z.TEXTURE_CUBE_MAP_NEGATIVE_X,z.TEXTURE_CUBE_MAP_NEGATIVE_Y,z.TEXTURE_CUBE_MAP_NEGATIVE_Z];if(D=A._width,E=A._height,I=b.Tools.IsExponentOfTwo(D)&&b.Tools.IsExponentOfTwo(E),z.bindTexture(z.TEXTURE_CUBE_MAP,
A),z.pixelStorei(z.UNPACK_FLIP_Y_WEBGL,0),!f&&I)if(x){var e=[];e.push(g[0]);e.push(g[3]);e.push(g[1]);e.push(g[4]);e.push(g[2]);e.push(g[5]);g=x(e);for(e=0;e<g.length;e++){var l=D>>e;z.texImage2D(c[0],e,B,l,l,0,B,C,g[e][0]);z.texImage2D(c[1],e,B,l,l,0,B,C,g[e][2]);z.texImage2D(c[2],e,B,l,l,0,B,C,g[e][4]);z.texImage2D(c[3],e,B,l,l,0,B,C,g[e][1]);z.texImage2D(c[4],e,B,l,l,0,B,C,g[e][3]);z.texImage2D(c[5],e,B,l,l,0,B,C,g[e][5])}}else{for(e=0;e<c.length;e++)l=g[e],z.texImage2D(c[e],0,B,D,E,0,B,C,l);if(z.generateMipmap(z.TEXTURE_CUBE_MAP),
C===z.FLOAT&&B===z.RGB&&1282===z.getError()){b.Tools.Log("RGB32F not renderable on Firefox, trying fallback to RGBA32F.");for(e=0;e<c.length;e++){for(var l=g[e],j=new Float32Array(4*D*E),n=0;D>n;n++)for(var p=0;E>p;p++){var r=3*(p*D+n),t=4*(p*D+n);j[t+0]=l[r+0];j[t+1]=l[r+1];j[t+2]=l[r+2];j[t+3]=1}z.texImage2D(c[e],0,z.RGBA,D,E,0,z.RGBA,C,j)}z.generateMipmap(z.TEXTURE_CUBE_MAP)}}else f=!0;C!==z.FLOAT||y._caps.textureFloatLinearFiltering?(z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_MAG_FILTER,z.LINEAR),
z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_MIN_FILTER,f?z.LINEAR:z.LINEAR_MIPMAP_LINEAR)):(z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_MAG_FILTER,z.NEAREST),z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_MIN_FILTER,z.NEAREST));z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE);z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE);z.bindTexture(z.TEXTURE_CUBE_MAP,null);A.isReady=!0;y.resetTextureCache();d._removePendingData(A)},function(){d._removePendingData(A)},
d.database,!0),A},l.prototype._releaseTexture=function(b){var c=this._gl;b._framebuffer&&c.deleteFramebuffer(b._framebuffer);b._depthBuffer&&c.deleteRenderbuffer(b._depthBuffer);c.deleteTexture(b);this.unbindAllTextures();b=this._loadedTexturesCache.indexOf(b);-1!==b&&this._loadedTexturesCache.splice(b,1)},l.prototype.bindSamplers=function(b){this._gl.useProgram(b.getProgram());for(var c=b.getSamplers(),d=0;d<c.length;d++){var g=b.getUniform(c[d]);this._gl.uniform1i(g,d)}this._currentEffect=null},
l.prototype._bindTexture=function(b,c){0>b||(this._gl.activeTexture(this._gl["TEXTURE"+b]),this._gl.bindTexture(this._gl.TEXTURE_2D,c),this._activeTexturesCache[b]=null)},l.prototype.setTextureFromPostProcess=function(b,c){this._bindTexture(b,c._textures.data[c._currentRenderTextureInd])},l.prototype.unbindAllTextures=function(){for(var b=0;b<this._caps.maxTexturesImageUnits;b++)this._gl.activeTexture(this._gl["TEXTURE"+b]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,
null),this._activeTexturesCache[b]=null},l.prototype.setTexture=function(c,d){if(!(0>c)){if(!d||!d.isReady())return void(null!=this._activeTexturesCache[c]&&(this._gl.activeTexture(this._gl["TEXTURE"+c]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null),this._activeTexturesCache[c]=null));var g=!1;if(d instanceof b.VideoTexture)this._gl.activeTexture(this._gl["TEXTURE"+c]),g=!0,d.update();else if(d.delayLoadState===l.DELAYLOADSTATE_NOTLOADED)return void d.delayLoad();
if(this._activeTexturesCache[c]!==d){this._activeTexturesCache[c]=d;var e=d.getInternalTexture();if(g||this._gl.activeTexture(this._gl["TEXTURE"+c]),e.isCube){if(this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,e),e._cachedCoordinatesMode!==d.coordinatesMode)e._cachedCoordinatesMode=d.coordinatesMode,g=d.coordinatesMode!==b.Texture.CUBIC_MODE&&d.coordinatesMode!==b.Texture.SKYBOX_MODE?this._gl.REPEAT:this._gl.CLAMP_TO_EDGE,this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_S,g),
this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_T,g);this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP,d)}else{if(this._gl.bindTexture(this._gl.TEXTURE_2D,e),e._cachedWrapU!==d.wrapU)switch(e._cachedWrapU=d.wrapU,d.wrapU){case b.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.REPEAT);break;case b.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE);break;case b.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,
this._gl.TEXTURE_WRAP_S,this._gl.MIRRORED_REPEAT)}if(e._cachedWrapV!==d.wrapV)switch(e._cachedWrapV=d.wrapV,d.wrapV){case b.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.REPEAT);break;case b.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);break;case b.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.MIRRORED_REPEAT)}this._setAnisotropicLevel(this._gl.TEXTURE_2D,
d)}}}},l.prototype._setAnisotropicLevel=function(c,d){var g=this._caps.textureAnisotropicFilterExtension,e=d.anisotropicFilteringLevel;d.getInternalTexture().samplingMode===b.Texture.NEAREST_SAMPLINGMODE&&(e=1);g&&d._cachedAnisotropicFilteringLevel!==e&&(this._gl.texParameterf(c,g.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e,this._caps.maxAnisotropy)),d._cachedAnisotropicFilteringLevel=e)},l.prototype.readPixels=function(b,c,d,g){var e=new Uint8Array(4*g*d);return this._gl.readPixels(b,c,d,g,this._gl.RGBA,
this._gl.UNSIGNED_BYTE,e),e},l.prototype.addExternalData=function(b,c){return this._externalData.add(b,c)},l.prototype.getExternalData=function(b){return this._externalData.get(b)},l.prototype.getOrAddExternalDataWithFactory=function(b,c){return this._externalData.getOrAddWithFactory(b,c)},l.prototype.removeExternalData=function(b){return this._externalData.remove(b)},l.prototype.releaseInternalTexture=function(b){if(b&&(b.references--,0===b.references)){var c=this.getLoadedTexturesCache(),d=c.indexOf(b);
-1<d&&c.splice(d,1);this._releaseTexture(b)}},l.prototype.dispose=function(){this.hideLoadingUI();for(this.stopRenderLoop();this.scenes.length;)this.scenes[0].dispose();l.audioEngine.dispose();for(var b in this._compiledEffects)this._gl.deleteProgram(this._compiledEffects[b]._program);if(this._vertexAttribArraysEnabled){b=0;for(var c=this._vertexAttribArraysEnabled.length;c>b;b++)b>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArraysEnabled[b]||this._gl.disableVertexAttribArray(b)}this._gl=
null;window.removeEventListener("blur",this._onBlur);window.removeEventListener("focus",this._onFocus);document.removeEventListener("fullscreenchange",this._onFullscreenChange);document.removeEventListener("mozfullscreenchange",this._onFullscreenChange);document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange);document.removeEventListener("msfullscreenchange",this._onFullscreenChange);document.removeEventListener("pointerlockchange",this._onPointerLockChange);document.removeEventListener("mspointerlockchange",
this._onPointerLockChange);document.removeEventListener("mozpointerlockchange",this._onPointerLockChange);document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange)},l.prototype.displayLoadingUI=function(){this._loadingScreen.displayLoadingUI()},l.prototype.hideLoadingUI=function(){this._loadingScreen.hideLoadingUI()},Object.defineProperty(l.prototype,"loadingScreen",{get:function(){return this._loadingScreen},set:function(b){this._loadingScreen=b},enumerable:!0,configurable:!0}),
Object.defineProperty(l.prototype,"loadingUIText",{set:function(b){this._loadingScreen.loadingUIText=b},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"loadingUIBackgroundColor",{set:function(b){this._loadingScreen.loadingUIBackgroundColor=b},enumerable:!0,configurable:!0}),l.prototype.getFps=function(){return this.fps},l.prototype.getDeltaTime=function(){return this.deltaTime},l.prototype._measureFps=function(){this.previousFramesDuration.push(b.Tools.Now);var c=this.previousFramesDuration.length;
if(2<=c&&(this.deltaTime=this.previousFramesDuration[c-1]-this.previousFramesDuration[c-2]),c>=this.fpsRange){c>this.fpsRange&&(this.previousFramesDuration.splice(0,1),c=this.previousFramesDuration.length);for(var d=0,g=0;c-1>g;g++)d+=this.previousFramesDuration[g+1]-this.previousFramesDuration[g];this.fps=1E3/(d/(c-1))}},l.isSupported=function(){try{if(navigator.isCocoonJS)return!0;var b=document.createElement("canvas");return null!=(b.getContext("webgl")||b.getContext("experimental-webgl"))&&!!window.WebGLRenderingContext}catch(c){return!1}},
l._ALPHA_DISABLE=0,l._ALPHA_ADD=1,l._ALPHA_COMBINE=2,l._ALPHA_SUBTRACT=3,l._ALPHA_MULTIPLY=4,l._ALPHA_MAXIMIZED=5,l._ALPHA_ONEONE=6,l._DELAYLOADSTATE_NONE=0,l._DELAYLOADSTATE_LOADED=1,l._DELAYLOADSTATE_LOADING=2,l._DELAYLOADSTATE_NOTLOADED=4,l._TEXTUREFORMAT_ALPHA=0,l._TEXTUREFORMAT_LUMINANCE=1,l._TEXTUREFORMAT_LUMINANCE_ALPHA=2,l._TEXTUREFORMAT_RGB=4,l._TEXTUREFORMAT_RGBA=5,l._TEXTURETYPE_UNSIGNED_INT=0,l._TEXTURETYPE_FLOAT=1,l.CollisionsEpsilon=0.0010,l.CodeRepository="src/",l.ShadersRepository=
"src/Shaders/",l);b.Engine=j}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(b,c){this.state="";this.animations=[];this._ranges={};this._childrenFlag=-1;this._isReady=this._isEnabled=!0;this._parentRenderId=this._currentRenderId=-1;this.id=this.name=b;this._scene=c;this._initCache()};f=(Object.defineProperty(f.prototype,"parent",{get:function(){return this._parentNode},set:function(b){if(this._parentNode!==b){if(this._parentNode){var c=this._parentNode._children.indexOf(this);-1!==c&&this._parentNode._children.splice(c,1)}(this._parentNode=b)&&
(this._parentNode._children||(this._parentNode._children=[]),this._parentNode._children.push(this))}},enumerable:!0,configurable:!0}),f.prototype.getScene=function(){return this._scene},f.prototype.getEngine=function(){return this._scene.getEngine()},f.prototype.getWorldMatrix=function(){return b.Matrix.Identity()},f.prototype._initCache=function(){this._cache={};this._cache.parent=void 0},f.prototype.updateCache=function(b){!b&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())},
f.prototype._updateCache=function(){},f.prototype._isSynchronized=function(){return!0},f.prototype._markSyncedWithParent=function(){this._parentRenderId=this.parent._currentRenderId},f.prototype.isSynchronizedWithParent=function(){return this.parent?this._parentRenderId!==this.parent._currentRenderId?!1:this.parent.isSynchronized():!0},f.prototype.isSynchronized=function(b){var c=this.hasNewParent();return c=c||!this.isSynchronizedWithParent(),c=c||!this._isSynchronized(),b&&this.updateCache(!0),
!c},f.prototype.hasNewParent=function(b){return this._cache.parent===this.parent?!1:(b&&(this._cache.parent=this.parent),!0)},f.prototype.isReady=function(){return this._isReady},f.prototype.isEnabled=function(){return this._isEnabled?this.parent?this.parent.isEnabled():!0:!1},f.prototype.setEnabled=function(b){this._isEnabled=b},f.prototype.isDescendantOf=function(b){return this.parent?this.parent===b?!0:this.parent.isDescendantOf(b):!1},f.prototype._getDescendants=function(b,c,d){if(void 0===c&&
(c=!1),this._children)for(var g=0;g<this._children.length;g++){var f=this._children[g];d&&!d(f)||b.push(f);c||f._getDescendants(b,!1,d)}},f.prototype.getDescendants=function(b,c){var d=[];return this._getDescendants(d,b,c),d},f.prototype.getChildren=function(b){return this.getDescendants(!0,b)},f.prototype.getChildMeshes=function(e,c){var d=[];return this._getDescendants(d,e,function(d){return(!c||c(d))&&d instanceof b.AbstractMesh}),d},f.prototype._setReady=function(b){if(b!==this._isReady){if(!b)return void(this._isReady=
!1);this._isReady=!0;this.onReady&&this.onReady(this)}},f.prototype.getAnimationByName=function(b){for(var c=0;c<this.animations.length;c++){var d=this.animations[c];if(d.name===b)return d}return null},f.prototype.createAnimationRange=function(e,c,d){if(!this._ranges[e]){this._ranges[e]=new b.AnimationRange(e,c,d);for(var g=0,f=this.animations.length;f>g;g++)this.animations[g]&&this.animations[g].createRange(e,c,d)}},f.prototype.deleteAnimationRange=function(b,c){void 0===c&&(c=!0);for(var d=0,g=
this.animations.length;g>d;d++)this.animations[d]&&this.animations[d].deleteRange(b,c);this._ranges[b]=void 0},f.prototype.getAnimationRange=function(b){return this._ranges[b]},f.prototype.beginAnimation=function(b,c,d,g){return(b=this.getAnimationRange(b))?void this._scene.beginAnimation(this,b.from,b.to,c,d,g):null},f.prototype.serializeAnimationRanges=function(){var b=[],c;for(c in this._ranges){var d={};d.name=c;d.from=this._ranges[c].from;d.to=this._ranges[c].to;b.push(d)}return b},f.prototype.dispose=
function(){this.parent=null},f.ParseAnimationRanges=function(b,c){if(c.ranges)for(var d=0;d<c.ranges.length;d++){var g=c.ranges[d];b.createAnimationRange(g.name,g.from,g.to)}},__decorate([b.serialize()],f.prototype,"name",void 0),__decorate([b.serialize()],f.prototype,"id",void 0),__decorate([b.serialize()],f.prototype,"uniqueId",void 0),__decorate([b.serialize()],f.prototype,"state",void 0),f);b.Node=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(b,d,g,e,j,l,f,q){this._engine=b;this._canvas=g;this._currentScene=d;this._sceneLoadedCallback=e;this._progressCallback=j;this._additionnalRenderLoopLogicCallback=l;this._textureLoadingCallback=f;this._startingProcessingFilesCallback=q};f=(e.prototype.monitorElementForDragNDrop=function(b){var d=this;b&&(this._elementToMonitor=b,this._elementToMonitor.addEventListener("dragenter",function(b){d.drag(b)},!1),this._elementToMonitor.addEventListener("dragover",function(b){d.drag(b)},
!1),this._elementToMonitor.addEventListener("drop",function(b){d.drop(b)},!1))},e.prototype.renderFunction=function(){if(this._additionnalRenderLoopLogicCallback&&this._additionnalRenderLoopLogicCallback(),this._currentScene){if(this._textureLoadingCallback){var b=this._currentScene.getWaitingItemsCount();0<b&&this._textureLoadingCallback(b)}this._currentScene.render()}},e.prototype.drag=function(b){b.stopPropagation();b.preventDefault()},e.prototype.drop=function(b){b.stopPropagation();b.preventDefault();
this.loadFiles(b)},e.prototype.loadFiles=function(b){if(this._startingProcessingFilesCallback&&this._startingProcessingFilesCallback(),b&&b.dataTransfer&&b.dataTransfer.files&&(this._filesToLoad=b.dataTransfer.files),b&&b.target&&b.target.files&&(this._filesToLoad=b.target.files),this._filesToLoad&&0<this._filesToLoad.length){for(b=0;b<this._filesToLoad.length;b++)switch(this._filesToLoad[b].type){case "image/jpeg":case "image/png":case "image/bmp":e.FilesTextures[this._filesToLoad[b].name.toLowerCase()]=
this._filesToLoad[b];break;case "image/targa":case "image/vnd.ms-dds":case "audio/wav":case "audio/x-wav":case "audio/mp3":case "audio/mpeg":case "audio/mpeg3":case "audio/x-mpeg-3":case "audio/ogg":e.FilesToLoad[this._filesToLoad[b].name.toLowerCase()]=this._filesToLoad[b];break;default:-1!==this._filesToLoad[b].name.indexOf(".mtl")?e.FilesToLoad[this._filesToLoad[b].name.toLowerCase()]=this._filesToLoad[b]:-1===this._filesToLoad[b].name.indexOf(".babylon")&&-1===this._filesToLoad[b].name.indexOf(".stl")&&
-1===this._filesToLoad[b].name.indexOf(".obj")||-1!==this._filesToLoad[b].name.indexOf(".manifest")||-1!==this._filesToLoad[b].name.indexOf(".incremental")||-1!==this._filesToLoad[b].name.indexOf(".babylonmeshdata")||-1!==this._filesToLoad[b].name.indexOf(".babylongeometrydata")||-1!==this._filesToLoad[b].name.indexOf(".babylonbinarymeshdata")||-1!==this._filesToLoad[b].name.indexOf(".binary.babylon")||(this._sceneFileToLoad=this._filesToLoad[b])}this.reload()}},e.prototype.reload=function(){var c=
this,d=this;this._sceneFileToLoad?(this._currentScene&&(0<b.Tools.errorsCount&&(b.Tools.ClearLogCache(),b.Tools.Log("Babylon.js engine (v"+b.Engine.Version+") launched")),this._engine.stopRenderLoop(),this._currentScene.dispose()),b.SceneLoader.Load("file:",this._sceneFileToLoad,this._engine,function(b){d._currentScene=b;d._currentScene.executeWhenReady(function(){d._currentScene.activeCamera&&0!==d._currentScene.lights.length||d._currentScene.createDefaultCameraOrLight();d._currentScene.activeCamera.attachControl(d._canvas);
d._sceneLoadedCallback&&d._sceneLoadedCallback(c._sceneFileToLoad,d._currentScene);d._engine.runRenderLoop(function(){d.renderFunction()})})},function(b){c._progressCallback&&c._progressCallback(b)})):b.Tools.Error("Please provide a valid .babylon file.")},e.FilesTextures=[],e.FilesToLoad=[],e);b.FilesInput=f}(BABYLON||(BABYLON={}));
!function(b){b.IntersectionInfo=function(b,c,d){this.bu=b;this.bv=c;this.distance=d;this.subMeshId=this.faceId=0};var f;f=function(){this.hit=!1;this.distance=0;this.pickedMesh=this.pickedPoint=null;this.bv=this.bu=0;this.faceId=-1;this.subMeshId=0;this.pickedSprite=null};f=(f.prototype.getNormal=function(e,c){if(void 0===e&&(e=!1),void 0===c&&(c=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(b.VertexBuffer.NormalKind))return null;var d;d=this.pickedMesh.getIndices();if(c){var g=this.pickedMesh.getVerticesData(b.VertexBuffer.NormalKind),
f=b.Vector3.FromArray(g,3*d[3*this.faceId]),j=b.Vector3.FromArray(g,3*d[3*this.faceId+1]);d=b.Vector3.FromArray(g,3*d[3*this.faceId+2]);f=f.scale(this.bu);j=j.scale(this.bv);d=d.scale(1-this.bu-this.bv);d=new b.Vector3(f.x+j.x+d.x,f.y+j.y+d.y,f.z+j.z+d.z)}else g=this.pickedMesh.getVerticesData(b.VertexBuffer.PositionKind),j=b.Vector3.FromArray(g,3*d[3*this.faceId]),f=b.Vector3.FromArray(g,3*d[3*this.faceId+1]),d=b.Vector3.FromArray(g,3*d[3*this.faceId+2]),j=j.subtract(f),d=d.subtract(f),d=b.Vector3.Cross(j,
d);return e&&(d=b.Vector3.TransformNormal(d,this.pickedMesh.getWorldMatrix())),b.Vector3.Normalize(d)},f.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(b.VertexBuffer.UVKind))return null;var e=this.pickedMesh.getIndices(),c=this.pickedMesh.getVerticesData(b.VertexBuffer.UVKind),d=b.Vector2.FromArray(c,2*e[3*this.faceId]),g=b.Vector2.FromArray(c,2*e[3*this.faceId+1]),e=b.Vector2.FromArray(c,2*e[3*this.faceId+2]);return d=d.scale(1-this.bu-this.bv),
g=g.scale(this.bu),e=e.scale(this.bv),new b.Vector2(d.x+g.x+e.x,d.y+g.y+e.y)},f);b.PickingInfo=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(e,c){this.minimum=e;this.maximum=c;this._tempRadiusVector=b.Vector3.Zero();var d=b.Vector3.Distance(e,c);this.center=b.Vector3.Lerp(e,c,0.5);this.radius=0.5*d;this.centerWorld=b.Vector3.Zero();this._update(b.Matrix.Identity())};f=(f.prototype._update=function(e){b.Vector3.TransformCoordinatesToRef(this.center,e,this.centerWorld);b.Vector3.TransformNormalFromFloatsToRef(1,1,1,e,this._tempRadiusVector);this.radiusWorld=Math.max(Math.abs(this._tempRadiusVector.x),Math.abs(this._tempRadiusVector.y),
Math.abs(this._tempRadiusVector.z))*this.radius},f.prototype.isInFrustum=function(b){for(var c=0;6>c;c++)if(b[c].dotCoordinate(this.centerWorld)<=-this.radiusWorld)return!1;return!0},f.prototype.intersectsPoint=function(e){var c=this.centerWorld.x-e.x,d=this.centerWorld.y-e.y;e=this.centerWorld.z-e.z;c=Math.sqrt(c*c+d*d+e*e);return!(Math.abs(this.radiusWorld-c)<b.Epsilon)},f.Intersects=function(b,c){var d=b.centerWorld.x-c.centerWorld.x,g=b.centerWorld.y-c.centerWorld.y,f=b.centerWorld.z-c.centerWorld.z,
d=Math.sqrt(d*d+g*g+f*f);return!(b.radiusWorld+c.radiusWorld<d)},f);b.BoundingSphere=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(c,d){this.minimum=c;this.maximum=d;this.vectors=[];this.vectorsWorld=[];this.vectors.push(this.minimum.clone());this.vectors.push(this.maximum.clone());this.vectors.push(this.minimum.clone());this.vectors[2].x=this.maximum.x;this.vectors.push(this.minimum.clone());this.vectors[3].y=this.maximum.y;this.vectors.push(this.minimum.clone());this.vectors[4].z=this.maximum.z;this.vectors.push(this.maximum.clone());this.vectors[5].z=this.minimum.z;this.vectors.push(this.maximum.clone());
this.vectors[6].x=this.minimum.x;this.vectors.push(this.maximum.clone());this.vectors[7].y=this.minimum.y;this.center=this.maximum.add(this.minimum).scale(0.5);this.extendSize=this.maximum.subtract(this.minimum).scale(0.5);this.directions=[b.Vector3.Zero(),b.Vector3.Zero(),b.Vector3.Zero()];for(var g=0;g<this.vectors.length;g++)this.vectorsWorld[g]=b.Vector3.Zero();this.minimumWorld=b.Vector3.Zero();this.maximumWorld=b.Vector3.Zero();this._update(b.Matrix.Identity())};f=(e.prototype.getWorldMatrix=
function(){return this._worldMatrix},e.prototype.setWorldMatrix=function(b){return this._worldMatrix.copyFrom(b),this},e.prototype._update=function(c){b.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.minimumWorld);b.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.maximumWorld);for(var d=0;d<this.vectors.length;d++){var g=this.vectorsWorld[d];b.Vector3.TransformCoordinatesToRef(this.vectors[d],c,g);g.x<this.minimumWorld.x&&(this.minimumWorld.x=
g.x);g.y<this.minimumWorld.y&&(this.minimumWorld.y=g.y);g.z<this.minimumWorld.z&&(this.minimumWorld.z=g.z);g.x>this.maximumWorld.x&&(this.maximumWorld.x=g.x);g.y>this.maximumWorld.y&&(this.maximumWorld.y=g.y);g.z>this.maximumWorld.z&&(this.maximumWorld.z=g.z)}this.maximumWorld.addToRef(this.minimumWorld,this.center);this.center.scaleInPlace(0.5);b.Vector3.FromFloatArrayToRef(c.m,0,this.directions[0]);b.Vector3.FromFloatArrayToRef(c.m,4,this.directions[1]);b.Vector3.FromFloatArrayToRef(c.m,8,this.directions[2]);
this._worldMatrix=c},e.prototype.isInFrustum=function(b){return e.IsInFrustum(this.vectorsWorld,b)},e.prototype.isCompletelyInFrustum=function(b){return e.IsCompletelyInFrustum(this.vectorsWorld,b)},e.prototype.intersectsPoint=function(c){var d=-b.Epsilon;return this.maximumWorld.x-c.x<d||d>c.x-this.minimumWorld.x?!1:this.maximumWorld.y-c.y<d||d>c.y-this.minimumWorld.y?!1:!(this.maximumWorld.z-c.z<d||d>c.z-this.minimumWorld.z)},e.prototype.intersectsSphere=function(b){return e.IntersectsSphere(this.minimumWorld,
this.maximumWorld,b.centerWorld,b.radiusWorld)},e.prototype.intersectsMinMax=function(b,d){return this.maximumWorld.x<b.x||this.minimumWorld.x>d.x?!1:this.maximumWorld.y<b.y||this.minimumWorld.y>d.y?!1:!(this.maximumWorld.z<b.z||this.minimumWorld.z>d.z)},e.Intersects=function(b,d){return b.maximumWorld.x<d.minimumWorld.x||b.minimumWorld.x>d.maximumWorld.x?!1:b.maximumWorld.y<d.minimumWorld.y||b.minimumWorld.y>d.maximumWorld.y?!1:!(b.maximumWorld.z<d.minimumWorld.z||b.minimumWorld.z>d.maximumWorld.z)},
e.IntersectsSphere=function(c,d,g,e){c=b.Vector3.Clamp(g,c,d);g=b.Vector3.DistanceSquared(g,c);return e*e>=g},e.IsCompletelyInFrustum=function(b,d){for(var g=0;6>g;g++)for(var e=0;8>e;e++)if(0>d[g].dotCoordinate(b[e]))return!1;return!0},e.IsInFrustum=function(b,d){for(var g=0;6>g;g++){for(var e=8,j=0;8>j&&0>d[g].dotCoordinate(b[j]);j++)--e;if(0===e)return!1}return!0},e);b.BoundingBox=f}(BABYLON||(BABYLON={}));
!function(b){var f=function(c,g){var e=b.Vector3.Dot(g.center,c),j=Math.abs(b.Vector3.Dot(g.directions[0],c))*g.extendSize.x,l=Math.abs(b.Vector3.Dot(g.directions[1],c))*g.extendSize.y,f=Math.abs(b.Vector3.Dot(g.directions[2],c))*g.extendSize.z,j=j+l+f;return{min:e-j,max:e+j}},e=function(b,c,e){c=f(b,c);b=f(b,e);return!(c.min>b.max||b.min>c.max)},c;c=function(c,g){this.minimum=c;this.maximum=g;this._isLocked=!1;this.boundingBox=new b.BoundingBox(c,g);this.boundingSphere=new b.BoundingSphere(c,g)};
c=(Object.defineProperty(c.prototype,"isLocked",{get:function(){return this._isLocked},set:function(b){this._isLocked=b},enumerable:!0,configurable:!0}),c.prototype.update=function(b){this._isLocked||(this.boundingBox._update(b),this.boundingSphere._update(b))},c.prototype.isInFrustum=function(b){return this.boundingSphere.isInFrustum(b)?this.boundingBox.isInFrustum(b):!1},c.prototype.isCompletelyInFrustum=function(b){return this.boundingBox.isCompletelyInFrustum(b)},c.prototype._checkCollision=function(b){return b._canDoCollision(this.boundingSphere.centerWorld,
this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},c.prototype.intersectsPoint=function(b){return this.boundingSphere.centerWorld&&this.boundingSphere.intersectsPoint(b)?!!this.boundingBox.intersectsPoint(b):!1},c.prototype.intersects=function(c,g){if(!this.boundingSphere.centerWorld||!c.boundingSphere.centerWorld||!b.BoundingSphere.Intersects(this.boundingSphere,c.boundingSphere)||!b.BoundingBox.Intersects(this.boundingBox,c.boundingBox))return!1;if(!g)return!0;
var f=this.boundingBox,j=c.boundingBox;return e(f.directions[0],f,j)&&e(f.directions[1],f,j)&&e(f.directions[2],f,j)&&e(j.directions[0],f,j)&&e(j.directions[1],f,j)&&e(j.directions[2],f,j)&&e(b.Vector3.Cross(f.directions[0],j.directions[0]),f,j)&&e(b.Vector3.Cross(f.directions[0],j.directions[1]),f,j)&&e(b.Vector3.Cross(f.directions[0],j.directions[2]),f,j)&&e(b.Vector3.Cross(f.directions[1],j.directions[0]),f,j)&&e(b.Vector3.Cross(f.directions[1],j.directions[1]),f,j)&&e(b.Vector3.Cross(f.directions[1],
j.directions[2]),f,j)&&e(b.Vector3.Cross(f.directions[2],j.directions[0]),f,j)&&e(b.Vector3.Cross(f.directions[2],j.directions[1]),f,j)?!!e(b.Vector3.Cross(f.directions[2],j.directions[2]),f,j):!1},c);b.BoundingInfo=c}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(b,d,g){void 0===g&&(g=Number.MAX_VALUE);this.origin=b;this.direction=d;this.length=g};f=(e.prototype.intersectsBoxMinMax=function(b,d){var g,e,j,l,f=0,q=Number.MAX_VALUE;if(1E-7>Math.abs(this.direction.x)){if(this.origin.x<b.x||this.origin.x>d.x)return!1}else if(g=1/this.direction.x,e=(b.x-this.origin.x)*g,j=(d.x-this.origin.x)*g,j===-(1/0)&&(j=1/0),e>j&&(l=e,e=j,j=l),f=Math.max(e,f),q=Math.min(j,q),f>q)return!1;if(1E-7>Math.abs(this.direction.y)){if(this.origin.y<b.y||
this.origin.y>d.y)return!1}else if(g=1/this.direction.y,e=(b.y-this.origin.y)*g,j=(d.y-this.origin.y)*g,j===-(1/0)&&(j=1/0),e>j&&(l=e,e=j,j=l),f=Math.max(e,f),q=Math.min(j,q),f>q)return!1;if(1E-7>Math.abs(this.direction.z)){if(this.origin.z<b.z||this.origin.z>d.z)return!1}else if(g=1/this.direction.z,e=(b.z-this.origin.z)*g,j=(d.z-this.origin.z)*g,j===-(1/0)&&(j=1/0),e>j&&(l=e,e=j,j=l),f=Math.max(e,f),q=Math.min(j,q),f>q)return!1;return!0},e.prototype.intersectsBox=function(b){return this.intersectsBoxMinMax(b.minimum,
b.maximum)},e.prototype.intersectsSphere=function(b){var d=b.center.x-this.origin.x,g=b.center.y-this.origin.y,e=b.center.z-this.origin.z,j=d*d+g*g+e*e;b=b.radius*b.radius;if(b>=j)return!0;d=d*this.direction.x+g*this.direction.y+e*this.direction.z;return 0>d?!1:b>=j-d*d},e.prototype.intersectsTriangle=function(c,d,g){this._edge1||(this._edge1=b.Vector3.Zero(),this._edge2=b.Vector3.Zero(),this._pvec=b.Vector3.Zero(),this._tvec=b.Vector3.Zero(),this._qvec=b.Vector3.Zero());d.subtractToRef(c,this._edge1);
g.subtractToRef(c,this._edge2);b.Vector3.CrossToRef(this.direction,this._edge2,this._pvec);d=b.Vector3.Dot(this._edge1,this._pvec);if(0===d)return null;d=1/d;this.origin.subtractToRef(c,this._tvec);c=b.Vector3.Dot(this._tvec,this._pvec)*d;if(0>c||1<c)return null;b.Vector3.CrossToRef(this._tvec,this._edge1,this._qvec);g=b.Vector3.Dot(this.direction,this._qvec)*d;if(0>g||1<c+g)return null;d*=b.Vector3.Dot(this._edge2,this._qvec);return d>this.length?null:new b.IntersectionInfo(c,g,d)},e.prototype.intersectsPlane=
function(c){var d,g=b.Vector3.Dot(c.normal,this.direction);if(9.99999997475243E-7>Math.abs(g))return null;var e=b.Vector3.Dot(c.normal,this.origin);return d=(-c.d-e)/g,0>d?-9.99999997475243E-7>d?null:0:d},e.prototype.intersectionSegment=function(c,d,g){var f,j,l=this.origin.add(this.direction.multiplyByFloats(e.rayl,e.rayl,e.rayl));d=d.subtract(c);l=l.subtract(this.origin);c=c.subtract(this.origin);var n=b.Vector3.Dot(d,d),q=b.Vector3.Dot(d,l),p=b.Vector3.Dot(l,l),r=b.Vector3.Dot(d,c),t=b.Vector3.Dot(l,
c),s=n*p-q*q,u=s,x=s;s<e.smallnum?(f=0,u=1,j=t,x=p):(f=q*t-p*r,j=n*t-q*r,0>f?(f=0,j=t,x=p):f>u&&(f=u,j=t+q,x=p));0>j?(j=0,0>-r?f=0:-r>n?f=u:(f=-r,u=n)):j>x&&(j=x,0>-r+q?f=0:-r+q>n?f=u:(f=-r+q,u=n));f=Math.abs(f)<e.smallnum?0:f/u;j=Math.abs(j)<e.smallnum?0:j/x;l=l.multiplyByFloats(j,j,j);d=c.add(d.multiplyByFloats(f,f,f)).subtract(l);return 0<j&&j<=this.length&&d.lengthSquared()<g*g?l.length():-1},e.CreateNew=function(c,d,g,f,j,l,n){var q=b.Vector3.Unproject(new b.Vector3(c,d,0),g,f,j,l,n);c=b.Vector3.Unproject(new b.Vector3(c,
d,1),g,f,j,l,n).subtract(q);return c.normalize(),new e(q,c)},e.CreateNewFromTo=function(c,d,g){void 0===g&&(g=b.Matrix.Identity());d=d.subtract(c);var f=Math.sqrt(d.x*d.x+d.y*d.y+d.z*d.z);return d.normalize(),e.Transform(new e(c,d,f),g)},e.Transform=function(c,d){var g=b.Vector3.TransformCoordinates(c.origin,d),f=b.Vector3.TransformNormal(c.direction,d);return f.normalize(),new e(g,f,c.length)},e.smallnum=1E-8,e.rayl=1E9,e);b.Ray=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.Node,c=function(d,g){var f=this;e.call(this,d,g);this.onDisposeObservable=new b.Observable;this.onCollideObservable=new b.Observable;this.onCollisionPositionChangeObservable=new b.Observable;this.onAfterWorldMatrixUpdateObservable=new b.Observable;this.definedFacingForward=!0;this.position=new b.Vector3(0,0,0);this._rotation=new b.Vector3(0,0,0);this._scaling=new b.Vector3(1,1,1);this.billboardMode=c.BILLBOARDMODE_NONE;this.visibility=1;this.alphaIndex=Number.MAX_VALUE;this.infiniteDistance=
!1;this.isPickable=this.isVisible=!0;this.isBlocker=this.showSubMeshesBoundingBox=this.showBoundingBox=!1;this.renderingGroupId=0;this.renderOutline=this.receiveShadows=!1;this.outlineColor=b.Color3.Red();this.outlineWidth=0.02;this.renderOverlay=!1;this.overlayColor=b.Color3.Red();this.overlayAlpha=0.5;this.hasVertexAlpha=!1;this.computeBonesUsingShaders=this.applyFog=this.useVertexColors=!0;this.scalingDeterminant=1;this.numBoneInfluencers=4;this.useOctreeForCollisions=this.useOctreeForPicking=
this.useOctreeForRenderingSelection=!0;this.layerMask=268435455;this._checkCollisions=this.alwaysSelectAsActiveMesh=!1;this.ellipsoid=new b.Vector3(0.5,1,0.5);this.ellipsoidOffset=new b.Vector3(0,0,0);this._collider=new b.Collider;this._oldPositionForCollisions=new b.Vector3(0,0,0);this._diffPositionForCollisions=new b.Vector3(0,0,0);this._newPositionForCollisions=new b.Vector3(0,0,0);this.edgesWidth=1;this.edgesColor=new b.Color4(1,0,0,1);this._localWorld=b.Matrix.Zero();this._worldMatrix=b.Matrix.Zero();
this._rotateYByPI=b.Matrix.RotationY(Math.PI);this._absolutePosition=b.Vector3.Zero();this._collisionsTransformMatrix=b.Matrix.Zero();this._collisionsScalingMatrix=b.Matrix.Zero();this._isDirty=!1;this._pivotMatrix=b.Matrix.Identity();this._isDisposed=!1;this._renderId=0;this._intersectionsInProgress=[];this._unIndexed=this._isWorldMatrixFrozen=!1;this._onCollisionPositionChange=function(c,d,g){void 0===g&&(g=null);f.getScene().workerCollisions&&d.multiplyInPlace(f._collider.radius);d.subtractToRef(f._oldPositionForCollisions,
f._diffPositionForCollisions);f._diffPositionForCollisions.length()>b.Engine.CollisionsEpsilon&&f.position.addInPlace(f._diffPositionForCollisions);g&&f.onCollideObservable.notifyObservers(g);f.onCollisionPositionChangeObservable.notifyObservers(f.position)};g.addMesh(this)};f=(__extends(c,e),Object.defineProperty(c,"BILLBOARDMODE_NONE",{get:function(){return c._BILLBOARDMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(c,"BILLBOARDMODE_X",{get:function(){return c._BILLBOARDMODE_X},
enumerable:!0,configurable:!0}),Object.defineProperty(c,"BILLBOARDMODE_Y",{get:function(){return c._BILLBOARDMODE_Y},enumerable:!0,configurable:!0}),Object.defineProperty(c,"BILLBOARDMODE_Z",{get:function(){return c._BILLBOARDMODE_Z},enumerable:!0,configurable:!0}),Object.defineProperty(c,"BILLBOARDMODE_ALL",{get:function(){return c._BILLBOARDMODE_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onDispose",{set:function(b){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver);
this._onDisposeObserver=this.onDisposeObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onCollide",{set:function(b){this._onCollideObserver&&this.onCollideObservable.remove(this._onCollideObserver);this._onCollideObserver=this.onCollideObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onCollisionPositionChange",{set:function(b){this._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._onCollisionPositionChangeObserver);
this._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"skeleton",{get:function(){return this._skeleton},set:function(b){this._skeleton&&this._skeleton.needInitialSkinMatrix&&this._skeleton._unregisterMeshWithPoseMatrix(this);b&&b.needInitialSkinMatrix&&b._registerMeshWithPoseMatrix(this);(this._skeleton=b)||(this._bonesTransformMatrices=null)},enumerable:!0,configurable:!0}),c.prototype.toString=function(c){var g=
"Name: "+this.name+", isInstance: "+(this instanceof b.InstancedMesh?"YES":"NO");return g+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0),this._skeleton&&(g+=", skeleton: "+this._skeleton.name),c&&(g+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],g+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingFreezeWorldMatrix?"YES":"NO")),g},Object.defineProperty(c.prototype,"rotation",{get:function(){return this._rotation},set:function(b){this._rotation=
b},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"scaling",{get:function(){return this._scaling},set:function(b){this._scaling=b;this.physicsImpostor&&this.physicsImpostor.forceUpdate()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(b){(this._rotationQuaternion=b)&&this.rotation.length()&&this.rotation.copyFromFloats(0,0,0)},enumerable:!0,configurable:!0}),c.prototype.updatePoseMatrix=
function(b){this._poseMatrix.copyFrom(b)},c.prototype.getPoseMatrix=function(){return this._poseMatrix},c.prototype.disableEdgesRendering=function(){void 0!==this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=void 0)},c.prototype.enableEdgesRendering=function(c,g){void 0===c&&(c=0.95);void 0===g&&(g=!1);this.disableEdgesRendering();this._edgesRenderer=new b.EdgesRenderer(this,c,g)},Object.defineProperty(c.prototype,"isBlocked",{get:function(){return!1},enumerable:!0,configurable:!0}),
c.prototype.getLOD=function(){return this},c.prototype.getTotalVertices=function(){return 0},c.prototype.getIndices=function(){return null},c.prototype.getVerticesData=function(){return null},c.prototype.isVerticesDataPresent=function(){return!1},c.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},Object.defineProperty(c.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&
this.isVerticesDataPresent(b.VertexBuffer.MatricesIndicesKind)&&this.isVerticesDataPresent(b.VertexBuffer.MatricesWeightsKind)},enumerable:!0,configurable:!0}),c.prototype._preActivate=function(){},c.prototype._preActivateForIntermediateRendering=function(){},c.prototype._activate=function(b){this._renderId=b},c.prototype.getWorldMatrix=function(){return this._masterMesh?this._masterMesh.getWorldMatrix():(this._currentRenderId!==this.getScene().getRenderId()&&this.computeWorldMatrix(),this._worldMatrix)},
Object.defineProperty(c.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),c.prototype.freezeWorldMatrix=function(){this._isWorldMatrixFrozen=!1;this.computeWorldMatrix(!0);this._isWorldMatrixFrozen=!0},c.prototype.unfreezeWorldMatrix=function(){this._isWorldMatrixFrozen=!1;this.computeWorldMatrix(!0)},Object.defineProperty(c.prototype,
"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!0,configurable:!0}),c.prototype.rotate=function(c,g,e){c.normalize();this.rotationQuaternion||(this.rotationQuaternion=b.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation=b.Vector3.Zero());e&&e!==b.Space.LOCAL?(this.parent&&(e=this.parent.getWorldMatrix().clone(),e.invert(),c=b.Vector3.TransformNormal(c,e)),c=b.Quaternion.RotationAxis(c,g),this.rotationQuaternion=c.multiply(this.rotationQuaternion)):
(c=b.Quaternion.RotationAxis(c,g),this.rotationQuaternion=this.rotationQuaternion.multiply(c))},c.prototype.translate=function(c,g,e){c=c.scale(g);e&&e!==b.Space.LOCAL?this.setAbsolutePosition(this.getAbsolutePosition().add(c)):(e=this.getPositionExpressedInLocalSpace().add(c),this.setPositionWithLocalVector(e))},c.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},c.prototype.setAbsolutePosition=function(c){if(c){var g,e,j;if(void 0===c.x){if(3>arguments.length)return;
g=arguments[0];e=arguments[1];j=arguments[2]}else g=c.x,e=c.y,j=c.z;if(this.parent){var l=this.parent.getWorldMatrix().clone();l.invert();g=new b.Vector3(g,e,j);this.position=b.Vector3.TransformCoordinates(g,l)}else this.position.x=g,this.position.y=e,this.position.z=j}},c.prototype.movePOV=function(b,c,e){this.position.addInPlace(this.calcMovePOV(b,c,e))},c.prototype.calcMovePOV=function(c,g,e){var j=new b.Matrix;(this.rotationQuaternion?this.rotationQuaternion:b.Quaternion.RotationYawPitchRoll(this.rotation.y,
this.rotation.x,this.rotation.z)).toRotationMatrix(j);var l=b.Vector3.Zero(),f=this.definedFacingForward?-1:1;return b.Vector3.TransformCoordinatesFromFloatsToRef(c*f,g,e*f,j,l),l},c.prototype.rotatePOV=function(b,c,e){this.rotation.addInPlace(this.calcRotatePOV(b,c,e))},c.prototype.calcRotatePOV=function(c,g,e){var j=this.definedFacingForward?1:-1;return new b.Vector3(c*j,g,e*j)},c.prototype.setPivotMatrix=function(b){this._pivotMatrix=b;this._cache.pivotMatrixUpdated=!0},c.prototype.getPivotMatrix=
function(){return this._pivotMatrix},c.prototype._isSynchronized=function(){if(this._isDirty||(this.billboardMode!==this._cache.billboardMode||this.billboardMode!==c.BILLBOARDMODE_NONE)||this._cache.pivotMatrixUpdated||this.infiniteDistance||!this._cache.position.equals(this.position))return!1;if(this.rotationQuaternion){if(!this._cache.rotationQuaternion.equals(this.rotationQuaternion))return!1}else if(!this._cache.rotation.equals(this.rotation))return!1;return!!this._cache.scaling.equals(this.scaling)},
c.prototype._initCache=function(){e.prototype._initCache.call(this);this._cache.localMatrixUpdated=!1;this._cache.position=b.Vector3.Zero();this._cache.scaling=b.Vector3.Zero();this._cache.rotation=b.Vector3.Zero();this._cache.rotationQuaternion=new b.Quaternion(0,0,0,0);this._cache.billboardMode=-1},c.prototype.markAsDirty=function(b){"rotation"===b&&(this.rotationQuaternion=null);this._currentRenderId=Number.MAX_VALUE;this._isDirty=!0},c.prototype._updateBoundingInfo=function(){this._boundingInfo=
this._boundingInfo||new b.BoundingInfo(this.absolutePosition,this.absolutePosition);this._boundingInfo.update(this.worldMatrixFromCache);this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)},c.prototype._updateSubMeshesBoundingInfo=function(b){if(this.subMeshes)for(var c=0;c<this.subMeshes.length;c++){var e=this.subMeshes[c];e.IsGlobal||e.updateBoundingInfo(b)}},c.prototype.computeWorldMatrix=function(d){if(this._isWorldMatrixFrozen)return this._worldMatrix;if(!d&&(this._currentRenderId===
this.getScene().getRenderId()||this.isSynchronized(!0)))return this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix;if(this._cache.position.copyFrom(this.position),this._cache.scaling.copyFrom(this.scaling),this._cache.pivotMatrixUpdated=!1,this._cache.billboardMode=this.billboardMode,this._currentRenderId=this.getScene().getRenderId(),this._isDirty=!1,b.Matrix.ScalingToRef(this.scaling.x*this.scalingDeterminant,this.scaling.y*this.scalingDeterminant,this.scaling.z*this.scalingDeterminant,
b.Tmp.Matrix[1]),this.rotationQuaternion)this.rotation.length()&&(this.rotationQuaternion.multiplyInPlace(b.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)),this.rotation.copyFromFloats(0,0,0));if(this.rotationQuaternion?(this.rotationQuaternion.toRotationMatrix(b.Tmp.Matrix[0]),this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)):(b.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,b.Tmp.Matrix[0]),this._cache.rotation.copyFrom(this.rotation)),
this.infiniteDistance&&!this.parent){if(d=this.getScene().activeCamera)d=d.getWorldMatrix(),d=new b.Vector3(d.m[12],d.m[13],d.m[14]),b.Matrix.TranslationToRef(this.position.x+d.x,this.position.y+d.y,this.position.z+d.z,b.Tmp.Matrix[2])}else b.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,b.Tmp.Matrix[2]);if(this._pivotMatrix.multiplyToRef(b.Tmp.Matrix[1],b.Tmp.Matrix[4]),b.Tmp.Matrix[4].multiplyToRef(b.Tmp.Matrix[0],b.Tmp.Matrix[5]),this.billboardMode!==c.BILLBOARDMODE_NONE&&
this.getScene().activeCamera){b.Tmp.Vector3[0].copyFrom(this.position);d=b.Tmp.Vector3[0];if(this.parent&&this.parent.getWorldMatrix){this._markSyncedWithParent();var g;this._meshToBoneReferal?(this.parent.getWorldMatrix().multiplyToRef(this._meshToBoneReferal.getWorldMatrix(),b.Tmp.Matrix[6]),g=b.Tmp.Matrix[6]):g=this.parent.getWorldMatrix();b.Vector3.TransformNormalToRef(d,g,b.Tmp.Vector3[1]);d=b.Tmp.Vector3[1]}g=this.getScene().activeCamera.globalPosition.clone();this.parent&&this.parent.position&&
(d.addInPlace(this.parent.position),b.Matrix.TranslationToRef(d.x,d.y,d.z,b.Tmp.Matrix[2]));(this.billboardMode&c.BILLBOARDMODE_ALL)!==c.BILLBOARDMODE_ALL&&(this.billboardMode&c.BILLBOARDMODE_X&&(g.x=d.x+b.Epsilon),this.billboardMode&c.BILLBOARDMODE_Y&&(g.y=d.y+b.Epsilon),this.billboardMode&c.BILLBOARDMODE_Z&&(g.z=d.z+b.Epsilon));b.Matrix.LookAtLHToRef(d,g,b.Vector3.Up(),b.Tmp.Matrix[3]);b.Tmp.Matrix[3].m[12]=b.Tmp.Matrix[3].m[13]=b.Tmp.Matrix[3].m[14]=0;b.Tmp.Matrix[3].invert();b.Tmp.Matrix[5].multiplyToRef(b.Tmp.Matrix[3],
this._localWorld);this._rotateYByPI.multiplyToRef(this._localWorld,b.Tmp.Matrix[5])}return b.Tmp.Matrix[5].multiplyToRef(b.Tmp.Matrix[2],this._localWorld),this.parent&&this.parent.getWorldMatrix&&this.billboardMode===c.BILLBOARDMODE_NONE?(this._markSyncedWithParent(),this._meshToBoneReferal?(this._localWorld.multiplyToRef(this.parent.getWorldMatrix(),b.Tmp.Matrix[6]),b.Tmp.Matrix[6].multiplyToRef(this._meshToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localWorld.multiplyToRef(this.parent.getWorldMatrix(),
this._worldMatrix)):this._worldMatrix.copyFrom(this._localWorld),this._updateBoundingInfo(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=b.Matrix.Invert(this._worldMatrix)),this._worldMatrix},c.prototype.registerAfterWorldMatrixUpdate=function(b){this.onAfterWorldMatrixUpdateObservable.add(b)},c.prototype.unregisterAfterWorldMatrixUpdate=
function(b){this.onAfterWorldMatrixUpdateObservable.removeCallback(b)},c.prototype.setPositionWithLocalVector=function(c){this.computeWorldMatrix();this.position=b.Vector3.TransformNormal(c,this._localWorld)},c.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var c=this._localWorld.clone();return c.invert(),b.Vector3.TransformNormal(this.position,c)},c.prototype.locallyTranslate=function(c){this.computeWorldMatrix(!0);this.position=b.Vector3.TransformCoordinates(c,this._localWorld)},
c.prototype.lookAt=function(c,g,e,j){g=g||0;e=e||0;j=j||0;var l=c.subtract(this.position);c=-Math.atan2(l.z,l.x)-Math.PI/2;var f=Math.sqrt(l.x*l.x+l.z*l.z),l=Math.atan2(l.y,f);this.rotationQuaternion=b.Quaternion.RotationYawPitchRoll(c+g,l+e,j)},c.prototype.attachToBone=function(b,c){this._meshToBoneReferal=c;this.parent=b;0>b.getWorldMatrix().determinant()&&(this.scalingDeterminant*=-1)},c.prototype.detachFromBone=function(){0>this.parent.getWorldMatrix().determinant()&&(this.scalingDeterminant*=
-1);this.parent=this._meshToBoneReferal=null},c.prototype.isInFrustum=function(b){return this._boundingInfo.isInFrustum(b)},c.prototype.isCompletelyInFrustum=function(c){c||(c=this.getScene().activeCamera);c=c.getViewMatrix().multiply(c.getProjectionMatrix());return!!this._boundingInfo.isCompletelyInFrustum(b.Frustum.GetPlanes(c))},c.prototype.intersectsMesh=function(b,c){return this._boundingInfo&&b._boundingInfo?this._boundingInfo.intersects(b._boundingInfo,c):!1},c.prototype.intersectsPoint=function(b){return this._boundingInfo?
this._boundingInfo.intersectsPoint(b):!1},c.prototype.setPhysicsState=function(c,g){return c.impostor&&(g=c,c=c.impostor),this.physicsImpostor=new b.PhysicsImpostor(this,c,g,this.getScene()),this.physicsImpostor.physicsBody},c.prototype.getPhysicsImpostor=function(){return this.physicsImpostor},c.prototype.getPhysicsMass=function(){return this.physicsImpostor.getParam("mass")},c.prototype.getPhysicsFriction=function(){return this.physicsImpostor.getParam("friction")},c.prototype.getPhysicsRestitution=
function(){return this.physicsImpostor.getParam("resitution")},c.prototype.getPositionInCameraSpace=function(c){return c||(c=this.getScene().activeCamera),b.Vector3.TransformCoordinates(this.absolutePosition,c.getViewMatrix())},c.prototype.getDistanceToCamera=function(b){return b||(b=this.getScene().activeCamera),this.absolutePosition.subtract(b.position).length()},c.prototype.applyImpulse=function(b,c){this.physicsImpostor&&this.physicsImpostor.applyImpulse(b,c)},c.prototype.setPhysicsLinkWith=function(c,
g,e,j){this.physicsImpostor&&c.physicsImpostor&&this.physicsImpostor.createJoint(c.physicsImpostor,b.PhysicsJoint.HingeJoint,{mainPivot:g,connectedPivot:e,nativeParams:j})},c.prototype.updatePhysicsBodyPosition=function(){b.Tools.Warn("updatePhysicsBodyPosition() is deprecated, please use updatePhysicsBody()");this.updatePhysicsBody()},c.prototype.updatePhysicsBody=function(){},Object.defineProperty(c.prototype,"checkCollisions",{get:function(){return this._checkCollisions},set:function(b){this._checkCollisions=
b;this.getScene().workerCollisions&&this.getScene().collisionCoordinator.onMeshUpdated(this)},enumerable:!0,configurable:!0}),c.prototype.moveWithCollisions=function(b){this.getAbsolutePosition().subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPositionForCollisions);this._oldPositionForCollisions.addInPlace(this.ellipsoidOffset);this._collider.radius=this.ellipsoid;this.getScene().collisionCoordinator.getNewPosition(this._oldPositionForCollisions,b,this._collider,3,this,this._onCollisionPositionChange,
this.uniqueId)},c.prototype.createOrUpdateSubmeshesOctree=function(c,g){void 0===c&&(c=64);void 0===g&&(g=2);this._submeshesOctree||(this._submeshesOctree=new b.Octree(b.Octree.CreationFuncForSubMeshes,c,g));this.computeWorldMatrix(!0);var e=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(e.minimumWorld,e.maximumWorld,this.subMeshes),this._submeshesOctree},c.prototype._collideForSubMesh=function(c,g,e){if(this._generatePointsArray(),!c._lastColliderWorldVertices||!c._lastColliderTransformMatrix.equals(g)){c._lastColliderTransformMatrix=
g.clone();c._lastColliderWorldVertices=[];c._trianglePlanes=[];for(var j=c.verticesStart+c.verticesCount,l=c.verticesStart;j>l;l++)c._lastColliderWorldVertices.push(b.Vector3.TransformCoordinates(this._positions[l],g))}e._collide(c._trianglePlanes,c._lastColliderWorldVertices,this.getIndices(),c.indexStart,c.indexStart+c.indexCount,c.verticesStart,!!c.getMaterial());e.collisionFound&&(e.collidedMesh=this)},c.prototype._processCollisionsForSubMeshes=function(b,c){var e,j;this._submeshesOctree&&this.useOctreeForCollisions?
(j=b.velocityWorldLength+Math.max(b.radius.x,b.radius.y,b.radius.z),e=this._submeshesOctree.intersects(b.basePointWorld,j),j=e.length,e=e.data):(e=this.subMeshes,j=e.length);for(var l=0;j>l;l++){var f=e[l];1<j&&!f._checkCollision(b)||this._collideForSubMesh(f,c,b)}},c.prototype._checkCollision=function(c){this._boundingInfo._checkCollision(c)&&(b.Matrix.ScalingToRef(1/c.radius.x,1/c.radius.y,1/c.radius.z,this._collisionsScalingMatrix),this.worldMatrixFromCache.multiplyToRef(this._collisionsScalingMatrix,
this._collisionsTransformMatrix),this._processCollisionsForSubMeshes(c,this._collisionsTransformMatrix))},c.prototype._generatePointsArray=function(){return!1},c.prototype.intersects=function(c,g){var e=new b.PickingInfo;if(!this.subMeshes||(!this._boundingInfo||!c.intersectsSphere(this._boundingInfo.boundingSphere)||!c.intersectsBox(this._boundingInfo.boundingBox))||!this._generatePointsArray())return e;var j,l,f=null;this._submeshesOctree&&this.useOctreeForPicking?(l=b.Ray.Transform(c,this.getWorldMatrix()),
j=this._submeshesOctree.intersectsRay(l),l=j.length,j=j.data):(j=this.subMeshes,l=j.length);for(var q=0;l>q;q++){var p=j[q];if(!(1<l)||p.canIntersects(c))if((p=p.intersects(c,this._positions,this.getIndices(),g))&&(g||!f||p.distance<f.distance)&&(f=p,f.subMeshId=q,g))break}return f?(j=this.getWorldMatrix(),l=b.Vector3.TransformCoordinates(c.origin,j),q=c.direction.clone(),q=q.scale(f.distance),j=b.Vector3.TransformNormal(q,j),j=l.add(j),e.hit=!0,e.distance=b.Vector3.Distance(l,j),e.pickedPoint=j,
e.pickedMesh=this,e.bu=f.bu,e.bv=f.bv,e.faceId=f.faceId,e.subMeshId=f.subMeshId,e):e},c.prototype.clone=function(){return null},c.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=[]},c.prototype.dispose=function(b){var c,f=this;this.actionManager&&(this.actionManager.dispose(),this.actionManager=null);this.skeleton=null;this.getScene().stopAnimation(this);this.physicsImpostor&&this.physicsImpostor.dispose();for(c=0;c<
this._intersectionsInProgress.length;c++){var j=this._intersectionsInProgress[c],l=j._intersectionsInProgress.indexOf(this);j._intersectionsInProgress.splice(l,1)}this._intersectionsInProgress=[];if(this.getScene().lights.forEach(function(b){var c=b.includedOnlyMeshes.indexOf(f);-1!==c&&b.includedOnlyMeshes.splice(c,1);c=b.excludedMeshes.indexOf(f);-1!==c&&b.excludedMeshes.splice(c,1)}),this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=null),this.releaseSubMeshes(),this.getScene().removeMesh(this),
b){b=this.getChildMeshes(!0);for(c=0;c<b.length;c++)j=b[c],j.parent=null,j.computeWorldMatrix(!0)}else{for(c=0;c<this.getScene().particleSystems.length;c++)this.getScene().particleSystems[c].emitter===this&&(this.getScene().particleSystems[c].dispose(),c--);b=this.getDescendants(!0);for(c=0;c<b.length;c++)b[c].dispose()}e.prototype.dispose.call(this);this.onAfterWorldMatrixUpdateObservable.clear();this.onCollideObservable.clear();this.onCollisionPositionChangeObservable.clear();this._isDisposed=!0;
this.onDisposeObservable.notifyObservers(this);this.onDisposeObservable.clear()},c._BILLBOARDMODE_NONE=0,c._BILLBOARDMODE_X=1,c._BILLBOARDMODE_Y=2,c._BILLBOARDMODE_Z=4,c._BILLBOARDMODE_ALL=7,c);b.AbstractMesh=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.Node,c=function(c,g){e.call(this,c,g);this.diffuse=new b.Color3(1,1,1);this.specular=new b.Color3(1,1,1);this.intensity=1;this.range=Number.MAX_VALUE;this.includeOnlyWithLayerMask=0;this.includedOnlyMeshes=[];this.excludedMeshes=[];this.excludeWithLayerMask=0;this.radius=1E-5;this._excludedMeshesIds=[];this._includedOnlyMeshesIds=[];g.addLight(this)};f=(__extends(c,e),c.prototype.toString=function(b){var c="Name: "+this.name;if(c+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],
this.animations)for(var e=0;e<this.animations.length;e++)c+=", animation[0]: "+this.animations[e].toString(b);return c},c.prototype.getShadowGenerator=function(){return this._shadowGenerator},c.prototype.getAbsolutePosition=function(){return b.Vector3.Zero()},c.prototype.transferToEffect=function(){},c.prototype._getWorldMatrix=function(){return b.Matrix.Identity()},c.prototype.canAffectMesh=function(b){return b?0<this.includedOnlyMeshes.length&&-1===this.includedOnlyMeshes.indexOf(b)?!1:0<this.excludedMeshes.length&&
-1!==this.excludedMeshes.indexOf(b)?!1:0!==this.includeOnlyWithLayerMask&&0===(this.includeOnlyWithLayerMask&b.layerMask)?!1:!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&b.layerMask):!0},c.prototype.getWorldMatrix=function(){this._currentRenderId=this.getScene().getRenderId();var c=this._getWorldMatrix();return this.parent&&this.parent.getWorldMatrix?(this._parentedWorldMatrix||(this._parentedWorldMatrix=b.Matrix.Identity()),c.multiplyToRef(this.parent.getWorldMatrix(),this._parentedWorldMatrix),
this._markSyncedWithParent(),this._parentedWorldMatrix):c},c.prototype.dispose=function(){this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null);this.getScene().stopAnimation(this);this.getScene().removeLight(this);e.prototype.dispose.call(this)},c.prototype.getTypeID=function(){return 0},c.prototype.clone=function(d){return b.SerializationHelper.Clone(c.GetConstructorFromName(this.getTypeID(),d,this.getScene()),this)},c.prototype.serialize=function(){var c=b.SerializationHelper.Serialize(this);
return c.type=this.getTypeID(),this.parent&&(c.parentId=this.parent.id),0<this.excludedMeshes.length&&(c.excludedMeshesIds=[],this.excludedMeshes.forEach(function(b){c.excludedMeshesIds.push(b.id)})),0<this.includedOnlyMeshes.length&&(c.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(function(b){c.includedOnlyMeshesIds.push(b.id)})),b.Animation.AppendSerializedAnimations(this,c),c.ranges=this.serializeAnimationRanges(),c},c.GetConstructorFromName=function(c,g,e){switch(c){case 0:return function(){return new b.PointLight(g,
b.Vector3.Zero(),e)};case 1:return function(){return new b.DirectionalLight(g,b.Vector3.Zero(),e)};case 2:return function(){return new b.SpotLight(g,b.Vector3.Zero(),b.Vector3.Zero(),0,0,e)};case 3:return function(){return new b.HemisphericLight(g,b.Vector3.Zero(),e)}}},c.Parse=function(d,g){var e=b.SerializationHelper.Parse(c.GetConstructorFromName(d.type,d.name,g),d,g);if(d.excludedMeshesIds&&(e._excludedMeshesIds=d.excludedMeshesIds),d.includedOnlyMeshesIds&&(e._includedOnlyMeshesIds=d.includedOnlyMeshesIds),
d.parentId&&(e._waitingParentId=d.parentId),d.animations){for(var j=0;j<d.animations.length;j++)e.animations.push(b.Animation.Parse(d.animations[j]));b.Node.ParseAnimationRanges(e,d,g)}return d.autoAnimate&&g.beginAnimation(e,d.autoAnimateFrom,d.autoAnimateTo,d.autoAnimateLoop,d.autoAnimateSpeed||1),e},__decorate([b.serializeAsColor3()],c.prototype,"diffuse",void 0),__decorate([b.serializeAsColor3()],c.prototype,"specular",void 0),__decorate([b.serialize()],c.prototype,"intensity",void 0),__decorate([b.serialize()],
c.prototype,"range",void 0),__decorate([b.serialize()],c.prototype,"includeOnlyWithLayerMask",void 0),__decorate([b.serialize()],c.prototype,"excludeWithLayerMask",void 0),__decorate([b.serialize()],c.prototype,"radius",void 0),c);b.Light=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.Light;f=function(b,d,g){e.call(this,b,g);this.position=d};f=(__extends(f,e),f.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},f.prototype.computeTransformedPosition=function(){return this.parent&&this.parent.getWorldMatrix?(this.transformedPosition||(this.transformedPosition=b.Vector3.Zero()),b.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),!0):!1},f.prototype.transferToEffect=
function(b,d){return this.parent&&this.parent.getWorldMatrix?(this.computeTransformedPosition(),void b.setFloat4(d,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0)):void b.setFloat4(d,this.position.x,this.position.y,this.position.z,0)},f.prototype.needCube=function(){return!0},f.prototype.supportsVSM=function(){return!1},f.prototype.needRefreshPerFrame=function(){return!1},f.prototype.getShadowDirection=function(c){switch(c){case 0:return new b.Vector3(1,0,0);case 1:return new b.Vector3(-1,
0,0);case 2:return new b.Vector3(0,-1,0);case 3:return new b.Vector3(0,1,0);case 4:return new b.Vector3(0,0,1);case 5:return new b.Vector3(0,0,-1)}return b.Vector3.Zero()},f.prototype.setShadowProjectionMatrix=function(c){var d=this.getScene().activeCamera;b.Matrix.PerspectiveFovLHToRef(Math.PI/2,1,d.minZ,d.maxZ,c)},f.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=b.Matrix.Identity()),b.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),
this._worldMatrix},f.prototype.getTypeID=function(){return 0},__decorate([b.serializeAsVector3()],f.prototype,"position",void 0),f);b.PointLight=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.Light;f=function(b,d,g,f,j,l){e.call(this,b,l);this.position=d;this.direction=g;this.angle=f;this.exponent=j};f=(__extends(f,e),f.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},f.prototype.setShadowProjectionMatrix=function(c){var d=this.getScene().activeCamera;b.Matrix.PerspectiveFovLHToRef(this.angle,1,d.minZ,d.maxZ,c)},f.prototype.needCube=function(){return!1},f.prototype.supportsVSM=function(){return!0},f.prototype.needRefreshPerFrame=
function(){return!1},f.prototype.getShadowDirection=function(){return this.direction},f.prototype.setDirectionToTarget=function(c){return this.direction=b.Vector3.Normalize(c.subtract(this.position)),this.direction},f.prototype.computeTransformedPosition=function(){return this.parent&&this.parent.getWorldMatrix?(this.transformedPosition||(this.transformedPosition=b.Vector3.Zero()),b.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),!0):!1},f.prototype.transferToEffect=
function(c,d,g){var e;this.parent&&this.parent.getWorldMatrix?(this._transformedDirection||(this._transformedDirection=b.Vector3.Zero()),this.computeTransformedPosition(),b.Vector3.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this._transformedDirection),c.setFloat4(d,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent),e=b.Vector3.Normalize(this._transformedDirection)):(c.setFloat4(d,this.position.x,this.position.y,this.position.z,this.exponent),
e=b.Vector3.Normalize(this.direction));c.setFloat4(g,e.x,e.y,e.z,Math.cos(0.5*this.angle))},f.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=b.Matrix.Identity()),b.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},f.prototype.getTypeID=function(){return 2},__decorate([b.serializeAsVector3()],f.prototype,"position",void 0),__decorate([b.serializeAsVector3()],f.prototype,"direction",void 0),__decorate([b.serialize()],
f.prototype,"angle",void 0),__decorate([b.serialize()],f.prototype,"exponent",void 0),f);b.SpotLight=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.Light;f=function(c,d,g){e.call(this,c,g);this.groundColor=new b.Color3(0,0,0);this.direction=d};f=(__extends(f,e),f.prototype.setDirectionToTarget=function(c){return this.direction=b.Vector3.Normalize(c.subtract(b.Vector3.Zero())),this.direction},f.prototype.getShadowGenerator=function(){return null},f.prototype.transferToEffect=function(c,d,g){var e=b.Vector3.Normalize(this.direction);c.setFloat4(d,e.x,e.y,e.z,0);c.setColor3(g,this.groundColor.scale(this.intensity))},f.prototype._getWorldMatrix=
function(){return this._worldMatrix||(this._worldMatrix=b.Matrix.Identity()),this._worldMatrix},f.prototype.getTypeID=function(){return 3},__decorate([b.serializeAsColor3()],f.prototype,"groundColor",void 0),__decorate([b.serializeAsVector3()],f.prototype,"direction",void 0),f);b.HemisphericLight=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.Light;f=function(b,d,g){e.call(this,b,g);this.shadowOrthoScale=0.5;this.autoUpdateExtends=!0;this._orthoLeft=Number.MAX_VALUE;this._orthoTop=this._orthoRight=Number.MIN_VALUE;this._orthoBottom=Number.MAX_VALUE;this.position=d.scale(-1);this.direction=d};f=(__extends(f,e),f.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},f.prototype.setDirectionToTarget=function(c){return this.direction=b.Vector3.Normalize(c.subtract(this.position)),
this.direction},f.prototype.setShadowProjectionMatrix=function(c,d,g){var e=this.getScene().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){var j=b.Vector3.Zero();this._orthoLeft=Number.MAX_VALUE;this._orthoTop=this._orthoRight=Number.MIN_VALUE;this._orthoBottom=Number.MAX_VALUE;for(var l=0;l<g.length;l++){var f=g[l];if(f&&(f=f.getBoundingInfo()))for(var f=f.boundingBox,q=0;q<f.vectorsWorld.length;q++)b.Vector3.TransformCoordinatesToRef(f.vectorsWorld[q],d,j),j.x<this._orthoLeft&&
(this._orthoLeft=j.x),j.y<this._orthoBottom&&(this._orthoBottom=j.y),j.x>this._orthoRight&&(this._orthoRight=j.x),j.y>this._orthoTop&&(this._orthoTop=j.y)}}d=this._orthoRight-this._orthoLeft;g=this._orthoTop-this._orthoBottom;b.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-d*this.shadowOrthoScale,this._orthoRight+d*this.shadowOrthoScale,this._orthoBottom-g*this.shadowOrthoScale,this._orthoTop+g*this.shadowOrthoScale,-e.maxZ,e.maxZ,c)},f.prototype.supportsVSM=function(){return!0},f.prototype.needRefreshPerFrame=
function(){return!0},f.prototype.needCube=function(){return!1},f.prototype.getShadowDirection=function(){return this.direction},f.prototype.computeTransformedPosition=function(){return this.parent&&this.parent.getWorldMatrix?(this.transformedPosition||(this.transformedPosition=b.Vector3.Zero()),b.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),!0):!1},f.prototype.transferToEffect=function(c,d){return this.parent&&this.parent.getWorldMatrix?(this._transformedDirection||
(this._transformedDirection=b.Vector3.Zero()),b.Vector3.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this._transformedDirection),void c.setFloat4(d,this._transformedDirection.x,this._transformedDirection.y,this._transformedDirection.z,1)):void c.setFloat4(d,this.direction.x,this.direction.y,this.direction.z,1)},f.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=b.Matrix.Identity()),b.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,
this._worldMatrix),this._worldMatrix},f.prototype.getTypeID=function(){return 1},__decorate([b.serializeAsVector3()],f.prototype,"position",void 0),__decorate([b.serializeAsVector3()],f.prototype,"direction",void 0),__decorate([b.serialize()],f.prototype,"shadowOrthoScale",void 0),__decorate([b.serialize()],f.prototype,"autoUpdateExtends",void 0),f);b.DirectionalLight=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(c,d){var g=this;this._filter=e.FILTER_NONE;this.blurScale=2;this._blurBoxOffset=0;this._bias=5E-5;this._lightDirection=b.Vector3.Zero();this.forceBackFacesOnly=!1;this._darkness=0;this._transparencyShadow=!1;this._viewMatrix=b.Matrix.Zero();this._projectionMatrix=b.Matrix.Zero();this._transformMatrix=b.Matrix.Zero();this._worldViewProjection=b.Matrix.Zero();this._currentFaceIndexCache=this._currentFaceIndex=0;this._light=d;this._scene=d.getScene();this._mapSize=c;d._shadowGenerator=
this;this._shadowMap=new b.RenderTargetTexture(d.name+"_shadowMap",c,this._scene,!1,!0,b.Engine.TEXTURETYPE_UNSIGNED_INT,d.needCube());this._shadowMap.wrapU=b.Texture.CLAMP_ADDRESSMODE;this._shadowMap.wrapV=b.Texture.CLAMP_ADDRESSMODE;this._shadowMap.anisotropicFilteringLevel=1;this._shadowMap.updateSamplingMode(b.Texture.NEAREST_SAMPLINGMODE);this._shadowMap.renderParticles=!1;this._shadowMap.onBeforeRenderObservable.add(function(b){g._currentFaceIndex=b});this._shadowMap.onAfterUnbindObservable.add(function(){g.useBlurVarianceShadowMap&&
(g._shadowMap2||(g._shadowMap2=new b.RenderTargetTexture(d.name+"_shadowMap",c,g._scene,!1),g._shadowMap2.wrapU=b.Texture.CLAMP_ADDRESSMODE,g._shadowMap2.wrapV=b.Texture.CLAMP_ADDRESSMODE,g._shadowMap2.updateSamplingMode(b.Texture.TRILINEAR_SAMPLINGMODE),g._downSamplePostprocess=new b.PassPostProcess("downScale",1/g.blurScale,null,b.Texture.BILINEAR_SAMPLINGMODE,g._scene.getEngine()),g._downSamplePostprocess.onApplyObservable.add(function(b){b.setTexture("textureSampler",g._shadowMap)}),g.blurBoxOffset=
1),g._scene.postProcessManager.directRender([g._downSamplePostprocess,g._boxBlurPostprocess],g._shadowMap2.getInternalTexture()))});var f=function(c){var d=c.getRenderingMesh(),e=g._scene,f=e.getEngine();f.setState(c.getMaterial().backFaceCulling);var m=d._getInstancesRenderList(c._id);if(!m.mustReturn){var r=null!==f.getCaps().instancedArrays&&null!==m.visibleInstances[c._id]&&void 0!==m.visibleInstances[c._id];if(g.isReady(c,r)){f.enableEffect(g._effect);d._bind(c,g._effect,b.Material.TriangleFillMode);
var t=c.getMaterial();if(g._effect.setMatrix("viewProjection",g.getTransformMatrix()),g._effect.setVector3("lightPosition",g.getLight().position),g.getLight().needCube()&&g._effect.setFloat2("depthValues",e.activeCamera.minZ,e.activeCamera.maxZ),t&&t.needAlphaTesting())e=t.getAlphaTestTexture(),g._effect.setTexture("diffuseSampler",e),g._effect.setMatrix("diffuseMatrix",e.getTextureMatrix());d.useBones&&d.computeBonesUsingShaders&&g._effect.setMatrices("mBones",d.skeleton.getTransformMatrices(d));
g.forceBackFacesOnly&&f.setState(!0,0,!1,!0);d._processRendering(c,g._effect,b.Material.TriangleFillMode,m,r,function(b,c){return g._effect.setMatrix("world",c)});g.forceBackFacesOnly&&f.setState(!0,0,!1,!1)}else g._shadowMap.resetRefreshCounter()}};this._shadowMap.customRenderFunction=function(b,c,d){var e;for(e=0;e<b.length;e++)f(b.data[e]);for(e=0;e<c.length;e++)f(c.data[e]);if(g._transparencyShadow)for(e=0;e<d.length;e++)f(d.data[e])};this._shadowMap.onClearObservable.add(function(c){g.useBlurVarianceShadowMap||
g.useVarianceShadowMap?c.clear(new b.Color4(0,0,0,0),!0,!0):c.clear(new b.Color4(1,1,1,1),!0,!0)})};f=(Object.defineProperty(e,"FILTER_NONE",{get:function(){return e._FILTER_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(e,"FILTER_VARIANCESHADOWMAP",{get:function(){return e._FILTER_VARIANCESHADOWMAP},enumerable:!0,configurable:!0}),Object.defineProperty(e,"FILTER_POISSONSAMPLING",{get:function(){return e._FILTER_POISSONSAMPLING},enumerable:!0,configurable:!0}),Object.defineProperty(e,
"FILTER_BLURVARIANCESHADOWMAP",{get:function(){return e._FILTER_BLURVARIANCESHADOWMAP},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bias",{get:function(){return this._bias},set:function(b){this._bias=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurBoxOffset",{get:function(){return this._blurBoxOffset},set:function(c){var d=this;this._blurBoxOffset!==c&&(this._blurBoxOffset=c,this._boxBlurPostprocess&&this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=
new b.PostProcess("DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1/this.blurScale,null,b.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define OFFSET "+c),this._boxBlurPostprocess.onApplyObservable.add(function(b){b.setFloat2("screenSize",d._mapSize/d.blurScale,d._mapSize/d.blurScale)}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filter",{get:function(){return this._filter},set:function(c){this._filter!==c&&(this._filter=c,this.useVarianceShadowMap||
this.useBlurVarianceShadowMap||this.usePoissonSampling?(this._shadowMap.anisotropicFilteringLevel=16,this._shadowMap.updateSamplingMode(b.Texture.BILINEAR_SAMPLINGMODE)):(this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(b.Texture.NEAREST_SAMPLINGMODE)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useVarianceShadowMap",{get:function(){return this.filter===e.FILTER_VARIANCESHADOWMAP&&this._light.supportsVSM()},set:function(b){this.filter=b?e.FILTER_VARIANCESHADOWMAP:
e.FILTER_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usePoissonSampling",{get:function(){return this.filter===e.FILTER_POISSONSAMPLING||!this._light.supportsVSM()&&(this.filter===e.FILTER_VARIANCESHADOWMAP||this.filter===e.FILTER_BLURVARIANCESHADOWMAP)},set:function(b){this.filter=b?e.FILTER_POISSONSAMPLING:e.FILTER_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBlurVarianceShadowMap",{get:function(){return this.filter===e.FILTER_BLURVARIANCESHADOWMAP&&
this._light.supportsVSM()},set:function(b){this.filter=b?e.FILTER_BLURVARIANCESHADOWMAP:e.FILTER_NONE},enumerable:!0,configurable:!0}),e.prototype.isReady=function(c,d){var g=[];(this.useVarianceShadowMap||this.useBlurVarianceShadowMap)&&g.push("#define VSM");this.getLight().needCube()&&g.push("#define CUBEMAP");var e=[b.VertexBuffer.PositionKind],j=c.getMesh(),l=c.getMaterial();l&&l.needAlphaTesting()&&(g.push("#define ALPHATEST"),j.isVerticesDataPresent(b.VertexBuffer.UVKind)&&(e.push(b.VertexBuffer.UVKind),
g.push("#define UV1")),j.isVerticesDataPresent(b.VertexBuffer.UV2Kind)&&(e.push(b.VertexBuffer.UV2Kind),g.push("#define UV2")));j.useBones&&j.computeBonesUsingShaders?(e.push(b.VertexBuffer.MatricesIndicesKind),e.push(b.VertexBuffer.MatricesWeightsKind),4<j.numBoneInfluencers&&(e.push(b.VertexBuffer.MatricesIndicesExtraKind),e.push(b.VertexBuffer.MatricesWeightsExtraKind)),g.push("#define NUM_BONE_INFLUENCERS "+j.numBoneInfluencers),g.push("#define BonesPerMesh "+(j.skeleton.bones.length+1))):g.push("#define NUM_BONE_INFLUENCERS 0");
d&&(g.push("#define INSTANCES"),e.push("world0"),e.push("world1"),e.push("world2"),e.push("world3"));g=g.join("\n");return this._cachedDefines!==g&&(this._cachedDefines=g,this._effect=this._scene.getEngine().createEffect("shadowMap",e,"world mBones viewProjection diffuseMatrix lightPosition depthValues".split(" "),["diffuseSampler"],g)),this._effect.isReady()},e.prototype.getShadowMap=function(){return this._shadowMap},e.prototype.getShadowMapForRendering=function(){return this._shadowMap2?this._shadowMap2:
this._shadowMap},e.prototype.getLight=function(){return this._light},e.prototype.getTransformMatrix=function(){var c=this._scene;if(this._currentRenderID===c.getRenderId()&&this._currentFaceIndexCache===this._currentFaceIndex)return this._transformMatrix;this._currentRenderID=c.getRenderId();this._currentFaceIndexCache=this._currentFaceIndex;c=this._light.position;return b.Vector3.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex),this._lightDirection),1===Math.abs(b.Vector3.Dot(this._lightDirection,
b.Vector3.Up()))&&(this._lightDirection.z=1E-13),this._light.computeTransformedPosition()&&(c=this._light.transformedPosition),!this._light.needRefreshPerFrame()&&this._cachedPosition&&this._cachedDirection&&c.equals(this._cachedPosition)&&this._lightDirection.equals(this._cachedDirection)||(this._cachedPosition=c.clone(),this._cachedDirection=this._lightDirection.clone(),b.Matrix.LookAtLHToRef(c,c.add(this._lightDirection),b.Vector3.Up(),this._viewMatrix),this._light.setShadowProjectionMatrix(this._projectionMatrix,
this._viewMatrix,this.getShadowMap().renderList),this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)),this._transformMatrix},e.prototype.getDarkness=function(){return this._darkness},e.prototype.setDarkness=function(b){1<=b?this._darkness=1:0>=b?this._darkness=0:this._darkness=b},e.prototype.setTransparencyShadow=function(b){this._transparencyShadow=b},e.prototype._packHalf=function(c){var d=255*c,d=d-Math.floor(d);return new b.Vector2(c-d/255,d)},e.prototype.dispose=function(){this._shadowMap.dispose();
this._shadowMap2&&this._shadowMap2.dispose();this._downSamplePostprocess&&this._downSamplePostprocess.dispose();this._boxBlurPostprocess&&this._boxBlurPostprocess.dispose()},e.prototype.serialize=function(){var b={};b.lightId=this._light.id;b.mapSize=this.getShadowMap().getRenderSize();b.useVarianceShadowMap=this.useVarianceShadowMap;b.usePoissonSampling=this.usePoissonSampling;b.forceBackFacesOnly=this.forceBackFacesOnly;b.renderList=[];for(var d=0;d<this.getShadowMap().renderList.length;d++){var g=
this.getShadowMap().renderList[d];b.renderList.push(g.id)}return b},e.Parse=function(b,d){for(var g=d.getLightByID(b.lightId),f=new e(b.mapSize,g),g=0;g<b.renderList.length;g++)d.getMeshesByID(b.renderList[g]).forEach(function(b){f.getShadowMap().renderList.push(b)});return b.usePoissonSampling?f.usePoissonSampling=!0:b.useVarianceShadowMap?f.useVarianceShadowMap=!0:b.useBlurVarianceShadowMap&&(f.useBlurVarianceShadowMap=!0,b.blurScale&&(f.blurScale=b.blurScale),b.blurBoxOffset&&(f.blurBoxOffset=
b.blurBoxOffset)),void 0!==b.bias&&(f.bias=b.bias),f.forceBackFacesOnly=b.forceBackFacesOnly,f},e._FILTER_NONE=0,e._FILTER_VARIANCESHADOWMAP=1,e._FILTER_POISSONSAMPLING=2,e._FILTER_BLURVARIANCESHADOWMAP=3,e);b.ShadowGenerator=f}(BABYLON||(BABYLON={}));
!function(b){var f=function(b,d,g,e){var j=d*d-4*b*g;g={root:0,found:!1};if(0>j)return g;var l=Math.sqrt(j),j=(-d-l)/(2*b);b=(-d+l)/(2*b);j>b&&(d=b,b=j,j=d);return 0<j&&e>j?(g.root=j,g.found=!0,g):0<b&&e>b?(g.root=b,g.found=!0,g):g},e;e=function(){this.radius=new b.Vector3(1,1,1);this.retry=0;this.basePointWorld=b.Vector3.Zero();this.velocityWorld=b.Vector3.Zero();this.normalizedVelocity=b.Vector3.Zero();this._collisionPoint=b.Vector3.Zero();this._planeIntersectionPoint=b.Vector3.Zero();this._tempVector=
b.Vector3.Zero();this._tempVector2=b.Vector3.Zero();this._tempVector3=b.Vector3.Zero();this._tempVector4=b.Vector3.Zero();this._edge=b.Vector3.Zero();this._baseToVertex=b.Vector3.Zero();this._destinationPoint=b.Vector3.Zero();this._slidePlaneNormal=b.Vector3.Zero();this._displacementVector=b.Vector3.Zero()};e=(e.prototype._initialize=function(c,d,g){this.velocity=d;b.Vector3.NormalizeToRef(d,this.normalizedVelocity);this.basePoint=c;c.multiplyToRef(this.radius,this.basePointWorld);d.multiplyToRef(this.radius,
this.velocityWorld);this.velocityWorldLength=this.velocityWorld.length();this.epsilon=g;this.collisionFound=!1},e.prototype._checkPointInTriangle=function(c,d,g,e,j){d.subtractToRef(c,this._tempVector);g.subtractToRef(c,this._tempVector2);b.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);d=b.Vector3.Dot(this._tempVector4,j);return 0>d?!1:(e.subtractToRef(c,this._tempVector3),b.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),d=b.Vector3.Dot(this._tempVector4,
j),0>d?!1:(b.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),d=b.Vector3.Dot(this._tempVector4,j),0<=d))},e.prototype._canDoCollision=function(c,d,g,e){c=b.Vector3.Distance(this.basePointWorld,c);var j=Math.max(this.radius.x,this.radius.y,this.radius.z);return c>this.velocityWorldLength+j+d?!1:!!(g.x>this.basePointWorld.x+(this.velocityWorldLength+j)?0:this.basePointWorld.x-(this.velocityWorldLength+j)>e.x?0:g.y>this.basePointWorld.y+(this.velocityWorldLength+j)?0:this.basePointWorld.y-
(this.velocityWorldLength+j)>e.y?0:g.z>this.basePointWorld.z+(this.velocityWorldLength+j)?0:!(this.basePointWorld.z-(this.velocityWorldLength+j)>e.z))},e.prototype._testTriangle=function(c,d,g,e,j,l){var n,q=!1;d||(d=[]);d[c]||(d[c]=new b.Plane(0,0,0,0),d[c].copyFromPoints(g,e,j));d=d[c];if(l||d.isFrontFacingTo(this.normalizedVelocity,0)){l=d.signedDistanceTo(this.basePoint);c=b.Vector3.Dot(d.normal,this.velocity);if(0==c){if(1<=Math.abs(l))return;q=!0;n=0}else{n=(-1-l)/c;l=(1-l)/c;n>l&&(c=l,l=n,
n=c);if(1<n||0>l)return;0>n&&(n=0);1<n&&(n=1)}this._collisionPoint.copyFromFloats(0,0,0);l=!1;c=1;if(q||(this.basePoint.subtractToRef(d.normal,this._planeIntersectionPoint),this.velocity.scaleToRef(n,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,g,e,j,d.normal)&&(l=!0,c=n,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!l){d=q=this.velocity.lengthSquared();this.basePoint.subtractToRef(g,this._tempVector);
n=2*b.Vector3.Dot(this.velocity,this._tempVector);var p=this._tempVector.lengthSquared()-1,r=f(d,n,p,c);r.found&&(c=r.root,l=!0,this._collisionPoint.copyFrom(g));this.basePoint.subtractToRef(e,this._tempVector);n=2*b.Vector3.Dot(this.velocity,this._tempVector);p=this._tempVector.lengthSquared()-1;r=f(d,n,p,c);r.found&&(c=r.root,l=!0,this._collisionPoint.copyFrom(e));this.basePoint.subtractToRef(j,this._tempVector);n=2*b.Vector3.Dot(this.velocity,this._tempVector);p=this._tempVector.lengthSquared()-
1;r=f(d,n,p,c);r.found&&(c=r.root,l=!0,this._collisionPoint.copyFrom(j));e.subtractToRef(g,this._edge);g.subtractToRef(this.basePoint,this._baseToVertex);var t=this._edge.lengthSquared(),s=b.Vector3.Dot(this._edge,this.velocity),u=b.Vector3.Dot(this._edge,this._baseToVertex);if(d=t*-q+s*s,n=t*2*b.Vector3.Dot(this.velocity,this._baseToVertex)-2*s*u,p=t*(1-this._baseToVertex.lengthSquared())+u*u,r=f(d,n,p,c),r.found){var x=(s*r.root-u)/t;0<=x&&1>=x&&(c=r.root,l=!0,this._edge.scaleInPlace(x),g.addToRef(this._edge,
this._collisionPoint))}j.subtractToRef(e,this._edge);e.subtractToRef(this.basePoint,this._baseToVertex);t=this._edge.lengthSquared();s=b.Vector3.Dot(this._edge,this.velocity);u=b.Vector3.Dot(this._edge,this._baseToVertex);d=t*-q+s*s;n=t*2*b.Vector3.Dot(this.velocity,this._baseToVertex)-2*s*u;p=t*(1-this._baseToVertex.lengthSquared())+u*u;r=f(d,n,p,c);r.found&&(x=(s*r.root-u)/t,0<=x&&1>=x&&(c=r.root,l=!0,this._edge.scaleInPlace(x),e.addToRef(this._edge,this._collisionPoint)));g.subtractToRef(j,this._edge);
j.subtractToRef(this.basePoint,this._baseToVertex);t=this._edge.lengthSquared();s=b.Vector3.Dot(this._edge,this.velocity);u=b.Vector3.Dot(this._edge,this._baseToVertex);d=t*-q+s*s;n=t*2*b.Vector3.Dot(this.velocity,this._baseToVertex)-2*s*u;p=t*(1-this._baseToVertex.lengthSquared())+u*u;r=f(d,n,p,c);r.found&&(x=(s*r.root-u)/t,0<=x&&1>=x&&(c=r.root,l=!0,this._edge.scaleInPlace(x),j.addToRef(this._edge,this._collisionPoint)))}l&&(g=c*this.velocity.length(),(!this.collisionFound||g<this.nearestDistance)&&
(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this.nearestDistance=g,this.collisionFound=!0))}},e.prototype._collide=function(b,d,g,e,j,l,f){for(;j>e;e+=3)this._testTriangle(e,b,d[g[e+2]-l],d[g[e+1]-l],d[g[e]-l],f)},e.prototype._getResponse=function(c,d){c.addToRef(d,this._destinationPoint);d.scaleInPlace(this.nearestDistance/d.length());this.basePoint.addToRef(d,c);c.subtractToRef(this.intersectionPoint,this._slidePlaneNormal);
this._slidePlaneNormal.normalize();this._slidePlaneNormal.scaleToRef(this.epsilon,this._displacementVector);c.addInPlace(this._displacementVector);this.intersectionPoint.addInPlace(this._displacementVector);this._slidePlaneNormal.scaleInPlace(b.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint));this._destinationPoint.subtractInPlace(this._slidePlaneNormal);this._destinationPoint.subtractToRef(this.intersectionPoint,d)},e);b.Collider=
e}(BABYLON||(BABYLON={}));
!function(b){b.CollisionWorker="";var f=b.WorkerTaskType||(b.WorkerTaskType={});f[f.INIT=0]="INIT";f[f.UPDATE=1]="UPDATE";f[f.COLLIDE=2]="COLLIDE";var e=b.WorkerTaskType,f=b.WorkerReplyType||(b.WorkerReplyType={});f[f.SUCCESS=0]="SUCCESS";f[f.UNKNOWN_ERROR=1]="UNKNOWN_ERROR";!0;var c=b.WorkerReplyType,d=function(){var g=this;this._scaledPosition=b.Vector3.Zero();this._scaledVelocity=b.Vector3.Zero();this.onMeshUpdated=function(b){g._addUpdateMeshesList[b.uniqueId]=d.SerializeMesh(b)};this.onGeometryUpdated=
function(b){g._addUpdateGeometriesList[b.id]=d.SerializeGeometry(b)};this._afterRender=function(){if(g._init&&!(0==g._toRemoveGeometryArray.length&&0==g._toRemoveMeshesArray.length&&0==Object.keys(g._addUpdateGeometriesList).length&&0==Object.keys(g._addUpdateMeshesList).length||4<g._runningUpdated)){++g._runningUpdated;var b={updatedMeshes:g._addUpdateMeshesList,updatedGeometries:g._addUpdateGeometriesList,removedGeometries:g._toRemoveGeometryArray,removedMeshes:g._toRemoveMeshesArray},c={payload:b,
taskType:e.UPDATE},d=[],f;for(f in b.updatedGeometries)b.updatedGeometries.hasOwnProperty(f)&&(d.push(c.payload.updatedGeometries[f].indices.buffer),d.push(c.payload.updatedGeometries[f].normals.buffer),d.push(c.payload.updatedGeometries[f].positions.buffer));g._worker.postMessage(c,d);g._addUpdateMeshesList={};g._addUpdateGeometriesList={};g._toRemoveGeometryArray=[];g._toRemoveMeshesArray=[]}};this._onMessageFromWorker=function(d){d=d.data;if(d.error!=c.SUCCESS)return void b.Tools.Warn("error returned from worker!");
switch(d.taskType){case e.INIT:g._init=!0;g._scene.meshes.forEach(function(b){g.onMeshAdded(b)});g._scene.getGeometries().forEach(function(b){g.onGeometryAdded(b)});break;case e.UPDATE:g._runningUpdated--;break;case e.COLLIDE:g._runningCollisionTask=!1;d=d.payload;if(!g._collisionsCallbackArray[d.collisionId])break;g._collisionsCallbackArray[d.collisionId](d.collisionId,b.Vector3.FromArray(d.newPosition),g._scene.getMeshByUniqueID(d.collidedMeshUniqueId));g._collisionsCallbackArray[d.collisionId]=
void 0}};this._collisionsCallbackArray=[];this._init=!1;this._runningUpdated=0;this._runningCollisionTask=!1;this._addUpdateMeshesList={};this._addUpdateGeometriesList={};this._toRemoveGeometryArray=[];this._toRemoveMeshesArray=[]},f=(d.prototype.getNewPosition=function(b,c,d,l,f,q,p){this._init&&(!this._collisionsCallbackArray[p]&&!this._collisionsCallbackArray[p+1E5])&&(b.divideToRef(d.radius,this._scaledPosition),c.divideToRef(d.radius,this._scaledVelocity),this._collisionsCallbackArray[p]=q,b=
{payload:{collider:{position:this._scaledPosition.asArray(),velocity:this._scaledVelocity.asArray(),radius:d.radius.asArray()},collisionId:p,excludedMeshUniqueId:f?f.uniqueId:null,maximumRetry:l},taskType:e.COLLIDE},this._worker.postMessage(b))},d.prototype.init=function(c){this._scene=c;this._scene.registerAfterRender(this._afterRender);c=b.WorkerIncluded?b.Engine.CodeRepository+"Collisions/babylon.collisionWorker.js":URL.createObjectURL(new Blob([b.CollisionWorker],{type:"application/javascript"}));
this._worker=new Worker(c);this._worker.onmessage=this._onMessageFromWorker;this._worker.postMessage({payload:{},taskType:e.INIT})},d.prototype.destroy=function(){this._scene.unregisterAfterRender(this._afterRender);this._worker.terminate()},d.prototype.onMeshAdded=function(b){b.registerAfterWorldMatrixUpdate(this.onMeshUpdated);this.onMeshUpdated(b)},d.prototype.onMeshRemoved=function(b){this._toRemoveMeshesArray.push(b.uniqueId)},d.prototype.onGeometryAdded=function(b){b.onGeometryUpdated=this.onGeometryUpdated;
this.onGeometryUpdated(b)},d.prototype.onGeometryDeleted=function(b){this._toRemoveGeometryArray.push(b.id)},d.SerializeMesh=function(b){var c=[];b.subMeshes&&(c=b.subMeshes.map(function(b,c){return{position:c,verticesStart:b.verticesStart,verticesCount:b.verticesCount,indexStart:b.indexStart,indexCount:b.indexCount,hasMaterial:!!b.getMaterial(),sphereCenter:b.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:b.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:b.getBoundingInfo().boundingBox.minimumWorld.asArray(),
boxMaximum:b.getBoundingInfo().boundingBox.maximumWorld.asArray()}}));return{uniqueId:b.uniqueId,id:b.id,name:b.name,geometryId:null,sphereCenter:b.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:b.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:b.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:b.getBoundingInfo().boundingBox.maximumWorld.asArray(),worldMatrixFromCache:b.worldMatrixFromCache.asArray(),subMeshes:c,checkCollisions:b.checkCollisions}},d.SerializeGeometry=
function(c){return{id:c.id,positions:new Float32Array(c.getVerticesData(b.VertexBuffer.PositionKind)||[]),normals:new Float32Array(c.getVerticesData(b.VertexBuffer.NormalKind)||[]),indices:new Int32Array(c.getIndices()||[])}},d);b.CollisionCoordinatorWorker=f;f=function(){this._scaledPosition=b.Vector3.Zero();this._scaledVelocity=b.Vector3.Zero();this._finalPosition=b.Vector3.Zero()};f=(f.prototype.getNewPosition=function(b,c,d,e,f,q,p){b.divideToRef(d.radius,this._scaledPosition);c.divideToRef(d.radius,
this._scaledVelocity);d.collidedMesh=null;d.retry=0;d.initialVelocity=this._scaledVelocity;d.initialPosition=this._scaledPosition;this._collideWithWorld(this._scaledPosition,this._scaledVelocity,d,e,this._finalPosition,f);this._finalPosition.multiplyInPlace(d.radius);q(p,this._finalPosition,d.collidedMesh)},f.prototype.init=function(b){this._scene=b},f.prototype.destroy=function(){},f.prototype.onMeshAdded=function(){},f.prototype.onMeshUpdated=function(){},f.prototype.onMeshRemoved=function(){},
f.prototype.onGeometryAdded=function(){},f.prototype.onGeometryUpdated=function(){},f.prototype.onGeometryDeleted=function(){},f.prototype._collideWithWorld=function(c,d,e,l,f,q){void 0===q&&(q=null);var p=10*b.Engine.CollisionsEpsilon;if(e.retry>=l)return void f.copyFrom(c);e._initialize(c,d,p);for(var r=0;r<this._scene.meshes.length;r++){var t=this._scene.meshes[r];t.isEnabled()&&t.checkCollisions&&t.subMeshes&&t!==q&&t._checkCollision(e)}return e.collisionFound?(0===d.x&&0===d.y&&0===d.z||e._getResponse(c,
d),d.length()<=p?void f.copyFrom(c):(e.retry++,void this._collideWithWorld(c,d,e,l,f,q))):void c.addToRef(d,f)},f);b.CollisionCoordinatorLegacy=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.Node,c=function(d,g,f){e.call(this,d,f);this.upVector=b.Vector3.Up();this.orthoTop=this.orthoBottom=this.orthoRight=this.orthoLeft=null;this.fov=0.8;this.minZ=1;this.maxZ=1E4;this.inertia=0.9;this.mode=c.PERSPECTIVE_CAMERA;this.isIntermediate=!1;this.viewport=new b.Viewport(0,0,1,1);this.layerMask=268435455;this.fovMode=c.FOVMODE_VERTICAL_FIXED;this.cameraRigMode=c.RIG_MODE_NONE;this._rigCameras=[];this._computedViewMatrix=b.Matrix.Identity();this._projectionMatrix=new b.Matrix;
this._postProcesses=[];this._activeMeshes=new b.SmartArray(256);this._globalPosition=b.Vector3.Zero();f.addCamera(this);f.activeCamera||(f.activeCamera=this);this.position=g};f=(__extends(c,e),Object.defineProperty(c,"PERSPECTIVE_CAMERA",{get:function(){return c._PERSPECTIVE_CAMERA},enumerable:!0,configurable:!0}),Object.defineProperty(c,"ORTHOGRAPHIC_CAMERA",{get:function(){return c._ORTHOGRAPHIC_CAMERA},enumerable:!0,configurable:!0}),Object.defineProperty(c,"FOVMODE_VERTICAL_FIXED",{get:function(){return c._FOVMODE_VERTICAL_FIXED},
enumerable:!0,configurable:!0}),Object.defineProperty(c,"FOVMODE_HORIZONTAL_FIXED",{get:function(){return c._FOVMODE_HORIZONTAL_FIXED},enumerable:!0,configurable:!0}),Object.defineProperty(c,"RIG_MODE_NONE",{get:function(){return c._RIG_MODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(c,"RIG_MODE_STEREOSCOPIC_ANAGLYPH",{get:function(){return c._RIG_MODE_STEREOSCOPIC_ANAGLYPH},enumerable:!0,configurable:!0}),Object.defineProperty(c,"RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL",{get:function(){return c._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL},
enumerable:!0,configurable:!0}),Object.defineProperty(c,"RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED",{get:function(){return c._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED},enumerable:!0,configurable:!0}),Object.defineProperty(c,"RIG_MODE_STEREOSCOPIC_OVERUNDER",{get:function(){return c._RIG_MODE_STEREOSCOPIC_OVERUNDER},enumerable:!0,configurable:!0}),Object.defineProperty(c,"RIG_MODE_VR",{get:function(){return c._RIG_MODE_VR},enumerable:!0,configurable:!0}),c.prototype.toString=function(b){var c="Name: "+
this.name;if(c+=", type: "+this.getTypeName(),this.animations)for(var e=0;e<this.animations.length;e++)c+=", animation[0]: "+this.animations[e].toString(b);return c},Object.defineProperty(c.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!0,configurable:!0}),c.prototype.getActiveMeshes=function(){return this._activeMeshes},c.prototype.isActiveMesh=function(b){return-1!==this._activeMeshes.indexOf(b)},c.prototype._initCache=function(){e.prototype._initCache.call(this);
this._cache.position=new b.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this._cache.upVector=new b.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this._cache.mode=void 0;this._cache.minZ=void 0;this._cache.maxZ=void 0;this._cache.fov=void 0;this._cache.aspectRatio=void 0;this._cache.orthoLeft=void 0;this._cache.orthoRight=void 0;this._cache.orthoBottom=void 0;this._cache.orthoTop=void 0;this._cache.renderWidth=void 0;this._cache.renderHeight=void 0},c.prototype._updateCache=
function(b){b||e.prototype._updateCache.call(this);b=this.getEngine();this._cache.position.copyFrom(this.position);this._cache.upVector.copyFrom(this.upVector);this._cache.mode=this.mode;this._cache.minZ=this.minZ;this._cache.maxZ=this.maxZ;this._cache.fov=this.fov;this._cache.aspectRatio=b.getAspectRatio(this);this._cache.orthoLeft=this.orthoLeft;this._cache.orthoRight=this.orthoRight;this._cache.orthoBottom=this.orthoBottom;this._cache.orthoTop=this.orthoTop;this._cache.renderWidth=b.getRenderWidth();
this._cache.renderHeight=b.getRenderHeight()},c.prototype._updateFromScene=function(){this.updateCache();this._update()},c.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},c.prototype._isSynchronizedViewMatrix=function(){return e.prototype._isSynchronized.call(this)?this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent():!1},c.prototype._isSynchronizedProjectionMatrix=
function(){if(!(this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ))return!1;var b=this.getEngine();return this.mode===c.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.aspectRatio===b.getAspectRatio(this):this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===b.getRenderWidth()&&this._cache.renderHeight===b.getRenderHeight()},
c.prototype.attachControl=function(){},c.prototype.detachControl=function(){},c.prototype._update=function(){this.cameraRigMode!==c.RIG_MODE_NONE&&this._updateRigCameras();this._checkInputs()},c.prototype._checkInputs=function(){},c.prototype._cascadePostProcessesToRigCams=function(){0<this._postProcesses.length&&this._postProcesses[0].markTextureDirty();for(var c=0,g=this._rigCameras.length;g>c;c++){var e=this._rigCameras[c],f=e._rigPostProcess;f?(f instanceof b.PassPostProcess&&(e.isIntermediate=
0===this._postProcesses.length),e._postProcesses=this._postProcesses.slice(0).concat(f),f.markTextureDirty()):e._postProcesses=this._postProcesses.slice(0)}},c.prototype.attachPostProcess=function(c,g){return void 0===g&&(g=null),!c.isReusable()&&-1<this._postProcesses.indexOf(c)?(b.Tools.Error("You're trying to reuse a post process not defined as reusable."),0):(null==g||0>g?this._postProcesses.push(c):this._postProcesses.splice(g,0,c),this._cascadePostProcessesToRigCams(),this._postProcesses.indexOf(c))},
c.prototype.detachPostProcess=function(b,c){void 0===c&&(c=null);var e,f=[];if(c){c=c instanceof Array?c:[c];for(e=c.length-1;0<=e;e--)this._postProcesses[c[e]]===b?this._postProcesses.splice(void 0,1):f.push(e)}else e=this._postProcesses.indexOf(b),-1!==e&&this._postProcesses.splice(e,1);return this._cascadePostProcessesToRigCams(),f},c.prototype.getWorldMatrix=function(){this._worldMatrix||(this._worldMatrix=b.Matrix.Identity());return this.getViewMatrix().invertToRef(this._worldMatrix),this._worldMatrix},
c.prototype._getViewMatrix=function(){return b.Matrix.Identity()},c.prototype.getViewMatrix=function(c){return this._computedViewMatrix=this._computeViewMatrix(c),!c&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this.parent&&this.parent.getWorldMatrix?(this._worldMatrix||(this._worldMatrix=b.Matrix.Identity()),this._computedViewMatrix.invertToRef(this._worldMatrix),this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._computedViewMatrix),this._globalPosition.copyFromFloats(this._computedViewMatrix.m[12],
this._computedViewMatrix.m[13],this._computedViewMatrix.m[14]),this._computedViewMatrix.invert(),this._markSyncedWithParent()):this._globalPosition.copyFrom(this.position),this._currentRenderId=this.getScene().getRenderId(),this._computedViewMatrix)},c.prototype._computeViewMatrix=function(b){return!b&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._computedViewMatrix)},c.prototype.getProjectionMatrix=
function(d){if(!d&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;var g=this.getEngine();if(this.mode===c.PERSPECTIVE_CAMERA)return 0>=this.minZ&&(this.minZ=0.1),b.Matrix.PerspectiveFovLHToRef(this.fov,g.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===c.FOVMODE_VERTICAL_FIXED),this._projectionMatrix;d=g.getRenderWidth()/2;g=g.getRenderHeight()/2;return b.Matrix.OrthoOffCenterLHToRef(this.orthoLeft||-d,this.orthoRight||d,this.orthoBottom||-g,this.orthoTop||
g,this.minZ,this.maxZ,this._projectionMatrix),this._projectionMatrix},c.prototype.dispose=function(){this.getScene().stopAnimation(this);for(this.getScene().removeCamera(this);0<this._rigCameras.length;)this._rigCameras.pop().dispose();for(var b=0;b<this._postProcesses.length;++b)this._postProcesses[b].dispose(this);e.prototype.dispose.call(this)},c.prototype.setCameraRigMode=function(d,g){for(;0<this._rigCameras.length;)this._rigCameras.pop().dispose();switch(this.cameraRigMode=d,this._cameraRigParams=
{},this._cameraRigParams.interaxialDistance=g.interaxialDistance||0.0637,this._cameraRigParams.stereoHalfAngle=b.Tools.ToRadians(this._cameraRigParams.interaxialDistance/0.0637),this.cameraRigMode!==c.RIG_MODE_NONE&&(this._rigCameras.push(this.createRigCamera(this.name+"_L",0)),this._rigCameras.push(this.createRigCamera(this.name+"_R",1))),this.cameraRigMode){case c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:this._rigCameras[0]._rigPostProcess=new b.PassPostProcess(this.name+"_passthru",1,this._rigCameras[0]);
this._rigCameras[1]._rigPostProcess=new b.AnaglyphPostProcess(this.name+"_anaglyph",1,this._rigCameras);break;case c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case c.RIG_MODE_STEREOSCOPIC_OVERUNDER:var e=this.cameraRigMode===c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL||this.cameraRigMode===c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED;this._rigCameras[0]._rigPostProcess=new b.PassPostProcess(this.name+"_passthru",1,this._rigCameras[0]);this._rigCameras[1]._rigPostProcess=
new b.StereoscopicInterlacePostProcess(this.name+"_stereoInterlace",this._rigCameras,e);break;case c.RIG_MODE_VR:e=g.vrCameraMetrics||b.VRCameraMetrics.GetDefault(),this._rigCameras[0]._cameraRigParams.vrMetrics=e,this._rigCameras[0].viewport=new b.Viewport(0,0,0.5,1),this._rigCameras[0]._cameraRigParams.vrWorkMatrix=new b.Matrix,this._rigCameras[0]._cameraRigParams.vrHMatrix=e.leftHMatrix,this._rigCameras[0]._cameraRigParams.vrPreViewMatrix=e.leftPreViewMatrix,this._rigCameras[0].getProjectionMatrix=
this._rigCameras[0]._getVRProjectionMatrix,this._rigCameras[1]._cameraRigParams.vrMetrics=e,this._rigCameras[1].viewport=new b.Viewport(0.5,0,0.5,1),this._rigCameras[1]._cameraRigParams.vrWorkMatrix=new b.Matrix,this._rigCameras[1]._cameraRigParams.vrHMatrix=e.rightHMatrix,this._rigCameras[1]._cameraRigParams.vrPreViewMatrix=e.rightPreViewMatrix,this._rigCameras[1].getProjectionMatrix=this._rigCameras[1]._getVRProjectionMatrix,e.compensateDistortion&&(this._rigCameras[0]._rigPostProcess=new b.VRDistortionCorrectionPostProcess("VR_Distort_Compensation_Left",
this._rigCameras[0],!1,e),this._rigCameras[1]._rigPostProcess=new b.VRDistortionCorrectionPostProcess("VR_Distort_Compensation_Right",this._rigCameras[1],!0,e))}this._cascadePostProcessesToRigCams();this._update()},c.prototype._getVRProjectionMatrix=function(){return b.Matrix.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,
this._projectionMatrix),this._projectionMatrix},c.prototype.setCameraRigParameter=function(c,g){this._cameraRigParams||(this._cameraRigParams={});this._cameraRigParams[c]=g;"interaxialDistance"===c&&(this._cameraRigParams.stereoHalfAngle=b.Tools.ToRadians(g/0.0637))},c.prototype.createRigCamera=function(){return null},c.prototype._updateRigCameras=function(){for(var b=0;b<this._rigCameras.length;b++)this._rigCameras[b].minZ=this.minZ,this._rigCameras[b].maxZ=this.maxZ,this._rigCameras[b].fov=this.fov;
this.cameraRigMode===c.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},c.prototype._setupInputs=function(){},c.prototype.serialize=function(){var c=b.SerializationHelper.Serialize(this);return c.type=this.getTypeName(),this.parent&&(c.parentId=this.parent.id),this.inputs&&this.inputs.serialize(c),b.Animation.AppendSerializedAnimations(this,c),c.ranges=this.serializeAnimationRanges(),c},c.prototype.getTypeName=function(){return"Camera"},c.prototype.clone=
function(d){return b.SerializationHelper.Clone(c.GetConstructorFromName(this.getTypeName(),d,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this)},c.GetConstructorFromName=function(c,g,e,f,l){switch(void 0===f&&(f=0),void 0===l&&(l=!0),c){case "ArcRotateCamera":return function(){return new b.ArcRotateCamera(g,0,0,1,b.Vector3.Zero(),e)};case "DeviceOrientationCamera":return function(){return new b.DeviceOrientationCamera(g,b.Vector3.Zero(),e)};case "FollowCamera":return function(){return new b.FollowCamera(g,
b.Vector3.Zero(),e)};case "ArcFollowCamera":return function(){return new b.ArcFollowCamera(g,0,0,1,null,e)};case "GamepadCamera":return function(){return new b.GamepadCamera(g,b.Vector3.Zero(),e)};case "TouchCamera":return function(){return new b.TouchCamera(g,b.Vector3.Zero(),e)};case "VirtualJoysticksCamera":return function(){return new b.VirtualJoysticksCamera(g,b.Vector3.Zero(),e)};case "WebVRFreeCamera":return function(){return new b.WebVRFreeCamera(g,b.Vector3.Zero(),e)};case "VRDeviceOrientationFreeCamera":return function(){return new b.VRDeviceOrientationFreeCamera(g,
b.Vector3.Zero(),e)};case "AnaglyphArcRotateCamera":return function(){return new b.AnaglyphArcRotateCamera(g,0,0,1,b.Vector3.Zero(),f,e)};case "AnaglyphFreeCamera":return function(){return new b.AnaglyphFreeCamera(g,b.Vector3.Zero(),f,e)};case "AnaglyphGamepadCamera":return function(){return new b.AnaglyphGamepadCamera(g,b.Vector3.Zero(),f,e)};case "AnaglyphUniversalCamera":return function(){return new b.AnaglyphUniversalCamera(g,b.Vector3.Zero(),f,e)};case "StereoscopicArcRotateCamera":return function(){return new b.StereoscopicArcRotateCamera(g,
0,0,1,b.Vector3.Zero(),f,l,e)};case "StereoscopicFreeCamera":return function(){return new b.StereoscopicFreeCamera(g,b.Vector3.Zero(),f,l,e)};case "StereoscopicGamepadCamera":return function(){return new b.StereoscopicGamepadCamera(g,b.Vector3.Zero(),f,l,e)};case "StereoscopicUniversalCamera":return function(){return new b.StereoscopicUniversalCamera(g,b.Vector3.Zero(),f,l,e)};case "FreeCamera":return function(){return new b.UniversalCamera(g,b.Vector3.Zero(),e)};default:return function(){return new b.UniversalCamera(g,
b.Vector3.Zero(),e)}}},c.Parse=function(d,g){var e=c.GetConstructorFromName(d.type,d.name,g,d.interaxial_distance,d.isStereoscopicSideBySide),e=b.SerializationHelper.Parse(e,d,g);if(d.parentId&&(e._waitingParentId=d.parentId),e.inputs&&(e.inputs.parse(d),e._setupInputs()),d.target&&e.setTarget&&e.setTarget(b.Vector3.FromArray(d.target)),d.cameraRigMode)e.setCameraRigMode(d.cameraRigMode,d.interaxial_distance?{interaxialDistance:d.interaxial_distance}:{});if(d.animations){for(var f=0;f<d.animations.length;f++)e.animations.push(b.Animation.Parse(d.animations[f]));
b.Node.ParseAnimationRanges(e,d,g)}return d.autoAnimate&&g.beginAnimation(e,d.autoAnimateFrom,d.autoAnimateTo,d.autoAnimateLoop,d.autoAnimateSpeed||1),e},c._PERSPECTIVE_CAMERA=0,c._ORTHOGRAPHIC_CAMERA=1,c._FOVMODE_VERTICAL_FIXED=0,c._FOVMODE_HORIZONTAL_FIXED=1,c._RIG_MODE_NONE=0,c._RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,c._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,c._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,c._RIG_MODE_STEREOSCOPIC_OVERUNDER=13,c._RIG_MODE_VR=20,c.ForceAttachControlToAlwaysPreventDefault=
!1,__decorate([b.serializeAsVector3()],c.prototype,"position",void 0),__decorate([b.serializeAsVector3()],c.prototype,"upVector",void 0),__decorate([b.serialize()],c.prototype,"orthoLeft",void 0),__decorate([b.serialize()],c.prototype,"orthoRight",void 0),__decorate([b.serialize()],c.prototype,"orthoBottom",void 0),__decorate([b.serialize()],c.prototype,"orthoTop",void 0),__decorate([b.serialize()],c.prototype,"fov",void 0),__decorate([b.serialize()],c.prototype,"minZ",void 0),__decorate([b.serialize()],
c.prototype,"maxZ",void 0),__decorate([b.serialize()],c.prototype,"inertia",void 0),__decorate([b.serialize()],c.prototype,"mode",void 0),__decorate([b.serialize()],c.prototype,"layerMask",void 0),__decorate([b.serialize()],c.prototype,"fovMode",void 0),__decorate([b.serialize()],c.prototype,"cameraRigMode",void 0),__decorate([b.serialize()],c.prototype,"interaxialDistance",void 0),__decorate([b.serialize()],c.prototype,"isStereoscopicSideBySide",void 0),c);b.Camera=f}(BABYLON||(BABYLON={}));
!function(b){b.CameraInputTypes={};var f;f=function(b){this.attached={};this.camera=b;this.checkInputs=function(){}};f=(f.prototype.add=function(e){var c=e.getSimpleName();return this.attached[c]?void b.Tools.Warn("camera input of type "+c+" already exists on camera"):(this.attached[c]=e,e.camera=this.camera,e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e))),void(this.attachedElement&&e.attachControl(this.attachedElement)))},f.prototype.remove=function(b){for(var c in this.attached){var d=
this.attached[c];d===b&&(d.detachControl(this.attachedElement),delete this.attached[c],this.rebuildInputCheck())}},f.prototype.removeByType=function(b){for(var c in this.attached){var d=this.attached[c];d.getTypeName()===b&&(d.detachControl(this.attachedElement),delete this.attached[c],this.rebuildInputCheck())}},f.prototype._addCheckInputs=function(b){var c=this.checkInputs;return function(){c();b()}},f.prototype.attachInput=function(b){b.attachControl(this.attachedElement,this.noPreventDefault)},
f.prototype.attachElement=function(e,c){if(!this.attachedElement){c=b.Camera.ForceAttachControlToAlwaysPreventDefault?!1:c;this.attachedElement=e;this.noPreventDefault=c;for(var d in this.attached)this.attached[d],this.attached[d].attachControl(e,c)}},f.prototype.detachElement=function(b){if(this.attachedElement===b){for(var c in this.attached)this.attached[c],this.attached[c].detachControl(b);this.attachedElement=null}},f.prototype.rebuildInputCheck=function(){this.checkInputs=function(){};for(var b in this.attached){var c=
this.attached[b];c.checkInputs&&(this.checkInputs=this._addCheckInputs(c.checkInputs.bind(c)))}},f.prototype.clear=function(){this.attachedElement&&this.detachElement(this.attachedElement);this.attached={};this.attachedElement=null;this.checkInputs=function(){}},f.prototype.serialize=function(e){var c={},d;for(d in this.attached){var g=this.attached[d],f=b.SerializationHelper.Serialize(g);c[g.getTypeName()]=f}e.inputsmgr=c},f.prototype.parse=function(e){var c=e.inputsmgr;if(c){this.clear();for(var d in c){var g=
b.CameraInputTypes[d];if(g){var f=b.SerializationHelper.Parse(function(){return new g},c[d],null);this.add(f)}}}else for(d in this.attached)if(g=b.CameraInputTypes[this.attached[d].getTypeName()])f=b.SerializationHelper.Parse(function(){return new g},e,null),this.remove(this.attached[d]),this.add(f)},f);b.CameraInputsManager=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(b){void 0===b&&(b=!0);this.touchEnabled=b;this.angularSensibility=2E3};f=(f.prototype.attachControl=function(e,c){var d=this;if(!this._pointerInput){var g=this.camera,f=this.camera.getEngine();this._pointerInput=function(e){var l=e.event;if(d.touchEnabled||"touch"!==l.pointerType)if(e.type===b.PointerEventTypes.POINTERDOWN){try{l.srcElement.setPointerCapture(l.pointerId)}catch(n){}d.previousPosition={x:l.clientX,y:l.clientY};c||l.preventDefault()}else if(e.type===b.PointerEventTypes.POINTERUP){try{l.srcElement.releasePointerCapture(l.pointerId)}catch(q){}d.previousPosition=
null;c||l.preventDefault()}else if(e.type===b.PointerEventTypes.POINTERMOVE&&(d.previousPosition||f.isPointerLock)){var p,r;f.isPointerLock?(p=l.movementX||l.mozMovementX||l.webkitMovementX||l.msMovementX||0,r=l.movementY||l.mozMovementY||l.webkitMovementY||l.msMovementY||0):(p=l.clientX-d.previousPosition.x,r=l.clientY-d.previousPosition.y);g.cameraRotation.y+=p/d.angularSensibility;g.cameraRotation.x+=r/d.angularSensibility;d.previousPosition={x:l.clientX,y:l.clientY};c||l.preventDefault()}}}this._observer=
this.camera.getScene().onPointerObservable.add(this._pointerInput,b.PointerEventTypes.POINTERDOWN|b.PointerEventTypes.POINTERUP|b.PointerEventTypes.POINTERMOVE)},f.prototype.detachControl=function(b){this._observer&&b&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this.previousPosition=null)},f.prototype.getTypeName=function(){return"FreeCameraMouseInput"},f.prototype.getSimpleName=function(){return"mouse"},__decorate([b.serialize()],f.prototype,"angularSensibility",
void 0),f);b.FreeCameraMouseInput=f;b.CameraInputTypes.FreeCameraMouseInput=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(){this._keys=[];this.keysUp=[38];this.keysDown=[40];this.keysLeft=[37];this.keysRight=[39]};f=(f.prototype.attachControl=function(e,c){var d=this;this._onKeyDown||(this._onKeyDown=function(b){if(-1!==d.keysUp.indexOf(b.keyCode)||-1!==d.keysDown.indexOf(b.keyCode)||-1!==d.keysLeft.indexOf(b.keyCode)||-1!==d.keysRight.indexOf(b.keyCode))-1===d._keys.indexOf(b.keyCode)&&d._keys.push(b.keyCode),c||b.preventDefault()},this._onKeyUp=function(b){if(-1!==d.keysUp.indexOf(b.keyCode)||
-1!==d.keysDown.indexOf(b.keyCode)||-1!==d.keysLeft.indexOf(b.keyCode)||-1!==d.keysRight.indexOf(b.keyCode)){var e=d._keys.indexOf(b.keyCode);0<=e&&d._keys.splice(e,1);c||b.preventDefault()}},b.Tools.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]))},f.prototype.detachControl=function(){this._onKeyDown&&(b.Tools.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},
{name:"blur",handler:this._onLostFocus}]),this._keys=[],this._onKeyDown=null,this._onKeyUp=null)},f.prototype.checkInputs=function(){if(this._onKeyDown)for(var e=this.camera,c=0;c<this._keys.length;c++){var d=this._keys[c],g=e._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(d)?e._localDirection.copyFromFloats(-g,0,0):-1!==this.keysUp.indexOf(d)?e._localDirection.copyFromFloats(0,0,g):-1!==this.keysRight.indexOf(d)?e._localDirection.copyFromFloats(g,0,0):-1!==this.keysDown.indexOf(d)&&e._localDirection.copyFromFloats(0,
0,-g);e.getViewMatrix().invertToRef(e._cameraTransformMatrix);b.Vector3.TransformNormalToRef(e._localDirection,e._cameraTransformMatrix,e._transformedDirection);e.cameraDirection.addInPlace(e._transformedDirection)}},f.prototype.getTypeName=function(){return"FreeCameraKeyboardMoveInput"},f.prototype._onLostFocus=function(){this._keys=[]},f.prototype.getSimpleName=function(){return"keyboard"},__decorate([b.serialize()],f.prototype,"keysUp",void 0),__decorate([b.serialize()],f.prototype,"keysDown",
void 0),__decorate([b.serialize()],f.prototype,"keysLeft",void 0),__decorate([b.serialize()],f.prototype,"keysRight",void 0),f);b.FreeCameraKeyboardMoveInput=f;b.CameraInputTypes.FreeCameraKeyboardMoveInput=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(){this._offsetY=this._offsetX=null;this._pointerCount=0;this._pointerPressed=[];this.touchAngularSensibility=2E5;this.touchMoveSensibility=250};f=(f.prototype.attachControl=function(e,c){var d,g=this;void 0===this._pointerInput&&(this._onLostFocus=function(){g._offsetX=null;g._offsetY=null},this._pointerInput=function(e){var f=e.event;if("mouse"!==f.pointerType)if(e.type===b.PointerEventTypes.POINTERDOWN){if(!(c||f.preventDefault(),g._pointerPressed.push(f.pointerId),
1!==g._pointerPressed.length))d={x:f.clientX,y:f.clientY}}else if(e.type===b.PointerEventTypes.POINTERUP){if(c||f.preventDefault(),e=g._pointerPressed.indexOf(f.pointerId),-1!==e&&!(g._pointerPressed.splice(e,1),0!=e))d=null,g._offsetX=null,g._offsetY=null}else if(e.type===b.PointerEventTypes.POINTERMOVE&&!(c||f.preventDefault(),!d))e=g._pointerPressed.indexOf(f.pointerId),0==e&&(g._offsetX=f.clientX-d.x,g._offsetY=-(f.clientY-d.y))});this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,
b.PointerEventTypes.POINTERDOWN|b.PointerEventTypes.POINTERUP|b.PointerEventTypes.POINTERMOVE);e.addEventListener("blur",this._onLostFocus)},f.prototype.detachControl=function(b){this._pointerInput&&b&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,b.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null,this._pointerPressed=[],this._offsetX=null,this._offsetY=null,this._pointerCount=0)},f.prototype.checkInputs=function(){if(this._offsetX){var e=
this.camera;if(e.cameraRotation.y+=this._offsetX/this.touchAngularSensibility,1<this._pointerPressed.length)e.cameraRotation.x+=-this._offsetY/this.touchAngularSensibility;else{var c=e._computeLocalCameraSpeed(),c=new b.Vector3(0,0,c*this._offsetY/this.touchMoveSensibility);b.Matrix.RotationYawPitchRollToRef(e.rotation.y,e.rotation.x,0,e._cameraRotationMatrix);e.cameraDirection.addInPlace(b.Vector3.TransformCoordinates(c,e._cameraRotationMatrix))}}},f.prototype.getTypeName=function(){return"FreeCameraTouchInput"},
f.prototype.getSimpleName=function(){return"touch"},__decorate([b.serialize()],f.prototype,"touchAngularSensibility",void 0),__decorate([b.serialize()],f.prototype,"touchMoveSensibility",void 0),f);b.FreeCameraTouchInput=f;b.CameraInputTypes.FreeCameraTouchInput=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(){var e=this;this._screenOrientationAngle=0;this._screenQuaternion=new b.Quaternion;this._gamma=this._beta=this._alpha=0;this._orientationChanged=function(){e._screenOrientationAngle=void 0!==window.orientation?+window.orientation:window.screen.orientation&&window.screen.orientation.angle?window.screen.orientation.angle:0;e._screenOrientationAngle=-b.Tools.ToRadians(e._screenOrientationAngle/2);e._screenQuaternion.copyFromFloats(0,Math.sin(e._screenOrientationAngle),
0,Math.cos(e._screenOrientationAngle))};this._deviceOrientation=function(b){e._alpha=b.alpha;e._beta=b.beta;e._gamma=b.gamma};this._constantTranform=new b.Quaternion(-Math.sqrt(0.5),0,0,Math.sqrt(0.5));this._orientationChanged()};f=(Object.defineProperty(f.prototype,"camera",{get:function(){return this._camera},set:function(e){this._camera=e;this._camera.rotationQuaternion||(this._camera.rotationQuaternion=new b.Quaternion)},enumerable:!0,configurable:!0}),f.prototype.attachControl=function(){window.addEventListener("orientationchange",
this._orientationChanged);window.addEventListener("deviceorientation",this._deviceOrientation)},f.prototype.detachControl=function(){window.removeEventListener("orientationchange",this._orientationChanged);window.removeEventListener("deviceorientation",this._deviceOrientation)},f.prototype.checkInputs=function(){b.Quaternion.RotationYawPitchRollToRef(b.Tools.ToRadians(this._alpha),b.Tools.ToRadians(this._beta),-b.Tools.ToRadians(this._gamma),this.camera.rotationQuaternion);this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion);
this._camera.rotationQuaternion.multiplyInPlace(this._constantTranform);this._camera.rotationQuaternion.z*=-1;this._camera.rotationQuaternion.w*=-1},f.prototype.getTypeName=function(){return"FreeCameraDeviceOrientationInput"},f.prototype.getSimpleName=function(){return"deviceOrientation"},f);b.FreeCameraDeviceOrientationInput=f;b.CameraInputTypes.FreeCameraDeviceOrientationInput=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(){this.gammaCorrection=this.betaCorrection=this.alphaCorrection=1;this._gamma=this._beta=this._alpha=0;this._dirty=!1;this._deviceOrientationHandler=this._onOrientationEvent.bind(this)};f=(f.prototype.attachControl=function(){window.addEventListener("deviceorientation",this._deviceOrientationHandler)},f.prototype._onOrientationEvent=function(b){this.camera;this._alpha=b.alpha;this._beta=b.beta;this._gamma=b.gamma;this._dirty=!0},f.prototype.checkInputs=function(){if(this._dirty){this._dirty=
!1;var b=this._gamma;this.camera.rotation.x=this.gammaCorrection*(0>b?90+b:270-b)/180*Math.PI;this.camera.rotation.y=this.alphaCorrection*-this._alpha/180*Math.PI;this.camera.rotation.z=this.betaCorrection*this._beta/180*Math.PI}},f.prototype.detachControl=function(){window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},f.prototype.getTypeName=function(){return"FreeCameraVRDeviceOrientationInput"},f.prototype.getSimpleName=function(){return"VRDeviceOrientation"},f);b.FreeCameraVRDeviceOrientationInput=
f;b.CameraInputTypes.FreeCameraVRDeviceOrientationInput=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(){this.gamepadAngularSensibility=200;this.gamepadMoveSensibility=40};f=(f.prototype.attachControl=function(){var e=this;this._gamepads=new b.Gamepads(function(b){e._onNewGameConnected(b)})},f.prototype.detachControl=function(){this._gamepads&&this._gamepads.dispose();this.gamepad=null},f.prototype.checkInputs=function(){if(this.gamepad){var e=this.camera,c=this.gamepad.leftStick,d=c.x/this.gamepadMoveSensibility,g=c.y/this.gamepadMoveSensibility;c.x=0.0050<Math.abs(d)?
0+d:0;c.y=0.0050<Math.abs(g)?0+g:0;var d=this.gamepad.rightStick,g=d.x/this.gamepadAngularSensibility,f=d.y/this.gamepadAngularSensibility;d.x=0.0010<Math.abs(g)?0+g:0;d.y=0.0010<Math.abs(f)?0+f:0;g=b.Matrix.RotationYawPitchRoll(e.rotation.y,e.rotation.x,0);f=50*e._computeLocalCameraSpeed();c=b.Vector3.TransformCoordinates(new b.Vector3(c.x*f,0,-c.y*f),g);e.cameraDirection=e.cameraDirection.add(c);e.cameraRotation=e.cameraRotation.add(new b.Vector2(d.y,d.x))}},f.prototype._onNewGameConnected=function(b){0===
b.index&&(this.gamepad=b)},f.prototype.getTypeName=function(){return"FreeCameraGamepadInput"},f.prototype.getSimpleName=function(){return"gamepad"},__decorate([b.serialize()],f.prototype,"gamepadAngularSensibility",void 0),__decorate([b.serialize()],f.prototype,"gamepadMoveSensibility",void 0),f);b.FreeCameraGamepadInput=f;b.CameraInputTypes.FreeCameraGamepadInput=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(){this._keys=[];this.keysUp=[38];this.keysDown=[40];this.keysLeft=[37];this.keysRight=[39]};f=(f.prototype.attachControl=function(e,c){var d=this;this._onKeyDown=function(b){if(-1!==d.keysUp.indexOf(b.keyCode)||-1!==d.keysDown.indexOf(b.keyCode)||-1!==d.keysLeft.indexOf(b.keyCode)||-1!==d.keysRight.indexOf(b.keyCode))-1===d._keys.indexOf(b.keyCode)&&d._keys.push(b.keyCode),b.preventDefault&&(c||b.preventDefault())};this._onKeyUp=function(b){if(-1!==d.keysUp.indexOf(b.keyCode)||
-1!==d.keysDown.indexOf(b.keyCode)||-1!==d.keysLeft.indexOf(b.keyCode)||-1!==d.keysRight.indexOf(b.keyCode)){var e=d._keys.indexOf(b.keyCode);0<=e&&d._keys.splice(e,1);b.preventDefault&&(c||b.preventDefault())}};this._onLostFocus=function(){d._keys=[]};b.Tools.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}])},f.prototype.detachControl=function(){b.Tools.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},
{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]);this._keys=[];this._onLostFocus=this._onKeyUp=this._onKeyDown=null},f.prototype.checkInputs=function(){if(this._onKeyDown)for(var b=this.camera,c=0;c<this._keys.length;c++){var d=this._keys[c];-1!==this.keysLeft.indexOf(d)?b.inertialAlphaOffset-=0.01:-1!==this.keysUp.indexOf(d)?b.inertialBetaOffset-=0.01:-1!==this.keysRight.indexOf(d)?b.inertialAlphaOffset+=0.01:-1!==this.keysDown.indexOf(d)&&(b.inertialBetaOffset+=0.01)}},
f.prototype.getTypeName=function(){return"ArcRotateCameraKeyboardMoveInput"},f.prototype.getSimpleName=function(){return"keyboard"},__decorate([b.serialize()],f.prototype,"keysUp",void 0),__decorate([b.serialize()],f.prototype,"keysDown",void 0),__decorate([b.serialize()],f.prototype,"keysLeft",void 0),__decorate([b.serialize()],f.prototype,"keysRight",void 0),f);b.ArcRotateCameraKeyboardMoveInput=f;b.CameraInputTypes.ArcRotateCameraKeyboardMoveInput=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(){this.wheelPrecision=3};f=(f.prototype.attachControl=function(e,c){var d=this;this._wheel=function(g){if(g.type===b.PointerEventTypes.POINTERWHEEL){g=g.event;var e=0;g.wheelDelta?e=g.wheelDelta/(40*d.wheelPrecision):g.detail&&(e=-g.detail/d.wheelPrecision);e&&(d.camera.inertialRadiusOffset+=e);g.preventDefault&&(c||g.preventDefault())}};this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,b.PointerEventTypes.POINTERWHEEL)},f.prototype.detachControl=
function(b){this._observer&&b&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},f.prototype.getTypeName=function(){return"ArcRotateCameraMouseWheelInput"},f.prototype.getSimpleName=function(){return"mousewheel"},__decorate([b.serialize()],f.prototype,"wheelPrecision",void 0),f);b.ArcRotateCameraMouseWheelInput=f;b.CameraInputTypes.ArcRotateCameraMouseWheelInput=f}(BABYLON||(BABYLON={}));
!function(b){b.Tools.GetPointerPrefix();var f=function(){this.angularSensibilityY=this.angularSensibilityX=1E3;this.pinchPrecision=6;this.panningSensibility=50;this._isCtrlPushed=this._isRightClick=!1;this.pinchInwards=!0},f=(f.prototype.attachControl=function(e,c){var d,g,f,j=this,l=this.camera.getEngine(),n=0;this._pointerInput=function(e){var l=e.event;if(e.type===b.PointerEventTypes.POINTERDOWN){try{l.srcElement.setPointerCapture(l.pointerId)}catch(r){}j._isRightClick=2===l.button;d={x:l.clientX,
y:l.clientY,pointerId:l.pointerId,type:l.pointerType};void 0===g?g=d:void 0===f&&(f=d);c||l.preventDefault()}else if(e.type===b.PointerEventTypes.POINTERUP){try{l.srcElement.releasePointerCapture(l.pointerId)}catch(t){}d=null;n=0;g=f=void 0;c||l.preventDefault()}else if(e.type===b.PointerEventTypes.POINTERMOVE)if(c||l.preventDefault(),g&&void 0===f)0!==j.panningSensibility&&(j._isCtrlPushed&&j.camera._useCtrlForPanning||!j.camera._useCtrlForPanning&&j._isRightClick)?(j.camera.inertialPanningX+=-(l.clientX-
d.x)/j.panningSensibility,j.camera.inertialPanningY+=(l.clientY-d.y)/j.panningSensibility):(e=l.clientY-d.y,j.camera.inertialAlphaOffset-=(l.clientX-d.x)/j.angularSensibilityX,j.camera.inertialBetaOffset-=e/j.angularSensibilityY),d.x=l.clientX,d.y=l.clientY;else if(g&&f){e=g.pointerId===l.pointerId?g:f;e.x=l.clientX;e.y=l.clientY;l=j.pinchInwards?1:-1;e=g.x-f.x;var s=g.y-f.y;e=e*e+s*s;if(0===n)return void(n=e);e!==n&&(j.camera.inertialRadiusOffset+=(e-n)/(j.pinchPrecision*((j.angularSensibilityX+
j.angularSensibilityY)/2)*l),n=e)}};this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,b.PointerEventTypes.POINTERDOWN|b.PointerEventTypes.POINTERUP|b.PointerEventTypes.POINTERMOVE);this._onContextMenu=function(b){b.preventDefault()};this.camera._useCtrlForPanning||e.addEventListener("contextmenu",this._onContextMenu,!1);this._onLostFocus=function(){g=f=void 0;n=0;d=null};this._onKeyDown=function(b){j._isCtrlPushed=b.ctrlKey};this._onKeyUp=function(b){j._isCtrlPushed=
b.ctrlKey};this._onMouseMove=function(b){if(l.isPointerLock){var d=b.movementY||b.mozMovementY||b.webkitMovementY||b.msMovementY||0;j.camera.inertialAlphaOffset-=(b.movementX||b.mozMovementX||b.webkitMovementX||b.msMovementX||0)/j.angularSensibilityX;j.camera.inertialBetaOffset-=d/j.angularSensibilityY;c||b.preventDefault()}};this._onGestureStart=function(b){void 0!==window.MSGesture&&(j._MSGestureHandler||(j._MSGestureHandler=new MSGesture,j._MSGestureHandler.target=e),j._MSGestureHandler.addPointer(b.pointerId))};
this._onGesture=function(b){j.camera.radius*=b.scale;b.preventDefault&&(c||(b.stopPropagation(),b.preventDefault()))};e.addEventListener("mousemove",this._onMouseMove,!1);e.addEventListener("MSPointerDown",this._onGestureStart,!1);e.addEventListener("MSGestureChange",this._onGesture,!1);b.Tools.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}])},f.prototype.detachControl=function(e){e&&this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),
this._observer=null,e.removeEventListener("contextmenu",this._onContextMenu),e.removeEventListener("mousemove",this._onMouseMove),e.removeEventListener("MSPointerDown",this._onGestureStart),e.removeEventListener("MSGestureChange",this._onGesture),this._isRightClick=!1,this._isCtrlPushed=!1,this.pinchInwards=!0,this._onKeyDown=null,this._onKeyUp=null,this._onMouseMove=null,this._onGestureStart=null,this._onGesture=null,this._MSGestureHandler=null,this._onLostFocus=null,this._onContextMenu=null);b.Tools.UnregisterTopRootEvents([{name:"keydown",
handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}])},f.prototype.getTypeName=function(){return"ArcRotateCameraPointersInput"},f.prototype.getSimpleName=function(){return"pointers"},__decorate([b.serialize()],f.prototype,"angularSensibilityX",void 0),__decorate([b.serialize()],f.prototype,"angularSensibilityY",void 0),__decorate([b.serialize()],f.prototype,"pinchPrecision",void 0),__decorate([b.serialize()],f.prototype,"panningSensibility",void 0),
f);b.ArcRotateCameraPointersInput=f;b.CameraInputTypes.ArcRotateCameraPointersInput=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(){this.gamepadRotationSensibility=80;this.gamepadMoveSensibility=40};f=(f.prototype.attachControl=function(){var e=this;this._gamepads=new b.Gamepads(function(b){e._onNewGameConnected(b)})},f.prototype.detachControl=function(){this._gamepads&&this._gamepads.dispose();this.gamepad=null},f.prototype.checkInputs=function(){if(this.gamepad){var b=this.camera,c=this.gamepad.rightStick;if(0!=c.x){var d=c.x/this.gamepadRotationSensibility;0!=d&&0.0050<Math.abs(d)&&(b.inertialAlphaOffset+=
d)}0!=c.y&&(c=c.y/this.gamepadRotationSensibility,0!=c&&0.0050<Math.abs(c)&&(b.inertialBetaOffset+=c));b=this.gamepad.leftStick;0!=b.y&&(b=b.y/this.gamepadMoveSensibility,0!=b&&0.0050<Math.abs(b)&&(this.camera.inertialRadiusOffset-=b))}},f.prototype._onNewGameConnected=function(b){0===b.index&&(this.gamepad=b)},f.prototype.getTypeName=function(){return"ArcRotateCameraGamepadInput"},f.prototype.getSimpleName=function(){return"gamepad"},__decorate([b.serialize()],f.prototype,"gamepadRotationSensibility",
void 0),__decorate([b.serialize()],f.prototype,"gamepadMoveSensibility",void 0),f);b.ArcRotateCameraGamepadInput=f;b.CameraInputTypes.ArcRotateCameraGamepadInput=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(){this.gammaCorrection=this.betaCorrection=this.alphaCorrection=1;this._gamma=this._beta=this._alpha=0;this._dirty=!1;this._deviceOrientationHandler=this._onOrientationEvent.bind(this)};f=(f.prototype.attachControl=function(b,c){this.camera.attachControl(b,c);window.addEventListener("deviceorientation",this._deviceOrientationHandler)},f.prototype._onOrientationEvent=function(b){this.camera;this._alpha=0|+b.alpha;this._beta=0|+b.beta;this._gamma=0|+b.gamma;this._dirty=
!0},f.prototype.checkInputs=function(){this._dirty&&(this._dirty=!1,0>this._gamma&&(this._gamma=180+this._gamma),this.camera.alpha=2*(-this._alpha/180*Math.PI%Math.PI),this.camera.beta=this._gamma/180*Math.PI)},f.prototype.detachControl=function(){window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},f.prototype.getTypeName=function(){return"ArcRotateCameraVRDeviceOrientationInput"},f.prototype.getSimpleName=function(){return"VRDeviceOrientation"},f);b.ArcRotateCameraVRDeviceOrientationInput=
f;b.CameraInputTypes.ArcRotateCameraVRDeviceOrientationInput=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.Camera,c=function(c,g,f){e.call(this,c,g,f);this.cameraDirection=new b.Vector3(0,0,0);this.cameraRotation=new b.Vector2(0,0);this.rotation=new b.Vector3(0,0,0);this.speed=2;this.noRotationConstraint=!1;this.lockedTarget=null;this._currentTarget=b.Vector3.Zero();this._viewMatrix=b.Matrix.Zero();this._camMatrix=b.Matrix.Zero();this._cameraTransformMatrix=b.Matrix.Zero();this._cameraRotationMatrix=b.Matrix.Zero();this._referencePoint=new b.Vector3(0,0,1);this._defaultUpVector=
new b.Vector3(0,1,0);this._transformedReferencePoint=b.Vector3.Zero();this._lookAtTemp=b.Matrix.Zero();this._tempMatrix=b.Matrix.Zero()};f=(__extends(c,e),c.prototype.getFrontPosition=function(b){var c=this.getTarget().subtract(this.position);return c.normalize(),c.scaleInPlace(b),this.globalPosition.add(c)},c.prototype._getLockedTargetPosition=function(){return this.lockedTarget?this.lockedTarget.position||this.lockedTarget:null},c.prototype._initCache=function(){e.prototype._initCache.call(this);
this._cache.lockedTarget=new b.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this._cache.rotation=new b.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this._cache.rotationQuaternion=new b.Quaternion(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},c.prototype._updateCache=function(b){b||e.prototype._updateCache.call(this);(b=this._getLockedTargetPosition())?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(b):this._cache.lockedTarget=b.clone():
this._cache.lockedTarget=null;this._cache.rotation.copyFrom(this.rotation);this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},c.prototype._isSynchronizedViewMatrix=function(){if(!e.prototype._isSynchronizedViewMatrix.call(this))return!1;var b=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(b):!b)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},
c.prototype._computeLocalCameraSpeed=function(){var b=this.getEngine();return this.speed*(b.getDeltaTime()/(10*b.getFps()))},c.prototype.setTarget=function(c){this.upVector.normalize();b.Matrix.LookAtLHToRef(this.position,c,this._defaultUpVector,this._camMatrix);this._camMatrix.invert();this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);c=c.subtract(this.position);0<=c.x?this.rotation.y=-Math.atan(c.z/c.x)+Math.PI/2:this.rotation.y=-Math.atan(c.z/c.x)-Math.PI/2;this.rotation.z=
0;isNaN(this.rotation.x)&&(this.rotation.x=0);isNaN(this.rotation.y)&&(this.rotation.y=0);isNaN(this.rotation.z)&&(this.rotation.z=0);this.rotationQuaternion&&b.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},c.prototype.getTarget=function(){return this._currentTarget},c.prototype._decideIfNeedsToMove=function(){return 0<Math.abs(this.cameraDirection.x)||0<Math.abs(this.cameraDirection.y)||0<Math.abs(this.cameraDirection.z)},c.prototype._updatePosition=
function(){this.position.addInPlace(this.cameraDirection)},c.prototype._checkInputs=function(){var c=this._decideIfNeedsToMove(),g=0<Math.abs(this.cameraRotation.x)||0<Math.abs(this.cameraRotation.y);if(c&&this._updatePosition(),g&&(this.rotation.x+=this.cameraRotation.x,this.rotation.y+=this.cameraRotation.y,!this.noRotationConstraint)){var f=0.95*(Math.PI/2);this.rotation.x>f&&(this.rotation.x=f);this.rotation.x<-f&&(this.rotation.x=-f)}c&&(Math.abs(this.cameraDirection.x)<b.Epsilon&&(this.cameraDirection.x=
0),Math.abs(this.cameraDirection.y)<b.Epsilon&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<b.Epsilon&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia));g&&(Math.abs(this.cameraRotation.x)<b.Epsilon&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<b.Epsilon&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia));e.prototype._checkInputs.call(this)},c.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?(this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix),
b.Vector3.TransformNormalToRef(this._defaultUpVector,this._cameraRotationMatrix,this.upVector)):b.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)},c.prototype._getViewMatrix=function(){return this.lockedTarget?this._currentTarget.copyFrom(this._getLockedTargetPosition()):(this._updateCameraRotationMatrix(),b.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,
this._currentTarget)),b.Matrix.LookAtLHToRef(this.position,this._currentTarget,this.upVector,this._viewMatrix),this._viewMatrix},c.prototype.createRigCamera=function(d){return this.cameraRigMode!==b.Camera.RIG_MODE_NONE?(d=new c(d,this.position.clone(),this.getScene()),this.cameraRigMode===b.Camera.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new b.Quaternion),d._cameraRigParams={},d.rotationQuaternion=new b.Quaternion),d):null},c.prototype._updateRigCameras=function(){var c=this._rigCameras[0],
g=this._rigCameras[1];switch(this.cameraRigMode){case b.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case b.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case b.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case b.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:var f=this.cameraRigMode===b.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPosition(this._cameraRigParams.stereoHalfAngle*(this.cameraRigMode===b.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1),c.position);this._getRigCamPosition(this._cameraRigParams.stereoHalfAngle*
f,g.position);c.setTarget(this.getTarget());g.setTarget(this.getTarget());break;case b.Camera.RIG_MODE_VR:c.rotationQuaternion.copyFrom(this.rotationQuaternion),g.rotationQuaternion.copyFrom(this.rotationQuaternion),c.position.copyFrom(this.position),g.position.copyFrom(this.position)}e.prototype._updateRigCameras.call(this)},c.prototype._getRigCamPosition=function(c,g){this._rigCamTransformMatrix||(this._rigCamTransformMatrix=new b.Matrix);var e=this.getTarget();b.Matrix.Translation(-e.x,-e.y,-e.z).multiplyToRef(b.Matrix.RotationY(c),
this._rigCamTransformMatrix);this._rigCamTransformMatrix=this._rigCamTransformMatrix.multiply(b.Matrix.Translation(e.x,e.y,e.z));b.Vector3.TransformCoordinatesToRef(this.position,this._rigCamTransformMatrix,g)},c.prototype.getTypeName=function(){return"TargetCamera"},__decorate([b.serializeAsVector3()],c.prototype,"rotation",void 0),__decorate([b.serialize()],c.prototype,"speed",void 0),__decorate([b.serializeAsMeshReference("lockedTargetId")],c.prototype,"lockedTarget",void 0),c);b.TargetCamera=
f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.TargetCamera;f=function(c,d,g){var f=this;e.call(this,c,d,g);this.ellipsoid=new b.Vector3(0.5,1,0.5);this.applyGravity=this.checkCollisions=!1;this._collider=new b.Collider;this._needMoveForGravity=!1;this._oldPosition=b.Vector3.Zero();this._diffPosition=b.Vector3.Zero();this._newPosition=b.Vector3.Zero();this._onCollisionPositionChange=function(c,d,g){void 0===g&&(g=null);f.getScene().workerCollisions&&d.multiplyInPlace(f._collider.radius);f._newPosition.copyFrom(d);f._newPosition.subtractToRef(f._oldPosition,
f._diffPosition);f.position.clone();f._diffPosition.length()>b.Engine.CollisionsEpsilon&&(f.position.addInPlace(f._diffPosition),f.onCollide&&g&&f.onCollide(g))};this.inputs=new b.FreeCameraInputsManager(this);this.inputs.addKeyboard().addMouse()};f=(__extends(f,e),Object.defineProperty(f.prototype,"angularSensibility",{get:function(){var b=this.inputs.attached.mouse;return b?b.angularSensibility:void 0},set:function(b){var d=this.inputs.attached.mouse;d&&(d.angularSensibility=b)},enumerable:!0,configurable:!0}),
Object.defineProperty(f.prototype,"keysUp",{get:function(){var b=this.inputs.attached.keyboard;return b?b.keysUp:void 0},set:function(b){var d=this.inputs.attached.keyboard;d&&(d.keysUp=b)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"keysDown",{get:function(){var b=this.inputs.attached.keyboard;return b?b.keysDown:void 0},set:function(b){var d=this.inputs.attached.keyboard;d&&(d.keysDown=b)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"keysLeft",{get:function(){var b=
this.inputs.attached.keyboard;return b?b.keysLeft:void 0},set:function(b){var d=this.inputs.attached.keyboard;d&&(d.keysLeft=b)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"keysRight",{get:function(){var b=this.inputs.attached.keyboard;return b?b.keysRight:void 0},set:function(b){var d=this.inputs.attached.keyboard;d&&(d.keysRight=b)},enumerable:!0,configurable:!0}),f.prototype.attachControl=function(b,d){this.inputs.attachElement(b,d)},f.prototype.detachControl=function(c){this.inputs.detachElement(c);
this.cameraDirection=new b.Vector3(0,0,0);this.cameraRotation=new b.Vector2(0,0)},f.prototype._collideWithWorld=function(c){(this.parent?b.Vector3.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition);this._collider.radius=this.ellipsoid;var d=c;this.applyGravity&&(d=c.add(this.getScene().gravity));this.getScene().collisionCoordinator.getNewPosition(this._oldPosition,d,this._collider,3,null,this._onCollisionPositionChange,
this.uniqueId)},f.prototype._checkInputs=function(){this._localDirection||(this._localDirection=b.Vector3.Zero(),this._transformedDirection=b.Vector3.Zero());this.inputs.checkInputs();e.prototype._checkInputs.call(this)},f.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||0<Math.abs(this.cameraDirection.x)||0<Math.abs(this.cameraDirection.y)||0<Math.abs(this.cameraDirection.z)},f.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?
this._collideWithWorld(this.cameraDirection):this.position.addInPlace(this.cameraDirection)},f.prototype.dispose=function(){this.inputs.clear();e.prototype.dispose.call(this)},f.prototype.getTypeName=function(){return"FreeCamera"},__decorate([b.serializeAsVector3()],f.prototype,"ellipsoid",void 0),__decorate([b.serialize()],f.prototype,"checkCollisions",void 0),__decorate([b.serialize()],f.prototype,"applyGravity",void 0),f);b.FreeCamera=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.CameraInputsManager;f=function(b){e.call(this,b)};f=(__extends(f,e),f.prototype.addKeyboard=function(){return this.add(new b.FreeCameraKeyboardMoveInput),this},f.prototype.addMouse=function(c){return void 0===c&&(c=!0),this.add(new b.FreeCameraMouseInput(c)),this},f.prototype.addGamepad=function(){return this.add(new b.FreeCameraGamepadInput),this},f.prototype.addDeviceOrientation=function(){return this.add(new b.FreeCameraDeviceOrientationInput),this},f.prototype.addVRDeviceOrientation=
function(){return this.add(new b.FreeCameraVRDeviceOrientationInput),this},f.prototype.addTouch=function(){return this.add(new b.FreeCameraTouchInput),this},f.prototype.addVirtualJoystick=function(){return this.add(new b.FreeCameraVirtualJoystickInput),this},f);b.FreeCameraInputsManager=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.TargetCamera;f=function(b,c,f,j){e.call(this,b,c,f);this.radius=12;this.rotationOffset=0;this.heightOffset=4;this.cameraAcceleration=0.05;this.maxCameraSpeed=20;this.target=j};f=(__extends(f,e),f.prototype.getRadians=function(b){return b*Math.PI/180},f.prototype.follow=function(c){if(c){var g;c.rotationQuaternion?(g=new b.Matrix,c.rotationQuaternion.toRotationMatrix(g),g=Math.atan2(g.m[8],g.m[10])):g=c.rotation.y;g=this.getRadians(this.rotationOffset)+g;var e=c.position.x+Math.sin(g)*
this.radius;g=c.position.z+Math.cos(g)*this.radius;var e=2*(e-this.position.x)*this.cameraAcceleration,f=(c.position.y+this.heightOffset-this.position.y)*this.cameraAcceleration;g=2*(g-this.position.z)*this.cameraAcceleration;(e>this.maxCameraSpeed||e<-this.maxCameraSpeed)&&(e=1>e?-this.maxCameraSpeed:this.maxCameraSpeed);(f>this.maxCameraSpeed||f<-this.maxCameraSpeed)&&(f=1>f?-this.maxCameraSpeed:this.maxCameraSpeed);(g>this.maxCameraSpeed||g<-this.maxCameraSpeed)&&(g=1>g?-this.maxCameraSpeed:this.maxCameraSpeed);
this.position=new b.Vector3(this.position.x+e,this.position.y+f,this.position.z+g);this.setTarget(c.position)}},f.prototype._checkInputs=function(){e.prototype._checkInputs.call(this);this.follow(this.target)},f.prototype.getTypeName=function(){return"FollowCamera"},__decorate([b.serialize()],f.prototype,"radius",void 0),__decorate([b.serialize()],f.prototype,"rotationOffset",void 0),__decorate([b.serialize()],f.prototype,"heightOffset",void 0),__decorate([b.serialize()],f.prototype,"cameraAcceleration",
void 0),__decorate([b.serialize()],f.prototype,"maxCameraSpeed",void 0),__decorate([b.serializeAsMeshReference("lockedTargetId")],f.prototype,"target",void 0),f);b.FollowCamera=f;var c=b.TargetCamera;f=function(d,g,e,f,l,n){c.call(this,d,b.Vector3.Zero(),n);this.alpha=g;this.beta=e;this.radius=f;this.target=l;this._cartesianCoordinates=b.Vector3.Zero();this.follow()};f=(__extends(f,c),f.prototype.follow=function(){this._cartesianCoordinates.x=this.radius*Math.cos(this.alpha)*Math.cos(this.beta);this._cartesianCoordinates.y=
this.radius*Math.sin(this.beta);this._cartesianCoordinates.z=this.radius*Math.sin(this.alpha)*Math.cos(this.beta);this.position=this.target.position.add(this._cartesianCoordinates);this.setTarget(this.target.position)},f.prototype._checkInputs=function(){c.prototype._checkInputs.call(this);this.follow()},f.prototype.getTypeName=function(){return"ArcFollowCamera"},f);b.ArcFollowCamera=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.FreeCamera;f=function(b,d,g){e.call(this,b,d,g);this.inputs.addTouch();this._setupInputs()};f=(__extends(f,e),Object.defineProperty(f.prototype,"touchAngularSensibility",{get:function(){var b=this.inputs.attached.touch;return b?b.touchAngularSensibility:void 0},set:function(b){var d=this.inputs.attached.touch;d&&(d.touchAngularSensibility=b)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"touchMoveSensibility",{get:function(){var b=this.inputs.attached.touch;
return b?b.touchMoveSensibility:void 0},set:function(b){var d=this.inputs.attached.touch;d&&(d.touchMoveSensibility=b)},enumerable:!0,configurable:!0}),f.prototype.getTypeName=function(){return"TouchCamera"},f.prototype._setupInputs=function(){var b=this.inputs.attached.mouse;b&&(b.touchEnabled=!1)},f);b.TouchCamera=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.TargetCamera,c=function(c,g,f,j,l,n){var q=this;e.call(this,c,b.Vector3.Zero(),n);this.inertialRadiusOffset=this.inertialBetaOffset=this.inertialAlphaOffset=0;this.upperAlphaLimit=this.lowerAlphaLimit=null;this.lowerBetaLimit=0.01;this.upperBetaLimit=Math.PI;this.upperRadiusLimit=this.lowerRadiusLimit=null;this.inertialPanningY=this.inertialPanningX=0;this.zoomOnFactor=1;this.targetScreenOffset=b.Vector2.Zero();this.allowUpsideDown=!0;this._viewMatrix=new b.Matrix;this.panningAxis=
new b.Vector3(1,1,0);this.checkCollisions=!1;this.collisionRadius=new b.Vector3(0.5,0.5,0.5);this._collider=new b.Collider;this._previousPosition=b.Vector3.Zero();this._collisionVelocity=b.Vector3.Zero();this._newPosition=b.Vector3.Zero();this._onCollisionPositionChange=function(c,d,g){void 0===g&&(g=null);q.getScene().workerCollisions&&q.checkCollisions&&d.multiplyInPlace(q._collider.radius);g?(q.setPosition(d),q.onCollide&&q.onCollide(g)):q._previousPosition.copyFrom(q.position);d=Math.cos(q.alpha);
g=Math.sin(q.alpha);var e=Math.cos(q.beta),l=Math.sin(q.beta);0===l&&(l=1E-4);c=q._getTargetPosition();c.addToRef(new b.Vector3(q.radius*d*l,q.radius*e,q.radius*g*l),q._newPosition);q.position.copyFrom(q._newPosition);d=q.upVector;q.allowUpsideDown&&0>q.beta&&(d=d.clone(),d=d.negate());b.Matrix.LookAtLHToRef(q.position,c,d,q._viewMatrix);q._viewMatrix.m[12]+=q.targetScreenOffset.x;q._viewMatrix.m[13]+=q.targetScreenOffset.y;q._collisionTriggered=!1};l?this.target=l:this.target=b.Vector3.Zero();this.alpha=
g;this.beta=f;this.radius=j;this.getViewMatrix();this.inputs=new b.ArcRotateCameraInputsManager(this);this.inputs.addKeyboard().addMouseWheel().addPointers().addGamepad()};f=(__extends(c,e),Object.defineProperty(c.prototype,"angularSensibilityX",{get:function(){var b=this.inputs.attached.pointers;return b?b.angularSensibilityX:void 0},set:function(b){var c=this.inputs.attached.pointers;c&&(c.angularSensibilityX=b)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"angularSensibilityY",
{get:function(){var b=this.inputs.attached.pointers;return b?b.angularSensibilityY:void 0},set:function(b){var c=this.inputs.attached.pointers;c&&(c.angularSensibilityY=b)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"pinchPrecision",{get:function(){var b=this.inputs.attached.pointers;return b?b.pinchPrecision:void 0},set:function(b){var c=this.inputs.attached.pointers;c&&(c.pinchPrecision=b)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"panningSensibility",
{get:function(){var b=this.inputs.attached.pointers;return b?b.panningSensibility:void 0},set:function(b){var c=this.inputs.attached.pointers;c&&(c.panningSensibility=b)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"keysUp",{get:function(){var b=this.inputs.attached.keyboard;return b?b.keysUp:void 0},set:function(b){var c=this.inputs.attached.keyboard;c&&(c.keysUp=b)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"keysDown",{get:function(){var b=this.inputs.attached.keyboard;
return b?b.keysDown:void 0},set:function(b){var c=this.inputs.attached.keyboard;c&&(c.keysDown=b)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"keysLeft",{get:function(){var b=this.inputs.attached.keyboard;return b?b.keysLeft:void 0},set:function(b){var c=this.inputs.attached.keyboard;c&&(c.keysLeft=b)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"keysRight",{get:function(){var b=this.inputs.attached.keyboard;return b?b.keysRight:void 0},set:function(b){var c=
this.inputs.attached.keyboard;c&&(c.keysRight=b)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"wheelPrecision",{get:function(){var b=this.inputs.attached.mousewheel;return b?b.wheelPrecision:void 0},set:function(b){var c=this.inputs.attached.mousewheel;c&&(c.wheelPrecision=b)},enumerable:!0,configurable:!0}),c.prototype._initCache=function(){e.prototype._initCache.call(this);this._cache.target=new b.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this._cache.alpha=
void 0;this._cache.beta=void 0;this._cache.radius=void 0;this._cache.targetScreenOffset=b.Vector2.Zero()},c.prototype._updateCache=function(b){b||e.prototype._updateCache.call(this);this._cache.target.copyFrom(this._getTargetPosition());this._cache.alpha=this.alpha;this._cache.beta=this.beta;this._cache.radius=this.radius;this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},c.prototype._getTargetPosition=function(){return this.target.getAbsolutePosition?this.target.getAbsolutePosition():
this.target},c.prototype._isSynchronizedViewMatrix=function(){return e.prototype._isSynchronizedViewMatrix.call(this)?this._cache.target.equals(this.target)&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset):!1},c.prototype.attachControl=function(b,c,e){var f=this;void 0===e&&(e=!0);this._useCtrlForPanning=e;this.inputs.attachElement(b,c);this._reset=function(){f.inertialAlphaOffset=0;f.inertialBetaOffset=
0;f.inertialRadiusOffset=0}},c.prototype.detachControl=function(b){this.inputs.detachElement(b);this._reset&&this._reset()},c.prototype._checkInputs=function(){this._collisionTriggered||(this.inputs.checkInputs(),0===this.inertialAlphaOffset&&0===this.inertialBetaOffset&&0===this.inertialRadiusOffset||(this.alpha+=0>=this.beta?-this.inertialAlphaOffset:this.inertialAlphaOffset,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=
this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<b.Epsilon&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<b.Epsilon&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<b.Epsilon&&(this.inertialRadiusOffset=0)),0===this.inertialPanningX&&0===this.inertialPanningY||(this._localDirection||(this._localDirection=b.Vector3.Zero(),this._transformedDirection=b.Vector3.Zero()),this.inertialPanningX*=this.inertia,this.inertialPanningY*=this.inertia,
Math.abs(this.inertialPanningX)<b.Epsilon&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<b.Epsilon&&(this.inertialPanningY=0),this._localDirection.copyFromFloats(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY),this._localDirection.multiplyInPlace(this.panningAxis),this._viewMatrix.invertToRef(this._cameraTransformMatrix),b.Vector3.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.panningAxis.y||(this._transformedDirection.y=
0),this.target.getAbsolutePosition||this.target.addInPlace(this._transformedDirection)),this._checkLimits(),e.prototype._checkInputs.call(this))},c.prototype._checkLimits=function(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta-=2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit);null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta+=2*Math.PI):this.beta>this.upperBetaLimit&&
(this.beta=this.upperBetaLimit);this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit);this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit);this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit);this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit)},c.prototype.rebuildAnglesAndRadius=function(){var b=this.position.subtract(this._getTargetPosition());
this.radius=b.length();this.alpha=Math.acos(b.x/Math.sqrt(Math.pow(b.x,2)+Math.pow(b.z,2)));0>b.z&&(this.alpha=2*Math.PI-this.alpha);this.beta=Math.acos(b.y/this.radius);this._checkLimits()},c.prototype.setPosition=function(b){this.position.equals(b)||(this.position=b,this.rebuildAnglesAndRadius())},c.prototype.setTarget=function(b){this._getTargetPosition().equals(b)||(this.target=b,this.rebuildAnglesAndRadius())},c.prototype._getViewMatrix=function(){var c=Math.cos(this.alpha),g=Math.sin(this.alpha),
e=Math.cos(this.beta),f=Math.sin(this.beta);0===f&&(f=1E-4);var l=this._getTargetPosition();(l.addToRef(new b.Vector3(this.radius*c*f,this.radius*e,this.radius*g*f),this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions)?(this._collider.radius=this.collisionRadius,this._newPosition.subtractToRef(this.position,this._collisionVelocity),this._collisionTriggered=!0,this.getScene().collisionCoordinator.getNewPosition(this.position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,
this.uniqueId)):(this.position.copyFrom(this._newPosition),c=this.upVector,this.allowUpsideDown&&0>this.beta&&(c=c.clone(),c=c.negate()),b.Matrix.LookAtLHToRef(this.position,l,c,this._viewMatrix),this._viewMatrix.m[12]+=this.targetScreenOffset.x,this._viewMatrix.m[13]+=this.targetScreenOffset.y);return this._viewMatrix},c.prototype.zoomOn=function(c,g){void 0===g&&(g=!1);c=c||this.getScene().meshes;var e=b.Mesh.MinMax(c),f=b.Vector3.Distance(e.min,e.max);this.radius=f*this.zoomOnFactor;this.focusOn({min:e.min,
max:e.max,distance:f},g)},c.prototype.focusOn=function(c,g){void 0===g&&(g=!1);var e,f;void 0===c.min?(e=c||this.getScene().meshes,e=b.Mesh.MinMax(e),f=b.Vector3.Distance(e.min,e.max)):(e=c,f=c.distance);this.target=b.Mesh.Center(e);g||(this.maxZ=2*f)},c.prototype.createRigCamera=function(d,g){var e;switch(this.cameraRigMode){case b.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case b.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case b.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case b.Camera.RIG_MODE_VR:e=
this._cameraRigParams.stereoHalfAngle*(0===g?1:-1);break;case b.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:e=this._cameraRigParams.stereoHalfAngle*(0===g?-1:1)}e=new c(d,this.alpha+e,this.beta,this.radius,this.target,this.getScene());return e._cameraRigParams={},e},c.prototype._updateRigCameras=function(){var c=this._rigCameras[0],g=this._rigCameras[1];switch(c.beta=g.beta=this.beta,c.radius=g.radius=this.radius,this.cameraRigMode){case b.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case b.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case b.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case b.Camera.RIG_MODE_VR:c.alpha=
this.alpha-this._cameraRigParams.stereoHalfAngle;g.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case b.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:c.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,g.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}e.prototype._updateRigCameras.call(this)},c.prototype.dispose=function(){this.inputs.clear();e.prototype.dispose.call(this)},c.prototype.getTypeName=function(){return"ArcRotateCamera"},__decorate([b.serialize()],c.prototype,
"alpha",void 0),__decorate([b.serialize()],c.prototype,"beta",void 0),__decorate([b.serialize()],c.prototype,"radius",void 0),__decorate([b.serializeAsVector3()],c.prototype,"target",void 0),__decorate([b.serialize()],c.prototype,"inertialAlphaOffset",void 0),__decorate([b.serialize()],c.prototype,"inertialBetaOffset",void 0),__decorate([b.serialize()],c.prototype,"inertialRadiusOffset",void 0),__decorate([b.serialize()],c.prototype,"lowerAlphaLimit",void 0),__decorate([b.serialize()],c.prototype,
"upperAlphaLimit",void 0),__decorate([b.serialize()],c.prototype,"lowerBetaLimit",void 0),__decorate([b.serialize()],c.prototype,"upperBetaLimit",void 0),__decorate([b.serialize()],c.prototype,"lowerRadiusLimit",void 0),__decorate([b.serialize()],c.prototype,"upperRadiusLimit",void 0),__decorate([b.serialize()],c.prototype,"inertialPanningX",void 0),__decorate([b.serialize()],c.prototype,"inertialPanningY",void 0),__decorate([b.serialize()],c.prototype,"zoomOnFactor",void 0),__decorate([b.serialize()],
c.prototype,"allowUpsideDown",void 0),c);b.ArcRotateCamera=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.CameraInputsManager;f=function(b){e.call(this,b)};f=(__extends(f,e),f.prototype.addMouseWheel=function(){return this.add(new b.ArcRotateCameraMouseWheelInput),this},f.prototype.addPointers=function(){return this.add(new b.ArcRotateCameraPointersInput),this},f.prototype.addKeyboard=function(){return this.add(new b.ArcRotateCameraKeyboardMoveInput),this},f.prototype.addGamepad=function(){return this.add(new b.ArcRotateCameraGamepadInput),this},f.prototype.addVRDeviceOrientation=
function(){return this.add(new b.ArcRotateCameraVRDeviceOrientationInput),this},f);b.ArcRotateCameraInputsManager=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(b){this._renderingGroups=[];this._scene=b};f=(e.prototype._renderParticles=function(c,d){if(0!==this._scene._activeParticleSystems.length){for(var g=this._scene.activeCamera,e=b.Tools.Now,f=0;f<this._scene._activeParticleSystems.length;f++){var l=this._scene._activeParticleSystems.data[f];l.renderingGroupId===c&&0!==(g.layerMask&l.layerMask)&&(this._clearDepthBuffer(),l.emitter.position&&d&&-1===d.indexOf(l.emitter)||(this._scene._activeParticles+=l.render()))}this._scene._particlesDuration+=
b.Tools.Now-e}},e.prototype._renderSprites=function(c){if(this._scene.spritesEnabled&&0!==this._scene.spriteManagers.length){for(var d=this._scene.activeCamera,g=b.Tools.Now,e=0;e<this._scene.spriteManagers.length;e++){var f=this._scene.spriteManagers[e];f.renderingGroupId===c&&0!==(d.layerMask&f.layerMask)&&(this._clearDepthBuffer(),f.render())}this._scene._spritesDuration+=b.Tools.Now-g}},e.prototype._clearDepthBuffer=function(){this._depthBufferAlreadyCleaned||(this._scene.getEngine().clear(0,
!1,!0),this._depthBufferAlreadyCleaned=!0)},e.prototype._renderSpritesAndParticles=function(){this._currentRenderSprites&&this._renderSprites(this._currentIndex);this._currentRenderParticles&&this._renderParticles(this._currentIndex,this._currentActiveMeshes)},e.prototype.render=function(b,d,g,f){this._currentActiveMeshes=d;this._currentRenderParticles=g;this._currentRenderSprites=f;for(d=0;d<e.MAX_RENDERINGGROUPS;d++)this._depthBufferAlreadyCleaned=0==d,g=this._renderingGroups[d],f=!1,this._currentIndex=
d,g?(this._clearDepthBuffer(),g.onBeforeTransparentRendering||(g.onBeforeTransparentRendering=this._renderSpritesAndParticles.bind(this)),g.render(b)||(this._renderingGroups.splice(d,1),f=!0,this._renderSpritesAndParticles())):this._renderSpritesAndParticles(),f&&d--},e.prototype.reset=function(){this._renderingGroups.forEach(function(b){b&&b.prepare()})},e.prototype.dispatch=function(c){var d=c.getMesh().renderingGroupId||0;this._renderingGroups[d]||(this._renderingGroups[d]=new b.RenderingGroup(d,
this._scene));this._renderingGroups[d].dispatch(c)},e.MAX_RENDERINGGROUPS=4,e);b.RenderingManager=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(e,c){this.index=e;this._opaqueSubMeshes=new b.SmartArray(256);this._transparentSubMeshes=new b.SmartArray(256);this._alphaTestSubMeshes=new b.SmartArray(256);this._scene=c};f=(f.prototype.render=function(e){if(e)return e(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes),!0;if(0===this._opaqueSubMeshes.length&&0===this._alphaTestSubMeshes.length&&0===this._transparentSubMeshes.length)return this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),
!1;var c,d=this._scene.getEngine();for(e=0;e<this._opaqueSubMeshes.length;e++)c=this._opaqueSubMeshes.data[e],c.render(!1);d.setAlphaTesting(!0);for(e=0;e<this._alphaTestSubMeshes.length;e++)c=this._alphaTestSubMeshes.data[e],c.render(!1);if(d.setAlphaTesting(!1),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),this._transparentSubMeshes.length){for(e=0;e<this._transparentSubMeshes.length;e++)c=this._transparentSubMeshes.data[e],c._alphaIndex=c.getMesh().alphaIndex,c._distanceToCamera=
c.getBoundingInfo().boundingSphere.centerWorld.subtract(this._scene.activeCamera.globalPosition).length();var g=this._transparentSubMeshes.data.slice(0,this._transparentSubMeshes.length);g.sort(function(b,c){return b._alphaIndex>c._alphaIndex?1:b._alphaIndex<c._alphaIndex?-1:b._distanceToCamera<c._distanceToCamera?1:b._distanceToCamera>c._distanceToCamera?-1:0});for(e=0;e<g.length;e++)c=g[e],c.render(!0);d.setAlphaMode(b.Engine.ALPHA_DISABLE)}return!0},f.prototype.prepare=function(){this._opaqueSubMeshes.reset();
this._transparentSubMeshes.reset();this._alphaTestSubMeshes.reset()},f.prototype.dispatch=function(b){var c=b.getMaterial(),d=b.getMesh();c.needAlphaBlending()||1>d.visibility||d.hasVertexAlpha?this._transparentSubMeshes.push(b):c.needAlphaTesting()?this._alphaTestSubMeshes.push(b):this._opaqueSubMeshes.push(b)},f);b.RenderingGroup=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(){};f=(Object.defineProperty(e,"POINTERDOWN",{get:function(){return e._POINTERDOWN},enumerable:!0,configurable:!0}),Object.defineProperty(e,"POINTERUP",{get:function(){return e._POINTERUP},enumerable:!0,configurable:!0}),Object.defineProperty(e,"POINTERMOVE",{get:function(){return e._POINTERMOVE},enumerable:!0,configurable:!0}),Object.defineProperty(e,"POINTERWHEEL",{get:function(){return e._POINTERWHEEL},enumerable:!0,configurable:!0}),Object.defineProperty(e,"POINTERPICK",
{get:function(){return e._POINTERPICK},enumerable:!0,configurable:!0}),e._POINTERDOWN=1,e._POINTERUP=2,e._POINTERMOVE=4,e._POINTERWHEEL=8,e._POINTERPICK=16,e);b.PointerEventTypes=f;var c;c=function(b,c){this.type=b;this.event=c};b.PointerInfoBase=c;var d,g=function(d,g,e,f){c.call(this,d,g);this.skipOnPointerObservable=!1;this.localPosition=new b.Vector2(e,f)};d=(__extends(g,c),g);b.PointerInfoPre=d;var m,g=function(b,d,g){c.call(this,b,d);this.pickInfo=g};m=(__extends(g,c),g);b.PointerInfo=m;var j=
function(c){this.autoClear=!0;this.clearColor=new b.Color3(0.2,0.2,0.3);this.ambientColor=new b.Color3(0,0,0);this.forceShowBoundingBoxes=this.forcePointsCloud=this.forceWireframe=!1;this.animationsEnabled=!0;this.constantlyUpdateMeshUnderPointer=!1;this.onDisposeObservable=new b.Observable;this.onBeforeRenderObservable=new b.Observable;this.onAfterRenderObservable=new b.Observable;this.onReadyObservable=new b.Observable;this.onBeforeCameraRenderObservable=new b.Observable;this.onAfterCameraRenderObservable=
new b.Observable;this.onNewCameraAddedObservable=new b.Observable;this.onCameraRemovedObservable=new b.Observable;this.onNewLightAddedObservable=new b.Observable;this.onLightRemovedObservable=new b.Observable;this.onNewGeometryAddedObservable=new b.Observable;this.onGeometryRemovedObservable=new b.Observable;this.onNewMeshAddedObservable=new b.Observable;this.onMeshRemovedObservable=new b.Observable;this.animations=[];this.onPrePointerObservable=new b.Observable;this.onPointerObservable=new b.Observable;
this.cameraToUseForPointers=null;this._startingPointerPosition=new b.Vector2(0,0);this._startingPointerTime=0;this.fogEnabled=!0;this.fogMode=j.FOGMODE_NONE;this.fogColor=new b.Color3(0.2,0.2,0.3);this.fogDensity=0.1;this.fogStart=0;this.fogEnd=1E3;this.lightsEnabled=this.shadowsEnabled=!0;this.lights=[];this.cameras=[];this.activeCameras=[];this.meshes=[];this._geometries=[];this.materials=[];this.multiMaterials=[];this.defaultMaterial=new b.StandardMaterial("default material",this);this.texturesEnabled=
!0;this.textures=[];this.particlesEnabled=!0;this.particleSystems=[];this.spritesEnabled=!0;this.spriteManagers=[];this.layers=[];this.skeletonsEnabled=!0;this.skeletons=[];this.lensFlaresEnabled=!0;this.lensFlareSystems=[];this.collisionsEnabled=!0;this.gravity=new b.Vector3(0,-9.807,0);this.renderTargetsEnabled=this.postProcessesEnabled=!0;this.dumpNextRenderTargets=!1;this.customRenderTargets=[];this.importedMeshesFiles=[];this.probesEnabled=!0;this.reflectionProbes=[];this._actionManagers=[];
this._meshesForIntersections=new b.SmartArray(256);this.proceduralTexturesEnabled=!0;this._proceduralTextures=[];this.soundTracks=[];this._audioEnabled=!0;this._headphone=!1;this._renderId=this._animationRatio=this._spritesDuration=this._renderDuration=this._particlesDuration=this._renderTargetsDuration=this._evaluateActiveMeshesDuration=this._lastFrameDuration=this._activeParticles=this._activeIndices=this._totalVertices=0;this._executeWhenReadyTimeoutId=-1;this._intermediateRendering=!1;this._toBeDisposed=
new b.SmartArray(256);this._pendingData=[];this._activeMeshes=new b.SmartArray(256);this._processedMaterials=new b.SmartArray(256);this._renderTargets=new b.SmartArray(256);this._activeParticleSystems=new b.SmartArray(256);this._activeSkeletons=new b.SmartArray(32);this._softwareSkinnedMeshes=new b.SmartArray(32);this._activeBones=0;this._activeAnimatables=[];this._transformMatrix=b.Matrix.Zero();this._edgesRenderers=new b.SmartArray(16);this._uniqueIdCounter=0;this._engine=c;c.scenes.push(this);
this._renderingManager=new b.RenderingManager(this);this.postProcessManager=new b.PostProcessManager(this);this.postProcessRenderPipelineManager=new b.PostProcessRenderPipelineManager;this._boundingBoxRenderer=new b.BoundingBoxRenderer(this);b.OutlineRenderer&&(this._outlineRenderer=new b.OutlineRenderer(this));this.attachControl();b.SoundTrack&&(this.mainSoundTrack=new b.SoundTrack(this,{mainTrack:!0}));b.SimplificationQueue&&(this.simplificationQueue=new b.SimplificationQueue);this.workerCollisions=
!1},g=(Object.defineProperty(j,"FOGMODE_NONE",{get:function(){return j._FOGMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(j,"FOGMODE_EXP",{get:function(){return j._FOGMODE_EXP},enumerable:!0,configurable:!0}),Object.defineProperty(j,"FOGMODE_EXP2",{get:function(){return j._FOGMODE_EXP2},enumerable:!0,configurable:!0}),Object.defineProperty(j,"FOGMODE_LINEAR",{get:function(){return j._FOGMODE_LINEAR},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"onDispose",{set:function(b){this._onDisposeObserver&&
this.onDisposeObservable.remove(this._onDisposeObserver);this._onDisposeObserver=this.onDisposeObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"beforeRender",{set:function(b){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver);this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"afterRender",{set:function(b){this._onAfterRenderObserver&&
this.onAfterRenderObservable.remove(this._onAfterRenderObserver);this._onAfterRenderObserver=this.onAfterRenderObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"beforeCameraRender",{set:function(b){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver);this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"afterCameraRender",
{set:function(b){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver);this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"unTranslatedPointer",{get:function(){return new b.Vector2(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"debugLayer",{get:function(){return this._debugLayer||
(this._debugLayer=new b.DebugLayer(this)),this._debugLayer},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"workerCollisions",{get:function(){return this._workerCollisions},set:function(c){this._workerCollisions=c=c&&!!Worker;this.collisionCoordinator&&this.collisionCoordinator.destroy();this.collisionCoordinator=c?new b.CollisionCoordinatorWorker:new b.CollisionCoordinatorLegacy;this.collisionCoordinator.init(this)},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,
"SelectionOctree",{get:function(){return this._selectionOctree},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"pointerX",{get:function(){return this._pointerX},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"pointerY",{get:function(){return this._pointerY},enumerable:!0,configurable:!0}),j.prototype.getCachedMaterial=function(){return this._cachedMaterial},
j.prototype.getBoundingBoxRenderer=function(){return this._boundingBoxRenderer},j.prototype.getOutlineRenderer=function(){return this._outlineRenderer},j.prototype.getEngine=function(){return this._engine},j.prototype.getTotalVertices=function(){return this._totalVertices},j.prototype.getActiveIndices=function(){return this._activeIndices},j.prototype.getActiveParticles=function(){return this._activeParticles},j.prototype.getActiveBones=function(){return this._activeBones},j.prototype.getLastFrameDuration=
function(){return this._lastFrameDuration},j.prototype.getEvaluateActiveMeshesDuration=function(){return this._evaluateActiveMeshesDuration},j.prototype.getActiveMeshes=function(){return this._activeMeshes},j.prototype.getRenderTargetsDuration=function(){return this._renderTargetsDuration},j.prototype.getRenderDuration=function(){return this._renderDuration},j.prototype.getParticlesDuration=function(){return this._particlesDuration},j.prototype.getSpritesDuration=function(){return this._spritesDuration},
j.prototype.getAnimationRatio=function(){return this._animationRatio},j.prototype.getRenderId=function(){return this._renderId},j.prototype.incrementRenderId=function(){this._renderId++},j.prototype._updatePointerPosition=function(b){var c=this._engine.getRenderingCanvasClientRect();this._pointerX=b.clientX-c.left;this._pointerY=b.clientY-c.top;this._unTranslatedPointerX=this._pointerX;this._unTranslatedPointerY=this._pointerY;this.cameraToUseForPointers&&(this._pointerX-=this.cameraToUseForPointers.viewport.x*
this._engine.getRenderWidth(),this._pointerY-=this.cameraToUseForPointers.viewport.y*this._engine.getRenderHeight())},j.prototype.attachControl=function(c,g,e){var j=this;void 0===c&&(c=!0);void 0===g&&(g=!0);void 0===e&&(e=!0);var r=function(b){return b.isPickable&&b.actionManager&&b.actionManager.hasPointerTriggers};this._onPointerMove=function(b){if(j._updatePointerPosition(b),j.onPrePointerObservable.hasObservers()){var c="mousewheel"===b.type||"DOMMouseScroll"===b.type?f.POINTERWHEEL:f.POINTERMOVE,
g=new d(c,b,j._unTranslatedPointerX,j._unTranslatedPointerY);if(j.onPrePointerObservable.notifyObservers(g,c),g.skipOnPointerObservable)return}if(j.cameraToUseForPointers||j.activeCamera)if(c=j._engine.getRenderingCanvas(),j.pointerMovePredicate||(j.pointerMovePredicate=function(b){return b.isPickable&&b.isVisible&&b.isReady()&&(j.constantlyUpdateMeshUnderPointer||null!==b.actionManager&&void 0!==b.actionManager)}),g=j.pick(j._unTranslatedPointerX,j._unTranslatedPointerY,j.pointerMovePredicate,!1,
j.cameraToUseForPointers),g.hit&&g.pickedMesh?(j.setPointerOverSprite(null),j.setPointerOverMesh(g.pickedMesh),j._pointerOverMesh.actionManager&&j._pointerOverMesh.actionManager.hasPointerTriggers?c.style.cursor="pointer":c.style.cursor=""):(j.setPointerOverMesh(null),g=j.pickSprite(j._unTranslatedPointerX,j._unTranslatedPointerY,r,!1,j.cameraToUseForPointers),g.hit&&g.pickedSprite?(c.style.cursor="pointer",j.setPointerOverSprite(g.pickedSprite)):(j.setPointerOverSprite(null),c.style.cursor="")),
j.onPointerMove&&j.onPointerMove(b,g),j.onPointerObservable.hasObservers())c="mousewheel"===b.type||"DOMMouseScroll"===b.type?f.POINTERWHEEL:f.POINTERMOVE,g=new m(c,b,g),j.onPointerObservable.notifyObservers(g,c)};this._onPointerDown=function(c){if(j._updatePointerPosition(c),j.onPrePointerObservable.hasObservers()){var g=f.POINTERDOWN,e=new d(g,c,j._unTranslatedPointerX,j._unTranslatedPointerY);if(j.onPrePointerObservable.notifyObservers(e,g),e.skipOnPointerObservable)return}if(j.cameraToUseForPointers||
j.activeCamera){j._startingPointerPosition.x=j._pointerX;j._startingPointerPosition.y=j._pointerY;j._startingPointerTime=(new Date).getTime();j.pointerDownPredicate||(j.pointerDownPredicate=function(b){return b.isPickable&&b.isVisible&&b.isReady()&&(!b.actionManager||b.actionManager.hasPointerTriggers)});j._pickedDownMesh=null;var l=j.pick(j._unTranslatedPointerX,j._unTranslatedPointerY,j.pointerDownPredicate,!1,j.cameraToUseForPointers);if(l.hit&&l.pickedMesh&&l.pickedMesh.actionManager){if(j._pickedDownMesh=
l.pickedMesh,l.pickedMesh.actionManager.hasPickTriggers){switch(c.button){case 0:l.pickedMesh.actionManager.processTrigger(b.ActionManager.OnLeftPickTrigger,b.ActionEvent.CreateNew(l.pickedMesh,c));break;case 1:l.pickedMesh.actionManager.processTrigger(b.ActionManager.OnCenterPickTrigger,b.ActionEvent.CreateNew(l.pickedMesh,c));break;case 2:l.pickedMesh.actionManager.processTrigger(b.ActionManager.OnRightPickTrigger,b.ActionEvent.CreateNew(l.pickedMesh,c))}l.pickedMesh.actionManager.processTrigger(b.ActionManager.OnPickDownTrigger,
b.ActionEvent.CreateNew(l.pickedMesh,c))}l.pickedMesh.actionManager.hasSpecificTrigger(b.ActionManager.OnLongPressTrigger)&&window.setTimeout(function(){var d=j.pick(j._unTranslatedPointerX,j._unTranslatedPointerY,function(c){return c.isPickable&&c.isVisible&&c.isReady()&&c.actionManager&&c.actionManager.hasSpecificTrigger(b.ActionManager.OnLongPressTrigger)},!1,j.cameraToUseForPointers);d.hit&&d.pickedMesh&&d.pickedMesh.actionManager&&0!==j._startingPointerTime&&(new Date).getTime()-j._startingPointerTime>
b.ActionManager.LongPressDelay&&Math.abs(j._startingPointerPosition.x-j._pointerX)<b.ActionManager.DragMovementThreshold&&Math.abs(j._startingPointerPosition.y-j._pointerY)<b.ActionManager.DragMovementThreshold&&(j._startingPointerTime=0,d.pickedMesh.actionManager.processTrigger(b.ActionManager.OnLongPressTrigger,b.ActionEvent.CreateNew(d.pickedMesh,c)))},b.ActionManager.LongPressDelay)}if(j.onPointerDown&&j.onPointerDown(c,l),j.onPointerObservable.hasObservers())g=f.POINTERDOWN,e=new m(g,c,l),j.onPointerObservable.notifyObservers(e,
g);if(j._pickedDownSprite=null,0<j.spriteManagers.length&&(l=j.pickSprite(j._unTranslatedPointerX,j._unTranslatedPointerY,r,!1,j.cameraToUseForPointers),l.hit&&l.pickedSprite&&l.pickedSprite.actionManager)){switch(j._pickedDownSprite=l.pickedSprite,c.button){case 0:l.pickedSprite.actionManager.processTrigger(b.ActionManager.OnLeftPickTrigger,b.ActionEvent.CreateNewFromSprite(l.pickedSprite,j,c));break;case 1:l.pickedSprite.actionManager.processTrigger(b.ActionManager.OnCenterPickTrigger,b.ActionEvent.CreateNewFromSprite(l.pickedSprite,
j,c));break;case 2:l.pickedSprite.actionManager.processTrigger(b.ActionManager.OnRightPickTrigger,b.ActionEvent.CreateNewFromSprite(l.pickedSprite,j,c))}l.pickedSprite.actionManager.processTrigger(b.ActionManager.OnPickDownTrigger,b.ActionEvent.CreateNewFromSprite(l.pickedSprite,j,c))}}};this._onPointerUp=function(c){if(j._updatePointerPosition(c),j.onPrePointerObservable.hasObservers()){var g=f.POINTERUP,e=new d(g,c,j._unTranslatedPointerX,j._unTranslatedPointerY);if(j.onPrePointerObservable.notifyObservers(e,
g),e.skipOnPointerObservable)return}if(j.cameraToUseForPointers||j.activeCamera){j.pointerUpPredicate||(j.pointerUpPredicate=function(c){return c.isPickable&&c.isVisible&&c.isReady()&&(!c.actionManager||c.actionManager.hasPickTriggers||c.actionManager.hasSpecificTrigger(b.ActionManager.OnLongPressTrigger))});var l=j.pick(j._unTranslatedPointerX,j._unTranslatedPointerY,j.pointerUpPredicate,!1,j.cameraToUseForPointers);if(l.hit&&l.pickedMesh){if(null!=j._pickedDownMesh&&l.pickedMesh==j._pickedDownMesh&&
(j.onPointerPick&&j.onPointerPick(c,l),j.onPointerObservable.hasObservers()))g=f.POINTERPICK,e=new m(g,c,l),j.onPointerObservable.notifyObservers(e,g);l.pickedMesh.actionManager&&(l.pickedMesh.actionManager.processTrigger(b.ActionManager.OnPickUpTrigger,b.ActionEvent.CreateNew(l.pickedMesh,c)),Math.abs(j._startingPointerPosition.x-j._pointerX)<b.ActionManager.DragMovementThreshold&&Math.abs(j._startingPointerPosition.y-j._pointerY)<b.ActionManager.DragMovementThreshold&&l.pickedMesh.actionManager.processTrigger(b.ActionManager.OnPickTrigger,
b.ActionEvent.CreateNew(l.pickedMesh,c)))}if(j._pickedDownMesh&&j._pickedDownMesh!==l.pickedMesh&&j._pickedDownMesh.actionManager.processTrigger(b.ActionManager.OnPickOutTrigger,b.ActionEvent.CreateNew(j._pickedDownMesh,c)),j.onPointerUp&&j.onPointerUp(c,l),j.onPointerObservable.hasObservers())g=f.POINTERUP,e=new m(g,c,l),j.onPointerObservable.notifyObservers(e,g);j._startingPointerTime=0;0<j.spriteManagers.length&&(l=j.pickSprite(j._unTranslatedPointerX,j._unTranslatedPointerY,r,!1,j.cameraToUseForPointers),
l.hit&&l.pickedSprite&&l.pickedSprite.actionManager&&(l.pickedSprite.actionManager.processTrigger(b.ActionManager.OnPickUpTrigger,b.ActionEvent.CreateNewFromSprite(l.pickedSprite,j,c)),Math.abs(j._startingPointerPosition.x-j._pointerX)<b.ActionManager.DragMovementThreshold&&Math.abs(j._startingPointerPosition.y-j._pointerY)<b.ActionManager.DragMovementThreshold&&l.pickedSprite.actionManager.processTrigger(b.ActionManager.OnPickTrigger,b.ActionEvent.CreateNewFromSprite(l.pickedSprite,j,c))),j._pickedDownSprite&&
j._pickedDownSprite!==l.pickedSprite&&j._pickedDownSprite.actionManager.processTrigger(b.ActionManager.OnPickOutTrigger,b.ActionEvent.CreateNewFromSprite(j._pickedDownSprite,j,c)))}};this._onKeyDown=function(c){j.actionManager&&j.actionManager.processTrigger(b.ActionManager.OnKeyDownTrigger,b.ActionEvent.CreateNewFromScene(j,c))};this._onKeyUp=function(c){j.actionManager&&j.actionManager.processTrigger(b.ActionManager.OnKeyUpTrigger,b.ActionEvent.CreateNewFromScene(j,c))};var t=b.Tools.GetPointerPrefix();
e&&(this._engine.getRenderingCanvas().addEventListener(t+"move",this._onPointerMove,!1),this._engine.getRenderingCanvas().addEventListener("mousewheel",this._onPointerMove,!1),this._engine.getRenderingCanvas().addEventListener("DOMMouseScroll",this._onPointerMove,!1));g&&this._engine.getRenderingCanvas().addEventListener(t+"down",this._onPointerDown,!1);c&&this._engine.getRenderingCanvas().addEventListener(t+"up",this._onPointerUp,!1);b.Tools.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},
{name:"keyup",handler:this._onKeyUp}])},j.prototype.detachControl=function(){var c=b.Tools.GetPointerPrefix();this._engine.getRenderingCanvas().removeEventListener(c+"move",this._onPointerMove);this._engine.getRenderingCanvas().removeEventListener(c+"down",this._onPointerDown);this._engine.getRenderingCanvas().removeEventListener(c+"up",this._onPointerUp);this._engine.getRenderingCanvas().removeEventListener("mousewheel",this._onPointerMove);this._engine.getRenderingCanvas().removeEventListener("DOMMouseScroll",
this._onPointerMove);b.Tools.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp}])},j.prototype.isReady=function(){if(0<this._pendingData.length)return!1;var c;for(c=0;c<this._geometries.length;c++)if(this._geometries[c].delayLoadState===b.Engine.DELAYLOADSTATE_LOADING)return!1;for(c=0;c<this.meshes.length;c++){var d=this.meshes[c];if(!d.isReady())return!1;var g=d.material;if(g&&!g.isReady(d))return!1}return!0},j.prototype.resetCachedMaterial=function(){this._cachedMaterial=
null},j.prototype.registerBeforeRender=function(b){this.onBeforeRenderObservable.add(b)},j.prototype.unregisterBeforeRender=function(b){this.onBeforeRenderObservable.removeCallback(b)},j.prototype.registerAfterRender=function(b){this.onAfterRenderObservable.add(b)},j.prototype.unregisterAfterRender=function(b){this.onAfterRenderObservable.removeCallback(b)},j.prototype._addPendingData=function(b){this._pendingData.push(b)},j.prototype._removePendingData=function(b){b=this._pendingData.indexOf(b);
-1!==b&&this._pendingData.splice(b,1)},j.prototype.getWaitingItemsCount=function(){return this._pendingData.length},j.prototype.executeWhenReady=function(b){var c=this;this.onReadyObservable.add(b);-1===this._executeWhenReadyTimeoutId&&(this._executeWhenReadyTimeoutId=setTimeout(function(){c._checkIsReady()},150))},j.prototype._checkIsReady=function(){var b=this;return this.isReady()?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=
-1)):void(this._executeWhenReadyTimeoutId=setTimeout(function(){b._checkIsReady()},150))},j.prototype.beginAnimation=function(c,d,g,e,f,j,m){if(void 0===f&&(f=1),this.stopAnimation(c),m||(m=new b.Animatable(this,c,d,g,e,f,j)),c.animations&&m.appendAnimations(c,c.animations),c.getAnimatables){c=c.getAnimatables();for(var u=0;u<c.length;u++)this.beginAnimation(c[u],d,g,e,f,j,m)}return m.reset(),m},j.prototype.beginDirectAnimation=function(c,d,g,e,f,j,m){void 0===j&&(j=1);return new b.Animatable(this,
c,g,e,f,j,m,d)},j.prototype.getAnimatableByTarget=function(b){for(var c=0;c<this._activeAnimatables.length;c++)if(this._activeAnimatables[c].target===b)return this._activeAnimatables[c];return null},Object.defineProperty(j.prototype,"Animatables",{get:function(){return this._activeAnimatables},enumerable:!0,configurable:!0}),j.prototype.stopAnimation=function(b){(b=this.getAnimatableByTarget(b))&&b.stop()},j.prototype._animate=function(){if(this.animationsEnabled&&0!==this._activeAnimatables.length){if(!this._animationStartDate){if(0<
this._pendingData.length)return;this._animationStartDate=b.Tools.Now}for(var c=b.Tools.Now-this._animationStartDate,d=0;d<this._activeAnimatables.length;d++)this._activeAnimatables[d]._animate(c)}},j.prototype.getViewMatrix=function(){return this._viewMatrix},j.prototype.getProjectionMatrix=function(){return this._projectionMatrix},j.prototype.getTransformMatrix=function(){return this._transformMatrix},j.prototype.setTransformMatrix=function(b,c){this._viewMatrix=b;this._projectionMatrix=c;this._viewMatrix.multiplyToRef(this._projectionMatrix,
this._transformMatrix)},j.prototype.addMesh=function(b){b.uniqueId=this._uniqueIdCounter++;this.meshes.push(b);this.collisionCoordinator.onMeshAdded(b);this.onNewMeshAddedObservable.notifyObservers(b)},j.prototype.removeMesh=function(b){var c=this.meshes.indexOf(b);return-1!==c&&this.meshes.splice(c,1),this.collisionCoordinator.onMeshRemoved(b),this.onMeshRemovedObservable.notifyObservers(b),c},j.prototype.removeSkeleton=function(b){b=this.skeletons.indexOf(b);return-1!==b&&this.skeletons.splice(b,
1),b},j.prototype.removeLight=function(b){var c=this.lights.indexOf(b);return-1!==c&&this.lights.splice(c,1),this.onLightRemovedObservable.notifyObservers(b),c},j.prototype.removeCamera=function(b){var c=this.cameras.indexOf(b);-1!==c&&this.cameras.splice(c,1);var d=this.activeCameras.indexOf(b);return-1!==d&&this.activeCameras.splice(d,1),this.activeCamera===b&&(0<this.cameras.length?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(b),c},j.prototype.addLight=
function(b){b.uniqueId=this._uniqueIdCounter++;this.lights.push(b);this.onNewLightAddedObservable.notifyObservers(b)},j.prototype.addCamera=function(b){b.uniqueId=this._uniqueIdCounter++;this.cameras.push(b);this.onNewCameraAddedObservable.notifyObservers(b)},j.prototype.swithActiveCamera=function(b,c){void 0===c&&(c=!0);var d=this._engine.getRenderingCanvas();this.activeCamera.detachControl(d);this.activeCamera=b;c&&b.attachControl(d)},j.prototype.setActiveCameraByID=function(b){return(b=this.getCameraByID(b))?
(this.activeCamera=b,b):null},j.prototype.setActiveCameraByName=function(b){return(b=this.getCameraByName(b))?(this.activeCamera=b,b):null},j.prototype.getMaterialByID=function(b){for(var c=0;c<this.materials.length;c++)if(this.materials[c].id===b)return this.materials[c];return null},j.prototype.getMaterialByName=function(b){for(var c=0;c<this.materials.length;c++)if(this.materials[c].name===b)return this.materials[c];return null},j.prototype.getLensFlareSystemByName=function(b){for(var c=0;c<this.lensFlareSystems.length;c++)if(this.lensFlareSystems[c].name===
b)return this.lensFlareSystems[c];return null},j.prototype.getLensFlareSystemByID=function(b){for(var c=0;c<this.lensFlareSystems.length;c++)if(this.lensFlareSystems[c].id===b)return this.lensFlareSystems[c];return null},j.prototype.getCameraByID=function(b){for(var c=0;c<this.cameras.length;c++)if(this.cameras[c].id===b)return this.cameras[c];return null},j.prototype.getCameraByUniqueID=function(b){for(var c=0;c<this.cameras.length;c++)if(this.cameras[c].uniqueId===b)return this.cameras[c];return null},
j.prototype.getCameraByName=function(b){for(var c=0;c<this.cameras.length;c++)if(this.cameras[c].name===b)return this.cameras[c];return null},j.prototype.getBoneByID=function(b){for(var c=0;c<this.skeletons.length;c++)for(var d=this.skeletons[c],g=0;g<d.bones.length;g++)if(d.bones[g].id===b)return d.bones[g];return null},j.prototype.getBoneByName=function(b){for(var c=0;c<this.skeletons.length;c++)for(var d=this.skeletons[c],g=0;g<d.bones.length;g++)if(d.bones[g].name===b)return d.bones[g];return null},
j.prototype.getLightByName=function(b){for(var c=0;c<this.lights.length;c++)if(this.lights[c].name===b)return this.lights[c];return null},j.prototype.getLightByID=function(b){for(var c=0;c<this.lights.length;c++)if(this.lights[c].id===b)return this.lights[c];return null},j.prototype.getLightByUniqueID=function(b){for(var c=0;c<this.lights.length;c++)if(this.lights[c].uniqueId===b)return this.lights[c];return null},j.prototype.getParticleSystemByID=function(b){for(var c=0;c<this.particleSystems.length;c++)if(this.particleSystems[c].id===
b)return this.particleSystems[c];return null},j.prototype.getGeometryByID=function(b){for(var c=0;c<this._geometries.length;c++)if(this._geometries[c].id===b)return this._geometries[c];return null},j.prototype.pushGeometry=function(b,c){return!c&&this.getGeometryByID(b.id)?!1:(this._geometries.push(b),this.collisionCoordinator.onGeometryAdded(b),this.onNewGeometryAddedObservable.notifyObservers(b),!0)},j.prototype.removeGeometry=function(b){var c=this._geometries.indexOf(b);return-1<c?(this._geometries.splice(c,
1),this.collisionCoordinator.onGeometryDeleted(b),this.onGeometryRemovedObservable.notifyObservers(b),!0):!1},j.prototype.getGeometries=function(){return this._geometries},j.prototype.getMeshByID=function(b){for(var c=0;c<this.meshes.length;c++)if(this.meshes[c].id===b)return this.meshes[c];return null},j.prototype.getMeshesByID=function(b){return this.meshes.filter(function(c){return c.id===b})},j.prototype.getMeshByUniqueID=function(b){for(var c=0;c<this.meshes.length;c++)if(this.meshes[c].uniqueId===
b)return this.meshes[c];return null},j.prototype.getLastMeshByID=function(b){for(var c=this.meshes.length-1;0<=c;c--)if(this.meshes[c].id===b)return this.meshes[c];return null},j.prototype.getLastEntryByID=function(b){var c;for(c=this.meshes.length-1;0<=c;c--)if(this.meshes[c].id===b)return this.meshes[c];for(c=this.cameras.length-1;0<=c;c--)if(this.cameras[c].id===b)return this.cameras[c];for(c=this.lights.length-1;0<=c;c--)if(this.lights[c].id===b)return this.lights[c];return null},j.prototype.getNodeByID=
function(b){var c=this.getMeshByID(b);return c||(c=this.getLightByID(b))?c:(c=this.getCameraByID(b))?c:this.getBoneByID(b)},j.prototype.getNodeByName=function(b){var c=this.getMeshByName(b);return c||(c=this.getLightByName(b))?c:(c=this.getCameraByName(b))?c:this.getBoneByName(b)},j.prototype.getMeshByName=function(b){for(var c=0;c<this.meshes.length;c++)if(this.meshes[c].name===b)return this.meshes[c];return null},j.prototype.getSoundByName=function(c){var d;if(b.AudioEngine){for(d=0;d<this.mainSoundTrack.soundCollection.length;d++)if(this.mainSoundTrack.soundCollection[d].name===
c)return this.mainSoundTrack.soundCollection[d];for(var g=0;g<this.soundTracks.length;g++)for(d=0;d<this.soundTracks[g].soundCollection.length;d++)if(this.soundTracks[g].soundCollection[d].name===c)return this.soundTracks[g].soundCollection[d]}return null},j.prototype.getLastSkeletonByID=function(b){for(var c=this.skeletons.length-1;0<=c;c--)if(this.skeletons[c].id===b)return this.skeletons[c];return null},j.prototype.getSkeletonById=function(b){for(var c=0;c<this.skeletons.length;c++)if(this.skeletons[c].id===
b)return this.skeletons[c];return null},j.prototype.getSkeletonByName=function(b){for(var c=0;c<this.skeletons.length;c++)if(this.skeletons[c].name===b)return this.skeletons[c];return null},j.prototype.isActiveMesh=function(b){return-1!==this._activeMeshes.indexOf(b)},j.prototype._evaluateSubMesh=function(b,c){if(c.alwaysSelectAsActiveMesh||1===c.subMeshes.length||b.isInFrustum(this._frustumPlanes)){var d=b.getMaterial();c.showSubMeshesBoundingBox&&this._boundingBoxRenderer.renderList.push(b.getBoundingInfo().boundingBox);
d&&(d.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(d)&&(this._processedMaterials.push(d),this._renderTargets.concatWithNoDuplicate(d.getRenderTargetTextures())),this._activeIndices+=b.indexCount,this._renderingManager.dispatch(b))}},j.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},j.prototype._evaluateActiveMeshes=function(){this.activeCamera._activeMeshes.reset();this._activeMeshes.reset();this._renderingManager.reset();this._processedMaterials.reset();
this._activeParticleSystems.reset();this._activeSkeletons.reset();this._softwareSkinnedMeshes.reset();this._boundingBoxRenderer.reset();this._edgesRenderers.reset();this._frustumPlanes?b.Frustum.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=b.Frustum.GetPlanes(this._transformMatrix);var c,d;this._selectionOctree?(d=this._selectionOctree.select(this._frustumPlanes),c=d.data,d=d.length):(d=this.meshes.length,c=this.meshes);for(var g=0;d>g;g++){var e=c[g];if(!e.isBlocked&&
(this._totalVertices+=e.getTotalVertices(),e.isReady()&&e.isEnabled())){e.computeWorldMatrix();e.actionManager&&e.actionManager.hasSpecificTriggers([b.ActionManager.OnIntersectionEnterTrigger,b.ActionManager.OnIntersectionExitTrigger])&&this._meshesForIntersections.pushNoDuplicate(e);var f=e.getLOD(this.activeCamera);f&&(e._preActivate(),(e.alwaysSelectAsActiveMesh||e.isVisible&&0<e.visibility&&0!==(e.layerMask&this.activeCamera.layerMask)&&e.isInFrustum(this._frustumPlanes))&&(this._activeMeshes.push(e),
this.activeCamera._activeMeshes.push(e),e._activate(this._renderId),this._activeMesh(f)))}}c=b.Tools.Now;if(this.particlesEnabled){b.Tools.StartPerformanceCounter("Particles",0<this.particleSystems.length);for(d=0;d<this.particleSystems.length;d++)g=this.particleSystems[d],g.isStarted()&&(!g.emitter.position||g.emitter&&g.emitter.isEnabled())&&(this._activeParticleSystems.push(g),g.animate());b.Tools.EndPerformanceCounter("Particles",0<this.particleSystems.length)}this._particlesDuration+=b.Tools.Now-
c},j.prototype._activeMesh=function(b){if(b.skeleton&&this.skeletonsEnabled&&(this._activeSkeletons.pushNoDuplicate(b.skeleton)&&b.skeleton.prepare(),b.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(b)),(b.showBoundingBox||this.forceShowBoundingBoxes)&&this._boundingBoxRenderer.renderList.push(b.getBoundingInfo().boundingBox),b._edgesRenderer&&this._edgesRenderers.push(b._edgesRenderer),b&&b.subMeshes){var c,d;b._submeshesOctree&&b.useOctreeForRenderingSelection?(d=b._submeshesOctree.select(this._frustumPlanes),
c=d.length,d=d.data):(d=b.subMeshes,c=d.length);for(var g=0;c>g;g++)this._evaluateSubMesh(d[g],b)}},j.prototype.updateTransformMatrix=function(b){this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(b))},j.prototype._renderForCamera=function(c){var d=this._engine;if(this.activeCamera=c,!this.activeCamera)throw Error("Active camera not set");b.Tools.StartPerformanceCounter("Rendering camera "+this.activeCamera.name);d.setViewport(this.activeCamera.viewport);
this.resetCachedMaterial();this._renderId++;this.updateTransformMatrix();this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera);var g=b.Tools.Now;b.Tools.StartPerformanceCounter("Active meshes evaluation");this._evaluateActiveMeshes();this._evaluateActiveMeshesDuration+=b.Tools.Now-g;b.Tools.EndPerformanceCounter("Active meshes evaluation");for(g=0;g<this._softwareSkinnedMeshes.length;g++){var e=this._softwareSkinnedMeshes.data[g];e.applySkeleton(e.skeleton)}g=b.Tools.Now;if(this.renderTargetsEnabled&&
0<this._renderTargets.length){this._intermediateRendering=!0;b.Tools.StartPerformanceCounter("Render targets",0<this._renderTargets.length);for(e=0;e<this._renderTargets.length;e++){var f=this._renderTargets.data[e];f._shouldRender()&&(this._renderId++,f.render(f.activeCamera&&f.activeCamera!==this.activeCamera,this.dumpNextRenderTargets))}b.Tools.EndPerformanceCounter("Render targets",0<this._renderTargets.length);this._intermediateRendering=!1;this._renderId++;d.restoreDefaultFramebuffer()}this._renderTargetsDuration+=
b.Tools.Now-g;this.postProcessManager._prepareFrame();g=b.Tools.Now;if(this.layers.length){d.setDepthBuffer(!1);for(e=0;e<this.layers.length;e++)f=this.layers[e],f.isBackground&&f.render();d.setDepthBuffer(!0)}b.Tools.StartPerformanceCounter("Main render");this._renderingManager.render(null,null,!0,!0);b.Tools.EndPerformanceCounter("Main render");this._boundingBoxRenderer.render();for(e=0;e<this._edgesRenderers.length;e++)this._edgesRenderers.data[e].render();if(this.lensFlaresEnabled){b.Tools.StartPerformanceCounter("Lens flares",
0<this.lensFlareSystems.length);for(e=0;e<this.lensFlareSystems.length;e++)f=this.lensFlareSystems[e],0!==(c.layerMask&f.layerMask)&&f.render();b.Tools.EndPerformanceCounter("Lens flares",0<this.lensFlareSystems.length)}if(this.layers.length){d.setDepthBuffer(!1);for(e=0;e<this.layers.length;e++)f=this.layers[e],f.isBackground||f.render();d.setDepthBuffer(!0)}this._renderDuration+=b.Tools.Now-g;this.postProcessManager._finalizeFrame(c.isIntermediate);this.activeCamera._updateFromScene();this._renderTargets.reset();
this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera);b.Tools.EndPerformanceCounter("Rendering camera "+this.activeCamera.name)},j.prototype._processSubCameras=function(c){if(c.cameraRigMode===b.Camera.RIG_MODE_NONE)return void this._renderForCamera(c);for(var d=0;d<c._rigCameras.length;d++)this._renderForCamera(c._rigCameras[d]);this.activeCamera=c;this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix());this.activeCamera._updateFromScene()},
j.prototype._checkIntersections=function(){for(var c=0;c<this._meshesForIntersections.length;c++)for(var d=this._meshesForIntersections.data[c],g=0;g<d.actionManager.actions.length;g++){var e=d.actionManager.actions[g];if(e.trigger===b.ActionManager.OnIntersectionEnterTrigger||e.trigger===b.ActionManager.OnIntersectionExitTrigger){var f=e.getTriggerParameter(),j=f instanceof b.AbstractMesh?f:f.mesh,f=j.intersectsMesh(d,f.usePreciseIntersection),m=d._intersectionsInProgress.indexOf(j);f&&-1===m?e.trigger===
b.ActionManager.OnIntersectionEnterTrigger?(e._executeCurrent(b.ActionEvent.CreateNew(d,null,j)),d._intersectionsInProgress.push(j)):e.trigger===b.ActionManager.OnIntersectionExitTrigger&&d._intersectionsInProgress.push(j):!f&&-1<m&&(e.trigger===b.ActionManager.OnIntersectionExitTrigger&&e._executeCurrent(b.ActionEvent.CreateNew(d,null,j)),d.actionManager.hasSpecificTrigger(b.ActionManager.OnIntersectionExitTrigger)&&e.trigger!==b.ActionManager.OnIntersectionExitTrigger||d._intersectionsInProgress.splice(m,
1))}}},j.prototype.render=function(){var c=b.Tools.Now;this._activeBones=this._activeIndices=this._totalVertices=this._evaluateActiveMeshesDuration=this._renderTargetsDuration=this._renderDuration=this._activeParticles=this._spritesDuration=this._particlesDuration=0;this.getEngine().resetDrawCalls();this._meshesForIntersections.reset();this.resetCachedMaterial();b.Tools.StartPerformanceCounter("Scene rendering");this.actionManager&&this.actionManager.processTrigger(b.ActionManager.OnEveryFrameTrigger,
null);this.simplificationQueue&&!this.simplificationQueue.running&&this.simplificationQueue.executeNext();var d=Math.max(j.MinDeltaTime,Math.min(this._engine.getDeltaTime(),j.MaxDeltaTime));this._animationRatio=0.06*d;this._animate();this._physicsEngine&&(b.Tools.StartPerformanceCounter("Physics"),this._physicsEngine._step(d/1E3),b.Tools.EndPerformanceCounter("Physics"));this.onBeforeRenderObservable.notifyObservers(this);var d=b.Tools.Now,g=this.getEngine(),e=this.activeCamera;if(this.renderTargetsEnabled){b.Tools.StartPerformanceCounter("Custom render targets",
0<this.customRenderTargets.length);for(var f=0;f<this.customRenderTargets.length;f++){var m=this.customRenderTargets[f];if(m._shouldRender()){if(this._renderId++,this.activeCamera=m.activeCamera||this.activeCamera,!this.activeCamera)throw Error("Active camera not set");g.setViewport(this.activeCamera.viewport);this.updateTransformMatrix();m.render(e!==this.activeCamera,this.dumpNextRenderTargets)}}b.Tools.EndPerformanceCounter("Custom render targets",0<this.customRenderTargets.length);this._renderId++}if(0<
this.customRenderTargets.length&&g.restoreDefaultFramebuffer(),this._renderTargetsDuration+=b.Tools.Now-d,this.activeCamera=e,this.proceduralTexturesEnabled){b.Tools.StartPerformanceCounter("Procedural textures",0<this._proceduralTextures.length);for(d=0;d<this._proceduralTextures.length;d++)g=this._proceduralTextures[d],g._shouldRender()&&g.render();b.Tools.EndPerformanceCounter("Procedural textures",0<this._proceduralTextures.length)}if(this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||
this.forcePointsCloud,!0),this.shadowsEnabled)for(d=0;d<this.lights.length;d++)g=this.lights[d],e=g.getShadowGenerator(),g.isEnabled()&&e&&-1!==e.getShadowMap().getScene().textures.indexOf(e.getShadowMap())&&this._renderTargets.push(e.getShadowMap());if(this._depthRenderer&&this._renderTargets.push(this._depthRenderer.getDepthMap()),this.postProcessRenderPipelineManager.update(),0<this.activeCameras.length){d=this._renderId;for(g=0;g<this.activeCameras.length;g++)this._renderId=d,0<g&&this._engine.clear(0,
!1,!0),this._processSubCameras(this.activeCameras[g])}else{if(!this.activeCamera)throw Error("No camera defined");this._processSubCameras(this.activeCamera)}this._checkIntersections();b.AudioEngine&&this._updateAudioParameters();this.afterRender&&this.afterRender();this.onAfterRenderObservable.notifyObservers(this);for(d=0;d<this._toBeDisposed.length;d++)this._toBeDisposed.data[d].dispose(),this._toBeDisposed[d]=null;this._toBeDisposed.reset();this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=
!1);b.Tools.EndPerformanceCounter("Scene rendering");this._lastFrameDuration=b.Tools.Now-c},j.prototype._updateAudioParameters=function(){if(this.audioEnabled&&(0!==this.mainSoundTrack.soundCollection.length||1!==this.soundTracks.length)){var c,d=b.Engine.audioEngine;if(c=0<this.activeCameras.length?this.activeCameras[0]:this.activeCamera,c&&d.canUseWebAudio){d.audioContext.listener.setPosition(c.position.x,c.position.y,c.position.z);c=b.Matrix.Invert(c.getViewMatrix());c=b.Vector3.TransformNormal(new b.Vector3(0,
0,-1),c);c.normalize();d.audioContext.listener.setOrientation(c.x,c.y,c.z,0,1,0);for(d=0;d<this.mainSoundTrack.soundCollection.length;d++)c=this.mainSoundTrack.soundCollection[d],c.useCustomAttenuation&&c.updateDistanceFromListener();for(d=0;d<this.soundTracks.length;d++)for(var g=0;g<this.soundTracks[d].soundCollection.length;g++)c=this.soundTracks[d].soundCollection[g],c.useCustomAttenuation&&c.updateDistanceFromListener()}}},Object.defineProperty(j.prototype,"audioEnabled",{get:function(){return this._audioEnabled},
set:function(c){this._audioEnabled=c;b.AudioEngine&&(this._audioEnabled?this._enableAudio():this._disableAudio())},enumerable:!0,configurable:!0}),j.prototype._disableAudio=function(){var b;for(b=0;b<this.mainSoundTrack.soundCollection.length;b++)this.mainSoundTrack.soundCollection[b].pause();for(b=0;b<this.soundTracks.length;b++)for(var c=0;c<this.soundTracks[b].soundCollection.length;c++)this.soundTracks[b].soundCollection[c].pause()},j.prototype._enableAudio=function(){var b;for(b=0;b<this.mainSoundTrack.soundCollection.length;b++)this.mainSoundTrack.soundCollection[b].isPaused&&
this.mainSoundTrack.soundCollection[b].play();for(b=0;b<this.soundTracks.length;b++)for(var c=0;c<this.soundTracks[b].soundCollection.length;c++)this.soundTracks[b].soundCollection[c].isPaused&&this.soundTracks[b].soundCollection[c].play()},Object.defineProperty(j.prototype,"headphone",{get:function(){return this._headphone},set:function(c){this._headphone=c;b.AudioEngine&&(this._headphone?this._switchAudioModeForHeadphones():this._switchAudioModeForNormalSpeakers())},enumerable:!0,configurable:!0}),
j.prototype._switchAudioModeForHeadphones=function(){this.mainSoundTrack.switchPanningModelToHRTF();for(var b=0;b<this.soundTracks.length;b++)this.soundTracks[b].switchPanningModelToHRTF()},j.prototype._switchAudioModeForNormalSpeakers=function(){this.mainSoundTrack.switchPanningModelToEqualPower();for(var b=0;b<this.soundTracks.length;b++)this.soundTracks[b].switchPanningModelToEqualPower()},j.prototype.enableDepthRenderer=function(){return this._depthRenderer?this._depthRenderer:(this._depthRenderer=
new b.DepthRenderer(this),this._depthRenderer)},j.prototype.disableDepthRenderer=function(){this._depthRenderer&&(this._depthRenderer.dispose(),this._depthRenderer=null)},j.prototype.freezeMaterials=function(){for(var b=0;b<this.materials.length;b++)this.materials[b].freeze()},j.prototype.unfreezeMaterials=function(){for(var b=0;b<this.materials.length;b++)this.materials[b].unfreeze()},j.prototype.dispose=function(){this.afterRender=this.beforeRender=null;this.skeletons=[];this._boundingBoxRenderer.dispose();
this._depthRenderer&&this._depthRenderer.dispose();this._debugLayer&&this._debugLayer.hide();this.onDisposeObservable.notifyObservers(this);this.onDisposeObservable.clear();this.onBeforeRenderObservable.clear();this.onAfterRenderObservable.clear();this.detachControl();b.AudioEngine&&this.disposeSounds();var c,d=this._engine.getRenderingCanvas();for(c=0;c<this.cameras.length;c++)this.cameras[c].detachControl(d);for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);
for(;this.cameras.length;)this.cameras[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.spriteManagers.length;)this.spriteManagers[0].dispose();for(;this.layers.length;)this.layers[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this.postProcessManager.dispose();this._physicsEngine&&this.disablePhysicsEngine();c=this._engine.scenes.indexOf(this);-1<c&&this._engine.scenes.splice(c,1);
this._engine.wipeCaches()},j.prototype.disposeSounds=function(){this.mainSoundTrack.dispose();for(var b=0;b<this.soundTracks.length;b++)this.soundTracks[b].dispose()},j.prototype.getWorldExtends=function(){for(var c=new b.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),d=new b.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),g=0;g<this.meshes.length;g++){var e=this.meshes[g];e.computeWorldMatrix(!0);var f=e.getBoundingInfo().boundingBox.minimumWorld,e=e.getBoundingInfo().boundingBox.maximumWorld;
b.Tools.CheckExtends(f,c,d);b.Tools.CheckExtends(e,c,d)}return{min:c,max:d}},j.prototype.createOrUpdateSelectionOctree=function(c,d){void 0===c&&(c=64);void 0===d&&(d=2);this._selectionOctree||(this._selectionOctree=new b.Octree(b.Octree.CreationFuncForMeshes,c,d));var g=this.getWorldExtends();return this._selectionOctree.update(g.min,g.max,this.meshes),this._selectionOctree},j.prototype.createPickingRay=function(c,d,g,e,f){void 0===f&&(f=!1);var j=this._engine;if(!e){if(!this.activeCamera)throw Error("Active camera not set");
e=this.activeCamera}j=e.viewport.toGlobal(j.getRenderWidth(),j.getRenderHeight());return c=c/this._engine.getHardwareScalingLevel()-j.x,d=d/this._engine.getHardwareScalingLevel()-(this._engine.getRenderHeight()-j.y-j.height),b.Ray.CreateNew(c,d,j.width,j.height,g?g:b.Matrix.Identity(),f?b.Matrix.Identity():e.getViewMatrix(),e.getProjectionMatrix())},j.prototype.createPickingRayInCameraSpace=function(c,d,g){var e=this._engine;if(!g){if(!this.activeCamera)throw Error("Active camera not set");g=this.activeCamera}var e=
g.viewport.toGlobal(e.getRenderWidth(),e.getRenderHeight()),f=b.Matrix.Identity();return c=c/this._engine.getHardwareScalingLevel()-e.x,d=d/this._engine.getHardwareScalingLevel()-(this._engine.getRenderHeight()-e.y-e.height),b.Ray.CreateNew(c,d,e.width,e.height,f,f,g.getProjectionMatrix())},j.prototype._internalPick=function(c,d,g){for(var e=null,f=0;f<this.meshes.length;f++){var j=this.meshes[f];if(d){if(!d(j))continue}else if(!j.isEnabled()||!j.isVisible||!j.isPickable)continue;var m=j.getWorldMatrix(),
m=c(m);if((j=j.intersects(m,g))&&j.hit&&(g||null==e||!(j.distance>=e.distance))&&(e=j,g))break}return e||new b.PickingInfo},j.prototype._internalPickSprites=function(c,d,g,e){var f=null;if(e=e||this.activeCamera,0<this.spriteManagers.length)for(var j=0;j<this.spriteManagers.length;j++){var m=this.spriteManagers[j];if(m.isPickable&&(m=m.intersects(c,e,d,g))&&m.hit&&(g||null==f||!(m.distance>=f.distance))&&(f=m,g))break}return f||new b.PickingInfo},j.prototype.pick=function(b,c,d,g,e){var f=this;return this._internalPick(function(d){return f.createPickingRay(b,
c,d,e)},d,g)},j.prototype.pickSprite=function(b,c,d,g,e){return this._internalPickSprites(this.createPickingRayInCameraSpace(b,c,e),d,g,e)},j.prototype.pickWithRay=function(c,d,g){var e=this;return this._internalPick(function(d){return e._pickWithRayInverseMatrix||(e._pickWithRayInverseMatrix=b.Matrix.Identity()),d.invertToRef(e._pickWithRayInverseMatrix),b.Ray.Transform(c,e._pickWithRayInverseMatrix)},d,g)},j.prototype.setPointerOverMesh=function(c){this._pointerOverMesh!==c&&(this._pointerOverMesh&&
this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(b.ActionManager.OnPointerOutTrigger,b.ActionEvent.CreateNew(this._pointerOverMesh)),this._pointerOverMesh=c,this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(b.ActionManager.OnPointerOverTrigger,b.ActionEvent.CreateNew(this._pointerOverMesh)))},j.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},j.prototype.setPointerOverSprite=function(c){this._pointerOverSprite!==
c&&(this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(b.ActionManager.OnPointerOutTrigger,b.ActionEvent.CreateNewFromSprite(this._pointerOverSprite,this)),this._pointerOverSprite=c,this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(b.ActionManager.OnPointerOverTrigger,b.ActionEvent.CreateNewFromSprite(this._pointerOverSprite,this)))},j.prototype.getPointerOverSprite=
function(){return this._pointerOverSprite},j.prototype.getPhysicsEngine=function(){return this._physicsEngine},j.prototype.enablePhysics=function(c,d){if(this._physicsEngine)return!0;try{return this._physicsEngine=new b.PhysicsEngine(c,d),!0}catch(g){return b.Tools.Error(g.message),!1}},j.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=void 0)},j.prototype.isPhysicsEnabled=function(){return void 0!==this._physicsEngine},j.prototype.setGravity=
function(c){b.Tools.Warn("Deprecated, please use 'scene.getPhysicsEngine().setGravity()'");this._physicsEngine&&this._physicsEngine.setGravity(c)},j.prototype.createCompoundImpostor=function(c,d){b.Tools.Warn("Scene.createCompoundImpostor is deprecated. Please use PhysicsImpostor parent/child");c.parts&&(d=c,c=c.parts);var g=c[0].mesh;g.physicsImpostor=new b.PhysicsImpostor(g,c[0].impostor,d,this);for(var e=1;e<c.length;e++){var f=c[e].mesh;f.parent!==g&&(f.position=f.position.subtract(g.position),
f.parent=g);f.physicsImpostor=new b.PhysicsImpostor(f,c[e].impostor,d,this)}g.physicsImpostor.forceUpdate()},j.prototype.deleteCompoundImpostor=function(b){b=b.parts[0].mesh;b.physicsImpostor.dispose();b.physicsImpostor=null},j.prototype.createDefaultCameraOrLight=function(){if(0===this.lights.length&&new b.HemisphericLight("default light",b.Vector3.Up(),this),!this.activeCamera){var c=new b.FreeCamera("default camera",b.Vector3.Zero(),this),d=this.getWorldExtends(),g=d.min.add(d.max.subtract(d.min).scale(0.5));
c.position=new b.Vector3(g.x,g.y,d.min.z-(d.max.z-d.min.z));c.setTarget(g);this.activeCamera=c}},j.prototype._getByTags=function(c,d,g){if(void 0===d)return c;var e=[];g=g||function(){};for(var f in c){var j=c[f];b.Tags.MatchesQuery(j,d)&&(e.push(j),g(j))}return e},j.prototype.getMeshesByTags=function(b,c){return this._getByTags(this.meshes,b,c)},j.prototype.getCamerasByTags=function(b,c){return this._getByTags(this.cameras,b,c)},j.prototype.getLightsByTags=function(b,c){return this._getByTags(this.lights,
b,c)},j.prototype.getMaterialByTags=function(b,c){return this._getByTags(this.materials,b,c).concat(this._getByTags(this.multiMaterials,b,c))},j._FOGMODE_NONE=0,j._FOGMODE_EXP=1,j._FOGMODE_EXP2=2,j._FOGMODE_LINEAR=3,j.MinDeltaTime=1,j.MaxDeltaTime=1E3,j);b.Scene=g}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(e,c,d,g,f,j){e instanceof b.Mesh?this._engine=e.getScene().getEngine():this._engine=e;this._updatable=d;this._data=c;this._strideSize=g;f||this.create();this._instanced=j};f=(f.prototype.createVertexBuffer=function(e,c,d,g){return new b.VertexBuffer(this._engine,this,e,this._updatable,!0,g?g:this._strideSize,this._instanced,c,d)},f.prototype.isUpdatable=function(){return this._updatable},f.prototype.getData=function(){return this._data},f.prototype.getBuffer=function(){return this._buffer},
f.prototype.getStrideSize=function(){return this._strideSize},f.prototype.getIsInstanced=function(){return this._instanced},f.prototype.create=function(b){!b&&this._buffer||(b=b||this._data,this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,b),this._data=b):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(b),this._data=b):this._buffer=this._engine.createVertexBuffer(b))},f.prototype.update=function(b){this.create(b)},f.prototype.updateDirectly=function(b,
c,d){this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,b,c,d?d*this.getStrideSize():void 0),this._data=null)},f.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},f);b.Buffer=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(c,d,g,f,j,l,n,q,p){if(!l)switch(g){case e.PositionKind:l=3;break;case e.NormalKind:l=3;break;case e.UVKind:case e.UV2Kind:case e.UV3Kind:case e.UV4Kind:case e.UV5Kind:case e.UV6Kind:l=2;break;case e.ColorKind:l=4;break;case e.MatricesIndicesKind:case e.MatricesIndicesExtraKind:l=4;break;case e.MatricesWeightsKind:case e.MatricesWeightsExtraKind:l=4}d instanceof b.Buffer?(l||(l=d.getStrideSize()),this._buffer=d,this._ownsBuffer=!1):(this._buffer=new b.Buffer(c,d,f,l,j,
n),this._ownsBuffer=!0);this._stride=l;this._offset=q?q:0;this._size=p?p:l;this._kind=g};f=(e.prototype.getKind=function(){return this._kind},e.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},e.prototype.getData=function(){return this._buffer.getData()},e.prototype.getBuffer=function(){return this._buffer.getBuffer()},e.prototype.getStrideSize=function(){return this._stride},e.prototype.getOffset=function(){return this._offset},e.prototype.getSize=function(){return this._size},
e.prototype.getIsInstanced=function(){return this._buffer.getIsInstanced()},e.prototype.create=function(b){return this._buffer.create(b)},e.prototype.update=function(b){return this._buffer.update(b)},e.prototype.updateDirectly=function(b,d){return this._buffer.updateDirectly(b,d)},e.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},Object.defineProperty(e,"PositionKind",{get:function(){return e._PositionKind},enumerable:!0,configurable:!0}),Object.defineProperty(e,"NormalKind",
{get:function(){return e._NormalKind},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UVKind",{get:function(){return e._UVKind},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UV2Kind",{get:function(){return e._UV2Kind},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UV3Kind",{get:function(){return e._UV3Kind},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UV4Kind",{get:function(){return e._UV4Kind},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UV5Kind",
{get:function(){return e._UV5Kind},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UV6Kind",{get:function(){return e._UV6Kind},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ColorKind",{get:function(){return e._ColorKind},enumerable:!0,configurable:!0}),Object.defineProperty(e,"MatricesIndicesKind",{get:function(){return e._MatricesIndicesKind},enumerable:!0,configurable:!0}),Object.defineProperty(e,"MatricesWeightsKind",{get:function(){return e._MatricesWeightsKind},enumerable:!0,
configurable:!0}),Object.defineProperty(e,"MatricesIndicesExtraKind",{get:function(){return e._MatricesIndicesExtraKind},enumerable:!0,configurable:!0}),Object.defineProperty(e,"MatricesWeightsExtraKind",{get:function(){return e._MatricesWeightsExtraKind},enumerable:!0,configurable:!0}),e._PositionKind="position",e._NormalKind="normal",e._UVKind="uv",e._UV2Kind="uv2",e._UV3Kind="uv3",e._UV4Kind="uv4",e._UV5Kind="uv5",e._UV6Kind="uv6",e._ColorKind="color",e._MatricesIndicesKind="matricesIndices",e._MatricesWeightsKind=
"matricesWeights",e._MatricesIndicesExtraKind="matricesIndicesExtra",e._MatricesWeightsExtraKind="matricesWeightsExtra",e);b.VertexBuffer=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.AbstractMesh;f=function(b,d){e.call(this,b,d.getScene());d.instances.push(this);this._sourceMesh=d;this.position.copyFrom(d.position);this.rotation.copyFrom(d.rotation);this.scaling.copyFrom(d.scaling);d.rotationQuaternion&&(this.rotationQuaternion=d.rotationQuaternion.clone());this.infiniteDistance=d.infiniteDistance;this.setPivotMatrix(d.getPivotMatrix());this.refreshBoundingInfo();this._syncSubMeshes()};f=(__extends(f,e),Object.defineProperty(f.prototype,"receiveShadows",
{get:function(){return this._sourceMesh.receiveShadows},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,
"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},enumerable:!0,configurable:!0}),f.prototype.getTotalVertices=function(){return this._sourceMesh.getTotalVertices()},Object.defineProperty(f.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!0,configurable:!0}),f.prototype.getVerticesData=function(b,d){return this._sourceMesh.getVerticesData(b,d)},f.prototype.isVerticesDataPresent=function(b){return this._sourceMesh.isVerticesDataPresent(b)},f.prototype.getIndices=
function(){return this._sourceMesh.getIndices()},Object.defineProperty(f.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!0,configurable:!0}),f.prototype.refreshBoundingInfo=function(){var c=this._sourceMesh.getBoundingInfo();this._boundingInfo=new b.BoundingInfo(c.minimum.clone(),c.maximum.clone());this._updateBoundingInfo()},f.prototype._preActivate=function(){this._currentLOD&&this._currentLOD._preActivate()},f.prototype._activate=function(b){this._currentLOD&&
this._currentLOD._registerInstanceForRenderId(this,b)},f.prototype.getLOD=function(){return this._currentLOD=this.sourceMesh.getLOD(this.getScene().activeCamera,this.getBoundingInfo().boundingSphere),this._currentLOD===this.sourceMesh?this:this._currentLOD},f.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var b=0;b<this._sourceMesh.subMeshes.length;b++)this._sourceMesh.subMeshes[b].clone(this,this._sourceMesh)},f.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},
f.prototype.clone=function(c,d,g){c=this._sourceMesh.createInstance(c);if(b.Tools.DeepCopy(this,c,["name","subMeshes"],[]),this.refreshBoundingInfo(),d&&(c.parent=d),!g)for(d=0;d<this.getScene().meshes.length;d++)g=this.getScene().meshes[d],g.parent===this&&g.clone(g.name,c);return c.computeWorldMatrix(!0),c},f.prototype.dispose=function(b){var d=this._sourceMesh.instances.indexOf(this);this._sourceMesh.instances.splice(d,1);e.prototype.dispose.call(this,b)},f);b.InstancedMesh=f}(BABYLON||(BABYLON=
{}));
!function(b){var f;f=function(){this.mustReturn=!1;this.visibleInstances=[];this.renderSelf=[]};b._InstancesBatch=f;var e,c=b.AbstractMesh,d=function(g,e,j,l,n,q){if(void 0===j&&(j=null),void 0===q&&(q=!0),c.call(this,g,e),this.onBeforeRenderObservable=new b.Observable,this.onAfterRenderObservable=new b.Observable,this.onBeforeDrawObservable=new b.Observable,this.delayLoadState=b.Engine.DELAYLOADSTATE_NONE,this.instances=[],this._LODLevels=[],this._visibleInstances={},this._renderIdForInstances=[],
this._batchCache=new f,this._instancesBufferSize=2048,this._sideOrientation=d._DEFAULTSIDE,this._areNormalsFrozen=!1,l){l._geometry&&l._geometry.applyToMesh(this);b.Tools.DeepCopy(l,this,["name","material","skeleton","instances"],["_poseMatrix"]);this.setPivotMatrix(l.getPivotMatrix());this.id=g+"."+l.id;this.material=l.material;var p;if(!n)for(p=0;p<e.meshes.length;p++){var r=e.meshes[p];r.parent===l&&r.clone(g+"."+r.name,this,n)}p=this.getScene().getPhysicsEngine();q&&p&&(q=p.getImpostorForPhysicsObject(l))&&
(this.physicsImpostor=q.clone(this));for(p=0;p<e.particleSystems.length;p++)q=e.particleSystems[p],q.emitter===l&&q.clone(q.name,this);this.computeWorldMatrix(!0)}null!==j&&(this.parent=j)};e=(__extends(d,c),Object.defineProperty(d,"FRONTSIDE",{get:function(){return d._FRONTSIDE},enumerable:!0,configurable:!0}),Object.defineProperty(d,"BACKSIDE",{get:function(){return d._BACKSIDE},enumerable:!0,configurable:!0}),Object.defineProperty(d,"DOUBLESIDE",{get:function(){return d._DOUBLESIDE},enumerable:!0,
configurable:!0}),Object.defineProperty(d,"DEFAULTSIDE",{get:function(){return d._DEFAULTSIDE},enumerable:!0,configurable:!0}),Object.defineProperty(d,"NO_CAP",{get:function(){return d._NO_CAP},enumerable:!0,configurable:!0}),Object.defineProperty(d,"CAP_START",{get:function(){return d._CAP_START},enumerable:!0,configurable:!0}),Object.defineProperty(d,"CAP_END",{get:function(){return d._CAP_END},enumerable:!0,configurable:!0}),Object.defineProperty(d,"CAP_ALL",{get:function(){return d._CAP_ALL},
enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"onBeforeDraw",{set:function(b){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver);this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(b)},enumerable:!0,configurable:!0}),d.prototype.toString=function(d){var e=c.prototype.toString.call(this,d);if(e+=", n vertices: "+this.getTotalVertices(),e+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),
this.animations)for(var f=0;f<this.animations.length;f++)e+=", animation[0]: "+this.animations[f].toString(d);return d&&(e+=", flat shading: "+(this._geometry?this.getVerticesData(b.VertexBuffer.PositionKind).length/3===this.getIndices().length?"YES":"NO":"UNKNOWN")),e},Object.defineProperty(d.prototype,"hasLODLevels",{get:function(){return 0<this._LODLevels.length},enumerable:!0,configurable:!0}),d.prototype._sortLODLevels=function(){this._LODLevels.sort(function(b,c){return b.distance<c.distance?
1:b.distance>c.distance?-1:0})},d.prototype.addLODLevel=function(c,d){if(d&&d._masterMesh)return b.Tools.Warn("You cannot use a mesh as LOD level twice"),this;var e=new b.Internals.MeshLODLevel(c,d);return this._LODLevels.push(e),d&&(d._masterMesh=this),this._sortLODLevels(),this},d.prototype.getLODLevelAtDistance=function(b){for(var c=0;c<this._LODLevels.length;c++){var d=this._LODLevels[c];if(d.distance===b)return d.mesh}return null},d.prototype.removeLODLevel=function(b){for(var c=0;c<this._LODLevels.length;c++)this._LODLevels[c].mesh===
b&&(this._LODLevels.splice(c,1),b&&(b._masterMesh=null));return this._sortLODLevels(),this},d.prototype.getLOD=function(b,c){if(!this._LODLevels||0===this._LODLevels.length)return this;var d=(c?c:this.getBoundingInfo().boundingSphere).centerWorld.subtract(b.globalPosition).length();if(this._LODLevels[this._LODLevels.length-1].distance>d)return this.onLODLevelSelection&&this.onLODLevelSelection(d,this,this._LODLevels[this._LODLevels.length-1].mesh),this;for(var e=0;e<this._LODLevels.length;e++){var f=
this._LODLevels[e];if(f.distance<d)return f.mesh&&(f.mesh._preActivate(),f.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)),this.onLODLevelSelection&&this.onLODLevelSelection(d,this,f.mesh),f.mesh}return this.onLODLevelSelection&&this.onLODLevelSelection(d,this,this),this},Object.defineProperty(d.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),d.prototype.getTotalVertices=function(){return this._geometry?this._geometry.getTotalVertices():0},
d.prototype.getVerticesData=function(b,c){return this._geometry?this._geometry.getVerticesData(b,c):null},d.prototype.getVertexBuffer=function(b){return this._geometry?this._geometry.getVertexBuffer(b):void 0},d.prototype.isVerticesDataPresent=function(b){return this._geometry?this._geometry.isVerticesDataPresent(b):this._delayInfo?-1!==this._delayInfo.indexOf(b):!1},d.prototype.getVerticesDataKinds=function(){if(!this._geometry){var b=[];if(this._delayInfo)for(var c in this._delayInfo)b.push(c);
return b}return this._geometry.getVerticesDataKinds()},d.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},d.prototype.getIndices=function(b){return this._geometry?this._geometry.getIndices(b):[]},Object.defineProperty(d.prototype,"isBlocked",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!0,configurable:!0}),d.prototype.isReady=function(){return this.delayLoadState===b.Engine.DELAYLOADSTATE_LOADING?!1:c.prototype.isReady.call(this)},
d.prototype.isDisposed=function(){return this._isDisposed},Object.defineProperty(d.prototype,"sideOrientation",{get:function(){return this._sideOrientation},set:function(b){this._sideOrientation=b},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"areNormalsFrozen",{get:function(){return this._areNormalsFrozen},enumerable:!0,configurable:!0}),d.prototype.freezeNormals=function(){this._areNormalsFrozen=!0},d.prototype.unfreezeNormals=function(){this._areNormalsFrozen=!1},Object.defineProperty(d.prototype,
"overridenInstanceCount",{set:function(b){this._overridenInstanceCount=b},enumerable:!0,configurable:!0}),d.prototype._preActivate=function(){var b=this.getScene().getRenderId();this._preActivateId!==b&&(this._preActivateId=b,this._visibleInstances=null)},d.prototype._preActivateForIntermediateRendering=function(b){this._visibleInstances&&(this._visibleInstances.intermediateDefaultRenderId=b)},d.prototype._registerInstanceForRenderId=function(b,c){this._visibleInstances||(this._visibleInstances={},
this._visibleInstances.defaultRenderId=c,this._visibleInstances.selfDefaultRenderId=this._renderId);this._visibleInstances[c]||(this._visibleInstances[c]=[]);this._visibleInstances[c].push(b)},d.prototype.refreshBoundingInfo=function(){if(!this._boundingInfo.isLocked){var c=this.getVerticesData(b.VertexBuffer.PositionKind);c&&(c=b.Tools.ExtractMinAndMax(c,0,this.getTotalVertices()),this._boundingInfo=new b.BoundingInfo(c.minimum,c.maximum));if(this.subMeshes)for(c=0;c<this.subMeshes.length;c++)this.subMeshes[c].refreshBoundingInfo();
this._updateBoundingInfo()}},d.prototype._createGlobalSubMesh=function(){var c=this.getTotalVertices();return c&&this.getIndices()?(this.releaseSubMeshes(),new b.SubMesh(0,0,c,0,this.getTotalIndices(),this)):null},d.prototype.subdivide=function(c){if(!(1>c)){for(var d=this.getTotalIndices(),e=d/c|0,f=0;0!==e%3;)e++;this.releaseSubMeshes();for(var n=0;c>n&&!(f>=d);n++)b.SubMesh.CreateFromIndices(0,f,Math.min(e,d-f),this),f+=e;this.synchronizeInstances()}},d.prototype.setVerticesData=function(c,d,e,
f){this._geometry?this._geometry.setVerticesData(c,d,e,f):(f=new b.VertexData,f.set(d,c),c=this.getScene(),new b.Geometry(b.Geometry.RandomId(),c,f,e,this))},d.prototype.setVerticesBuffer=function(c){if(!this._geometry){var d=this.getScene();(new b.Geometry(b.Geometry.RandomId(),d)).applyToMesh(this)}this._geometry.setVerticesBuffer(c)},d.prototype.updateVerticesData=function(b,c,d,e){this._geometry&&(e?(this.makeGeometryUnique(),this.updateVerticesData(b,c,d,!1)):this._geometry.updateVerticesData(b,
c,d))},d.prototype.updateVerticesDataDirectly=function(c,d,e,f){b.Tools.Warn("Mesh.updateVerticesDataDirectly deprecated since 2.3.");this._geometry&&(f?(this.makeGeometryUnique(),this.updateVerticesDataDirectly(c,d,e,!1)):this._geometry.updateVerticesDataDirectly(c,d,e))},d.prototype.updateMeshPositions=function(c,d){void 0===d&&(d=!0);var e=this.getVerticesData(b.VertexBuffer.PositionKind);if(c(e),this.updateVerticesData(b.VertexBuffer.PositionKind,e,!1,!1),d){var f=this.getIndices(),n=this.getVerticesData(b.VertexBuffer.NormalKind);
b.VertexData.ComputeNormals(e,f,n);this.updateVerticesData(b.VertexBuffer.NormalKind,n,!1,!1)}},d.prototype.makeGeometryUnique=function(){this._geometry&&this._geometry.copy(b.Geometry.RandomId()).applyToMesh(this)},d.prototype.setIndices=function(c,d){if(this._geometry)this._geometry.setIndices(c,d);else{var e=new b.VertexData;e.indices=c;var f=this.getScene();new b.Geometry(b.Geometry.RandomId(),f,e,!1,this)}},d.prototype.toLeftHanded=function(){this._geometry&&this._geometry.toLeftHanded()},d.prototype._bind=
function(c,d,e){var f=this.getScene().getEngine();if(this._unIndexed)c=null;else switch(e){case b.Material.PointFillMode:c=null;break;case b.Material.WireFrameFillMode:c=c.getLinesIndexBuffer(this.getIndices(),f);break;default:case b.Material.TriangleFillMode:c=this._unIndexed?null:this._geometry.getIndexBuffer()}f.bindBuffers(this._geometry.getVertexBuffers(),c,d)},d.prototype._draw=function(c,d,e){if(this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){this.onBeforeDrawObservable.notifyObservers(this);
var f=this.getScene().getEngine();switch(d){case b.Material.PointFillMode:f.drawPointClouds(c.verticesStart,c.verticesCount,e);break;case b.Material.WireFrameFillMode:this._unIndexed?f.drawUnIndexed(!1,c.verticesStart,c.verticesCount,e):f.draw(!1,0,0<e?c.linesIndexCount/2:c.linesIndexCount,e);break;default:this._unIndexed?f.drawUnIndexed(!0,c.verticesStart,c.verticesCount,e):f.draw(!0,c.indexStart,c.indexCount,e)}}},d.prototype.registerBeforeRender=function(b){this.onBeforeRenderObservable.add(b)},
d.prototype.unregisterBeforeRender=function(b){this.onBeforeRenderObservable.removeCallback(b)},d.prototype.registerAfterRender=function(b){this.onAfterRenderObservable.add(b)},d.prototype.unregisterAfterRender=function(b){this.onAfterRenderObservable.removeCallback(b)},d.prototype._getInstancesRenderList=function(b){var c=this.getScene();if(this._batchCache.mustReturn=!1,this._batchCache.renderSelf[b]=this.isEnabled()&&this.isVisible,this._batchCache.visibleInstances[b]=null,this._visibleInstances){var d=
c.getRenderId(),c=c._isInIntermediateRendering()?this._visibleInstances.intermediateDefaultRenderId:this._visibleInstances.defaultRenderId;this._batchCache.visibleInstances[b]=this._visibleInstances[d];var e=this._renderId;if(!this._batchCache.visibleInstances[b]&&c&&(this._batchCache.visibleInstances[b]=this._visibleInstances[c],d=Math.max(c,d),e=Math.max(this._visibleInstances.selfDefaultRenderId,d)),this._batchCache.visibleInstances[b]&&this._batchCache.visibleInstances[b].length){if(this._renderIdForInstances[b]===
d)return this._batchCache.mustReturn=!0,this._batchCache;d!==e&&(this._batchCache.renderSelf[b]=!1)}this._renderIdForInstances[b]=d}return this._batchCache},d.prototype._renderWithInstances=function(c,d,e,f,n){for(var q=e.visibleInstances[c._id],p=64*(q.length+1),r=this._instancesBufferSize,t=this._instancesBuffer;this._instancesBufferSize<p;)this._instancesBufferSize*=2;this._instancesData&&r==this._instancesBufferSize||(this._instancesData=new Float32Array(this._instancesBufferSize/4));var s=p=
0,u=this.getWorldMatrix();if(e.renderSelf[c._id]&&(u.copyToArray(this._instancesData,p),p+=16,s++),q)for(e=0;e<q.length;e++)q[e].getWorldMatrix().copyToArray(this._instancesData,p),p+=16,s++;t&&r==this._instancesBufferSize?t.updateDirectly(this._instancesData,0,s):(t&&t.dispose(),t=new b.Buffer(n,this._instancesData,!0,16,!1,!0),this._instancesBuffer=t,this.setVerticesBuffer(t.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(t.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(t.createVertexBuffer("world2",
8,4)),this.setVerticesBuffer(t.createVertexBuffer("world3",12,4)));n.bindBuffers(this.geometry.getVertexBuffers(),this.geometry.getIndexBuffer(),f);this._draw(c,d,s);n.unbindInstanceAttributes()},d.prototype._processRendering=function(b,c,d,e,f,q){var p=this.getScene().getEngine();if(f)this._renderWithInstances(b,d,e,c,p);else if(e.renderSelf[b._id]&&(q&&q(!1,this.getWorldMatrix()),this._draw(b,d,this._overridenInstanceCount)),e.visibleInstances[b._id])for(c=0;c<e.visibleInstances[b._id].length;c++)f=
e.visibleInstances[b._id][c].getWorldMatrix(),q&&q(!0,f),this._draw(b,d)},d.prototype.render=function(c,d){var e=this.getScene(),f=this._getInstancesRenderList(c._id);if(!f.mustReturn&&this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){this.onBeforeRenderObservable.notifyObservers(this);var n=e.getEngine(),q=null!==n.getCaps().instancedArrays&&null!==f.visibleInstances[c._id]&&void 0!==f.visibleInstances[c._id],p=c.getMaterial();if(p&&p.isReady(this,q)){var r=n.getDepthWrite();
this.renderOutline&&(n.setDepthWrite(!1),e.getOutlineRenderer().render(c,f),n.setDepthWrite(r));p._preBind();var t=p.getEffect(),s=e.forcePointsCloud?b.Material.PointFillMode:e.forceWireframe?b.Material.WireFrameFillMode:p.fillMode;this._bind(c,t,s);var u=this.getWorldMatrix();if(p.bind(u,this),d&&n.setAlphaMode(p.alphaMode),this._processRendering(c,t,s,f,q,function(b,c){b&&p.bindOnlyWorldMatrix(c)}),p.unbind(),this.renderOutline&&r&&(n.setDepthWrite(!0),n.setColorWrite(!1),e.getOutlineRenderer().render(c,
f),n.setColorWrite(!0)),this.renderOverlay)q=n.getAlphaMode(),n.setAlphaMode(b.Engine.ALPHA_COMBINE),e.getOutlineRenderer().render(c,f,!0),n.setAlphaMode(q);this.onAfterRenderObservable.notifyObservers(this)}}},d.prototype.getEmittedParticleSystems=function(){for(var b=[],c=0;c<this.getScene().particleSystems.length;c++){var d=this.getScene().particleSystems[c];d.emitter===this&&b.push(d)}return b},d.prototype.getHierarchyEmittedParticleSystems=function(){var b=[],c=this.getDescendants();c.push(this);
for(var d=0;d<this.getScene().particleSystems.length;d++){var e=this.getScene().particleSystems[d];-1!==c.indexOf(e.emitter)&&b.push(e)}return b},d.prototype._checkDelayState=function(){var c=this,d=this.getScene();if(this._geometry)this._geometry.load(d);else if(this.delayLoadState===b.Engine.DELAYLOADSTATE_NOTLOADED){this.delayLoadState=b.Engine.DELAYLOADSTATE_LOADING;d._addPendingData(this);var e=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");b.Tools.LoadFile(this.delayLoadingFile,
function(e){e instanceof ArrayBuffer?c._delayLoadingFunction(e,c):c._delayLoadingFunction(JSON.parse(e),c);c.delayLoadState=b.Engine.DELAYLOADSTATE_LOADED;d._removePendingData(c)},function(){},d.database,e)}},d.prototype.isInFrustum=function(d){return this.delayLoadState===b.Engine.DELAYLOADSTATE_LOADING?!1:c.prototype.isInFrustum.call(this,d)?(this._checkDelayState(),!0):!1},d.prototype.setMaterialByID=function(b){var c,d=this.getScene().materials;for(c=0;c<d.length;c++)if(d[c].id===b)return void(this.material=
d[c]);d=this.getScene().multiMaterials;for(c=0;c<d.length;c++)if(d[c].id===b)return void(this.material=d[c])},d.prototype.getAnimatables=function(){var b=[];return this.material&&b.push(this.material),this.skeleton&&b.push(this.skeleton),b},d.prototype.bakeTransformIntoVertices=function(c){if(this.isVerticesDataPresent(b.VertexBuffer.PositionKind)){var d=this.subMeshes.splice(0);this._resetPointsArrayCache();var e,f=this.getVerticesData(b.VertexBuffer.PositionKind),n=[];for(e=0;e<f.length;e+=3)b.Vector3.TransformCoordinates(b.Vector3.FromArray(f,
e),c).toArray(n,e);if(this.setVerticesData(b.VertexBuffer.PositionKind,n,this.getVertexBuffer(b.VertexBuffer.PositionKind).isUpdatable()),this.isVerticesDataPresent(b.VertexBuffer.NormalKind)){f=this.getVerticesData(b.VertexBuffer.NormalKind);n=[];for(e=0;e<f.length;e+=3)b.Vector3.TransformNormal(b.Vector3.FromArray(f,e),c).normalize().toArray(n,e);this.setVerticesData(b.VertexBuffer.NormalKind,n,this.getVertexBuffer(b.VertexBuffer.NormalKind).isUpdatable());0>c.m[0]*c.m[5]*c.m[10]&&this.flipFaces();
this.releaseSubMeshes();this.subMeshes=d}}},d.prototype.bakeCurrentTransformIntoVertices=function(){this.bakeTransformIntoVertices(this.computeWorldMatrix(!0));this.scaling.copyFromFloats(1,1,1);this.position.copyFromFloats(0,0,0);this.rotation.copyFromFloats(0,0,0);this.rotationQuaternion&&(this.rotationQuaternion=b.Quaternion.Identity());this._worldMatrix=b.Matrix.Identity()},d.prototype._resetPointsArrayCache=function(){this._positions=null},d.prototype._generatePointsArray=function(){if(this._positions)return!0;
this._positions=[];var c=this.getVerticesData(b.VertexBuffer.PositionKind);if(!c)return!1;for(var d=0;d<c.length;d+=3)this._positions.push(b.Vector3.FromArray(c,d));return!0},d.prototype.clone=function(b,c,e,f){return void 0===f&&(f=!0),new d(b,this.getScene(),c,this,e,f)},d.prototype.dispose=function(b){this._geometry&&this._geometry.releaseForMesh(this,!0);for(this._instancesBuffer&&(this._instancesBuffer.dispose(),this._instancesBuffer=null);this.instances.length;)this.instances[0].dispose();c.prototype.dispose.call(this,
b)},d.prototype.applyDisplacementMap=function(c,d,e,f){var n=this,q=this.getScene();b.Tools.LoadImage(c,function(b){var c=document.createElement("canvas"),g=c.getContext("2d"),q=b.width,u=b.height;c.width=q;c.height=u;g.drawImage(b,0,0);b=g.getImageData(0,0,q,u).data;n.applyDisplacementMapFromBuffer(b,q,u,d,e);f&&f(n)},function(){},q.database)},d.prototype.applyDisplacementMapFromBuffer=function(c,d,e,f,n){if(!this.isVerticesDataPresent(b.VertexBuffer.PositionKind)||!this.isVerticesDataPresent(b.VertexBuffer.NormalKind)||
!this.isVerticesDataPresent(b.VertexBuffer.UVKind))return void b.Tools.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing");for(var q=this.getVerticesData(b.VertexBuffer.PositionKind),p=this.getVerticesData(b.VertexBuffer.NormalKind),r=this.getVerticesData(b.VertexBuffer.UVKind),t=b.Vector3.Zero(),s=b.Vector3.Zero(),u=b.Vector2.Zero(),x=0;x<q.length;x+=3){b.Vector3.FromArrayToRef(q,x,t);b.Vector3.FromArrayToRef(p,x,s);b.Vector2.FromArrayToRef(r,
2*(x/3),u);var y=Math.abs(u.x)*d%d|0,z=Math.abs(u.y)*e%e|0,y=4*(y+z*d),y=0.3*(c[y]/255)+0.59*(c[y+1]/255)+0.11*(c[y+2]/255);s.normalize();s.scaleInPlace(f+(n-f)*y);t=t.add(s);t.toArray(q,x)}b.VertexData.ComputeNormals(q,this.getIndices(),p);this.updateVerticesData(b.VertexBuffer.PositionKind,q);this.updateVerticesData(b.VertexBuffer.NormalKind,p)},d.prototype.convertToFlatShadedMesh=function(){var c,d,e=this.getVerticesDataKinds(),f=[],n=[],q=[],p=!1;for(c=0;c<e.length;c++){d=e[c];var r=this.getVertexBuffer(d);
d!==b.VertexBuffer.NormalKind?(f[d]=r,n[d]=f[d].getData(),q[d]=[]):(p=r.isUpdatable(),e.splice(c,1),c--)}var t,r=this.subMeshes.slice(0),s=this.getIndices(),u=this.getTotalIndices();for(t=0;u>t;t++){var x=s[t];for(c=0;c<e.length;c++){d=e[c];for(var y=f[d].getStrideSize(),z=0;y>z;z++)q[d].push(n[d][x*y+z])}}c=[];d=q[b.VertexBuffer.PositionKind];for(t=0;u>t;t+=3){s[t]=t;s[t+1]=t+1;s[t+2]=t+2;y=b.Vector3.FromArray(d,3*t);n=b.Vector3.FromArray(d,3*(t+1));x=b.Vector3.FromArray(d,3*(t+2));y=y.subtract(n);
n=x.subtract(n);n=b.Vector3.Normalize(b.Vector3.Cross(y,n));for(x=0;3>x;x++)c.push(n.x),c.push(n.y),c.push(n.z)}this.setIndices(s);this.setVerticesData(b.VertexBuffer.NormalKind,c,p);for(c=0;c<e.length;c++)d=e[c],this.setVerticesData(d,q[d],f[d].isUpdatable());this.releaseSubMeshes();for(e=0;e<r.length;e++)f=r[e],new b.SubMesh(f.materialIndex,f.indexStart,f.indexCount,f.indexStart,f.indexCount,this);this.synchronizeInstances()},d.prototype.convertToUnIndexedMesh=function(){var c,d,e=this.getVerticesDataKinds(),
f=[],n=[],q=[];for(c=0;c<e.length;c++){d=e[c];var p=this.getVertexBuffer(d);f[d]=p;n[d]=f[d].getData();q[d]=[]}var r,p=this.subMeshes.slice(0),t=this.getIndices(),s=this.getTotalIndices();for(r=0;s>r;r++){var u=t[r];for(c=0;c<e.length;c++){d=e[c];for(var x=f[d].getStrideSize(),y=0;x>y;y++)q[d].push(n[d][u*x+y])}}for(r=0;s>r;r+=3)t[r]=r,t[r+1]=r+1,t[r+2]=r+2;this.setIndices(t);for(c=0;c<e.length;c++)d=e[c],this.setVerticesData(d,q[d],f[d].isUpdatable());this.releaseSubMeshes();for(c=0;c<p.length;c++)d=
p[c],new b.SubMesh(d.materialIndex,d.indexStart,d.indexCount,d.indexStart,d.indexCount,this);this._unIndexed=!0;this.synchronizeInstances()},d.prototype.flipFaces=function(c){void 0===c&&(c=!1);var d=b.VertexData.ExtractFromMesh(this);if(c&&this.isVerticesDataPresent(b.VertexBuffer.NormalKind))for(c=0;c<d.normals.length;c++)d.normals[c]*=-1;var e;for(c=0;c<d.indices.length;c+=3)e=d.indices[c+1],d.indices[c+1]=d.indices[c+2],d.indices[c+2]=e;d.applyToMesh(this)},d.prototype.createInstance=function(c){return new b.InstancedMesh(c,
this)},d.prototype.synchronizeInstances=function(){for(var b=0;b<this.instances.length;b++)this.instances[b]._syncSubMeshes()},d.prototype.simplify=function(c,d,e,f){void 0===d&&(d=!0);void 0===e&&(e=b.SimplificationType.QUADRATIC);this.getScene().simplificationQueue.addTask({settings:c,parallelProcessing:d,mesh:this,simplificationType:e,successCallback:f})},d.prototype.optimizeIndices=function(c){for(var d=this,e=this.getIndices(),f=this.getVerticesData(b.VertexBuffer.PositionKind),n=[],q=0;q<f.length;q+=
3)n.push(b.Vector3.FromArray(f,q));var p=[];b.AsyncLoop.SyncAsyncForLoop(n.length,40,function(b){b=n.length-1-b;for(var c=n[b],d=0;b>d;++d)if(c.equals(n[d])){p[b]=d;break}},function(){for(var b=0;b<e.length;++b)e[b]=p[e[b]]||e[b];b=d.subMeshes.slice(0);d.setIndices(e);d.subMeshes=b;c&&c(d)})},d.Parse=function(c,e,f){var l=new d(c.name,e);if(l.id=c.id,b.Tags.AddTagsTo(l,c.tags),l.position=b.Vector3.FromArray(c.position),c.rotationQuaternion?l.rotationQuaternion=b.Quaternion.FromArray(c.rotationQuaternion):
c.rotation&&(l.rotation=b.Vector3.FromArray(c.rotation)),l.scaling=b.Vector3.FromArray(c.scaling),c.localMatrix?l.setPivotMatrix(b.Matrix.FromArray(c.localMatrix)):c.pivotMatrix&&l.setPivotMatrix(b.Matrix.FromArray(c.pivotMatrix)),l.setEnabled(c.isEnabled),l.isVisible=c.isVisible,l.infiniteDistance=c.infiniteDistance,l.showBoundingBox=c.showBoundingBox,l.showSubMeshesBoundingBox=c.showSubMeshesBoundingBox,void 0!==c.applyFog&&(l.applyFog=c.applyFog),void 0!==c.pickable&&(l.isPickable=c.pickable),
void 0!==c.alphaIndex&&(l.alphaIndex=c.alphaIndex),l.receiveShadows=c.receiveShadows,l.billboardMode=c.billboardMode,void 0!==c.visibility&&(l.visibility=c.visibility),l.checkCollisions=c.checkCollisions,l._shouldGenerateFlatShading=c.useFlatShading,c.freezeWorldMatrix&&(l._waitingFreezeWorldMatrix=c.freezeWorldMatrix),c.parentId&&(l._waitingParentId=c.parentId),void 0!==c.actions&&(l._waitingActions=c.actions),l.hasVertexAlpha=c.hasVertexAlpha,c.delayLoadingFile?(l.delayLoadState=b.Engine.DELAYLOADSTATE_NOTLOADED,
l.delayLoadingFile=f+c.delayLoadingFile,l._boundingInfo=new b.BoundingInfo(b.Vector3.FromArray(c.boundingBoxMinimum),b.Vector3.FromArray(c.boundingBoxMaximum)),c._binaryInfo&&(l._binaryInfo=c._binaryInfo),l._delayInfo=[],c.hasUVs&&l._delayInfo.push(b.VertexBuffer.UVKind),c.hasUVs2&&l._delayInfo.push(b.VertexBuffer.UV2Kind),c.hasUVs3&&l._delayInfo.push(b.VertexBuffer.UV3Kind),c.hasUVs4&&l._delayInfo.push(b.VertexBuffer.UV4Kind),c.hasUVs5&&l._delayInfo.push(b.VertexBuffer.UV5Kind),c.hasUVs6&&l._delayInfo.push(b.VertexBuffer.UV6Kind),
c.hasColors&&l._delayInfo.push(b.VertexBuffer.ColorKind),c.hasMatricesIndices&&l._delayInfo.push(b.VertexBuffer.MatricesIndicesKind),c.hasMatricesWeights&&l._delayInfo.push(b.VertexBuffer.MatricesWeightsKind),l._delayLoadingFunction=b.Geometry.ImportGeometry,b.SceneLoader.ForceFullSceneLoadingForIncremental&&l._checkDelayState()):b.Geometry.ImportGeometry(c,l),c.materialId?l.setMaterialByID(c.materialId):l.material=null,-1<c.skeletonId&&(l.skeleton=e.getLastSkeletonByID(c.skeletonId),c.numBoneInfluencers&&
(l.numBoneInfluencers=c.numBoneInfluencers)),c.animations){for(var n=0;n<c.animations.length;n++){var q=c.animations[n];l.animations.push(b.Animation.Parse(q))}b.Node.ParseAnimationRanges(l,c,e)}if(c.autoAnimate&&e.beginAnimation(l,c.autoAnimateFrom,c.autoAnimateTo,c.autoAnimateLoop,c.autoAnimateSpeed||1),c.layerMask&&!isNaN(c.layerMask)?l.layerMask=Math.abs(parseInt(c.layerMask)):l.layerMask=268435455,c.physicsImpostor&&(l.physicsImpostor=new b.PhysicsImpostor(l,c.physicsImpostor,{mass:c.physicsMass,
friction:c.physicsFriction,restitution:c.physicsRestitution},e)),c.instances)for(f=0;f<c.instances.length;f++){var n=c.instances[f],p=l.createInstance(n.name);if(b.Tags.AddTagsTo(p,n.tags),p.position=b.Vector3.FromArray(n.position),n.rotationQuaternion?p.rotationQuaternion=b.Quaternion.FromArray(n.rotationQuaternion):n.rotation&&(p.rotation=b.Vector3.FromArray(n.rotation)),p.scaling=b.Vector3.FromArray(n.scaling),p.checkCollisions=l.checkCollisions,c.animations){for(n=0;n<c.animations.length;n++)q=
c.animations[n],p.animations.push(b.Animation.Parse(q));b.Node.ParseAnimationRanges(p,c,e)}}return l},d.CreateRibbon=function(c,d,e,f,n,q,p,r,t){return b.MeshBuilder.CreateRibbon(c,{pathArray:d,closeArray:e,closePath:f,offset:n,updatable:p,sideOrientation:r,instance:t},q)},d.CreateDisc=function(c,d,e,f,n,q){return b.MeshBuilder.CreateDisc(c,{radius:d,tessellation:e,sideOrientation:q,updatable:n},f)},d.CreateBox=function(c,d,e,f,n){return b.MeshBuilder.CreateBox(c,{size:d,sideOrientation:n,updatable:f},
e)},d.CreateSphere=function(c,d,e,f,n,q){return b.MeshBuilder.CreateSphere(c,{segments:d,diameterX:e,diameterY:e,diameterZ:e,sideOrientation:q,updatable:n},f)},d.CreateCylinder=function(c,e,f,l,n,q,p,r,t){void 0!==p&&p instanceof b.Scene||(void 0!==p&&(t=r||d.DEFAULTSIDE,r=p),p=q,q=1);return b.MeshBuilder.CreateCylinder(c,{height:e,diameterTop:f,diameterBottom:l,tessellation:n,subdivisions:q,sideOrientation:t,updatable:r},p)},d.CreateTorus=function(c,d,e,f,n,q,p){return b.MeshBuilder.CreateTorus(c,
{diameter:d,thickness:e,tessellation:f,sideOrientation:p,updatable:q},n)},d.CreateTorusKnot=function(c,d,e,f,n,q,p,r,t,s){return b.MeshBuilder.CreateTorusKnot(c,{radius:d,tube:e,radialSegments:f,tubularSegments:n,p:q,q:p,sideOrientation:s,updatable:t},r)},d.CreateLines=function(c,d,e,f,n){return b.MeshBuilder.CreateLines(c,{points:d,updatable:f,instance:n},e)},d.CreateDashedLines=function(c,d,e,f,n,q,p){return b.MeshBuilder.CreateDashedLines(c,{points:d,dashSize:e,gapSize:f,dashNb:n,updatable:p},
q)},d.ExtrudeShape=function(c,e,f,l,n,q,p,r,t,s){return b.MeshBuilder.ExtrudeShape(c,{shape:e,path:f,scale:l,rotation:n,cap:0===q?0:q||d.NO_CAP,sideOrientation:t,instance:s,updatable:r},p)},d.ExtrudeShapeCustom=function(c,e,f,l,n,q,p,r,t,s,u,x){return b.MeshBuilder.ExtrudeShapeCustom(c,{shape:e,path:f,scaleFunction:l,rotationFunction:n,ribbonCloseArray:q,ribbonClosePath:p,cap:0===r?0:r||d.NO_CAP,sideOrientation:u,instance:x,updatable:s},t)},d.CreateLathe=function(c,d,e,f,n,q,p){return b.MeshBuilder.CreateLathe(c,
{shape:d,radius:e,tessellation:f,sideOrientation:p,updatable:q},n)},d.CreatePlane=function(c,d,e,f,n){return b.MeshBuilder.CreatePlane(c,{size:d,width:d,height:d,sideOrientation:n,updatable:f},e)},d.CreateGround=function(c,d,e,f,n,q){return b.MeshBuilder.CreateGround(c,{width:d,height:e,subdivisions:f,updatable:q},n)},d.CreateTiledGround=function(c,d,e,f,n,q,p,r,t){return b.MeshBuilder.CreateTiledGround(c,{xmin:d,zmin:e,xmax:f,zmax:n,subdivisions:q,precision:p,updatable:t},r)},d.CreateGroundFromHeightMap=
function(c,d,e,f,n,q,p,r,t,s){return b.MeshBuilder.CreateGroundFromHeightMap(c,d,{width:e,height:f,subdivisions:n,minHeight:q,maxHeight:p,updatable:t,onReady:s},r)},d.CreateTube=function(c,d,e,f,n,q,p,r,t,s){return b.MeshBuilder.CreateTube(c,{path:d,radius:e,tessellation:f,radiusFunction:n,arc:1,cap:q,updatable:r,sideOrientation:t,instance:s},p)},d.CreatePolyhedron=function(c,d,e){return b.MeshBuilder.CreatePolyhedron(c,d,e)},d.CreateIcoSphere=function(c,d,e){return b.MeshBuilder.CreateIcoSphere(c,
d,e)},d.CreateDecal=function(c,d,e,f,n,q){return b.MeshBuilder.CreateDecal(c,d,{position:e,normal:f,size:n,angle:q})},d.prototype.setPositionsForCPUSkinning=function(){var c;return this._sourcePositions||(c=this.getVerticesData(b.VertexBuffer.PositionKind),this._sourcePositions=new Float32Array(c),this.getVertexBuffer(b.VertexBuffer.PositionKind).isUpdatable()||this.setVerticesData(b.VertexBuffer.PositionKind,c,!0)),this._sourcePositions},d.prototype.setNormalsForCPUSkinning=function(){var c;return this._sourceNormals||
(c=this.getVerticesData(b.VertexBuffer.NormalKind),this._sourceNormals=new Float32Array(c),this.getVertexBuffer(b.VertexBuffer.NormalKind).isUpdatable()||this.setVerticesData(b.VertexBuffer.NormalKind,c,!0)),this._sourceNormals},d.prototype.applySkeleton=function(c){if(this.geometry&&this.geometry._softwareSkinningRenderId!=this.getScene().getRenderId()){if((this.geometry._softwareSkinningRenderId=this.getScene().getRenderId(),!this.isVerticesDataPresent(b.VertexBuffer.PositionKind))||!this.isVerticesDataPresent(b.VertexBuffer.NormalKind)||
!this.isVerticesDataPresent(b.VertexBuffer.MatricesIndicesKind)||!this.isVerticesDataPresent(b.VertexBuffer.MatricesWeightsKind))return this;this._sourcePositions||this.setPositionsForCPUSkinning();this._sourceNormals||this.setNormalsForCPUSkinning();var d=this.getVerticesData(b.VertexBuffer.PositionKind);d instanceof Float32Array||(d=new Float32Array(d));var e=this.getVerticesData(b.VertexBuffer.NormalKind);e instanceof Float32Array||(e=new Float32Array(e));for(var f=this.getVerticesData(b.VertexBuffer.MatricesIndicesKind),
n=this.getVerticesData(b.VertexBuffer.MatricesWeightsKind),q=4<this.numBoneInfluencers,p=q?this.getVerticesData(b.VertexBuffer.MatricesIndicesExtraKind):null,r=q?this.getVerticesData(b.VertexBuffer.MatricesWeightsExtraKind):null,t=c.getTransformMatrices(this),s=b.Vector3.Zero(),u=new b.Matrix,x=new b.Matrix,y=0,z=0;z<d.length;z+=3,y+=4){var A;for(c=0;4>c&&(A=n[y+c],0<A);c++)b.Matrix.FromFloat32ArrayToRefScaled(t,16*f[y+c],A,x),u.addToSelf(x);if(q)for(c=0;4>c&&(A=r[y+c],0<A);c++)b.Matrix.FromFloat32ArrayToRefScaled(t,
16*p[y+c],A,x),u.addToSelf(x);b.Vector3.TransformCoordinatesFromFloatsToRef(this._sourcePositions[z],this._sourcePositions[z+1],this._sourcePositions[z+2],u,s);s.toArray(d,z);b.Vector3.TransformNormalFromFloatsToRef(this._sourceNormals[z],this._sourceNormals[z+1],this._sourceNormals[z+2],u,s);s.toArray(e,z);u.reset()}return this.updateVerticesData(b.VertexBuffer.PositionKind,d),this.updateVerticesData(b.VertexBuffer.NormalKind,e),this}},d.MinMax=function(b){var c=null,d=null,e;for(e in b){var f=b[e].getBoundingInfo().boundingBox;
c?(c.MinimizeInPlace(f.minimumWorld),d.MaximizeInPlace(f.maximumWorld)):(c=f.minimumWorld,d=f.maximumWorld)}return{min:c,max:d}},d.Center=function(c){c=void 0!==c.min?c:d.MinMax(c);return b.Vector3.Center(c.min,c.max)},d.MergeMeshes=function(c,e,f,l){void 0===e&&(e=!0);if(!f){var n=0;for(f=0;f<c.length;f++)if(c[f]&&(n+=c[f].getTotalVertices(),65536<n))return b.Tools.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),
null}var q,p,r;for(f=0;f<c.length;f++)c[f]&&(c[f].computeWorldMatrix(!0),p=b.VertexData.ExtractFromMesh(c[f],!0),p.transform(c[f].getWorldMatrix()),q?q.merge(p):(q=p,r=c[f]));if(l||(l=new d(r.name+"_merged",r.getScene())),q.applyToMesh(l),l.material=r.material,l.checkCollisions=r.checkCollisions,e)for(f=0;f<c.length;f++)c[f]&&c[f].dispose();return l},d._FRONTSIDE=0,d._BACKSIDE=1,d._DOUBLESIDE=2,d._DEFAULTSIDE=0,d._NO_CAP=0,d._CAP_START=1,d._CAP_END=2,d._CAP_ALL=3,d);b.Mesh=e}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(b,d,e,f,j,l,n,q){void 0===q&&(q=!0);this.materialIndex=b;this.verticesStart=d;this.verticesCount=e;this.indexStart=f;this.indexCount=j;this._renderId=0;this._mesh=l;this._renderingMesh=n||l;l.subMeshes.push(this);this._trianglePlanes=[];this._id=l.subMeshes.length-1;q&&(this.refreshBoundingInfo(),l.computeWorldMatrix(!0))};f=(Object.defineProperty(e.prototype,"IsGlobal",{get:function(){return 0===this.verticesStart&&this.verticesCount==this._mesh.getTotalVertices()},
enumerable:!0,configurable:!0}),e.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},e.prototype.getMesh=function(){return this._mesh},e.prototype.getRenderingMesh=function(){return this._renderingMesh},e.prototype.getMaterial=function(){var c=this._renderingMesh.material;return c&&c instanceof b.MultiMaterial?c.getSubMaterial(this.materialIndex):c?c:this._mesh.getScene().defaultMaterial},e.prototype.refreshBoundingInfo=function(){if(this._lastColliderWorldVertices=
null,!this.IsGlobal){var c=this._renderingMesh.getVerticesData(b.VertexBuffer.PositionKind);if(!c)return void(this._boundingInfo=this._mesh._boundingInfo);var d=this._renderingMesh.getIndices(),c=0===this.indexStart&&this.indexCount===d.length?{minimum:this._renderingMesh.getBoundingInfo().minimum.clone(),maximum:this._renderingMesh.getBoundingInfo().maximum.clone()}:b.Tools.ExtractMinAndMaxIndexed(c,d,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);this._boundingInfo=new b.BoundingInfo(c.minimum,
c.maximum)}},e.prototype._checkCollision=function(b){return this.getBoundingInfo()._checkCollision(b)},e.prototype.updateBoundingInfo=function(b){this.getBoundingInfo()||this.refreshBoundingInfo();this.getBoundingInfo().update(b)},e.prototype.isInFrustum=function(b){return this.getBoundingInfo().isInFrustum(b)},e.prototype.render=function(b){this._renderingMesh.render(this,b)},e.prototype.getLinesIndexBuffer=function(b,d){if(!this._linesIndexBuffer){for(var e=[],f=this.indexStart;f<this.indexStart+
this.indexCount;f+=3)e.push(b[f],b[f+1],b[f+1],b[f+2],b[f+2],b[f]);this._linesIndexBuffer=d.createIndexBuffer(e);this.linesIndexCount=e.length}return this._linesIndexBuffer},e.prototype.canIntersects=function(b){return b.intersectsBox(this.getBoundingInfo().boundingBox)},e.prototype.intersects=function(c,d,e,f){var j=null;if(this._mesh instanceof b.LinesMesh)for(var l=this._mesh,n=this.indexStart;n<this.indexStart+this.indexCount;n+=2){var q=d[e[n]],p=d[e[n+1]],q=c.intersectionSegment(q,p,l.intersectionThreshold);
if(!(0>q)&&(f||!j||q<j.distance)&&(j=new b.IntersectionInfo(null,null,q),f))break}else for(n=this.indexStart;n<this.indexStart+this.indexCount&&!(q=d[e[n]],p=d[e[n+1]],(l=c.intersectsTriangle(q,p,d[e[n+2]]))&&!(0>l.distance)&&(f||!j||l.distance<j.distance)&&(j=l,j.faceId=n/3,f));n+=3);return j},e.prototype.clone=function(c,d){var g=new e(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,c,d,!1);return this.IsGlobal||(g._boundingInfo=new b.BoundingInfo(this.getBoundingInfo().minimum,
this.getBoundingInfo().maximum)),g},e.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var b=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(b,1)},e.CreateFromIndices=function(b,d,g,f,j){var l=Number.MAX_VALUE,n=-Number.MAX_VALUE;j=j||f;for(var q=j.getIndices(),p=d;d+g>p;p++){var r=q[p];l>r&&(l=r);r>n&&(n=r)}return new e(b,l,n-l+1,d,g,f,j)},e);b.SubMesh=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(){};f=(e.CreateBox=function(c,d,e){c=new b.Mesh(c,e);return b.VertexData.CreateBox(d).applyToMesh(c,d.updatable),c},e.CreateSphere=function(c,d,e){c=new b.Mesh(c,e);return b.VertexData.CreateSphere(d).applyToMesh(c,d.updatable),c},e.CreateDisc=function(c,d,e){c=new b.Mesh(c,e);return b.VertexData.CreateDisc(d).applyToMesh(c,d.updatable),c},e.CreateIcoSphere=function(c,d,e){c=new b.Mesh(c,e);return b.VertexData.CreateIcoSphere(d).applyToMesh(c,d.updatable),c},e.CreateRibbon=
function(c,d,e){var f=d.pathArray,j=d.closeArray,l=d.closePath,n=(d.offset,d.sideOrientation),q=d.instance,p=d.updatable;if(q){j=q.getVerticesData(b.VertexBuffer.PositionKind);l=f[0].length;p=0;d=q.sideOrientation===b.Mesh.DOUBLESIDE?2:1;for(n=1;d>=n;n++)for(c=0;c<f.length;c++){e=f[c];for(var r=e.length,l=r>l?l:r,r=0;l>r;)j[p]=e[r].x,j[p+1]=e[r].y,j[p+2]=e[r].z,r++,p+=3;q._closePath&&(j[p]=e[0].x,j[p+1]=e[0].y,j[p+2]=e[0].z,p+=3)}if(q.updateVerticesData(b.VertexBuffer.PositionKind,j,!1,!1),!q.areNormalsFrozen){p=
q.getIndices();l=q.getVerticesData(b.VertexBuffer.NormalKind);if(b.VertexData.ComputeNormals(j,p,l),q._closePath)for(d=p=j=0;d<f.length;d++)j=3*q._idx[d],p=d+1<f.length?3*(q._idx[d+1]-1):l.length-3,l[j]=0.5*(l[j]+l[p]),l[j+1]=0.5*(l[j+1]+l[p+1]),l[j+2]=0.5*(l[j+2]+l[p+2]),l[p]=l[j],l[p+1]=l[j+1],l[p+2]=l[j+2];q.updateVerticesData(b.VertexBuffer.NormalKind,l,!1,!1)}return q}f=new b.Mesh(c,e);f.sideOrientation=n;q=b.VertexData.CreateRibbon(d);return l&&(f._idx=q._idx),f._closePath=l,f._closeArray=j,
q.applyToMesh(f,p),f},e.CreateCylinder=function(c,d,e){c=new b.Mesh(c,e);return b.VertexData.CreateCylinder(d).applyToMesh(c,d.updatable),c},e.CreateTorus=function(c,d,e){c=new b.Mesh(c,e);return b.VertexData.CreateTorus(d).applyToMesh(c,d.updatable),c},e.CreateTorusKnot=function(c,d,e){c=new b.Mesh(c,e);return b.VertexData.CreateTorusKnot(d).applyToMesh(c,d.updatable),c},e.CreateLineSystem=function(c,d,e){var f=d.instance,j=d.lines;if(f)return f.updateMeshPositions(function(b){for(var c=0,d=0;d<
j.length;d++)for(var e=j[d],g=0;g<e.length;g++)b[c]=e[g].x,b[c+1]=e[g].y,b[c+2]=e[g].z,c+=3},!1),f;c=new b.LinesMesh(c,e);return b.VertexData.CreateLineSystem(d).applyToMesh(c,d.updatable),c},e.CreateLines=function(b,d,g){return e.CreateLineSystem(b,{lines:[d.points],updatable:d.updatable,instance:d.instance},g)},e.CreateDashedLines=function(c,d,e){var f=d.points,j=d.instance,l=d.gapSize,n=(d.dashNb,d.dashSize);if(j)return j.updateMeshPositions(function(c){for(var d=b.Vector3.Zero(),e=c.length/6,
g=0,l=0,n=0,x=0,y=0,z=0,A=0,B=0,A=0;A<f.length-1;A++)f[A+1].subtractToRef(f[A],d),g+=d.length();n=g/e;x=j.dashSize*n/(j.dashSize+j.gapSize);for(A=0;A<f.length-1;A++){f[A+1].subtractToRef(f[A],d);l=Math.floor(d.length()/n);d.normalize();for(B=0;l>B&&z<c.length;)y=n*B,c[z]=f[A].x+y*d.x,c[z+1]=f[A].y+y*d.y,c[z+2]=f[A].z+y*d.z,c[z+3]=f[A].x+(y+x)*d.x,c[z+4]=f[A].y+(y+x)*d.y,c[z+5]=f[A].z+(y+x)*d.z,z+=6,B++}for(;z<c.length;)c[z]=f[A].x,c[z+1]=f[A].y,c[z+2]=f[A].z,z+=3},!1),j;c=new b.LinesMesh(c,e);return b.VertexData.CreateDashedLines(d).applyToMesh(c,
d.updatable),c.dashSize=n,c.gapSize=l,c},e.ExtrudeShape=function(c,d,g){return e._ExtrudeShapeGeneric(c,d.shape,d.path,d.scale||1,d.rotation||0,null,null,!1,!1,0===d.cap?0:d.cap||b.Mesh.NO_CAP,!1,g,d.updatable,0===d.sideOrientation?0:d.sideOrientation||b.Mesh.DEFAULTSIDE,d.instance)},e.ExtrudeShapeCustom=function(c,d,g){return e._ExtrudeShapeGeneric(c,d.shape,d.path,null,null,d.scaleFunction||function(){return 1},d.rotationFunction||function(){return 0},d.ribbonCloseArray||!1,d.ribbonClosePath||!1,
0===d.cap?0:d.cap||b.Mesh.NO_CAP,!0,g,d.updatable,0===d.sideOrientation?0:d.sideOrientation||b.Mesh.DEFAULTSIDE,d.instance)},e.CreateLathe=function(c,d,g){for(var f=void 0===d.closed?!0:d.closed,j=d.shape,l=d.radius||1,n=d.tessellation||64,q=d.updatable,p=0===d.sideOrientation?0:d.sideOrientation||b.Mesh.DEFAULTSIDE,r=d.cap||b.Mesh.NO_CAP,t=[],s=0,u=0,x=2*Math.PI/n*(0>=d.arc||1<d.arc?1:d.arc||1),y=[],s=0;n>=s;s++){y=[];r!=b.Mesh.CAP_START&&r!=b.Mesh.CAP_ALL||(y.push(new b.Vector3(0,j[0].y,0)),y.push(new b.Vector3(Math.cos(s*
x)*j[0].x*l,j[0].y,Math.sin(s*x)*j[0].x*l)));for(u=0;u<j.length;u++)d=new b.Vector3(Math.cos(s*x)*j[u].x*l,j[u].y,Math.sin(s*x)*j[u].x*l),y.push(d);r!=b.Mesh.CAP_END&&r!=b.Mesh.CAP_ALL||(y.push(new b.Vector3(Math.cos(s*x)*j[j.length-1].x*l,j[j.length-1].y,Math.sin(s*x)*j[j.length-1].x*l)),y.push(new b.Vector3(0,j[j.length-1].y,0)));t.push(y)}return e.CreateRibbon(c,{pathArray:t,closeArray:f,sideOrientation:p,updatable:q},g)},e.CreatePlane=function(c,d,e){c=new b.Mesh(c,e);if(b.VertexData.CreatePlane(d).applyToMesh(c,
d.updatable),d.sourcePlane)c.translate(d.sourcePlane.normal,d.sourcePlane.d),e=Math.acos(b.Vector3.Dot(d.sourcePlane.normal,b.Axis.Z)),d=b.Vector3.Cross(b.Axis.Z,d.sourcePlane.normal),c.rotate(d,e);return c},e.CreateGround=function(c,d,e){c=new b.GroundMesh(c,e);c._setReady(!1);c._subdivisions=d.subdivisions||1;c._width=d.width||1;c._height=d.height||1;c._maxX=c._width/2;c._maxZ=c._height/2;c._minX=-c._maxX;c._minZ=-c._maxZ;return b.VertexData.CreateGround(d).applyToMesh(c,d.updatable),c._setReady(!0),
c},e.CreateTiledGround=function(c,d,e){c=new b.Mesh(c,e);return b.VertexData.CreateTiledGround(d).applyToMesh(c,d.updatable),c},e.CreateGroundFromHeightMap=function(c,d,e,f){var j=e.width||10,l=e.height||10,n=e.subdivisions||1,q=e.minHeight,p=e.maxHeight||10,r=e.updatable,t=e.onReady,s=new b.GroundMesh(c,f);s._subdivisions=n;s._width=j;s._height=l;s._maxX=s._width/2;s._maxZ=s._height/2;s._minX=-s._maxX;s._minZ=-s._maxZ;s._setReady(!1);return b.Tools.LoadImage(d,function(c){var d=document.createElement("canvas"),
e=d.getContext("2d"),g=c.width,f=c.height;d.width=g;d.height=f;e.drawImage(c,0,0);c=e.getImageData(0,0,g,f).data;b.VertexData.CreateGroundFromHeightMap({width:j,height:l,subdivisions:n,minHeight:q,maxHeight:p,buffer:c,bufferWidth:g,bufferHeight:f}).applyToMesh(s,r);s._setReady(!0);t&&t(s)},function(){},f.database),s},e.CreateTube=function(c,d,g){var f=d.path,j=d.radius||1,l=d.tessellation||64,n=d.radiusFunction,q=d.cap||b.Mesh.NO_CAP,p=d.updatable,r=d.sideOrientation||b.Mesh.DEFAULTSIDE,t=d.instance;
d.arc=0>=d.arc||1<d.arc?1:d.arc||1;var s,u,x=function(c,d,e,g,f,j,l,m){var p,n,q,r,s=d.getTangents(),t=d.getNormals();d=d.getDistances();m*=2*Math.PI/f;var x=j||function(){return g},u=b.Tmp.Matrix[0];j=l===b.Mesh._NO_CAP||l===b.Mesh.CAP_END?0:2;for(var K=0;K<c.length;K++){n=x(K,d[K]);p=[];q=t[K];for(var O=0;f>O;O++)b.Matrix.RotationAxisToRef(s[K],m*O,u),r=p[O]?p[O]:b.Vector3.Zero(),b.Vector3.TransformCoordinatesToRef(q,u,r),r.scaleInPlace(n).addInPlace(c[K]),p[O]=r;e[j]=p;j++}s=function(b,d){for(var e=
[],g=0;b>g;g++)e.push(c[d]);return e};switch(l){case b.Mesh.CAP_START:e[0]=s(f,0);e[1]=e[2].slice(0);break;case b.Mesh.CAP_END:e[j]=e[j-1].slice(0);e[j+1]=s(f,c.length-1);break;case b.Mesh.CAP_ALL:e[0]=s(f,0),e[1]=e[2].slice(0),e[j]=e[j-1].slice(0),e[j+1]=s(f,c.length-1)}return e};if(t)return d=d.arc||t.arc,s=t.path3D.update(f),u=x(f,s,t.pathArray,j,t.tessellation,n,t.cap,d),t=e.CreateRibbon(null,{pathArray:u,instance:t}),t.path3D=s,t.pathArray=u,t.arc=d,t;s=new b.Path3D(f);q=0>q||3<q?0:q;u=x(f,s,
[],j,l,n,q,d.arc);f=e.CreateRibbon(c,{pathArray:u,closePath:!0,closeArray:!1,updatable:p,sideOrientation:r},g);return f.pathArray=u,f.path3D=s,f.tessellation=l,f.cap=q,f.arc=d.arc,f},e.CreatePolyhedron=function(c,d,e){c=new b.Mesh(c,e);return b.VertexData.CreatePolyhedron(d).applyToMesh(c,d.updatable),c},e.CreateDecal=function(c,d,e){var f=d.getIndices(),j=d.getVerticesData(b.VertexBuffer.PositionKind),l=d.getVerticesData(b.VertexBuffer.NormalKind),n=e.position||b.Vector3.Zero(),q=e.normal||b.Vector3.Up(),
p=e.size||new b.Vector3(1,1,1);e=e.angle||0;if(!q)var q=new b.Vector3(0,0,1),r=d.getScene().activeCamera,q=b.Vector3.TransformCoordinates(q,r.getWorldMatrix()),q=r.globalPosition.subtract(q);var r=-Math.atan2(q.z,q.x)-Math.PI/2,t=Math.sqrt(q.x*q.x+q.z*q.z),q=Math.atan2(q.y,t),t=b.Matrix.RotationYawPitchRoll(r,q,e).multiply(b.Matrix.Translation(n.x,n.y,n.z)),t=b.Matrix.Invert(t),s=d.getWorldMatrix().multiply(t),t=new b.VertexData;t.indices=[];t.positions=[];t.normals=[];t.uvs=[];for(var u=0,x=function(c){c=
f[c];var d=new b.PositionNormalVertex;return d.position=new b.Vector3(j[3*c],j[3*c+1],j[3*c+2]),d.position=b.Vector3.TransformCoordinates(d.position,s),d.normal=new b.Vector3(l[3*c],l[3*c+1],l[3*c+2]),d},y=function(c,d){if(0===c.length)return c;for(var e=0.5*Math.abs(b.Vector3.Dot(p,d)),g=function(c,g){var f=b.Vector3.GetClipFactor(c.position,g.position,d,e);return new b.PositionNormalVertex(b.Vector3.Lerp(c.position,g.position,f),b.Vector3.Lerp(c.normal,g.normal,f))},f=[],j=0;j<c.length;j+=3){var l,
m,n,q,r,s,t,x=b.Vector3.Dot(c[j].position,d)-e,u=b.Vector3.Dot(c[j+1].position,d)-e,y=b.Vector3.Dot(c[j+2].position,d)-e;switch(l=0<x,m=0<u,n=0<y,(l?1:0)+(m?1:0)+(n?1:0)){case 0:f.push(c[j]);f.push(c[j+1]);f.push(c[j+2]);break;case 1:if(l&&(q=c[j+1],r=c[j+2],s=g(c[j],q),t=g(c[j],r)),m){q=c[j];r=c[j+2];s=g(c[j+1],q);t=g(c[j+1],r);f.push(s);f.push(r.clone());f.push(q.clone());f.push(r.clone());f.push(s.clone());f.push(t);break}n&&(q=c[j],r=c[j+1],s=g(c[j+2],q),t=g(c[j+2],r));f.push(q.clone());f.push(r.clone());
f.push(s);f.push(t);f.push(s.clone());f.push(r.clone());break;case 2:l||(q=c[j].clone(),r=g(q,c[j+1]),s=g(q,c[j+2]),f.push(q),f.push(r),f.push(s)),m||(q=c[j+1].clone(),r=g(q,c[j+2]),s=g(q,c[j]),f.push(q),f.push(r),f.push(s)),n||(q=c[j+2].clone(),r=g(q,c[j]),s=g(q,c[j+1]),f.push(q),f.push(r),f.push(s))}}return f},z=0;z<f.length;z+=3){var A=[];if(A.push(x(z)),A.push(x(z+1)),A.push(x(z+2)),A=y(A,new b.Vector3(1,0,0)),A=y(A,new b.Vector3(-1,0,0)),A=y(A,new b.Vector3(0,1,0)),A=y(A,new b.Vector3(0,-1,0)),
A=y(A,new b.Vector3(0,0,1)),A=y(A,new b.Vector3(0,0,-1)),0!==A.length)for(var B=0;B<A.length;B++){var C=A[B];t.indices.push(u);C.position.toArray(t.positions,3*u);C.normal.toArray(t.normals,3*u);t.uvs.push(0.5+C.position.x/p.x);t.uvs.push(0.5+C.position.y/p.y);u++}}c=new b.Mesh(c,d.getScene());return t.applyToMesh(c),c.position=n.clone(),c.rotation=new b.Vector3(q,r,e),c},e._ExtrudeShapeGeneric=function(c,d,e,f,j,l,n,q,p,r,t,s,u,x,y){var z,A,B=function(c,d,e,g,f,j,l,m,p,n){var q=e.getTangents(),r=
e.getNormals(),s=e.getBinormals();e=e.getDistances();var t=0;m=n?m:function(){return j};n=n?l:function(){return f};l=p===b.Mesh.NO_CAP||p===b.Mesh.CAP_END?0:2;for(var x=b.Tmp.Matrix[0],u=0;u<d.length;u++){for(var y=[],z=m(u,e[u]),A=n(u,e[u]),B=0;B<c.length;B++){b.Matrix.RotationAxisToRef(q[u],t,x);var Va=q[u].scale(c[B].z).add(r[u].scale(c[B].x)).add(s[u].scale(c[B].y)),Ra=y[B]?y[B]:b.Vector3.Zero();b.Vector3.TransformCoordinatesToRef(Va,x,Ra);Ra.scaleInPlace(A).addInPlace(d[u]);y[B]=Ra}g[l]=y;t+=
z;l++}c=function(c){var d,e=[],g=b.Vector3.Zero();for(d=0;d<c.length;d++)g.addInPlace(c[d]);g.scaleInPlace(1/c.length);for(d=0;d<c.length;d++)e.push(g);return e};switch(p){case b.Mesh.CAP_START:g[0]=c(g[2]);g[1]=g[2].slice(0);break;case b.Mesh.CAP_END:g[l]=g[l-1];g[l+1]=c(g[l-1]);break;case b.Mesh.CAP_ALL:g[0]=c(g[2]),g[1]=g[2].slice(0),g[l]=g[l-1],g[l+1]=c(g[l-1])}return g};if(y)return z=y.path3D.update(e),A=B(d,e,y.path3D,y.pathArray,f,j,l,n,y.cap,t),y=b.Mesh.CreateRibbon(null,A,null,null,null,
null,null,null,y);z=new b.Path3D(e);r=0>r||3<r?0:r;A=B(d,e,z,[],f,j,l,n,r,t);c=b.Mesh.CreateRibbon(c,A,q,p,0,s,u,x);return c.pathArray=A,c.path3D=z,c.cap=r,c},e);b.MeshBuilder=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(e){this.getAlphaFromRGB=this.hasAlpha=!1;this.level=1;this.coordinatesIndex=0;this.coordinatesMode=b.Texture.EXPLICIT_MODE;this.wrapV=this.wrapU=b.Texture.WRAP_ADDRESSMODE;this.anisotropicFilteringLevel=4;this.isRenderTarget=this.isCube=!1;this.animations=[];this.onDisposeObservable=new b.Observable;this.delayLoadState=b.Engine.DELAYLOADSTATE_NONE;this._scene=e;this._scene.textures.push(this)};f=(f.prototype.toString=function(){return this.name},Object.defineProperty(f.prototype,
"onDispose",{set:function(b){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver);this._onDisposeObserver=this.onDisposeObservable.add(b)},enumerable:!0,configurable:!0}),f.prototype.getScene=function(){return this._scene},f.prototype.getTextureMatrix=function(){return null},f.prototype.getReflectionTextureMatrix=function(){return null},f.prototype.getInternalTexture=function(){return this._texture},f.prototype.isReady=function(){return this.delayLoadState===b.Engine.DELAYLOADSTATE_NOTLOADED?
!0:this._texture?this._texture.isReady:!1},f.prototype.getSize=function(){return this._texture._width?{width:this._texture._width,height:this._texture._height}:this._texture._size?{width:this._texture._size,height:this._texture._size}:{width:0,height:0}},f.prototype.getBaseSize=function(){return this.isReady()&&this._texture?this._texture._size?{width:this._texture._size,height:this._texture._size}:{width:this._texture._baseWidth,height:this._texture._baseHeight}:{width:0,height:0}},f.prototype.scale=
function(){},Object.defineProperty(f.prototype,"canRescale",{get:function(){return!1},enumerable:!0,configurable:!0}),f.prototype._removeFromCache=function(b,c){for(var d=this._scene.getEngine().getLoadedTexturesCache(),g=0;g<d.length;g++){var f=d[g];if(f.url===b&&f.noMipmap===c)return void d.splice(g,1)}},f.prototype._getFromCache=function(b,c,d){for(var g=this._scene.getEngine().getLoadedTexturesCache(),f=0;f<g.length;f++){var j=g[f];if(j.url===b&&j.noMipmap===c&&(!d||d===j.samplingMode))return j.references++,
j}return null},f.prototype.delayLoad=function(){},f.prototype.clone=function(){return null},f.prototype.releaseInternalTexture=function(){this._texture&&(this._scene.getEngine().releaseInternalTexture(this._texture),delete this._texture)},f.prototype.dispose=function(){this.getScene().stopAnimation(this);var b=this._scene.textures.indexOf(this);0<=b&&this._scene.textures.splice(b,1);void 0!==this._texture&&(this.releaseInternalTexture(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear())},
f.prototype.serialize=function(){if(!this.name)return null;var e=b.SerializationHelper.Serialize(this);return b.Animation.AppendSerializedAnimations(this,e),e},__decorate([b.serialize()],f.prototype,"name",void 0),__decorate([b.serialize()],f.prototype,"hasAlpha",void 0),__decorate([b.serialize()],f.prototype,"getAlphaFromRGB",void 0),__decorate([b.serialize()],f.prototype,"level",void 0),__decorate([b.serialize()],f.prototype,"coordinatesIndex",void 0),__decorate([b.serialize()],f.prototype,"coordinatesMode",
void 0),__decorate([b.serialize()],f.prototype,"wrapU",void 0),__decorate([b.serialize()],f.prototype,"wrapV",void 0),__decorate([b.serialize()],f.prototype,"anisotropicFilteringLevel",void 0),__decorate([b.serialize()],f.prototype,"isCube",void 0),__decorate([b.serialize()],f.prototype,"isRenderTarget",void 0),f);b.BaseTexture=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.BaseTexture,c=function(d,g,f,j,l,n,q,p,r){void 0===l&&(l=c.TRILINEAR_SAMPLINGMODE);void 0===n&&(n=null);void 0===q&&(q=null);void 0===p&&(p=null);void 0===r&&(r=!1);e.call(this,g);this.vOffset=this.uOffset=0;this.vScale=this.uScale=1;this.wAng=this.vAng=this.uAng=0;this.url=this.name=d;this._noMipmap=f;this._invertY=j;this._samplingMode=l;this._buffer=p;this._deleteBuffer=r;d&&(this._texture=this._getFromCache(d,f,l),this._texture?b.Tools.SetImmediate(function(){n&&n()}):g.useDelayedTextureLoading?
(this.delayLoadState=b.Engine.DELAYLOADSTATE_NOTLOADED,this._delayedOnLoad=n,this._delayedOnError=q):(this._texture=g.getEngine().createTexture(d,f,j,g,this._samplingMode,n,q,this._buffer),r&&delete this._buffer))};f=(__extends(c,e),Object.defineProperty(c.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!0,configurable:!0}),c.prototype.delayLoad=function(){this.delayLoadState===b.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=b.Engine.DELAYLOADSTATE_LOADED,this._texture=
this._getFromCache(this.url,this._noMipmap,this._samplingMode),this._texture||(this._texture=this.getScene().getEngine().createTexture(this.url,this._noMipmap,this._invertY,this.getScene(),this._samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer),this._deleteBuffer&&delete this._buffer))},c.prototype.updateSamplingMode=function(b){this._texture&&(this._samplingMode=b,this.getScene().getEngine().updateTextureSamplingMode(b,this._texture))},c.prototype._prepareRowForTextureGeneration=
function(c,e,f,j){c*=this.uScale;e*=this.vScale;c-=0.5*this.uScale;e-=0.5*this.vScale;b.Vector3.TransformCoordinatesFromFloatsToRef(c,e,f-0.5,this._rowGenerationMatrix,j);j.x+=0.5*this.uScale+this.uOffset;j.y+=0.5*this.vScale+this.vOffset;j.z+=0.5},c.prototype.getTextureMatrix=function(){return this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===
this._cachedWAng?this._cachedTextureMatrix:(this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedTextureMatrix||(this._cachedTextureMatrix=b.Matrix.Zero(),this._rowGenerationMatrix=new b.Matrix,this._t0=b.Vector3.Zero(),this._t1=b.Vector3.Zero(),this._t2=b.Vector3.Zero()),b.Matrix.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,
this._rowGenerationMatrix),this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),b.Matrix.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix.m[0]=this._t1.x,this._cachedTextureMatrix.m[1]=this._t1.y,this._cachedTextureMatrix.m[2]=this._t1.z,this._cachedTextureMatrix.m[4]=this._t2.x,this._cachedTextureMatrix.m[5]=
this._t2.y,this._cachedTextureMatrix.m[6]=this._t2.z,this._cachedTextureMatrix.m[8]=this._t0.x,this._cachedTextureMatrix.m[9]=this._t0.y,this._cachedTextureMatrix.m[10]=this._t0.z,this._cachedTextureMatrix)},c.prototype.getReflectionTextureMatrix=function(){if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode)return this._cachedTextureMatrix;switch(this._cachedTextureMatrix||
(this._cachedTextureMatrix=b.Matrix.Zero(),this._projectionModeMatrix=b.Matrix.Zero()),this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case c.PLANAR_MODE:b.Matrix.IdentityToRef(this._cachedTextureMatrix);this._cachedTextureMatrix[0]=this.uScale;this._cachedTextureMatrix[5]=this.vScale;this._cachedTextureMatrix[12]=this.uOffset;this._cachedTextureMatrix[13]=this.vOffset;break;case c.PROJECTION_MODE:b.Matrix.IdentityToRef(this._projectionModeMatrix);this._projectionModeMatrix.m[0]=
0.5;this._projectionModeMatrix.m[5]=-0.5;this._projectionModeMatrix.m[10]=0;this._projectionModeMatrix.m[12]=0.5;this._projectionModeMatrix.m[13]=0.5;this._projectionModeMatrix.m[14]=1;this._projectionModeMatrix.m[15]=1;this.getScene().getProjectionMatrix().multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:b.Matrix.IdentityToRef(this._cachedTextureMatrix)}return this._cachedTextureMatrix},c.prototype.clone=function(){var d=this;return b.SerializationHelper.Clone(function(){return new c(d._texture.url,
d.getScene(),d._noMipmap,d._invertY,d._samplingMode)},this)},c.CreateFromBase64String=function(b,e,f,j,l,n,q,p){return void 0===n&&(n=c.TRILINEAR_SAMPLINGMODE),void 0===q&&(q=null),void 0===p&&(p=null),new c("data:"+e,f,j,l,n,q,p,b)},c.Parse=function(d,e,f){if(d.isCube)return b.CubeTexture.Parse(d,e,f);if(!d.name&&!d.isRenderTarget)return null;var j=b.SerializationHelper.Parse(function(){if(d.mirrorPlane){var j=new b.MirrorTexture(d.name,d.renderTargetSize,e);return j._waitingRenderList=d.renderList,
j.mirrorPlane=b.Plane.FromArray(d.mirrorPlane),j}return d.isRenderTarget?(j=new b.RenderTargetTexture(d.name,d.renderTargetSize,e),j._waitingRenderList=d.renderList,j):d.base64String?c.CreateFromBase64String(d.base64String,d.name,e):new c(f+d.name,e)},d,e);if(d.animations)for(var l=0;l<d.animations.length;l++)j.animations.push(b.Animation.Parse(d.animations[l]));return j},c.NEAREST_SAMPLINGMODE=1,c.BILINEAR_SAMPLINGMODE=2,c.TRILINEAR_SAMPLINGMODE=3,c.EXPLICIT_MODE=0,c.SPHERICAL_MODE=1,c.PLANAR_MODE=
2,c.CUBIC_MODE=3,c.PROJECTION_MODE=4,c.SKYBOX_MODE=5,c.INVCUBIC_MODE=6,c.EQUIRECTANGULAR_MODE=7,c.FIXED_EQUIRECTANGULAR_MODE=8,c.CLAMP_ADDRESSMODE=0,c.WRAP_ADDRESSMODE=1,c.MIRROR_ADDRESSMODE=2,__decorate([b.serialize()],c.prototype,"url",void 0),__decorate([b.serialize()],c.prototype,"uOffset",void 0),__decorate([b.serialize()],c.prototype,"vOffset",void 0),__decorate([b.serialize()],c.prototype,"uScale",void 0),__decorate([b.serialize()],c.prototype,"vScale",void 0),__decorate([b.serialize()],c.prototype,
"uAng",void 0),__decorate([b.serialize()],c.prototype,"vAng",void 0),__decorate([b.serialize()],c.prototype,"wAng",void 0),c);b.Texture=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.BaseTexture,c=function(c,g,f,j,l){if(e.call(this,g),this.coordinatesMode=b.Texture.CUBIC_MODE,this.name=c,this.url=c,this._noMipmap=j,this.hasAlpha=!1,c||l){if(this._texture=this._getFromCache(c,j),!l){f||(f="_px.jpg _py.jpg _pz.jpg _nx.jpg _ny.jpg _nz.jpg".split(" "));l=[];for(var n=0;n<f.length;n++)l.push(c+f[n]);this._extensions=f}this._files=l;this._texture||(g.useDelayedTextureLoading?this.delayLoadState=b.Engine.DELAYLOADSTATE_NOTLOADED:this._texture=g.getEngine().createCubeTexture(c,
g,l,j));this.isCube=!0;this._textureMatrix=b.Matrix.Identity()}};f=(__extends(c,e),c.CreateFromImages=function(b,e,f){return new c("",e,null,f,b)},c.prototype.delayLoad=function(){this.delayLoadState===b.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=b.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||(this._texture=this.getScene().getEngine().createCubeTexture(this.url,this.getScene(),this._extensions)))},c.prototype.getReflectionTextureMatrix=
function(){return this._textureMatrix},c.Parse=function(c,e,f){var j=b.SerializationHelper.Parse(function(){return new b.CubeTexture(f+c.name,e,c.extensions)},c,e);if(c.animations)for(var l=0;l<c.animations.length;l++)j.animations.push(b.Animation.Parse(c.animations[l]));return j},c.prototype.clone=function(){var d=this;return b.SerializationHelper.Clone(function(){return new c(d.url,d.getScene(),d._extensions,d._noMipmap,d._files)},this)},c);b.CubeTexture=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.Texture,c=function(c,g,f,j,l,n,q,p){void 0===l&&(l=!0);void 0===n&&(n=b.Engine.TEXTURETYPE_UNSIGNED_INT);void 0===q&&(q=!1);void 0===p&&(p=b.Texture.TRILINEAR_SAMPLINGMODE);e.call(this,null,f,!j);this.isCube=q;this.renderList=[];this.renderParticles=!0;this.renderSprites=!1;this.coordinatesMode=b.Texture.PROJECTION_MODE;this.onAfterUnbindObservable=new b.Observable;this.onBeforeRenderObservable=new b.Observable;this.onAfterRenderObservable=new b.Observable;this.onClearObservable=
new b.Observable;this._currentRefreshId=-1;this._refreshRate=1;this.name=c;this.isRenderTarget=!0;this._size=g;this._generateMipMaps=j;this._doNotChangeAspectRatio=l;p===b.Texture.NEAREST_SAMPLINGMODE&&(this.wrapU=b.Texture.CLAMP_ADDRESSMODE,this.wrapV=b.Texture.CLAMP_ADDRESSMODE);q?(this._texture=f.getEngine().createRenderTargetCubeTexture(g,{generateMipMaps:j,samplingMode:p}),this.coordinatesMode=b.Texture.INVCUBIC_MODE,this._textureMatrix=b.Matrix.Identity()):this._texture=f.getEngine().createRenderTargetTexture(g,
{generateMipMaps:j,type:n,samplingMode:p});this._renderingManager=new b.RenderingManager(f)};f=(__extends(c,e),Object.defineProperty(c,"REFRESHRATE_RENDER_ONCE",{get:function(){return c._REFRESHRATE_RENDER_ONCE},enumerable:!0,configurable:!0}),Object.defineProperty(c,"REFRESHRATE_RENDER_ONEVERYFRAME",{get:function(){return c._REFRESHRATE_RENDER_ONEVERYFRAME},enumerable:!0,configurable:!0}),Object.defineProperty(c,"REFRESHRATE_RENDER_ONEVERYTWOFRAMES",{get:function(){return c._REFRESHRATE_RENDER_ONEVERYTWOFRAMES},
enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onAfterUnbind",{set:function(b){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver);this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onBeforeRender",{set:function(b){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver);this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(b)},
enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onAfterRender",{set:function(b){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver);this._onAfterRenderObserver=this.onAfterRenderObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onClear",{set:function(b){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver);this._onClearObserver=this.onClearObservable.add(b)},enumerable:!0,configurable:!0}),
c.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(c.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(b){this._refreshRate=b;this.resetRefreshCounter()},enumerable:!0,configurable:!0}),c.prototype._shouldRender=function(){return-1===this._currentRefreshId?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},c.prototype.isReady=function(){return this.getScene().renderTargetsEnabled?
e.prototype.isReady.call(this):!1},c.prototype.getRenderSize=function(){return this._size},Object.defineProperty(c.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),c.prototype.scale=function(b){this.resize(this._size*b,this._generateMipMaps)},c.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:e.prototype.getReflectionTextureMatrix.call(this)},c.prototype.resize=function(b,c){this.releaseInternalTexture();this.isCube?this._texture=
this.getScene().getEngine().createRenderTargetCubeTexture(b):this._texture=this.getScene().getEngine().createRenderTargetTexture(b,c)},c.prototype.render=function(b,c){var e=this.getScene();if(void 0!==this.useCameraPostProcesses&&(b=this.useCameraPostProcesses),this.activeCamera&&this.activeCamera!==e.activeCamera&&e.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(!0)),this._waitingRenderList){this.renderList=[];for(var f=0;f<this._waitingRenderList.length;f++)this.renderList.push(e.getMeshByID(this._waitingRenderList[f]));
delete this._waitingRenderList}if(this.renderListPredicate){this.renderList.splice(0);for(var l=this.getScene().meshes,f=0;f<l.length;f++){var n=l[f];this.renderListPredicate(n)&&this.renderList.push(n)}}if(!this.renderList||0!==this.renderList.length){this._renderingManager.reset();for(var f=this.renderList?this.renderList:e.getActiveMeshes().data,l=e.getRenderId(),q=0;q<f.length;q++)if(n=f[q])if(n.isReady()){if(n._preActivateForIntermediateRendering(l),n.isEnabled()&&n.isVisible&&n.subMeshes&&0!==
(n.layerMask&e.activeCamera.layerMask)){n._activate(l);for(var p=0;p<n.subMeshes.length;p++){var r=n.subMeshes[p];e._activeIndices+=r.indexCount;this._renderingManager.dispatch(r)}}}else this.resetRefreshCounter();if(this.isCube)for(n=0;6>n;n++)this.renderToTarget(n,f,b,c),e.incrementRenderId(),e.resetCachedMaterial();else this.renderToTarget(0,f,b,c);this.onAfterUnbindObservable.notifyObservers(this);this.activeCamera&&this.activeCamera!==e.activeCamera&&e.setTransformMatrix(e.activeCamera.getViewMatrix(),
e.activeCamera.getProjectionMatrix(!0));e.resetCachedMaterial()}},c.prototype.renderToTarget=function(c,e,f,j){var l=this.getScene(),n=l.getEngine();f&&l.postProcessManager._prepareFrame(this._texture)||(this.isCube?n.bindFramebuffer(this._texture,c):n.bindFramebuffer(this._texture));this.onBeforeRenderObservable.notifyObservers(c);this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(n):n.clear(l.clearColor,!0,!0);this._doNotChangeAspectRatio||l.updateTransformMatrix(!0);this._renderingManager.render(this.customRenderFunction,
e,this.renderParticles,this.renderSprites);f&&l.postProcessManager._finalizeFrame(!1,this._texture,c);this._doNotChangeAspectRatio||l.updateTransformMatrix(!0);this.onAfterRenderObservable.notifyObservers(c);j&&b.Tools.DumpFramebuffer(this._size,this._size,n);this.isCube&&5!==c||(this.isCube&&5===c&&n.generateMipMapsForCubemap(this._texture),n.unBindFramebuffer(this._texture,this.isCube))},c.prototype.clone=function(){var b=this.getSize(),b=new c(this.name,b.width,this.getScene(),this._generateMipMaps);
return b.hasAlpha=this.hasAlpha,b.level=this.level,b.coordinatesMode=this.coordinatesMode,b.renderList=this.renderList.slice(0),b},c.prototype.serialize=function(){if(!this.name)return null;var b=e.prototype.serialize.call(this);b.renderTargetSize=this.getRenderSize();b.renderList=[];for(var c=0;c<this.renderList.length;c++)b.renderList.push(this.renderList[c].id);return b},c._REFRESHRATE_RENDER_ONCE=0,c._REFRESHRATE_RENDER_ONEVERYFRAME=1,c._REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,c);b.RenderTargetTexture=
f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.Texture,c=function(c,g,f,j,l,n,q){void 0===n&&(n=!0);void 0===q&&(q=!1);e.call(this,null,j,!n);this.isCube=q;this.isEnabled=!0;this._currentRefreshId=-1;this._refreshRate=1;this._vertexBuffers={};this._uniforms=[];this._samplers=[];this._textures=[];this._floats=[];this._floatsArrays={};this._colors3=[];this._colors4=[];this._vectors2=[];this._vectors3=[];this._matrices=[];this._fallbackTextureUsed=!1;j._proceduralTextures.push(this);this.name=c;this.isRenderTarget=!0;this._size=
g;this._generateMipMaps=n;this.setFragment(f);this._fallbackTexture=l;c=j.getEngine();q?(this._texture=c.createRenderTargetCubeTexture(g,{generateMipMaps:n}),this.setFloat("face",0)):this._texture=c.createRenderTargetTexture(g,n);g=[];g.push(1,1);g.push(-1,1);g.push(-1,-1);g.push(1,-1);this._vertexBuffers[b.VertexBuffer.PositionKind]=new b.VertexBuffer(c,g,b.VertexBuffer.PositionKind,!1,!1,2);g=[];g.push(0);g.push(1);g.push(2);g.push(0);g.push(2);g.push(3);this._indexBuffer=c.createIndexBuffer(g)};
f=(__extends(c,e),c.prototype.reset=function(){void 0!==this._effect&&this.getScene().getEngine()._releaseEffect(this._effect)},c.prototype.isReady=function(){var c,e=this,f=this.getScene().getEngine();return this._fragment?this._fallbackTextureUsed?!0:(c=void 0!==this._fragment.fragmentElement?{vertex:"procedural",fragmentElement:this._fragment.fragmentElement}:{vertex:"procedural",fragment:this._fragment},this._effect=f.createEffect(c,[b.VertexBuffer.PositionKind],this._uniforms,this._samplers,
"",null,null,function(){e.releaseInternalTexture();e._fallbackTexture&&(e._texture=e._fallbackTexture._texture,e._texture.references++);e._fallbackTextureUsed=!0}),this._effect.isReady()):!1},c.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},c.prototype.setFragment=function(b){this._fragment=b},Object.defineProperty(c.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(b){this._refreshRate=b;this.resetRefreshCounter()},enumerable:!0,configurable:!0}),
c.prototype._shouldRender=function(){return this.isEnabled&&this.isReady()&&this._texture?this._fallbackTextureUsed?!1:-1===this._currentRefreshId?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1):!1},c.prototype.getRenderSize=function(){return this._size},c.prototype.resize=function(b,c){this._fallbackTextureUsed||(this.releaseInternalTexture(),this._texture=this.getScene().getEngine().createRenderTargetTexture(b,c))},
c.prototype._checkUniform=function(b){-1===this._uniforms.indexOf(b)&&this._uniforms.push(b)},c.prototype.setTexture=function(b,c){return-1===this._samplers.indexOf(b)&&this._samplers.push(b),this._textures[b]=c,this},c.prototype.setFloat=function(b,c){return this._checkUniform(b),this._floats[b]=c,this},c.prototype.setFloats=function(b,c){return this._checkUniform(b),this._floatsArrays[b]=c,this},c.prototype.setColor3=function(b,c){return this._checkUniform(b),this._colors3[b]=c,this},c.prototype.setColor4=
function(b,c){return this._checkUniform(b),this._colors4[b]=c,this},c.prototype.setVector2=function(b,c){return this._checkUniform(b),this._vectors2[b]=c,this},c.prototype.setVector3=function(b,c){return this._checkUniform(b),this._vectors3[b]=c,this},c.prototype.setMatrix=function(b,c){return this._checkUniform(b),this._matrices[b]=c,this},c.prototype.render=function(){var b=this.getScene(),c=b.getEngine();c.enableEffect(this._effect);c.setState(!1);for(var e in this._textures)this._effect.setTexture(e,
this._textures[e]);for(e in this._floats)this._effect.setFloat(e,this._floats[e]);for(e in this._floatsArrays)this._effect.setArray(e,this._floatsArrays[e]);for(e in this._colors3)this._effect.setColor3(e,this._colors3[e]);for(e in this._colors4){var f=this._colors4[e];this._effect.setFloat4(e,f.r,f.g,f.b,f.a)}for(e in this._vectors2)this._effect.setVector2(e,this._vectors2[e]);for(e in this._vectors3)this._effect.setVector3(e,this._vectors3[e]);for(e in this._matrices)this._effect.setMatrix(e,this._matrices[e]);
if(c.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this.isCube)for(e=0;6>e;e++)c.bindFramebuffer(this._texture,e),this._effect.setFloat("face",e),c.clear(b.clearColor,!0,!0),c.draw(!0,0,6),5===e&&c.generateMipMapsForCubemap(this._texture);else c.bindFramebuffer(this._texture),c.clear(b.clearColor,!0,!0),c.draw(!0,0,6);c.unBindFramebuffer(this._texture,this.isCube);this.onGenerated&&this.onGenerated()},c.prototype.clone=function(){var b=this.getSize(),b=new c(this.name,b.width,this._fragment,
this.getScene(),this._fallbackTexture,this._generateMipMaps);return b.hasAlpha=this.hasAlpha,b.level=this.level,b.coordinatesMode=this.coordinatesMode,b},c.prototype.dispose=function(){var c=this.getScene()._proceduralTextures.indexOf(this);0<=c&&this.getScene()._proceduralTextures.splice(c,1);(c=this._vertexBuffers[b.VertexBuffer.PositionKind])&&(c.dispose(),this._vertexBuffers[b.VertexBuffer.PositionKind]=null);this._indexBuffer&&this.getScene().getEngine()._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=
null);e.prototype.dispose.call(this)},c);b.ProceduralTexture=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.RenderTargetTexture,c=function(c,g,f,j){var l=this;e.call(this,c,g,f,j,!0);this.mirrorPlane=new b.Plane(0,1,0,1);this._transformMatrix=b.Matrix.Zero();this._mirrorMatrix=b.Matrix.Zero();this.onBeforeRenderObservable.add(function(){b.Matrix.ReflectionToRef(l.mirrorPlane,l._mirrorMatrix);l._savedViewMatrix=f.getViewMatrix();l._mirrorMatrix.multiplyToRef(l._savedViewMatrix,l._transformMatrix);f.setTransformMatrix(l._transformMatrix,f.getProjectionMatrix());f.clipPlane=l.mirrorPlane;
f.getEngine().cullBackFaces=!1;f._mirroredCameraPosition=b.Vector3.TransformCoordinates(f.activeCamera.position,l._mirrorMatrix)});this.onAfterRenderObservable.add(function(){f.setTransformMatrix(l._savedViewMatrix,f.getProjectionMatrix());f.getEngine().cullBackFaces=!0;f._mirroredCameraPosition=null;delete f.clipPlane})};f=(__extends(c,e),c.prototype.clone=function(){var b=this.getSize(),b=new c(this.name,b.width,this.getScene(),this._generateMipMaps);return b.hasAlpha=this.hasAlpha,b.level=this.level,
b.mirrorPlane=this.mirrorPlane.clone(),b.renderList=this.renderList.slice(0),b},c.prototype.serialize=function(){if(!this.name)return null;var b=e.prototype.serialize.call(this);return b.mirrorPlane=this.mirrorPlane.asArray(),b},c);b.MirrorTexture=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.RenderTargetTexture,c=function(c,g,f,j){var l=this;e.call(this,c,g,f,j,!0);this.refractionPlane=new b.Plane(0,1,0,1);this.depth=2;this.onBeforeRenderObservable.add(function(){f.clipPlane=l.refractionPlane});this.onAfterRenderObservable.add(function(){delete f.clipPlane})};f=(__extends(c,e),c.prototype.clone=function(){var b=this.getSize(),b=new c(this.name,b.width,this.getScene(),this._generateMipMaps);return b.hasAlpha=this.hasAlpha,b.level=this.level,b.refractionPlane=this.refractionPlane.clone(),
b.renderList=this.renderList.slice(0),b.depth=this.depth,b},c.prototype.serialize=function(){if(!this.name)return null;var b=e.prototype.serialize.call(this);return b.mirrorPlane=this.refractionPlane.asArray(),b.depth=this.depth,b},c);b.RefractionTexture=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.Texture,c=function(c,g,f,j,l){void 0===l&&(l=b.Texture.TRILINEAR_SAMPLINGMODE);e.call(this,null,f,!j);this.name=c;this.wrapV=this.wrapU=b.Texture.CLAMP_ADDRESSMODE;this._generateMipMaps=j;g.getContext?(this._canvas=g,this._texture=f.getEngine().createDynamicTexture(g.width,g.height,j,l)):(this._canvas=document.createElement("canvas"),g.width?this._texture=f.getEngine().createDynamicTexture(g.width,g.height,j,l):this._texture=f.getEngine().createDynamicTexture(g,g,j,l));c=this.getSize();
this._canvas.width=c.width;this._canvas.height=c.height;this._context=this._canvas.getContext("2d")};f=(__extends(c,e),Object.defineProperty(c.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),c.prototype.scale=function(b){var c=this.getSize();c.width*=b;c.height*=b;this._canvas.width=c.width;this._canvas.height=c.height;this.releaseInternalTexture();this._texture=this.getScene().getEngine().createDynamicTexture(c.width,c.height,this._generateMipMaps,this._samplingMode)},
c.prototype.getContext=function(){return this._context},c.prototype.clear=function(){var b=this.getSize();this._context.fillRect(0,0,b.width,b.height)},c.prototype.update=function(b){this.getScene().getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===b?!0:b)},c.prototype.drawText=function(b,c,e,f,l,n,q,p){void 0===p&&(p=!0);var r=this.getSize();if(n&&(this._context.fillStyle=n,this._context.fillRect(0,0,r.width,r.height)),this._context.font=f,null===c)c=this._context.measureText(b),
c=(r.width-c.width)/2;this._context.fillStyle=l;this._context.fillText(b,c,e);p&&this.update(q)},c.prototype.clone=function(){var b=this.getSize(),b=new c(this.name,b,this.getScene(),this._generateMipMaps);return b.hasAlpha=this.hasAlpha,b.level=this.level,b.wrapU=this.wrapU,b.wrapV=this.wrapV,b},c);b.DynamicTexture=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.Texture;f=function(c,d,g,f,j,l){var n=this;void 0===f&&(f=!1);void 0===j&&(j=!1);void 0===l&&(l=b.Texture.TRILINEAR_SAMPLINGMODE);e.call(this,null,g,!f,j);this._autoLaunch=!0;var q;this.name=c;d instanceof HTMLVideoElement?this.video=d:(q=d,this.video=document.createElement("video"),this.video.autoplay=!1,this.video.loop=!0);this._generateMipMaps=f;this._samplingMode=l;b.Tools.IsExponentOfTwo(this.video.videoWidth)&&b.Tools.IsExponentOfTwo(this.video.videoHeight)?(this.wrapU=
b.Texture.WRAP_ADDRESSMODE,this.wrapV=b.Texture.WRAP_ADDRESSMODE):(this.wrapU=b.Texture.CLAMP_ADDRESSMODE,this.wrapV=b.Texture.CLAMP_ADDRESSMODE,this._generateMipMaps=!1);q?(this.video.addEventListener("canplaythrough",function(){n._createTexture()}),q.forEach(function(b){var c=document.createElement("source");c.src=b;n.video.appendChild(c)})):this._createTexture();this._lastUpdate=b.Tools.Now};f=(__extends(f,e),f.prototype._createTexture=function(){this._texture=this.getScene().getEngine().createDynamicTexture(this.video.videoWidth,
this.video.videoHeight,this._generateMipMaps,this._samplingMode);this._texture.isReady=!0},f.prototype.update=function(){this._autoLaunch&&(this._autoLaunch=!1,this.video.play());var c=b.Tools.Now;return 15>c-this._lastUpdate||this.video.readyState!==this.video.HAVE_ENOUGH_DATA?!1:(this._lastUpdate=c,this.getScene().getEngine().updateVideoTexture(this._texture,this.video,this._invertY),!0)},f);b.VideoTexture=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.ProceduralTexture;f=function(b,d,g,f,j,l){e.call(this,b,g,null,f,j,l);this._animate=!0;this._time=0;this._texturePath=d;this.loadJson(d);this.refreshRate=1};f=(__extends(f,e),f.prototype.loadJson=function(c){function d(){b.Tools.Log("No config file found in "+c+" trying to use ShadersStore or DOM element");try{f.setFragment(f._texturePath)}catch(d){b.Tools.Error("No json or ShaderStore or DOM element found for CustomProceduralTexture")}}var e=this,f=this,j=new XMLHttpRequest;
j.open("GET",c+"/config.json",!0);j.addEventListener("load",function(){if(200===j.status||b.Tools.ValidateXHRData(j,1))try{e._config=JSON.parse(j.response),e.updateShaderUniforms(),e.updateTextures(),e.setFragment(e._texturePath+"/custom"),e._animate=e._config.animate,e.refreshRate=e._config.refreshrate}catch(c){d()}else d()},!1);j.addEventListener("error",function(){d()},!1);try{j.send()}catch(l){b.Tools.Error("CustomProceduralTexture: Error on XHR send request.")}},f.prototype.isReady=function(){if(!e.prototype.isReady.call(this))return!1;
for(var b in this._textures)if(!this._textures[b].isReady())return!1;return!0},f.prototype.render=function(b){this._animate&&(this._time+=0.03*this.getScene().getAnimationRatio(),this.updateShaderUniforms());e.prototype.render.call(this,b)},f.prototype.updateTextures=function(){for(var c=0;c<this._config.sampler2Ds.length;c++)this.setTexture(this._config.sampler2Ds[c].sample2Dname,new b.Texture(this._texturePath+"/"+this._config.sampler2Ds[c].textureRelativeUrl,this.getScene()))},f.prototype.updateShaderUniforms=
function(){if(this._config)for(var c=0;c<this._config.uniforms.length;c++){var d=this._config.uniforms[c];switch(d.type){case "float":this.setFloat(d.name,d.value);break;case "color3":this.setColor3(d.name,new b.Color3(d.r,d.g,d.b));break;case "color4":this.setColor4(d.name,new b.Color4(d.r,d.g,d.b,d.a));break;case "vector2":this.setVector2(d.name,new b.Vector2(d.x,d.y));break;case "vector3":this.setVector3(d.name,new b.Vector3(d.x,d.y,d.z))}}this.setFloat("time",this._time)},Object.defineProperty(f.prototype,
"animate",{get:function(){return this._animate},set:function(b){this._animate=b},enumerable:!0,configurable:!0}),f);b.CustomProceduralTexture=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(){this._defines={};this._currentRank=32;this._maxRank=-1};f=(f.prototype.addFallback=function(b,d){this._defines[b]||(b<this._currentRank&&(this._currentRank=b),b>this._maxRank&&(this._maxRank=b),this._defines[b]=[]);this._defines[b].push(d)},f.prototype.addCPUSkinningFallback=function(b,d){this._meshRank=b;this._mesh=d;b>this._maxRank&&(this._maxRank=b)},Object.defineProperty(f.prototype,"isMoreFallbacks",{get:function(){return this._currentRank<=this._maxRank},enumerable:!0,
configurable:!0}),f.prototype.reduce=function(c){for(var d=this._defines[this._currentRank],e=0;e<d.length;e++)c=c.replace("#define "+d[e],"");return this._mesh&&this._currentRank===this._meshRank&&(this._mesh.computeBonesUsingShaders=!1,c=c.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),b.Tools.Log("Falling back to CPU skinning for "+this._mesh.name)),this._currentRank++,c},f);b.EffectFallbacks=f;var e=function(b,d,e,f,j,l,n,q,p,r){var t=this;
this._isReady=!1;this._compilationError="";this._valueCache=[];this._engine=j;this.name=b;this.defines=l;this._uniformsNames=e.concat(f);this._samplers=f;this._attributesNames=d;this.onError=p;this.onCompiled=q;this._indexParameters=r;var s,u;b.vertexElement?(s=document.getElementById(b.vertexElement),s||(s=b.vertexElement)):s=b.vertex||b;b.fragmentElement?(u=document.getElementById(b.fragmentElement),u||(u=b.fragmentElement)):u=b.fragment||b;this._loadVertexShader(s,function(b){t._processIncludes(b,
function(b){t._loadFragmentShader(u,function(c){t._processIncludes(c,function(c){t._prepareEffect(b,c,d,l,n)})})})})};f=(e.prototype.isReady=function(){return this._isReady},e.prototype.getProgram=function(){return this._program},e.prototype.getAttributesNames=function(){return this._attributesNames},e.prototype.getAttributeLocation=function(b){return this._attributes[b]},e.prototype.getAttributeLocationByName=function(b){b=this._attributesNames.indexOf(b);return this._attributes[b]},e.prototype.getAttributesCount=
function(){return this._attributes.length},e.prototype.getUniformIndex=function(b){return this._uniformsNames.indexOf(b)},e.prototype.getUniform=function(b){return this._uniforms[this._uniformsNames.indexOf(b)]},e.prototype.getSamplers=function(){return this._samplers},e.prototype.getCompilationError=function(){return this._compilationError},e.prototype._loadVertexShader=function(c,d){if(c instanceof HTMLElement){var g=b.Tools.GetDOMTextContent(c);return void d(g)}if(e.ShadersStore[c+"VertexShader"])return void d(e.ShadersStore[c+
"VertexShader"]);g="."===c[0]||"/"===c[0]||-1<c.indexOf("http")?c:b.Engine.ShadersRepository+c;b.Tools.LoadFile(g+".vertex.fx",d)},e.prototype._loadFragmentShader=function(c,d){if(c instanceof HTMLElement){var g=b.Tools.GetDOMTextContent(c);return void d(g)}if(e.ShadersStore[c+"PixelShader"])return void d(e.ShadersStore[c+"PixelShader"]);if(e.ShadersStore[c+"FragmentShader"])return void d(e.ShadersStore[c+"FragmentShader"]);g="."===c[0]||"/"===c[0]||-1<c.indexOf("http")?c:b.Engine.ShadersRepository+
c;b.Tools.LoadFile(g+".fragment.fx",d)},e.prototype._dumpShadersName=function(){this.name.vertexElement?(b.Tools.Error("Vertex shader:"+this.name.vertexElement),b.Tools.Error("Fragment shader:"+this.name.fragmentElement)):this.name.vertex?(b.Tools.Error("Vertex shader:"+this.name.vertex),b.Tools.Error("Fragment shader:"+this.name.fragment)):(b.Tools.Error("Vertex shader:"+this.name),b.Tools.Error("Fragment shader:"+this.name))},e.prototype._processIncludes=function(c,d){for(var g=this,f=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,
j=f.exec(c),l=new String(c);null!=j;){var n=j[1];if(!e.IncludesShadersStore[n])return void b.Tools.LoadFile(b.Engine.ShadersRepository+"ShadersInclude/"+n+".fx",function(b){e.IncludesShadersStore[n]=b;g._processIncludes(l,d)});var q=e.IncludesShadersStore[n];if(j[2])for(var p=j[3].split(","),r=0;r<p.length;r+=2)q=q.replace(RegExp(p[r],"g"),p[r+1]);if(j[4])if(p=j[5],-1!==p.indexOf("..")){var t=p.split(".."),s=parseInt(t[0]),p=parseInt(t[1]),r=q.slice(0),q="";isNaN(p)&&(p=this._indexParameters[t[1]]);
for(t=s;p>=t;t++)q+=r.replace(/\{X\}/g,t)+"\n"}else q=q.replace(/\{X\}/g,p);l=l.replace(j[0],q);j=f.exec(c)}d(l)},e.prototype._processPrecision=function(b){return-1===b.indexOf("precision highp float")?b=this._engine.getCaps().highPrecisionShaderSupported?"precision highp float;\n"+b:"precision mediump float;\n"+b:this._engine.getCaps().highPrecisionShaderSupported||(b=b.replace("precision highp float","precision mediump float")),b},e.prototype._prepareEffect=function(c,d,e,f,j){try{var l=this._engine;
c=this._processPrecision(c);d=this._processPrecision(d);this._program=l.createShaderProgram(c,d,f);this._uniforms=l.getUniforms(this._program,this._uniformsNames);this._attributes=l.getAttributes(this._program,e);for(var n=0;n<this._samplers.length;n++)null==this.getUniform(this._samplers[n])&&(this._samplers.splice(n,1),n--);l.bindSamplers(this);this._isReady=!0;this.onCompiled&&this.onCompiled(this)}catch(q){if(-1!==q.message.indexOf("highp"))return c=c.replace("precision highp float","precision mediump float"),
d=d.replace("precision highp float","precision mediump float"),void this._prepareEffect(c,d,e,f,j);j&&j.isMoreFallbacks?(b.Tools.Error("Unable to compile effect with current defines. Trying next fallback."),this._dumpShadersName(),f=j.reduce(f),this._prepareEffect(c,d,e,f,j)):(b.Tools.Error("Unable to compile effect: "),this._dumpShadersName(),b.Tools.Error("Defines: "+f),b.Tools.Error("Error: "+q.message),this._compilationError=q.message,this.onError&&this.onError(this,this._compilationError))}},
Object.defineProperty(e.prototype,"isSupported",{get:function(){return""===this._compilationError},enumerable:!0,configurable:!0}),e.prototype._bindTexture=function(b,d){this._engine._bindTexture(this._samplers.indexOf(b),d)},e.prototype.setTexture=function(b,d){this._engine.setTexture(this._samplers.indexOf(b),d)},e.prototype.setTextureFromPostProcess=function(b,d){this._engine.setTextureFromPostProcess(this._samplers.indexOf(b),d)},e.prototype._cacheMatrix=function(c,d){this._valueCache[c]||(this._valueCache[c]=
new b.Matrix);for(var e=0;16>e;e++)this._valueCache[c].m[e]=d.m[e]},e.prototype._cacheFloat2=function(b,d,e){return this._valueCache[b]?(this._valueCache[b][0]=d,void(this._valueCache[b][1]=e)):void(this._valueCache[b]=[d,e])},e.prototype._cacheFloat3=function(b,d,e,f){return this._valueCache[b]?(this._valueCache[b][0]=d,this._valueCache[b][1]=e,void(this._valueCache[b][2]=f)):void(this._valueCache[b]=[d,e,f])},e.prototype._cacheFloat4=function(b,d,e,f,j){return this._valueCache[b]?(this._valueCache[b][0]=
d,this._valueCache[b][1]=e,this._valueCache[b][2]=f,void(this._valueCache[b][3]=j)):void(this._valueCache[b]=[d,e,f,j])},e.prototype.setArray=function(b,d){return this._engine.setArray(this.getUniform(b),d),this},e.prototype.setArray2=function(b,d){return this._engine.setArray2(this.getUniform(b),d),this},e.prototype.setArray3=function(b,d){return this._engine.setArray3(this.getUniform(b),d),this},e.prototype.setArray4=function(b,d){return this._engine.setArray4(this.getUniform(b),d),this},e.prototype.setMatrices=
function(b,d){return this._engine.setMatrices(this.getUniform(b),d),this},e.prototype.setMatrix=function(b,d){return this._engine.setMatrix(this.getUniform(b),d),this},e.prototype.setMatrix3x3=function(b,d){return this._engine.setMatrix3x3(this.getUniform(b),d),this},e.prototype.setMatrix2x2=function(b,d){return this._engine.setMatrix2x2(this.getUniform(b),d),this},e.prototype.setFloat=function(b,d){return this._valueCache[b]&&this._valueCache[b]===d?this:(this._valueCache[b]=d,this._engine.setFloat(this.getUniform(b),
d),this)},e.prototype.setBool=function(b,d){return this._valueCache[b]&&this._valueCache[b]===d?this:(this._valueCache[b]=d,this._engine.setBool(this.getUniform(b),d?1:0),this)},e.prototype.setVector2=function(b,d){return this._valueCache[b]&&this._valueCache[b][0]===d.x&&this._valueCache[b][1]===d.y?this:(this._cacheFloat2(b,d.x,d.y),this._engine.setFloat2(this.getUniform(b),d.x,d.y),this)},e.prototype.setFloat2=function(b,d,e){return this._valueCache[b]&&this._valueCache[b][0]===d&&this._valueCache[b][1]===
e?this:(this._cacheFloat2(b,d,e),this._engine.setFloat2(this.getUniform(b),d,e),this)},e.prototype.setVector3=function(b,d){return this._valueCache[b]&&this._valueCache[b][0]===d.x&&this._valueCache[b][1]===d.y&&this._valueCache[b][2]===d.z?this:(this._cacheFloat3(b,d.x,d.y,d.z),this._engine.setFloat3(this.getUniform(b),d.x,d.y,d.z),this)},e.prototype.setFloat3=function(b,d,e,f){return this._valueCache[b]&&this._valueCache[b][0]===d&&this._valueCache[b][1]===e&&this._valueCache[b][2]===f?this:(this._cacheFloat3(b,
d,e,f),this._engine.setFloat3(this.getUniform(b),d,e,f),this)},e.prototype.setVector4=function(b,d){return this._valueCache[b]&&this._valueCache[b][0]===d.x&&this._valueCache[b][1]===d.y&&this._valueCache[b][2]===d.z&&this._valueCache[b][3]===d.w?this:(this._cacheFloat4(b,d.x,d.y,d.z,d.w),this._engine.setFloat4(this.getUniform(b),d.x,d.y,d.z,d.w),this)},e.prototype.setFloat4=function(b,d,e,f,j){return this._valueCache[b]&&this._valueCache[b][0]===d&&this._valueCache[b][1]===e&&this._valueCache[b][2]===
f&&this._valueCache[b][3]===j?this:(this._cacheFloat4(b,d,e,f,j),this._engine.setFloat4(this.getUniform(b),d,e,f,j),this)},e.prototype.setColor3=function(b,d){return this._valueCache[b]&&this._valueCache[b][0]===d.r&&this._valueCache[b][1]===d.g&&this._valueCache[b][2]===d.b?this:(this._cacheFloat3(b,d.r,d.g,d.b),this._engine.setColor3(this.getUniform(b),d),this)},e.prototype.setColor4=function(b,d,e){return this._valueCache[b]&&this._valueCache[b][0]===d.r&&this._valueCache[b][1]===d.g&&this._valueCache[b][2]===
d.b&&this._valueCache[b][3]===e?this:(this._cacheFloat4(b,d.r,d.g,d.b,e),this._engine.setColor4(this.getUniform(b),d,e),this)},e.ShadersStore={},e.IncludesShadersStore={},e);b.Effect=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(){};f=(e.PrepareDefinesForLights=function(c,d,e,f){void 0===f&&(f=4);for(var j=0,l=!1,n=!1,q=0;q<c.lights.length;q++){var p=c.lights[q];if(p.isEnabled()){if(0<p._excludedMeshesIds.length){for(var r=0;r<p._excludedMeshesIds.length;r++){var t=c.getMeshByID(p._excludedMeshesIds[r]);t&&p.excludedMeshes.push(t)}p._excludedMeshesIds=[]}if(0<p._includedOnlyMeshesIds.length){for(r=0;r<p._includedOnlyMeshesIds.length;r++)(t=c.getMeshByID(p._includedOnlyMeshesIds[r]))&&p.includedOnlyMeshes.push(t);
p._includedOnlyMeshesIds=[]}if(p.canAffectMesh(d)){l=!0;void 0===e["LIGHT"+j]&&(n=!0);e["LIGHT"+j]=!0;var s;if(s=p instanceof b.SpotLight?"SPOTLIGHT"+j:p instanceof b.HemisphericLight?"HEMILIGHT"+j:p instanceof b.PointLight?"POINTLIGHT"+j:"DIRLIGHT"+j,void 0===e[s]&&(n=!0),e[s]=!0,p.specular.equalsFloats(0,0,0)||void 0===e.SPECULARTERM||(e.SPECULARTERM=!0),c.shadowsEnabled)p=p.getShadowGenerator(),d&&d.receiveShadows&&p&&(void 0===e["SHADOW"+j]&&(n=!0),e["SHADOW"+j]=!0,e.SHADOWS=!0,(p.useVarianceShadowMap||
p.useBlurVarianceShadowMap)&&(void 0===e["SHADOWVSM"+j]&&(n=!0),e["SHADOWVSM"+j]=!0),p.usePoissonSampling&&(void 0===e["SHADOWPCF"+j]&&(n=!0),e["SHADOWPCF"+j]=!0));if(j++,j===f)break}}}return n&&e.rebuild(),l},e.PrepareUniformsAndSamplersList=function(b,d,e,f){void 0===f&&(f=4);for(var j=0;f>j&&e["LIGHT"+j];j++)b.push("vLightData"+j,"vLightDiffuse"+j,"vLightSpecular"+j,"vLightDirection"+j,"vLightGround"+j,"lightMatrix"+j,"shadowsInfo"+j),d.push("shadowSampler"+j)},e.HandleFallbacksForShadows=function(b,
d,e){void 0===e&&(e=4);for(var f=0;e>f&&b["LIGHT"+f];f++)0<f&&d.addFallback(f,"LIGHT"+f),b["SHADOW"+f]&&d.addFallback(0,"SHADOW"+f),b["SHADOWPCF"+f]&&d.addFallback(0,"SHADOWPCF"+f),b["SHADOWVSM"+f]&&d.addFallback(0,"SHADOWVSM"+f)},e.PrepareAttributesForBones=function(c,d,e,f){0<e.NUM_BONE_INFLUENCERS&&(f.addCPUSkinningFallback(0,d),c.push(b.VertexBuffer.MatricesIndicesKind),c.push(b.VertexBuffer.MatricesWeightsKind),4<e.NUM_BONE_INFLUENCERS&&(c.push(b.VertexBuffer.MatricesIndicesExtraKind),c.push(b.VertexBuffer.MatricesWeightsExtraKind)))},
e.PrepareAttributesForInstances=function(b,d){d.INSTANCES&&(b.push("world0"),b.push("world1"),b.push("world2"),b.push("world3"))},e.BindLightShadow=function(b,d,e,f,j,l){var n=b.getShadowGenerator();return e.receiveShadows&&n&&(b.needCube()?l||(l=!0,j.setFloat2("depthValues",d.activeCamera.minZ,d.activeCamera.maxZ)):j.setMatrix("lightMatrix"+f,n.getTransformMatrix()),j.setTexture("shadowSampler"+f,n.getShadowMapForRendering()),j.setFloat3("shadowsInfo"+f,n.getDarkness(),n.blurScale/n.getShadowMap().getSize().width,
n.bias)),l},e.BindLightProperties=function(c,d,e){c instanceof b.PointLight?c.transferToEffect(d,"vLightData"+e):c instanceof b.DirectionalLight?c.transferToEffect(d,"vLightData"+e):c instanceof b.SpotLight?c.transferToEffect(d,"vLightData"+e,"vLightDirection"+e):c instanceof b.HemisphericLight&&c.transferToEffect(d,"vLightData"+e,"vLightGround"+e)},e.BindLights=function(c,d,g,f,j){void 0===j&&(j=4);for(var l=0,n=!1,q=0;q<c.lights.length;q++){var p=c.lights[q];if(p.isEnabled()&&p.canAffectMesh(d)&&
(e.BindLightProperties(p,g,l),p.diffuse.scaleToRef(p.intensity,b.Tmp.Color3[0]),g.setColor4("vLightDiffuse"+l,b.Tmp.Color3[0],p.range),f.SPECULARTERM&&(p.specular.scaleToRef(p.intensity,b.Tmp.Color3[1]),g.setColor3("vLightSpecular"+l,b.Tmp.Color3[1])),c.shadowsEnabled&&(n=this.BindLightShadow(p,c,d,l,g,n)),l++,l===j))break}},e.BindFogParameters=function(c,d,e){c.fogEnabled&&d.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&(e.setFloat4("vFogInfos",c.fogMode,c.fogStart,c.fogEnd,c.fogDensity),e.setColor3("vFogColor",
c.fogColor))},e.BindBonesParameters=function(b,d){b&&b.useBones&&b.computeBonesUsingShaders&&d.setMatrices("mBones",b.skeleton.getTransformMatrices(b))},e.BindLogDepth=function(b,d,e){b.LOGARITHMICDEPTH&&d.setFloat("logarithmicDepthConstant",2/(Math.log(e.activeCamera.maxZ+1)/Math.LN2))},e.BindClipPlane=function(b,d){if(d.clipPlane){var e=d.clipPlane;b.setFloat4("vClipPlane",e.normal.x,e.normal.y,e.normal.z,e.d)}},e);b.MaterialHelper=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(){this.isEnabled=!0;this.leftColor=b.Color3.White();this.rightColor=b.Color3.Black();this.bias=0;this.power=1};f=(e.prototype.clone=function(){var c=new e;return b.Tools.DeepCopy(this,c),new e},e.prototype.serialize=function(){var b={};return b.isEnabled=this.isEnabled,b.leftColor=this.leftColor,b.rightColor=this.rightColor,b.bias=this.bias,b.power=this.power,b},e.Parse=function(c){var d=new e;return d.isEnabled=c.isEnabled,d.leftColor=b.Color3.FromArray(c.leftColor),
d.rightColor=b.Color3.FromArray(c.rightColor),d.bias=c.bias,d.power=c.power||1,d},e);b.FresnelParameters=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(){};f=(f.prototype.rebuild=function(){this._keys&&delete this._keys;this._keys=Object.keys(this)},f.prototype.isEqual=function(b){if(this._keys.length!==b._keys.length)return!1;for(var d=0;d<this._keys.length;d++){var e=this._keys[d];if(this[e]!==b[e])return!1}return!0},f.prototype.cloneTo=function(b){this._keys.length!==b._keys.length&&(b._keys=this._keys.slice(0));for(var d=0;d<this._keys.length;d++){var e=this._keys[d];b[e]=this[e]}},f.prototype.reset=function(){for(var b=
0;b<this._keys.length;b++){var d=this._keys[b];"number"==typeof this[d]?this[d]=0:this[d]=!1}},f.prototype.toString=function(){for(var b="",d=0;d<this._keys.length;d++){var e=this._keys[d];"number"==typeof this[e]?b+="#define "+e+" "+this[e]+"\n":this[e]&&(b+="#define "+e+"\n")}return b},f);b.MaterialDefines=f;var e=function(c,d,g){this.name=c;this.checkReadyOnlyOnce=this.checkReadyOnEveryCall=!1;this.state="";this.alpha=1;this.backFaceCulling=!0;this.sideOrientation=e.CounterClockWiseSideOrientation;
this.onDisposeObservable=new b.Observable;this.onBindObservable=new b.Observable;this.alphaMode=b.Engine.ALPHA_COMBINE;this.disableDepthWrite=!1;this.fogEnabled=!0;this.pointSize=1;this.zOffset=0;this._wasPreviouslyReady=!1;this._fillMode=e.TriangleFillMode;this.id=c;this._scene=d;g||d.materials.push(this)};f=(Object.defineProperty(e,"TriangleFillMode",{get:function(){return e._TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(e,"WireFrameFillMode",{get:function(){return e._WireFrameFillMode},
enumerable:!0,configurable:!0}),Object.defineProperty(e,"PointFillMode",{get:function(){return e._PointFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ClockWiseSideOrientation",{get:function(){return e._ClockWiseSideOrientation},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CounterClockWiseSideOrientation",{get:function(){return e._CounterClockWiseSideOrientation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onDispose",{set:function(b){this._onDisposeObserver&&
this.onDisposeObservable.remove(this._onDisposeObserver);this._onDisposeObserver=this.onDisposeObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onBind",{set:function(b){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver);this._onBindObserver=this.onBindObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wireframe",{get:function(){return this._fillMode===e.WireFrameFillMode},set:function(b){this._fillMode=b?
e.WireFrameFillMode:e.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointsCloud",{get:function(){return this._fillMode===e.PointFillMode},set:function(b){this._fillMode=b?e.PointFillMode:e.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fillMode",{get:function(){return this._fillMode},set:function(b){this._fillMode=b},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return"Name: "+this.name},Object.defineProperty(e.prototype,
"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!0,configurable:!0}),e.prototype.freeze=function(){this.checkReadyOnlyOnce=!0},e.prototype.unfreeze=function(){this.checkReadyOnlyOnce=!1},e.prototype.isReady=function(){return!0},e.prototype.getEffect=function(){return this._effect},e.prototype.getScene=function(){return this._scene},e.prototype.needAlphaBlending=function(){return 1>this.alpha},e.prototype.needAlphaTesting=function(){return!1},e.prototype.getAlphaTestTexture=function(){return null},
e.prototype.markDirty=function(){this._wasPreviouslyReady=!1},e.prototype._preBind=function(){var b=this._scene.getEngine();b.enableEffect(this._effect);b.setState(this.backFaceCulling,this.zOffset,!1,this.sideOrientation===e.ClockWiseSideOrientation)},e.prototype.bind=function(b,d){if(this._scene._cachedMaterial=this,this.onBindObservable.notifyObservers(d),this.disableDepthWrite){var e=this._scene.getEngine();this._cachedDepthWriteState=e.getDepthWrite();e.setDepthWrite(!1)}},e.prototype.bindOnlyWorldMatrix=
function(){},e.prototype.unbind=function(){this.disableDepthWrite&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)},e.prototype.clone=function(){return null},e.prototype.getBindedMeshes=function(){for(var b=[],d=0;d<this._scene.meshes.length;d++){var e=this._scene.meshes[d];e.material===this&&b.push(e)}return b},e.prototype.dispose=function(b){this.getScene().stopAnimation(this);var d=this._scene.materials.indexOf(this);0<=d&&this._scene.materials.splice(d,1);b&&this._effect&&(this._scene.getEngine()._releaseEffect(this._effect),
this._effect=null);for(d=0;d<this._scene.meshes.length;d++)b=this._scene.meshes[d],b.material===this&&(b.material=null);this.onDisposeObservable.notifyObservers(this);this.onDisposeObservable.clear();this.onBindObservable.clear()},e.prototype.serialize=function(){return b.SerializationHelper.Serialize(this)},e.ParseMultiMaterial=function(c,d){var e=new b.MultiMaterial(c.name,d);e.id=c.id;b.Tags.AddTagsTo(e,c.tags);for(var f=0;f<c.materials.length;f++){var j=c.materials[f];j?e.subMaterials.push(d.getMaterialByID(j)):
e.subMaterials.push(null)}return e},e.Parse=function(c,d,e){return!c.customType?b.StandardMaterial.Parse(c,d,e):b.Tools.Instantiate(c.customType).Parse(c,d,e)},e._TriangleFillMode=0,e._WireFrameFillMode=1,e._PointFillMode=2,e._ClockWiseSideOrientation=0,e._CounterClockWiseSideOrientation=1,__decorate([b.serialize()],e.prototype,"id",void 0),__decorate([b.serialize()],e.prototype,"checkReadyOnEveryCall",void 0),__decorate([b.serialize()],e.prototype,"checkReadyOnlyOnce",void 0),__decorate([b.serialize()],
e.prototype,"state",void 0),__decorate([b.serialize()],e.prototype,"alpha",void 0),__decorate([b.serialize()],e.prototype,"backFaceCulling",void 0),__decorate([b.serialize()],e.prototype,"sideOrientation",void 0),__decorate([b.serialize()],e.prototype,"alphaMode",void 0),__decorate([b.serialize()],e.prototype,"disableDepthWrite",void 0),__decorate([b.serialize()],e.prototype,"fogEnabled",void 0),__decorate([b.serialize()],e.prototype,"pointSize",void 0),__decorate([b.serialize()],e.prototype,"zOffset",
void 0),__decorate([b.serialize()],e.prototype,"wireframe",null),__decorate([b.serialize()],e.prototype,"pointsCloud",null),__decorate([b.serialize()],e.prototype,"fillMode",null),e);b.Material=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.MaterialDefines,c=function(){e.call(this);this.VERTEXALPHA=this.VERTEXCOLOR=this.UV2=this.UV1=this.NORMAL=this.FRESNEL=this.EMISSIVEFRESNEL=this.REFRACTIONFRESNEL=this.REFLECTIONFRESNEL=this.OPACITYFRESNEL=this.DIFFUSEFRESNEL=this.SPECULARTERM=this.FOG=this.POINTSIZE=this.ALPHAFROMDIFFUSE=this.ALPHATEST=this.CLIPPLANE=this.SPECULAROVERALPHA=this.PARALLAXOCCLUSION=this.PARALLAX=this.BUMP=this.SPECULAR=this.EMISSIVE=this.REFLECTION=this.OPACITYRGB=this.OPACITY=this.AMBIENT=this.DIFFUSE=
!1;this.BonesPerMesh=this.NUM_BONE_INFLUENCERS=0;this.INVERTNORMALMAPY=this.INVERTNORMALMAPX=this.REFLECTIONOVERALPHA=this.REFRACTIONMAP_3D=this.REFRACTION=this.LOGARITHMICDEPTH=this.INVERTCUBICMAP=this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=this.REFLECTIONMAP_EQUIRECTANGULAR=this.REFLECTIONMAP_EXPLICIT=this.REFLECTIONMAP_SKYBOX=this.REFLECTIONMAP_PROJECTION=this.REFLECTIONMAP_CUBIC=this.REFLECTIONMAP_PLANAR=this.REFLECTIONMAP_SPHERICAL=this.REFLECTIONMAP_3D=this.USELIGHTMAPASSHADOWMAP=this.LIGHTMAP=
this.REFLECTIONFRESNELFROMSPECULAR=this.LINKEMISSIVEWITHDIFFUSE=this.EMISSIVEASILLUMINATION=this.ROUGHNESS=this.GLOSSINESS=this.INSTANCES=!1;this.rebuild()};f=(__extends(c,e),c);var d=b.Material,g=function(c,e){var g=this;d.call(this,c,e);this.ambientColor=new b.Color3(0,0,0);this.diffuseColor=new b.Color3(1,1,1);this.specularColor=new b.Color3(1,1,1);this.emissiveColor=new b.Color3(0,0,0);this.specularPower=64;this.useParallaxOcclusion=this.useParallax=this.disableLighting=this.useReflectionOverAlpha=
this.useSpecularOverAlpha=this.useReflectionFresnelFromSpecular=this.linkEmissiveWithDiffuse=this.useEmissiveAsIllumination=this.useAlphaFromDiffuseTexture=!1;this.parallaxScaleBias=0.05;this.roughness=0;this.indexOfRefraction=0.98;this.invertRefractionY=!0;this.useGlossinessFromSpecularMapAlpha=this.useLightmapAsShadowmap=!1;this.maxSimultaneousLights=4;this.invertNormalMapY=this.invertNormalMapX=!1;this._renderTargets=new b.SmartArray(16);this._worldViewProjectionMatrix=b.Matrix.Zero();this._globalAmbientColor=
new b.Color3(0,0,0);this._defines=new f;this._cachedDefines=new f;this._cachedDefines.BonesPerMesh=-1;this.getRenderTargetTextures=function(){return g._renderTargets.reset(),g.reflectionTexture&&g.reflectionTexture.isRenderTarget&&g._renderTargets.push(g.reflectionTexture),g.refractionTexture&&g.refractionTexture.isRenderTarget&&g._renderTargets.push(g.refractionTexture),g._renderTargets}},c=(__extends(g,d),Object.defineProperty(g.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},
set:function(b){this._useLogarithmicDepth=b&&this.getScene().getEngine().getCaps().fragmentDepthSupported},enumerable:!0,configurable:!0}),g.prototype.needAlphaBlending=function(){return 1>this.alpha||null!=this.opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled},g.prototype.needAlphaTesting=function(){return null!=this.diffuseTexture&&this.diffuseTexture.hasAlpha},g.prototype._shouldUseAlphaFromDiffuseTexture=function(){return null!=
this.diffuseTexture&&this.diffuseTexture.hasAlpha&&this.useAlphaFromDiffuseTexture},g.prototype.getAlphaTestTexture=function(){return this.diffuseTexture},g.prototype._checkCache=function(b,c,d){return c?this._defines.INSTANCES!==d?!1:!(!c._materialDefines||!c._materialDefines.isEqual(this._defines)):!0},g.prototype.isReady=function(c,d){if(this.isFrozen&&this._wasPreviouslyReady)return!0;var e=this.getScene();if(!this.checkReadyOnEveryCall&&this._renderId===e.getRenderId()&&this._checkCache(e,c,
d))return!0;var n=e.getEngine(),q=!1,p=!1;if(this._defines.reset(),e.texturesEnabled){if(this.diffuseTexture&&g.DiffuseTextureEnabled){if(!this.diffuseTexture.isReady())return!1;p=!0;this._defines.DIFFUSE=!0}if(this.ambientTexture&&g.AmbientTextureEnabled){if(!this.ambientTexture.isReady())return!1;p=!0;this._defines.AMBIENT=!0}if(this.opacityTexture&&g.OpacityTextureEnabled){if(!this.opacityTexture.isReady())return!1;p=!0;this._defines.OPACITY=!0;this.opacityTexture.getAlphaFromRGB&&(this._defines.OPACITYRGB=
!0)}if(this.reflectionTexture&&g.ReflectionTextureEnabled){if(!this.reflectionTexture.isReady())return!1;switch(q=!0,this._defines.REFLECTION=!0,0<this.roughness&&(this._defines.ROUGHNESS=!0),this.useReflectionOverAlpha&&(this._defines.REFLECTIONOVERALPHA=!0),this.reflectionTexture.coordinatesMode===b.Texture.INVCUBIC_MODE&&(this._defines.INVERTCUBICMAP=!0),this._defines.REFLECTIONMAP_3D=this.reflectionTexture.isCube,this.reflectionTexture.coordinatesMode){case b.Texture.CUBIC_MODE:case b.Texture.INVCUBIC_MODE:this._defines.REFLECTIONMAP_CUBIC=
!0;break;case b.Texture.EXPLICIT_MODE:this._defines.REFLECTIONMAP_EXPLICIT=!0;break;case b.Texture.PLANAR_MODE:this._defines.REFLECTIONMAP_PLANAR=!0;break;case b.Texture.PROJECTION_MODE:this._defines.REFLECTIONMAP_PROJECTION=!0;break;case b.Texture.SKYBOX_MODE:this._defines.REFLECTIONMAP_SKYBOX=!0;break;case b.Texture.SPHERICAL_MODE:this._defines.REFLECTIONMAP_SPHERICAL=!0;break;case b.Texture.EQUIRECTANGULAR_MODE:this._defines.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case b.Texture.FIXED_EQUIRECTANGULAR_MODE:this._defines.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=
!0}}if(this.emissiveTexture&&g.EmissiveTextureEnabled){if(!this.emissiveTexture.isReady())return!1;p=!0;this._defines.EMISSIVE=!0}if(this.lightmapTexture&&g.LightmapTextureEnabled){if(!this.lightmapTexture.isReady())return!1;p=!0;this._defines.LIGHTMAP=!0;this._defines.USELIGHTMAPASSHADOWMAP=this.useLightmapAsShadowmap}if(this.specularTexture&&g.SpecularTextureEnabled){if(!this.specularTexture.isReady())return!1;p=!0;this._defines.SPECULAR=!0;this._defines.GLOSSINESS=this.useGlossinessFromSpecularMapAlpha}if(e.getEngine().getCaps().standardDerivatives&&
this.bumpTexture&&g.BumpTextureEnabled){if(!this.bumpTexture.isReady())return!1;p=!0;this._defines.BUMP=!0;this.useParallax&&(this._defines.PARALLAX=!0,this.useParallaxOcclusion&&(this._defines.PARALLAXOCCLUSION=!0));this.invertNormalMapX&&(this._defines.INVERTNORMALMAPX=!0);this.invertNormalMapY&&(this._defines.INVERTNORMALMAPY=!0)}if(this.refractionTexture&&g.RefractionTextureEnabled){if(!this.refractionTexture.isReady())return!1;p=!0;this._defines.REFRACTION=!0;this._defines.REFRACTIONMAP_3D=this.refractionTexture.isCube}}if(e.clipPlane&&
(this._defines.CLIPPLANE=!0),n.getAlphaTesting()&&(this._defines.ALPHATEST=!0),this._shouldUseAlphaFromDiffuseTexture()&&(this._defines.ALPHAFROMDIFFUSE=!0),this.useEmissiveAsIllumination&&(this._defines.EMISSIVEASILLUMINATION=!0),this.linkEmissiveWithDiffuse&&(this._defines.LINKEMISSIVEWITHDIFFUSE=!0),this.useLogarithmicDepth&&(this._defines.LOGARITHMICDEPTH=!0),(this.pointsCloud||e.forcePointsCloud)&&(this._defines.POINTSIZE=!0),e.fogEnabled&&c&&c.applyFog&&e.fogMode!==b.Scene.FOGMODE_NONE&&this.fogEnabled&&
(this._defines.FOG=!0),e.lightsEnabled&&!this.disableLighting&&(q=b.MaterialHelper.PrepareDefinesForLights(e,c,this._defines,this.maxSimultaneousLights)),g.FresnelEnabled&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled||this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled||this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled||this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled||this.reflectionFresnelParameters&&
this.reflectionFresnelParameters.isEnabled)&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(this._defines.DIFFUSEFRESNEL=!0),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&(this._defines.OPACITYFRESNEL=!0),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(this._defines.REFLECTIONFRESNEL=!0,this.useReflectionFresnelFromSpecular&&(this._defines.REFLECTIONFRESNELFROMSPECULAR=!0)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&
(this._defines.REFRACTIONFRESNEL=!0),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._defines.EMISSIVEFRESNEL=!0),q=!0,this._defines.FRESNEL=!0),this._defines.SPECULARTERM&&this.useSpecularOverAlpha&&(this._defines.SPECULAROVERALPHA=!0),c&&(q&&c.isVerticesDataPresent(b.VertexBuffer.NormalKind)&&(this._defines.NORMAL=!0),p&&(c.isVerticesDataPresent(b.VertexBuffer.UVKind)&&(this._defines.UV1=!0),c.isVerticesDataPresent(b.VertexBuffer.UV2Kind)&&(this._defines.UV2=!0)),
c.useVertexColors&&c.isVerticesDataPresent(b.VertexBuffer.ColorKind)&&(this._defines.VERTEXCOLOR=!0,c.hasVertexAlpha&&(this._defines.VERTEXALPHA=!0)),c.useBones&&c.computeBonesUsingShaders&&(this._defines.NUM_BONE_INFLUENCERS=c.numBoneInfluencers,this._defines.BonesPerMesh=c.skeleton.bones.length+1),d&&(this._defines.INSTANCES=!0)),!this._defines.isEqual(this._cachedDefines)){this._defines.cloneTo(this._cachedDefines);e.resetCachedMaterial();n=new b.EffectFallbacks;this._defines.REFLECTION&&n.addFallback(0,
"REFLECTION");this._defines.SPECULAR&&n.addFallback(0,"SPECULAR");this._defines.BUMP&&n.addFallback(0,"BUMP");this._defines.PARALLAX&&n.addFallback(1,"PARALLAX");this._defines.PARALLAXOCCLUSION&&n.addFallback(0,"PARALLAXOCCLUSION");this._defines.SPECULAROVERALPHA&&n.addFallback(0,"SPECULAROVERALPHA");this._defines.FOG&&n.addFallback(1,"FOG");this._defines.POINTSIZE&&n.addFallback(0,"POINTSIZE");this._defines.LOGARITHMICDEPTH&&n.addFallback(0,"LOGARITHMICDEPTH");b.MaterialHelper.HandleFallbacksForShadows(this._defines,
n,this.maxSimultaneousLights);this._defines.SPECULARTERM&&n.addFallback(0,"SPECULARTERM");this._defines.DIFFUSEFRESNEL&&n.addFallback(1,"DIFFUSEFRESNEL");this._defines.OPACITYFRESNEL&&n.addFallback(2,"OPACITYFRESNEL");this._defines.REFLECTIONFRESNEL&&n.addFallback(3,"REFLECTIONFRESNEL");this._defines.EMISSIVEFRESNEL&&n.addFallback(4,"EMISSIVEFRESNEL");this._defines.FRESNEL&&n.addFallback(4,"FRESNEL");q=[b.VertexBuffer.PositionKind];this._defines.NORMAL&&q.push(b.VertexBuffer.NormalKind);this._defines.UV1&&
q.push(b.VertexBuffer.UVKind);this._defines.UV2&&q.push(b.VertexBuffer.UV2Kind);this._defines.VERTEXCOLOR&&q.push(b.VertexBuffer.ColorKind);b.MaterialHelper.PrepareAttributesForBones(q,c,this._defines,n);b.MaterialHelper.PrepareAttributesForInstances(q,this._defines);p="default";e.getEngine().getCaps().standardDerivatives||(p="legacydefault");var r=this._defines.toString(),t="world view viewProjection vEyePosition vLightsType vAmbientColor vDiffuseColor vSpecularColor vEmissiveColor vFogInfos vFogColor pointSize vDiffuseInfos vAmbientInfos vOpacityInfos vReflectionInfos vEmissiveInfos vSpecularInfos vBumpInfos vLightmapInfos vRefractionInfos mBones vClipPlane diffuseMatrix ambientMatrix opacityMatrix reflectionMatrix emissiveMatrix specularMatrix bumpMatrix lightmapMatrix refractionMatrix depthValues diffuseLeftColor diffuseRightColor opacityParts reflectionLeftColor reflectionRightColor emissiveLeftColor emissiveRightColor refractionLeftColor refractionRightColor logarithmicDepthConstant".split(" "),
s="diffuseSampler ambientSampler opacitySampler reflectionCubeSampler reflection2DSampler emissiveSampler specularSampler bumpSampler lightmapSampler refractionCubeSampler refraction2DSampler".split(" ");b.MaterialHelper.PrepareUniformsAndSamplersList(t,s,this._defines,this.maxSimultaneousLights);this._effect=e.getEngine().createEffect(p,q,t,s,r,n,this.onCompiled,this.onError,{maxSimultaneousLights:this.maxSimultaneousLights-1})}return this._effect.isReady()?(this._renderId=e.getRenderId(),this._wasPreviouslyReady=
!0,c&&(c._materialDefines||(c._materialDefines=new f),this._defines.cloneTo(c._materialDefines)),!0):!1},g.prototype.unbind=function(){this.reflectionTexture&&this.reflectionTexture.isRenderTarget&&this._effect.setTexture("reflection2DSampler",null);this.refractionTexture&&this.refractionTexture.isRenderTarget&&this._effect.setTexture("refraction2DSampler",null);d.prototype.unbind.call(this)},g.prototype.bindOnlyWorldMatrix=function(b){this._effect.setMatrix("world",b)},g.prototype.bind=function(c,
e){var f=this.getScene();if(this.bindOnlyWorldMatrix(c),b.MaterialHelper.BindBonesParameters(e,this._effect),f.getCachedMaterial()!==this){if(this._effect.setMatrix("viewProjection",f.getTransformMatrix()),g.FresnelEnabled&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(this._effect.setColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),this._effect.setColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,
this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&this._effect.setColor4("opacityParts",new b.Color3(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(this._effect.setColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,
this.reflectionFresnelParameters.power),this._effect.setColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(this._effect.setColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),this._effect.setColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),
this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._effect.setColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),this._effect.setColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),f.texturesEnabled&&(this.diffuseTexture&&g.DiffuseTextureEnabled&&(this._effect.setTexture("diffuseSampler",this.diffuseTexture),this._effect.setFloat2("vDiffuseInfos",this.diffuseTexture.coordinatesIndex,
this.diffuseTexture.level),this._effect.setMatrix("diffuseMatrix",this.diffuseTexture.getTextureMatrix())),this.ambientTexture&&g.AmbientTextureEnabled&&(this._effect.setTexture("ambientSampler",this.ambientTexture),this._effect.setFloat2("vAmbientInfos",this.ambientTexture.coordinatesIndex,this.ambientTexture.level),this._effect.setMatrix("ambientMatrix",this.ambientTexture.getTextureMatrix())),this.opacityTexture&&g.OpacityTextureEnabled&&(this._effect.setTexture("opacitySampler",this.opacityTexture),
this._effect.setFloat2("vOpacityInfos",this.opacityTexture.coordinatesIndex,this.opacityTexture.level),this._effect.setMatrix("opacityMatrix",this.opacityTexture.getTextureMatrix())),this.reflectionTexture&&g.ReflectionTextureEnabled&&(this.reflectionTexture.isCube?this._effect.setTexture("reflectionCubeSampler",this.reflectionTexture):this._effect.setTexture("reflection2DSampler",this.reflectionTexture),this._effect.setMatrix("reflectionMatrix",this.reflectionTexture.getReflectionTextureMatrix()),
this._effect.setFloat2("vReflectionInfos",this.reflectionTexture.level,this.roughness)),this.emissiveTexture&&g.EmissiveTextureEnabled&&(this._effect.setTexture("emissiveSampler",this.emissiveTexture),this._effect.setFloat2("vEmissiveInfos",this.emissiveTexture.coordinatesIndex,this.emissiveTexture.level),this._effect.setMatrix("emissiveMatrix",this.emissiveTexture.getTextureMatrix())),this.lightmapTexture&&g.LightmapTextureEnabled&&(this._effect.setTexture("lightmapSampler",this.lightmapTexture),
this._effect.setFloat2("vLightmapInfos",this.lightmapTexture.coordinatesIndex,this.lightmapTexture.level),this._effect.setMatrix("lightmapMatrix",this.lightmapTexture.getTextureMatrix())),this.specularTexture&&g.SpecularTextureEnabled&&(this._effect.setTexture("specularSampler",this.specularTexture),this._effect.setFloat2("vSpecularInfos",this.specularTexture.coordinatesIndex,this.specularTexture.level),this._effect.setMatrix("specularMatrix",this.specularTexture.getTextureMatrix())),this.bumpTexture&&
f.getEngine().getCaps().standardDerivatives&&g.BumpTextureEnabled&&(this._effect.setTexture("bumpSampler",this.bumpTexture),this._effect.setFloat3("vBumpInfos",this.bumpTexture.coordinatesIndex,1/this.bumpTexture.level,this.parallaxScaleBias),this._effect.setMatrix("bumpMatrix",this.bumpTexture.getTextureMatrix())),this.refractionTexture&&g.RefractionTextureEnabled)){var n=1;this.refractionTexture.isCube?this._effect.setTexture("refractionCubeSampler",this.refractionTexture):(this._effect.setTexture("refraction2DSampler",
this.refractionTexture),this._effect.setMatrix("refractionMatrix",this.refractionTexture.getReflectionTextureMatrix()),this.refractionTexture.depth&&(n=this.refractionTexture.depth));this._effect.setFloat4("vRefractionInfos",this.refractionTexture.level,this.indexOfRefraction,n,this.invertRefractionY?-1:1)}b.MaterialHelper.BindClipPlane(this._effect,f);this.pointsCloud&&this._effect.setFloat("pointSize",this.pointSize);f.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor);this._effect.setVector3("vEyePosition",
f._mirroredCameraPosition?f._mirroredCameraPosition:f.activeCamera.position);this._effect.setColor3("vAmbientColor",this._globalAmbientColor);this._defines.SPECULARTERM&&this._effect.setColor4("vSpecularColor",this.specularColor,this.specularPower);this._effect.setColor3("vEmissiveColor",this.emissiveColor)}f.getCachedMaterial()===this&&this.isFrozen||(this._effect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*e.visibility),f.lightsEnabled&&!this.disableLighting&&b.MaterialHelper.BindLights(f,
e,this._effect,this._defines,this.maxSimultaneousLights),(f.fogEnabled&&e.applyFog&&f.fogMode!==b.Scene.FOGMODE_NONE||this.reflectionTexture||this.refractionTexture)&&this._effect.setMatrix("view",f.getViewMatrix()),b.MaterialHelper.BindFogParameters(f,e,this._effect),b.MaterialHelper.BindLogDepth(this._defines,this._effect,f));d.prototype.bind.call(this,c,e)},g.prototype.getAnimatables=function(){var b=[];return this.diffuseTexture&&this.diffuseTexture.animations&&0<this.diffuseTexture.animations.length&&
b.push(this.diffuseTexture),this.ambientTexture&&this.ambientTexture.animations&&0<this.ambientTexture.animations.length&&b.push(this.ambientTexture),this.opacityTexture&&this.opacityTexture.animations&&0<this.opacityTexture.animations.length&&b.push(this.opacityTexture),this.reflectionTexture&&this.reflectionTexture.animations&&0<this.reflectionTexture.animations.length&&b.push(this.reflectionTexture),this.emissiveTexture&&this.emissiveTexture.animations&&0<this.emissiveTexture.animations.length&&
b.push(this.emissiveTexture),this.specularTexture&&this.specularTexture.animations&&0<this.specularTexture.animations.length&&b.push(this.specularTexture),this.bumpTexture&&this.bumpTexture.animations&&0<this.bumpTexture.animations.length&&b.push(this.bumpTexture),this.lightmapTexture&&this.lightmapTexture.animations&&0<this.lightmapTexture.animations.length&&b.push(this.lightmapTexture),this.refractionTexture&&this.refractionTexture.animations&&0<this.refractionTexture.animations.length&&b.push(this.refractionTexture),
b},g.prototype.dispose=function(b,c){c&&(this.diffuseTexture&&this.diffuseTexture.dispose(),this.ambientTexture&&this.ambientTexture.dispose(),this.opacityTexture&&this.opacityTexture.dispose(),this.reflectionTexture&&this.reflectionTexture.dispose(),this.emissiveTexture&&this.emissiveTexture.dispose(),this.specularTexture&&this.specularTexture.dispose(),this.bumpTexture&&this.bumpTexture.dispose(),this.lightmapTexture&&this.lightmapTexture.dispose(),this.refractionTexture&&this.refractionTexture.dispose());
d.prototype.dispose.call(this,b,c)},g.prototype.clone=function(c){var d=this;return b.SerializationHelper.Clone(function(){return new g(c,d.getScene())},this)},g.prototype.serialize=function(){return b.SerializationHelper.Serialize(this)},g.Parse=function(c,d,e){return b.SerializationHelper.Parse(function(){return new g(c.name,d)},c,d,e)},g.DiffuseTextureEnabled=!0,g.AmbientTextureEnabled=!0,g.OpacityTextureEnabled=!0,g.ReflectionTextureEnabled=!0,g.EmissiveTextureEnabled=!0,g.SpecularTextureEnabled=
!0,g.BumpTextureEnabled=!0,g.FresnelEnabled=!0,g.LightmapTextureEnabled=!0,g.RefractionTextureEnabled=!0,__decorate([b.serializeAsTexture()],g.prototype,"diffuseTexture",void 0),__decorate([b.serializeAsTexture()],g.prototype,"ambientTexture",void 0),__decorate([b.serializeAsTexture()],g.prototype,"opacityTexture",void 0),__decorate([b.serializeAsTexture()],g.prototype,"reflectionTexture",void 0),__decorate([b.serializeAsTexture()],g.prototype,"emissiveTexture",void 0),__decorate([b.serializeAsTexture()],
g.prototype,"specularTexture",void 0),__decorate([b.serializeAsTexture()],g.prototype,"bumpTexture",void 0),__decorate([b.serializeAsTexture()],g.prototype,"lightmapTexture",void 0),__decorate([b.serializeAsTexture()],g.prototype,"refractionTexture",void 0),__decorate([b.serializeAsColor3("ambient")],g.prototype,"ambientColor",void 0),__decorate([b.serializeAsColor3("diffuse")],g.prototype,"diffuseColor",void 0),__decorate([b.serializeAsColor3("specular")],g.prototype,"specularColor",void 0),__decorate([b.serializeAsColor3("emissive")],
g.prototype,"emissiveColor",void 0),__decorate([b.serialize()],g.prototype,"specularPower",void 0),__decorate([b.serialize()],g.prototype,"useAlphaFromDiffuseTexture",void 0),__decorate([b.serialize()],g.prototype,"useEmissiveAsIllumination",void 0),__decorate([b.serialize()],g.prototype,"linkEmissiveWithDiffuse",void 0),__decorate([b.serialize()],g.prototype,"useReflectionFresnelFromSpecular",void 0),__decorate([b.serialize()],g.prototype,"useSpecularOverAlpha",void 0),__decorate([b.serialize()],
g.prototype,"useReflectionOverAlpha",void 0),__decorate([b.serialize()],g.prototype,"disableLighting",void 0),__decorate([b.serialize()],g.prototype,"useParallax",void 0),__decorate([b.serialize()],g.prototype,"useParallaxOcclusion",void 0),__decorate([b.serialize()],g.prototype,"parallaxScaleBias",void 0),__decorate([b.serialize()],g.prototype,"roughness",void 0),__decorate([b.serialize()],g.prototype,"indexOfRefraction",void 0),__decorate([b.serialize()],g.prototype,"invertRefractionY",void 0),
__decorate([b.serialize()],g.prototype,"useLightmapAsShadowmap",void 0),__decorate([b.serializeAsFresnelParameters()],g.prototype,"diffuseFresnelParameters",void 0),__decorate([b.serializeAsFresnelParameters()],g.prototype,"opacityFresnelParameters",void 0),__decorate([b.serializeAsFresnelParameters()],g.prototype,"reflectionFresnelParameters",void 0),__decorate([b.serializeAsFresnelParameters()],g.prototype,"refractionFresnelParameters",void 0),__decorate([b.serializeAsFresnelParameters()],g.prototype,
"emissiveFresnelParameters",void 0),__decorate([b.serialize()],g.prototype,"useGlossinessFromSpecularMapAlpha",void 0),__decorate([b.serialize()],g.prototype,"maxSimultaneousLights",void 0),__decorate([b.serialize()],g.prototype,"invertNormalMapX",void 0),__decorate([b.serialize()],g.prototype,"invertNormalMapY",void 0),__decorate([b.serialize()],g.prototype,"useLogarithmicDepth",null),g);b.StandardMaterial=c}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.Material,c=function(b,c){e.call(this,b,c,!0);this.subMaterials=[];c.multiMaterials.push(this)};f=(__extends(c,e),c.prototype.getSubMaterial=function(b){return 0>b||b>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[b]},c.prototype.isReady=function(b){for(var c=0;c<this.subMaterials.length;c++)if(this.subMaterials[c]&&!this.subMaterials[c].isReady(b))return!1;return!0},c.prototype.clone=function(b,e){for(var f=new c(b,this.getScene()),j=0;j<this.subMaterials.length;j++){var l=
null,l=e?this.subMaterials[j].clone(b+"-"+this.subMaterials[j].name):this.subMaterials[j];f.subMaterials.push(l)}return f},c.prototype.serialize=function(){var c={};c.name=this.name;c.id=this.id;c.tags=b.Tags.GetTags(this);c.materials=[];for(var e=0;e<this.subMaterials.length;e++){var f=this.subMaterials[e];f?c.materials.push(f.id):c.materials.push(null)}return c},c);b.MultiMaterial=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(){};f=(Object.defineProperty(e,"NO_LOGGING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e,"MINIMAL_LOGGING",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SUMMARY_LOGGING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DETAILED_LOGGING",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ForceFullSceneLoadingForIncremental",{get:function(){return e._ForceFullSceneLoadingForIncremental},
set:function(b){e._ForceFullSceneLoadingForIncremental=b},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ShowLoadingScreen",{get:function(){return e._ShowLoadingScreen},set:function(b){e._ShowLoadingScreen=b},enumerable:!0,configurable:!0}),Object.defineProperty(e,"loggingLevel",{get:function(){return e._loggingLevel},set:function(b){e._loggingLevel=b},enumerable:!0,configurable:!0}),e._getPluginForFilename=function(b){var d=b.lastIndexOf("."),e=b.indexOf("?");-1===e&&(e=b.length);b=b.substring(d,
e).toLowerCase();for(d=0;d<this._registeredPlugins.length;d++)if(e=this._registeredPlugins[d],-1!==e.extensions.indexOf(b))return e;return this._registeredPlugins[0]},e.GetPluginForExtension=function(b){for(var d=0;d<this._registeredPlugins.length;d++){var e=this._registeredPlugins[d];if(-1!==e.extensions.indexOf(b))return e}return null},e.RegisterPlugin=function(b){b.extensions=b.extensions.toLowerCase();e._registeredPlugins.push(b)},e.ImportMesh=function(c,d,g,f,j,l,n){if(g.substr&&"/"===g.substr(0,
1)||g.substr&&"/"===g.substr(0,1))return void b.Tools.Error("Wrong sceneFilename parameter");var q={};f._addPendingData(q);var p=function(){f.database=r;var p=e._getPluginForFilename(g),s=function(b){var e=[],l=[],r=[];try{if(p.importMesh){if(!p.importMesh(c,f,b,d,e,l,r))return n&&n(f,"Unable to import meshes from "+d+g),void f._removePendingData(q);j&&(f.importedMeshesFiles.push(d+g),j(e,l,r),f._removePendingData(q))}else p.importMeshAsync(c,f,b,d,function(b,c,e){j&&(f.importedMeshesFiles.push(d+
g),j(b,c,e),f._removePendingData(q))},function(){n&&n(f,"Unable to import meshes from "+d+g);f._removePendingData(q)})}catch(s){n&&n(f,"Unable to import meshes from "+d+g,s),f._removePendingData(q)}};return g.substr&&"data:"===g.substr(0,5)?void s(g.substr(5)):void b.Tools.LoadFile(d+g,function(b){s(b)},l,r)};if(!f.getEngine().enableOfflineSupport||g.substr&&"data:"===g.substr(0,5))p(!0);else var r=new b.Database(d+g,p)},e.Load=function(c,d,g,f,j,l){e.Append(c,d,new b.Scene(g),f,j,l)},e.Append=function(c,
d,g,f,j,l){if(d.substr&&"/"===d.substr(0,1))return void b.Tools.Error("Wrong sceneFilename parameter");var n,q=this._getPluginForFilename(d.name||d),p={};g._addPendingData(p);e.ShowLoadingScreen&&g.getEngine().displayLoadingUI();var r=function(b){if(g.database=n,q.load){if(!q.load(g,b,c))return l&&l(g),g._removePendingData(p),void g.getEngine().hideLoadingUI();f&&f(g);g._removePendingData(p)}else q.loadAsync(g,b,c,function(){f&&f(g)},function(){l&&l(g);g._removePendingData(p);g.getEngine().hideLoadingUI()});
e.ShowLoadingScreen&&g.executeWhenReady(function(){g.getEngine().hideLoadingUI()})},t=function(){b.Tools.LoadFile(c+d,r,j,n)};return d.substr&&"data:"===d.substr(0,5)?void r(d.substr(5)):void(-1===c.indexOf("file:")?g.getEngine().enableOfflineSupport?n=new b.Database(c+d,t):t(!0):b.Tools.ReadFile(d,r,j))},e._ForceFullSceneLoadingForIncremental=!1,e._ShowLoadingScreen=!0,e._loggingLevel=e.NO_LOGGING,e._registeredPlugins=[],e);b.SceneLoader=f}(BABYLON||(BABYLON={}));
!function(b){b.Internals||(b.Internals={});var f=function(c,d,e,f){for(var j=0,l=d.materials.length;l>j;j++){var n=d.materials[j];if(n.id===c)return b.Material.Parse(n,e,f)}return null},e=function(b,d){return b+" of "+(d?d.file+" from "+d.name+" version: "+d.version+", exporter version: "+d.exporter_version:"unknown")};b.SceneLoader.RegisterPlugin({extensions:".babylon",importMesh:function(c,d,g,m,j,l,n){var q="importMesh has failed JSON parse";try{var p=JSON.parse(g),q="",r,t,s=b.SceneLoader.loggingLevel===
b.SceneLoader.DETAILED_LOGGING;g=[];var u=[],x=[];r=0;for(t=p.meshes.length;t>r;r++){var y=p.meshes[r],z;if(!(z=!c))a:{var A=y,B=c,C=x,B=B instanceof Array?B:[B],D=void 0;for(D in B)if(A.name===B[D]){z=(C.push(A.id),!0);break a}z=A.parentId&&-1!==C.indexOf(A.parentId)?(C.push(A.id),!0):!1}if(z){if(c instanceof Array&&delete c[c.indexOf(y.name)],y.geometryId&&p.geometries){var E=!1;"boxes spheres cylinders toruses grounds planes torusKnots vertexData".split(" ").forEach(function(c){!E&&p.geometries[c]&&
p.geometries[c]instanceof Array&&p.geometries[c].forEach(function(e){if(e.id===y.geometryId){switch(c){case "boxes":b.Geometry.Primitives.Box.Parse(e,d);break;case "spheres":b.Geometry.Primitives.Sphere.Parse(e,d);break;case "cylinders":b.Geometry.Primitives.Cylinder.Parse(e,d);break;case "toruses":b.Geometry.Primitives.Torus.Parse(e,d);break;case "grounds":b.Geometry.Primitives.Ground.Parse(e,d);break;case "planes":b.Geometry.Primitives.Plane.Parse(e,d);break;case "torusKnots":b.Geometry.Primitives.TorusKnot.Parse(e,
d);break;case "vertexData":b.Geometry.Parse(e,d,m)}E=!0}})});E||b.Tools.Warn("Geometry not found for mesh "+y.id)}if(y.materialId){var I=-1!==u.indexOf(y.materialId);if(!I&&p.multiMaterials)for(var A=0,H=p.multiMaterials.length;H>A;A++){var F=p.multiMaterials[A];if(F.id===y.materialId){for(var A=0,J=F.materials.length;J>A;A++){var G=F.materials[A];u.push(G);var L=f(G,p,d,m),q=q+("\n\tMaterial "+L.toString(s))}u.push(F.id);var N=b.Material.ParseMultiMaterial(F,d),I=!0,q=q+("\n\tMulti-Material "+N.toString(s));
break}}I||(u.push(y.materialId),(L=f(y.materialId,p,d,m))?q+="\n\tMaterial "+L.toString(s):b.Tools.Warn("Material not found for mesh "+y.id))}if(-1<y.skeletonId&&d.skeletons&&!(-1<g.indexOf(y.skeletonId)))for(var A=0,R=p.skeletons.length;R>A;A++){var P=p.skeletons[A];if(P.id===y.skeletonId){var K=b.Skeleton.Parse(P,d);n.push(K);g.push(P.id);q+="\n\tSkeleton "+K.toString(s)}}var O=b.Mesh.Parse(y,d,m);j.push(O);q+="\n\tMesh "+O.toString(s)}}var M;r=0;for(t=d.meshes.length;t>r;r++)M=d.meshes[r],M._waitingParentId&&
(M.parent=d.getLastEntryByID(M._waitingParentId),M._waitingParentId=void 0);r=0;for(t=d.meshes.length;t>r;r++)M=d.meshes[r],M._waitingFreezeWorldMatrix?(M.freezeWorldMatrix(),M._waitingFreezeWorldMatrix=void 0):M.computeWorldMatrix(!0);if(p.particleSystems){r=0;for(t=p.particleSystems.length;t>r;r++){var W=p.particleSystems[r];-1!==x.indexOf(W.emitterId)&&l.push(b.ParticleSystem.Parse(W,d,m))}}return!0}catch(Ga){throw b.Tools.Log(e("importMesh",p.producer)+q),q=null,Ga;}finally{null!==q&&b.SceneLoader.loggingLevel!==
b.SceneLoader.NO_LOGGING&&b.Tools.Log(e("importMesh",p.producer)+(b.SceneLoader.loggingLevel!==b.SceneLoader.MINIMAL_LOGGING?q:""))}},load:function(c,d,g){var f="importScene has failed JSON parse";try{var j=JSON.parse(d),f="",l=b.SceneLoader.loggingLevel===b.SceneLoader.DETAILED_LOGGING;if(c.useDelayedTextureLoading=j.useDelayedTextureLoading&&!b.SceneLoader.ForceFullSceneLoadingForIncremental,c.autoClear=j.autoClear,c.clearColor=b.Color4.FromArray(j.clearColor),c.ambientColor=b.Color3.FromArray(j.ambientColor),
j.gravity&&(c.gravity=b.Vector3.FromArray(j.gravity)),j.fogMode&&0!==j.fogMode)switch(c.fogMode=j.fogMode,c.fogColor=b.Color3.FromArray(j.fogColor),c.fogStart=j.fogStart,c.fogEnd=j.fogEnd,c.fogDensity=j.fogDensity,f+="\tFog mode for scene:  ",c.fogMode){case 1:f+="exp\n";break;case 2:f+="exp2\n";break;case 3:f+="linear\n"}if(j.physicsEnabled){var n;"cannon"===j.physicsEngine?n=new b.CannonJSPlugin:"oimo"===j.physicsEngine&&(n=new b.OimoJSPlugin);var f="\tPhysics engine "+(j.physicsEngine?j.physicsEngine:
"oimo")+" enabled\n",q=j.physicsGravity?b.Vector3.FromArray(j.physicsGravity):null;c.enablePhysics(q,n)}void 0!=j.collisionsEnabled&&(c.collisionsEnabled=j.collisionsEnabled);c.workerCollisions=!!j.workerCollisions;var p,r;p=0;for(r=j.lights.length;r>p;p++)var t=b.Light.Parse(j.lights[p],c),f=f+(0===p?"\n\tLights:":""),f=f+("\n\t\t"+t.toString(l));if(j.animations){p=0;for(r=j.animations.length;r>p;p++){var s=b.Animation.Parse(j.animations[p]);c.animations.push(s);f+=0===p?"\n\tAnimations:":"";f+=
"\n\t\t"+s.toString(l)}}if(j.autoAnimate&&c.beginAnimation(c,j.autoAnimateFrom,j.autoAnimateTo,j.autoAnimateLoop,j.autoAnimateSpeed||1),j.materials){p=0;for(r=j.materials.length;r>p;p++)var u=b.Material.Parse(j.materials[p],c,g),f=f+(0===p?"\n\tMaterials:":""),f=f+("\n\t\t"+u.toString(l))}if(j.multiMaterials){p=0;for(r=j.multiMaterials.length;r>p;p++)var x=b.Material.ParseMultiMaterial(j.multiMaterials[p],c),f=f+(0===p?"\n\tMultiMaterials:":""),f=f+("\n\t\t"+x.toString(l))}if(j.skeletons){p=0;for(r=
j.skeletons.length;r>p;p++)var y=b.Skeleton.Parse(j.skeletons[p],c),f=f+(0===p?"\n\tSkeletons:":""),f=f+("\n\t\t"+y.toString(l))}var z=j.geometries;if(z){var A=z.boxes;if(A){p=0;for(r=A.length;r>p;p++)b.Geometry.Primitives.Box.Parse(A[p],c)}var B=z.spheres;if(B){p=0;for(r=B.length;r>p;p++)b.Geometry.Primitives.Sphere.Parse(B[p],c)}var C=z.cylinders;if(C){p=0;for(r=C.length;r>p;p++)b.Geometry.Primitives.Cylinder.Parse(C[p],c)}var D=z.toruses;if(D){p=0;for(r=D.length;r>p;p++)b.Geometry.Primitives.Torus.Parse(D[p],
c)}var E=z.grounds;if(E){p=0;for(r=E.length;r>p;p++)b.Geometry.Primitives.Ground.Parse(E[p],c)}var I=z.planes;if(I){p=0;for(r=I.length;r>p;p++)b.Geometry.Primitives.Plane.Parse(I[p],c)}var H=z.torusKnots;if(H){p=0;for(r=H.length;r>p;p++)b.Geometry.Primitives.TorusKnot.Parse(H[p],c)}var F=z.vertexData;if(F){p=0;for(r=F.length;r>p;p++)b.Geometry.Parse(F[p],c,g)}}p=0;for(r=j.meshes.length;r>p;p++)var J=b.Mesh.Parse(j.meshes[p],c,g),f=f+(0===p?"\n\tMeshes:":""),f=f+("\n\t\t"+J.toString(l));p=0;for(r=
j.cameras.length;r>p;p++)var G=b.Camera.Parse(j.cameras[p],c),f=f+(0===p?"\n\tCameras:":""),f=f+("\n\t\t"+G.toString(l));j.activeCameraID&&c.setActiveCameraByID(j.activeCameraID);p=0;for(r=c.cameras.length;r>p;p++)G=c.cameras[p],G._waitingParentId&&(G.parent=c.getLastEntryByID(G._waitingParentId),G._waitingParentId=void 0);p=0;for(r=c.lights.length;r>p;p++)t=c.lights[p],t._waitingParentId&&(t.parent=c.getLastEntryByID(t._waitingParentId),t._waitingParentId=void 0);var L;d=[];if(b.AudioEngine&&j.sounds){p=
0;for(r=j.sounds.length;r>p;p++){var N=j.sounds[p];b.Engine.audioEngine.canUseWebAudio?(N.url||(N.url=N.name),d[N.url]?b.Sound.Parse(N,c,g,d[N.url]):(L=b.Sound.Parse(N,c,g),d[N.url]=L)):new b.Sound(N.name,null,c)}}p=0;for(r=c.meshes.length;r>p;p++)J=c.meshes[p],J._waitingParentId&&(J.parent=c.getLastEntryByID(J._waitingParentId),J._waitingParentId=void 0),J._waitingActions&&(b.ActionManager.Parse(J._waitingActions,J,c),J._waitingActions=void 0);p=0;for(r=c.meshes.length;r>p;p++){var R=c.meshes[p];
R._waitingFreezeWorldMatrix?(R.freezeWorldMatrix(),R._waitingFreezeWorldMatrix=void 0):R.computeWorldMatrix(!0)}if(j.particleSystems){p=0;for(r=j.particleSystems.length;r>p;p++)b.ParticleSystem.Parse(j.particleSystems[p],c,g)}if(j.lensFlareSystems){p=0;for(r=j.lensFlareSystems.length;r>p;p++)b.LensFlareSystem.Parse(j.lensFlareSystems[p],c,g)}if(j.shadowGenerators){p=0;for(r=j.shadowGenerators.length;r>p;p++)b.ShadowGenerator.Parse(j.shadowGenerators[p],c)}return j.actions&&b.ActionManager.Parse(j.actions,
null,c),!0}catch(P){throw b.Tools.Log(e("importScene",j.producer)+f),P;}finally{null!==f&&b.SceneLoader.loggingLevel!==b.SceneLoader.NO_LOGGING&&b.Tools.Log(e("importScene",j.producer)+(b.SceneLoader.loggingLevel!==b.SceneLoader.MINIMAL_LOGGING?f:""))}}});!0}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(e,c,d,g,f,j,l){void 0===l&&(l=b.Texture.TRILINEAR_SAMPLINGMODE);this.name=e;this.cellSize=g;this.sprites=[];this.renderingGroupId=0;this.layerMask=268435455;this.fogEnabled=!0;this.isPickable=!1;this.onDisposeObservable=new b.Observable;this._vertexBuffers={};this._capacity=d;this._spriteTexture=new b.Texture(c,f,!0,!1,l);this._spriteTexture.wrapU=b.Texture.CLAMP_ADDRESSMODE;this._spriteTexture.wrapV=b.Texture.CLAMP_ADDRESSMODE;this._epsilon=void 0===j?0.01:j;this._scene=
f;this._scene.spriteManagers.push(this);e=[];for(g=c=0;d>g;g++)e.push(c),e.push(c+1),e.push(c+2),e.push(c),e.push(c+2),e.push(c+3),c+=4;this._indexBuffer=f.getEngine().createIndexBuffer(e);this._vertexData=new Float32Array(64*d);this._buffer=new b.Buffer(f.getEngine(),this._vertexData,!0,16);d=this._buffer.createVertexBuffer(b.VertexBuffer.PositionKind,0,4);f=this._buffer.createVertexBuffer("options",4,4);e=this._buffer.createVertexBuffer("cellInfo",8,4);c=this._buffer.createVertexBuffer(b.VertexBuffer.ColorKind,
12,4);this._vertexBuffers[b.VertexBuffer.PositionKind]=d;this._vertexBuffers.options=f;this._vertexBuffers.cellInfo=e;this._vertexBuffers[b.VertexBuffer.ColorKind]=c;this._effectBase=this._scene.getEngine().createEffect("sprites",[b.VertexBuffer.PositionKind,"options","cellInfo",b.VertexBuffer.ColorKind],["view","projection","textureInfos","alphaTest"],["diffuseSampler"],"");this._effectFog=this._scene.getEngine().createEffect("sprites",[b.VertexBuffer.PositionKind,"options","cellInfo",b.VertexBuffer.ColorKind],
"view projection textureInfos alphaTest vFogInfos vFogColor".split(" "),["diffuseSampler"],"#define FOG")};f=(Object.defineProperty(f.prototype,"onDispose",{set:function(b){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver);this._onDisposeObserver=this.onDisposeObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"texture",{get:function(){return this._spriteTexture},set:function(b){this._spriteTexture=b},enumerable:!0,configurable:!0}),
f.prototype._appendSpriteVertex=function(b,c,d,g,f){b*=16;0===d?d=this._epsilon:1===d&&(d=1-this._epsilon);0===g?g=this._epsilon:1===g&&(g=1-this._epsilon);this._vertexData[b]=c.position.x;this._vertexData[b+1]=c.position.y;this._vertexData[b+2]=c.position.z;this._vertexData[b+3]=c.angle;this._vertexData[b+4]=c.width;this._vertexData[b+5]=c.height;this._vertexData[b+6]=d;this._vertexData[b+7]=g;this._vertexData[b+8]=c.invertU?1:0;this._vertexData[b+9]=c.invertV?1:0;d=c.cellIndex/f>>0;this._vertexData[b+
10]=c.cellIndex-d*f;this._vertexData[b+11]=d;this._vertexData[b+12]=c.color.r;this._vertexData[b+13]=c.color.g;this._vertexData[b+14]=c.color.b;this._vertexData[b+15]=c.color.a},f.prototype.intersects=function(e,c,d,g){var f,j=Math.min(this._capacity,this.sprites.length),l=b.Vector3.Zero(),n=b.Vector3.Zero(),q=Number.MAX_VALUE,p=b.Vector3.Zero();c=c.getViewMatrix();for(var r=0;j>r;r++){var t=this.sprites[r];if(t){if(d){if(!d(t))continue}else if(!t.isPickable)continue;if(b.Vector3.TransformCoordinatesToRef(t.position,
c,p),l.copyFromFloats(p.x-t.width/2,p.y-t.height/2,p.z),n.copyFromFloats(p.x+t.width/2,p.y+t.height/2,p.z),e.intersectsBoxMinMax(l,n)){var s=b.Vector3.Distance(p,e.origin);if(q>s&&(q=s,f=t,g))break}}}return f?(e=new b.PickingInfo,e.hit=!0,e.pickedSprite=f,e.distance=q,e):null},f.prototype.render=function(){if(this._effectBase.isReady()&&this._effectFog.isReady()&&this._spriteTexture&&this._spriteTexture.isReady()){for(var e=this._scene.getEngine(),c=this._spriteTexture.getBaseSize(),d=e.getDeltaTime(),
g=Math.min(this._capacity,this.sprites.length),f=c.width/this.cellSize,j=0,l=0;g>l;l++){var n=this.sprites[l];n&&(n._animate(d),this._appendSpriteVertex(j++,n,0,0,f),this._appendSpriteVertex(j++,n,1,0,f),this._appendSpriteVertex(j++,n,1,1,f),this._appendSpriteVertex(j++,n,0,1,f))}this._buffer.update(this._vertexData);d=this._effectBase;this._scene.fogEnabled&&this._scene.fogMode!==b.Scene.FOGMODE_NONE&&this.fogEnabled&&(d=this._effectFog);e.enableEffect(d);f=this._scene.getViewMatrix();d.setTexture("diffuseSampler",
this._spriteTexture);d.setMatrix("view",f);d.setMatrix("projection",this._scene.getProjectionMatrix());d.setFloat2("textureInfos",this.cellSize/c.width,this.cellSize/c.height);this._scene.fogEnabled&&this._scene.fogMode!==b.Scene.FOGMODE_NONE&&this.fogEnabled&&(d.setFloat4("vFogInfos",this._scene.fogMode,this._scene.fogStart,this._scene.fogEnd,this._scene.fogDensity),d.setColor3("vFogColor",this._scene.fogColor));e.bindBuffers(this._vertexBuffers,this._indexBuffer,d);e.setDepthFunctionToLessOrEqual();
d.setBool("alphaTest",!0);e.setColorWrite(!1);e.draw(!0,0,6*g);e.setColorWrite(!0);d.setBool("alphaTest",!1);e.setAlphaMode(b.Engine.ALPHA_COMBINE);e.draw(!0,0,6*g);e.setAlphaMode(b.Engine.ALPHA_DISABLE)}},f.prototype.dispose=function(){this._buffer&&(this._buffer.dispose(),this._buffer=null);this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this._spriteTexture&&(this._spriteTexture.dispose(),this._spriteTexture=null);var b=this._scene.spriteManagers.indexOf(this);
this._scene.spriteManagers.splice(b,1);this.onDisposeObservable.notifyObservers(this);this.onDisposeObservable.clear()},f);b.SpriteManager=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(e,c){this.name=e;this.color=new b.Color4(1,1,1,1);this.height=this.width=1;this.invertV=this.invertU=this.cellIndex=this.angle=0;this.animations=[];this._loopAnimation=this._animationStarted=this.isPickable=!1;this._delay=this._toIndex=this._fromIndex=0;this._direction=1;this._time=this._frameCount=0;this._manager=c;this._manager.sprites.push(this);this.position=b.Vector3.Zero()};f=(Object.defineProperty(f.prototype,"size",{get:function(){return this.width},set:function(b){this.height=
this.width=b},enumerable:!0,configurable:!0}),f.prototype.playAnimation=function(b,c,d,g){this._fromIndex=b;this._toIndex=c;this._loopAnimation=d;this._delay=g;this._animationStarted=!0;this._direction=c>b?1:-1;this.cellIndex=b;this._time=0},f.prototype.stopAnimation=function(){this._animationStarted=!1},f.prototype._animate=function(b){this._animationStarted&&(this._time+=b,this._time>this._delay&&(this._time%=this._delay,this.cellIndex+=this._direction,this.cellIndex==this._toIndex&&(this._loopAnimation?
this.cellIndex=this._fromIndex:(this._animationStarted=!1,this.disposeWhenFinishedAnimating&&this.dispose()))))},f.prototype.dispose=function(){for(var b=0;b<this._manager.sprites.length;b++)this._manager.sprites[b]==this&&this._manager.sprites.splice(b,1)},f);b.Sprite=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(e,c,d,g,f){this.name=e;this.scale=new b.Vector2(1,1);this.offset=new b.Vector2(0,0);this.alphaBlendingMode=b.Engine.ALPHA_COMBINE;this._vertexBuffers={};this.onDisposeObservable=new b.Observable;this.onBeforeRenderObservable=new b.Observable;this.onAfterRenderObservable=new b.Observable;this.texture=c?new b.Texture(c,d,!0):null;this.isBackground=void 0===g?!0:g;this.color=void 0===f?new b.Color4(1,1,1,1):f;this._scene=d;this._scene.layers.push(this);e=d.getEngine();c=
[];c.push(1,1);c.push(-1,1);c.push(-1,-1);c.push(1,-1);c=new b.VertexBuffer(e,c,b.VertexBuffer.PositionKind,!1,!1,2);this._vertexBuffers[b.VertexBuffer.PositionKind]=c;c=[];c.push(0);c.push(1);c.push(2);c.push(0);c.push(2);c.push(3);this._indexBuffer=e.createIndexBuffer(c);this._effect=e.createEffect("layer",[b.VertexBuffer.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],"");this._alphaTestEffect=e.createEffect("layer",[b.VertexBuffer.PositionKind],["textureMatrix","color",
"scale","offset"],["textureSampler"],"#define ALPHATEST")};f=(Object.defineProperty(f.prototype,"onDispose",{set:function(b){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver);this._onDisposeObserver=this.onDisposeObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"onBeforeRender",{set:function(b){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver);this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(b)},
enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"onAfterRender",{set:function(b){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver);this._onAfterRenderObserver=this.onAfterRenderObservable.add(b)},enumerable:!0,configurable:!0}),f.prototype.render=function(){var e=this.alphaTest?this._alphaTestEffect:this._effect;if(e.isReady()&&this.texture&&this.texture.isReady()){var c=this._scene.getEngine();this.onBeforeRenderObservable.notifyObservers(this);
c.enableEffect(e);c.setState(!1);e.setTexture("textureSampler",this.texture);e.setMatrix("textureMatrix",this.texture.getTextureMatrix());e.setFloat4("color",this.color.r,this.color.g,this.color.b,this.color.a);e.setVector2("offset",this.offset);e.setVector2("scale",this.scale);c.bindBuffers(this._vertexBuffers,this._indexBuffer,e);this._alphaTestEffect?c.draw(!0,0,6):(c.setAlphaMode(this.alphaBlendingMode),c.draw(!0,0,6),c.setAlphaMode(b.Engine.ALPHA_DISABLE));this.onAfterRenderObservable.notifyObservers(this)}},
f.prototype.dispose=function(){var e=this._vertexBuffers[b.VertexBuffer.PositionKind];e&&(e.dispose(),this._vertexBuffers[b.VertexBuffer.PositionKind]=null);this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.texture&&(this.texture.dispose(),this.texture=null);e=this._scene.layers.indexOf(this);this._scene.layers.splice(e,1);this.onDisposeObservable.notifyObservers(this);this.onDisposeObservable.clear();this.onAfterRenderObservable.clear();this.onBeforeRenderObservable.clear()},
f);b.Layer=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(){this.position=b.Vector3.Zero();this.direction=b.Vector3.Zero();this.color=new b.Color4(0,0,0,0);this.colorStep=new b.Color4(0,0,0,0);this.lifeTime=1;this.angularSpeed=this.angle=this.size=this.age=0};f=(f.prototype.copyTo=function(b){b.position.copyFrom(this.position);b.direction.copyFrom(this.direction);b.color.copyFrom(this.color);b.colorStep.copyFrom(this.colorStep);b.lifeTime=this.lifeTime;b.age=this.age;b.size=this.size;b.angle=this.angle;b.angularSpeed=this.angularSpeed},
f);b.Particle=f}(BABYLON||(BABYLON={}));
!function(b){var f=function(b,c){return b===c?b:Math.random()*(c-b)+b},e,c=function(d,e,m,j){var l=this;this.name=d;this.animations=[];this.renderingGroupId=0;this.emitter=null;this.emitRate=10;this.manualEmitCount=-1;this.updateSpeed=0.01;this.targetStopDuration=0;this.disposeOnStop=!1;this.maxSize=this.minSize=this.maxLifeTime=this.minLifeTime=this.maxEmitPower=this.minEmitPower=1;this.maxAngularSpeed=this.minAngularSpeed=0;this.layerMask=268435455;this.onDisposeObservable=new b.Observable;this.blendMode=
c.BLENDMODE_ONEONE;this.forceDepthWrite=!1;this.gravity=b.Vector3.Zero();this.direction1=new b.Vector3(0,1,0);this.direction2=new b.Vector3(0,1,0);this.minEmitBox=new b.Vector3(-0.5,-0.5,-0.5);this.maxEmitBox=new b.Vector3(0.5,0.5,0.5);this.color1=new b.Color4(1,1,1,1);this.color2=new b.Color4(1,1,1,1);this.colorDead=new b.Color4(0,0,0,1);this.textureMask=new b.Color4(1,1,1,1);this.particles=[];this._stockParticles=[];this._newPartsExcess=0;this._vertexBuffers={};this._scaledColorStep=new b.Color4(0,
0,0,0);this._colorDiff=new b.Color4(0,0,0,0);this._scaledDirection=b.Vector3.Zero();this._scaledGravity=b.Vector3.Zero();this._currentRenderId=-1;this._stopped=this._started=!1;this._actualFrame=0;this.id=d;this._capacity=e;this._scene=m;this._customEffect=j;m.particleSystems.push(this);d=[];for(var n=j=0;e>n;n++)d.push(j),d.push(j+1),d.push(j+2),d.push(j),d.push(j+2),d.push(j+3),j+=4;this._indexBuffer=m.getEngine().createIndexBuffer(d);this._vertexData=new Float32Array(44*e);this._vertexBuffer=new b.Buffer(m.getEngine(),
this._vertexData,!0,11);e=this._vertexBuffer.createVertexBuffer(b.VertexBuffer.PositionKind,0,3);m=this._vertexBuffer.createVertexBuffer(b.VertexBuffer.ColorKind,3,4);d=this._vertexBuffer.createVertexBuffer("options",7,4);this._vertexBuffers[b.VertexBuffer.PositionKind]=e;this._vertexBuffers[b.VertexBuffer.ColorKind]=m;this._vertexBuffers.options=d;this.startDirectionFunction=function(c,d,e){var g=f(l.direction1.x,l.direction2.x),j=f(l.direction1.y,l.direction2.y),m=f(l.direction1.z,l.direction2.z);
b.Vector3.TransformNormalFromFloatsToRef(g*c,j*c,m*c,d,e)};this.startPositionFunction=function(c,d){var e=f(l.minEmitBox.x,l.maxEmitBox.x),g=f(l.minEmitBox.y,l.maxEmitBox.y),j=f(l.minEmitBox.z,l.maxEmitBox.z);b.Vector3.TransformCoordinatesFromFloatsToRef(e,g,j,c,d)};this.updateFunction=function(b){for(var c=0;c<b.length;c++){var d=b[c];d.age+=l._scaledUpdateSpeed;d.age>=d.lifeTime?(l.recycleParticle(d),c--):(d.colorStep.scaleToRef(l._scaledUpdateSpeed,l._scaledColorStep),d.color.addInPlace(l._scaledColorStep),
0>d.color.a&&(d.color.a=0),d.angle+=d.angularSpeed*l._scaledUpdateSpeed,d.direction.scaleToRef(l._scaledUpdateSpeed,l._scaledDirection),d.position.addInPlace(l._scaledDirection),l.gravity.scaleToRef(l._scaledUpdateSpeed,l._scaledGravity),d.direction.addInPlace(l._scaledGravity))}}};e=(Object.defineProperty(c.prototype,"onDispose",{set:function(b){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver);this._onDisposeObserver=this.onDisposeObservable.add(b)},enumerable:!0,
configurable:!0}),c.prototype.recycleParticle=function(b){var c=this.particles.pop();c!==b&&(c.copyTo(b),this._stockParticles.push(c))},c.prototype.getCapacity=function(){return this._capacity},c.prototype.isAlive=function(){return this._alive},c.prototype.isStarted=function(){return this._started},c.prototype.start=function(){this._started=!0;this._stopped=!1;this._actualFrame=0},c.prototype.stop=function(){this._stopped=!0},c.prototype._appendParticleVertex=function(b,c,e,f){b*=11;this._vertexData[b]=
c.position.x;this._vertexData[b+1]=c.position.y;this._vertexData[b+2]=c.position.z;this._vertexData[b+3]=c.color.r;this._vertexData[b+4]=c.color.g;this._vertexData[b+5]=c.color.b;this._vertexData[b+6]=c.color.a;this._vertexData[b+7]=c.angle;this._vertexData[b+8]=c.size;this._vertexData[b+9]=e;this._vertexData[b+10]=f},c.prototype._update=function(c){this._alive=0<this.particles.length;this.updateFunction(this.particles);var e;e=this.emitter.position?this.emitter.getWorldMatrix():b.Matrix.Translation(this.emitter.x,
this.emitter.y,this.emitter.z);for(var m,j=0;c>j&&this.particles.length!==this._capacity;j++){0!==this._stockParticles.length?(m=this._stockParticles.pop(),m.age=0):m=new b.Particle;this.particles.push(m);var l=f(this.minEmitPower,this.maxEmitPower);this.startDirectionFunction(l,e,m.direction,m);m.lifeTime=f(this.minLifeTime,this.maxLifeTime);m.size=f(this.minSize,this.maxSize);m.angularSpeed=f(this.minAngularSpeed,this.maxAngularSpeed);this.startPositionFunction(e,m.position,m);l=f(0,1);b.Color4.LerpToRef(this.color1,
this.color2,l,m.color);this.colorDead.subtractToRef(m.color,this._colorDiff);this._colorDiff.scaleToRef(1/m.lifeTime,m.colorStep)}},c.prototype._getEffect=function(){if(this._customEffect)return this._customEffect;var c=[];this._scene.clipPlane&&c.push("#define CLIPPLANE");c=c.join("\n");return this._cachedDefines!==c&&(this._cachedDefines=c,this._effect=this._scene.getEngine().createEffect("particles",[b.VertexBuffer.PositionKind,b.VertexBuffer.ColorKind,"options"],["invView","view","projection",
"vClipPlane","textureMask"],["diffuseSampler"],c)),this._effect},c.prototype.animate=function(){if(this._started){var b=this._getEffect();if(this.emitter&&b.isReady()&&this.particleTexture&&this.particleTexture.isReady()&&this._currentRenderId!==this._scene.getRenderId()){this._currentRenderId=this._scene.getRenderId();this._scaledUpdateSpeed=this.updateSpeed*this._scene.getAnimationRatio();var c;-1<this.manualEmitCount?(c=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0):(c=this.emitRate*
this._scaledUpdateSpeed>>0,this._newPartsExcess+=this.emitRate*this._scaledUpdateSpeed-c);1<this._newPartsExcess&&(c+=this._newPartsExcess>>0,this._newPartsExcess-=this._newPartsExcess>>0);this._alive=!1;this._stopped?c=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop());this._update(c);this._stopped&&(this._alive||(this._started=!1,this.disposeOnStop&&this._scene._toBeDisposed.push(this)));for(c=b=0;c<this.particles.length;c++){var e=
this.particles[c];this._appendParticleVertex(b++,e,0,0);this._appendParticleVertex(b++,e,1,0);this._appendParticleVertex(b++,e,1,1);this._appendParticleVertex(b++,e,0,1)}this._vertexBuffer.update(this._vertexData)}}},c.prototype.render=function(){var d=this._getEffect();if(!this.emitter||!d.isReady()||!this.particleTexture||!this.particleTexture.isReady()||!this.particles.length)return 0;var e=this._scene.getEngine();e.enableEffect(d);e.setState(!1);var f=this._scene.getViewMatrix();if(d.setTexture("diffuseSampler",
this.particleTexture),d.setMatrix("view",f),d.setMatrix("projection",this._scene.getProjectionMatrix()),d.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._scene.clipPlane){var j=this._scene.clipPlane,f=f.clone();f.invert();d.setMatrix("invView",f);d.setFloat4("vClipPlane",j.normal.x,j.normal.y,j.normal.z,j.d)}return e.bindBuffers(this._vertexBuffers,this._indexBuffer,d),this.blendMode===c.BLENDMODE_ONEONE?e.setAlphaMode(b.Engine.ALPHA_ONEONE):
e.setAlphaMode(b.Engine.ALPHA_COMBINE),this.forceDepthWrite&&e.setDepthWrite(!0),e.draw(!0,0,6*this.particles.length),e.setAlphaMode(b.Engine.ALPHA_DISABLE),this.particles.length},c.prototype.dispose=function(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null);this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null);var b=this._scene.particleSystems.indexOf(this);
this._scene.particleSystems.splice(b,1);this.onDisposeObservable.notifyObservers(this);this.onDisposeObservable.clear()},c.prototype.clone=function(d,e){var f=new c(d,this._capacity,this._scene);return b.Tools.DeepCopy(this,f,["particles"]),void 0===e&&(e=this.emitter),f.emitter=e,this.particleTexture&&(f.particleTexture=new b.Texture(this.particleTexture.url,this._scene)),f.start(),f},c.prototype.serialize=function(){var c={};return c.name=this.name,c.id=this.id,this.emitter.position?c.emitterId=
this.emitter.id:c.emitter=this.emitter.asArray(),c.capacity=this.getCapacity(),this.particleTexture&&(c.textureName=this.particleTexture.name),b.Animation.AppendSerializedAnimations(this,c),c.minAngularSpeed=this.minAngularSpeed,c.maxAngularSpeed=this.maxAngularSpeed,c.minSize=this.minSize,c.maxSize=this.maxSize,c.minEmitPower=this.minEmitPower,c.maxEmitPower=this.maxEmitPower,c.minLifeTime=this.minLifeTime,c.maxLifeTime=this.maxLifeTime,c.emitRate=this.emitRate,c.minEmitBox=this.minEmitBox.asArray(),
c.maxEmitBox=this.maxEmitBox.asArray(),c.gravity=this.gravity.asArray(),c.direction1=this.direction1.asArray(),c.direction2=this.direction2.asArray(),c.color1=this.color1.asArray(),c.color2=this.color2.asArray(),c.colorDead=this.colorDead.asArray(),c.updateSpeed=this.updateSpeed,c.targetStopDuration=this.targetStopDuration,c.textureMask=this.textureMask.asArray(),c.blendMode=this.blendMode,c},c.Parse=function(d,e,f){var j=new c(d.name,d.capacity,e);if(d.id&&(j.id=d.id),d.textureName&&(j.particleTexture=
new b.Texture(f+d.textureName,e),j.particleTexture.name=d.textureName),d.emitterId?j.emitter=e.getLastMeshByID(d.emitterId):j.emitter=b.Vector3.FromArray(d.emitter),d.animations)for(f=0;f<d.animations.length;f++)j.animations.push(b.Animation.Parse(d.animations[f]));return d.autoAnimate&&e.beginAnimation(j,d.autoAnimateFrom,d.autoAnimateTo,d.autoAnimateLoop,d.autoAnimateSpeed||1),j.minAngularSpeed=d.minAngularSpeed,j.maxAngularSpeed=d.maxAngularSpeed,j.minSize=d.minSize,j.maxSize=d.maxSize,j.minLifeTime=
d.minLifeTime,j.maxLifeTime=d.maxLifeTime,j.minEmitPower=d.minEmitPower,j.maxEmitPower=d.maxEmitPower,j.emitRate=d.emitRate,j.minEmitBox=b.Vector3.FromArray(d.minEmitBox),j.maxEmitBox=b.Vector3.FromArray(d.maxEmitBox),j.gravity=b.Vector3.FromArray(d.gravity),j.direction1=b.Vector3.FromArray(d.direction1),j.direction2=b.Vector3.FromArray(d.direction2),j.color1=b.Color4.FromArray(d.color1),j.color2=b.Color4.FromArray(d.color2),j.colorDead=b.Color4.FromArray(d.colorDead),j.updateSpeed=d.updateSpeed,
j.targetStopDuration=d.targetStopDuration,j.textureMask=b.Color4.FromArray(d.textureMask),j.blendMode=d.blendMode,d.preventAutoStart||j.start(),j},c.BLENDMODE_ONEONE=0,c.BLENDMODE_STANDARD=1,c);b.ParticleSystem=e}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(b,c,d){this.name=b;this.from=c;this.to=d};f=(e.prototype.clone=function(){return new e(this.name,this.from,this.to)},e);b.AnimationRange=f;b.AnimationEvent=function(b,c,d){this.frame=b;this.action=c;this.onlyOnce=d;this.isDone=!1};var c;c=function(b){this.path=b;this._onchange=[];this.value=0;this.animations=[]};c=(c.prototype.getPoint=function(){var c=this.path.getPointAtLengthPosition(this.value);return new b.Vector3(c.x,0,c.y)},c.prototype.moveAhead=function(b){return void 0===
b&&(b=0.0020),this.move(b),this},c.prototype.moveBack=function(b){return void 0===b&&(b=0.0020),this.move(-b),this},c.prototype.move=function(b){if(1<Math.abs(b))throw"step size should be less than 1.";return this.value+=b,this.ensureLimits(),this.raiseOnChange(),this},c.prototype.ensureLimits=function(){for(;1<this.value;)this.value-=1;for(;0>this.value;)this.value+=1;return this},c.prototype.markAsDirty=function(){return this.ensureLimits(),this.raiseOnChange(),this},c.prototype.raiseOnChange=function(){var b=
this;return this._onchange.forEach(function(c){return c(b)}),this},c.prototype.onchange=function(b){return this._onchange.push(b),this},c);b.PathCursor=c;var d=function(b,c,e,f,n,q){this.name=b;this.targetProperty=c;this.framePerSecond=e;this.dataType=f;this.loopMode=n;this.enableBlending=q;this._offsetsCache={};this._highLimitsCache={};this._stopped=!1;this._blendingFactor=0;this._events=[];this.allowMatricesInterpolation=!1;this.blendingSpeed=0.01;this._ranges={};this.targetPropertyPath=c.split(".");
this.dataType=f;this.loopMode=void 0===n?d.ANIMATIONLOOPMODE_CYCLE:n};c=(d._PrepareAnimation=function(c,e,f,l,n,q,p,r){var t=void 0;if(!isNaN(parseFloat(n))&&isFinite(n)?t=d.ANIMATIONTYPE_FLOAT:n instanceof b.Quaternion?t=d.ANIMATIONTYPE_QUATERNION:n instanceof b.Vector3?t=d.ANIMATIONTYPE_VECTOR3:n instanceof b.Vector2?t=d.ANIMATIONTYPE_VECTOR2:n instanceof b.Color3?t=d.ANIMATIONTYPE_COLOR3:n instanceof b.Size&&(t=d.ANIMATIONTYPE_SIZE),void 0==t)return null;c=new d(c,e,f,t,p);e=[];return e.push({frame:0,
value:n}),e.push({frame:l,value:q}),c.setKeys(e),void 0!==r&&c.setEasingFunction(r),c},d.CreateAndStartAnimation=function(b,c,e,f,n,q,p,r,t,s){b=d._PrepareAnimation(b,e,f,n,q,p,r,t);return c.getScene().beginDirectAnimation(c,[b],0,n,1===b.loopMode,1,s)},d.CreateMergeAndStartAnimation=function(b,c,e,f,n,q,p,r,t,s){b=d._PrepareAnimation(b,e,f,n,q,p,r,t);return c.animations.push(b),c.getScene().beginAnimation(c,0,n,1===b.loopMode,1,s)},d.prototype.toString=function(b){var c="Name: "+this.name+", property: "+
this.targetProperty;if(c+=", datatype: "+"Float Vector3 Quaternion Matrix Color3 Vector2".split(" ")[this.dataType],c+=", nKeys: "+(this._keys?this._keys.length:"none"),c+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),b){c+=", Ranges: {";b=!0;for(var d in this._ranges)b&&(c+=", ",b=!1),c+=d;c+="}"}return c},d.prototype.addEvent=function(b){this._events.push(b)},d.prototype.removeEvents=function(b){for(var c=0;c<this._events.length;c++)this._events[c].frame===b&&(this._events.splice(c,
1),c--)},d.prototype.createRange=function(b,c,d){this._ranges[b]||(this._ranges[b]=new f(b,c,d))},d.prototype.deleteRange=function(b,c){if(void 0===c&&(c=!0),this._ranges[b]){if(c)for(var d=this._ranges[b].from,e=this._ranges[b].to,f=this._keys.length-1;0<=f;f--)this._keys[f].frame>=d&&this._keys[f].frame<=e&&this._keys.splice(f,1);this._ranges[b]=void 0}},d.prototype.getRange=function(b){return this._ranges[b]},d.prototype.reset=function(){this._offsetsCache={};this._highLimitsCache={};this._blendingFactor=
this.currentFrame=0;this._originalBlendValue=null},d.prototype.isStopped=function(){return this._stopped},d.prototype.getKeys=function(){return this._keys},d.prototype.getHighestFrame=function(){for(var b=0,c=0,d=this._keys.length;d>c;c++)b<this._keys[c].frame&&(b=this._keys[c].frame);return b},d.prototype.getEasingFunction=function(){return this._easingFunction},d.prototype.setEasingFunction=function(b){this._easingFunction=b},d.prototype.floatInterpolateFunction=function(b,c,d){return b+(c-b)*d},
d.prototype.quaternionInterpolateFunction=function(c,d,e){return b.Quaternion.Slerp(c,d,e)},d.prototype.vector3InterpolateFunction=function(c,d,e){return b.Vector3.Lerp(c,d,e)},d.prototype.vector2InterpolateFunction=function(c,d,e){return b.Vector2.Lerp(c,d,e)},d.prototype.sizeInterpolateFunction=function(c,d,e){return b.Size.Lerp(c,d,e)},d.prototype.color3InterpolateFunction=function(c,d,e){return b.Color3.Lerp(c,d,e)},d.prototype.matrixInterpolateFunction=function(c,d,e){return b.Matrix.Lerp(c,
d,e)},d.prototype.clone=function(){var b=new d(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(this._keys&&b.setKeys(this._keys),this._ranges){b._ranges={};for(var c in this._ranges)b._ranges[c]=this._ranges[c].clone()}return b},d.prototype.setKeys=function(b){this._keys=b.slice(0);this._offsetsCache={};this._highLimitsCache={}},d.prototype._getKeyValue=function(b){return"function"==typeof b?b():b},d.prototype._interpolate=function(b,c,e,f,n){if(e===
d.ANIMATIONLOOPMODE_CONSTANT&&0<c)return n.clone?n.clone():n;this.currentFrame=b;n=Math.max(0,Math.min(this._keys.length-1,Math.floor(this._keys.length*(b-this._keys[0].frame)/(this._keys[this._keys.length-1].frame-this._keys[0].frame))-1));if(this._keys[n].frame>=b)for(;0<=n-1&&this._keys[n].frame>=b;)n--;for(var q=n;q<this._keys.length;q++)if(this._keys[q+1].frame>=b){n=this._getKeyValue(this._keys[q].value);var p=this._getKeyValue(this._keys[q+1].value);b=(b-this._keys[q].frame)/(this._keys[q+
1].frame-this._keys[q].frame);switch(null!=this._easingFunction&&(b=this._easingFunction.ease(b)),this.dataType){case d.ANIMATIONTYPE_FLOAT:switch(e){case d.ANIMATIONLOOPMODE_CYCLE:case d.ANIMATIONLOOPMODE_CONSTANT:return this.floatInterpolateFunction(n,p,b);case d.ANIMATIONLOOPMODE_RELATIVE:return f*c+this.floatInterpolateFunction(n,p,b)}break;case d.ANIMATIONTYPE_QUATERNION:q=null;switch(e){case d.ANIMATIONLOOPMODE_CYCLE:case d.ANIMATIONLOOPMODE_CONSTANT:q=this.quaternionInterpolateFunction(n,p,
b);break;case d.ANIMATIONLOOPMODE_RELATIVE:q=this.quaternionInterpolateFunction(n,p,b).add(f.scale(c))}return q;case d.ANIMATIONTYPE_VECTOR3:switch(e){case d.ANIMATIONLOOPMODE_CYCLE:case d.ANIMATIONLOOPMODE_CONSTANT:return this.vector3InterpolateFunction(n,p,b);case d.ANIMATIONLOOPMODE_RELATIVE:return this.vector3InterpolateFunction(n,p,b).add(f.scale(c))}case d.ANIMATIONTYPE_VECTOR2:switch(e){case d.ANIMATIONLOOPMODE_CYCLE:case d.ANIMATIONLOOPMODE_CONSTANT:return this.vector2InterpolateFunction(n,
p,b);case d.ANIMATIONLOOPMODE_RELATIVE:return this.vector2InterpolateFunction(n,p,b).add(f.scale(c))}case d.ANIMATIONTYPE_SIZE:switch(e){case d.ANIMATIONLOOPMODE_CYCLE:case d.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(n,p,b);case d.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(n,p,b).add(f.scale(c))}case d.ANIMATIONTYPE_COLOR3:switch(e){case d.ANIMATIONLOOPMODE_CYCLE:case d.ANIMATIONLOOPMODE_CONSTANT:return this.color3InterpolateFunction(n,p,b);case d.ANIMATIONLOOPMODE_RELATIVE:return this.color3InterpolateFunction(n,
p,b).add(f.scale(c))}case d.ANIMATIONTYPE_MATRIX:switch(e){case d.ANIMATIONLOOPMODE_CYCLE:case d.ANIMATIONLOOPMODE_CONSTANT:if(this.allowMatricesInterpolation)return this.matrixInterpolateFunction(n,p,b);case d.ANIMATIONLOOPMODE_RELATIVE:return n}}break}return this._getKeyValue(this._keys[this._keys.length-1].value)},d.prototype.setValue=function(c){var d,e;if(1<this.targetPropertyPath.length){e=this._target[this.targetPropertyPath[0]];for(d=1;d<this.targetPropertyPath.length-1;d++)e=e[this.targetPropertyPath[d]];
d=this.targetPropertyPath[this.targetPropertyPath.length-1]}else d=this.targetPropertyPath[0],e=this._target;this.enableBlending&&1>=this._blendingFactor?(this._originalBlendValue||(e[d].clone?this._originalBlendValue=e[d].clone():this._originalBlendValue=e[d]),this._originalBlendValue.prototype?this._originalBlendValue.prototype.Lerp?e[d]=this._originalBlendValue.construtor.prototype.Lerp(c,this._originalBlendValue,this._blendingFactor):e[d]=c:this._originalBlendValue.m?e[d]=b.Matrix.Lerp(this._originalBlendValue,
c,this._blendingFactor):e[d]=this._originalBlendValue*(1-this._blendingFactor)+this._blendingFactor*c,this._blendingFactor+=this.blendingSpeed):e[d]=c;this._target.markAsDirty&&this._target.markAsDirty(this.targetProperty)},d.prototype.goToFrame=function(b){b<this._keys[0].frame?b=this._keys[0].frame:b>this._keys[this._keys.length-1].frame&&(b=this._keys[this._keys.length-1].frame);b=this._interpolate(b,0,this.loopMode);this.setValue(b)},d.prototype.animate=function(c,e,f,l,n){if(!this.targetPropertyPath||
1>this.targetPropertyPath.length)return this._stopped=!0,!1;var q=!0;0!==this._keys[0].frame&&this._keys.splice(0,0,{frame:0,value:this._keys[0].value});(e<this._keys[0].frame||e>this._keys[this._keys.length-1].frame)&&(e=this._keys[0].frame);(f<this._keys[0].frame||f>this._keys[this._keys.length-1].frame)&&(f=this._keys[this._keys.length-1].frame);var p,r=f-e;c=c*this.framePerSecond*n/1E3;n=0;if(c>r&&!l)q=!1,n=this._getKeyValue(this._keys[this._keys.length-1].value);else if(this.loopMode!==d.ANIMATIONLOOPMODE_CYCLE){p=
f.toString()+e.toString();if(!this._offsetsCache[p]){l=this._interpolate(e,0,d.ANIMATIONLOOPMODE_CYCLE);n=this._interpolate(f,0,d.ANIMATIONLOOPMODE_CYCLE);switch(this.dataType){case d.ANIMATIONTYPE_FLOAT:this._offsetsCache[p]=n-l;break;case d.ANIMATIONTYPE_QUATERNION:this._offsetsCache[p]=n.subtract(l);break;case d.ANIMATIONTYPE_VECTOR3:this._offsetsCache[p]=n.subtract(l);case d.ANIMATIONTYPE_VECTOR2:this._offsetsCache[p]=n.subtract(l);case d.ANIMATIONTYPE_SIZE:this._offsetsCache[p]=n.subtract(l);
case d.ANIMATIONTYPE_COLOR3:this._offsetsCache[p]=n.subtract(l)}this._highLimitsCache[p]=n}n=this._highLimitsCache[p];p=this._offsetsCache[p]}if(void 0===p)switch(this.dataType){case d.ANIMATIONTYPE_FLOAT:p=0;break;case d.ANIMATIONTYPE_QUATERNION:p=new b.Quaternion(0,0,0,0);break;case d.ANIMATIONTYPE_VECTOR3:p=b.Vector3.Zero();break;case d.ANIMATIONTYPE_VECTOR2:p=b.Vector2.Zero();break;case d.ANIMATIONTYPE_SIZE:p=b.Size.Zero();break;case d.ANIMATIONTYPE_COLOR3:p=b.Color3.Black()}e=q?e+c%r:f;r=this._interpolate(e,
c/r>>0,this.loopMode,p,n);this.setValue(r);for(r=0;r<this._events.length;r++)e>=this._events[r].frame?(f=this._events[r],f.isDone||(f.onlyOnce&&(this._events.splice(r,1),r--),f.isDone=!0,f.action())):this._events[r].isDone&&!this._events[r].onlyOnce&&(this._events[r].isDone=!1);return q||(this._stopped=!0),q},d.prototype.serialize=function(){var b={};b.name=this.name;b.property=this.targetProperty;b.framePerSecond=this.framePerSecond;b.dataType=this.dataType;b.loopBehavior=this.loopMode;var c=this.dataType;
b.keys=[];for(var e=this.getKeys(),f=0;f<e.length;f++){var n=e[f],q={};switch(q.frame=n.frame,c){case d.ANIMATIONTYPE_FLOAT:q.values=[n.value];break;case d.ANIMATIONTYPE_QUATERNION:case d.ANIMATIONTYPE_MATRIX:case d.ANIMATIONTYPE_VECTOR3:case d.ANIMATIONTYPE_COLOR3:q.values=n.value.asArray()}b.keys.push(q)}b.ranges=[];for(var p in this._ranges)c={},c.name=p,c.from=this._ranges[p].from,c.to=this._ranges[p].to,b.ranges.push(c);return b},Object.defineProperty(d,"ANIMATIONTYPE_FLOAT",{get:function(){return d._ANIMATIONTYPE_FLOAT},
enumerable:!0,configurable:!0}),Object.defineProperty(d,"ANIMATIONTYPE_VECTOR3",{get:function(){return d._ANIMATIONTYPE_VECTOR3},enumerable:!0,configurable:!0}),Object.defineProperty(d,"ANIMATIONTYPE_VECTOR2",{get:function(){return d._ANIMATIONTYPE_VECTOR2},enumerable:!0,configurable:!0}),Object.defineProperty(d,"ANIMATIONTYPE_SIZE",{get:function(){return d._ANIMATIONTYPE_SIZE},enumerable:!0,configurable:!0}),Object.defineProperty(d,"ANIMATIONTYPE_QUATERNION",{get:function(){return d._ANIMATIONTYPE_QUATERNION},
enumerable:!0,configurable:!0}),Object.defineProperty(d,"ANIMATIONTYPE_MATRIX",{get:function(){return d._ANIMATIONTYPE_MATRIX},enumerable:!0,configurable:!0}),Object.defineProperty(d,"ANIMATIONTYPE_COLOR3",{get:function(){return d._ANIMATIONTYPE_COLOR3},enumerable:!0,configurable:!0}),Object.defineProperty(d,"ANIMATIONLOOPMODE_RELATIVE",{get:function(){return d._ANIMATIONLOOPMODE_RELATIVE},enumerable:!0,configurable:!0}),Object.defineProperty(d,"ANIMATIONLOOPMODE_CYCLE",{get:function(){return d._ANIMATIONLOOPMODE_CYCLE},
enumerable:!0,configurable:!0}),Object.defineProperty(d,"ANIMATIONLOOPMODE_CONSTANT",{get:function(){return d._ANIMATIONLOOPMODE_CONSTANT},enumerable:!0,configurable:!0}),d.Parse=function(c){var e,f,l=new d(c.name,c.property,c.framePerSecond,c.dataType,c.loopBehavior),n=c.dataType,q=[];for(f=0;f<c.keys.length;f++){var p=c.keys[f];switch(n){case d.ANIMATIONTYPE_FLOAT:e=p.values[0];break;case d.ANIMATIONTYPE_QUATERNION:e=b.Quaternion.FromArray(p.values);break;case d.ANIMATIONTYPE_MATRIX:e=b.Matrix.FromArray(p.values);
break;case d.ANIMATIONTYPE_COLOR3:e=b.Color3.FromArray(p.values);break;default:e=b.Vector3.FromArray(p.values)}q.push({frame:p.frame,value:e})}if(l.setKeys(q),c.ranges)for(f=0;f<c.ranges.length;f++)e=c.ranges[f],l.createRange(e.name,e.from,e.to);return l},d.AppendSerializedAnimations=function(b,c){if(b.animations){c.animations=[];for(var d=0;d<b.animations.length;d++)c.animations.push(b.animations[d].serialize())}},d._ANIMATIONTYPE_FLOAT=0,d._ANIMATIONTYPE_VECTOR3=1,d._ANIMATIONTYPE_QUATERNION=2,
d._ANIMATIONTYPE_MATRIX=3,d._ANIMATIONTYPE_COLOR3=4,d._ANIMATIONTYPE_VECTOR2=5,d._ANIMATIONTYPE_SIZE=6,d._ANIMATIONLOOPMODE_RELATIVE=0,d._ANIMATIONLOOPMODE_CYCLE=1,d._ANIMATIONLOOPMODE_CONSTANT=2,d);b.Animation=c}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(b,c,d,g,f,j,l,n){void 0===d&&(d=0);void 0===g&&(g=100);void 0===f&&(f=!1);void 0===j&&(j=1);this.target=c;this.fromFrame=d;this.toFrame=g;this.loopAnimation=f;this.speedRatio=j;this.onAnimationEnd=l;this._animations=[];this.animationStarted=this._paused=!1;n&&this.appendAnimations(c,n);this._scene=b;b._activeAnimatables.push(this)};f=(f.prototype.getAnimations=function(){return this._animations},f.prototype.appendAnimations=function(b,c){for(var d=0;d<c.length;d++){var g=
c[d];g._target=b;this._animations.push(g)}},f.prototype.getAnimationByTargetProperty=function(b){for(var c=this._animations,d=0;d<c.length;d++)if(c[d].targetProperty===b)return c[d];return null},f.prototype.reset=function(){for(var b=this._animations,c=0;c<b.length;c++)b[c].reset();this._pausedDelay=this._localDelayOffset=null},f.prototype.enableBlending=function(b){for(var c=this._animations,d=0;d<c.length;d++)c[d].enableBlending=!0,c[d].blendingSpeed=b},f.prototype.disableBlending=function(){for(var b=
this._animations,c=0;c<b.length;c++)b[c].enableBlending=!1},f.prototype.goToFrame=function(b){for(var c=this._animations,d=0;d<c.length;d++)c[d].goToFrame(b)},f.prototype.pause=function(){this._paused||(this._paused=!0)},f.prototype.restart=function(){this._paused=!1},f.prototype.stop=function(){var b=this._scene._activeAnimatables.indexOf(this);if(-1<b){this._scene._activeAnimatables.splice(b,1);for(var c=this._animations,b=0;b<c.length;b++)c[b].reset();this.onAnimationEnd&&this.onAnimationEnd()}},
f.prototype._animate=function(b){if(this._paused)return this.animationStarted=!1,this._pausedDelay||(this._pausedDelay=b),!0;this._localDelayOffset?this._pausedDelay&&(this._localDelayOffset+=b-this._pausedDelay,this._pausedDelay=null):this._localDelayOffset=b;var c,d=!1,g=this._animations;for(c=0;c<g.length;c++)var f=g[c].animate(b-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this.speedRatio),d=d||f;return this.animationStarted=d,d||(c=this._scene._activeAnimatables.indexOf(this),
this._scene._activeAnimatables.splice(c,1)),!d&&this.onAnimationEnd&&(this.onAnimationEnd(),this.onAnimationEnd=null),d},f);b.Animatable=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(){this._easingMode=e.EASINGMODE_EASEIN};f=(Object.defineProperty(e,"EASINGMODE_EASEIN",{get:function(){return e._EASINGMODE_EASEIN},enumerable:!0,configurable:!0}),Object.defineProperty(e,"EASINGMODE_EASEOUT",{get:function(){return e._EASINGMODE_EASEOUT},enumerable:!0,configurable:!0}),Object.defineProperty(e,"EASINGMODE_EASEINOUT",{get:function(){return e._EASINGMODE_EASEINOUT},enumerable:!0,configurable:!0}),e.prototype.setEasingMode=function(b){this._easingMode=Math.min(Math.max(b,
0),2)},e.prototype.getEasingMode=function(){return this._easingMode},e.prototype.easeInCore=function(){throw Error("You must implement this method");},e.prototype.ease=function(b){switch(this._easingMode){case e.EASINGMODE_EASEIN:return this.easeInCore(b);case e.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-b)}return 0.5<=b?0.5*(1-this.easeInCore(2*(1-b)))+0.5:0.5*this.easeInCore(2*b)},e._EASINGMODE_EASEIN=0,e._EASINGMODE_EASEOUT=1,e._EASINGMODE_EASEINOUT=2,e);b.EasingFunction=f;var c;c=function(){f.apply(this,
arguments)};c=(__extends(c,f),c.prototype.easeInCore=function(b){return b=Math.max(0,Math.min(1,b)),1-Math.sqrt(1-b*b)},c);b.CircleEase=c;c=function(b){void 0===b&&(b=1);f.call(this);this.amplitude=b};c=(__extends(c,f),c.prototype.easeInCore=function(b){var c=Math.max(0,this.amplitude);return Math.pow(b,3)-b*c*Math.sin(3.141592653589793*b)},c);b.BackEase=c;c=function(b,c){void 0===b&&(b=3);void 0===c&&(c=2);f.call(this);this.bounces=b;this.bounciness=c};c=(__extends(c,f),c.prototype.easeInCore=function(b){var c=
Math.max(0,this.bounces),e=this.bounciness;1>=e&&(e=1.001);var f=Math.pow(e,c),l=1-e,n=(1-f)/l+0.5*f,f=Math.log(-(b*n)*(1-e)+1)/Math.log(e),f=Math.floor(f),q=f+1,p=(1-Math.pow(e,f))/(l*n),l=(1-Math.pow(e,q))/(l*n),l=0.5*(p+l);b-=l;p=l-p;return-Math.pow(1/e,c-f)/(p*p)*(b-p)*(b+p)},c);b.BounceEase=c;c=function(){f.apply(this,arguments)};c=(__extends(c,f),c.prototype.easeInCore=function(b){return b*b*b},c);b.CubicEase=c;c=function(b,c){void 0===b&&(b=3);void 0===c&&(c=3);f.call(this);this.oscillations=
b;this.springiness=c};c=(__extends(c,f),c.prototype.easeInCore=function(b){var c,e=Math.max(0,this.oscillations),f=Math.max(0,this.springiness);return c=0==f?b:(Math.exp(f*b)-1)/(Math.exp(f)-1),c*Math.sin((6.283185307179586*e+1.5707963267948966)*b)},c);b.ElasticEase=c;c=function(b){void 0===b&&(b=2);f.call(this);this.exponent=b};c=(__extends(c,f),c.prototype.easeInCore=function(b){return 0>=this.exponent?b:(Math.exp(this.exponent*b)-1)/(Math.exp(this.exponent)-1)},c);b.ExponentialEase=c;c=function(b){void 0===
b&&(b=2);f.call(this);this.power=b};c=(__extends(c,f),c.prototype.easeInCore=function(b){var c=Math.max(0,this.power);return Math.pow(b,c)},c);b.PowerEase=c;c=function(){f.apply(this,arguments)};c=(__extends(c,f),c.prototype.easeInCore=function(b){return b*b},c);b.QuadraticEase=c;c=function(){f.apply(this,arguments)};c=(__extends(c,f),c.prototype.easeInCore=function(b){return b*b*b*b},c);b.QuarticEase=c;c=function(){f.apply(this,arguments)};c=(__extends(c,f),c.prototype.easeInCore=function(b){return b*
b*b*b*b},c);b.QuinticEase=c;c=function(){f.apply(this,arguments)};c=(__extends(c,f),c.prototype.easeInCore=function(b){return 1-Math.sin(1.5707963267948966*(1-b))},c);b.SineEase=c;c=function(b,c,e,j){void 0===b&&(b=0);void 0===c&&(c=0);void 0===e&&(e=1);void 0===j&&(j=1);f.call(this);this.x1=b;this.y1=c;this.x2=e;this.y2=j};c=(__extends(c,f),c.prototype.easeInCore=function(c){return b.BezierCurve.interpolate(c,this.x1,this.y1,this.x2,this.y2)},c);b.BezierCurveEase=c}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.Node;f=function(c,d,g,f,j){e.call(this,c,d.getScene());this.name=c;this.children=[];this.animations=[];this._worldTransform=new b.Matrix;this._absoluteTransform=new b.Matrix;this._invertedAbsoluteTransform=new b.Matrix;this._skeleton=d;this._baseMatrix=this._matrix=f;this._restPose=j?j:f.clone();d.bones.push(this);g?(this._parent=g,g.children.push(this)):this._parent=null;this._updateDifferenceMatrix()};f=(__extends(f,e),f.prototype.getParent=function(){return this._parent},
f.prototype.getLocalMatrix=function(){return this._matrix},f.prototype.getBaseMatrix=function(){return this._baseMatrix},f.prototype.getRestPose=function(){return this._restPose},f.prototype.returnToRest=function(){this.updateMatrix(this._restPose.clone())},f.prototype.getWorldMatrix=function(){return this._worldTransform},f.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},f.prototype.getAbsoluteTransform=function(){return this._absoluteTransform},f.prototype.updateMatrix=
function(b){this._baseMatrix=b.clone();this._matrix=b.clone();this._skeleton._markAsDirty();this._updateDifferenceMatrix()},f.prototype._updateDifferenceMatrix=function(b){b||(b=this._baseMatrix);this._parent?b.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(b);this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform);for(b=0;b<this.children.length;b++)this.children[b]._updateDifferenceMatrix()},f.prototype.markAsDirty=function(){this._currentRenderId++;
this._skeleton._markAsDirty()},f.prototype.copyAnimationRange=function(c,d,e,f,j){void 0===f&&(f=!1);void 0===j&&(j=null);0===this.animations.length&&(this.animations.push(new b.Animation(this.name,"_matrix",c.animations[0].framePerSecond,b.Animation.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));var l=c.animations[0].getRange(d);if(!l)return!1;var n,q,p,r=l.from,l=l.to,t=c.animations[0].getKeys(),s=c.length;c=c.getParent();n=this.getParent();c=(s=f&&c&&s&&this.length&&s!==this.length)?
n.length/c.length:null;for(var u=f&&!n&&j&&(1!==j.x||1!==j.y||1!==j.z),x=this.animations[0].getKeys(),y=0,z=t.length;z>y;y++)n=t[y],n.frame>=r&&n.frame<=l&&(f?(p=n.value.clone(),s?(q=p.getTranslation(),p.setTranslation(q.scaleInPlace(c))):u?(q=p.getTranslation(),p.setTranslation(q.multiplyInPlace(j))):p=n.value):p=n.value,x.push({frame:n.frame+e,value:p}));return this.animations[0].createRange(d,r+e,l+e),!0},f);b.Bone=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(c,d,e){this.name=c;this.id=d;this.bones=[];this.needInitialSkinMatrix=!1;this._isDirty=!0;this._meshesWithPoseMatrix=[];this._identity=b.Matrix.Identity();this._ranges={};this.bones=[];this._scene=e;e.skeletons.push(this);this._isDirty=!0};f=(e.prototype.getTransformMatrices=function(b){return this.needInitialSkinMatrix&&b._bonesTransformMatrices?b._bonesTransformMatrices:this._transformMatrices},e.prototype.getScene=function(){return this._scene},e.prototype.toString=
function(b){var d="Name: "+this.name+", nBones: "+this.bones.length;if(d+=", nAnimationRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),b){d+=", Ranges: {";b=!0;for(var e in this._ranges)b&&(d+=", ",b=!1),d+=e;d+="}"}return d},e.prototype.getBoneIndexByName=function(b){for(var d=0,e=this.bones.length;e>d;d++)if(this.bones[d].name===b)return d;return-1},e.prototype.createAnimationRange=function(c,d,e){if(!this._ranges[c]){this._ranges[c]=new b.AnimationRange(c,d,e);for(var f=0,j=this.bones.length;j>
f;f++)this.bones[f].animations[0]&&this.bones[f].animations[0].createRange(c,d,e)}},e.prototype.deleteAnimationRange=function(b,d){void 0===d&&(d=!0);for(var e=0,f=this.bones.length;f>e;e++)this.bones[e].animations[0]&&this.bones[e].animations[0].deleteRange(b,d);this._ranges[b]=void 0},e.prototype.getAnimationRange=function(b){return this._ranges[b]},e.prototype.getAnimationRanges=function(){var b,d=[],e=0;for(b in this._ranges)d[e]=this._ranges[b],e++;return d},e.prototype.copyAnimationRange=function(c,
d,e){if(void 0===e&&(e=!1),this._ranges[d]||!c.getAnimationRange(d))return!1;var f,j,l=!0,n=this._getHighestAnimationFrame()+1,q={},p=c.bones;j=0;for(f=p.length;f>j;j++)q[p[j].name]=p[j];this.bones.length!==p.length&&(b.Tools.Warn("copyAnimationRange: this rig has "+this.bones.length+" bones, while source as "+p.length),l=!1);p=e&&this.dimensionsAtRest&&c.dimensionsAtRest?this.dimensionsAtRest.divide(c.dimensionsAtRest):null;j=0;for(f=this.bones.length;f>j;j++){var r=this.bones[j].name,t=q[r];t?l=
l&&this.bones[j].copyAnimationRange(t,d,n,e,p):(b.Tools.Warn("copyAnimationRange: not same rig, missing source bone "+r),l=!1)}c=c.getAnimationRange(d);return this._ranges[d]=new b.AnimationRange(d,c.from+n,c.to+n),l},e.prototype.returnToRest=function(){for(var b=0;b<this.bones.length;b++)this.bones[b].returnToRest()},e.prototype._getHighestAnimationFrame=function(){for(var b=0,d=0,e=this.bones.length;e>d;d++)if(this.bones[d].animations[0]){var f=this.bones[d].animations[0].getHighestFrame();f>b&&
(b=f)}return b},e.prototype.beginAnimation=function(b,d,e,f){return(b=this.getAnimationRange(b))?this._scene.beginAnimation(this,b.from,b.to,d,e,f):null},e.prototype._markAsDirty=function(){this._isDirty=!0},e.prototype._registerMeshWithPoseMatrix=function(b){this._meshesWithPoseMatrix.push(b)},e.prototype._unregisterMeshWithPoseMatrix=function(b){b=this._meshesWithPoseMatrix.indexOf(b);-1<b&&this._meshesWithPoseMatrix.splice(b,1)},e.prototype._computeTransformMatrices=function(b,d){for(var e=0;e<
this.bones.length;e++){var f=this.bones[e],j=f.getParent();j?f.getLocalMatrix().multiplyToRef(j.getWorldMatrix(),f.getWorldMatrix()):d?f.getLocalMatrix().multiplyToRef(d,f.getWorldMatrix()):f.getWorldMatrix().copyFrom(f.getLocalMatrix());f.getInvertedAbsoluteTransform().multiplyToArray(f.getWorldMatrix(),b,16*e)}this._identity.copyToArray(b,16*this.bones.length)},e.prototype.prepare=function(){if(this._isDirty){if(this.needInitialSkinMatrix)for(var c=0;c<this._meshesWithPoseMatrix.length;c++){var d=
this._meshesWithPoseMatrix[c];d._bonesTransformMatrices&&d._bonesTransformMatrices.length===16*(this.bones.length+1)||(d._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)));for(var e=d.getPoseMatrix(),f=0;f<this.bones.length;f++){var j=this.bones[f];j.getParent()||(j.getBaseMatrix().multiplyToRef(e,b.Tmp.Matrix[0]),j._updateDifferenceMatrix(b.Tmp.Matrix[0]))}this._computeTransformMatrices(d._bonesTransformMatrices,e)}else this._transformMatrices&&this._transformMatrices.length===16*
(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1))),this._computeTransformMatrices(this._transformMatrices,null);this._isDirty=!1;this._scene._activeBones+=this.bones.length}},e.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(var b=0;b<this.bones.length;b++)this._animatables.push(this.bones[b])}return this._animatables},e.prototype.clone=function(c,d){var g=new e(c,d||c,this._scene);
g.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var f=0;f<this.bones.length;f++){var j=this.bones[f],l=null;j.getParent()&&(l=this.bones.indexOf(j.getParent()),l=g.bones[l]);l=new b.Bone(j.name,g,l,j.getBaseMatrix().clone(),j.getRestPose().clone());b.Tools.DeepCopy(j.animations,l.animations)}if(this._ranges){g._ranges={};for(var n in this._ranges)g._ranges[n]=this._ranges[n].clone()}return this._isDirty=!0,g},e.prototype.enableBlending=function(b){void 0===b&&(b=0.01);this.bones.forEach(function(d){d.animations.forEach(function(d){d.enableBlending=
!0;d.blendingSpeed=b})})},e.prototype.dispose=function(){this._meshesWithPoseMatrix=[];this.getScene().stopAnimation(this);this.getScene().removeSkeleton(this)},e.prototype.serialize=function(){var b={};b.name=this.name;b.id=this.id;b.dimensionsAtRest=this.dimensionsAtRest;b.bones=[];b.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var d=0;d<this.bones.length;d++){var e=this.bones[d],f={parentBoneIndex:e.getParent()?this.bones.indexOf(e.getParent()):-1,name:e.name,matrix:e.getLocalMatrix().toArray(),
rest:e.getRestPose().toArray()};b.bones.push(f);e.length&&(f.length=e.length);e.animations&&0<e.animations.length&&(f.animation=e.animations[0].serialize());b.ranges=[];for(var j in this._ranges)e={},e.name=j,e.from=this._ranges[j].from,e.to=this._ranges[j].to,b.ranges.push(e)}return b},e.Parse=function(c,d){var g=new e(c.name,c.id,d);c.dimensionsAtRest&&(g.dimensionsAtRest=b.Vector3.FromArray(c.dimensionsAtRest));g.needInitialSkinMatrix=c.needInitialSkinMatrix;var f;for(f=0;f<c.bones.length;f++){var j=
c.bones[f],l=null;-1<j.parentBoneIndex&&(l=g.bones[j.parentBoneIndex]);var n=j.rest?b.Matrix.FromArray(j.rest):null,l=new b.Bone(j.name,g,l,b.Matrix.FromArray(j.matrix),n);j.length&&(l.length=j.length);j.animation&&l.animations.push(b.Animation.Parse(j.animation))}if(c.ranges)for(f=0;f<c.ranges.length;f++)j=c.ranges[f],g.createAnimationRange(j.name,j.from,j.to);return g},e);b.Skeleton=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(e,c,d,g,f,j,l,n,q,p,r){void 0===l&&(l=b.Texture.NEAREST_SAMPLINGMODE);void 0===r&&(r=b.Engine.TEXTURETYPE_UNSIGNED_INT);this.name=e;this.height=this.width=-1;this._reusable=this.enablePixelPerfectMode=!1;this._textures=new b.SmartArray(2);this._currentRenderTextureInd=0;this._scaleRatio=new b.Vector2(1,1);this.onActivateObservable=new b.Observable;this.onSizeChangedObservable=new b.Observable;this.onApplyObservable=new b.Observable;this.onBeforeRenderObservable=new b.Observable;
this.onAfterRenderObservable=new b.Observable;null!=j?(this._camera=j,this._scene=j.getScene(),j.attachPostProcess(this),this._engine=this._scene.getEngine()):this._engine=n;this._options=f;this.renderTargetSamplingMode=l?l:b.Texture.NEAREST_SAMPLINGMODE;this._reusable=q||!1;this._textureType=r;this._samplers=g||[];this._samplers.push("textureSampler");this._fragmentUrl=c;this._parameters=d||[];this._parameters.push("scale");this.updateEffect(p)};f=(Object.defineProperty(f.prototype,"onActivate",
{set:function(b){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver);this._onActivateObserver=this.onActivateObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"onSizeChanged",{set:function(b){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver);this._onSizeChangedObserver=this.onSizeChangedObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"onApply",{set:function(b){this._onApplyObserver&&
this.onApplyObservable.remove(this._onApplyObserver);this._onApplyObserver=this.onApplyObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"onBeforeRender",{set:function(b){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver);this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"onAfterRender",{set:function(b){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver);
this._onAfterRenderObserver=this.onAfterRenderObservable.add(b)},enumerable:!0,configurable:!0}),f.prototype.updateEffect=function(b){this._effect=this._engine.createEffect({vertex:"postprocess",fragment:this._fragmentUrl},["position"],this._parameters,this._samplers,void 0!==b?b:"")},f.prototype.isReusable=function(){return this._reusable},f.prototype.markTextureDirty=function(){this.width=-1},f.prototype.activate=function(e,c){e=e||this._camera;var d=e.getScene(),g=e.getEngine().getCaps().maxTextureSize,
f=(c?c._width:this._engine.getRenderingCanvas().width)*this._options|0,j=(c?c._height:this._engine.getRenderingCanvas().height)*this._options|0,l=this._options.width||f,n=this._options.height||j;if(this.renderTargetSamplingMode!==b.Texture.NEAREST_SAMPLINGMODE&&(this._options.width||(l=b.Tools.GetExponentOfTwo(l,g)),this._options.height||(n=b.Tools.GetExponentOfTwo(n,g))),this.width!==l||this.height!==n){if(0<this._textures.length){for(g=0;g<this._textures.length;g++)this._engine._releaseTexture(this._textures.data[g]);
this._textures.reset()}this.width=l;this.height=n;this._textures.push(this._engine.createRenderTargetTexture({width:this.width,height:this.height},{generateMipMaps:!1,generateDepthBuffer:0===e._postProcesses.indexOf(this),samplingMode:this.renderTargetSamplingMode,type:this._textureType}));this._reusable&&this._textures.push(this._engine.createRenderTargetTexture({width:this.width,height:this.height},{generateMipMaps:!1,generateDepthBuffer:0===e._postProcesses.indexOf(this),samplingMode:this.renderTargetSamplingMode,
type:this._textureType}));this.onSizeChangedObservable.notifyObservers(this)}this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(f/l,j/n),this._engine.bindFramebuffer(this._textures.data[this._currentRenderTextureInd],0,f,j)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(this._textures.data[this._currentRenderTextureInd]));this.onActivateObservable.notifyObservers(e);this.clearColor?this._engine.clear(this.clearColor,!0,!0):this._engine.clear(d.clearColor,d.autoClear||
d.forceWireframe,!0);this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2)},Object.defineProperty(f.prototype,"isSupported",{get:function(){return this._effect.isSupported},enumerable:!0,configurable:!0}),f.prototype.apply=function(){return this._effect.isReady()?(this._engine.enableEffect(this._effect),this._engine.setState(!1),this._engine.setAlphaMode(b.Engine.ALPHA_DISABLE),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._effect._bindTexture("textureSampler",
this._textures.data[this._currentRenderTextureInd]),this._effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effect),this._effect):null},f.prototype.dispose=function(b){if(b=b||this._camera,0<this._textures.length){for(var c=0;c<this._textures.length;c++)this._engine._releaseTexture(this._textures.data[c]);this._textures.reset()}b&&(b.detachPostProcess(this),0===b._postProcesses.indexOf(this)&&0<b._postProcesses.length&&this._camera._postProcesses[0].markTextureDirty(),
this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear())},f);b.PostProcess=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(b){this._vertexBuffers={};this._scene=b};f=(f.prototype._prepareBuffers=function(){if(!this._vertexBuffers[b.VertexBuffer.PositionKind]){var e=[];e.push(1,1);e.push(-1,1);e.push(-1,-1);e.push(1,-1);this._vertexBuffers[b.VertexBuffer.PositionKind]=new b.VertexBuffer(this._scene.getEngine(),e,b.VertexBuffer.PositionKind,!1,!1,2);e=[];e.push(0);e.push(1);e.push(2);e.push(0);e.push(2);e.push(3);this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)}},f.prototype._prepareFrame=
function(b){var c=this._scene.activeCamera._postProcesses;return 0!==c.length&&this._scene.postProcessesEnabled?(c[0].activate(this._scene.activeCamera,b),!0):!1},f.prototype.directRender=function(b,c){for(var d=this._scene.getEngine(),g=0;g<b.length;g++){g<b.length-1?b[g+1].activate(this._scene.activeCamera,c):c?d.bindFramebuffer(c):d.restoreDefaultFramebuffer();var f=b[g],j=f.apply();j&&(f.onBeforeRenderObservable.notifyObservers(j),this._prepareBuffers(),d.bindBuffers(this._vertexBuffers,this._indexBuffer,
j),d.draw(!0,0,6),f.onAfterRenderObservable.notifyObservers(j))}d.setDepthBuffer(!0);d.setDepthWrite(!0)},f.prototype._finalizeFrame=function(b,c,d,g){if(g=g||this._scene.activeCamera._postProcesses,0!==g.length&&this._scene.postProcessesEnabled){for(var f=this._scene.getEngine(),j=0,l=g.length;l>j&&(l-1>j?g[j+1].activate(this._scene.activeCamera,c):c?f.bindFramebuffer(c,d):f.restoreDefaultFramebuffer(),!b);j++){var n=g[j],q=n.apply();q&&(n.onBeforeRenderObservable.notifyObservers(q),this._prepareBuffers(),
f.bindBuffers(this._vertexBuffers,this._indexBuffer,q),f.draw(!0,0,6),n.onAfterRenderObservable.notifyObservers(q))}f.setDepthBuffer(!0);f.setDepthWrite(!0)}},f.prototype.dispose=function(){var e=this._vertexBuffers[b.VertexBuffer.PositionKind];e&&(e.dispose(),this._vertexBuffers[b.VertexBuffer.PositionKind]=null);this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},f);b.PostProcessManager=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.PostProcess;f=function(b,d,g,f,j,l){e.call(this,b,"pass",null,null,d,g,f,j,l)};f=(__extends(f,e),f);b.PassPostProcess=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(b,c){this.type=b;this.jointData=c;c.nativeParams=c.nativeParams||{}};f=(Object.defineProperty(e.prototype,"physicsJoint",{get:function(){return this._physicsJoint},set:function(b){this._physicsJoint;this._physicsJoint=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"physicsPlugin",{set:function(b){this._physicsPlugin=b},enumerable:!0,configurable:!0}),e.prototype.executeNativeFunction=function(b){b(this._physicsPlugin.world,this._physicsJoint)},e.DistanceJoint=
0,e.HingeJoint=1,e.BallAndSocketJoint=2,e.WheelJoint=3,e.SliderJoint=4,e.PrismaticJoint=5,e.UniversalJoint=6,e.Hinge2Joint=e.WheelJoint,e.PointToPointJoint=8,e.SpringJoint=9,e.LockJoint=10,e);b.PhysicsJoint=f;e=function(b){f.call(this,f.DistanceJoint,b)};e=(__extends(e,f),e.prototype.updateDistance=function(b,c){this._physicsPlugin.updateDistanceJoint(this,b,c)},e);b.DistanceJoint=e;var c,e=function(b,c){f.call(this,b,c)};c=(__extends(e,f),e.prototype.setMotor=function(b,c){this._physicsPlugin.setMotor(this,
b,c)},e.prototype.setLimit=function(b,c){this._physicsPlugin.setLimit(this,b,c)},e);b.MotorEnabledJoint=c;e=function(b){c.call(this,f.HingeJoint,b)};e=(__extends(e,c),e.prototype.setMotor=function(b,c){this._physicsPlugin.setMotor(this,b,c)},e.prototype.setLimit=function(b,c){this._physicsPlugin.setLimit(this,b,c)},e);b.HingeJoint=e;e=function(b){c.call(this,f.Hinge2Joint,b)};e=(__extends(e,c),e.prototype.setMotor=function(b,c,e){void 0===e&&(e=0);this._physicsPlugin.setMotor(this,b,c,e)},e.prototype.setLimit=
function(b,c,e){void 0===e&&(e=0);this._physicsPlugin.setLimit(this,b,c,e)},e);b.Hinge2Joint=e}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(c,d,e,f){var j=this;return void 0===e&&(e={mass:0}),this.object=c,this.type=d,this._options=e,this._scene=f,this._bodyUpdateRequired=!1,this._onBeforePhysicsStepCallbacks=[],this._onAfterPhysicsStepCallbacks=[],this._onPhysicsCollideCallbacks=[],this._deltaPosition=b.Vector3.Zero(),this._tmpPositionWithDelta=b.Vector3.Zero(),this._tmpRotationWithDelta=new b.Quaternion,this.beforeStep=function(){j.object.position.subtractToRef(j._deltaPosition,j._tmpPositionWithDelta);
j._deltaRotationConjugated?j.object.rotationQuaternion.multiplyToRef(j._deltaRotationConjugated,j._tmpRotationWithDelta):j._tmpRotationWithDelta.copyFrom(j.object.rotationQuaternion);j._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(j,j._tmpPositionWithDelta,j._tmpRotationWithDelta);j._onBeforePhysicsStepCallbacks.forEach(function(b){b(j)})},this.afterStep=function(){j._onAfterPhysicsStepCallbacks.forEach(function(b){b(j)});j._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(j);
j.object.position.addInPlace(j._deltaPosition);j._deltaRotation&&j.object.rotationQuaternion.multiplyInPlace(j._deltaRotation)},this.onCollide=function(b){if(j._onPhysicsCollideCallbacks.length){var c=j._physicsEngine.getImpostorWithPhysicsBody(b.body);c&&j._onPhysicsCollideCallbacks.filter(function(b){return-1!==b.otherImpostors.indexOf(c)}).forEach(function(b){b.callback(j,c)})}},this.object?(!this._scene&&c.getScene&&(this._scene=c.getScene()),this._physicsEngine=this._scene.getPhysicsEngine(),
void(this._physicsEngine?(this.object.rotationQuaternion||(this.object.rotation?this.object.rotationQuaternion=b.Quaternion.RotationYawPitchRoll(this.object.rotation.y,this.object.rotation.x,this.object.rotation.z):this.object.rotationQuaternion=new b.Quaternion),this._options.mass=void 0===e.mass?0:e.mass,this._options.friction=void 0===e.friction?0.2:e.friction,this._options.restitution=void 0===e.restitution?0.2:e.restitution,this._joints=[],this.object.parent||this._init()):b.Tools.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))):
void b.Tools.Error("No object was provided. A physics object is obligatory")};f=(e.prototype._init=function(){this._physicsEngine.removeImpostor(this);this.physicsBody=null;this._parent=this._parent||this._getPhysicsParent();this.parent||this._physicsEngine.addImpostor(this)},e.prototype._getPhysicsParent=function(){if(this.object.parent instanceof b.AbstractMesh)return this.object.parent.physicsImpostor},e.prototype.isBodyInitRequired=function(){return this._bodyUpdateRequired||!this._physicsBody&&
!this._parent},e.prototype.setScalingUpdated=function(){this.forceUpdate()},e.prototype.forceUpdate=function(){this._init();this.parent&&this.parent.forceUpdate()},Object.defineProperty(e.prototype,"physicsBody",{get:function(){return this._parent?this._parent.physicsBody:this._physicsBody},set:function(b){this._physicsBody&&this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this);this._physicsBody=b;this.resetUpdateFlags()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,
"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),e.prototype.resetUpdateFlags=function(){this._bodyUpdateRequired=!1},e.prototype.getObjectExtendSize=function(){return this.object.getBoundingInfo?(this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0),this.object.getBoundingInfo().boundingBox.extendSize.scale(2).multiply(this.object.scaling)):e.DEFAULT_OBJECT_SIZE},e.prototype.getObjectCenter=function(){return this.object.getBoundingInfo?this.object.getBoundingInfo().boundingBox.center:
this.object.position},e.prototype.getParam=function(b){return this._options[b]},e.prototype.setParam=function(b,d){this._options[b]=d;this._bodyUpdateRequired=!0},e.prototype.setMass=function(b){this.getParam("mass")!==b&&this.setParam("mass",b);this._physicsEngine.getPhysicsPlugin().setBodyMass(this,b)},e.prototype.getLinearVelocity=function(){return this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this)},e.prototype.setLinearVelocity=function(b){this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this,
b)},e.prototype.getAngularVelocity=function(){return this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this)},e.prototype.setAngularVelocity=function(b){this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this,b)},e.prototype.executeNativeFunction=function(b){b(this._physicsEngine.getPhysicsPlugin().world,this.physicsBody)},e.prototype.registerBeforePhysicsStep=function(b){this._onBeforePhysicsStepCallbacks.push(b)},e.prototype.unregisterBeforePhysicsStep=function(c){c=this._onBeforePhysicsStepCallbacks.indexOf(c);
-1<c?this._onBeforePhysicsStepCallbacks.splice(c,1):b.Tools.Warn("Function to remove was not found")},e.prototype.registerAfterPhysicsStep=function(b){this._onAfterPhysicsStepCallbacks.push(b)},e.prototype.unregisterAfterPhysicsStep=function(c){c=this._onAfterPhysicsStepCallbacks.indexOf(c);-1<c?this._onAfterPhysicsStepCallbacks.splice(c,1):b.Tools.Warn("Function to remove was not found")},e.prototype.registerOnPhysicsCollide=function(b,d){this._onPhysicsCollideCallbacks.push({callback:d,otherImpostors:b instanceof
Array?b:[b]})},e.prototype.unregisterOnPhysicsCollide=function(c,d){var e=this._onPhysicsCollideCallbacks.indexOf({callback:d,otherImpostors:c instanceof Array?c:[c]});-1<e?this._onPhysicsCollideCallbacks.splice(e,1):b.Tools.Warn("Function to remove was not found")},e.prototype.applyForce=function(b,d){this._physicsEngine.getPhysicsPlugin().applyForce(this,b,d)},e.prototype.applyImpulse=function(b,d){this._physicsEngine.getPhysicsPlugin().applyImpulse(this,b,d)},e.prototype.createJoint=function(c,
d,e){d=new b.PhysicsJoint(d,e);this.addJoint(c,d)},e.prototype.addJoint=function(b,d){this._joints.push({otherImpostor:b,joint:d});this._physicsEngine.addJoint(this,b,d)},e.prototype.sleep=function(){this._physicsEngine.getPhysicsPlugin().sleepBody(this)},e.prototype.wakeUp=function(){this._physicsEngine.getPhysicsPlugin().wakeUpBody(this)},e.prototype.clone=function(b){return b?new e(b,this.type,this._options,this._scene):null},e.prototype.dispose=function(){var b=this;this._physicsEngine&&(this._joints.forEach(function(d){b._physicsEngine.removeJoint(b,
d.otherImpostor,d.joint)}),this._physicsEngine.removeImpostor(this),this.parent&&this.parent.forceUpdate())},e.prototype.setDeltaPosition=function(b){this._deltaPosition.copyFrom(b)},e.prototype.setDeltaRotation=function(c){this._deltaRotation||(this._deltaRotation=new b.Quaternion);this._deltaRotation.copyFrom(c);this._deltaRotationConjugated=this._deltaRotation.conjugate()},e.DEFAULT_OBJECT_SIZE=new b.Vector3(1,1,1),e.NoImpostor=0,e.SphereImpostor=1,e.BoxImpostor=2,e.PlaneImpostor=3,e.MeshImpostor=
4,e.CylinderImpostor=7,e.ParticleImpostor=8,e.HeightmapImpostor=9,e);b.PhysicsImpostor=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(e,c){if(void 0===c&&(c=new b.CannonJSPlugin),this._physicsPlugin=c,this._impostors=[],this._joints=[],!this._physicsPlugin.isSupported())throw Error("Physics Engine "+this._physicsPlugin.name+" cannot be found. Please make sure it is included.");e=e||new b.Vector3(0,-9.807,0);this.setGravity(e);this.setTimeStep()};f=(f.prototype.setGravity=function(b){this.gravity=b;this._physicsPlugin.setGravity(this.gravity)},f.prototype.setTimeStep=function(b){void 0===b&&(b=1/60);
this._physicsPlugin.setTimeStep(b)},f.prototype.dispose=function(){this._impostors.forEach(function(b){b.dispose()});this._physicsPlugin.dispose()},f.prototype.getPhysicsPluginName=function(){return this._physicsPlugin.name},f.prototype.addImpostor=function(b){b.uniqueId=this._impostors.push(b);b.parent||this._physicsPlugin.generatePhysicsBody(b)},f.prototype.removeImpostor=function(b){b=this._impostors.indexOf(b);-1<b&&(b=this._impostors.splice(b,1),b.length&&(b[0].physicsBody=null))},f.prototype.addJoint=
function(b,c,d){b={mainImpostor:b,connectedImpostor:c,joint:d};d.physicsPlugin=this._physicsPlugin;this._joints.push(b);this._physicsPlugin.generateJoint(b)},f.prototype.removeJoint=function(b,c,d){var g=this._joints.filter(function(g){return g.connectedImpostor===c&&g.joint===d&&g.mainImpostor===b});g.length&&this._physicsPlugin.removeJoint(g[0])},f.prototype._step=function(b){var c=this;this._impostors.forEach(function(b){b.isBodyInitRequired()&&c._physicsPlugin.generatePhysicsBody(b)});0.1<b?b=
0.1:0>=b&&(b=1/60);this._physicsPlugin.executeStep(b,this._impostors)},f.prototype.getPhysicsPlugin=function(){return this._physicsPlugin},f.prototype.getImpostorForPhysicsObject=function(b){for(var c=0;c<this._impostors.length;++c)if(this._impostors[c].object===b)return this._impostors[c]},f.prototype.getImpostorWithPhysicsBody=function(b){for(var c=0;c<this._impostors.length;++c)if(this._impostors[c].physicsBody===b)return this._impostors[c]},f.NoImpostor=b.PhysicsImpostor.NoImpostor,f.SphereImpostor=
b.PhysicsImpostor.SphereImpostor,f.BoxImpostor=b.PhysicsImpostor.BoxImpostor,f.PlaneImpostor=b.PhysicsImpostor.PlaneImpostor,f.MeshImpostor=b.PhysicsImpostor.MeshImpostor,f.CylinderImpostor=b.PhysicsImpostor.CylinderImpostor,f.HeightmapImpostor=b.PhysicsImpostor.HeightmapImpostor,f.CapsuleImpostor=-1,f.ConeImpostor=-1,f.ConvexHullImpostor=-1,f.Epsilon=0.0010,f);b.PhysicsEngine=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(){};f=(e.prototype.set=function(c,d){switch(d){case b.VertexBuffer.PositionKind:this.positions=c;break;case b.VertexBuffer.NormalKind:this.normals=c;break;case b.VertexBuffer.UVKind:this.uvs=c;break;case b.VertexBuffer.UV2Kind:this.uvs2=c;break;case b.VertexBuffer.UV3Kind:this.uvs3=c;break;case b.VertexBuffer.UV4Kind:this.uvs4=c;break;case b.VertexBuffer.UV5Kind:this.uvs5=c;break;case b.VertexBuffer.UV6Kind:this.uvs6=c;break;case b.VertexBuffer.ColorKind:this.colors=
c;break;case b.VertexBuffer.MatricesIndicesKind:this.matricesIndices=c;break;case b.VertexBuffer.MatricesWeightsKind:this.matricesWeights=c;break;case b.VertexBuffer.MatricesIndicesExtraKind:this.matricesIndicesExtra=c;break;case b.VertexBuffer.MatricesWeightsExtraKind:this.matricesWeightsExtra=c}},e.prototype.applyToMesh=function(b,d){this._applyTo(b,d)},e.prototype.applyToGeometry=function(b,d){this._applyTo(b,d)},e.prototype.updateMesh=function(b){this._update(b)},e.prototype.updateGeometry=function(b){this._update(b)},
e.prototype._applyTo=function(c,d){this.positions&&c.setVerticesData(b.VertexBuffer.PositionKind,this.positions,d);this.normals&&c.setVerticesData(b.VertexBuffer.NormalKind,this.normals,d);this.uvs&&c.setVerticesData(b.VertexBuffer.UVKind,this.uvs,d);this.uvs2&&c.setVerticesData(b.VertexBuffer.UV2Kind,this.uvs2,d);this.uvs3&&c.setVerticesData(b.VertexBuffer.UV3Kind,this.uvs3,d);this.uvs4&&c.setVerticesData(b.VertexBuffer.UV4Kind,this.uvs4,d);this.uvs5&&c.setVerticesData(b.VertexBuffer.UV5Kind,this.uvs5,
d);this.uvs6&&c.setVerticesData(b.VertexBuffer.UV6Kind,this.uvs6,d);this.colors&&c.setVerticesData(b.VertexBuffer.ColorKind,this.colors,d);this.matricesIndices&&c.setVerticesData(b.VertexBuffer.MatricesIndicesKind,this.matricesIndices,d);this.matricesWeights&&c.setVerticesData(b.VertexBuffer.MatricesWeightsKind,this.matricesWeights,d);this.matricesIndicesExtra&&c.setVerticesData(b.VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra,d);this.matricesWeightsExtra&&c.setVerticesData(b.VertexBuffer.MatricesWeightsExtraKind,
this.matricesWeightsExtra,d);this.indices&&c.setIndices(this.indices)},e.prototype._update=function(c,d,e){this.positions&&c.updateVerticesData(b.VertexBuffer.PositionKind,this.positions,d,e);this.normals&&c.updateVerticesData(b.VertexBuffer.NormalKind,this.normals,d,e);this.uvs&&c.updateVerticesData(b.VertexBuffer.UVKind,this.uvs,d,e);this.uvs2&&c.updateVerticesData(b.VertexBuffer.UV2Kind,this.uvs2,d,e);this.uvs3&&c.updateVerticesData(b.VertexBuffer.UV3Kind,this.uvs3,d,e);this.uvs4&&c.updateVerticesData(b.VertexBuffer.UV4Kind,
this.uvs4,d,e);this.uvs5&&c.updateVerticesData(b.VertexBuffer.UV5Kind,this.uvs5,d,e);this.uvs6&&c.updateVerticesData(b.VertexBuffer.UV6Kind,this.uvs6,d,e);this.colors&&c.updateVerticesData(b.VertexBuffer.ColorKind,this.colors,d,e);this.matricesIndices&&c.updateVerticesData(b.VertexBuffer.MatricesIndicesKind,this.matricesIndices,d,e);this.matricesWeights&&c.updateVerticesData(b.VertexBuffer.MatricesWeightsKind,this.matricesWeights,d,e);this.matricesIndicesExtra&&c.updateVerticesData(b.VertexBuffer.MatricesIndicesExtraKind,
this.matricesIndicesExtra,d,e);this.matricesWeightsExtra&&c.updateVerticesData(b.VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra,d,e);this.indices&&c.setIndices(this.indices)},e.prototype.transform=function(c){var d,e=b.Vector3.Zero();if(this.positions){var f=b.Vector3.Zero();for(d=0;d<this.positions.length;d+=3)b.Vector3.FromArrayToRef(this.positions,d,f),b.Vector3.TransformCoordinatesToRef(f,c,e),this.positions[d]=e.x,this.positions[d+1]=e.y,this.positions[d+2]=e.z}if(this.normals){f=
b.Vector3.Zero();for(d=0;d<this.normals.length;d+=3)b.Vector3.FromArrayToRef(this.normals,d,f),b.Vector3.TransformNormalToRef(f,c,e),this.normals[d]=e.x,this.normals[d+1]=e.y,this.normals[d+2]=e.z}},e.prototype.merge=function(b){if(b.indices){this.indices||(this.indices=[]);for(var d=this.positions?this.positions.length/3:0,e=0;e<b.indices.length;e++)this.indices.push(b.indices[e]+d)}this.positions=this._mergeElement(this.positions,b.positions);this.normals=this._mergeElement(this.normals,b.normals);
this.uvs=this._mergeElement(this.uvs,b.uvs);this.uvs2=this._mergeElement(this.uvs2,b.uvs2);this.uvs3=this._mergeElement(this.uvs3,b.uvs3);this.uvs4=this._mergeElement(this.uvs4,b.uvs4);this.uvs5=this._mergeElement(this.uvs5,b.uvs5);this.uvs6=this._mergeElement(this.uvs6,b.uvs6);this.colors=this._mergeElement(this.colors,b.colors);this.matricesIndices=this._mergeElement(this.matricesIndices,b.matricesIndices);this.matricesWeights=this._mergeElement(this.matricesWeights,b.matricesWeights);this.matricesIndicesExtra=
this._mergeElement(this.matricesIndicesExtra,b.matricesIndicesExtra);this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,b.matricesWeightsExtra)},e.prototype._mergeElement=function(b,d){if(!d)return b;if(!b)return d;var e=d.length+b.length,f=d instanceof Float32Array;if(b instanceof Float32Array)return e=new Float32Array(e),e.set(b),e.set(d,b.length),e;if(f){for(var f=b.slice(0),j=0,e=d.length;e>j;j++)f.push(d[j]);return f}return b.concat(d)},e.prototype.serialize=function(){var b=
this.serialize();return this.positions&&(b.positions=this.positions),this.normals&&(b.normals=this.normals),this.uvs&&(b.uvs=this.uvs),this.uvs2&&(b.uvs2=this.uvs2),this.uvs3&&(b.uvs3=this.uvs3),this.uvs4&&(b.uvs4=this.uvs4),this.uvs5&&(b.uvs5=this.uvs5),this.uvs6&&(b.uvs6=this.uvs6),this.colors&&(b.colors=this.colors),this.matricesIndices&&(b.matricesIndices=this.matricesIndices,b.matricesIndices._isExpanded=!0),this.matricesWeights&&(b.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&
(b.matricesIndicesExtra=this.matricesIndicesExtra,b.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(b.matricesWeightsExtra=this.matricesWeightsExtra),b.indices=this.indices,b},e.ExtractFromMesh=function(b,d){return e._ExtractFrom(b,d)},e.ExtractFromGeometry=function(b,d){return e._ExtractFrom(b,d)},e._ExtractFrom=function(c,d){var g=new e;return c.isVerticesDataPresent(b.VertexBuffer.PositionKind)&&(g.positions=c.getVerticesData(b.VertexBuffer.PositionKind,d)),c.isVerticesDataPresent(b.VertexBuffer.NormalKind)&&
(g.normals=c.getVerticesData(b.VertexBuffer.NormalKind,d)),c.isVerticesDataPresent(b.VertexBuffer.UVKind)&&(g.uvs=c.getVerticesData(b.VertexBuffer.UVKind,d)),c.isVerticesDataPresent(b.VertexBuffer.UV2Kind)&&(g.uvs2=c.getVerticesData(b.VertexBuffer.UV2Kind,d)),c.isVerticesDataPresent(b.VertexBuffer.UV3Kind)&&(g.uvs3=c.getVerticesData(b.VertexBuffer.UV3Kind,d)),c.isVerticesDataPresent(b.VertexBuffer.UV4Kind)&&(g.uvs4=c.getVerticesData(b.VertexBuffer.UV4Kind,d)),c.isVerticesDataPresent(b.VertexBuffer.UV5Kind)&&
(g.uvs5=c.getVerticesData(b.VertexBuffer.UV5Kind,d)),c.isVerticesDataPresent(b.VertexBuffer.UV6Kind)&&(g.uvs6=c.getVerticesData(b.VertexBuffer.UV6Kind,d)),c.isVerticesDataPresent(b.VertexBuffer.ColorKind)&&(g.colors=c.getVerticesData(b.VertexBuffer.ColorKind,d)),c.isVerticesDataPresent(b.VertexBuffer.MatricesIndicesKind)&&(g.matricesIndices=c.getVerticesData(b.VertexBuffer.MatricesIndicesKind,d)),c.isVerticesDataPresent(b.VertexBuffer.MatricesWeightsKind)&&(g.matricesWeights=c.getVerticesData(b.VertexBuffer.MatricesWeightsKind,
d)),c.isVerticesDataPresent(b.VertexBuffer.MatricesIndicesExtraKind)&&(g.matricesIndicesExtra=c.getVerticesData(b.VertexBuffer.MatricesIndicesExtraKind,d)),c.isVerticesDataPresent(b.VertexBuffer.MatricesWeightsExtraKind)&&(g.matricesWeightsExtra=c.getVerticesData(b.VertexBuffer.MatricesWeightsExtraKind,d)),g.indices=c.getIndices(d),g},e.CreateRibbon=function(c){var d=c.pathArray,g=c.closeArray||!1,f=c.closePath||!1,j=Math.floor(d[0].length/2),l=c.offset||j,l=l>j?j:Math.floor(l),n,q,p=0===c.sideOrientation?
0:c.sideOrientation||b.Mesh.DEFAULTSIDE;c=[];var j=[],r=[],t=[],s=[],u=[],x=[],y=[],z=[],A=[];if(2>d.length){n=[];var B=[];for(q=0;q<d[0].length-l;q++)n.push(d[0][q]),B.push(d[0][q+l]);d=[n,B]}var C,D,E=0,B=f?1:0;n=d[0].length;for(var I,H,l=0;l<d.length;l++){x[l]=0;s[l]=[0];C=d[l];D=C.length;n=D>n?n:D;for(q=0;D>q;)c.push(C[q].x,C[q].y,C[q].z),0<q&&(I=C[q].subtract(C[q-1]).length(),H=I+x[l],s[l].push(H),x[l]=H),q++;f&&(q--,c.push(C[0].x,C[0].y,C[0].z),I=C[q].subtract(C[0]).length(),H=I+x[l],s[l].push(H),
x[l]=H);z[l]=D+B;A[l]=E;E+=D+B}var F,J,G;for(q=0;n+B>q;q++){y[q]=0;u[q]=[0];for(l=0;l<d.length-1;l++)I=d[l],F=d[l+1],q===n?(J=I[0],G=F[0]):(J=I[q],G=F[q]),I=G.subtract(J).length(),H=I+y[q],u[q].push(H),y[q]=H;g&&(F=d[0],q===n&&(G=F[0]),I=G.subtract(J).length(),H=I+y[q],y[q]=H)}for(l=0;l<d.length;l++)for(q=0;n+B>q;q++)F=s[l][q]/x[l],J=u[q][l]/y[q],t.push(F,J);s=l=0;u=z[l]-1;x=z[l+1]-1;y=x>u?u:x;F=A[1]-A[0];for(g=g?z.length:z.length-1;y>=s&&g>l;)j.push(s,s+F,s+1),j.push(s+F+1,s+1,s+F),s+=1,s===y&&(l++,
l===z.length-1?(F=A[0]-A[l],u=z[l]-1,x=z[0]-1):(F=A[l+1]-A[l],u=z[l]-1,x=z[l+1]-1),s=A[l],y=x>u?u+s:x+s);if(e.ComputeNormals(c,j,r),f)for(l=z=g=0;l<d.length;l++)g=3*A[l],z=l+1<d.length?3*(A[l+1]-1):r.length-3,r[g]=0.5*(r[g]+r[z]),r[g+1]=0.5*(r[g+1]+r[z+1]),r[g+2]=0.5*(r[g+2]+r[z+2]),r[z]=r[g],r[z+1]=r[g+1],r[z+2]=r[g+2];e._ComputeSides(p,c,j,r,t);d=new e;return d.indices=j,d.positions=c,d.normals=r,d.uvs=t,f&&(d._idx=A),d},e.CreateBox=function(c){var d=[new b.Vector3(0,0,1),new b.Vector3(0,0,-1),
new b.Vector3(1,0,0),new b.Vector3(-1,0,0),new b.Vector3(0,1,0),new b.Vector3(0,-1,0)],g=[],f=[],j=[],l=[],n=c.width||c.size||1,q=c.height||c.size||1,p=c.depth||c.size||1,r=0===c.sideOrientation?0:c.sideOrientation||b.Mesh.DEFAULTSIDE,t=c.faceUV||Array(6);c=c.faceColors;for(var s=[],u=0;6>u;u++)void 0===t[u]&&(t[u]=new b.Vector4(0,0,1,1)),c&&void 0===c[u]&&(c[u]=new b.Color4(1,1,1,1));n=new b.Vector3(n/2,q/2,p/2);for(q=0;q<d.length;q++){var p=d[q],u=new b.Vector3(p.y,p.z,p.x),x=b.Vector3.Cross(p,
u),y=f.length/3;g.push(y);g.push(y+1);g.push(y+2);g.push(y);g.push(y+2);g.push(y+3);y=p.subtract(u).subtract(x).multiply(n);f.push(y.x,y.y,y.z);j.push(p.x,p.y,p.z);l.push(t[q].z,t[q].w);c&&s.push(c[q].r,c[q].g,c[q].b,c[q].a);y=p.subtract(u).add(x).multiply(n);f.push(y.x,y.y,y.z);j.push(p.x,p.y,p.z);l.push(t[q].x,t[q].w);c&&s.push(c[q].r,c[q].g,c[q].b,c[q].a);y=p.add(u).add(x).multiply(n);f.push(y.x,y.y,y.z);j.push(p.x,p.y,p.z);l.push(t[q].x,t[q].y);c&&s.push(c[q].r,c[q].g,c[q].b,c[q].a);y=p.add(u).subtract(x).multiply(n);
f.push(y.x,y.y,y.z);j.push(p.x,p.y,p.z);l.push(t[q].z,t[q].y);c&&s.push(c[q].r,c[q].g,c[q].b,c[q].a)}e._ComputeSides(r,f,g,j,l);d=new e;if(d.indices=g,d.positions=f,d.normals=j,d.uvs=l,c)g=r===b.Mesh.DOUBLESIDE?s.concat(s):s,d.colors=g;return d},e.CreateSphere=function(c){var d=c.segments||32,g=0>=c.arc||1<c.arc?1:c.arc||1,f=0>=c.slice?1:c.slice||1,j=0===c.sideOrientation?0:c.sideOrientation||b.Mesh.DEFAULTSIDE;c=new b.Vector3((c.diameterX||c.diameter||1)/2,(c.diameterY||c.diameter||1)/2,(c.diameterZ||
c.diameter||1)/2);for(var l=2+d,n=2*l,d=[],q=[],p=[],r=[],t=0;l>=t;t++){for(var s=t/l,u=s*Math.PI*f,x=0;n>=x;x++){var y=x/n,z=2*(y*Math.PI)*g,A=b.Matrix.RotationZ(-u),z=b.Matrix.RotationY(z),A=b.Vector3.TransformCoordinates(b.Vector3.Up(),A),z=b.Vector3.TransformCoordinates(A,z),A=z.multiply(c),z=z.divide(c).normalize();q.push(A.x,A.y,A.z);p.push(z.x,z.y,z.z);r.push(y,s)}if(0<t){s=q.length/3;for(u=s-2*(n+1);s>u+n+2;u++)d.push(u),d.push(u+1),d.push(u+n+1),d.push(u+n+1),d.push(u+1),d.push(u+n+2)}}e._ComputeSides(j,
q,d,p,r);g=new e;return g.indices=d,g.positions=q,g.normals=p,g.uvs=r,g},e.CreateCylinder=function(c){var d=c.height||2,g=0===c.diameterTop?0:c.diameterTop||c.diameter||1,f=c.diameterBottom||c.diameter||1,j=c.tessellation||24,l=c.subdivisions||1,n=c.hasRings,q=c.enclose,p=0>=c.arc||1<c.arc?1:c.arc||1,r=0===c.sideOrientation?0:c.sideOrientation||b.Mesh.DEFAULTSIDE,t=c.faceUV||Array(3),s=c.faceColors,u=2+(1+(1!==p&&q?2:0))*(n?l:1);for(c=0;u>c;c++)s&&void 0===s[c]&&(s[c]=new b.Color4(1,1,1,1));for(c=
0;u>c;c++)t&&void 0===t[c]&&(t[c]=new b.Vector4(0,0,1,1));var x,y,z,A,B,C=[],D=[],E=[],I=[],H=[],F=2*Math.PI*p/j,J=(f-g)/2/d,G=b.Vector3.Zero(),L=b.Vector3.Zero(),N=b.Vector3.Zero(),R=b.Vector3.Zero(),P=b.Vector3.Zero(),K=b.Axis.Y,O=1,M=1,W=0;for(c=x=0;l>=c;c++){y=c/l;z=(y*(g-f)+f)/2;O=n&&0!==c&&c!==l?2:1;for(B=0;O>B;B++){n&&(M+=B);q&&(M+=2*B);for(A=0;j>=A;A++)x=A*F,G.x=Math.cos(-x)*z,G.y=-d/2+y*d,G.z=Math.sin(-x)*z,0===g&&c===l?(L.x=E[E.length-3*(j+1)],L.y=E[E.length-3*(j+1)+1],L.z=E[E.length-3*
(j+1)+2]):(L.x=G.x,L.z=G.z,L.y=Math.sqrt(L.x*L.x+L.z*L.z)*J,L.normalize()),0===A&&(N.copyFrom(G),R.copyFrom(L)),D.push(G.x,G.y,G.z),E.push(L.x,L.y,L.z),x=n?W!==M?t[M].y:t[M].w:t[M].y+(t[M].w-t[M].y)*y,I.push(t[M].x+(t[M].z-t[M].x)*A/j,x),s&&H.push(s[M].r,s[M].g,s[M].b,s[M].a);1!==p&&q&&(D.push(G.x,G.y,G.z),D.push(0,G.y,0),D.push(0,G.y,0),D.push(N.x,N.y,N.z),b.Vector3.CrossToRef(K,L,P),P.normalize(),E.push(P.x,P.y,P.z,P.x,P.y,P.z),b.Vector3.CrossToRef(R,K,P),P.normalize(),E.push(P.x,P.y,P.z,P.x,P.y,
P.z),x=n?W!==M?t[M+1].y:t[M+1].w:t[M+1].y+(t[M+1].w-t[M+1].y)*y,I.push(t[M+1].x,x),I.push(t[M+1].z,x),x=n?W!==M?t[M+2].y:t[M+2].w:t[M+2].y+(t[M+2].w-t[M+2].y)*y,I.push(t[M+2].x,x),I.push(t[M+2].z,x),s&&(H.push(s[M+1].r,s[M+1].g,s[M+1].b,s[M+1].a),H.push(s[M+1].r,s[M+1].g,s[M+1].b,s[M+1].a),H.push(s[M+2].r,s[M+2].g,s[M+2].b,s[M+2].a),H.push(s[M+2].r,s[M+2].g,s[M+2].b,s[M+2].a)));W!==M&&(W=M)}}y=1!==p&&q?j+4:j;for(M=c=0;l>M;M++){for(A=0;j>A;A++){var Ga=c*(y+1)+A,qa=(c+1)*(y+1)+A,fa=c*(y+1)+(A+1),Ba=
(c+1)*(y+1)+(A+1);C.push(Ga,qa,fa);C.push(Ba,fa,qa)}1!==p&&q&&(C.push(Ga+2,qa+2,fa+2),C.push(Ba+2,fa+2,qa+2),C.push(Ga+4,qa+4,fa+4),C.push(Ba+4,fa+4,qa+4));c=n?c+2:c+1}l=function(c){var e=c?g/2:f/2;if(0!==e){var l,n,q,r=c?t[u-1]:t[0];s&&(q=c?s[u-1]:s[0]);var x=D.length/3,y=c?d/2:-d/2;n=new b.Vector3(0,y,0);D.push(n.x,n.y,n.z);E.push(0,c?1:-1,0);I.push(r.x+0.5*(r.z-r.x),r.y+0.5*(r.w-r.y));s&&H.push(q.r,q.g,q.b,q.a);var z=new b.Vector2(0.5,0.5);for(n=0;j>=n;n++){l=2*Math.PI*n*p/j;var A=Math.cos(-l),
B=Math.sin(-l);l=new b.Vector3(A*e,y,B*e);A=new b.Vector2(A*z.x+0.5,B*z.y+0.5);D.push(l.x,l.y,l.z);E.push(0,c?1:-1,0);I.push(r.x+(r.z-r.x)*A.x,r.y+(r.w-r.y)*A.y);s&&H.push(q.r,q.g,q.b,q.a)}for(n=0;j>n;n++)c?(C.push(x),C.push(x+(n+2)),C.push(x+(n+1))):(C.push(x),C.push(x+(n+1)),C.push(x+(n+2)))}};l(!1);l(!0);e._ComputeSides(r,D,C,E,I);r=new e;return r.indices=C,r.positions=D,r.normals=E,r.uvs=I,s&&(r.colors=H),r},e.CreateTorus=function(c){var d=[],g=[],f=[],j=[],l=c.diameter||1,n=c.thickness||0.5,
q=c.tessellation||16;c=0===c.sideOrientation?0:c.sideOrientation||b.Mesh.DEFAULTSIDE;for(var p=q+1,r=0;q>=r;r++)for(var t=r/q,s=2*r*Math.PI/q-Math.PI/2,s=b.Matrix.Translation(l/2,0,0).multiply(b.Matrix.RotationY(s)),u=0;q>=u;u++){var x=1-u/q,y=2*u*Math.PI/q+Math.PI,z=Math.cos(y),y=Math.sin(y),z=new b.Vector3(z,y,0),y=z.scale(n/2),x=new b.Vector2(t,x),y=b.Vector3.TransformCoordinates(y,s),z=b.Vector3.TransformNormal(z,s);g.push(y.x,y.y,y.z);f.push(z.x,z.y,z.z);j.push(x.x,x.y);x=(r+1)%p;z=(u+1)%p;d.push(r*
p+u);d.push(r*p+z);d.push(x*p+u);d.push(r*p+z);d.push(x*p+z);d.push(x*p+u)}e._ComputeSides(c,g,d,f,j);l=new e;return l.indices=d,l.positions=g,l.normals=f,l.uvs=j,l},e.CreateLineSystem=function(b){var d=[],g=[];b=b.lines;for(var f=0,j=0;j<b.length;j++)for(var l=b[j],n=0;n<l.length;n++)g.push(l[n].x,l[n].y,l[n].z),0<n&&(d.push(f-1),d.push(f)),f++;b=new e;return b.indices=d,b.positions=g,b},e.CreateDashedLines=function(c){var d=c.dashSize||3,g=c.gapSize||1,f=c.dashNb||200,j=c.points;c=[];for(var l=
[],n=b.Vector3.Zero(),q=0,p=0,r=0,t=0,s=0,u=0,x=0,x=0;x<j.length-1;x++)j[x+1].subtractToRef(j[x],n),q+=n.length();r=q/f;t=d*r/(d+g);for(x=0;x<j.length-1;x++){j[x+1].subtractToRef(j[x],n);p=Math.floor(n.length()/r);n.normalize();for(d=0;p>d;d++)s=r*d,c.push(j[x].x+s*n.x,j[x].y+s*n.y,j[x].z+s*n.z),c.push(j[x].x+(s+t)*n.x,j[x].y+(s+t)*n.y,j[x].z+(s+t)*n.z),l.push(u,u+1),u+=2}d=new e;return d.positions=c,d.indices=l,d},e.CreateGround=function(c){var d,g=[],f=[],j=[],l=[],n=c.width||1,q=c.height||1,p=
c.subdivisions||1;for(c=0;p>=c;c++)for(d=0;p>=d;d++){var r=new b.Vector3(d*n/p-n/2,0,(p-c)*q/p-q/2),t=new b.Vector3(0,1,0);f.push(r.x,r.y,r.z);j.push(t.x,t.y,t.z);l.push(d/p,1-c/p)}for(c=0;p>c;c++)for(d=0;p>d;d++)g.push(d+1+(c+1)*(p+1)),g.push(d+1+c*(p+1)),g.push(d+c*(p+1)),g.push(d+(c+1)*(p+1)),g.push(d+1+(c+1)*(p+1)),g.push(d+c*(p+1));n=new e;return n.indices=g,n.positions=f,n.normals=j,n.uvs=l,n},e.CreateTiledGround=function(c){var d,g,f,j,l=c.xmin,n=c.zmin,q=c.xmax;d=c.zmax;var p=c.subdivisions||
{w:1,h:1},r=c.precision||{w:1,h:1};c=[];var t=[],s=[],u=[];p.h=1>p.w?1:p.h;p.w=1>p.w?1:p.w;r.w=1>r.w?1:r.w;r.h=1>r.h?1:r.h;var q=(q-l)/p.w,x=(d-n)/p.h;for(f=0;f<p.h;f++)for(j=0;j<p.w;j++){var y=l+j*q,z=n+f*x,A=l+(j+1)*q,B=n+(f+1)*x,C=t.length/3,D=r.w+1;for(d=0;d<r.h;d++)for(g=0;g<r.w;g++){var E=[C+g+d*D,C+(g+1)+d*D,C+(g+1)+(d+1)*D,C+g+(d+1)*D];c.push(E[1]);c.push(E[2]);c.push(E[3]);c.push(E[0]);c.push(E[1]);c.push(E[3])}C=b.Vector3.Zero();D=new b.Vector3(0,1,0);for(d=0;d<=r.h;d++){C.z=d*(B-z)/r.h+
z;for(g=0;g<=r.w;g++)C.x=g*(A-y)/r.w+y,C.y=0,t.push(C.x,C.y,C.z),s.push(D.x,D.y,D.z),u.push(g/r.w,d/r.h)}}l=new e;return l.indices=c,l.positions=t,l.normals=s,l.uvs=u,l},e.CreateGroundFromHeightMap=function(c){var d,g,f=[],j=[],l=[],n=[];for(d=0;d<=c.subdivisions;d++)for(g=0;g<=c.subdivisions;g++){var q=new b.Vector3(g*c.width/c.subdivisions-c.width/2,0,(c.subdivisions-d)*c.height/c.subdivisions-c.height/2),p=4*(((q.x+c.width/2)/c.width*(c.bufferWidth-1)|0)+((1-(q.z+c.height/2)/c.height)*(c.bufferHeight-
1)|0)*c.bufferWidth);q.y=c.minHeight+(c.maxHeight-c.minHeight)*(0.3*(c.buffer[p]/255)+0.59*(c.buffer[p+1]/255)+0.11*(c.buffer[p+2]/255));j.push(q.x,q.y,q.z);l.push(0,0,0);n.push(g/c.subdivisions,1-d/c.subdivisions)}for(d=0;d<c.subdivisions;d++)for(g=0;g<c.subdivisions;g++)f.push(g+1+(d+1)*(c.subdivisions+1)),f.push(g+1+d*(c.subdivisions+1)),f.push(g+d*(c.subdivisions+1)),f.push(g+(d+1)*(c.subdivisions+1)),f.push(g+1+(d+1)*(c.subdivisions+1)),f.push(g+d*(c.subdivisions+1));e.ComputeNormals(j,f,l);
c=new e;return c.indices=f,c.positions=j,c.normals=l,c.uvs=n,c},e.CreatePlane=function(c){var d=[],g=[],f=[],j=[],l=0===c.sideOrientation?0:c.sideOrientation||b.Mesh.DEFAULTSIDE,n=(c.width||c.size||1)/2;c=(c.height||c.size||1)/2;g.push(-n,-c,0);f.push(0,0,-1);j.push(0,0);g.push(n,-c,0);f.push(0,0,-1);j.push(1,0);g.push(n,c,0);f.push(0,0,-1);j.push(1,1);g.push(-n,c,0);f.push(0,0,-1);j.push(0,1);d.push(0);d.push(1);d.push(2);d.push(0);d.push(2);d.push(3);e._ComputeSides(l,g,d,f,j);l=new e;return l.indices=
d,l.positions=g,l.normals=f,l.uvs=j,l},e.CreateDisc=function(c){var d=[],g=[],f=[],j=[],l=c.radius||0.5,n=c.tessellation||64,q=0>=c.arc||1<c.arc?1:c.arc||1;c=0===c.sideOrientation?0:c.sideOrientation||b.Mesh.DEFAULTSIDE;d.push(0,0,0);j.push(0.5,0.5);for(var p=2*Math.PI*q,n=p/n,r=0;p>r;r+=n){var t=Math.cos(r),s=Math.sin(r),u=(t+1)/2,x=(1-s)/2;d.push(l*t,l*s,0);j.push(u,x)}1===q&&(d.push(d[3],d[4],d[5]),j.push(j[2],j[3]));l=d.length/3;for(q=1;l-1>q;q++)g.push(q+1,0,q);e.ComputeNormals(d,g,f);e._ComputeSides(c,
d,g,f,j);c=new e;return c.indices=g,c.positions=d,c.normals=f,c.uvs=j,c},e.CreateIcoSphere=function(c){var d,g=c.sideOrientation||b.Mesh.DEFAULTSIDE,f=c.radius||1,j=void 0===c.flat?!0:c.flat,l=c.subdivisions||4,n=c.radiusX||f,q=c.radiusY||f,p=c.radiusZ||f;c=(1+Math.sqrt(5))/2;c=[-1,c,-0,1,c,0,-1,-c,0,1,-c,0,0,-1,-c,0,1,-c,0,-1,c,0,1,c,c,0,1,c,0,-1,-c,0,1,-c,0,-1];var r=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,
22,19,6,18,9,8,1],t=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],s=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],u=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],x=[],y=[],z=[],A=[],B=0,C=Array(3),D=Array(3);for(d=0;3>d;d++)C[d]=b.Vector3.Zero(),D[d]=b.Vector2.Zero();for(var E=0;20>E;E++){for(d=0;3>d;d++){var I=r[3*E+d];C[d].copyFromFloats(c[3*t[I]],c[3*t[I]+1],c[3*t[I]+2]);C[d].normalize().scaleInPlace(f);D[d].copyFromFloats(0.134765625*s[2*
I]+0.05859375+-0.0390625*u[E],0.2333984375*s[2*I+1]+0.025390625+0.01953125*u[E])}d=function(c,d,e,g){var f=b.Vector3.Lerp(C[0],C[2],d/l),m=b.Vector3.Lerp(C[1],C[2],d/l),f=l===d?C[2]:b.Vector3.Lerp(f,m,c/(l-d));f.normalize();if(j){var m=b.Vector3.Lerp(C[0],C[2],g/l),r=b.Vector3.Lerp(C[1],C[2],g/l);e=b.Vector3.Lerp(m,r,e/(l-g))}else e=new b.Vector3(f.x,f.y,f.z);e.x/=n;e.y/=q;e.z/=p;e.normalize();g=b.Vector2.Lerp(D[0],D[2],d/l);m=b.Vector2.Lerp(D[1],D[2],d/l);c=l===d?D[2]:b.Vector2.Lerp(g,m,c/(l-d));
y.push(f.x*n,f.y*q,f.z*p);z.push(e.x,e.y,e.z);A.push(c.x,c.y);x.push(B);B++};for(I=0;l>I;I++)for(var H=0;l>H+I;H++)d(H,I,H+1/3,I+1/3),d(H+1,I,H+1/3,I+1/3),d(H,I+1,H+1/3,I+1/3),l>H+I+1&&(d(H+1,I,H+2/3,I+2/3),d(H+1,I+1,H+2/3,I+2/3),d(H,I+1,H+2/3,I+2/3))}e._ComputeSides(g,y,x,z,A);g=new e;return g.indices=x,g.positions=y,g.normals=z,g.uvs=A,g},e.CreatePolyhedron=function(c){var d=[{vertex:[[0,0,1.732051],[1.632993,0,-0.5773503],[-0.8164966,1.414214,-0.5773503],[-0.8164966,-1.414214,-0.5773503]],face:[[0,
1,2],[0,2,3],[0,3,1],[1,3,2]]},{vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},{vertex:[[0,0,1.070466],[0.7136442,0,0.7978784],[-0.3568221,0.618034,0.7978784],[-0.3568221,-0.618034,0.7978784],[0.7978784,0.618034,0.3568221],[0.7978784,-0.618034,0.3568221],[-0.9341724,0.381966,0.3568221],[0.1362939,1,0.3568221],[0.1362939,-1,0.3568221],[-0.9341724,-0.381966,0.3568221],[0.9341724,
0.381966,-0.3568221],[0.9341724,-0.381966,-0.3568221],[-0.7978784,0.618034,-0.3568221],[-0.1362939,1,-0.3568221],[-0.1362939,-1,-0.3568221],[-0.7978784,-0.618034,-0.3568221],[0.3568221,0.618034,-0.7978784],[0.3568221,-0.618034,-0.7978784],[-0.7136442,0,-0.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},{vertex:[[0,0,1.175571],[1.051462,0,0.5257311],
[0.3249197,1,0.5257311],[-0.8506508,0.618034,0.5257311],[-0.8506508,-0.618034,0.5257311],[0.3249197,-1,0.5257311],[0.8506508,0.618034,-0.5257311],[0.8506508,-0.618034,-0.5257311],[-0.3249197,1,-0.5257311],[-1.051462,0,-0.5257311],[-0.3249197,-1,-0.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},{vertex:[[0,0,1.070722],[0.7148135,0,0.7971752],[-0.104682,
0.7071068,0.7971752],[-0.6841528,0.2071068,0.7971752],[-0.104682,-0.7071068,0.7971752],[0.6101315,0.7071068,0.5236279],[1.04156,0.2071068,0.1367736],[0.6101315,-0.7071068,0.5236279],[-0.3574067,1,0.1367736],[-0.7888348,-0.5,0.5236279],[-0.9368776,0.5,0.1367736],[-0.3574067,-1,0.1367736],[0.3574067,1,-0.1367736],[0.9368776,-0.5,-0.1367736],[0.7888348,0.5,-0.5236279],[0.3574067,-1,-0.1367736],[-0.6101315,0.7071068,-0.5236279],[-1.04156,-0.2071068,-0.1367736],[-0.6101315,-0.7071068,-0.5236279],[0.104682,
0.7071068,-0.7971752],[0.6841528,-0.2071068,-0.7971752],[0.104682,-0.7071068,-0.7971752],[-0.7148135,0,-0.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},{vertex:[[0,0,1.322876],[1.309307,0,0.1889822],[-0.9819805,0.8660254,
0.1889822],[0.1636634,-1.299038,0.1889822],[0.3273268,0.8660254,-0.9449112],[-0.8183171,-0.4330127,-0.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},{vertex:[[0,0,1.159953],[1.013464,0,0.5642542],[-0.3501431,0.9510565,0.5642542],[-0.7715208,-0.6571639,0.5642542],[0.6633206,0.9510565,-0.03144481],[0.8682979,-0.6571639,-0.3996071],[-1.121664,0.2938926,-0.03144481],[-0.2348831,-1.063314,-0.3996071],[0.5181548,0.2938926,-0.9953061],[-0.5850262,-0.112257,-0.9953061]],face:[[0,1,4,2],[0,
2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},{vertex:[[0,0,1.118034],[0.8944272,0,0.6708204],[-0.2236068,0.8660254,0.6708204],[-0.7826238,-0.4330127,0.6708204],[0.6708204,0.8660254,0.2236068],[1.006231,-0.4330127,-0.2236068],[-1.006231,0.4330127,0.2236068],[-0.6708204,-0.8660254,-0.2236068],[0.7826238,0.4330127,-0.6708204],[0.2236068,-0.8660254,-0.6708204],[-0.8944272,0,-0.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,
1],[2,4,8,11,10,6]]},{vertex:[[-0.729665,0.670121,0.319155],[-0.655235,-0.29213,-0.754096],[-0.093922,-0.607123,0.537818],[0.702196,0.595691,0.485187],[0.776626,-0.36656,-0.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},{vertex:[[-0.868849,-0.100041,0.61257],[-0.329458,0.976099,0.28078],[-0.26629,-0.013796,-0.477654],[-0.13392,-1.034115,0.229829],[0.738834,0.707117,-0.307018],[0.859683,-0.535264,-0.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},{vertex:[[-0.610389,
0.243975,0.531213],[-0.187812,-0.48795,-0.664016],[-0.187812,0.9759,-0.664016],[0.187812,-0.9759,0.664016],[0.798201,0.243975,0.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},{vertex:[[-1.028778,0.392027,-0.048786],[-0.640503,-0.646161,0.621837],[-0.125162,-0.395663,-0.540059],[0.004683,0.888447,-0.651988],[0.125161,0.395663,0.540059],[0.632925,-0.791376,0.433102],[1.031672,0.157063,-0.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},
{vertex:[[-0.669867,0.334933,-0.529576],[-0.669867,0.334933,0.529577],[-0.4043,1.212901,0],[-0.334933,-0.669867,-0.529576],[-0.334933,-0.669867,0.529577],[0.334933,0.669867,-0.529576],[0.334933,0.669867,0.529577],[0.4043,-1.212901,0],[0.669867,-0.334933,-0.529576],[0.669867,-0.334933,0.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},{vertex:[[-0.931836,0.219976,-0.264632],[-0.636706,0.318353,0.692816],[-0.613483,-0.735083,-0.264632],
[-0.326545,0.979634,0],[-0.318353,-0.636706,0.692816],[-0.159176,0.477529,-0.856368],[0.159176,-0.477529,-0.856368],[0.318353,0.636706,0.692816],[0.326545,-0.979634,0],[0.613482,0.735082,-0.264632],[0.636706,-0.318353,0.692816],[0.931835,-0.219977,-0.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},{vertex:[[-0.93465,0.300459,-0.271185],[-0.838689,-0.260219,-0.516017],[-0.711319,0.717591,0.128359],
[-0.710334,-0.156922,0.080946],[-0.599799,0.556003,-0.725148],[-0.503838,-0.004675,-0.969981],[-0.487004,0.26021,0.48049],[-0.460089,-0.750282,-0.512622],[-0.376468,0.973135,-0.325605],[-0.331735,-0.646985,0.084342],[-0.254001,0.831847,0.530001],[-0.125239,-0.494738,-0.966586],[0.029622,0.027949,0.730817],[0.056536,-0.982543,-0.262295],[0.08085,1.087391,0.076037],[0.125583,-0.532729,0.485984],[0.262625,0.599586,0.780328],[0.391387,-0.726999,-0.716259],[0.513854,-0.868287,0.139347],[0.597475,0.85513,
0.326364],[0.641224,0.109523,0.783723],[0.737185,-0.451155,0.538891],[0.848705,-0.612742,-0.314616],[0.976075,0.365067,0.32976],[1.072036,-0.19561,0.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]}],g,f,j,l,n,q=0>c.type||c.type>=d.length?0:c.type||0,p=c.size,
r=c.sizeX||p||1,t=c.sizeY||p||1,p=c.sizeZ||p||1,s=c.custom||d[q],u=s.face.length,x=c.faceUV||Array(u),d=c.faceColors,q=void 0===c.flat?!0:c.flat,y=0===c.sideOrientation?0:c.sideOrientation||b.Mesh.DEFAULTSIDE;c=[];var z=[],A=[],B=[],C=[],D=0,E=0,I=[],H=0,F=0;if(q)for(F=0;u>F;F++)d&&void 0===d[F]&&(d[F]=new b.Color4(1,1,1,1)),x&&void 0===x[F]&&(x[F]=new b.Vector4(0,0,1,1));if(q)for(F=0;u>F;F++){var J=s.face[F].length;j=2*Math.PI/J;l=0.5*Math.tan(j/2);n=0.5;for(H=0;J>H;H++)c.push(s.vertex[s.face[F][H]][0]*
r,s.vertex[s.face[F][H]][1]*t,s.vertex[s.face[F][H]][2]*p),I.push(D),D++,g=x[F].x+(x[F].z-x[F].x)*(0.5+l),f=x[F].y+(x[F].w-x[F].y)*(n-0.5),B.push(g,f),g=l*Math.cos(j)-n*Math.sin(j),n=l*Math.sin(j)+n*Math.cos(j),l=g,d&&C.push(d[F].r,d[F].g,d[F].b,d[F].a);for(H=0;J-2>H;H++)z.push(I[0+E],I[H+2+E],I[H+1+E]);E+=J}else{for(H=0;H<s.vertex.length;H++)c.push(s.vertex[H][0]*r,s.vertex[H][1]*t,s.vertex[H][2]*p),B.push(0,0);for(F=0;u>F;F++)for(H=0;H<s.face[F].length-2;H++)z.push(s.face[F][0],s.face[F][H+2],s.face[F][H+
1])}e.ComputeNormals(c,z,A);e._ComputeSides(y,c,z,A,B);r=new e;return r.positions=c,r.indices=z,r.normals=A,r.uvs=B,d&&q&&(r.colors=C),r},e.CreateTorusKnot=function(c){var d,g=[],f=[],j=[],l=[],n=c.radius||2,q=c.tube||0.5,p=c.radialSegments||32,r=c.tubularSegments||32,t=c.p||2,s=c.q||3,u=0===c.sideOrientation?0:c.sideOrientation||b.Mesh.DEFAULTSIDE,x=function(c){var d=Math.cos(c),e=Math.sin(c);c*=s/t;var g=Math.cos(c),d=0.5*(n*(2+g))*d,e=0.5*n*(2+g)*e;c=0.5*n*Math.sin(c);return new b.Vector3(d,e,
c)};for(c=0;p>=c;c++){d=2*(c%p/p)*t*Math.PI;var y=x(d),z=x(d+0.01);d=z.subtract(y);var z=z.add(y),A=b.Vector3.Cross(d,z),z=b.Vector3.Cross(A,d);A.normalize();z.normalize();for(d=0;r>d;d++){var B=2*(d%r/r)*Math.PI,C=-q*Math.cos(B),B=q*Math.sin(B);f.push(y.x+C*z.x+B*A.x);f.push(y.y+C*z.y+B*A.y);f.push(y.z+C*z.z+B*A.z);l.push(c/p);l.push(d/r)}}for(c=0;p>c;c++)for(d=0;r>d;d++)z=(d+1)%r,q=c*r+d,x=(c+1)*r+d,y=(c+1)*r+z,z=c*r+z,g.push(z),g.push(x),g.push(q),g.push(z),g.push(y),g.push(x);e.ComputeNormals(f,
g,j);e._ComputeSides(u,f,g,j,l);p=new e;return p.indices=g,p.positions=f,p.normals=j,p.uvs=l,p},e.ComputeNormals=function(b,d,e){for(var f=0,j=0,l=0,n=0,q=0,p=0,r=0,t=0,s=l=j=n=0,u=0,x=0,f=0;f<b.length;f++)e[f]=0;for(var y=d.length/3,f=0;y>f;f++)s=d[3*f],u=d[3*f+1],x=d[3*f+2],j=b[3*s]-b[3*u],l=b[3*s+1]-b[3*u+1],n=b[3*s+2]-b[3*u+2],q=b[3*x]-b[3*u],p=b[3*x+1]-b[3*u+1],r=b[3*x+2]-b[3*u+2],t=l*r-n*p,n=n*q-j*r,j=j*p-l*q,l=Math.sqrt(t*t+n*n+j*j),l=0===l?1:l,t/=l,n/=l,j/=l,e[3*s]+=t,e[3*s+1]+=n,e[3*s+2]+=
j,e[3*u]+=t,e[3*u+1]+=n,e[3*u+2]+=j,e[3*x]+=t,e[3*x+1]+=n,e[3*x+2]+=j;for(f=0;f<e.length/3;f++)t=e[3*f],n=e[3*f+1],j=e[3*f+2],l=Math.sqrt(t*t+n*n+j*j),l=0===l?1:l,t/=l,n/=l,j/=l,e[3*f]=t,e[3*f+1]=n,e[3*f+2]=j},e._ComputeSides=function(c,d,e,f,j){var l=e.length,n=f.length;switch(c||b.Mesh.DEFAULTSIDE){case b.Mesh.BACKSIDE:for(d=0;l>d;d+=3)j=e[d],e[d]=e[d+2],e[d+2]=j;for(e=0;n>e;e++)f[e]=-f[e];break;case b.Mesh.DOUBLESIDE:var q=d.length;c=q/3;for(var p=0;q>p;p++)d[q+p]=d[p];for(d=0;l>d;d+=3)e[d+l]=
e[d+2]+c,e[d+1+l]=e[d+1]+c,e[d+2+l]=e[d]+c;for(e=0;n>e;e++)f[n+e]=-f[e];f=j.length;for(n=0;f>n;n++)j[n+f]=j[n]}},e.ImportVertexData=function(c,d){var f=new e,m=c.positions;m&&f.set(m,b.VertexBuffer.PositionKind);var j=c.normals;j&&f.set(j,b.VertexBuffer.NormalKind);(j=c.uvs)&&f.set(j,b.VertexBuffer.UVKind);(j=c.uv2s)&&f.set(j,b.VertexBuffer.UV2Kind);(j=c.uv3s)&&f.set(j,b.VertexBuffer.UV3Kind);(j=c.uv4s)&&f.set(j,b.VertexBuffer.UV4Kind);(j=c.uv5s)&&f.set(j,b.VertexBuffer.UV5Kind);(j=c.uv6s)&&f.set(j,
b.VertexBuffer.UV6Kind);(j=c.colors)&&f.set(b.Color4.CheckColors4(j,m.length/3),b.VertexBuffer.ColorKind);(m=c.matricesIndices)&&f.set(m,b.VertexBuffer.MatricesIndicesKind);(m=c.matricesWeights)&&f.set(m,b.VertexBuffer.MatricesWeightsKind);(m=c.indices)&&(f.indices=m);d.setAllVerticesData(f,c.updatable)},e);b.VertexData=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(){};f=(e.EnableFor=function(b){b._tags=b._tags||{};b.hasTags=function(){return e.HasTags(b)};b.addTags=function(d){return e.AddTagsTo(b,d)};b.removeTags=function(d){return e.RemoveTagsFrom(b,d)};b.matchesTagsQuery=function(d){return e.MatchesQuery(b,d)}},e.DisableFor=function(b){delete b._tags;delete b.hasTags;delete b.addTags;delete b.removeTags;delete b.matchesTagsQuery},e.HasTags=function(c){return c._tags?!b.Tools.IsEmpty(c._tags):!1},e.GetTags=function(b,d){if(void 0===
d&&(d=!0),!b._tags)return null;if(d){var e=[],f;for(f in b._tags)b._tags.hasOwnProperty(f)&&!0===b._tags[f]&&e.push(f);return e.join(" ")}return b._tags},e.AddTagsTo=function(b,d){if(d&&"string"==typeof d){var f=d.split(" "),m;for(m in f)e._AddTagTo(b,f[m])}},e._AddTagTo=function(b,d){d=d.trim();""!==d&&"true"!==d&&"false"!==d&&(d.match(/[\s]/)||d.match(/^([!]|([|]|[&]){2})/)||(e.EnableFor(b),b._tags[d]=!0))},e.RemoveTagsFrom=function(b,d){if(e.HasTags(b)){var f=d.split(" "),m;for(m in f)e._RemoveTagFrom(b,
f[m])}},e._RemoveTagFrom=function(b,d){delete b._tags[d]},e.MatchesQuery=function(c,d){return void 0===d?!0:""===d?e.HasTags(c):b.Internals.AndOrNotEvaluator.Eval(d,function(b){return e.HasTags(c)&&c._tags[b]})},e);b.Tags=f}(BABYLON||(BABYLON={}));
!function(b){b=b.Internals||(b.Internals={});var f,e=function(){};f=(e.Eval=function(b,d){return b=b.match(/\([^\(\)]*\)/g)?b.replace(/\([^\(\)]*\)/g,function(b){return b=b.slice(1,b.length-1),e._HandleParenthesisContent(b,d)}):e._HandleParenthesisContent(b,d),"true"===b?!0:"false"===b?!1:e.Eval(b,d)},e._HandleParenthesisContent=function(b,d){d=d||function(b){return"true"===b};var f,m=b.split("||"),j;for(j in m){var l=e._SimplifyNegation(m[j].trim()),n=l.split("&&");if(1<n.length)for(var q=0;q<n.length;++q){var p=
e._SimplifyNegation(n[q].trim());if(f="true"!==p&&"false"!==p?"!"===p[0]?!d(p.substring(1)):d(p):"true"===p,!f){l="false";break}}if(f||"true"===l){f=!0;break}f="true"!==l&&"false"!==l?"!"===l[0]?!d(l.substring(1)):d(l):"true"===l}return f?"true":"false"},e._SimplifyNegation=function(b){return b=b.replace(/^[\s!]+/,function(b){return b=b.replace(/[\s]/g,function(){return""}),b.length%2?"!":""}),b=b.trim(),"!true"===b?b="false":"!false"===b&&(b="true"),b},e);b.AndOrNotEvaluator=f;!0}(BABYLON||(BABYLON=
{}));
!function(b){var f;f=function(e,c,d,f,m,j){this._enabled=!0;this._refCount=0;this._name=c;this._renderTexture=new b.RenderTargetTexture(c,d,e);this.setRenderList(f);this._renderTexture.onBeforeRenderObservable.add(m);this._renderTexture.onAfterRenderObservable.add(j);this._scene=e;this._renderList=f};f=(f.prototype._incRefCount=function(){return 0===this._refCount&&this._scene.customRenderTargets.push(this._renderTexture),++this._refCount},f.prototype._decRefCount=function(){return this._refCount--,0>=
this._refCount&&this._scene.customRenderTargets.splice(this._scene.customRenderTargets.indexOf(this._renderTexture),1),this._refCount},f.prototype._update=function(){this.setRenderList(this._renderList)},f.prototype.setRenderList=function(b){this._renderTexture.renderList=b},f.prototype.getRenderTexture=function(){return this._renderTexture},f);b.PostProcessRenderPass=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(b,c,d,f){this._engine=b;this._name=c;this._singleInstance=f||!0;this._getPostProcess=d;this._cameras=[];this._indicesForCamera=[];this._postProcesses={};this._renderPasses={};this._renderEffectAsPasses={}};f=(Object.defineProperty(f.prototype,"isSupported",{get:function(){for(var b in this._postProcesses)if(!this._postProcesses[b].isSupported)return!1;return!0},enumerable:!0,configurable:!0}),f.prototype._update=function(){for(var b in this._renderPasses)this._renderPasses[b]._update()},
f.prototype.addPass=function(b){this._renderPasses[b._name]=b;this._linkParameters()},f.prototype.removePass=function(b){delete this._renderPasses[b._name];this._linkParameters()},f.prototype.addRenderEffectAsPass=function(b){this._renderEffectAsPasses[b._name]=b;this._linkParameters()},f.prototype.getPass=function(b){for(var c in this._renderPasses)if(c===b)return this._renderPasses[b]},f.prototype.emptyPasses=function(){this._renderPasses={};this._linkParameters()},f.prototype._attachCameras=function(e){var c;
e=b.Tools.MakeArray(e||this._cameras);for(var d=0;d<e.length;d++){var f=e[d],m=f.name;c=this._singleInstance?0:m;this._postProcesses[c]=this._postProcesses[c]||this._getPostProcess();c=f.attachPostProcess(this._postProcesses[c]);this._indicesForCamera[m]||(this._indicesForCamera[m]=[]);this._indicesForCamera[m].push(c);-1===this._cameras.indexOf(f)&&(this._cameras[m]=f);for(var j in this._renderPasses)this._renderPasses[j]._incRefCount()}this._linkParameters()},f.prototype._detachCameras=function(e){e=
b.Tools.MakeArray(e||this._cameras);for(var c=0;c<e.length;c++){var d=e[c],f=d.name;d.detachPostProcess(this._postProcesses[this._singleInstance?0:f],this._indicesForCamera[f]);d=this._cameras.indexOf(f);this._indicesForCamera.splice(d,1);this._cameras.splice(d,1);for(var m in this._renderPasses)this._renderPasses[m]._decRefCount()}},f.prototype._enable=function(e){for(var c=b.Tools.MakeArray(e||this._cameras),d=0;d<c.length;d++){for(var f=c[d],m=f.name,j=0;j<this._indicesForCamera[m].length;j++)void 0===
f._postProcesses[this._indicesForCamera[m][j]]&&e[d].attachPostProcess(this._postProcesses[this._singleInstance?0:m],this._indicesForCamera[m][j]);for(var l in this._renderPasses)this._renderPasses[l]._incRefCount()}},f.prototype._disable=function(e){e=b.Tools.MakeArray(e||this._cameras);for(var c=0;c<e.length;c++){var d=e[c],f=d.Name;d.detachPostProcess(this._postProcesses[this._singleInstance?0:f],this._indicesForCamera[f]);for(var m in this._renderPasses)this._renderPasses[m]._decRefCount()}},
f.prototype.getPostProcess=function(b){return this._singleInstance?this._postProcesses[0]:this._postProcesses[b.name]},f.prototype._linkParameters=function(){var b=this,c;for(c in this._postProcesses)this.applyParameters&&this.applyParameters(this._postProcesses[c]),this._postProcesses[c].onBeforeRenderObservable.add(function(c){b._linkTextures(c)})},f.prototype._linkTextures=function(b){for(var c in this._renderPasses)b.setTexture(c,this._renderPasses[c].getRenderTexture());for(var d in this._renderEffectAsPasses)b.setTextureFromPostProcess(d+
"Sampler",this._renderEffectAsPasses[d].getPostProcess())},f);b.PostProcessRenderEffect=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(b,d){this._engine=b;this._name=d;this._renderEffects={};this._renderEffectsForIsolatedPass={};this._cameras=[]};f=(Object.defineProperty(e.prototype,"isSupported",{get:function(){for(var b in this._renderEffects)if(!this._renderEffects[b].isSupported)return!1;return!0},enumerable:!0,configurable:!0}),e.prototype.addEffect=function(b){this._renderEffects[b._name]=b},e.prototype._enableEffect=function(c,d){var e=this._renderEffects[c];e&&e._enable(b.Tools.MakeArray(d||
this._cameras))},e.prototype._disableEffect=function(c,d){var e=this._renderEffects[c];e&&e._disable(b.Tools.MakeArray(d||this._cameras))},e.prototype._attachCameras=function(c,d){var e,f=b.Tools.MakeArray(c||this._cameras),j=[];for(e=0;e<f.length;e++){var l=f[e],n=l.name;-1===this._cameras.indexOf(l)?this._cameras[n]=l:d&&j.push(e)}for(e=0;e<j.length;e++)c.splice(j[e],1);for(var q in this._renderEffects)this._renderEffects[q]._attachCameras(f)},e.prototype._detachCameras=function(c){c=b.Tools.MakeArray(c||
this._cameras);for(var d in this._renderEffects)this._renderEffects[d]._detachCameras(c);for(d=0;d<c.length;d++)this._cameras.splice(this._cameras.indexOf(c[d]),1)},e.prototype._enableDisplayOnlyPass=function(c,d){var f,m=this,j=b.Tools.MakeArray(d||this._cameras),l=null;for(f in this._renderEffects)if(l=this._renderEffects[f].getPass(c),null!=l)break;if(null!==l){for(f in this._renderEffects)this._renderEffects[f]._disable(j);l._name=e.PASS_SAMPLER_NAME;for(f=0;f<j.length;f++){var n=j[f],q=n.name;
this._renderEffectsForIsolatedPass[q]=this._renderEffectsForIsolatedPass[q]||new b.PostProcessRenderEffect(this._engine,e.PASS_EFFECT_NAME,function(){return new b.DisplayPassPostProcess(e.PASS_EFFECT_NAME,1,null,null,m._engine,!0)});this._renderEffectsForIsolatedPass[q].emptyPasses();this._renderEffectsForIsolatedPass[q].addPass(l);this._renderEffectsForIsolatedPass[q]._attachCameras(n)}}},e.prototype._disableDisplayOnlyPass=function(c){var d=this;c=b.Tools.MakeArray(c||this._cameras);for(var f=0;f<
c.length;f++){var m=c[f],j=m.name;this._renderEffectsForIsolatedPass[j]=this._renderEffectsForIsolatedPass[j]||new b.PostProcessRenderEffect(this._engine,e.PASS_EFFECT_NAME,function(){return new b.DisplayPassPostProcess(e.PASS_EFFECT_NAME,1,null,null,d._engine,!0)});this._renderEffectsForIsolatedPass[j]._disable(m)}for(var l in this._renderEffects)this._renderEffects[l]._enable(c)},e.prototype._update=function(){for(var b in this._renderEffects)this._renderEffects[b]._update();for(b=0;b<this._cameras.length;b++){var d=
this._cameras[b].name;this._renderEffectsForIsolatedPass[d]&&this._renderEffectsForIsolatedPass[d]._update()}},e.prototype.dispose=function(){},e.PASS_EFFECT_NAME="passEffect",e.PASS_SAMPLER_NAME="passSampler",e);b.PostProcessRenderPipeline=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(){this._renderPipelines={}};f=(f.prototype.addPipeline=function(b){this._renderPipelines[b._name]=b},f.prototype.attachCamerasToRenderPipeline=function(b,c,d){(b=this._renderPipelines[b])&&b._attachCameras(c,d)},f.prototype.detachCamerasFromRenderPipeline=function(b,c){var d=this._renderPipelines[b];d&&d._detachCameras(c)},f.prototype.enableEffectInPipeline=function(b,c,d){(b=this._renderPipelines[b])&&b._enableEffect(c,d)},f.prototype.disableEffectInPipeline=function(b,
c,d){(b=this._renderPipelines[b])&&b._disableEffect(c,d)},f.prototype.enableDisplayOnlyPassInPipeline=function(b,c,d){(b=this._renderPipelines[b])&&b._enableDisplayOnlyPass(c,d)},f.prototype.disableDisplayOnlyPassInPipeline=function(b,c){var d=this._renderPipelines[b];d&&d._disableDisplayOnlyPass(c)},f.prototype.update=function(){for(var b in this._renderPipelines){var c=this._renderPipelines[b];c.isSupported?c._update():(c.dispose(),delete this._renderPipelines[b])}},f);b.PostProcessRenderPipelineManager=
f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(e){this.frontColor=new b.Color3(1,1,1);this.backColor=new b.Color3(0.1,0.1,0.1);this.showBackLines=!0;this.renderList=new b.SmartArray(32);this._vertexBuffers={};this._scene=e};f=(f.prototype._prepareRessources=function(){if(!this._colorShader){this._colorShader=new b.ShaderMaterial("colorShader",this._scene,"color",{attributes:[b.VertexBuffer.PositionKind],uniforms:["worldViewProjection","color"]});var e=this._scene.getEngine(),c=b.VertexData.CreateBox(1);this._vertexBuffers[b.VertexBuffer.PositionKind]=
new b.VertexBuffer(e,c.positions,b.VertexBuffer.PositionKind,!1);this._indexBuffer=e.createIndexBuffer([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,7,1,6,2,5,3,4])}},f.prototype.reset=function(){this.renderList.reset()},f.prototype.render=function(){if(0!==this.renderList.length&&(this._prepareRessources(),this._colorShader.isReady())){var e=this._scene.getEngine();e.setDepthWrite(!1);this._colorShader._preBind();for(var c=0;c<this.renderList.length;c++){var d=this.renderList.data[c],f=d.minimum,m=d.maximum.subtract(f),
f=f.add(m.scale(0.5)),d=b.Matrix.Scaling(m.x,m.y,m.z).multiply(b.Matrix.Translation(f.x,f.y,f.z)).multiply(d.getWorldMatrix());e.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect());this.showBackLines&&(e.setDepthFunctionToGreaterOrEqual(),this._scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.backColor.toColor4()),this._colorShader.bind(d),e.draw(!1,0,24));e.setDepthFunctionToLess();this._scene.resetCachedMaterial();this._colorShader.setColor4("color",
this.frontColor.toColor4());this._colorShader.bind(d);e.draw(!1,0,24)}this._colorShader.unbind();e.setDepthFunctionToLessOrEqual();e.setDepthWrite(!0)}},f.prototype.dispose=function(){if(this._colorShader){this._colorShader.dispose();var e=this._vertexBuffers[b.VertexBuffer.PositionKind];e&&(e.dispose(),this._vertexBuffers[b.VertexBuffer.PositionKind]=null);this._scene.getEngine()._releaseBuffer(this._indexBuffer)}},f);b.BoundingBoxRenderer=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(b){this._actionManager=b};f=(e.prototype.isValid=function(){return!0},e.prototype._getProperty=function(b){return this._actionManager._getProperty(b)},e.prototype._getEffectiveTarget=function(b,c){return this._actionManager._getEffectiveTarget(b,c)},e.prototype.serialize=function(){},e.prototype._serialize=function(b){return{type:2,children:[],name:b.name,properties:b.properties}},e);b.Condition=f;var c=function(b,e,m,j,l){void 0===l&&(l=c.IsEqual);f.call(this,b);this.propertyPath=
m;this.value=j;this.operator=l;this._target=e;this._effectiveTarget=this._getEffectiveTarget(e,this.propertyPath);this._property=this._getProperty(this.propertyPath)},e=(__extends(c,f),Object.defineProperty(c,"IsEqual",{get:function(){return c._IsEqual},enumerable:!0,configurable:!0}),Object.defineProperty(c,"IsDifferent",{get:function(){return c._IsDifferent},enumerable:!0,configurable:!0}),Object.defineProperty(c,"IsGreater",{get:function(){return c._IsGreater},enumerable:!0,configurable:!0}),Object.defineProperty(c,
"IsLesser",{get:function(){return c._IsLesser},enumerable:!0,configurable:!0}),c.prototype.isValid=function(){switch(this.operator){case c.IsGreater:return this._effectiveTarget[this._property]>this.value;case c.IsLesser:return this._effectiveTarget[this._property]<this.value;case c.IsEqual:case c.IsDifferent:var b;return b=this.value.equals?this.value.equals(this._effectiveTarget[this._property]):this.value===this._effectiveTarget[this._property],this.operator===c.IsEqual?b:!b}return!1},c.prototype.serialize=
function(){return this._serialize({name:"ValueCondition",properties:[b.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:b.Action._SerializeValueAsString(this.value)},{name:"operator",value:c.GetOperatorName(this.operator)}]})},c.GetOperatorName=function(b){switch(b){case c._IsEqual:return"IsEqual";case c._IsDifferent:return"IsDifferent";case c._IsGreater:return"IsGreater";case c._IsLesser:return"IsLesser";default:return""}},c._IsEqual=0,c._IsDifferent=
1,c._IsGreater=2,c._IsLesser=3,c);b.ValueCondition=e;e=function(b,c){f.call(this,b);this.predicate=c};e=(__extends(e,f),e.prototype.isValid=function(){return this.predicate()},e);b.PredicateCondition=e;e=function(b,c,e){f.call(this,b);this.value=e;this._target=c};e=(__extends(e,f),e.prototype.isValid=function(){return this._target.state===this.value},e.prototype.serialize=function(){return this._serialize({name:"StateCondition",properties:[b.Action._GetTargetProperty(this._target),{name:"value",value:this.value}]})},
e);b.StateCondition=e}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(b,c){this.triggerOptions=b;b.parameter?(this.trigger=b.trigger,this._triggerParameter=b.parameter):this.trigger=b;this._nextActiveAction=this;this._condition=c};f=(f.prototype._prepare=function(){},f.prototype.getTriggerParameter=function(){return this._triggerParameter},f.prototype._executeCurrent=function(b){if(this._nextActiveAction._condition){var c=this._nextActiveAction._condition,d=this._actionManager.getScene().getRenderId();if(c._evaluationId===d){if(!c._currentResult)return}else{if(c._evaluationId=
d,!c.isValid())return void(c._currentResult=!1);c._currentResult=!0}}this._nextActiveAction.execute(b);this.skipToNextActiveAction()},f.prototype.execute=function(){},f.prototype.skipToNextActiveAction=function(){this._nextActiveAction._child?(this._nextActiveAction._child._actionManager||(this._nextActiveAction._child._actionManager=this._actionManager),this._nextActiveAction=this._nextActiveAction._child):this._nextActiveAction=this},f.prototype.then=function(b){return this._child=b,b._actionManager=
this._actionManager,b._prepare(),b},f.prototype._getProperty=function(b){return this._actionManager._getProperty(b)},f.prototype._getEffectiveTarget=function(b,c){return this._actionManager._getEffectiveTarget(b,c)},f.prototype.serialize=function(){},f.prototype._serialize=function(b,c){var d={type:1,children:[],name:b.name,properties:b.properties||[]};if(this._child&&this._child.serialize(d),this._condition){var f=this._condition.serialize();return f.children.push(d),c&&c.children.push(f),f}return c&&
c.children.push(d),d},f._SerializeValueAsString=function(e){return"number"==typeof e?e.toString():"boolean"==typeof e?e?"true":"false":e instanceof b.Vector2?e.x+", "+e.y:e instanceof b.Vector3?e.x+", "+e.y+", "+e.z:e instanceof b.Color3?e.r+", "+e.g+", "+e.b:e instanceof b.Color4?e.r+", "+e.g+", "+e.b+", "+e.a:e},f._GetTargetProperty=function(e){return{name:"target",targetType:e instanceof b.Mesh?"MeshProperties":e instanceof b.Light?"LightProperties":e instanceof b.Camera?"CameraProperties":"SceneProperties",
value:e instanceof b.Scene?"Scene":e.name}},f);b.Action=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(b,c,e,f,l,n){this.source=b;this.pointerX=c;this.pointerY=e;this.meshUnderPointer=f;this.sourceEvent=l;this.additionalData=n};f=(e.CreateNew=function(b,c,f){var j=b.getScene();return new e(b,j.pointerX,j.pointerY,j.meshUnderPointer,c,f)},e.CreateNewFromSprite=function(b,c,f,j){return new e(b,c.pointerX,c.pointerY,c.meshUnderPointer,f,j)},e.CreateNewFromScene=function(b,c){return new e(null,b.pointerX,b.pointerY,b.meshUnderPointer,c)},e.CreateNewFromPrimitive=function(b,
c,f,j){return new e(b,c.x,c.y,null,f,j)},e);b.ActionEvent=f;var c=function(b){this.actions=[];this._scene=b;b._actionManagers.push(this)};f=(Object.defineProperty(c,"NothingTrigger",{get:function(){return c._NothingTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnPickTrigger",{get:function(){return c._OnPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnLeftPickTrigger",{get:function(){return c._OnLeftPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(c,
"OnRightPickTrigger",{get:function(){return c._OnRightPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnCenterPickTrigger",{get:function(){return c._OnCenterPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnPickDownTrigger",{get:function(){return c._OnPickDownTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnPickUpTrigger",{get:function(){return c._OnPickUpTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnPickOutTrigger",
{get:function(){return c._OnPickOutTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnLongPressTrigger",{get:function(){return c._OnLongPressTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnPointerOverTrigger",{get:function(){return c._OnPointerOverTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnPointerOutTrigger",{get:function(){return c._OnPointerOutTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnEveryFrameTrigger",{get:function(){return c._OnEveryFrameTrigger},
enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnIntersectionEnterTrigger",{get:function(){return c._OnIntersectionEnterTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnIntersectionExitTrigger",{get:function(){return c._OnIntersectionExitTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnKeyDownTrigger",{get:function(){return c._OnKeyDownTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(c,"OnKeyUpTrigger",{get:function(){return c._OnKeyUpTrigger},
enumerable:!0,configurable:!0}),c.prototype.dispose=function(){var b=this._scene._actionManagers.indexOf(this);-1<b&&this._scene._actionManagers.splice(b,1)},c.prototype.getScene=function(){return this._scene},c.prototype.hasSpecificTriggers=function(b){for(var c=0;c<this.actions.length;c++)if(-1<b.indexOf(this.actions[c].trigger))return!0;return!1},c.prototype.hasSpecificTrigger=function(b){for(var c=0;c<this.actions.length;c++)if(this.actions[c].trigger===b)return!0;return!1},Object.defineProperty(c.prototype,
"hasPointerTriggers",{get:function(){for(var b=0;b<this.actions.length;b++){var e=this.actions[b];if(e.trigger>=c._OnPickTrigger&&e.trigger<=c._OnPointerOutTrigger)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"hasPickTriggers",{get:function(){for(var b=0;b<this.actions.length;b++){var e=this.actions[b];if(e.trigger>=c._OnPickTrigger&&e.trigger<=c._OnPickUpTrigger)return!0}return!1},enumerable:!0,configurable:!0}),c.prototype.registerAction=function(d){return d.trigger===
c.OnEveryFrameTrigger&&this.getScene().actionManager!==this?(b.Tools.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"),null):(this.actions.push(d),d._actionManager=this,d._prepare(),d)},c.prototype.processTrigger=function(b,e){for(var f=0;f<this.actions.length;f++){var j=this.actions[f];if(j.trigger===b){if(b===c.OnKeyUpTrigger||b===c.OnKeyDownTrigger){var l=j.getTriggerParameter();if(l&&String.fromCharCode(e.sourceEvent.charCode?e.sourceEvent.charCode:e.sourceEvent.keyCode).toLowerCase()!==
l.toLowerCase())continue}j._executeCurrent(e)}}},c.prototype._getEffectiveTarget=function(b,c){for(var e=c.split("."),f=0;f<e.length-1;f++)b=b[e[f]];return b},c.prototype._getProperty=function(b){b=b.split(".");return b[b.length-1]},c.prototype.serialize=function(d){d={children:[],name:d,type:3,properties:[]};for(var e=0;e<this.actions.length;e++){var f={type:0,children:[],name:c.GetTriggerName(this.actions[e].trigger),properties:[]},j=this.actions[e].triggerOptions;j&&"number"!=typeof j&&(j.parameter instanceof
b.Node?f.properties.push(b.Action._GetTargetProperty(j.parameter)):f.properties.push({name:"parameter",targetType:null,value:j.parameter}));this.actions[e].serialize(f);d.children.push(f)}return d},c.Parse=function(d,e,f){var j=new b.ActionManager(f);null===e?f.actionManager=j:e.actionManager=j;var l=function(d,e,g,p,n){if(void 0===n&&(n=null),!d.detached){var q=[],z=null,A=null,B=d.combine&&0<d.combine.length;if(2===d.type?q.push(j):q.push(e),B){z=[];for(A=0;A<d.combine.length;A++)l(d.combine[A],
c.NothingTrigger,g,p,z);q.push(z)}else for(B=0;B<d.properties.length;B++){var C=d.properties[B].value,D=d.properties[B].name,E=d.properties[B].targetType;if("target"===D)C=z=null!==E&&"SceneProperties"===E?f:f.getNodeByName(C);else if("parent"===D)C=f.getNodeByName(C);else if("sound"===D)C=f.getSoundByName(C);else if("propertyPath"!==D)if(2===d.type&&"operator"===D)C=b.ValueCondition[C];else if(E=C,C=z,D="value"===D?A:null,null===D)C=parseFloat(E),C="true"===E||"false"===E?"true"===E:isNaN(C)?E:C;
else{for(var D=D.split("."),E=E.split(","),I=0;I<D.length;I++)C=C[D[I]];if("boolean"==typeof C)C="true"===E[0];else if("string"==typeof C)C=E[0];else{D=[];for(I=0;I<E.length;I++)D.push(parseFloat(E[I]));C=C instanceof b.Vector3?b.Vector3.FromArray(D):C instanceof b.Vector4?b.Vector4.FromArray(D):C instanceof b.Color3?b.Color3.FromArray(D):C instanceof b.Color4?b.Color4.FromArray(D):parseFloat(E[0])}}else A=C;q.push(C)}if(null===n?q.push(g):q.push(null),"InterpolateValueAction"===d.name)q[q.length-
1]=q[q.length-2],q[q.length-2]=g;z=Object.create(b[d.name].prototype);q=(z.constructor.apply(z,q),z);q instanceof b.Condition&&null!==g&&(z=new b.DoNothingAction(e,g),p?p.then(z):j.registerAction(z),p=z);null===n?q instanceof b.Condition?(g=q,q=p):(g=null,p?p.then(q):j.registerAction(q)):n.push(q);for(B=0;B<d.children.length;B++)l(d.children[B],e,g,q,null)}};for(e=0;e<d.children.length;e++){var n,q=d.children[e];0<q.properties.length?(n=q.properties[0].value,n=null===q.properties[0].targetType?n:
f.getMeshByName(n),n={trigger:b.ActionManager[q.name],parameter:n}):n=b.ActionManager[q.name];for(var p=0;p<q.children.length;p++)q.detached||l(q.children[p],n,null,null)}},c.GetTriggerName=function(b){switch(b){case 0:return"NothingTrigger";case 1:return"OnPickTrigger";case 2:return"OnLeftPickTrigger";case 3:return"OnRightPickTrigger";case 4:return"OnCenterPickTrigger";case 5:return"OnPickDownTrigger";case 6:return"OnPickUpTrigger";case 7:return"OnLongPressTrigger";case 8:return"OnPointerOverTrigger";
case 9:return"OnPointerOutTrigger";case 10:return"OnEveryFrameTrigger";case 11:return"OnIntersectionEnterTrigger";case 12:return"OnIntersectionExitTrigger";case 13:return"OnKeyDownTrigger";case 14:return"OnKeyUpTrigger";case 15:return"OnPickOutTrigger";default:return""}},c._NothingTrigger=0,c._OnPickTrigger=1,c._OnLeftPickTrigger=2,c._OnRightPickTrigger=3,c._OnCenterPickTrigger=4,c._OnPickDownTrigger=5,c._OnPickUpTrigger=6,c._OnLongPressTrigger=7,c._OnPointerOverTrigger=8,c._OnPointerOutTrigger=9,
c._OnEveryFrameTrigger=10,c._OnIntersectionEnterTrigger=11,c._OnIntersectionExitTrigger=12,c._OnKeyDownTrigger=13,c._OnKeyUpTrigger=14,c._OnPickOutTrigger=15,c.DragMovementThreshold=10,c.LongPressDelay=500,c);b.ActionManager=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.Action;f=function(b,d,f,m,j,l,n,q){void 0===j&&(j=1E3);e.call(this,b,l);this.propertyPath=f;this.value=m;this.duration=j;this.stopOtherAnimations=n;this.onInterpolationDone=q;this._target=this._effectiveTarget=d};f=(__extends(f,e),f.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath);this._property=this._getProperty(this.propertyPath)},f.prototype.execute=function(){var c,d=this._actionManager.getScene(),e=[{frame:0,
value:this._effectiveTarget[this._property]},{frame:100,value:this.value}];if("number"==typeof this.value)c=b.Animation.ANIMATIONTYPE_FLOAT;else if(this.value instanceof b.Color3)c=b.Animation.ANIMATIONTYPE_COLOR3;else if(this.value instanceof b.Vector3)c=b.Animation.ANIMATIONTYPE_VECTOR3;else if(this.value instanceof b.Matrix)c=b.Animation.ANIMATIONTYPE_MATRIX;else{if(!(this.value instanceof b.Quaternion))return void b.Tools.Warn("InterpolateValueAction: Unsupported type ("+typeof this.value+")");
c=b.Animation.ANIMATIONTYPE_QUATERNION}c=new b.Animation("InterpolateValueAction",this._property,100*(1E3/this.duration),c,b.Animation.ANIMATIONLOOPMODE_CONSTANT);c.setKeys(e);this.stopOtherAnimations&&d.stopAnimation(this._effectiveTarget);d.beginDirectAnimation(this._effectiveTarget,[c],0,100,!1,1,this.onInterpolationDone)},f.prototype.serialize=function(c){return e.prototype._serialize.call(this,{name:"InterpolateValueAction",properties:[b.Action._GetTargetProperty(this._target),{name:"propertyPath",
value:this.propertyPath},{name:"value",value:b.Action._SerializeValueAsString(this.value)},{name:"duration",value:b.Action._SerializeValueAsString(this.duration)},{name:"stopOtherAnimations",value:b.Action._SerializeValueAsString(this.stopOtherAnimations)||!1}]},c)},f);b.InterpolateValueAction=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.Action;f=function(b,c,d,f){e.call(this,b,f);this.propertyPath=d;this._target=this._effectiveTarget=c};f=(__extends(f,e),f.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath);this._property=this._getProperty(this.propertyPath)},f.prototype.execute=function(){this._effectiveTarget[this._property]=!this._effectiveTarget[this._property]},f.prototype.serialize=function(c){return e.prototype._serialize.call(this,{name:"SwitchBooleanAction",
properties:[b.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath}]},c)},f);b.SwitchBooleanAction=f;var c=b.Action;f=function(b,d,e,f){c.call(this,b,f);this.value=e;this._target=d};f=(__extends(f,c),f.prototype.execute=function(){this._target.state=this.value},f.prototype.serialize=function(d){return c.prototype._serialize.call(this,{name:"SetStateAction",properties:[b.Action._GetTargetProperty(this._target),{name:"value",value:this.value}]},d)},f);b.SetStateAction=
f;var d=b.Action;f=function(b,c,e,f,g){d.call(this,b,g);this.propertyPath=e;this.value=f;this._target=this._effectiveTarget=c};f=(__extends(f,d),f.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath);this._property=this._getProperty(this.propertyPath)},f.prototype.execute=function(){this._effectiveTarget[this._property]=this.value;this._target.markAsDirty&&this._target.markAsDirty(this._property)},f.prototype.serialize=function(c){return d.prototype._serialize.call(this,
{name:"SetValueAction",properties:[b.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:b.Action._SerializeValueAsString(this.value)}]},c)},f);b.SetValueAction=f;var g=b.Action;f=function(b,c,d,e,f){g.call(this,b,f);this.propertyPath=d;this.value=e;this._target=this._effectiveTarget=c};f=(__extends(f,g),f.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath);this._property=this._getProperty(this.propertyPath);
"number"!=typeof this._effectiveTarget[this._property]&&b.Tools.Warn("Warning: IncrementValueAction can only be used with number values")},f.prototype.execute=function(){this._effectiveTarget[this._property]+=this.value;this._target.markAsDirty&&this._target.markAsDirty(this._property)},f.prototype.serialize=function(c){return g.prototype._serialize.call(this,{name:"IncrementValueAction",properties:[b.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",
value:b.Action._SerializeValueAsString(this.value)}]},c)},f);b.IncrementValueAction=f;var m=b.Action;f=function(b,c,d,e,f,g){m.call(this,b,g);this.from=d;this.to=e;this.loop=f;this._target=c};f=(__extends(f,m),f.prototype._prepare=function(){},f.prototype.execute=function(){this._actionManager.getScene().beginAnimation(this._target,this.from,this.to,this.loop)},f.prototype.serialize=function(c){return m.prototype._serialize.call(this,{name:"PlayAnimationAction",properties:[b.Action._GetTargetProperty(this._target),
{name:"from",value:String(this.from)},{name:"to",value:String(this.to)},{name:"loop",value:b.Action._SerializeValueAsString(this.loop)||!1}]},c)},f);b.PlayAnimationAction=f;var j=b.Action;f=function(b,c,d){j.call(this,b,d);this._target=c};f=(__extends(f,j),f.prototype._prepare=function(){},f.prototype.execute=function(){this._actionManager.getScene().stopAnimation(this._target)},f.prototype.serialize=function(c){return j.prototype._serialize.call(this,{name:"StopAnimationAction",properties:[b.Action._GetTargetProperty(this._target)]},
c)},f);b.StopAnimationAction=f;var l=b.Action;f=function(c,d){void 0===c&&(c=b.ActionManager.NothingTrigger);l.call(this,c,d)};f=(__extends(f,l),f.prototype.execute=function(){},f.prototype.serialize=function(b){return l.prototype._serialize.call(this,{name:"DoNothingAction",properties:[]},b)},f);b.DoNothingAction=f;var n=b.Action;f=function(b,c,d){n.call(this,b,d);this.children=c};f=(__extends(f,n),f.prototype._prepare=function(){for(var b=0;b<this.children.length;b++)this.children[b]._actionManager=
this._actionManager,this.children[b]._prepare()},f.prototype.execute=function(b){for(var c=0;c<this.children.length;c++)this.children[c].execute(b)},f.prototype.serialize=function(b){b=n.prototype._serialize.call(this,{name:"CombineAction",properties:[],combine:[]},b);for(var c=0;c<this.children.length;c++)b.combine.push(this.children[c].serialize(null));return b},f);b.CombineAction=f;var q=b.Action;f=function(b,c,d){q.call(this,b,d);this.func=c};f=(__extends(f,q),f.prototype.execute=function(b){this.func(b)},
f);b.ExecuteCodeAction=f;var p=b.Action;f=function(b,c,d,e){p.call(this,b,e);this._target=c;this._parent=d};f=(__extends(f,p),f.prototype._prepare=function(){},f.prototype.execute=function(){if(this._target.parent!==this._parent){var c=this._parent.getWorldMatrix().clone();c.invert();this._target.position=b.Vector3.TransformCoordinates(this._target.position,c);this._target.parent=this._parent}},f.prototype.serialize=function(c){return p.prototype._serialize.call(this,{name:"SetParentAction",properties:[b.Action._GetTargetProperty(this._target),
b.Action._GetTargetProperty(this._parent)]},c)},f);b.SetParentAction=f;var r=b.Action;f=function(b,c,d){r.call(this,b,d);this._sound=c};f=(__extends(f,r),f.prototype._prepare=function(){},f.prototype.execute=function(){void 0!==this._sound&&this._sound.play()},f.prototype.serialize=function(b){return r.prototype._serialize.call(this,{name:"PlaySoundAction",properties:[{name:"sound",value:this._sound.name}]},b)},f);b.PlaySoundAction=f;var t=b.Action;f=function(b,c,d){t.call(this,b,d);this._sound=c};
f=(__extends(f,t),f.prototype._prepare=function(){},f.prototype.execute=function(){void 0!==this._sound&&this._sound.stop()},f.prototype.serialize=function(b){return t.prototype._serialize.call(this,{name:"StopSoundAction",properties:[{name:"sound",value:this._sound.name}]},b)},f);b.StopSoundAction=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(c,d,e,f,g){this.delayLoadState=b.Engine.DELAYLOADSTATE_NONE;this._totalVertices=0;this._isDisposed=!1;this.id=c;this._engine=d.getEngine();this._meshes=[];this._scene=d;this._vertexBuffers={};this._indices=[];e?this.setAllVerticesData(e,f):(this._totalVertices=0,this._indices=[]);g&&(g instanceof b.LinesMesh&&(this.boundingBias=new b.Vector2(0,g.intersectionThreshold),this.updateExtend()),this.applyToMesh(g),g.computeWorldMatrix(!0))};f=(Object.defineProperty(e.prototype,
"boundingBias",{get:function(){return this._boundingBias},set:function(b){this._boundingBias&&this._boundingBias.equals(b)||(this._boundingBias=b.clone(),this.updateBoundingInfo(!0,null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extend",{get:function(){return this._extend},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype.getEngine=function(){return this._engine},e.prototype.isReady=function(){return this.delayLoadState===b.Engine.DELAYLOADSTATE_LOADED||
this.delayLoadState===b.Engine.DELAYLOADSTATE_NONE},e.prototype.setAllVerticesData=function(b,c){b.applyToGeometry(this,c);this.notifyUpdate()},e.prototype.setVerticesData=function(c,d,e,f){c=new b.VertexBuffer(this._engine,d,c,e,0===this._meshes.length,f);this.setVerticesBuffer(c)},e.prototype.setVerticesBuffer=function(c){var d=c.getKind();if(this._vertexBuffers[d]&&this._vertexBuffers[d].dispose(),this._vertexBuffers[d]=c,d===b.VertexBuffer.PositionKind){var e=c.getData();c=c.getStrideSize();this._totalVertices=
e.length/c;this.updateExtend(e,c);e=this._meshes;c=e.length;for(var f=0;c>f;f++){var g=e[f];g._resetPointsArrayCache();g._boundingInfo=new b.BoundingInfo(this._extend.minimum,this._extend.maximum);g._createGlobalSubMesh();g.computeWorldMatrix(!0)}}this.notifyUpdate(d)},e.prototype.updateVerticesDataDirectly=function(b,c,d){var e=this.getVertexBuffer(b);e&&(e.updateDirectly(c,d),this.notifyUpdate(b))},e.prototype.updateVerticesData=function(c,d,e){var f=this.getVertexBuffer(c);if(f){if(f.update(d),
c===b.VertexBuffer.PositionKind)f=f.getStrideSize(),this._totalVertices=d.length/f,this.updateBoundingInfo(e,d);this.notifyUpdate(c)}},e.prototype.updateBoundingInfo=function(c,d){c&&this.updateExtend(d);for(var e=this._meshes,f=e.length,g=0;f>g;g++){var j=e[g];if(j._resetPointsArrayCache(),c){j._boundingInfo=new b.BoundingInfo(this._extend.minimum,this._extend.maximum);for(var l=0;l<j.subMeshes.length;l++)j.subMeshes[l].refreshBoundingInfo()}}},e.prototype.getTotalVertices=function(){return this.isReady()?
this._totalVertices:0},e.prototype.getVerticesData=function(b,c){var d=this.getVertexBuffer(b);if(!d)return null;d=d.getData();if(c&&1!==this._meshes.length){for(var e=d.length,f=[],g=0;e>g;g++)f.push(d[g]);return f}return d},e.prototype.getVertexBuffer=function(b){return this.isReady()?this._vertexBuffers[b]:null},e.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},e.prototype.isVerticesDataPresent=function(b){return this._vertexBuffers?void 0!==this._vertexBuffers[b]:
this._delayInfo?-1!==this._delayInfo.indexOf(b):!1},e.prototype.getVerticesDataKinds=function(){var b,c=[];if(!this._vertexBuffers&&this._delayInfo)for(b in this._delayInfo)c.push(b);else for(b in this._vertexBuffers)c.push(b);return c},e.prototype.setIndices=function(b,c){this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer);this._indices=b;0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices));void 0!==c&&(this._totalVertices=c);for(var d=
this._meshes,e=d.length,f=0;e>f;f++)d[f]._createGlobalSubMesh();this.notifyUpdate()},e.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},e.prototype.getIndices=function(b){if(!this.isReady())return null;var c=this._indices;if(b&&1!==this._meshes.length){b=c.length;for(var d=[],e=0;b>e;e++)d.push(c[e]);return d}return c},e.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},e.prototype.releaseForMesh=function(b,c){var d=this._meshes,e=
d.indexOf(b);if(-1!==e){for(var f in this._vertexBuffers)this._vertexBuffers[f].dispose();this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null);d.splice(e,1);b._geometry=null;0===d.length&&c&&this.dispose()}},e.prototype.applyToMesh=function(b){if(b._geometry!==this){var c=b._geometry;c&&c.releaseForMesh(b);c=this._meshes;b._geometry=this;this._scene.pushGeometry(this);c.push(b);this.isReady()?this._applyToMesh(b):b._boundingInfo=this._boundingInfo}},e.prototype.updateExtend=
function(c,d){void 0===c&&(c=null);c||(c=this._vertexBuffers[b.VertexBuffer.PositionKind].getData());this._extend=b.Tools.ExtractMinAndMax(c,0,this._totalVertices,this.boundingBias,d)},e.prototype._applyToMesh=function(c){var d=this._meshes.length,e;for(e in this._vertexBuffers)1===d&&this._vertexBuffers[e].create(),this._vertexBuffers[e].getBuffer().references=d,e===b.VertexBuffer.PositionKind&&(c._resetPointsArrayCache(),this._extend||this.updateExtend(this._vertexBuffers[e].getData()),c._boundingInfo=
new b.BoundingInfo(this._extend.minimum,this._extend.maximum),c._createGlobalSubMesh(),c._updateBoundingInfo());1===d&&this._indices&&0<this._indices.length&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices));this._indexBuffer&&(this._indexBuffer.references=d)},e.prototype.notifyUpdate=function(b){this.onGeometryUpdated&&this.onGeometryUpdated(this,b)},e.prototype.load=function(c,d){var e=this;if(this.delayLoadState!==b.Engine.DELAYLOADSTATE_LOADING){if(this.isReady())return void(d&&
d());this.delayLoadState=b.Engine.DELAYLOADSTATE_LOADING;c._addPendingData(this);b.Tools.LoadFile(this.delayLoadingFile,function(f){e._delayLoadingFunction(JSON.parse(f),e);e.delayLoadState=b.Engine.DELAYLOADSTATE_LOADED;e._delayInfo=[];c._removePendingData(e);f=e._meshes;for(var g=f.length,j=0;g>j;j++)e._applyToMesh(f[j]);d&&d()},function(){},c.database)}},e.prototype.toLeftHanded=function(){var c=this.getIndices(!1);if(null!=c&&0<c.length){for(var d=0;d<c.length;d+=3){var e=c[d+0];c[d+0]=c[d+2];
c[d+2]=e}this.setIndices(c)}c=this.getVerticesData(b.VertexBuffer.PositionKind,!1);if(null!=c&&0<c.length){for(d=0;d<c.length;d+=3)c[d+2]=-c[d+2];this.setVerticesData(b.VertexBuffer.PositionKind,c,!1)}c=this.getVerticesData(b.VertexBuffer.NormalKind,!1);if(null!=c&&0<c.length){for(d=0;d<c.length;d+=3)c[d+2]=-c[d+2];this.setVerticesData(b.VertexBuffer.NormalKind,c,!1)}},e.prototype.isDisposed=function(){return this._isDisposed},e.prototype.dispose=function(){var c,d=this._meshes,e=d.length;for(c=0;e>
c;c++)this.releaseForMesh(d[c]);this._meshes=[];for(var f in this._vertexBuffers)this._vertexBuffers[f].dispose();this._vertexBuffers={};this._totalVertices=0;this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer);this._indexBuffer=null;this._indices=[];this.delayLoadState=b.Engine.DELAYLOADSTATE_NONE;this._delayLoadingFunction=this.delayLoadingFile=null;this._delayInfo=[];this._boundingInfo=null;this._scene.removeGeometry(this);this._isDisposed=!0},e.prototype.copy=function(c){var d=new b.VertexData;
d.indices=[];for(var f=this.getIndices(),g=0;g<f.length;g++)d.indices.push(f[g]);var j,g=f=!1;for(j in this._vertexBuffers){var l=this.getVerticesData(j);l instanceof Float32Array?d.set(new Float32Array(l),j):d.set(l.slice(0),j);g||(f=this.getVertexBuffer(j).isUpdatable(),g=!f)}c=new e(c,this._scene,d,f,null);c.delayLoadState=this.delayLoadState;c.delayLoadingFile=this.delayLoadingFile;c._delayLoadingFunction=this._delayLoadingFunction;for(j in this._delayInfo)c._delayInfo=c._delayInfo||[],c._delayInfo.push(j);
return c._boundingInfo=new b.BoundingInfo(this._extend.minimum,this._extend.maximum),c},e.prototype.serialize=function(){var c={};return c.id=this.id,b.Tags.HasTags(this)&&(c.tags=b.Tags.GetTags(this)),c},e.prototype.serializeVerticeData=function(){var c=this.serialize();return this.isVerticesDataPresent(b.VertexBuffer.PositionKind)&&(c.positions=this.getVerticesData(b.VertexBuffer.PositionKind)),this.isVerticesDataPresent(b.VertexBuffer.NormalKind)&&(c.normals=this.getVerticesData(b.VertexBuffer.NormalKind)),
this.isVerticesDataPresent(b.VertexBuffer.UVKind)&&(c.uvs=this.getVerticesData(b.VertexBuffer.UVKind)),this.isVerticesDataPresent(b.VertexBuffer.UV2Kind)&&(c.uvs2=this.getVerticesData(b.VertexBuffer.UV2Kind)),this.isVerticesDataPresent(b.VertexBuffer.UV3Kind)&&(c.uvs3=this.getVerticesData(b.VertexBuffer.UV3Kind)),this.isVerticesDataPresent(b.VertexBuffer.UV4Kind)&&(c.uvs4=this.getVerticesData(b.VertexBuffer.UV4Kind)),this.isVerticesDataPresent(b.VertexBuffer.UV5Kind)&&(c.uvs5=this.getVerticesData(b.VertexBuffer.UV5Kind)),
this.isVerticesDataPresent(b.VertexBuffer.UV6Kind)&&(c.uvs6=this.getVerticesData(b.VertexBuffer.UV6Kind)),this.isVerticesDataPresent(b.VertexBuffer.ColorKind)&&(c.colors=this.getVerticesData(b.VertexBuffer.ColorKind)),this.isVerticesDataPresent(b.VertexBuffer.MatricesIndicesKind)&&(c.matricesIndices=this.getVerticesData(b.VertexBuffer.MatricesIndicesKind),c.matricesIndices._isExpanded=!0),this.isVerticesDataPresent(b.VertexBuffer.MatricesWeightsKind)&&(c.matricesWeights=this.getVerticesData(b.VertexBuffer.MatricesWeightsKind)),
c.indices=this.getIndices(),c},e.ExtractFromMesh=function(b,c){var d=b._geometry;return d?d.copy(c):null},e.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=16*Math.random()|0;return("x"===b?c:3&c|8).toString(16)})},e.ImportGeometry=function(c,d){var e=d.getScene(),f=c.geometryId;if(f)(f=e.getGeometryByID(f))&&f.applyToMesh(d);else if(c instanceof ArrayBuffer){f=d._binaryInfo;if(f.positionsAttrDesc&&0<f.positionsAttrDesc.count){var g=new Float32Array(c,
f.positionsAttrDesc.offset,f.positionsAttrDesc.count);d.setVerticesData(b.VertexBuffer.PositionKind,g,!1)}f.normalsAttrDesc&&0<f.normalsAttrDesc.count&&(g=new Float32Array(c,f.normalsAttrDesc.offset,f.normalsAttrDesc.count),d.setVerticesData(b.VertexBuffer.NormalKind,g,!1));f.uvsAttrDesc&&0<f.uvsAttrDesc.count&&(g=new Float32Array(c,f.uvsAttrDesc.offset,f.uvsAttrDesc.count),d.setVerticesData(b.VertexBuffer.UVKind,g,!1));f.uvs2AttrDesc&&0<f.uvs2AttrDesc.count&&(g=new Float32Array(c,f.uvs2AttrDesc.offset,
f.uvs2AttrDesc.count),d.setVerticesData(b.VertexBuffer.UV2Kind,g,!1));f.uvs3AttrDesc&&0<f.uvs3AttrDesc.count&&(g=new Float32Array(c,f.uvs3AttrDesc.offset,f.uvs3AttrDesc.count),d.setVerticesData(b.VertexBuffer.UV3Kind,g,!1));f.uvs4AttrDesc&&0<f.uvs4AttrDesc.count&&(g=new Float32Array(c,f.uvs4AttrDesc.offset,f.uvs4AttrDesc.count),d.setVerticesData(b.VertexBuffer.UV4Kind,g,!1));f.uvs5AttrDesc&&0<f.uvs5AttrDesc.count&&(g=new Float32Array(c,f.uvs5AttrDesc.offset,f.uvs5AttrDesc.count),d.setVerticesData(b.VertexBuffer.UV5Kind,
g,!1));f.uvs6AttrDesc&&0<f.uvs6AttrDesc.count&&(g=new Float32Array(c,f.uvs6AttrDesc.offset,f.uvs6AttrDesc.count),d.setVerticesData(b.VertexBuffer.UV6Kind,g,!1));f.colorsAttrDesc&&0<f.colorsAttrDesc.count&&(g=new Float32Array(c,f.colorsAttrDesc.offset,f.colorsAttrDesc.count),d.setVerticesData(b.VertexBuffer.ColorKind,g,!1,f.colorsAttrDesc.stride));f.matricesIndicesAttrDesc&&0<f.matricesIndicesAttrDesc.count&&(g=new Int32Array(c,f.matricesIndicesAttrDesc.offset,f.matricesIndicesAttrDesc.count),d.setVerticesData(b.VertexBuffer.MatricesIndicesKind,
g,!1));f.matricesWeightsAttrDesc&&0<f.matricesWeightsAttrDesc.count&&(g=new Float32Array(c,f.matricesWeightsAttrDesc.offset,f.matricesWeightsAttrDesc.count),d.setVerticesData(b.VertexBuffer.MatricesWeightsKind,g,!1));f.indicesAttrDesc&&0<f.indicesAttrDesc.count&&(g=new Int32Array(c,f.indicesAttrDesc.offset,f.indicesAttrDesc.count),d.setIndices(g));if(f.subMeshesAttrDesc&&0<f.subMeshesAttrDesc.count){var j=new Int32Array(c,f.subMeshesAttrDesc.offset,5*f.subMeshesAttrDesc.count);d.subMeshes=[];for(g=
0;g<f.subMeshesAttrDesc.count;g++)new b.SubMesh(j[5*g+0],j[5*g+1],j[5*g+2],j[5*g+3],j[5*g+4],d)}}else if(c.positions&&c.normals&&c.indices){if(d.setVerticesData(b.VertexBuffer.PositionKind,c.positions,!1),d.setVerticesData(b.VertexBuffer.NormalKind,c.normals,!1),c.uvs&&d.setVerticesData(b.VertexBuffer.UVKind,c.uvs,!1),c.uvs2&&d.setVerticesData(b.VertexBuffer.UV2Kind,c.uvs2,!1),c.uvs3&&d.setVerticesData(b.VertexBuffer.UV3Kind,c.uvs3,!1),c.uvs4&&d.setVerticesData(b.VertexBuffer.UV4Kind,c.uvs4,!1),c.uvs5&&
d.setVerticesData(b.VertexBuffer.UV5Kind,c.uvs5,!1),c.uvs6&&d.setVerticesData(b.VertexBuffer.UV6Kind,c.uvs6,!1),c.colors&&d.setVerticesData(b.VertexBuffer.ColorKind,b.Color4.CheckColors4(c.colors,c.positions.length/3),!1),c.matricesIndices)if(c.matricesIndices._isExpanded)delete c.matricesIndices._isExpanded,d.setVerticesData(b.VertexBuffer.MatricesIndicesKind,c.matricesIndices,!1);else{f=[];for(g=0;g<c.matricesIndices.length;g++)j=c.matricesIndices[g],f.push(255&j),f.push((65280&j)>>8),f.push((16711680&
j)>>16),f.push(j>>24);d.setVerticesData(b.VertexBuffer.MatricesIndicesKind,f,!1)}if(c.matricesIndicesExtra)if(c.matricesIndicesExtra._isExpanded)delete c.matricesIndices._isExpanded,d.setVerticesData(b.VertexBuffer.MatricesIndicesExtraKind,c.matricesIndicesExtra,!1);else{f=[];for(g=0;g<c.matricesIndicesExtra.length;g++)j=c.matricesIndicesExtra[g],f.push(255&j),f.push((65280&j)>>8),f.push((16711680&j)>>16),f.push(j>>24);d.setVerticesData(b.VertexBuffer.MatricesIndicesExtraKind,f,!1)}c.matricesWeights&&
d.setVerticesData(b.VertexBuffer.MatricesWeightsKind,c.matricesWeights,!1);c.matricesWeightsExtra&&d.setVerticesData(b.VertexBuffer.MatricesWeightsExtraKind,c.matricesWeightsExtra,!1);d.setIndices(c.indices)}if(c.subMeshes){d.subMeshes=[];for(f=0;f<c.subMeshes.length;f++)g=c.subMeshes[f],new b.SubMesh(g.materialIndex,g.verticesStart,g.verticesCount,g.indexStart,g.indexCount,d)}d._shouldGenerateFlatShading&&(d.convertToFlatShadedMesh(),delete d._shouldGenerateFlatShading);d.computeWorldMatrix(!0);
e._selectionOctree&&e._selectionOctree.addMesh(d)},e.Parse=function(c,d,f){if(d.getGeometryByID(c.id))return null;var g=new e(c.id,d);return b.Tags.AddTagsTo(g,c.tags),c.delayLoadingFile?(g.delayLoadState=b.Engine.DELAYLOADSTATE_NOTLOADED,g.delayLoadingFile=f+c.delayLoadingFile,g._boundingInfo=new b.BoundingInfo(b.Vector3.FromArray(c.boundingBoxMinimum),b.Vector3.FromArray(c.boundingBoxMaximum)),g._delayInfo=[],c.hasUVs&&g._delayInfo.push(b.VertexBuffer.UVKind),c.hasUVs2&&g._delayInfo.push(b.VertexBuffer.UV2Kind),
c.hasUVs3&&g._delayInfo.push(b.VertexBuffer.UV3Kind),c.hasUVs4&&g._delayInfo.push(b.VertexBuffer.UV4Kind),c.hasUVs5&&g._delayInfo.push(b.VertexBuffer.UV5Kind),c.hasUVs6&&g._delayInfo.push(b.VertexBuffer.UV6Kind),c.hasColors&&g._delayInfo.push(b.VertexBuffer.ColorKind),c.hasMatricesIndices&&g._delayInfo.push(b.VertexBuffer.MatricesIndicesKind),c.hasMatricesWeights&&g._delayInfo.push(b.VertexBuffer.MatricesWeightsKind),g._delayLoadingFunction=b.VertexData.ImportVertexData):b.VertexData.ImportVertexData(c,
g),d.pushGeometry(g,!0),g},e);b.Geometry=f;var c=f=b.Geometry||(b.Geometry={});f=c.Primitives||(c.Primitives={});var d,g=function(b,d,e,f){c.call(this,b,d,null,!1,f);this._canBeRegenerated=e;this._beingRegenerated=!0;this.regenerate();this._beingRegenerated=!1};d=(__extends(g,c),g.prototype.canBeRegenerated=function(){return this._canBeRegenerated},g.prototype.regenerate=function(){this._canBeRegenerated&&(this._beingRegenerated=!0,this.setAllVerticesData(this._regenerateVertexData(),!1),this._beingRegenerated=
!1)},g.prototype.asNewGeometry=function(b){return c.prototype.copy.call(this,b)},g.prototype.setAllVerticesData=function(b){this._beingRegenerated&&c.prototype.setAllVerticesData.call(this,b,!1)},g.prototype.setVerticesData=function(b,d){this._beingRegenerated&&c.prototype.setVerticesData.call(this,b,d,!1)},g.prototype._regenerateVertexData=function(){throw Error("Abstract method");},g.prototype.copy=function(){throw Error("Must be overriden in sub-classes.");},g.prototype.serialize=function(){var b=
c.prototype.serialize.call(this);return b.canBeRegenerated=this.canBeRegenerated(),b},g);f._Primitive=d;var m=function(c,e,f,g,j,l,p,n,q){void 0===q&&(q=b.Mesh.DEFAULTSIDE);d.call(this,c,e,p,n);this.pathArray=f;this.closeArray=g;this.closePath=j;this.offset=l;this.side=q},g=(__extends(m,d),m.prototype._regenerateVertexData=function(){return b.VertexData.CreateRibbon({pathArray:this.pathArray,closeArray:this.closeArray,closePath:this.closePath,offset:this.offset,sideOrientation:this.side})},m.prototype.copy=
function(b){return new m(b,this.getScene(),this.pathArray,this.closeArray,this.closePath,this.offset,this.canBeRegenerated(),null,this.side)},m);f.Ribbon=g;var j=function(c,e,f,g,j,l){void 0===l&&(l=b.Mesh.DEFAULTSIDE);d.call(this,c,e,g,j);this.size=f;this.side=l},g=(__extends(j,d),j.prototype._regenerateVertexData=function(){return b.VertexData.CreateBox({size:this.size,sideOrientation:this.side})},j.prototype.copy=function(b){return new j(b,this.getScene(),this.size,this.canBeRegenerated(),null,
this.side)},j.prototype.serialize=function(){var b=d.prototype.serialize.call(this);return b.size=this.size,b},j.Parse=function(d,e){if(e.getGeometryByID(d.id))return null;var f=new c.Primitives.Box(d.id,e,d.size,d.canBeRegenerated,null);return b.Tags.AddTagsTo(f,d.tags),e.pushGeometry(f,!0),f},j);f.Box=g;var l=function(c,e,f,g,j,l,p){void 0===p&&(p=b.Mesh.DEFAULTSIDE);d.call(this,c,e,j,l);this.segments=f;this.diameter=g;this.side=p},g=(__extends(l,d),l.prototype._regenerateVertexData=function(){return b.VertexData.CreateSphere({segments:this.segments,
diameter:this.diameter,sideOrientation:this.side})},l.prototype.copy=function(b){return new l(b,this.getScene(),this.segments,this.diameter,this.canBeRegenerated(),null,this.side)},l.prototype.serialize=function(){var b=d.prototype.serialize.call(this);return b.segments=this.segments,b.diameter=this.diameter,b},l.Parse=function(d,e){if(e.getGeometryByID(d.id))return null;var f=new c.Primitives.Sphere(d.id,e,d.segments,d.diameter,d.canBeRegenerated,null);return b.Tags.AddTagsTo(f,d.tags),e.pushGeometry(f,
!0),f},l);f.Sphere=g;var n=function(c,e,f,g,j,l,p){void 0===p&&(p=b.Mesh.DEFAULTSIDE);d.call(this,c,e,j,l);this.radius=f;this.tessellation=g;this.side=p},g=(__extends(n,d),n.prototype._regenerateVertexData=function(){return b.VertexData.CreateDisc({radius:this.radius,tessellation:this.tessellation,sideOrientation:this.side})},n.prototype.copy=function(b){return new n(b,this.getScene(),this.radius,this.tessellation,this.canBeRegenerated(),null,this.side)},n);f.Disc=g;var q=function(c,e,f,g,j,l,p,n,
q,m){void 0===p&&(p=1);void 0===m&&(m=b.Mesh.DEFAULTSIDE);d.call(this,c,e,n,q);this.height=f;this.diameterTop=g;this.diameterBottom=j;this.tessellation=l;this.subdivisions=p;this.side=m},g=(__extends(q,d),q.prototype._regenerateVertexData=function(){return b.VertexData.CreateCylinder({height:this.height,diameterTop:this.diameterTop,diameterBottom:this.diameterBottom,tessellation:this.tessellation,subdivisions:this.subdivisions,sideOrientation:this.side})},q.prototype.copy=function(b){return new q(b,
this.getScene(),this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.canBeRegenerated(),null,this.side)},q.prototype.serialize=function(){var b=d.prototype.serialize.call(this);return b.height=this.height,b.diameterTop=this.diameterTop,b.diameterBottom=this.diameterBottom,b.tessellation=this.tessellation,b},q.Parse=function(d,e){if(e.getGeometryByID(d.id))return null;var f=new c.Primitives.Cylinder(d.id,e,d.height,d.diameterTop,d.diameterBottom,d.tessellation,
d.subdivisions,d.canBeRegenerated,null);return b.Tags.AddTagsTo(f,d.tags),e.pushGeometry(f,!0),f},q);f.Cylinder=g;var p=function(c,e,f,g,j,l,p,n){void 0===n&&(n=b.Mesh.DEFAULTSIDE);d.call(this,c,e,l,p);this.diameter=f;this.thickness=g;this.tessellation=j;this.side=n},g=(__extends(p,d),p.prototype._regenerateVertexData=function(){return b.VertexData.CreateTorus({diameter:this.diameter,thickness:this.thickness,tessellation:this.tessellation,sideOrientation:this.side})},p.prototype.copy=function(b){return new p(b,
this.getScene(),this.diameter,this.thickness,this.tessellation,this.canBeRegenerated(),null,this.side)},p.prototype.serialize=function(){var b=d.prototype.serialize.call(this);return b.diameter=this.diameter,b.thickness=this.thickness,b.tessellation=this.tessellation,b},p.Parse=function(d,e){if(e.getGeometryByID(d.id))return null;var f=new c.Primitives.Torus(d.id,e,d.diameter,d.thickness,d.tessellation,d.canBeRegenerated,null);return b.Tags.AddTagsTo(f,d.tags),e.pushGeometry(f,!0),f},p);f.Torus=g;
var r=function(b,c,e,f,g,j,l){d.call(this,b,c,j,l);this.width=e;this.height=f;this.subdivisions=g},g=(__extends(r,d),r.prototype._regenerateVertexData=function(){return b.VertexData.CreateGround({width:this.width,height:this.height,subdivisions:this.subdivisions})},r.prototype.copy=function(b){return new r(b,this.getScene(),this.width,this.height,this.subdivisions,this.canBeRegenerated(),null)},r.prototype.serialize=function(){var b=d.prototype.serialize.call(this);return b.width=this.width,b.height=
this.height,b.subdivisions=this.subdivisions,b},r.Parse=function(d,e){if(e.getGeometryByID(d.id))return null;var f=new c.Primitives.Ground(d.id,e,d.width,d.height,d.subdivisions,d.canBeRegenerated,null);return b.Tags.AddTagsTo(f,d.tags),e.pushGeometry(f,!0),f},r);f.Ground=g;var t=function(b,c,e,f,g,j,l,p,n,q){d.call(this,b,c,n,q);this.xmin=e;this.zmin=f;this.xmax=g;this.zmax=j;this.subdivisions=l;this.precision=p},g=(__extends(t,d),t.prototype._regenerateVertexData=function(){return b.VertexData.CreateTiledGround({xmin:this.xmin,
zmin:this.zmin,xmax:this.xmax,zmax:this.zmax,subdivisions:this.subdivisions,precision:this.precision})},t.prototype.copy=function(b){return new t(b,this.getScene(),this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision,this.canBeRegenerated(),null)},t);f.TiledGround=g;var s=function(c,e,f,g,j,l){void 0===l&&(l=b.Mesh.DEFAULTSIDE);d.call(this,c,e,g,j);this.size=f;this.side=l},g=(__extends(s,d),s.prototype._regenerateVertexData=function(){return b.VertexData.CreatePlane({size:this.size,
sideOrientation:this.side})},s.prototype.copy=function(b){return new s(b,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)},s.prototype.serialize=function(){var b=d.prototype.serialize.call(this);return b.size=this.size,b},s.Parse=function(d,e){if(e.getGeometryByID(d.id))return null;var f=new c.Primitives.Plane(d.id,e,d.size,d.canBeRegenerated,null);return b.Tags.AddTagsTo(f,d.tags),e.pushGeometry(f,!0),f},s);f.Plane=g;var u=function(c,e,f,g,j,l,p,n,q,m,r){void 0===r&&(r=b.Mesh.DEFAULTSIDE);
d.call(this,c,e,q,m);this.radius=f;this.tube=g;this.radialSegments=j;this.tubularSegments=l;this.p=p;this.q=n;this.side=r},g=(__extends(u,d),u.prototype._regenerateVertexData=function(){return b.VertexData.CreateTorusKnot({radius:this.radius,tube:this.tube,radialSegments:this.radialSegments,tubularSegments:this.tubularSegments,p:this.p,q:this.q,sideOrientation:this.side})},u.prototype.copy=function(b){return new u(b,this.getScene(),this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,
this.q,this.canBeRegenerated(),null,this.side)},u.prototype.serialize=function(){var b=d.prototype.serialize.call(this);return b.radius=this.radius,b.tube=this.tube,b.radialSegments=this.radialSegments,b.tubularSegments=this.tubularSegments,b.p=this.p,b.q=this.q,b},u.Parse=function(d,e){if(e.getGeometryByID(d.id))return null;var f=new c.Primitives.TorusKnot(d.id,e,d.radius,d.tube,d.radialSegments,d.tubularSegments,d.p,d.q,d.canBeRegenerated,null);return b.Tags.AddTagsTo(f,d.tags),e.pushGeometry(f,
!0),f},u);f.TorusKnot=g;!0;!0}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.Mesh;f=function(c,d){e.call(this,c,d);this.generateOctree=!1;this._worldInverse=new b.Matrix};f=(__extends(f,e),Object.defineProperty(f.prototype,"subdivisions",{get:function(){return this._subdivisions},enumerable:!0,configurable:!0}),f.prototype.optimize=function(b,d){void 0===d&&(d=32);this._subdivisions=b;this.subdivide(this._subdivisions);this.createOrUpdateSubmeshesOctree(d)},f.prototype.getHeightAtCoordinates=function(b,d){if(b-=this.position.x,d-=this.position.z,b/=
this.scaling.x,d/=this.scaling.z,b<this._minX||b>this._maxX||d<this._minZ||d>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var e=this._getFacetAt(b,d);return-(e.x*b+e.z*d+e.w)/e.y*this.scaling.y+this.position.y},f.prototype.getNormalAtCoordinates=function(c,d){var e=new b.Vector3(0,1,0);return this.getNormalAtCoordinatesToRef(c,d,e),e},f.prototype.getNormalAtCoordinatesToRef=function(b,d,e){if(b-=this.position.x,
d-=this.position.z,b/=this.scaling.x,d/=this.scaling.z,!(b<this._minX||b>this._maxX||d<this._minZ||d>this._maxZ))this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads()),b=this._getFacetAt(b,d),e.x=b.x,e.y=b.y,e.z=b.z},f.prototype.updateCoordinateHeights=function(){this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads();this._computeHeightQuads()},f.prototype._getFacetAt=function(b,d){var e=this._heightQuads[Math.floor(-(d+this._maxZ)*this._subdivisions/
this._height+this._subdivisions)*this._subdivisions+Math.floor((b+this._maxX)*this._subdivisions/this._width)];return d<e.slope.x*b+e.slope.y?e.facet1:e.facet2},f.prototype._initHeightQuads=function(){this._heightQuads=[];for(var c=0;c<this._subdivisions;c++)for(var d=0;d<this._subdivisions;d++){var e={slope:b.Vector2.Zero(),facet1:new b.Vector4(0,0,0,0),facet2:new b.Vector4(0,0,0,0)};this._heightQuads[c*this._subdivisions+d]=e}},f.prototype._computeHeightQuads=function(){for(var c=this.getVerticesData(b.VertexBuffer.PositionKind),
d=b.Tmp.Vector3[0],e=b.Tmp.Vector3[1],f=b.Tmp.Vector3[2],j=b.Tmp.Vector3[3],l=b.Tmp.Vector3[4],n=b.Tmp.Vector3[5],q=b.Tmp.Vector3[6],p=b.Tmp.Vector3[7],r=b.Tmp.Vector3[8],t=0,s=0,u=0,x=u=s=t=0,y=0;y<this._subdivisions;y++)for(var z=0;z<this._subdivisions;z++){t=3*z;s=3*y*(this._subdivisions+1);u=3*(y+1)*(this._subdivisions+1);d.x=c[s+t];d.y=c[s+t+1];d.z=c[s+t+2];e.x=c[s+t+3];e.y=c[s+t+4];e.z=c[s+t+5];f.x=c[u+t];f.y=c[u+t+1];f.z=c[u+t+2];j.x=c[u+t+3];j.y=c[u+t+4];j.z=c[u+t+5];t=(j.z-d.z)/(j.x-d.x);
s=d.z-t*d.x;e.subtractToRef(d,l);f.subtractToRef(d,n);j.subtractToRef(d,q);b.Vector3.CrossToRef(q,n,p);b.Vector3.CrossToRef(l,q,r);p.normalize();r.normalize();var u=-(p.x*d.x+p.y*d.y+p.z*d.z),x=-(r.x*e.x+r.y*e.y+r.z*e.z),A=this._heightQuads[y*this._subdivisions+z];A.slope.copyFromFloats(t,s);A.facet1.copyFromFloats(p.x,p.y,p.z,u);A.facet2.copyFromFloats(r.x,r.y,r.z,x)}},f);b.GroundMesh=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.Mesh,c=function(c,f,m,j,l){void 0===m&&(m=null);e.call(this,c,f,m,j,l);this.color=new b.Color3(1,1,1);this.alpha=1;this._positionBuffer={};j&&(this.color=j.color.clone(),this.alpha=j.alpha);this._intersectionThreshold=0.1;this._colorShader=new b.ShaderMaterial("colorShader",f,"color",{attributes:[b.VertexBuffer.PositionKind],uniforms:["worldViewProjection","color"],needAlphaBlending:!0});this._positionBuffer[b.VertexBuffer.PositionKind]=null};f=(__extends(c,e),Object.defineProperty(c.prototype,
"intersectionThreshold",{get:function(){return this._intersectionThreshold},set:function(c){this._intersectionThreshold!==c&&(this._intersectionThreshold=c,this.geometry&&(this.geometry.boundingBias=new b.Vector2(0,c)))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"material",{get:function(){return this._colorShader},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"checkCollisions",{get:function(){return!1},enumerable:!0,configurable:!0}),c.prototype.createInstance=
function(){return b.Tools.Log("LinesMeshes do not support createInstance."),null},c.prototype._bind=function(){var c=this.getScene().getEngine();this._positionBuffer[b.VertexBuffer.PositionKind]=this._geometry.getVertexBuffer(b.VertexBuffer.PositionKind);c.bindBuffers(this._positionBuffer,this._geometry.getIndexBuffer(),this._colorShader.getEffect());this._colorShader.setColor4("color",this.color.toColor4(this.alpha))},c.prototype._draw=function(b){this._geometry&&(this._geometry.getVertexBuffers()&&
this._geometry.getIndexBuffer())&&this.getScene().getEngine().draw(!1,b.indexStart,b.indexCount)},c.prototype.dispose=function(b){this._colorShader.dispose();e.prototype.dispose.call(this,b)},c.prototype.clone=function(b,e,f){return new c(b,this.getScene(),e,this,f)},c);b.LinesMesh=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(b,c,d){var f=this;void 0===c&&(c="");void 0===d&&(d="black");this._renderingCanvas=b;this._loadingText=c;this._loadingDivBackgroundColor=d;this._resizeLoadingUI=function(){var b=f._renderingCanvas.getBoundingClientRect();f._loadingDiv.style.position="absolute";f._loadingDiv.style.left=b.left+"px";f._loadingDiv.style.top=b.top+"px";f._loadingDiv.style.width=b.width+"px";f._loadingDiv.style.height=b.height+"px"}};f=(f.prototype.displayLoadingUI=function(){var b=this;if(!this._loadingDiv){this._loadingDiv=
document.createElement("div");this._loadingDiv.id="babylonjsLoadingDiv";this._loadingDiv.style.opacity="0";this._loadingDiv.style.transition="opacity 1.5s ease";this._loadingTextDiv=document.createElement("div");this._loadingTextDiv.style.position="absolute";this._loadingTextDiv.style.left="0";this._loadingTextDiv.style.top="50%";this._loadingTextDiv.style.marginTop="80px";this._loadingTextDiv.style.width="100%";this._loadingTextDiv.style.height="20px";this._loadingTextDiv.style.fontFamily="Arial";
this._loadingTextDiv.style.fontSize="14px";this._loadingTextDiv.style.color="white";this._loadingTextDiv.style.textAlign="center";this._loadingTextDiv.innerHTML="Loading";this._loadingDiv.appendChild(this._loadingTextDiv);this._loadingTextDiv.innerHTML=this._loadingText;var c=new Image;c.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAARbSURBVHhe7Z09aFNRFMc716kuLrq4FdyLq4Wi4CAoRQcR0UJBUBdRiuLSIYMo6CA4FF2sgw6CFAdFUOpSQYcWO4hD26UQCfXrIQrx/JJzw1OSWq3NPeL/B4Fy+0jg/HO+7j3vpUcI8b/Q39+/49ihfWdPHT94Yf/e3Se3bd263f8lus218TPn6vV6Ya8Wi/MzNRNmj18iusX9W1evmP1/EKNEIVG6CMbG6E3bt+fT++pHha8NoHdT72bLE8NDg7tGU64gLLndV4Wc4m8j/pS+vr4tGB/DT16v3Fyr8dvBe/jbit8BL0AES9LX1iPAz+BR/hFiLVCynj95dPzNy6fv3IZ/k4L3948Sq7FzYGBg4vLFGxitabuOFCbWNKGrMnbiUuo18KaV6tIHv6YtvL9/nOgE31jCktmrY7k6+/zhE4yP4Vf7hiNqh/BWWEl8mzDol4p22Lf7cIdvdUMEvv0Y2S9fE5S1hLzpqTsPkiep//gFGPnR3Yl7GL5p/xYFBrTwM+iXio3GqpwDGL5p/xYNIX7XG8Q6IJRgdIzf1KBBgafII7oMidhyQtVFaMA2Bt7il4huQRhaXphbcR2g4RXqBzKAGHiCCwGFVUAj/m/RTRDj29cvn10I0PZ3LghH5f4CL1EFlQmqqXK3jDDKFxmhQ3Yt6oQseUZGKmMnTpsOqc8o1F9kBOMjQlOLeqEeIyOc6JV6jYLJD/+XyIFvnzdgl9aXRQ5I2qZDK1SpospMqaoqON/wZZGDciLnMMiXRS7IF4hhqMTNTdk7CFu+LHLhR7BQqBvPDJUUQqCGvCMATHUgBmhWNgApmdOda9YpM+VwRYfuyyIXDK8hBlilNerLIheMZCKGwlUAyru6GlwOgPUbRxADdJ9FAChxXY864viyyEXqPxhc0M2TAfAbatSdRyHtXymhByEdRnE3ky+JnHAIhSA0h74kckETmHoQbSgGwJrCIRMEPSRIBCRIMAhZaYhaggQhJXUJEoRU9mofKwh+F22dLRRfEjlJM7w6KQwCoQpBOKTyJZETjmwRxKqtGV8SOSkNOGjKPQppBEgDDkFgpxdBVGkFgaYQQXRIFQSObk0P5ZFIpAZRHXsQ0r0hCluBWKkuvVbYCkQaCdL5ehBScudJP4yY+rLISdps1NBDEJKXMMmoSfggWC4ZQRR17oFYXph7hSiquIKQ+hJGTX1J5MYSPD/GVdNzsgLBwZVCVyAQAkF0ohiI/c1fS6tNXq9UfEnkhudmIQolsS+J3Hh/UtNDzQLhj42VKJFInqLwFYiUU5ToA+HdfI0JevUpQUAIn+vSz2lHIuUV/dJOIHhOY/IWVWGBIHQtzs88s9zyWBuTgcBLzGOmeNnfF/QslSDgMeQW85i3DOQxuipxAkCyZ8SIm4Omp+7MMlCB59j6sKZcMoM4iIEoeI2J9AKxrFobZx0v4vYInuHFS4J1GQRCAGaLEYQXfyMML5XSQgghhBBCCCH+cXp6vgNhKpSKX/XdOAAAAABJRU5ErkJggg==";
c.style.position="absolute";c.style.left="50%";c.style.top="50%";c.style.marginLeft="-50px";c.style.marginTop="-50px";c.style.transition="transform 1.0s ease";c.style.webkitTransition="-webkit-transform 1.0s ease";var d=360,f=function(){d+=360;c.style.transform="rotateZ("+d+"deg)";c.style.webkitTransform="rotateZ("+d+"deg)"};c.addEventListener("transitionend",f);c.addEventListener("webkitTransitionEnd",f);this._loadingDiv.appendChild(c);f=new Image;f.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAAYJSURBVHhe7Zy/qx1FFMff/2Av2Nvbi4WFiiAEY/OQ2IgQsbCJQoqkCAgpFLXyoZURLfwBIiIpgqZJoYQYlWelNsIrNOxDJcrzfHe+G97dnTl75u7euzv7zgcWHrlnZmfOmXPmzI/NjuM4juM4juM4juM4juM4juM4juM4juM45fPic08/uHf5/CvffH7lnT8PfrtxdHS0n3p+/fHGl5+89/prr5599iEWd8bg0rkXHoFyqehKnlxQpjYSDHTm9JMPsGrHylOPPXofvICKXMcIGtXdf/76AYbm6xyNW9e/eAtKC7rbKLXnvHHx5Sf4auc4Ek7OQkFU1Dap/vv37k/wSjblZANFiFIGzw98hhizwqBgs04mCBdQRNCHidoAEtY+lLIvtSdoGFeyql2ZH57HBH4sE7O+o/r9l+8/ZXUni68+2jsHBQQ9qNRGeP/tSxdSYQX/roUcpL4/f3vtM9TD+jTq92n1LQ7jxF1hhGPtwWL3gGccy8JuS1r8sVWBGXNVdSKMYjBGPUJjCzooiGuSpnwlnnOGP2dhHRSLNgpHp2oMKIriK8TmG4Qh/rwW8D6pps9b9im+LDDipXOqMVJrAngBfg9i98gevWKA+/nnCod3Dr5GfaHaDgidVym6HKRjGIkpqthcAVKGxNqBImbEo66kjCih8AOpNmkUmbMuUrR8kEqiU6FvHZLGAPJ71JCYSyhiBqmwFE2GoD6jLGIfDHtG6EzoU4dK21PCqIRMEF0FGRjFzGDtIkXVAdATvsqfT9CJ0JcOFdYiFIsiMlqYy1YOFpQo2OddqBtyEaq9y+efoVh5oPHoROjLKn0j3JIE5Ka8UqZRtGrMnneX6yVofOhDh94MSbznTcpqmDOt1vyQzOgaJAF4F3JBfIXesrNEGWWmjIX7UBZ6jRJbBMLg/DmJiKUGVHleIpnVNTa+jakzkAviJqLhi4MC9XQGBrZeKJZESSrKy7ik0VGFWhQBRDTHIACKQ5l9nAjy75gya4a2w+Jhs0FJdc0xX/GwUbAqFBkZi7QpJ2w16WUbjFyK9MJF3KaoEM74KhVtLrQOrsmRxkbdHEqmSC/c+EuGnIFkjW7Ih2Kr4CCMIvNG2hrrgLpCjiFloooYCjyYrzCRyvhyBthkIPuQtsZGdnbMTezyDiU71KTC5zr7aVsHbsz2tllrEkS5UHwU1tq1HbtPW4UbeB0O7xx8R5EsMJql+BheUmHjkNVmIRP7LutoM3+D4O4tG7vCkNO9ESZ4lL3J6rKRMPx4qKbD/A0icf8CG7tC7kTahnMTwleuYSrsS7GatRAvfZh1tTm5BmmQCdZ8a0Sefe28xUrRBkmFLKy8KTIKUDRX0Y1xagPgwbaIdeFnQULmKak3xvwNMkVGgok/N5XNoehJvejRlCDl9escI28dJU0tZ++nBTJE9mEF647x5Ehbo4s5hDOKFIU0PdofeA5F5k1q63zIWmQqNI/P3ZubjFTqKxQ3jyjHAOX0RdlgVO9hzRFpczRcjZ3Gbxxpc7Qj6+5pTYF2OFXawNI+yDGf1k2NcvOlzBQeDQ/t7zD7DsEDpJ2xATXaNtDWUS4IzP4DS2ljajAVu57SUkYw245ptxZxA5JiZaJ0DswudGn3kYUy54426EjoT4dZfYbccxC2nI92cDkZHQr96jD4AGkMDKeSy/COBsRe6VTSKFN6irLeaCh3IteQjt1E5+oudsG/b/2DfZ5AqsYo8vMDK9LB1HzSsLWvlGThdxXvC6+NsqyPPWP0pMINtbdsajfVeC6f/GZ+cdAofQoB1d+Hf9waY98I7+RXWab3Lt4zYkjHtTnlOLXHYMsCh1zWeQYehu1zfNPOOiys/d91LAKEBSgh6MJMbSA82AaHofDgAIwbgvVvlLNS11nModMm4UZergLHZBZrodmBuA3lBB1thdorSjkOmATMDwg/UBQVtglqQyx6fbEJ+H3IWIapjYAjAfeIgeCMHldueJvFaqDaAHhwf8qNsEEQ1iQbOoUUGIbCLRc8+Bvfp4jyd2FEijuO4ziO4ziO4ziO4ziO4ziO4ziO4ziOUzw7O/8D0P7rcZ/GEboAAAAASUVORK5CYII=";
f.style.position="absolute";f.style.left="50%";f.style.top="50%";f.style.marginLeft="-50px";f.style.marginTop="-50px";this._loadingDiv.appendChild(f);this._resizeLoadingUI();window.addEventListener("resize",this._resizeLoadingUI);this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor;document.body.appendChild(this._loadingDiv);setTimeout(function(){b._loadingDiv.style.opacity="1";c.style.transform="rotateZ(360deg)";c.style.webkitTransform="rotateZ(360deg)"},0)}},f.prototype.hideLoadingUI=
function(){var b=this;this._loadingDiv&&(this._loadingDiv.style.opacity="0",this._loadingDiv.addEventListener("transitionend",function(){b._loadingDiv&&(document.body.removeChild(b._loadingDiv),window.removeEventListener("resize",b._resizeLoadingUI),b._loadingDiv=null)}))},Object.defineProperty(f.prototype,"loadingUIText",{set:function(b){this._loadingText=b;this._loadingTextDiv&&(this._loadingTextDiv.innerHTML=this._loadingText)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,
"loadingUIBackgroundColor",{get:function(){return this._loadingDivBackgroundColor},set:function(b){this._loadingDivBackgroundColor=b;this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor)},enumerable:!0,configurable:!0}),f);b.DefaultLoadingScreen=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(){this._audioContext=null;this.unlocked=this.WarnedWebAudioUnsupported=this.canUseWebAudio=this._audioContextInitialized=!1;"undefined"==typeof window.AudioContext&&"undefined"==typeof window.webkitAudioContext||(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.canUseWebAudio=!0);/iPad|iPhone|iPod/.test(navigator.platform)?this._unlockiOSaudio():this.unlocked=!0};f=(Object.defineProperty(f.prototype,"audioContext",{get:function(){return this._audioContextInitialized||
this._initializeAudioContext(),this._audioContext},enumerable:!0,configurable:!0}),f.prototype._unlockiOSaudio=function(){var b=this,c=function(){var d=b.audioContext.createBuffer(1,1,22050),f=b.audioContext.createBufferSource();f.buffer=d;f.connect(b.audioContext.destination);f.start(0);setTimeout(function(){f.playbackState!==f.PLAYING_STATE&&f.playbackState!==f.FINISHED_STATE||(b.unlocked=!0,window.removeEventListener("touchend",c,!1),b.onAudioUnlocked&&b.onAudioUnlocked())},0)};window.addEventListener("touchend",
c,!1)},f.prototype._initializeAudioContext=function(){try{this.canUseWebAudio&&(this._audioContext=new AudioContext,this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this._audioContext.destination),this._audioContextInitialized=!0)}catch(e){this.canUseWebAudio=!1,b.Tools.Error("Web Audio: "+e.message)}},f.prototype.dispose=function(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&(this._connectedAnalyser.stopDebugCanvas(),
this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1);this.WarnedWebAudioUnsupported=!1},f.prototype.getGlobalVolume=function(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1},f.prototype.setGlobalVolume=function(b){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=b)},f.prototype.connectToAnalyser=function(b){this._connectedAnalyser&&
this._connectedAnalyser.stopDebugCanvas();this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser=b,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))},f);b.AudioEngine=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(c,d,e,f,j){var l=this;this.spatialSound=this.useCustomAttenuation=this.loop=this.autoplay=!1;this.rolloffFactor=this.refDistance=1;this.maxDistance=100;this.distanceModel="linear";this._panningModel="equalpower";this._playbackRate=1;this._streaming=!1;this._startOffset=this._startTime=0;this._position=b.Vector3.Zero();this._localDirection=new b.Vector3(1,0,0);this._volume=1;this._isDirectional=this.isPaused=this.isPlaying=this._isReadyToPlay=this._isLoaded=!1;this._coneOuterAngle=
this._coneInnerAngle=360;this._coneOuterGain=0;this._isOutputConnected=!1;this.name=c;this._scene=e;this._readyToPlayCallback=f;this._customAttenuationFunction=function(b,c,d){return d>c?b*(1-c/d):0};j&&(this.autoplay=j.autoplay||!1,this.loop=j.loop||!1,void 0!==j.volume&&(this._volume=j.volume),this.spatialSound=j.spatialSound||!1,this.maxDistance=j.maxDistance||100,this.useCustomAttenuation=j.useCustomAttenuation||!1,this.rolloffFactor=j.rolloffFactor||1,this.refDistance=j.refDistance||1,this.distanceModel=
j.distanceModel||"linear",this._playbackRate=j.playbackRate||1,this._streaming=j.streaming||!1);b.Engine.audioEngine.canUseWebAudio?(this._soundGain=b.Engine.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._ouputAudioNode=this._soundGain,this.spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.AddSound(this),d&&("string"==typeof d?this._streaming?(this._htmlAudioElement=new Audio(d),this._htmlAudioElement.controls=
!1,this._htmlAudioElement.loop=this.loop,this._htmlAudioElement.crossOrigin="anonymous",this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",function(){l._isReadyToPlay=!0;l.autoplay&&l.play();l._readyToPlayCallback&&l._readyToPlayCallback()}),document.body.appendChild(this._htmlAudioElement)):b.Tools.LoadFile(d,function(b){l._soundLoaded(b)},null,this._scene.database,!0):d instanceof ArrayBuffer?0<d.byteLength&&this._soundLoaded(d):b.Tools.Error("Parameter must be a URL to the sound or an ArrayBuffer of the sound."))):
(this._scene.mainSoundTrack.AddSound(this),b.Engine.audioEngine.WarnedWebAudioUnsupported||(b.Tools.Error("Web Audio is not supported by your browser."),b.Engine.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout(function(){l._readyToPlayCallback()},1E3))};f=(e.prototype.dispose=function(){b.Engine.audioEngine.canUseWebAudio&&this._isReadyToPlay&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.RemoveSound(this):
this._scene.soundTracks[this.soundTrackId].RemoveSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement)),this._connectedMesh&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),
this._connectedMesh=null))},e.prototype._soundLoaded=function(c){var d=this;this._isLoaded=!0;b.Engine.audioEngine.audioContext.decodeAudioData(c,function(b){d._audioBuffer=b;d._isReadyToPlay=!0;d.autoplay&&d.play();d._readyToPlayCallback&&d._readyToPlayCallback()},function(){b.Tools.Error("Error while decoding audio data for: "+d.name)})},e.prototype.setAudioBuffer=function(c){b.Engine.audioEngine.canUseWebAudio&&(this._audioBuffer=c,this._isReadyToPlay=!0)},e.prototype.updateOptions=function(b){b&&
(this.loop=b.loop||this.loop,this.maxDistance=b.maxDistance||this.maxDistance,this.useCustomAttenuation=b.useCustomAttenuation||this.useCustomAttenuation,this.rolloffFactor=b.rolloffFactor||this.rolloffFactor,this.refDistance=b.refDistance||this.refDistance,this.distanceModel=b.distanceModel||this.distanceModel,this._playbackRate=b.playbackRate||this._playbackRate,this._updateSpatialParameters(),this.isPlaying&&(this._streaming?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource.playbackRate.value=
this._playbackRate))},e.prototype._createSpatialParameters=function(){b.Engine.audioEngine.canUseWebAudio&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=b.Engine.audioEngine.audioContext.createPanner(),this._updateSpatialParameters(),this._soundPanner.connect(this._ouputAudioNode),this._inputAudioNode=this._soundPanner)},e.prototype._updateSpatialParameters=function(){this.spatialSound&&(this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=
Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},e.prototype.switchPanningModelToHRTF=function(){this._panningModel="HRTF";this._switchPanningModel()},e.prototype.switchPanningModelToEqualPower=
function(){this._panningModel="equalpower";this._switchPanningModel()},e.prototype._switchPanningModel=function(){b.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&(this._soundPanner.panningModel=this._panningModel)},e.prototype.connectToSoundTrackAudioNode=function(c){b.Engine.audioEngine.canUseWebAudio&&(this._isOutputConnected&&this._ouputAudioNode.disconnect(),this._ouputAudioNode.connect(c),this._isOutputConnected=!0)},e.prototype.setDirectionalCone=function(c,d,e){return c>d?void b.Tools.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):
(this._coneInnerAngle=c,this._coneOuterAngle=d,this._coneOuterGain=e,this._isDirectional=!0,void(this.isPlaying&&this.loop&&(this.stop(),this.play())))},e.prototype.setPosition=function(c){this._position=c;b.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z)},e.prototype.setLocalDirectionToMesh=function(c){this._localDirection=c;b.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.isPlaying&&this._updateDirection()},
e.prototype._updateDirection=function(){var c=this._connectedMesh.getWorldMatrix(),c=b.Vector3.TransformNormal(this._localDirection,c);c.normalize();this._soundPanner.setOrientation(c.x,c.y,c.z)},e.prototype.updateDistanceFromListener=function(){if(b.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.useCustomAttenuation){var c=this._connectedMesh.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,c,this.maxDistance,this.refDistance,
this.rolloffFactor)}},e.prototype.setAttenuationFunction=function(b){this._customAttenuationFunction=b},e.prototype.play=function(c){var d=this;if(this._isReadyToPlay&&this._scene.audioEnabled)try{0>this._startOffset&&(c=-this._startOffset,this._startOffset=0);var e=c?b.Engine.audioEngine.audioContext.currentTime+c:b.Engine.audioEngine.audioContext.currentTime;this._soundSource&&this._streamingSource||this.spatialSound&&(this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z),
this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedMesh?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z)));this._streaming?(this._streamingSource||(this._streamingSource=b.Engine.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=
function(){d._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource.disconnect(),this._streamingSource.connect(this._inputAudioNode),this._htmlAudioElement.play()):(this._soundSource=b.Engine.audioEngine.audioContext.createBufferSource(),this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=function(){d._onended()},
this._soundSource.start(e,this.isPaused?this._startOffset%this._soundSource.buffer.duration:0));this._startTime=e;this.isPlaying=!0;this.isPaused=!1}catch(f){b.Tools.Error("Error while trying to play audio: "+this.name+", "+f.message)}},e.prototype._onended=function(){this.isPlaying=!1;this.onended&&this.onended()},e.prototype.stop=function(c){this.isPlaying&&(this._streaming?(this._htmlAudioElement.pause(),0<this._htmlAudioElement.currentTime&&(this._htmlAudioElement.currentTime=0)):(this._soundSource.stop(c?
b.Engine.audioEngine.audioContext.currentTime+c:b.Engine.audioEngine.audioContext.currentTime),this._soundSource.onended=null,this.isPaused||(this._startOffset=0)),this.isPlaying=!1)},e.prototype.pause=function(){this.isPlaying&&(this.isPaused=!0,this._streaming?this._htmlAudioElement.pause():(this.stop(0),this._startOffset+=b.Engine.audioEngine.audioContext.currentTime-this._startTime))},e.prototype.setVolume=function(c,d){b.Engine.audioEngine.canUseWebAudio&&(d?(this._soundGain.gain.cancelScheduledValues(b.Engine.audioEngine.audioContext.currentTime),
this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,b.Engine.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(c,b.Engine.audioEngine.audioContext.currentTime+d)):this._soundGain.gain.value=c);this._volume=c},e.prototype.setPlaybackRate=function(b){this._playbackRate=b;this.isPlaying&&(this._streaming?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource.playbackRate.value=this._playbackRate)},e.prototype.getVolume=function(){return this._volume},
e.prototype.attachToMesh=function(b){var d=this;this._connectedMesh&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null);this._connectedMesh=b;this.spatialSound||(this.spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play()));this._onRegisterAfterWorldMatrixUpdate(this._connectedMesh);this._registerFunc=function(b){return d._onRegisterAfterWorldMatrixUpdate(b)};b.registerAfterWorldMatrixUpdate(this._registerFunc)},
e.prototype.detachFromMesh=function(){this._connectedMesh&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedMesh=null)},e.prototype._onRegisterAfterWorldMatrixUpdate=function(c){this.setPosition(c.getBoundingInfo().boundingSphere.centerWorld);b.Engine.audioEngine.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()},e.prototype.clone=function(){var b=this;if(this._streaming)return null;var d=function(){b._isReadyToPlay?
(m._audioBuffer=b.getAudioBuffer(),m._isReadyToPlay=!0,m.autoplay&&m.play()):window.setTimeout(d,300)},f={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},m=new e(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,f);return this.useCustomAttenuation&&m.setAttenuationFunction(this._customAttenuationFunction),
m.setPosition(this._position),m.setPlaybackRate(this._playbackRate),d(),m},e.prototype.getAudioBuffer=function(){return this._audioBuffer},e.Parse=function(c,d,f,m){var j=c.name;f=c.url?f+c.url:f+j;var l,n={autoplay:c.autoplay,loop:c.loop,volume:c.volume,spatialSound:c.spatialSound,maxDistance:c.maxDistance,rolloffFactor:c.rolloffFactor,refDistance:c.refDistance,distanceModel:c.distanceModel,playbackRate:c.playbackRate};if(m){var q=function(){m._isReadyToPlay?(l._audioBuffer=m.getAudioBuffer(),l._isReadyToPlay=
!0,l.autoplay&&l.play()):window.setTimeout(q,300)};l=new e(j,new ArrayBuffer(0),d,null,n);q()}else l=new e(j,f,d,function(){d._removePendingData(l)},n),d._addPendingData(l);c.position&&(j=b.Vector3.FromArray(c.position),l.setPosition(j));if(c.isDirectional&&(l.setDirectionalCone(c.coneInnerAngle||360,c.coneOuterAngle||360,c.coneOuterGain||0),c.localDirectionToMesh))j=b.Vector3.FromArray(c.localDirectionToMesh),l.setLocalDirectionToMesh(j);c.connectedMeshId&&(c=d.getMeshByID(c.connectedMeshId))&&l.attachToMesh(c);
return l},e);b.Sound=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(b,c){this.id=-1;this._isInitialized=this._isMainTrack=!1;this._scene=b;this.soundCollection=[];this._options=c;this._isMainTrack||(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1)};f=(f.prototype._initializeSoundTrackAudioGraph=function(){b.Engine.audioEngine.canUseWebAudio&&(this._outputAudioNode=b.Engine.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(b.Engine.audioEngine.masterGain),this._options&&(this._options.volume&&
(this._outputAudioNode.gain.value=this._options.volume),this._options.mainTrack&&(this._isMainTrack=this._options.mainTrack)),this._isInitialized=!0)},f.prototype.dispose=function(){if(b.Engine.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect();this._outputAudioNode=null}},f.prototype.AddSound=function(e){this._isInitialized||this._initializeSoundTrackAudioGraph();
b.Engine.audioEngine.canUseWebAudio&&e.connectToSoundTrackAudioNode(this._outputAudioNode);e.soundTrackId&&(-1===e.soundTrackId?this._scene.mainSoundTrack.RemoveSound(e):this._scene.soundTracks[e.soundTrackId].RemoveSound(e));this.soundCollection.push(e);e.soundTrackId=this.id},f.prototype.RemoveSound=function(b){b=this.soundCollection.indexOf(b);-1!==b&&this.soundCollection.splice(b,1)},f.prototype.setVolume=function(e){b.Engine.audioEngine.canUseWebAudio&&(this._outputAudioNode.gain.value=e)},f.prototype.switchPanningModelToHRTF=
function(){if(b.Engine.audioEngine.canUseWebAudio)for(var e=0;e<this.soundCollection.length;e++)this.soundCollection[e].switchPanningModelToHRTF()},f.prototype.switchPanningModelToEqualPower=function(){if(b.Engine.audioEngine.canUseWebAudio)for(var e=0;e<this.soundCollection.length;e++)this.soundCollection[e].switchPanningModelToEqualPower()},f.prototype.connectToAnalyser=function(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this._connectedAnalyser=e;b.Engine.audioEngine.canUseWebAudio&&
(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,b.Engine.audioEngine.masterGain))},f);b.SoundTrack=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(){};f=(e.TransformCoordinatesToRefSIMD=function(b,c,d){b=SIMD.float32x4.loadXYZ(b._data,0);var e=SIMD.float32x4.load(c.m,0),f=SIMD.float32x4.load(c.m,4),g=SIMD.float32x4.load(c.m,8);c=SIMD.float32x4.load(c.m,12);c=SIMD.float32x4.add(SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,0,0,0,0),e),SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,1,1,1,1),f)),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,2,2,2,2),g),c));c=SIMD.float32x4.div(c,SIMD.float32x4.swizzle(c,
3,3,3,3));SIMD.float32x4.storeXYZ(d._data,0,c)},e.TransformCoordinatesFromFloatsToRefSIMD=function(b,c,d,e,f){b=SIMD.float32x4.splat(b);c=SIMD.float32x4.splat(c);d=SIMD.float32x4.splat(d);var g=SIMD.float32x4.load(e.m,0),j=SIMD.float32x4.load(e.m,4),l=SIMD.float32x4.load(e.m,8);e=SIMD.float32x4.load(e.m,12);e=SIMD.float32x4.add(SIMD.float32x4.add(SIMD.float32x4.mul(b,g),SIMD.float32x4.mul(c,j)),SIMD.float32x4.add(SIMD.float32x4.mul(d,l),e));e=SIMD.float32x4.div(e,SIMD.float32x4.swizzle(e,3,3,3,3));
SIMD.float32x4.storeXYZ(f._data,0,e)},e);b.SIMDVector3=f;var c,e=function(){};c=(e.prototype.multiplyToArraySIMD=function(b,c,d){void 0===d&&(d=0);var e=this.m,f=b.m;b=SIMD.float32x4.load(f,0);var g=SIMD.float32x4.load(f,4),j=SIMD.float32x4.load(f,8),f=SIMD.float32x4.load(f,12),l=SIMD.float32x4.load(e,0);SIMD.float32x4.store(c,d+0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,0,0,0,0),b),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,
2,2,2,2),j),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,3,3,3,3),f)))));l=SIMD.float32x4.load(e,4);SIMD.float32x4.store(c,d+4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,0,0,0,0),b),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,2,2,2),j),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,3,3,3,3),f)))));l=SIMD.float32x4.load(e,8);SIMD.float32x4.store(c,d+8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,
0,0,0,0),b),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,2,2,2),j),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,3,3,3,3),f)))));e=SIMD.float32x4.load(e,12);SIMD.float32x4.store(c,d+12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(e,0,0,0,0),b),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(e,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(e,2,2,2,2),j),
SIMD.float32x4.mul(SIMD.float32x4.swizzle(e,3,3,3,3),f)))))},e.prototype.invertToRefSIMD=function(b){var c,d,e,f,g,j,l,n,m,B,C=this.m;b=b.m;var D=SIMD.float32x4.load(C,0),E=SIMD.float32x4.load(C,4),I=SIMD.float32x4.load(C,8),C=SIMD.float32x4.load(C,12);return g=SIMD.float32x4.shuffle(D,E,0,1,4,5),d=SIMD.float32x4.shuffle(I,C,0,1,4,5),c=SIMD.float32x4.shuffle(g,d,0,2,4,6),d=SIMD.float32x4.shuffle(d,g,1,3,5,7),g=SIMD.float32x4.shuffle(D,E,2,3,6,7),f=SIMD.float32x4.shuffle(I,C,2,3,6,7),e=SIMD.float32x4.shuffle(g,
f,0,2,4,6),f=SIMD.float32x4.shuffle(f,g,1,3,5,7),g=SIMD.float32x4.mul(e,f),g=SIMD.float32x4.swizzle(g,1,0,3,2),j=SIMD.float32x4.mul(d,g),l=SIMD.float32x4.mul(c,g),g=SIMD.float32x4.swizzle(g,2,3,0,1),j=SIMD.float32x4.sub(SIMD.float32x4.mul(d,g),j),l=SIMD.float32x4.sub(SIMD.float32x4.mul(c,g),l),l=SIMD.float32x4.swizzle(l,2,3,0,1),g=SIMD.float32x4.mul(d,e),g=SIMD.float32x4.swizzle(g,1,0,3,2),j=SIMD.float32x4.add(SIMD.float32x4.mul(f,g),j),m=SIMD.float32x4.mul(c,g),g=SIMD.float32x4.swizzle(g,2,3,0,1),
j=SIMD.float32x4.sub(j,SIMD.float32x4.mul(f,g)),m=SIMD.float32x4.sub(SIMD.float32x4.mul(c,g),m),m=SIMD.float32x4.swizzle(m,2,3,0,1),g=SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,2,3,0,1),f),g=SIMD.float32x4.swizzle(g,1,0,3,2),e=SIMD.float32x4.swizzle(e,2,3,0,1),j=SIMD.float32x4.add(SIMD.float32x4.mul(e,g),j),n=SIMD.float32x4.mul(c,g),g=SIMD.float32x4.swizzle(g,2,3,0,1),j=SIMD.float32x4.sub(j,SIMD.float32x4.mul(e,g)),n=SIMD.float32x4.sub(SIMD.float32x4.mul(c,g),n),n=SIMD.float32x4.swizzle(n,2,3,0,
1),g=SIMD.float32x4.mul(c,d),g=SIMD.float32x4.swizzle(g,1,0,3,2),n=SIMD.float32x4.add(SIMD.float32x4.mul(f,g),n),m=SIMD.float32x4.sub(SIMD.float32x4.mul(e,g),m),g=SIMD.float32x4.swizzle(g,2,3,0,1),n=SIMD.float32x4.sub(SIMD.float32x4.mul(f,g),n),m=SIMD.float32x4.sub(m,SIMD.float32x4.mul(e,g)),g=SIMD.float32x4.mul(c,f),g=SIMD.float32x4.swizzle(g,1,0,3,2),l=SIMD.float32x4.sub(l,SIMD.float32x4.mul(e,g)),n=SIMD.float32x4.add(SIMD.float32x4.mul(d,g),n),g=SIMD.float32x4.swizzle(g,2,3,0,1),l=SIMD.float32x4.add(SIMD.float32x4.mul(e,
g),l),n=SIMD.float32x4.sub(n,SIMD.float32x4.mul(d,g)),g=SIMD.float32x4.mul(c,e),g=SIMD.float32x4.swizzle(g,1,0,3,2),l=SIMD.float32x4.add(SIMD.float32x4.mul(f,g),l),m=SIMD.float32x4.sub(m,SIMD.float32x4.mul(d,g)),g=SIMD.float32x4.swizzle(g,2,3,0,1),l=SIMD.float32x4.sub(l,SIMD.float32x4.mul(f,g)),m=SIMD.float32x4.add(SIMD.float32x4.mul(d,g),m),B=SIMD.float32x4.mul(c,j),B=SIMD.float32x4.add(SIMD.float32x4.swizzle(B,2,3,0,1),B),B=SIMD.float32x4.add(SIMD.float32x4.swizzle(B,1,0,3,2),B),g=SIMD.float32x4.reciprocalApproximation(B),
B=SIMD.float32x4.sub(SIMD.float32x4.add(g,g),SIMD.float32x4.mul(B,SIMD.float32x4.mul(g,g))),B=SIMD.float32x4.swizzle(B,0,0,0,0),j=SIMD.float32x4.mul(B,j),l=SIMD.float32x4.mul(B,l),n=SIMD.float32x4.mul(B,n),m=SIMD.float32x4.mul(B,m),SIMD.float32x4.store(b,0,j),SIMD.float32x4.store(b,4,l),SIMD.float32x4.store(b,8,n),SIMD.float32x4.store(b,12,m),this},e.LookAtLHToRefSIMD=function(b,c,d,e){e=e.m;c=SIMD.float32x4(c.x,c.y,c.z,0);b=SIMD.float32x4(b.x,b.y,b.z,0);var f=SIMD.float32x4(d.x,d.y,d.z,0),g=SIMD.float32x4.sub(c,
b);d=SIMD.float32x4.mul(g,g);d=SIMD.float32x4.add(d,SIMD.float32x4.add(SIMD.float32x4.swizzle(d,1,2,0,3),SIMD.float32x4.swizzle(d,2,0,1,3)));g=SIMD.float32x4.mul(g,SIMD.float32x4.reciprocalSqrtApproximation(d));d=SIMD.float32x4.mul(f,f);d=SIMD.float32x4.add(d,SIMD.float32x4.add(SIMD.float32x4.swizzle(d,1,2,0,3),SIMD.float32x4.swizzle(d,2,0,1,3)));f=SIMD.float32x4.mul(f,SIMD.float32x4.reciprocalSqrtApproximation(d));f=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(g,1,2,0,3),SIMD.float32x4.swizzle(f,
2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(g,2,0,1,3),SIMD.float32x4.swizzle(f,1,2,0,3)));d=SIMD.float32x4.mul(f,f);d=SIMD.float32x4.add(d,SIMD.float32x4.add(SIMD.float32x4.swizzle(d,1,2,0,3),SIMD.float32x4.swizzle(d,2,0,1,3)));var f=SIMD.float32x4.mul(f,SIMD.float32x4.reciprocalSqrtApproximation(d)),j=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,1,2,0,3),SIMD.float32x4.swizzle(g,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,2,0,1,3),SIMD.float32x4.swizzle(g,1,2,
0,3)));d=SIMD.float32x4.mul(f,f);d=SIMD.float32x4.add(d,SIMD.float32x4.add(SIMD.float32x4.swizzle(d,1,2,0,3),SIMD.float32x4.swizzle(d,2,0,1,3)));var f=SIMD.float32x4.mul(f,SIMD.float32x4.reciprocalSqrtApproximation(d)),l=SIMD.float32x4.splat(0),f=SIMD.float32x4.neg(f),n=SIMD.float32x4.shuffle(f,j,0,1,4,5),m=SIMD.float32x4.shuffle(g,l,0,1,4,5);d=SIMD.float32x4.shuffle(n,m,0,2,4,6);c=SIMD.float32x4.shuffle(n,m,1,3,5,7);n=SIMD.float32x4.shuffle(f,j,2,3,6,7);m=SIMD.float32x4.shuffle(g,l,2,3,6,7);g=SIMD.float32x4.shuffle(n,
m,0,2,4,6);f=SIMD.float32x4(0,0,0,1);j=SIMD.float32x4(1,0,0,0);l=SIMD.float32x4(0,1,0,0);n=SIMD.float32x4(0,0,1,0);b=SIMD.float32x4.neg(b);b=SIMD.float32x4.withW(b,1);SIMD.float32x4.store(e,0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(j,0,0,0,0),d),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(j,1,1,1,1),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(j,2,2,2,2),g),SIMD.float32x4.mul(SIMD.float32x4.swizzle(j,3,3,3,3),f)))));SIMD.float32x4.store(e,4,
SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,0,0,0,0),d),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,1,1,1),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,2,2,2),g),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,3,3,3,3),f)))));SIMD.float32x4.store(e,8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,0,0,0,0),d),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,1,1,1,1),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,
2,2,2,2),g),SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,3,3,3,3),f)))));SIMD.float32x4.store(e,12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,0,0,0,0),d),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,1,1,1,1),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,2,2,2,2),g),SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,3,3,3,3),f)))))},e);b.SIMDMatrix=c;var d=b.Matrix.prototype.multiplyToArray,g=b.Matrix.prototype.invertToRef,m=b.Matrix.LookAtLHToRef,
j=b.Vector3.TransformCoordinatesToRef,l=b.Vector3.TransformCoordinatesFromFloatsToRef,n=function(){},e=(Object.defineProperty(n,"IsEnabled",{get:function(){return n._isEnabled},enumerable:!0,configurable:!0}),n.DisableSIMD=function(){b.Matrix.prototype.multiplyToArray=d;b.Matrix.prototype.invertToRef=g;b.Matrix.LookAtLHToRef=m;b.Vector3.TransformCoordinatesToRef=j;b.Vector3.TransformCoordinatesFromFloatsToRef=l;n._isEnabled=!1},n.EnableSIMD=function(){void 0!==window.SIMD&&(b.Matrix.prototype.multiplyToArray=
c.prototype.multiplyToArraySIMD,b.Matrix.prototype.invertToRef=c.prototype.invertToRefSIMD,b.Matrix.LookAtLHToRef=c.LookAtLHToRefSIMD,b.Vector3.TransformCoordinatesToRef=f.TransformCoordinatesToRefSIMD,b.Vector3.TransformCoordinatesFromFloatsToRef=f.TransformCoordinatesFromFloatsToRefSIMD,Object.defineProperty(b.Vector3.prototype,"x",{get:function(){return this._data[0]},set:function(b){this._data||(this._data=new Float32Array(3));this._data[0]=b}}),Object.defineProperty(b.Vector3.prototype,"y",{get:function(){return this._data[1]},
set:function(b){this._data[1]=b}}),Object.defineProperty(b.Vector3.prototype,"z",{get:function(){return this._data[2]},set:function(b){this._data[2]=b}}),n._isEnabled=!0)},n._isEnabled=!1,n);b.SIMDHelper=e}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(b,c,e,f){this._pos=e;this._size=f;this._root=b;this._parent=c};f=(Object.defineProperty(e.prototype,"pos",{get:function(){return this._pos},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentSize",{get:function(){return this._contentSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"UVs",{get:function(){var c=this._root._size.width,e=this._root._size.height,f=new b.Vector2(this._pos.x/c,this._pos.y/e),c=new b.Vector2((this._pos.x+
this._contentSize.width-1)/c,(this._pos.y+this._contentSize.height-1)/e),e=[];return e.push(f),e.push(new b.Vector2(c.x,f.y)),e.push(c),e.push(new b.Vector2(f.x,c.y)),e},enumerable:!0,configurable:!0}),e.prototype.freeContent=function(){this.contentSize&&(this._contentSize=null,this.attemptDefrag())},Object.defineProperty(e.prototype,"isUsed",{get:function(){return null!=this._contentSize||null!=this._leftNode},enumerable:!0,configurable:!0}),e.prototype.findAndSplitNode=function(b){var c=this.findNode(b);
return c?(c.splitNode(b),c):null},e.prototype.findNode=function(b){var c=null;return this.isUsed?(this._leftNode&&(c=this._leftNode.findNode(b)),!c&&this._rightNode&&(c=this._rightNode.findNode(b)),!c&&this._bottomNode&&(c=this._bottomNode.findNode(b))):this._initialSize&&b.width<=this._initialSize.width&&b.height<=this._initialSize.height?c=this:b.width<=this._size.width&&b.height<=this._size.height&&(c=this),c},e.prototype.splitNode=function(c){return!this._contentSize&&this._initialSize?(this._leftNode=
new e(this._root,this,new b.Vector2(this._pos.x,this._pos.y),new b.Size(this._initialSize.width,this._initialSize.height)),this._leftNode.splitNode(c)):(this._contentSize=c.clone(),this._initialSize=c.clone(),c.width!==this._size.width&&(this._rightNode=new e(this._root,this,new b.Vector2(this._pos.x+c.width,this._pos.y),new b.Size(this._size.width-c.width,c.height))),c.height!==this._size.height&&(this._bottomNode=new e(this._root,this,new b.Vector2(this._pos.x,this._pos.y+c.height),new b.Size(this._size.width,
this._size.height-c.height))),this)},e.prototype.attemptDefrag=function(){!this.isUsed&&this.isRecursiveFree&&(this.clearNode(),this._parent&&this._parent.attemptDefrag())},e.prototype.clearNode=function(){this._bottomNode=this._rightNode=this._initialSize=null},Object.defineProperty(e.prototype,"isRecursiveFree",{get:function(){return!this.contentSize&&(!this._leftNode||this._leftNode.isRecursiveFree)&&(!this._rightNode||this._rightNode.isRecursiveFree)&&(!this._bottomNode||this._bottomNode.isRecursiveFree)},
enumerable:!0,configurable:!0}),e.prototype.evalFreeSize=function(b){var c=0;return this.isUsed||(c=this._initialSize?this._initialSize.surface:this._size.surface),this._rightNode&&(c+=this._rightNode.evalFreeSize(0)),this._bottomNode&&(c+=this._bottomNode.evalFreeSize(0)),c+b},e);b.PackedRect=f;var c;c=function(c){f.call(this,null,null,b.Vector2.Zero(),c);this._root=this};c=(__extends(c,f),c.prototype.addRect=function(b){return this.findAndSplitNode(b)},Object.defineProperty(c.prototype,"freeSpace",
{get:function(){var b=0;return b=this.evalFreeSize(b),b/(this._size.width*this._size.height)},enumerable:!0,configurable:!0}),c);b.RectPackingMap=c}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(){};b.DynamicFloatArrayElementInfo=f;var e;e=function(b,c){this.compareValueOffset=null;this.sortingAscending=!0;this._stride=b;this.buffer=new Float32Array(b*c);this._firstFree=this._lastUsed=0;this._allEntries=Array(c);this._freeEntries=Array(c);for(var e=0;c>e;e++){var j=new f;j.offset=e*b;this._allEntries[e]=j;this._freeEntries[c-e-1]=j}};e=(e.prototype.allocElement=function(){0===this._freeEntries.length&&this._growBuffer();var b=this._freeEntries.pop();return this._lastUsed=
Math.max(b.offset,this._lastUsed),b.offset===this._firstFree&&(0<this._freeEntries.length?this._firstFree=this._freeEntries[this._freeEntries.length-1].offset:this._firstFree+=this._stride),b},e.prototype.freeElement=function(b){this._firstFree=Math.min(b.offset,this._firstFree);this._freeEntries.push(b)},e.prototype.pack=function(){if(0===this._freeEntries.length)return this.buffer;if(this._lastUsed<this._firstFree)return this.buffer.subarray(0,this._lastUsed+this._stride);var b=this._stride,c=new f;
c.offset=this.totalElementCount*b;this._freeEntries.push(c);for(var c=this._freeEntries.sort(function(b,c){return b.offset-c.offset}),e=this._allEntries.sort(function(b,c){return b.offset-c.offset}),j=c[0].offset,l=1,n=(this.usedElementCount+1)*b,q=c[0].offset,p=1;p<c.length&&!(j>=n);p++){var r=c[p].offset,q=r-q;if(q!==b){for(var q=q/b-1,t=r-b,s=Math.min(l,q),u=0;s>u;u++){var x=j/b,y=t/b,z=e[y];this._moveElement(z,j);var A=e[x];A.offset=t;e[x]=z;e[y]=A;t-=b;j+=b}q>=l?(j=t+b,l=1+s):l=(r-j)/b+1}else++l;
q=r}l=this.buffer.subarray(0,j);return this._lastUsed=j-b,this._firstFree=j,c.pop(),this._freeEntries=c.sort(function(b,c){return c.offset-b.offset}),this._allEntries=e,l},e.prototype._moveElement=function(b,c){for(var e=0;e<this._stride;e++)this.buffer[c+e]=this.buffer[b.offset+e];b.offset=c},e.prototype._growBuffer=function(){var b=Math.floor(1.5*this.totalElementCount),c=new Float32Array(b*this._stride);c.set(this.buffer);for(var e=this.totalElementCount,b=b-this.totalElementCount,j=0;b>j;j++){var l=
new f;l.offset=(e+j)*this.stride;this._allEntries.push(l);this._freeEntries[b-j-1]=l}this._firstFree=e*this.stride;this.buffer=c},Object.defineProperty(e.prototype,"totalElementCount",{get:function(){return this._allEntries.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"freeElementCount",{get:function(){return this._freeEntries.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usedElementCount",{get:function(){return this._allEntries.length-this._freeEntries.length},
enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stride",{get:function(){return this._stride},enumerable:!0,configurable:!0}),e.prototype.sort=function(){if(!this.compareValueOffset)throw Error("The DynamicFloatArray.sort() method needs a valid 'compareValueOffset' property");var b=this.usedElementCount;if(!this._sortTable||this._sortTable.length<b){var e=Math.min(this.totalElementCount,2*b);this._sortTable=Array(e);this._sortedTable=Array(e)}this.pack();for(var f=0,e=this.stride,
j=0;b>j;j++,f+=e){var l=this._sortTable[j];l||(l=new c,this._sortTable[j]=l);l.compareData=this.buffer[f+this.compareValueOffset];l.offset=f;l.swapedOffset=null;this._sortedTable[j]=l}this.sortingAscending?this._sortedTable.sort(function(b,c){return b.compareData-c.compareData}):this._sortedTable.sort(function(b,c){return c.compareData-b.compareData});for(j=0;b>j;j++){var f=this._sortedTable[j],l=this._sortTable[j],n=f.offset;if(f.swapedOffset){for(n=f;n.swapedOffset;)n=this._sortTable[n.swapedOffset/
e];n=n.offset}l.swapedOffset=n;if(n!==l.offset)for(var q=l.offset,p=0;e>p;p++){var r=this.buffer[q+p];this.buffer[q+p]=this.buffer[n+p];this.buffer[n+p]=r}this._allEntries[f.offset/e].offset=l.offset}return this._allEntries.sort(function(b,c){return b.offset-c.offset}),!0},e);b.DynamicFloatArray=e;var c;c=function(){this.compareData=this.offset=this.swapedOffset=null}}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(){};b.CharInfo=f;var e,c=b.Texture,d=function(d,e,f,l,n){void 0===l&&(l=200);void 0===n&&(n=b.Texture.TRILINEAR_SAMPLINGMODE);c.call(this,null,f,!0,!1,n);this._charInfos={};this._curCharCount=0;this._lastUpdateCharCount=-1;this._usedCounter=1;this.name=d;this.wrapV=this.wrapU=b.Texture.CLAMP_ADDRESSMODE;this._canvas=document.createElement("canvas");this._context=this._canvas.getContext("2d");this._context.font=e;this._context.fillStyle="white";d=this.getFontHeight(e);
this._lineHeight=d.height;this._offset=d.offset-1;d=this._context.measureText("W").width;this._spaceWidth=this._context.measureText(" ").width;l=Math.sqrt(this._lineHeight*d*l);l=Math.pow(2,Math.ceil(Math.log(l)/Math.log(2)));this._texture=f.getEngine().createDynamicTexture(l,l,!1,n);f=this.getSize();this._canvas=document.createElement("canvas");this._canvas.width=f.width;this._canvas.height=f.height;this._context=this._canvas.getContext("2d");this._context.textBaseline="top";this._context.font=e;
this._context.fillStyle="white";this._context.imageSmoothingEnabled=!1;this._currentFreePosition=b.Vector2.Zero();for(e=32;127>e;e++)f=String.fromCharCode(e),this.getChar(f);this.update()};e=(__extends(d,c),Object.defineProperty(d.prototype,"spaceWidth",{get:function(){return this._spaceWidth},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"lineHeight",{get:function(){return this._lineHeight},enumerable:!0,configurable:!0}),d.GetCachedFontTexture=function(c,e){c.__fontTextureCache__||
(c.__fontTextureCache__=new b.StringDictionary);var f=c.__fontTextureCache__,l=e.toLocaleLowerCase(),n=f.get(l);return n?(++n._usedCounter,n):(n=new d(null,l,c,200,b.Texture.NEAREST_SAMPLINGMODE),f.add(l,n),n)},d.ReleaseCachedFontTexture=function(b,c){var d=b.__fontTextureCache__;if(d){var e=c.toLocaleLowerCase(),f=d.get(e);0===--f._usedCounter&&(d.remove(e),f.dispose())}},d.prototype.getChar=function(c){if(1!==c.length)return null;var d=this._charInfos[c];if(d)return d;var d=new f,e=this._context.measureText(c),
l=this.getSize(),e=e.width;return this._currentFreePosition.x+e+2>l.width&&(this._currentFreePosition.x=0,this._currentFreePosition.y+=this._lineHeight+2,this._currentFreePosition.y>l.height)?this.getChar("!"):(this._context.fillText(c,this._currentFreePosition.x-0.5,this._currentFreePosition.y-this._offset-0.5),d.topLeftUV=new b.Vector2(this._currentFreePosition.x/l.width,this._currentFreePosition.y/l.height),d.bottomRightUV=new b.Vector2(d.topLeftUV.x+e/l.width,d.topLeftUV.y+(this._lineHeight+2)/
l.height),d.charWidth=e,this._charInfos[c]=d,this._curCharCount++,this._currentFreePosition.x+=e+2,d)},d.prototype.measureText=function(c,d){void 0===d&&(d=4);for(var e=0,f=0,n=1,q=0,p=0;p<c.length;p++){var r=c[p];"\n"!==r?"\t"!==r?" ">r||(f+=this.getChar(r).charWidth,++q):(r=q+d,r-=r%d,f+=(r-q)*this.spaceWidth,q=r):(e=Math.max(e,f),f=q=0,++n)}return e=Math.max(e,f),new b.Size(e,n*this._lineHeight)},d.prototype.getFontHeight=function(b){var c=document.createElement("canvas"),d=c.getContext("2d");
d.fillRect(0,0,c.width,c.height);d.textBaseline="top";d.fillStyle="white";d.font=b;d.fillText("jH|",0,0);b=d.getImageData(0,0,c.width,c.height).data;for(var e=d=-1,f=0;f<c.height;f++)for(var q=0;q<c.width;q++){if(0!==b[4*(f*c.width+q)]){-1===d&&(d=f);break}if(q===c.width-1&&-1!==d){e=f;f=c.height;break}}return{height:e-d,offset:d-1}},Object.defineProperty(d.prototype,"canRescale",{get:function(){return!1},enumerable:!0,configurable:!0}),d.prototype.getContext=function(){return this._context},d.prototype.update=
function(){this._lastUpdateCharCount<this._curCharCount&&(this.getScene().getEngine().updateDynamicTexture(this._texture,this._canvas,!1,!0),this._lastUpdateCharCount=this._curCharCount)},d.prototype.clone=function(){return null},d);b.FontTexture=e}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.Texture;f=function(c,d,f,m){void 0===m&&(m=b.Texture.TRILINEAR_SAMPLINGMODE);e.call(this,null,d,!0,!1,m);this.name=c;this._size=f;this.wrapV=this.wrapU=b.Texture.CLAMP_ADDRESSMODE;this._rectPackingMap=new b.RectPackingMap(new b.Size(f.width,f.height));this._texture=d.getEngine().createRenderTargetTexture(f,{generateMipMaps:!this.noMipmap,type:b.Engine.TEXTURETYPE_UNSIGNED_INT})};f=(__extends(f,e),f.prototype.allocateRect=function(b){return this._rectPackingMap.addRect(b)},f.prototype.freeRect=
function(b){b&&b.freeContent()},Object.defineProperty(f.prototype,"freeSpace",{get:function(){return this._rectPackingMap.freeSpace},enumerable:!0,configurable:!0}),f.prototype.bindTextureForRect=function(b,d){return this.bindTextureForPosSize(b.pos,b.contentSize,d)},f.prototype.bindTextureForPosSize=function(c,d,e){var f=this.getScene().getEngine();f.bindFramebuffer(this._texture);this._replacedViewport=f.setDirectViewport(c.x,c.y,d.width,d.height);e&&f.scissorClear(c.x,c.y,d.width,d.height,new b.Color4(0,
0,0,0))},f.prototype.unbindTexture=function(c){c&&b.Tools.DumpFramebuffer(this._size.width,this._size.height,this.getScene().getEngine());c=this.getScene().getEngine();this._replacedViewport&&(c.setViewport(this._replacedViewport),this._replacedViewport=null);c.unBindFramebuffer(this._texture)},Object.defineProperty(f.prototype,"canRescale",{get:function(){return!1},enumerable:!0,configurable:!0}),f.prototype.clone=function(){return null},f);b.MapTexture=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(){this.radius=0;this.center=b.Vector2.Zero();this.extent=b.Vector2.Zero()};f=(e.CreateFromSize=function(b){var d=new e;return e.CreateFromSizeToRef(b,d),d},e.CreateFromRadius=function(b){var d=new e;return e.CreateFromRadiusToRef(b,d),d},e.CreateFromPoints=function(b){var d=new e;return e.CreateFromPointsToRef(b,d),d},e.CreateFromSizeToRef=function(c,d){c||(c=b.Size.Zero());d.center.x=+c.width/2;d.center.y=+c.height/2;d.extent.x=d.center.x;d.extent.y=d.center.y;d.radius=
d.extent.length()},e.CreateFromRadiusToRef=function(b,d){d.center.x=d.center.y=0;var e=+b;d.extent.x=e;d.extent.y=e;d.radius=e},e.CreateFromPointsToRef=function(b,d){for(var f=Number.MAX_VALUE,m=Number.MAX_VALUE,j=Number.MIN_VALUE,l=Number.MIN_VALUE,n=0;n<b.length;n++)var q=b[n],f=Math.min(q.x,f),j=Math.max(q.x,j),m=Math.min(q.y,m),l=Math.max(q.y,l);e.CreateFromMinMaxToRef(f,j,m,l,d)},e.CreateFromMinMaxToRef=function(c,d,e,f,j){j.center=new b.Vector2(c+(d-c)/2,e+(f-e)/2);j.extent=new b.Vector2(d-
j.center.x,f-j.center.y);j.radius=j.extent.length()},e.prototype.clone=function(){var b=new e;return b.center=this.center.clone(),b.radius=this.radius,b.extent=this.extent.clone(),b},e.prototype.max=function(){var c=b.Vector2.Zero();return this.maxToRef(c),c},e.prototype.maxToRef=function(b){b.x=this.center.x+this.extent.x;b.y=this.center.y+this.extent.y},e.prototype.transform=function(b){var d=new e;return this.transformToRef(b,d),d},e.prototype.union=function(b){var d=new e;return this.unionToRef(b,
d),d},e.prototype.transformToRef=function(c,d){var f=e._transform;f[0].x=this.center.x+this.extent.x;f[0].y=this.center.y+this.extent.y;f[1].x=this.center.x+this.extent.x;f[1].y=this.center.y-this.extent.y;f[2].x=this.center.x-this.extent.x;f[2].y=this.center.y-this.extent.y;f[3].x=this.center.x-this.extent.x;f[3].y=this.center.y+this.extent.y;for(var m=0;4>m;m++)b.Vector2.TransformToRef(f[m],c,f[m]);e.CreateFromPointsToRef(f,d)},e.prototype.unionToRef=function(b,d){var f=Math.max(this.center.x+this.extent.x,
b.center.x+b.extent.x),m=Math.max(this.center.y+this.extent.y,b.center.y+b.extent.y),j=Math.min(this.center.x-this.extent.x,b.center.x-b.extent.x),l=Math.min(this.center.y-this.extent.y,b.center.y-b.extent.y);e.CreateFromMinMaxToRef(j,f,l,m,d)},e.prototype.doesIntersect=function(b){b=b.subtract(this.center);return b.lengthSquared()<=this.radius*this.radius?Math.abs(b.x)<=this.extent.x&&Math.abs(b.y)<=this.extent.y:!1},e._transform=[b.Vector2.Zero(),b.Vector2.Zero(),b.Vector2.Zero(),b.Vector2.Zero()],
e);b.BoundingInfo2D=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(){};f=(e.prototype.isLocked=function(){return this._isLocked},e.prototype.lock=function(){return this._isLocked?!0:(this.onLock(),this._isLocked=!0,!1)},e.prototype.onLock=function(){},e);b.LockableBase=f;var c=function(b,c){void 0===c&&(c=!1);f.call(this);this._color=b;c&&this.lock()},e=(__extends(c,f),c.prototype.isTransparent=function(){return this._color&&1>this._color.a},Object.defineProperty(c.prototype,"color",{get:function(){return this._color},set:function(b){this.isLocked()||
(this._color=b)},enumerable:!0,configurable:!0}),c.prototype.toString=function(){return this._color.toHexString()},c=__decorate([b.className("SolidColorBrush2D")],c));b.SolidColorBrush2D=e;c=function(c,e,m,j,l,n){void 0===m&&(m=b.Vector2.Zero());void 0===j&&(j=0);void 0===l&&(l=1);void 0===n&&(n=!1);f.call(this);this._color1=c;this._color2=e;this._translation=m;this._rotation=j;this._scale=l;n&&this.lock()};e=(__extends(c,f),c.prototype.isTransparent=function(){return this._color1&&1>this._color1.a||
this._color2&&1>this._color2.a},Object.defineProperty(c.prototype,"color1",{get:function(){return this._color1},set:function(b){this.isLocked()||(this._color1=b)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"color2",{get:function(){return this._color2},set:function(b){this.isLocked()||(this._color2=b)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"translation",{get:function(){return this._translation},set:function(b){this.isLocked()||(this._translation=b)},
enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rotation",{get:function(){return this._rotation},set:function(b){this.isLocked()||(this._rotation=b)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"scale",{get:function(){return this._scale},set:function(b){this.isLocked()||(this._scale=b)},enumerable:!0,configurable:!0}),c.prototype.toString=function(){return"C1:"+this._color1+";C2:"+this._color2+";T:"+this._translation.toString()+";R:"+this._rotation+";S:"+this._scale+
";"},c.BuildKey=function(b,c,e,f,l){return"C1:"+b+";C2:"+c+";T:"+e.toString()+";R:"+f+";S:"+l+";"},c=__decorate([b.className("GradientColorBrush2D")],c));b.GradientColorBrush2D=e}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(){};b.Prim2DClassInfo=f;var e,c=function(){};e=(c.PROPKIND_MODEL=1,c.PROPKIND_INSTANCE=2,c.PROPKIND_DYNAMIC=3,c);b.Prim2DPropInfo=e;c=function(){};b.PropertyChangedInfo=c;var d,g=function(c,d,e){this._baseClass=c;this._type=d;this._subClasses=[];this._levelContent=new b.StringDictionary;this._classContentFactory=e};d=(Object.defineProperty(g.prototype,"classContent",{get:function(){return this._classContent||(this._classContent=this._classContentFactory(this._baseClass?
this._baseClass.classContent:null)),this._classContent},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"levelContent",{get:function(){return this._levelContent},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"fullContent",{get:function(){if(!this._fullContent){for(var c=new b.StringDictionary,d=this;d;)d.levelContent.forEach(function(b,d){return c.add(b,
d)}),d=d._baseClass;this._fullContent=c}return this._fullContent},enumerable:!0,configurable:!0}),g.prototype.getLevelOf=function(b){if(b===this._type)return this;var c=Object.getPrototypeOf(b);return this.getOrAddType(Object.getPrototypeOf(c),c)||this.getLevelOf(c),this.getOrAddType(c,b)},g.prototype.getOrAddType=function(b,c){if(b===this._type){for(var d=0,e=this._subClasses;d<e.length;d++){var f=e[d];if(f.type===c)return f.node}f=new g(this,c,this._classContentFactory);f={type:c,node:f};return this._subClasses.push(f),
f.node}d=0;for(e=this._subClasses;d<e.length;d++)if(f=e[d],f=f.node.getOrAddType(b,c))return f;return null},g.get=function(b){var c=b.__classTreeInfo;return c?c.getLevelOf(b):null},g.getOrRegister=function(b,c){var d=b.__classTreeInfo;return d||(d=new g(null,b,c),b.__classTreeInfo=d),d},g);b.ClassTreeInfo=d;var m,j=function(){this._flags=0;this._modelKey=null;this._instanceDirtyFlags=0;this._levelBoundingInfo=new b.BoundingInfo2D;this.animations=[]};m=(Object.defineProperty(j.prototype,"isDisposed",
{get:function(){return this._isFlagSet(j.flagIsDisposed)},enumerable:!0,configurable:!0}),j.prototype.dispose=function(){return this.isDisposed?!1:(this.animations.splice(0),this._setFlags(j.flagIsDisposed),!0)},j.prototype.getAnimatables=function(){return[]},Object.defineProperty(j.prototype,"modelKey",{get:function(){var c=this;if(!this._isFlagSet(j.flagModelDirty)&&this._modelKey)return this._modelKey;var d="Class:"+b.Tools.getClassName(this)+";";return this.propDic.forEach(function(f,g){if(g.kind===
e.PROPKIND_MODEL){var j=c[g.name];j&&j.constructor===Array&&(j=j[0]?b.Tools.hashCodeFromStream(b.Tools.arrayOrStringFeeder(j)):0);d+=g.name+":"+(null!=j?g.typeLevelCompare?b.Tools.getClassName(j):j.toString():"[null]")+";"}}),this._clearFlags(j.flagModelDirty),this._modelKey=d,d},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"isDirty",{get:function(){return 0!==this._instanceDirtyFlags||this._areSomeFlagsSet(j.flagModelDirty|j.flagPositioningDirty|j.flagLayoutDirty)},enumerable:!0,
configurable:!0}),Object.defineProperty(j.prototype,"propDic",{get:function(){if(!this._propInfo){var b=d.get(Object.getPrototypeOf(this));if(!b)throw Error("Can't access the propDic member in class definition, is this class SmartPropertyPrim based?");this._propInfo=b.fullContent}return this._propInfo},enumerable:!0,configurable:!0}),j._createPropInfo=function(b,c,g,j,m,t){b=d.getOrRegister(b,function(){return new f}).getLevelOf(b);var s=b.levelContent.get(g.toString());if(s)throw Error("The ID "+
g+" is already taken by another property declaration named: "+s.name);return s=new e,s.id=g,s.flagId=Math.pow(2,g),s.kind=t,s.name=c,s.dirtyBoundingInfo=j,s.typeLevelCompare=m,b.levelContent.add(c,s),s},j._checkUnchanged=function(b,c){if(null===b&&null===c||void 0===b&&void 0===c)return!0;if(null!=b&&null!=c)if("function"==typeof b.equals){if(b.equals(c))return!0}else if(b===c)return!0;return!1},j.prototype.markAsDirty=function(b){if(!this.isDisposed){var c=b.indexOf(".");-1!==c&&(b=b.substr(0,c));
(c=this.propDic.get(b))&&this._handlePropChanged(void 0,this[b],b,c,c.typeLevelCompare)}},j.prototype._boundingBoxDirty=function(){if(this._setFlags(j.flagLevelBoundingInfoDirty),this instanceof b.Prim2DBase)for(var c=this;c&&(c._boundingSize=null,c._setFlags(j.flagBoundingInfoDirty),c.isSizeAuto&&c.onPrimitivePropertyDirty(b.Prim2DBase.sizeProperty.flagId),!(c instanceof b.Group2D&&c.isRenderableGroup));)c=c.parent},j.prototype._handlePropChanged=function(c,d,f,g,m){g.dirtyBoundingInfo&&this._boundingBoxDirty();
var t=j.propChangedInfo;t.oldValue=c;t.newValue=d;t.propertyName=f;f=g.flagId;if(this.propertyChanged.notifyObservers(t,f),this instanceof b.Group2D&&this.handleGroupChanged(g),this instanceof b.Prim2DBase)t=this._parent,null!=t&&t.layoutEngine&&0!==(t.layoutEngine.layoutDirtyOnPropertyChangedMask&g.flagId)&&t._setLayoutDirty();t=!1;m&&(null!=c&&null!=d)&&(t=c.__proto__===d.__proto__);t||g.kind!==e.PROPKIND_MODEL?(t||g.kind===e.PROPKIND_INSTANCE||g.kind===e.PROPKIND_DYNAMIC)&&this.onPrimitivePropertyDirty(f):
this.onPrimitivePropertyDirty(j.flagModelDirty)},j.prototype.onPrimitivePropertyDirty=function(b){this.isDirty||this.onPrimBecomesDirty();this._instanceDirtyFlags|=b},j.prototype.handleGroupChanged=function(){},j.prototype.checkPropertiesDirty=function(b){return 0!==(this._instanceDirtyFlags&b)},j.prototype.clearPropertiesDirty=function(b){return this._instanceDirtyFlags&=~b,this._instanceDirtyFlags},j.prototype._resetPropertiesDirty=function(){this._instanceDirtyFlags=0},Object.defineProperty(j.prototype,
"levelBoundingInfo",{get:function(){return this._isFlagSet(j.flagLevelBoundingInfoDirty)&&(this.updateLevelBoundingInfo(),this._clearFlags(j.flagLevelBoundingInfoDirty)),this._levelBoundingInfo},enumerable:!0,configurable:!0}),j.prototype.updateLevelBoundingInfo=function(){},j.prototype.onPrimBecomesDirty=function(){},j._hookProperty=function(b,c,d,e,f){return function(g,m,u){var x=j._createPropInfo(g,m,b,e,d,f);c&&c(x);var y=u.get,z=u.set;u.set=function(b){if(!this.isDisposed){var c=y.call(this);
j._checkUnchanged(c,b)||(z.call(this,b),this._handlePropChanged(c,b,m,x,d))}}}},j.prototype.addExternalData=function(c,d){return this._externalData||(this._externalData=new b.StringDictionary),this._externalData.add(c,d)},j.prototype.getExternalData=function(b){return this._externalData?this._externalData.get(b):null},j.prototype.getOrAddExternalDataWithFactory=function(c,d){return this._externalData||(this._externalData=new b.StringDictionary),this._externalData.getOrAddWithFactory(c,d)},j.prototype.removeExternalData=
function(b){return this._externalData?this._externalData.remove(b):!1},j.prototype._isFlagSet=function(b){return 0!==(this._flags&b)},j.prototype._areAllFlagsSet=function(b){return(this._flags&b)===b},j.prototype._areSomeFlagsSet=function(b){return 0!==(this._flags&b)},j.prototype._clearFlags=function(b){this._flags&=~b},j.prototype._setFlags=function(b){var c=this._flags;return this._flags|=b,c},j.prototype._changeFlags=function(b,c){c?this._flags|=b:this._flags&=~b},j.propChangedInfo=new c,j.flagIsDisposed=
1,j.flagLevelBoundingInfoDirty=2,j.flagModelDirty=4,j.flagLayoutDirty=8,j.flagLevelVisible=16,j.flagBoundingInfoDirty=32,j.flagIsPickable=64,j.flagIsVisible=128,j.flagVisibilityChanged=256,j.flagPositioningDirty=512,j.flagTrackedGroup=1024,j=__decorate([b.className("SmartPropertyPrim")],j));b.SmartPropertyPrim=m;b.modelLevelProperty=function(b,c,d,f){return void 0===d&&(d=!1),void 0===f&&(f=!1),m._hookProperty(b,c,d,f,e.PROPKIND_MODEL)};b.instanceLevelProperty=function(b,c,d,f){return void 0===d&&
(d=!1),void 0===f&&(f=!1),m._hookProperty(b,c,d,f,e.PROPKIND_INSTANCE)};b.dynamicLevelProperty=function(b,c,d,f){return void 0===d&&(d=!1),void 0===f&&(f=!1),m._hookProperty(b,c,d,f,e.PROPKIND_DYNAMIC)}}(BABYLON||(BABYLON={}));
!function(b){b.PrepareRender2DContext=function(){this.forceRefreshPrimitive=!1};var f,e=function(b){this._renderMode=b;this.useInstancing=!1;this.partDataStartIndex=this.partDataEndIndex=this.groupInfoPartData=null};f=(Object.defineProperty(e.prototype,"renderMode",{get:function(){return this._renderMode},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RenderModeOpaque",{get:function(){return e._renderModeOpaque},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RenderModeAlphaTest",
{get:function(){return e._renderModeAlphaTest},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RenderModeTransparent",{get:function(){return e._renderModeTransparent},enumerable:!0,configurable:!0}),e._renderModeOpaque=1,e._renderModeAlphaTest=2,e._renderModeTransparent=3,e);b.Render2DContext=f;var c=function(){this.primitivePointerPos=b.Vector2.Zero();this.tilt=b.Vector2.Zero();this.cancelBubble=!1};f=(Object.defineProperty(c,"PointerOver",{get:function(){return c._pointerOver},enumerable:!0,
configurable:!0}),Object.defineProperty(c,"PointerEnter",{get:function(){return c._pointerEnter},enumerable:!0,configurable:!0}),Object.defineProperty(c,"PointerDown",{get:function(){return c._pointerDown},enumerable:!0,configurable:!0}),Object.defineProperty(c,"PointerMouseWheel",{get:function(){return c._pointerMouseWheel},enumerable:!0,configurable:!0}),Object.defineProperty(c,"PointerMove",{get:function(){return c._pointerMove},enumerable:!0,configurable:!0}),Object.defineProperty(c,"PointerUp",
{get:function(){return c._pointerUp},enumerable:!0,configurable:!0}),Object.defineProperty(c,"PointerOut",{get:function(){return c._pointerOut},enumerable:!0,configurable:!0}),Object.defineProperty(c,"PointerLeave",{get:function(){return c._pointerLeave},enumerable:!0,configurable:!0}),Object.defineProperty(c,"PointerGotCapture",{get:function(){return c._pointerGotCapture},enumerable:!0,configurable:!0}),Object.defineProperty(c,"PointerLostCapture",{get:function(){return c._pointerLostCapture},enumerable:!0,
configurable:!0}),Object.defineProperty(c,"MouseWheelPrecision",{get:function(){return c._mouseWheelPrecision},enumerable:!0,configurable:!0}),c.prototype.updateRelatedTarget=function(b,c){this.relatedTarget=b;this.relatedTargetPointerPos=c},c.getEventTypeName=function(b){switch(b){case c.PointerOver:return"PointerOver";case c.PointerEnter:return"PointerEnter";case c.PointerDown:return"PointerDown";case c.PointerMouseWheel:return"PointerMouseWheel";case c.PointerMove:return"PointerMove";case c.PointerUp:return"PointerUp";
case c.PointerOut:return"PointerOut";case c.PointerLeave:return"PointerLeave";case c.PointerGotCapture:return"PointerGotCapture";case c.PointerLostCapture:return"PointerLostCapture"}},c._pointerOver=1,c._pointerEnter=2,c._pointerDown=4,c._pointerMouseWheel=8,c._pointerMove=16,c._pointerUp=32,c._pointerOut=64,c._pointerLeave=128,c._pointerGotCapture=256,c._pointerLostCapture=512,c._mouseWheelPrecision=3,c);b.PrimitivePointerInfo=f;var d,g=function(b){this._changedCallback=b;this._horizontal=g.AlignLeft;
this._vertical=g.AlignBottom};d=(Object.defineProperty(g,"AlignLeft",{get:function(){return g._AlignLeft},enumerable:!0,configurable:!0}),Object.defineProperty(g,"AlignTop",{get:function(){return g._AlignTop},enumerable:!0,configurable:!0}),Object.defineProperty(g,"AlignRight",{get:function(){return g._AlignRight},enumerable:!0,configurable:!0}),Object.defineProperty(g,"AlignBottom",{get:function(){return g._AlignBottom},enumerable:!0,configurable:!0}),Object.defineProperty(g,"AlignCenter",{get:function(){return g._AlignCenter},
enumerable:!0,configurable:!0}),Object.defineProperty(g,"AlignStretch",{get:function(){return g._AlignStretch},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"horizontal",{get:function(){return this._horizontal},set:function(b){this._horizontal!==b&&(this._horizontal=b,this._changedCallback())},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"vertical",{get:function(){return this._vertical},set:function(b){this._vertical!==b&&(this._vertical=b,this._changedCallback())},
enumerable:!0,configurable:!0}),g.prototype.setHorizontal=function(b){switch(b.trim().toLocaleLowerCase()){case "left":return void(this.horizontal=g.AlignLeft);case "right":return void(this.horizontal=g.AlignRight);case "center":return void(this.horizontal=g.AlignCenter);case "stretch":return void(this.horizontal=g.AlignStretch)}},g.prototype.setVertical=function(b){switch(b.trim().toLocaleLowerCase()){case "top":return void(this.vertical=g.AlignTop);case "bottom":return void(this.vertical=g.AlignBottom);
case "center":return void(this.vertical=g.AlignCenter);case "stretch":return void(this.vertical=g.AlignStretch)}},g.prototype.fromString=function(b){b=b.trim().split(",");for(var c=0;c<b.length;c++){var d=b[c],d=d.toLocaleLowerCase().trim(),e=d.indexOf("h:");-1===e&&(e=d.indexOf("horizontal:"));-1===e?(e=d.indexOf("v:"),-1===e&&(e=d.indexOf("vertical:")),-1===e||(d=d.substr(d.indexOf(":")+1),this.setVertical(d))):(d=d.substr(d.indexOf(":")+1),this.setHorizontal(d))}},g._AlignLeft=1,g._AlignTop=1,
g._AlignRight=2,g._AlignBottom=2,g._AlignCenter=3,g._AlignStretch=4,g);b.PrimitiveAlignment=d;var m;m=function(b,c){this.prim=b;this.intersectionLocation=c};b.PrimitiveIntersectedInfo=m;var j,l=function(b,c){this._parentAccess=b;this._changedCallback=c;this._pixels=Array(4);this._percentages=Array(4);this._setType(0,l.Auto);this._setType(1,l.Auto);this._setType(2,l.Auto);this._setType(3,l.Auto);this._pixels[0]=0;this._pixels[1]=0;this._pixels[2]=0;this._pixels[3]=0};j=(l.prototype.fromString=function(b){this._clear();
b=b.trim().split(",");for(var c=!1,d=0;d<b.length;d++)c=this._extractString(b[d],!1)||c;if(!c)throw Error("Can't parse the string to create a PrimitiveMargin object, format must be: 'top: <value>, left:<value>, right:<value>, bottom:<value>");0===(15&this._flags)&&(this._flags|=l.Pixel<<0);0===(240&this._flags)&&(this._flags|=l.Pixel<<4);0===(3840&this._flags)&&(this._flags|=l.Pixel<<8);0===(61440&this._flags)&&(this._flags|=l.Pixel<<12);this._changedCallback()},l.prototype.fromStrings=function(b,
c,d,e){return this._clear(),this._setStringValue(b,0,!1),this._setStringValue(c,1,!1),this._setStringValue(d,2,!1),this._setStringValue(e,3,!1),this._changedCallback(),this},l.prototype.fromPixels=function(b,c,d,e){return this._clear(),this._pixels[0]=b,this._pixels[1]=c,this._pixels[2]=d,this._pixels[3]=e,this._changedCallback(),this},l.prototype.fromUniformPixels=function(b){return this._clear(),this._pixels[0]=b,this._pixels[1]=b,this._pixels[2]=b,this._pixels[3]=b,this._changedCallback(),this},
l.prototype.auto=function(){return this._clear(),this._flags=l.Auto<<0|l.Auto<<4|l.Auto<<8|l.Auto<<12,this._pixels[0]=0,this._pixels[1]=0,this._pixels[2]=0,this._pixels[3]=0,this._changedCallback(),this},l.prototype._clear=function(){this._flags=0;this._pixels[0]=0;this._pixels[1]=0;this._pixels[2]=0;this._pixels[3]=0;this._percentages[0]=null;this._percentages[1]=null;this._percentages[2]=null;this._percentages[3]=null},l.prototype._extractString=function(b,c){var d=b.trim().toLocaleLowerCase();
return 0===d.indexOf("top:")?(d=d.substr(4).trim(),this._setStringValue(d,0,c)):0===d.indexOf("left:")?(d=d.substr(5).trim(),this._setStringValue(d,1,c)):0===d.indexOf("right:")?(d=d.substr(6).trim(),this._setStringValue(d,2,c)):0===d.indexOf("bottom:")?(d=d.substr(7).trim(),this._setStringValue(d,3,c)):!1},l.prototype._setStringValue=function(b,c,d){b=b.trim().toLocaleLowerCase();if("auto"===b){if(this._isType(c,l.Auto))return!0;this._setType(c,l.Auto);this._pixels[c]=0}else{if("inherit"!==b){var e=
b.indexOf("%");if(-1!==e)return b=b.substr(0,e),b=Math.round(Number(b))/100,this._isType(c,l.Percentage)&&this._percentages[c]===b?!0:(this._setType(c,l.Percentage),isNaN(b)?!1:(this._percentages[c]=b,d&&this._changedCallback(),!0));e=b.indexOf("px");b=-1!==e?b.substr(0,e).trim():b;b=Number(b);return this._isType(c,l.Pixel)&&this._pixels[c]===b?!0:isNaN(b)?!1:(this._pixels[c]=b,this._setType(c,l.Pixel),d&&this._changedCallback(),!0)}if(this._isType(c,l.Inherit))return!0;this._setType(c,l.Inherit);
this._pixels[c]=null}d&&this._changedCallback()},l.prototype._setPixels=function(b,c,d){b=Math.round(b);this._isType(c,l.Pixel)&&this._pixels[c]===b||(this._setType(c,l.Pixel),this._pixels[c]=b,d&&this._changedCallback())},l.prototype._setPercentage=function(b,c,d){b=Math.min(1,b);b=Math.max(0,b);b=Math.round(100*b)/100;this._isType(c,l.Percentage)&&this._percentages[c]===b||(this._setType(c,l.Percentage),this._percentages[c]=b,d&&this._changedCallback())},l.prototype._getStringValue=function(b){switch(this._flags>>
4*b&15){case l.Auto:return"auto";case l.Pixel:return this._pixels[b]+"px";case l.Percentage:return 100*this._percentages[b]+"%";case l.Inherit:return"inherit"}return""},l.prototype._isType=function(b,c){return(this._flags>>4*b&15)===c},l.prototype._getType=function(b,c){var d=this._flags>>4*b&15;return c&&d===l.Inherit?(d=this._parentAccess())?d._getType(b,!0):l.Auto:d},l.prototype._setType=function(b,c){this._flags&=~(15<<4*b);this._flags|=c<<4*b},l.prototype.setTop=function(b){"string"==typeof b?
this._setStringValue(b,0,!0):this.topPixels=b},l.prototype.setLeft=function(b){"string"==typeof b?this._setStringValue(b,1,!0):this.leftPixels=b},l.prototype.setRight=function(b){"string"==typeof b?this._setStringValue(b,2,!0):this.rightPixels=b},l.prototype.setBottom=function(b){"string"==typeof b?this._setStringValue(b,3,!0):this.bottomPixels=b},Object.defineProperty(l.prototype,"top",{get:function(){return this._getStringValue(0)},set:function(b){this._setStringValue(b,0,!0)},enumerable:!0,configurable:!0}),
Object.defineProperty(l.prototype,"left",{get:function(){return this._getStringValue(1)},set:function(b){this._setStringValue(b,1,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"right",{get:function(){return this._getStringValue(2)},set:function(b){this._setStringValue(b,2,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"bottom",{get:function(){return this._getStringValue(3)},set:function(b){this._setStringValue(b,3,!0)},enumerable:!0,configurable:!0}),
Object.defineProperty(l.prototype,"topPixels",{get:function(){return this._pixels[0]},set:function(b){this._setPixels(b,0,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"leftPixels",{get:function(){return this._pixels[1]},set:function(b){this._setPixels(b,1,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"rightPixels",{get:function(){return this._pixels[2]},set:function(b){this._setPixels(b,2,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,
"bottomPixels",{get:function(){return this._pixels[3]},set:function(b){this._setPixels(b,3,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"topPercentage",{get:function(){return this._percentages[0]},set:function(b){this._setPercentage(b,0,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"leftPercentage",{get:function(){return this._percentages[1]},set:function(b){this._setPercentage(b,1,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,
"rightPercentage",{get:function(){return this._percentages[2]},set:function(b){this._setPercentage(b,2,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"bottomPercentage",{get:function(){return this._percentages[3]},set:function(b){this._setPercentage(b,3,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"topMode",{get:function(){return this._getType(0,!1)},set:function(b){this._setType(0,b)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,
"leftMode",{get:function(){return this._getType(1,!1)},set:function(b){this._setType(1,b)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"rightMode",{get:function(){return this._getType(2,!1)},set:function(b){this._setType(2,b)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"bottomMode",{get:function(){return this._getType(3,!1)},set:function(b){this._setType(3,b)},enumerable:!0,configurable:!0}),l.prototype._computePixels=function(b,c,d){var e=this._getType(b,
!1);if(e===l.Inherit)return void this._parentAccess()._computePixels(b,c,d);e===l.Percentage&&(this._pixels[b]=(0===b||3===b?c.height:c.width)*this._percentages[b],d&&this._changedCallback())},l.prototype.computeWithAlignment=function(b,c,e,f,g){var j=this._getType(0,!0),n=this._getType(1,!0),q=this._getType(2,!0),m=this._getType(3,!0),B=c&&null!=c.width?c.width:0;c=c&&null!=c.height?c.height:0;j=j===l.Auto;n=n===l.Auto;q=q===l.Auto;m=m===l.Auto;switch(e.horizontal){case d.AlignLeft:n?f.x=0:(this._computePixels(1,
b,!0),f.x=this.leftPixels);g.width=B;break;case d.AlignRight:q?f.x=Math.round(b.width-B):(this._computePixels(2,b,!0),f.x=Math.round(b.width-(B+this.rightPixels)));g.width=B;break;case d.AlignStretch:n?f.x=0:(this._computePixels(1,b,!0),f.x=this.leftPixels);B=0;q||(this._computePixels(2,b,!0),B=this.rightPixels);g.width=b.width-(f.x+B);break;case d.AlignCenter:n||this._computePixels(1,b,!0),q||this._computePixels(2,b,!0),q=(n?0:this.leftPixels)-(q?0:this.rightPixels),f.x=Math.round((b.width-B)/2+
q),g.width=B}switch(e.vertical){case d.AlignTop:j?f.y=b.height-c:(this._computePixels(0,b,!0),f.y=Math.round(b.height-(c+this.topPixels)));g.height=c;break;case d.AlignBottom:m?f.y=0:(this._computePixels(3,b,!0),f.y=this.bottomPixels);g.height=c;break;case d.AlignStretch:m?f.y=0:(this._computePixels(3,b,!0),f.y=this.bottomPixels);e=0;j||(this._computePixels(0,b,!0),e=this.topPixels);g.height=b.height-(f.y+e);break;case d.AlignCenter:j||this._computePixels(0,b,!0),m||this._computePixels(3,b,!0),q=
(m?0:this.bottomPixels)-(j?0:this.topPixels),f.y=Math.round((b.height-c)/2+q),g.height=c}},l.prototype.compute=function(b,c,d){this._computePixels(0,b,!0);this._computePixels(1,b,!0);this._computePixels(2,b,!0);this._computePixels(3,b,!0);c.x=this.leftPixels;d.width=b.width-(c.x+this.rightPixels);c.y=this.bottomPixels;d.height=b.height-(c.y+this.topPixels)},l.prototype.computeArea=function(b,c){this._computePixels(0,b,!0);this._computePixels(1,b,!0);this._computePixels(2,b,!0);this._computePixels(3,
b,!0);c.width=this.leftPixels+b.width+this.rightPixels;c.height=this.bottomPixels+b.height+this.topPixels},l.Auto=1,l.Inherit=2,l.Percentage=4,l.Pixel=8,l);b.PrimitiveThickness=j;f=function(){this.intersectHidden=this.findFirstOnly=!1;this.pickPosition=b.Vector2.Zero()};f=(Object.defineProperty(f.prototype,"isIntersected",{get:function(){return this.intersectedPrimitives&&0<this.intersectedPrimitives.length},enumerable:!0,configurable:!0}),f.prototype.isPrimIntersected=function(b){for(var c=0,d=this.intersectedPrimitives;c<
d.length;c++){var e=d[c];if(e.prim===b)return e.intersectionLocation}return null},f.prototype._exit=function(b){b&&(this._globalPickPosition=null)},f);b.IntersectInfo2D=f;var n=b.SmartPropertyPrim,q=function(c){null==c&&(c={});n.call(this);var d,e;if(q._isCanvasInit)d=this,e=null,this._canvasPreInit(c);else if(null!=c.parent){if(e=c.parent,d=c.parent.owner,!d)throw Error("Parent "+e.id+" of "+c.id+" doesn't have a valid owner!");if(!(this instanceof b.Group2D||this instanceof b.Sprite2D&&null!==c.id&&
0===c.id.indexOf("__cachedSpriteOfGroup__")||d.cachingStrategy!==b.Canvas2D.CACHESTRATEGY_TOPLEVELGROUPS||e!==d))throw Error("Can't create a primitive with the canvas as direct parent when the caching strategy is TOPLEVELGROUPS. You need to create a Group below the canvas and use it as the parent for the primitive");}(this._layoutEngine=b.CanvasLayoutEngine.Singleton,this._size=null,this._actualSize=null,this._boundingSize=null,this._layoutArea=b.Size.Zero(),this._layoutAreaPos=b.Vector2.Zero(),this._marginOffset=
b.Vector2.Zero(),this._parentMargingOffset=b.Vector2.Zero(),this._parentContentArea=b.Size.Zero(),this._contentArea=new b.Size(null,null),this._pointerEventObservable=new b.Observable,this._siblingDepthOffset=this._hierarchyDepthOffset=0,this._boundingInfo=new b.BoundingInfo2D,this._owner=d,this._parent=null,this._margin=null,this._padding=null,this._marginAlignment=null,this._id=c.id,this.propertyChanged=new b.Observable,this._children=[],this._localTransform=new b.Matrix,this._globalTransform=null,
this._invGlobalTransform=null,this._globalTransformProcessStep=0,this._globalTransformStep=0,this._hierarchyDepth=0,this._renderGroup=null,this._setFlags(b.SmartPropertyPrim.flagIsPickable|b.SmartPropertyPrim.flagBoundingInfoDirty),null!=e&&(e.addChild(this),this._patchHierarchy(e.owner)),this.owner&&this instanceof b.Group2D)&&this.detectGroupStates();if(null!=c.children){d=0;for(e=c.children;d<e.length;d++){var f=e[d];this.addChild(f);f._patchHierarchy(this.owner)}}if(null!=c.position?this.position=
c.position:null!=c.x||null!=c.y?this.position=new b.Vector2(c.x||0,c.y||0):this._position=null,this.rotation=null==c.rotation?0:c.rotation,this.scale=null==c.scale?1:c.scale,this.levelVisible=null==c.isVisible?!0:c.isVisible,this.origin=c.origin||new b.Vector2(0.5,0.5),null!=c.layoutEngine)"string"==typeof c.layoutEngine?(d=c.layoutEngine.toLocaleLowerCase().trim(),"canvas"===d||"canvaslayoutengine"===d?this.layoutEngine=b.CanvasLayoutEngine.Singleton:0===d.indexOf("stackpanel")||0===d.indexOf("horizontalstackpanel")?
this.layoutEngine=b.StackPanelLayoutEngine.Horizontal:0===d.indexOf("verticalstackpanel")&&(this.layoutEngine=b.StackPanelLayoutEngine.Vertical)):c.layoutEngine instanceof b.LayoutEngineBase&&(this.layoutEngine=c.layoutEngine);c.marginTop&&this.margin.setTop(c.marginTop);c.marginLeft&&this.margin.setLeft(c.marginLeft);c.marginRight&&this.margin.setRight(c.marginRight);c.marginBottom&&this.margin.setBottom(c.marginBottom);c.margin&&("string"==typeof c.margin?this.margin.fromString(c.margin):this.margin.fromUniformPixels(c.margin));
c.marginHAlignment&&(this.marginAlignment.horizontal=c.marginHAlignment);c.marginVAlignment&&(this.marginAlignment.vertical=c.marginVAlignment);c.marginAlignment&&this.marginAlignment.fromString(c.marginAlignment);c.paddingTop&&this.padding.setTop(c.paddingTop);c.paddingLeft&&this.padding.setLeft(c.paddingLeft);c.paddingRight&&this.padding.setRight(c.paddingRight);c.paddingBottom&&this.padding.setBottom(c.paddingBottom);c.padding&&this.padding.fromString(c.padding);this._parentLayoutDirty();this._positioningDirty()};
f=(__extends(q,n),Object.defineProperty(q.prototype,"actionManager",{get:function(){return this._actionManager||(this._actionManager=new b.ActionManager(this.owner.scene)),this._actionManager},enumerable:!0,configurable:!0}),q.prototype.traverseUp=function(b){for(var c=this;null!=c;){if(b(c))return c;c=c._parent}return null},Object.defineProperty(q.prototype,"owner",{get:function(){return this._owner},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"parent",{get:function(){return this._parent},
enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"actualPosition",{get:function(){return null!=this._actualPosition?this._actualPosition:null!=this._position?this._position:q._nullPosition},set:function(b){this._actualPosition=b},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,
"actualX",{get:function(){return this.actualPosition.x},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"actualY",{get:function(){return this.actualPosition.y},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"position",{get:function(){return this._position},set:function(b){this._checkPositionChange()&&(this._position=b)},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"x",{get:function(){return this._position?this._position.x:null},set:function(c){this._checkPositionChange()&&
(this._position||(this._position=b.Vector2.Zero()),this._position.x!==c&&(this._position.x=c,this.markAsDirty("position")))},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"y",{get:function(){return this._position?this._position.y:null},set:function(c){this._checkPositionChange()&&(this._position||(this._position=b.Vector2.Zero()),this._position.y!==c&&(this._position.y=c,this.markAsDirty("position")))},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"size",{get:function(){if(!this._size||
null==this._size.width||null==this._size.height){if(q.boundinbBoxReentrency)return q.nullSize;if(this._boundingSize)return this._boundingSize;q.boundinbBoxReentrency=!0;this.boundingInfo;return q.boundinbBoxReentrency=!1,this._boundingSize}return this._size},set:function(b){this._size=b},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"width",{get:function(){return this.size?this.size.width:null},set:function(c){return this.size?void(this.size.width!==c&&(this.size.width=c,this.markAsDirty("size"),
this._positioningDirty())):void(this.size=new b.Size(c,0))},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"height",{get:function(){return this.size?this.size.height:null},set:function(c){return this.size?void(this.size.height!==c&&(this.size.height=c,this.markAsDirty("size"),this._positioningDirty())):void(this.size=new b.Size(0,c))},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"rotation",{get:function(){return this._rotation},set:function(b){this._rotation=
b},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"scale",{get:function(){return this._scale},set:function(b){this._scale=b},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"actualSize",{get:function(){return this._actualSize?this._actualSize:this._size},set:function(b){this._actualSize.equals(b)||(this._actualSize=b)},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"actualZOffset",{get:function(){return this._zOrder||1-this._hierarchyDepthOffset},
enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"minSize",{get:function(){return this._minSize},set:function(b){this._minSize&&b&&this._minSize.equals(b)||(this._minSize=b,this._parentLayoutDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"maxSize",{get:function(){return this._maxSize},set:function(b){this._maxSize&&b&&this._maxSize.equals(b)||(this._maxSize=b,this._parentLayoutDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,
"origin",{get:function(){return this._origin},set:function(b){this._origin=b},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"levelVisible",{get:function(){return this._isFlagSet(b.SmartPropertyPrim.flagLevelVisible)},set:function(c){this._changeFlags(b.SmartPropertyPrim.flagLevelVisible,c)},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"isVisible",{get:function(){return this._isFlagSet(b.SmartPropertyPrim.flagIsVisible)},set:function(c){this._changeFlags(b.SmartPropertyPrim.flagIsVisible,
c)},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"zOrder",{get:function(){return this._zOrder},set:function(b){this._zOrder=b;this.onZOrderChanged()},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"margin",{get:function(){var b=this;return this._margin||(this._margin=new j(function(){return b.parent?b.parent.margin:null},function(){return b._positioningDirty()})),this._margin},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"_hasMargin",{get:function(){return null!==
this._margin||null!==this._marginAlignment},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"padding",{get:function(){var b=this;return this._padding||(this._padding=new j(function(){return b.parent?b.parent.padding:null},function(){return b._positioningDirty()})),this._padding},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"_hasPadding",{get:function(){return null!==this._padding},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"marginAlignment",
{get:function(){var b=this;return this._marginAlignment||(this._marginAlignment=new d(function(){return b._positioningDirty()})),this._marginAlignment},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"layoutEngine",{get:function(){return this._layoutEngine||(this._layoutEngine=b.CanvasLayoutEngine.Singleton),this._layoutEngine},set:function(b){this._layoutEngine!==b&&this._changeLayoutEngine(b)},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"layoutArea",{get:function(){return this._layoutArea},
set:function(b){this._layoutArea.equals(b)||(this._positioningDirty(),this._layoutArea=b)},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"layoutAreaPos",{get:function(){return this._layoutAreaPos},set:function(b){this._layoutAreaPos.equals(b)||(this._positioningDirty(),this._layoutAreaPos=b)},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"isPickable",{get:function(){return this._isFlagSet(b.SmartPropertyPrim.flagIsPickable)},set:function(c){this._changeFlags(b.SmartPropertyPrim.flagIsPickable,
c)},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"hierarchyDepth",{get:function(){return this._hierarchyDepth},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"renderGroup",{get:function(){return this._renderGroup},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"globalTransform",{get:function(){return this._globalTransform},enumerable:!0,configurable:!0}),q.prototype.getGlobalPosition=function(){var c=new b.Vector2(0,0);return this.getGlobalPositionByRef(c),
c},q.prototype.getGlobalPositionByRef=function(b){b.x=this.globalTransform.m[12];b.y=this.globalTransform.m[13]},Object.defineProperty(q.prototype,"invGlobalTransform",{get:function(){return this._invGlobalTransform},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"localTransform",{get:function(){return this._updateLocalTransform(),this._localTransform},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"boundingInfo",{get:function(){if(this._isFlagSet(b.SmartPropertyPrim.flagBoundingInfoDirty)){for(var c=
this._boundingInfo=this.levelBoundingInfo.clone(),d=new b.BoundingInfo2D,e=0,f=this._children;e<f.length;e++){var g=f[e];g.boundingInfo.transformToRef(g.localTransform,d);c.unionToRef(d,c)}this._boundingSize=b.Size.Zero();c=this._boundingInfo.max();this._boundingSize=new b.Size(this._size&&null!=this._size.width?this._size.width:Math.ceil(c.x),this._size&&null!=this._size.height?this._size.height:Math.ceil(c.y));this._clearFlags(b.SmartPropertyPrim.flagBoundingInfoDirty)}return this._boundingInfo},
enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"isSizeAuto",{get:function(){return null==this._size},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"isPositionAuto",{get:function(){return null==this._position},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"pointerEventObservable",{get:function(){return this._pointerEventObservable},enumerable:!0,configurable:!0}),q.prototype.findById=function(b){if(this._id===b)return this;for(var c=0,d=this._children;c<
d.length;c++){var e=d[c].findById(b);if(null!=e)return e}},q.prototype.onZOrderChanged=function(){},q.prototype.levelIntersect=function(){return!1},q.prototype.setPointerEventCapture=function(b){return this.owner._setPointerCapture(b,this)},q.prototype.releasePointerEventsCapture=function(b){return this.owner._releasePointerCapture(b,this)},q.prototype.intersect=function(c){if(!c)return!1;var d=!c._globalPickPosition;if(d&&(c._globalPickPosition=b.Vector2.Zero(),b.Vector2.TransformToRef(c.pickPosition,
this.globalTransform,c._globalPickPosition),c._localPickPosition=c.pickPosition.clone(),c.intersectedPrimitives=[],c.topMostIntersectedPrimitive=null),!c.intersectHidden&&!this.isVisible)return!1;if(this.isPickable&&!this.boundingInfo.doesIntersect(c._localPickPosition))return c._exit(d),!1;var e=!1;if(this.isPickable&&(e=this.levelIntersect(c))){var f=new m(this,c._localPickPosition.clone());if(c.intersectedPrimitives.push(f),(!c.topMostIntersectedPrimitive||c.topMostIntersectedPrimitive.prim.actualZOffset>
f.prim.actualZOffset)&&(c.topMostIntersectedPrimitive=f),c.findFirstOnly)return c._exit(d),!0}if(!e||!c.findFirstOnly){e=0;for(f=this._children;e<f.length;e++){var g=f[e];if(g.isPickable&&(c.intersectHidden||g.isVisible)&&(b.Vector2.TransformToRef(c._globalPickPosition,g.invGlobalTransform,c._localPickPosition),g.intersect(c)&&c.findFirstOnly))return c._exit(d),!0}}return c._exit(d),c.isIntersected},q.prototype.moveChild=function(b,c){if(b.parent!==this)return!1;var d,e,f=this._children.indexOf(b),
g=c?this._children.indexOf(c):-1;c?(d=this._children[g]._siblingDepthOffset,e=this._children[g+1]._siblingDepthOffset):(d=1,e=this._children[1]._siblingDepthOffset);b._siblingDepthOffset=(e-d)/2;this._children.splice(g+1,0,this._children.splice(f,1)[0])},q.prototype.addChild=function(b){b._parent=this;this._boundingBoxDirty();this._patchHierarchyDepth(b);this._children.push(b)},q.prototype.dispose=function(){if(!n.prototype.dispose.call(this))return!1;if(this._actionManager&&(this._actionManager.dispose(),
this._actionManager=null),this._parent){var b=this._parent._children.indexOf(this);void 0!==b&&this._parent._children.splice(b,1);this._parent=null}if(this._children)for(;0<this._children.length;)this._children[this._children.length-1].dispose();return!0},q.prototype.onPrimBecomesDirty=function(){this._renderGroup&&this._renderGroup._addPrimToDirtyList(this)},q.prototype._needPrepare=function(){return this._areSomeFlagsSet(b.SmartPropertyPrim.flagVisibilityChanged|b.SmartPropertyPrim.flagModelDirty)||
0!==this._instanceDirtyFlags||this._globalTransformProcessStep!==this._globalTransformStep},q.prototype._prepareRender=function(b){this._prepareRenderPre(b);this._prepareRenderPost(b)},q.prototype._prepareRenderPre=function(){},q.prototype._prepareRenderPost=function(c){this instanceof b.Group2D&&this.isRenderableGroup||(0<this._children.length&&(this._globalTransformProcessStep!==this._globalTransformStep||this.checkPropertiesDirty(q.isVisibleProperty.flagId))&&this._children.forEach(function(d){d instanceof
b.Group2D&&d.isRenderableGroup||d._prepareRender(c)}),this._clearFlags(b.SmartPropertyPrim.flagModelDirty),this._instanceDirtyFlags=0)},q.prototype._canvasPreInit=function(){},q.CheckParent=function(){},q.prototype.updateCachedStatesOf=function(b,c){for(var d=0;d<b.length;d++)b[d].updateCachedStates(c)},q.prototype._parentLayoutDirty=function(){this._parent&&!this._parent.isDisposed&&this._parent._setLayoutDirty()},q.prototype._setLayoutDirty=function(){this.isDirty||this.onPrimBecomesDirty();this._setFlags(b.SmartPropertyPrim.flagLayoutDirty)},
q.prototype._checkPositionChange=function(){return this.parent&&!1===this.parent.layoutEngine.isChildPositionAllowed?(console.log("Can't manually set the position of "+this.id+", the Layout Engine of its parent doesn't allow it"),!1):!0},q.prototype._positioningDirty=function(){this.isDirty||this.onPrimBecomesDirty();this._setFlags(b.SmartPropertyPrim.flagPositioningDirty)},q.prototype._changeLayoutEngine=function(b){this._layoutEngine=b},q.prototype._updateLocalTransform=function(){var c=!1,d=null;
this._parent?(d=this._parent._marginOffset,c=!d.equals(this._parentMargingOffset),this._parentMargingOffset.copyFrom(d)):d=q._v0;var e=q.actualPositionProperty.flagId|q.rotationProperty.flagId|q.scaleProperty.flagId|q.originProperty.flagId;if(c||this.checkPropertiesDirty(e)){c=b.Quaternion.RotationAxis(new b.Vector3(0,0,1),this._rotation);if(0===this._origin.x&&0===this._origin.y)this._localTransform=d=b.Matrix.Compose(new b.Vector3(this._scale,this._scale,1),c,new b.Vector3(this.actualPosition.x+
d.x,this.actualPosition.y+d.y,0));else{var f=this.actualSize;b.Matrix.TranslationToRef(-f.width*this._origin.x,-f.height*this._origin.y,0,q._t0);c.toRotationMatrix(q._t1);q._t0.multiplyToRef(q._t1,q._t2);b.Matrix.ScalingToRef(this._scale,this._scale,1,q._t0);q._t2.multiplyToRef(q._t0,q._t1);b.Matrix.TranslationToRef(f.width*this._origin.x+this.actualPosition.x+d.x,f.height*this._origin.y+this.actualPosition.y+d.y,0,q._t2);q._t1.multiplyToRef(q._t2,this._localTransform)}return this.clearPropertiesDirty(e),
!0}return!1},q.prototype.updateCachedStates=function(c){if(!this.isDisposed){this._parent&&(this._parent._globalTransformProcessStep!==this.owner._globalTransformProcessStep||this._parent._areSomeFlagsSet(b.SmartPropertyPrim.flagLayoutDirty|b.SmartPropertyPrim.flagPositioningDirty))&&this._parent.updateCachedStates(!1);var d=this.checkPropertiesDirty(q.sizeProperty.flagId);!this._isFlagSet(b.SmartPropertyPrim.flagLayoutDirty)&&d&&this.size&&(null!=this.size.width&&(this.actualSize.width=this.size.width),
null!=this.size.height&&(this.actualSize.height=this.size.height),this.clearPropertiesDirty(q.sizeProperty.flagId));var e=this._isFlagSet(b.SmartPropertyPrim.flagPositioningDirty);this._isFlagSet(b.SmartPropertyPrim.flagLayoutDirty)&&(this._layoutEngine.updateLayout(this),this._clearFlags(b.SmartPropertyPrim.flagLayoutDirty));e=e&&!this._isFlagSet(b.SmartPropertyPrim.flagPositioningDirty);if(!e&&(d||this._isFlagSet(b.SmartPropertyPrim.flagPositioningDirty)||this._parent&&!this._parent.contentArea.equals(this._parentContentArea))&&
(this._updatePositioning(),this._clearFlags(b.SmartPropertyPrim.flagPositioningDirty),e=!0),e&&this._parent&&this._parentContentArea.copyFrom(this._parent.contentArea),this===this.owner||this._globalTransformProcessStep!==this.owner._globalTransformProcessStep){d=this.isVisible;this.isVisible=(!this._parent||this._parent.isVisible)&&this.levelVisible;this._changeFlags(b.SmartPropertyPrim.flagVisibilityChanged,d!==this.isVisible);d=this._updateLocalTransform();e=null!=this._parent?this._parent._globalTransformStep!==
this._parentTransformStep:!1;if(!this._globalTransform||d||e)d=this._parent?this._parent._globalTransform:null,this._globalTransform=this._parent?this._localTransform.multiply(d):this._localTransform,this._invGlobalTransform=b.Matrix.Invert(this._globalTransform),this._globalTransformStep=this.owner._globalTransformProcessStep+1,this._parentTransformStep=this._parent?this._parent._globalTransformStep:0;this._globalTransformProcessStep=this.owner._globalTransformProcessStep}if(c){c=0;for(d=this._children;c<
d.length;c++)e=d[c],e.updateCachedStates(!(e instanceof b.Group2D&&e.isRenderableGroup))}}},q.prototype._updatePositioning=function(){this._hasMargin||null!=this.actualSize.width&&null!=this.actualSize.height||(null==this.actualSize.width&&(this.marginAlignment.horizontal=d.AlignStretch),null==this.actualSize.height&&(this.marginAlignment.vertical=d.AlignStretch));this._hasMargin&&(this.margin.computeWithAlignment(this.layoutArea,this.size,this.marginAlignment,this._marginOffset,q._size),this.actualPosition=
this._marginOffset.add(this._layoutAreaPos),null!=this.size.width&&(this.size.width=q._size.width),null!=this.size.height&&(this.size.height=q._size.height),this.actualSize.copyFrom(q._size.clone()));this._hasPadding?(this._getInitialContentAreaToRef(this.actualSize,q._icPos,q._icArea),q._icArea.width=Math.max(0,q._icArea.width),q._icArea.height=Math.max(0,q._icArea.height),this.padding.compute(q._icArea,this._marginOffset,q._size),this._marginOffset.x+=q._icPos.x,this._marginOffset.y+=q._icPos.y,
this._contentArea.copyFrom(q._size)):(this._getInitialContentAreaToRef(this.actualSize,q._icPos,q._icArea),q._icArea.width=Math.max(0,q._icArea.width),q._icArea.height=Math.max(0,q._icArea.height),this._marginOffset.copyFrom(q._icPos),this._contentArea.copyFrom(q._icArea))},Object.defineProperty(q.prototype,"contentArea",{get:function(){return this._isFlagSet(b.SmartPropertyPrim.flagPositioningDirty)&&(this._updatePositioning(),this._clearFlags(b.SmartPropertyPrim.flagPositioningDirty)),this._contentArea},
enumerable:!0,configurable:!0}),q.prototype._patchHierarchy=function(c){if(this._owner=c,null==this._renderGroup){this instanceof b.Group2D&&(this.detectGroupStates(),this._trackedNode&&!this._isFlagSet(b.SmartPropertyPrim.flagTrackedGroup)&&this.owner._registerTrackedNode(this));if(this._parent&&(this._renderGroup=this.parent.traverseUp(function(c){return c instanceof b.Group2D&&c.isRenderableGroup}),this._parentLayoutDirty()),this._renderGroup&&this.isDirty){var d=this._renderGroup._renderableData._primDirtyList;
-1===d.indexOf(this)&&d.push(this)}for(var d=0,e=this._children;d<e.length;d++){var f=e[d];this._patchHierarchyDepth(f);f._patchHierarchy(c)}}},q.prototype._patchHierarchyDepth=function(c){c._hierarchyDepth=this._hierarchyDepth+1;c._hierarchyDepthOffset=this._hierarchyDepthOffset+(this._children.length+1)*this._siblingDepthOffset;c._siblingDepthOffset=this._siblingDepthOffset/b.Canvas2D.hierarchyLevelMaxSiblingCount},q.prototype._getInitialContentAreaToRef=function(b,c,d){d.width=b.width;d.height=
b.height;c.x=c.y=0},q.PRIM2DBASE_PROPCOUNT=15,q._nullPosition=b.Vector2.Zero(),q.boundinbBoxReentrency=!1,q.nullSize=b.Size.Zero(),q._isCanvasInit=!1,q._t0=new b.Matrix,q._t1=new b.Matrix,q._t2=new b.Matrix,q._v0=b.Vector2.Zero(),q._icPos=b.Vector2.Zero(),q._icArea=b.Size.Zero(),q._size=b.Size.Zero(),__decorate([b.instanceLevelProperty(1,function(b){return q.actualPositionProperty=b},!1,!0)],q.prototype,"actualPosition",null),__decorate([b.dynamicLevelProperty(1,function(b){return q.positionProperty=
b},!1,!0)],q.prototype,"position",null),__decorate([b.dynamicLevelProperty(2,function(b){return q.sizeProperty=b},!1,!0)],q.prototype,"size",null),__decorate([b.instanceLevelProperty(3,function(b){return q.rotationProperty=b},!1,!0)],q.prototype,"rotation",null),__decorate([b.instanceLevelProperty(4,function(b){return q.scaleProperty=b},!1,!0)],q.prototype,"scale",null),__decorate([b.dynamicLevelProperty(5,function(b){return q.originProperty=b},!1,!0)],q.prototype,"origin",null),__decorate([b.dynamicLevelProperty(6,
function(b){return q.levelVisibleProperty=b})],q.prototype,"levelVisible",null),__decorate([b.instanceLevelProperty(7,function(b){return q.isVisibleProperty=b})],q.prototype,"isVisible",null),__decorate([b.instanceLevelProperty(8,function(b){return q.zOrderProperty=b})],q.prototype,"zOrder",null),__decorate([b.dynamicLevelProperty(9,function(b){return q.marginProperty=b})],q.prototype,"margin",null),__decorate([b.dynamicLevelProperty(10,function(b){return q.paddingProperty=b})],q.prototype,"padding",
null),__decorate([b.dynamicLevelProperty(11,function(b){return q.marginAlignmentProperty=b})],q.prototype,"marginAlignment",null),q=__decorate([b.className("Prim2DBase")],q));b.Prim2DBase=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(c,d,e){this._partCount=e;this.owner=c;this.modelRenderCache=d;this.modelRenderCache.addRef();this.partIndexFromId=new b.StringDictionary;this._usedShaderCategories=Array(e);this._strides=Array(e);this._transparentData=this._alphaTestData=this._opaqueData=null;this.opaqueDirty=this.alphaTestDirty=this.transparentDirty=this.transparentOrderDirty=!1};f=(f.prototype.dispose=function(){if(this._isDisposed)return!1;this.modelRenderCache&&this.modelRenderCache.dispose();var b=
this.owner.owner.engine;return this.opaqueData&&(this.opaqueData.forEach(function(c){return c.dispose(b)}),this.opaqueData=null),this.partIndexFromId=null,this._isDisposed=!0,!0},Object.defineProperty(f.prototype,"hasOpaqueData",{get:function(){return null!=this._opaqueData},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"hasAlphaTestData",{get:function(){return null!=this._alphaTestData},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"hasTransparentData",{get:function(){return null!=
this._transparentData},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"opaqueData",{get:function(){if(!this._opaqueData){this._opaqueData=Array(this._partCount);for(var b=0;b<this._partCount;b++)this._opaqueData[b]=new e(this._strides[b])}return this._opaqueData},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"alphaTestData",{get:function(){if(!this._alphaTestData){this._alphaTestData=Array(this._partCount);for(var b=0;b<this._partCount;b++)this._alphaTestData[b]=
new e(this._strides[b])}return this._alphaTestData},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"transparentData",{get:function(){if(!this._transparentData){this._transparentData=Array(this._partCount);for(var b=0;b<this._partCount;b++)this._transparentData[b]=new c(this._strides[b],this.modelRenderCache._partData[b]._zBiasOffset)}return this._transparentData},enumerable:!0,configurable:!0}),f.prototype.sortTransparentData=function(){if(this.transparentOrderDirty){for(var b=
0;b<this._transparentData.length;b++)this._transparentData[b]._partData.sort();this.transparentOrderDirty=!1}},Object.defineProperty(f.prototype,"usedShaderCategories",{get:function(){return this._usedShaderCategories},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"strides",{get:function(){return this._strides},enumerable:!0,configurable:!0}),f);b.GroupInstanceInfo=f;b.TransparentSegment=function(){};var e;f=function(c){this._partBuffer=this._partData=null;this._partBufferSize=
0;this._partData=new b.DynamicFloatArray(c/4,50);this._isDisposed=!1};e=(f.prototype.dispose=function(b){return this._isDisposed?!1:(this._partBuffer&&(b._releaseBuffer(this._partBuffer),this._partBuffer=null),this._partData=null,void(this._isDisposed=!0))},f);b.GroupInfoPartData=e;var c,d=e;f=function(b,c){d.call(this,b);this._partData.compareValueOffset=c;this._partData.sortingAscending=!1};c=(__extends(f,d),f);b.TransparentGroupInfoPartData=c;var g=function(c,d){this._engine=c;this._modelKey=d;
this._refCounter=this._nextKey=1;this._instancesData=new b.StringDictionary;this._partData=null};f=(g.prototype.dispose=function(){if(0!==--this._refCounter)return!1;var b=this._engine.getExternalData("__BJSCANVAS2D__");return b&&b.DisposeModelRenderCache(this),!0},Object.defineProperty(g.prototype,"isDisposed",{get:function(){return 0>=this._refCounter},enumerable:!0,configurable:!0}),g.prototype.addRef=function(){return++this._refCounter},Object.defineProperty(g.prototype,"modelKey",{get:function(){return this._modelKey},
enumerable:!0,configurable:!0}),g.prototype.render=function(){return!0},g.prototype.addInstanceDataParts=function(b){var c=this._nextKey.toString();if(!this._instancesData.add(c,b))throw Error("Key: "+c+" is already allocated");return++this._nextKey,c},g.prototype.removeInstanceData=function(b){this._instancesData.remove(b)},g.prototype.getPartIndexFromId=function(b){for(var c=0;c<this._partData.length;c++)if(this._partData[c]._partId===b)return c;return null},g.prototype.loadInstancingAttributes=
function(b,c){var d=this.getPartIndexFromId(b);return null===d?null:this._partsClassInfo[d].classContent.getInstancingAttributeInfos(c,this._partData[d]._partUsedCategories)},g.prototype.setupUniforms=function(b,c,d,e){var f=this._partData[c],p=f._partDataStride/4*e;this._partsClassInfo[c].fullContent.forEach(function(c,e){if(!e.category||-1!==f._partUsedCategories.indexOf(e.category))switch(e.dataType){case 4:var j=e.instanceOffset.get(f._partJoinedUsedCategories);b.setFloat(e.attributeName,d.buffer[p+
j]);break;case 0:j=e.instanceOffset.get(f._partJoinedUsedCategories);g.v2.x=d.buffer[p+j+0];g.v2.y=d.buffer[p+j+1];b.setVector2(e.attributeName,g.v2);break;case 5:case 1:j=e.instanceOffset.get(f._partJoinedUsedCategories);g.v3.x=d.buffer[p+j+0];g.v3.y=d.buffer[p+j+1];g.v3.z=d.buffer[p+j+2];b.setVector3(e.attributeName,g.v3);break;case 6:case 2:j=e.instanceOffset.get(f._partJoinedUsedCategories),g.v4.x=d.buffer[p+j+0],g.v4.y=d.buffer[p+j+1],g.v4.z=d.buffer[p+j+2],g.v4.w=d.buffer[p+j+3],b.setVector4(e.attributeName,
g.v4)}})},g.v2=b.Vector2.Zero(),g.v3=b.Vector3.Zero(),g.v4=b.Vector4.Zero(),g);b.ModelRenderCache=f;b.ModelRenderCachePartData=function(){}}(BABYLON||(BABYLON={}));
!function(b){function f(c,f){return function(g,j,m){var t=b.ClassTreeInfo.getOrRegister(g,function(b){return new e(b)}).getLevelOf(g);f=f||j;var s=t.levelContent.get(j);if(s)throw Error("The ID "+j+" is already taken by another instance data");s=new d;s.attributeName=f;s.category=c||null;s.category&&(s.delimitedCategory=";"+s.category+";");t.levelContent.add(j,s);m.get=function(){return null};m.set=function(b){if(!s.category||-1!==e._CurCategories.indexOf(s.delimitedCategory))if(s.size?s.instanceOffset.contains(e._CurCategories)||
t.classContent.mapProperty(s,!1):(s.setSize(b),t.classContent.mapProperty(s,!0)),this.dataBuffer&&this.dataElements){var c=this.dataElements[this.curElement].offset+s.instanceOffset.get(e._CurCategories);s.writeData(this.dataBuffer.buffer,c,b)}}}}var e,c=function(c){this._baseInfo=c;this._nextOffset=new b.StringDictionary;this._attributes=[]};e=(c.prototype.mapProperty=function(b,d){var e=this._nextOffset.getOrAdd(c._CurCategories,0);b.instanceOffset.add(c._CurCategories,this._getBaseOffset(c._CurCategories)+
e);this._nextOffset.set(c._CurCategories,e+b.size/4);d&&this._attributes.push(b)},c.prototype.getInstancingAttributeInfos=function(c,d){for(var e=";"+d.join(";")+";",f=[],g=this;g;){for(var j=0,m=g._attributes;j<m.length;j++){var u=m[j];if(!u.category||-1!==d.indexOf(u.category)){var x=c.getAttributeLocationByName(u.attributeName),y=new b.InstancingAttributeInfo;y.index=x;y.attributeSize=u.size/4;y.offset=4*u.instanceOffset.get(e);y.attributeName=u.attributeName;f.push(y)}}g=g._baseInfo}return f},
c.prototype.getShaderAttributes=function(b){for(var c=[],d=this;d;){for(var e=0,f=d._attributes;e<f.length;e++){var g=f[e];g.category&&-1===b.indexOf(g.category)||c.push(g.attributeName)}d=d._baseInfo}return c},c.prototype._getBaseOffset=function(b){for(var c=0,d=this._baseInfo;d;)c+=d._nextOffset.getOrAdd(b,0),d=d._baseInfo;return c},c);b.InstanceClassInfo=e;var d,g=function(){this.instanceOffset=new b.StringDictionary};d=(g.prototype.setSize=function(c){if(c instanceof b.Vector2)return this.size=
8,void(this.dataType=0);if(c instanceof b.Vector3)return this.size=12,void(this.dataType=1);if(c instanceof b.Vector4)return this.size=16,void(this.dataType=2);if(c instanceof b.Matrix)throw Error("Matrix type is not supported by WebGL Instance Buffer, you have to use four Vector4 properties instead");return"number"==typeof c?(this.size=4,void(this.dataType=4)):c instanceof b.Color3?(this.size=12,void(this.dataType=5)):c instanceof b.Color4?(this.size=16,void(this.dataType=6)):c instanceof b.Size?
(this.size=8,void(this.dataType=7)):void 0},g.prototype.writeData=function(b,c,d){switch(this.dataType){case 0:b[c+0]=d.x;b[c+1]=d.y;break;case 1:b[c+0]=d.x;b[c+1]=d.y;b[c+2]=d.z;break;case 2:b[c+0]=d.x;b[c+1]=d.y;b[c+2]=d.z;b[c+3]=d.w;break;case 5:b[c+0]=d.r;b[c+1]=d.g;b[c+2]=d.b;break;case 6:b[c+0]=d.r;b[c+1]=d.g;b[c+2]=d.b;b[c+3]=d.a;break;case 4:b[c]=d;break;case 3:for(var e=0;16>e;e++)b[c+e]=d.m[e];break;case 7:b[c+0]=d.width,b[c+1]=d.height}},g);b.InstancePropInfo=d;b.instanceData=f;g=function(b,
c){this.id=b;this.curElement=0;this.dataElementCount=c};g=(Object.defineProperty(g.prototype,"zBias",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"transformX",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"transformY",{get:function(){return null},enumerable:!0,configurable:!0}),g.prototype.getClassTreeInfo=function(){return this.typeInfo||(this.typeInfo=b.ClassTreeInfo.get(Object.getPrototypeOf(this))),
this.typeInfo},g.prototype.allocElements=function(){if(this.dataBuffer){for(var b=Array(this.dataElementCount),c=0;c<this.dataElementCount;c++)b[c]=this.dataBuffer.allocElement();this.dataElements=b}},g.prototype.freeElements=function(){if(this.dataElements){for(var b=0,c=this.dataElements;b<c.length;b++)this.dataBuffer.freeElement(c[b]);this.dataElements=null}},Object.defineProperty(g.prototype,"dataElementCount",{get:function(){return this._dataElementCount},set:function(b){b!==this._dataElementCount&&
(this.freeElements(),this._dataElementCount=b,this.allocElements())},enumerable:!0,configurable:!0}),__decorate([f()],g.prototype,"zBias",null),__decorate([f()],g.prototype,"transformX",null),__decorate([f()],g.prototype,"transformY",null),g);b.InstanceDataBase=g;var m=b.Prim2DBase,j=function(b){m.call(this,b);this._isAlphaTest=this._isTransparent=!1;this._transparentPrimitiveInfo=null},g=(__extends(j,m),Object.defineProperty(j.prototype,"isAlphaTest",{get:function(){return this._isAlphaTest},set:function(b){this._isAlphaTest=
b},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"isTransparent",{get:function(){return this._isTransparent},set:function(b){this._isTransparent=b},enumerable:!0,configurable:!0}),j.prototype.dispose=function(){return m.prototype.dispose.call(this)?(this._transparentPrimitiveInfo&&(this.renderGroup._renderableData.removeTransparentPrimitiveInfo(this._transparentPrimitiveInfo),this._transparentPrimitiveInfo=null),this._modelRenderInstanceID&&(this._modelRenderCache.removeInstanceData(this._modelRenderInstanceID),
this._modelRenderInstanceID=null),this._modelRenderCache&&(this._modelRenderCache.dispose(),this._modelRenderCache=null),this._instanceDataParts&&(this._instanceDataParts.forEach(function(b){b.freeElements()}),this._instanceDataParts=null),!0):!1},j.prototype._prepareRenderPre=function(c){m.prototype._prepareRenderPre.call(this,c);this._isFlagSet(b.SmartPropertyPrim.flagModelDirty)&&this._modelRenderInstanceID&&(this._modelRenderCache.removeInstanceData(this._modelRenderInstanceID),this._modelRenderInstanceID=
null);var d=!1;this._modelRenderCache&&!this._isFlagSet(b.SmartPropertyPrim.flagModelDirty)||(d=this._createModelRenderCache());var e=null,f=!1;this._modelRenderInstanceID||(f=!0,e=this._createModelDataParts());d&&this.setupModelRenderCache(this._modelRenderCache);(this._isFlagSet(b.SmartPropertyPrim.flagVisibilityChanged)||c.forceRefreshPrimitive||f||0!==this._instanceDirtyFlags||this._globalTransformProcessStep!==this._globalTransformStep)&&(this.isTransparent,this._updateInstanceDataParts(e))},
j.prototype._createModelRenderCache=function(){var c=this,d=!1;return this._modelRenderCache&&this._modelRenderCache.dispose(),this._modelRenderCache=this.owner._engineData.GetOrAddModelCache(this.modelKey,function(b){b=c.createModelRenderCache(b);return d=!0,b}),this._clearFlags(b.SmartPropertyPrim.flagModelDirty),d||this._modelRenderCache.addRef(),d},j.prototype._createModelDataParts=function(){var c=this,d=this.createInstanceDataParts();this._instanceDataParts=d;this._modelRenderCache._partData||
this._setupModelRenderCache(d);for(var e=this.renderGroup._renderableData._renderGroupInstancesInfo.getOrAddWithFactory(this.modelKey,function(){for(var d=new b.GroupInstanceInfo(c.renderGroup,c._modelRenderCache,c._modelRenderCache._partData.length),e=0;e<c._modelRenderCache._partData.length;e++){var f=c._instanceDataParts[e];d.partIndexFromId.add(f.id.toString(),e);d.usedShaderCategories[e]=";"+c.getUsedShaderCategories(f).join(";")+";";d.strides[e]=c._modelRenderCache._partData[e]._partDataStride}return d}),
f=null,f=this.isTransparent?e.transparentData:this.isAlphaTest?e.alphaTestData:e.opaqueData,g=0;g<d.length;g++){var j=d[g];j.dataBuffer=f[g]._partData;j.allocElements()}return this._modelRenderInstanceID=this._modelRenderCache.addInstanceDataParts(this._instanceDataParts),e},j.prototype._setupModelRenderCache=function(c){var d=[];this._modelRenderCache._partData=[];for(var f=0;f<c.length;f++){var g=c[f],j=new b.ModelRenderCachePartData;this._modelRenderCache._partData.push(j);var m=this.getUsedShaderCategories(g),
s=g.getClassTreeInfo(),u=this.isVisible;this.isVisible=!0;var x=";"+m.join(";")+";";j._partJoinedUsedCategories=x;e._CurCategories=x;var y=this.beforeRefreshForLayoutConstruction(g);this.refreshInstanceDataPart(g);this.afterRefreshForLayoutConstruction(g,y);this.isVisible=u;var z=0;s.fullContent.forEach(function(c,d){d.category&&-1===m.indexOf(d.category)||("zBias"===d.attributeName&&(j._zBiasOffset=d.instanceOffset.get(x)),d.size?z+=d.size:console.log("ERROR: Couldn't detect the size of the Property "+
d.attributeName+" from type "+b.Tools.getClassName(s.type)+". Property is ignored."))});j._partDataStride=z;j._partUsedCategories=m;j._partId=g.id;d.push(s)}this._modelRenderCache._partsClassInfo=d},j.prototype.onZOrderChanged=function(){this.isTransparent&&this._transparentPrimitiveInfo&&(this.renderGroup._renderableData.transparentPrimitiveZChanged(this._transparentPrimitiveInfo),this.renderGroup._renderableData._renderGroupInstancesInfo.get(this.modelKey).transparentOrderDirty=!0)},j.prototype._updateInstanceDataParts=
function(c){c||(c=this.renderGroup._renderableData._renderGroupInstancesInfo.get(this.modelKey));this.isTransparent&&this._isFlagSet(b.SmartPropertyPrim.flagVisibilityChanged)&&(this.isVisible?this._transparentPrimitiveInfo||(this._transparentPrimitiveInfo=this.renderGroup._renderableData.addNewTransparentPrimitiveInfo(this,c)):this._transparentPrimitiveInfo&&(this.renderGroup._renderableData.removeTransparentPrimitiveInfo(this._transparentPrimitiveInfo),this._transparentPrimitiveInfo=null),c.transparentOrderDirty=
!0);for(var d=0,f=this._instanceDataParts;d<f.length;d++){var g=f[d];this._isFlagSet(b.SmartPropertyPrim.flagVisibilityChanged)&&!g.dataElements&&g.allocElements();e._CurCategories=c.usedShaderCategories[c.partIndexFromId.get(g.id.toString())];this.refreshInstanceDataPart(g)||g.dataElements&&g.freeElements()}this._instanceDirtyFlags=0;this.isTransparent?c.transparentDirty=!0:this.isAlphaTest?c.alphaTestDirty=!0:c.opaqueDirty=!0;this._clearFlags(b.SmartPropertyPrim.flagVisibilityChanged)},j.prototype._getFirstIndexInDataBuffer=
function(){for(var b=0,c=this._instanceDataParts;b<c.length;b++){var d=c[b];if(d)return d.dataElements[0].offset/d.dataBuffer.stride}return null},j.prototype._getLastIndexInDataBuffer=function(){for(var b=0,c=this._instanceDataParts;b<c.length;b++){var d=c[b];if(d)return d.dataElements[d.dataElements.length-1].offset/d.dataBuffer.stride}return null},j.prototype._getNextPrimZOrder=function(){for(var b=this._instanceDataParts.length,c=0;b>c;c++){var d=this._instanceDataParts[c];if(d){var b=d.dataBuffer.stride,
e=d.dataElements[d.dataElements.length-1].offset;return d.dataBuffer.totalElementCount*b<=e?null:d.dataBuffer[e+b+this.modelRenderCache._partData[c]._zBiasOffset]}}return null},j.prototype._getPrevPrimZOrder=function(){for(var b=this._instanceDataParts.length,c=0;b>c;c++){var d=this._instanceDataParts[c];if(d){var b=d.dataBuffer.stride,e=d.dataElements[0].offset;return 0===e?null:d.dataBuffer[e-b+this.modelRenderCache._partData[c]._zBiasOffset]}}return null},j.prototype.transformPointWithOriginByRef=
function(b,c,d){var e=this.actualSize;d.x=b.x-(this.origin.x+(c?c.x:0))*e.width;d.y=b.y-(this.origin.y+(c?c.y:0))*e.height},j.prototype.transformPointWithOriginToRef=function(b,c,d){return this.transformPointWithOriginByRef(b,c,d),d},j.prototype.getDataPartEffectInfo=function(c,d,e){void 0===e&&(e=null);var f=b.Tools.first(this._instanceDataParts,function(b){return b.id===c});if(!f)return null;var g=this.owner.supportInstancedArray;if(null!=e){if(e&&!1===g)return null;g=e}e=f.getClassTreeInfo();f=
this.getUsedShaderCategories(f);e=e.classContent.getShaderAttributes(f);var j="";return f.forEach(function(b){j+="#define "+b+"\n"}),g&&(j+="#define Instanced\n"),{attributes:g?d.concat(e):d,uniforms:g?[]:e,defines:j}},Object.defineProperty(j.prototype,"modelRenderCache",{get:function(){return this._modelRenderCache},enumerable:!0,configurable:!0}),j.prototype.createModelRenderCache=function(){return null},j.prototype.setupModelRenderCache=function(){},j.prototype.createInstanceDataParts=function(){return null},
j.prototype.getUsedShaderCategories=function(){return[]},j.prototype.beforeRefreshForLayoutConstruction=function(){},j.prototype.afterRefreshForLayoutConstruction=function(){},j.prototype.refreshInstanceDataPart=function(b){return this.isVisible?(b.isVisible=this.isVisible,1===b.dataElementCount&&(b.curElement=0,this.updateInstanceDataPart(b)),!0):!1},j.prototype.updateInstanceDataPart=function(c,d){void 0===d&&(d=null);var e=this._globalTransform.multiply(this.renderGroup.invGlobalTransform),f=this.renderGroup.viewportSize,
g=this.actualZOffset,j=0,m=0;d&&(j=d.x*e.m[0]+d.y*e.m[4],m=d.x*e.m[1]+d.y*e.m[5]);var u=f.width,x=f.height,f=1/g,j=new b.Vector4(2*e.m[0]/u,2*e.m[4]/u,0,2*(e.m[12]+j)/u-1),e=new b.Vector4(2*e.m[1]/x,2*e.m[5]/x,0,2*(e.m[13]+m)/x-1);c.transformX=j;c.transformY=e;c.zBias=new b.Vector2(g,f)},j.RENDERABLEPRIM2D_PROPCOUNT=b.Prim2DBase.PRIM2DBASE_PROPCOUNT+5,__decorate([b.dynamicLevelProperty(b.Prim2DBase.PRIM2DBASE_PROPCOUNT+0,function(b){return j.isAlphaTestProperty=b})],j.prototype,"isAlphaTest",null),
__decorate([b.dynamicLevelProperty(b.Prim2DBase.PRIM2DBASE_PROPCOUNT+1,function(b){return j.isTransparentProperty=b})],j.prototype,"isTransparent",null),j=__decorate([b.className("RenderablePrim2D")],j));b.RenderablePrim2D=g}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.RenderablePrim2D,c=function(c){e.call(this,c);c||(c={});var d=null;c.border&&(d="string"==typeof c.border?b.Canvas2D.GetBrushFromString(c.border):c.border);var f=null;c.fill&&(f="string"==typeof c.fill?b.Canvas2D.GetBrushFromString(c.fill):c.fill);this.border=d;this.fill=f;this.borderThickness=c.borderThickness};f=(__extends(c,e),Object.defineProperty(c.prototype,"border",{get:function(){return this._border},set:function(b){this._border=b;this._updateTransparencyStatus()},enumerable:!0,
configurable:!0}),Object.defineProperty(c.prototype,"fill",{get:function(){return this._fill},set:function(b){this._fill=b;this._updateTransparencyStatus()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"borderThickness",{get:function(){return this._borderThickness},set:function(b){this._borderThickness=b},enumerable:!0,configurable:!0}),c.prototype.getUsedShaderCategories=function(d){var f=e.prototype.getUsedShaderCategories.call(this,d);if(d.id===c.SHAPE2D_FILLPARTID){var g=
this.fill;g instanceof b.SolidColorBrush2D&&f.push(c.SHAPE2D_CATEGORY_FILLSOLID);g instanceof b.GradientColorBrush2D&&f.push(c.SHAPE2D_CATEGORY_FILLGRADIENT)}d.id===c.SHAPE2D_BORDERPARTID&&(f.push(c.SHAPE2D_CATEGORY_BORDER),d=this.border,d instanceof b.SolidColorBrush2D&&f.push(c.SHAPE2D_CATEGORY_BORDERSOLID),d instanceof b.GradientColorBrush2D&&f.push(c.SHAPE2D_CATEGORY_BORDERGRADIENT));return f},c.prototype.refreshInstanceDataPart=function(d){if(!e.prototype.refreshInstanceDataPart.call(this,d))return!1;
if(d.id===c.SHAPE2D_FILLPARTID){if(this.fill){var f=this.fill;f instanceof b.SolidColorBrush2D?d.fillSolidColor=f.color:f instanceof b.GradientColorBrush2D&&(d.fillGradientColor1=f.color1,d.fillGradientColor2=f.color2,f=b.Matrix.Compose(new b.Vector3(f.scale,f.scale,f.scale),b.Quaternion.RotationAxis(new b.Vector3(0,0,1),f.rotation),new b.Vector3(f.translation.x,f.translation.y,0)),f=new b.Vector4(f.m[1],f.m[5],f.m[9],f.m[13]),d.fillGradientTY=f)}}else d.id===c.SHAPE2D_BORDERPARTID&&this.border&&
(d.borderThickness=this.borderThickness,f=this.border,f instanceof b.SolidColorBrush2D?d.borderSolidColor=f.color:f instanceof b.GradientColorBrush2D&&(d.borderGradientColor1=f.color1,d.borderGradientColor2=f.color2,f=b.Matrix.Compose(new b.Vector3(f.scale,f.scale,f.scale),b.Quaternion.RotationAxis(new b.Vector3(0,0,1),f.rotation),new b.Vector3(f.translation.x,f.translation.y,0)),f=new b.Vector4(f.m[1],f.m[5],f.m[9],f.m[13]),d.borderGradientTY=f));return!0},c.prototype._updateTransparencyStatus=function(){this.isTransparent=
this._border&&this._border.isTransparent()||this._fill&&this._fill.isTransparent()},c.SHAPE2D_BORDERPARTID=1,c.SHAPE2D_FILLPARTID=2,c.SHAPE2D_CATEGORY_BORDER="Border",c.SHAPE2D_CATEGORY_BORDERSOLID="BorderSolid",c.SHAPE2D_CATEGORY_BORDERGRADIENT="BorderGradient",c.SHAPE2D_CATEGORY_FILLSOLID="FillSolid",c.SHAPE2D_CATEGORY_FILLGRADIENT="FillGradient",c.SHAPE2D_PROPCOUNT=b.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+5,__decorate([b.modelLevelProperty(b.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+1,function(b){return c.borderProperty=
b},!0)],c.prototype,"border",null),__decorate([b.modelLevelProperty(b.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+2,function(b){return c.fillProperty=b},!0)],c.prototype,"fill",null),__decorate([b.instanceLevelProperty(b.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+3,function(b){return c.borderThicknessProperty=b})],c.prototype,"borderThickness",null),c=__decorate([b.className("Shape2D")],c));b.Shape2D=f;var d=b.InstanceDataBase,g=function(){d.apply(this,arguments)};f=(__extends(g,d),Object.defineProperty(g.prototype,
"fillSolidColor",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"fillGradientColor1",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"fillGradientColor2",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"fillGradientTY",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"borderThickness",{get:function(){return null},
enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"borderSolidColor",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"borderGradientColor1",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"borderGradientColor2",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"borderGradientTY",{get:function(){return null},enumerable:!0,configurable:!0}),__decorate([b.instanceData(f.SHAPE2D_CATEGORY_FILLSOLID)],
g.prototype,"fillSolidColor",null),__decorate([b.instanceData(f.SHAPE2D_CATEGORY_FILLGRADIENT)],g.prototype,"fillGradientColor1",null),__decorate([b.instanceData(f.SHAPE2D_CATEGORY_FILLGRADIENT)],g.prototype,"fillGradientColor2",null),__decorate([b.instanceData(f.SHAPE2D_CATEGORY_FILLGRADIENT)],g.prototype,"fillGradientTY",null),__decorate([b.instanceData(f.SHAPE2D_CATEGORY_BORDER)],g.prototype,"borderThickness",null),__decorate([b.instanceData(f.SHAPE2D_CATEGORY_BORDERSOLID)],g.prototype,"borderSolidColor",
null),__decorate([b.instanceData(f.SHAPE2D_CATEGORY_BORDERGRADIENT)],g.prototype,"borderGradientColor1",null),__decorate([b.instanceData(f.SHAPE2D_CATEGORY_BORDERGRADIENT)],g.prototype,"borderGradientColor2",null),__decorate([b.instanceData(f.SHAPE2D_CATEGORY_BORDERGRADIENT)],g.prototype,"borderGradientTY",null),g);b.Shape2DInstanceData=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.Prim2DBase,c=function(d){null==d&&(d={});null==d.origin&&(d.origin=new b.Vector2(0,0));e.call(this,d);var f=d.size||d.width||d.height?d.size||new b.Size(d.width||0,d.height||0):null;(this._trackedNode=null==d.trackNode?null:d.trackNode)&&this.owner&&this.owner._registerTrackedNode(this);this._cacheBehavior=null==d.cacheBehavior?c.GROUPCACHEBEHAVIOR_FOLLOWCACHESTRATEGY:d.cacheBehavior;this.size=f;this._viewportPosition=b.Vector2.Zero()};f=(__extends(c,e),c._createCachedCanvasGroup=
function(d){return new c({parent:d,id:"__cachedCanvasGroup__",position:b.Vector2.Zero(),origin:b.Vector2.Zero(),size:null,isVisible:!0})},c.prototype.applyCachedTexture=function(c,d){if(this._bindCacheTarget(),c)for(var e=c.uvs,f=this._renderableData._cacheNode.UVs,g=0;4>g;g++)e[2*g+0]=f[g].x,e[2*g+1]=f[g].y;d&&(d.diffuseTexture=this._renderableData._cacheTexture,d.emissiveColor=new b.Color3(1,1,1));this._renderableData._cacheTexture.hasAlpha=!0;this._unbindCacheTarget()},Object.defineProperty(c.prototype,
"cachedRect",{get:function(){return this._renderableData?this._renderableData._cacheNode:null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"cacheTexture",{get:function(){return this._renderableData?this._renderableData._cacheTexture:null},enumerable:!0,configurable:!0}),c.prototype.dispose=function(){return e.prototype.dispose.call(this)?(null!=this._trackedNode&&(this.owner._unregisterTrackedNode(this),this._trackedNode=null),this._renderableData&&(this._renderableData.dispose(),
this._renderableData=null),!0):!1},Object.defineProperty(c.prototype,"isRenderableGroup",{get:function(){return this._isRenderableGroup},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isCachedGroup",{get:function(){return this._isCachedGroup},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"size",{get:function(){return this._size},set:function(b){this._size=b},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"viewportSize",{get:function(){return this._viewportSize},
enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"actualSize",{get:function(){var d;this._size?d=new b.Size(Math.ceil(this._size.width),Math.ceil(this._size.height)):(d=this.boundingInfo.max(),d=new b.Size(Math.ceil(d.x),Math.ceil(d.y)));return d.equals(this._actualSize)||(this.onPrimitivePropertyDirty(c.actualSizeProperty.flagId),this._actualSize=d,this.handleGroupChanged(c.actualSizeProperty)),d},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"cacheBehavior",
{get:function(){return this._cacheBehavior},enumerable:!0,configurable:!0}),c.prototype._addPrimToDirtyList=function(b){this._renderableData._primDirtyList.push(b)},c.prototype._renderCachedCanvas=function(){this.updateCachedStates(!0);var c=new b.PrepareRender2DContext;this._prepareGroupRender(c);this._groupRender()},Object.defineProperty(c.prototype,"trackedNode",{get:function(){return this._trackedNode},set:function(c){null!=c?(this._isFlagSet(b.SmartPropertyPrim.flagTrackedGroup)||this.owner._registerTrackedNode(this),
this._trackedNode=c):(this._isFlagSet(b.SmartPropertyPrim.flagTrackedGroup)&&this.owner._unregisterTrackedNode(this),this._trackedNode=null)},enumerable:!0,configurable:!0}),c.prototype.levelIntersect=function(){return!0},c.prototype.updateLevelBoundingInfo=function(){var c;c=this.size?this.size:new b.Size(0,0);b.BoundingInfo2D.CreateFromSizeToRef(c,this._levelBoundingInfo)},c.prototype._prepareGroupRender=function(c){var d=null;if((0<this._renderableData._primDirtyList.length||c.forceRefreshPrimitive)&&
(d=this._renderableData._primDirtyList.sort(function(b,c){return b.hierarchyDepth-c.hierarchyDepth}),this.updateCachedStatesOf(d,!0)),this._isCachedGroup){var e=this.actualSize.clone();e.equals(this._viewportSize)||(c.forceRefreshPrimitive=!0);this._viewportSize=e}else{var f=this._globalTransform.getTranslation(),e=this.actualSize.clone(),g=this.owner._renderingSize;e.height=Math.min(e.height,g.height-f.y);e.width=Math.min(e.width,g.width-f.x);g=f.y;this._viewportPosition.x=f.x;this._viewportPosition.y=
g;f=e.width;e=e.height;this._viewportSize?(this._viewportSize.width===f&&this._viewportSize.height===e||(c.forceRefreshPrimitive=!0),this._viewportSize.width=f,this._viewportSize.height=e):this._viewportSize=new b.Size(f,e)}if(0<this._renderableData._primDirtyList.length||c.forceRefreshPrimitive)if(this._cacheGroupDirty=this._isCachedGroup,c.forceRefreshPrimitive){d=0;for(e=this._children;d<e.length;d++)e[d]._prepareRender(c)}else d||(d=this._renderableData._primDirtyList.sort(function(b,c){return b.hierarchyDepth-
c.hierarchyDepth})),d.forEach(function(b){!b.isDisposed&&b._needPrepare()&&b._prepareRender(c)}),this._renderableData._primDirtyList.forEach(function(b){return b._resetPropertiesDirty()}),this._renderableData._primDirtyList.splice(0);this._renderableData._childrenRenderableGroups.forEach(function(b){b._prepareGroupRender(c)})},c.prototype._groupRender=function(){for(var c=this,d=this.owner.engine,e=0,f=0,g=this._renderableData._childrenRenderableGroups;f<g.length;f++)g[f]._groupRender();if(!this.isCachedGroup||
this._cacheGroupDirty){if(this.isCachedGroup)this._bindCacheTarget();else var p=d.setDirectViewport(this._viewportPosition.x,this._viewportPosition.y,this._viewportSize.width,this._viewportSize.height);f=!0===d.getAlphaTesting();g=!0===d.getDepthWrite();d.setAlphaTesting(!1);d.setDepthWrite(!0);var r=new b.Render2DContext(b.Render2DContext.RenderModeOpaque);this._renderableData._renderGroupInstancesInfo.forEach(function(b,f){var g=c._prepareContext(d,r,f);if(null!==g&&(!c.owner.supportInstancedArray||
0<g))g=!f.modelRenderCache.render(f,r),f.opaqueDirty=g,e+=g?1:0});d.setAlphaTesting(!0);d.setDepthWrite(!0);r=new b.Render2DContext(b.Render2DContext.RenderModeAlphaTest);this._renderableData._renderGroupInstancesInfo.forEach(function(b,f){var g=c._prepareContext(d,r,f);if(null!==g&&(!c.owner.supportInstancedArray||0<g))g=!f.modelRenderCache.render(f,r),f.opaqueDirty=g,e+=g?1:0});d.setAlphaTesting(!0);d.setDepthWrite(!1);this._renderableData._transparentListChanged&&this._updateTransparentData();
e+=this._renderTransparentData();this._cacheGroupDirty=0!==e;this.isCachedGroup?this._unbindCacheTarget():p&&d.setViewport(p);d.setAlphaTesting(f);d.setDepthWrite(g)}},c.prototype._updateTransparentData=function(){var c=this._renderableData;if(null!==c._firstChangedPrim){c._transparentPrimitives.sort(function(b,c){return c._primitive.actualZOffset-b._primitive.actualZOffset});c._transparentSegments.splice(0);for(var d=null,e=0;e<c._transparentPrimitives.length;e++){var f=c._transparentPrimitives[e];
f._groupInstanceInfo.transparentOrderDirty&&f._groupInstanceInfo.sortTransparentData();f._transparentSegment=null;if(d){var g=c._transparentPrimitives[e];if(d.groupInsanceInfo===g._groupInstanceInfo){var p=g._primitive.actualZOffset;g._transparentSegment=d;p<d.endZ&&(d.endZ=p,d.endDataIndex=g._primitive._getLastIndexInDataBuffer()+1)}}f._transparentSegment||(d=new b.TransparentSegment,d.groupInsanceInfo=f._groupInstanceInfo,g=f._primitive,d.startZ=g.actualZOffset,d.startDataIndex=g._getFirstIndexInDataBuffer(),
d.endDataIndex=g._getLastIndexInDataBuffer()+1,d.endZ=d.startZ,f._transparentSegment=d,c._transparentSegments.push(d));d=f._transparentSegment}c._firstChangedPrim=null;c._transparentListChanged=!1}},c.prototype._renderTransparentData=function(){for(var c=0,d=new b.Render2DContext(b.Render2DContext.RenderModeTransparent),e=this._renderableData,f=e._transparentSegments.length,g=0;f>g;g++){var p=e._transparentSegments[g],r=p.groupInsanceInfo,t=r.modelRenderCache;d.useInstancing=!1;d.partDataStartIndex=
p.startDataIndex;d.partDataEndIndex=p.endDataIndex;d.groupInfoPartData=r.transparentData;p=!t.render(r,d);c+=p?1:0}return c},c.prototype._prepareContext=function(c,d,e){var f,g,p=null;switch(d.renderMode){case b.Render2DContext.RenderModeOpaque:if(!e.hasOpaqueData)return null;f=function(b){e.opaqueDirty=b};g=function(){return e.opaqueDirty};p=d.groupInfoPartData=e.opaqueData;break;case b.Render2DContext.RenderModeAlphaTest:if(!e.hasAlphaTestData)return null;f=function(b){e.alphaTestDirty=b};g=function(){return e.alphaTestDirty};
p=d.groupInfoPartData=e.alphaTestData;break;default:throw Error("_prepareContext is only for opaque or alphaTest");}var r=0;if(this.owner.supportInstancedArray){d.useInstancing=!0;for(var t=0;t<p.length;t++){d=p[t];var s=d._partData,u=s.pack(),r=r+s.usedElementCount,s=4*s.usedElementCount*s.stride;!d._partBuffer||d._partBufferSize<s?(d._partBuffer&&c.deleteInstancesBuffer(d._partBuffer),d._partBuffer=c.createInstancesBuffer(s),d._partBufferSize=s,f(!1),c.updateArrayBuffer(u)):g()&&(c.bindArrayBuffer(d._partBuffer),
c.updateArrayBuffer(u))}f(!1)}else{for(t=d.partDataStartIndex=0;!d.groupInfoPartData[t];)t++;d.partDataEndIndex=d.groupInfoPartData[t]._partData.usedElementCount}return r},c.prototype._bindCacheTarget=function(){var c,d,e=this._renderableData;if(e._cacheNode){var f=e._cacheNode.contentSize,g=Math.ceil(this.actualSize.width),p=Math.ceil(this.actualSize.height);(f.width<g||f.height<p)&&(c=Math.floor(1.07*f.width),d=Math.floor(1.07*f.height),e._cacheTexture.freeRect(e._cacheNode),e._cacheNode=null)}e._cacheNode||
(c=this.owner._allocateGroupCache(this,this.renderGroup,c?new b.Size(c,d):null),e._cacheNode=c.node,e._cacheTexture=c.texture,e._cacheRenderSprite=c.sprite);e._cacheTexture.bindTextureForPosSize(e._cacheNode.pos,this.actualSize,!0)},c.prototype._unbindCacheTarget=function(){this._renderableData._cacheTexture&&this._renderableData._cacheTexture.unbindTexture()},c.prototype.handleGroupChanged=function(d){var e=this._renderableData;this.isCachedGroup&&e._cacheRenderSprite&&(d.id===b.Prim2DBase.actualPositionProperty.id?
e._cacheRenderSprite.actualPosition=this.actualPosition.clone():d.id===b.Prim2DBase.rotationProperty.id?e._cacheRenderSprite.rotation=this.rotation:d.id===b.Prim2DBase.scaleProperty.id?e._cacheRenderSprite.scale=this.scale:d.id===b.Prim2DBase.originProperty.id?e._cacheRenderSprite.origin=this.origin.clone():d.id===c.actualSizeProperty.id&&(e._cacheRenderSprite.size=this.actualSize.clone()))},c.prototype.detectGroupStates=function(){var e=this instanceof b.Canvas2D,f=this.owner.cachingStrategy;f===
b.Canvas2D.CACHESTRATEGY_DONTCACHE?(this._isRenderableGroup=e,this._isCachedGroup=!1):f===b.Canvas2D.CACHESTRATEGY_CANVAS?e?(this._isRenderableGroup=!0,this._isCachedGroup=!0):(this._isRenderableGroup="__cachedCanvasGroup__"===this.id,this._isCachedGroup=!1):f===b.Canvas2D.CACHESTRATEGY_TOPLEVELGROUPS?e?(this._isRenderableGroup=!0,this._isCachedGroup=!1):1===this.hierarchyDepth?(this._isRenderableGroup=!0,this._isCachedGroup=!0):(this._isRenderableGroup=!1,this._isCachedGroup=!1):f===b.Canvas2D.CACHESTRATEGY_ALLGROUPS&&
(e=this.cacheBehavior,e!==c.GROUPCACHEBEHAVIOR_DONTCACHEOVERRIDE&&e!==c.GROUPCACHEBEHAVIOR_CACHEINPARENTGROUP||(this._isRenderableGroup=e===c.GROUPCACHEBEHAVIOR_DONTCACHEOVERRIDE,this._isCachedGroup=!1),e===c.GROUPCACHEBEHAVIOR_FOLLOWCACHESTRATEGY&&(this._isRenderableGroup=!0,this._isCachedGroup=!0));if(this._isRenderableGroup&&(this._renderableData||(this._renderableData=new d)),this._isCachedGroup)for(e=this.parent;e;){if(e instanceof c&&e._isRenderableGroup){-1===e._renderableData._childrenRenderableGroups.indexOf(this)&&
e._renderableData._childrenRenderableGroups.push(this);break}e=e.parent}},c.GROUP2D_PROPCOUNT=b.Prim2DBase.PRIM2DBASE_PROPCOUNT+5,c.GROUPCACHEBEHAVIOR_FOLLOWCACHESTRATEGY=0,c.GROUPCACHEBEHAVIOR_DONTCACHEOVERRIDE=1,c.GROUPCACHEBEHAVIOR_CACHEINPARENTGROUP=2,__decorate([b.instanceLevelProperty(b.Prim2DBase.PRIM2DBASE_PROPCOUNT+1,function(b){return c.sizeProperty=b},!1,!0)],c.prototype,"size",null),__decorate([b.instanceLevelProperty(b.Prim2DBase.PRIM2DBASE_PROPCOUNT+2,function(b){return c.actualSizeProperty=
b})],c.prototype,"actualSize",null),c=__decorate([b.className("Group2D")],c));b.Group2D=f;var d;f=function(){this._primDirtyList=[];this._childrenRenderableGroups=[];this._renderGroupInstancesInfo=new b.StringDictionary;this._transparentPrimitives=[];this._transparentSegments=[];this._firstChangedPrim=null;this._transparentListChanged=!1;this._cacheRenderSprite=this._cacheTexture=this._cacheNode=null};d=(f.prototype.dispose=function(){this._cacheRenderSprite&&(this._cacheRenderSprite.dispose(),this._cacheRenderSprite=
null);this._cacheTexture&&this._cacheNode&&(this._cacheTexture.freeRect(this._cacheNode),this._cacheTexture=null,this._cacheNode=null);this._primDirtyList&&(this._primDirtyList.splice(0),this._primDirtyList=null);this._renderGroupInstancesInfo&&(this._renderGroupInstancesInfo.forEach(function(b,c){c.dispose()}),this._renderGroupInstancesInfo=null)},f.prototype.addNewTransparentPrimitiveInfo=function(b,c){var d=new g;return d._primitive=b,d._groupInstanceInfo=c,d._transparentSegment=null,this._transparentPrimitives.push(d),
this._transparentListChanged=!0,this.updateSmallestZChangedPrim(d),d},f.prototype.removeTransparentPrimitiveInfo=function(b){var c=this._transparentPrimitives.indexOf(b);-1!==c&&(this._transparentPrimitives.splice(c,1),this._transparentListChanged=!0,this.updateSmallestZChangedPrim(b))},f.prototype.transparentPrimitiveZChanged=function(b){this._transparentListChanged=!0;this.updateSmallestZChangedPrim(b)},f.prototype.updateSmallestZChangedPrim=function(b){b._primitive&&b._primitive.actualZOffset>
(this._firstChangedPrim?this._firstChangedPrim._primitive.actualZOffset:Number.MIN_VALUE)&&(this._firstChangedPrim=b)},f);b.RenderableGroupData=d;var g;g=function(){};b.TransparentPrimitiveInfo=g}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.ModelRenderCache,c=function(b,c){e.call(this,b,c);this.effectsReady=!1;this.fillIB=this.fillVB=null;this.fillIndicesCount=0;this.borderIB=this.borderVB=this.effectFillInstanced=this.effectFill=this.instancingFillAttributes=null;this.borderIndicesCount=0;this.effectBorderInstanced=this.effectBorder=this.instancingBorderAttributes=null};f=(__extends(c,e),c.prototype.render=function(c,d){if(!this.effectsReady){if(this.effectFill&&(!this.effectFill.isReady()||this.effectFillInstanced&&
!this.effectFillInstanced.isReady())||this.effectBorder&&(!this.effectBorder.isReady()||this.effectBorderInstanced&&!this.effectBorderInstanced.isReady()))return!1;this.effectsReady=!0}var e=c.owner.owner.engine,f=0;this.effectFill&&this.effectBorder&&(f=e.getDepthFunction(),e.setDepthFunctionToLessOrEqual());var g=e.getAlphaMode();if(this.effectFill){var j=c.partIndexFromId.get(b.Shape2D.SHAPE2D_FILLPARTID.toString()),m=d.groupInfoPartData[j];d.renderMode!==b.Render2DContext.RenderModeOpaque&&e.setAlphaMode(b.Engine.ALPHA_COMBINE);
var u=d.useInstancing?this.effectFillInstanced:this.effectFill;if(e.enableEffect(u),e.bindBuffersDirectly(this.fillVB,this.fillIB,[1],4,u),d.useInstancing)this.instancingFillAttributes||(this.instancingFillAttributes=this.loadInstancingAttributes(b.Shape2D.SHAPE2D_FILLPARTID,u)),e.updateAndBindInstancesBuffer(m._partBuffer,null,this.instancingFillAttributes),e.draw(!0,0,this.fillIndicesCount,m._partData.usedElementCount),e.unbindInstanceAttributes();else for(var x=d.partDataStartIndex;x<d.partDataEndIndex;x++)this.setupUniforms(u,
j,m._partData,x),e.draw(!0,0,this.fillIndicesCount)}if(this.effectBorder)if(j=c.partIndexFromId.get(b.Shape2D.SHAPE2D_BORDERPARTID.toString()),m=d.groupInfoPartData[j],d.renderMode!==b.Render2DContext.RenderModeOpaque&&e.setAlphaMode(b.Engine.ALPHA_COMBINE),u=d.useInstancing?this.effectBorderInstanced:this.effectBorder,e.enableEffect(u),e.bindBuffersDirectly(this.borderVB,this.borderIB,[1],4,u),d.useInstancing)this.instancingBorderAttributes||(this.instancingBorderAttributes=this.loadInstancingAttributes(b.Shape2D.SHAPE2D_BORDERPARTID,
u)),e.updateAndBindInstancesBuffer(m._partBuffer,null,this.instancingBorderAttributes),e.draw(!0,0,this.borderIndicesCount,m._partData.usedElementCount),e.unbindInstanceAttributes();else for(x=d.partDataStartIndex;x<d.partDataEndIndex;x++)this.setupUniforms(u,j,m._partData,x),e.draw(!0,0,this.borderIndicesCount);return e.setAlphaMode(g),this.effectFill&&this.effectBorder&&e.setDepthFunction(f),!0},c.prototype.dispose=function(){return e.prototype.dispose.call(this)?(this.fillVB&&(this._engine._releaseBuffer(this.fillVB),
this.fillVB=null),this.fillIB&&(this._engine._releaseBuffer(this.fillIB),this.fillIB=null),this.effectFill&&(this._engine._releaseEffect(this.effectFill),this.effectFill=null),this.effectFillInstanced&&(this._engine._releaseEffect(this.effectFillInstanced),this.effectFillInstanced=null),this.borderVB&&(this._engine._releaseBuffer(this.borderVB),this.borderVB=null),this.borderIB&&(this._engine._releaseBuffer(this.borderIB),this.borderIB=null),this.effectBorder&&(this._engine._releaseEffect(this.effectBorder),
this.effectBorder=null),this.effectBorderInstanced&&(this._engine._releaseEffect(this.effectBorderInstanced),this.effectBorderInstanced=null),!0):!1},c);b.Rectangle2DRenderCache=f;var d,g=b.Shape2DInstanceData,c=function(b){g.call(this,b,1)};d=(__extends(c,g),Object.defineProperty(c.prototype,"properties",{get:function(){return null},enumerable:!0,configurable:!0}),__decorate([b.instanceData()],c.prototype,"properties",null),c);b.Rectangle2DInstanceData=d;var m=b.Shape2D,j=function(c){if(null==c&&
(c={}),m.call(this,c),null!=c.size)this.size=c.size;else if(c.width||c.height)this.size=new b.Size(c.width,c.height);var d=null==c.borderThickness?1:c.borderThickness;this.roundRadius=null==c.roundRadius?0:c.roundRadius;this.borderThickness=d},c=(__extends(j,m),Object.defineProperty(j.prototype,"actualSize",{get:function(){return this._actualSize?this._actualSize:this.size},set:function(b){this._actualSize=b},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"notRounded",{get:function(){return this._notRounded},
set:function(b){this._notRounded=b},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"roundRadius",{get:function(){return this._roundRadius},set:function(b){this._roundRadius=b;this.notRounded=0===b;this._positioningDirty()},enumerable:!0,configurable:!0}),j.prototype.levelIntersect=function(b){if(this.notRounded)return!0;var c=this.size;j._i0.x=b._localPickPosition.x;j._i0.y=b._localPickPosition.y;b=this.roundRadius;var d=b*b;return j._i1.x=b,j._i1.y=b,j._i0.x<=j._i1.x&&j._i0.y<=
j._i1.y?(j._i2.x=j._i0.x-j._i1.x,j._i2.y=j._i0.y-j._i1.y,j._i2.lengthSquared()<=d):(j._i1.x=b,j._i1.y=c.height-b,j._i0.x<=j._i1.x&&j._i0.y>=j._i1.y?(j._i2.x=j._i0.x-j._i1.x,j._i2.y=j._i0.y-j._i1.y,j._i2.lengthSquared()<=d):(j._i1.x=c.width-b,j._i1.y=c.height-b,j._i0.x>=j._i1.x&&j._i0.y>=j._i1.y?(j._i2.x=j._i0.x-j._i1.x,j._i2.y=j._i0.y-j._i1.y,j._i2.lengthSquared()<=d):(j._i1.x=c.width-b,j._i1.y=b,j._i0.x>=j._i1.x&&j._i0.y<=j._i1.y?(j._i2.x=j._i0.x-j._i1.x,j._i2.y=j._i0.y-j._i1.y,j._i2.lengthSquared()<=
d):!0)))},j.prototype.updateLevelBoundingInfo=function(){b.BoundingInfo2D.CreateFromSizeToRef(this.actualSize,this._levelBoundingInfo)},j.prototype.createModelRenderCache=function(b){return new f(this.owner.engine,b)},j.prototype.setupModelRenderCache=function(c){var d=this.owner.engine;if(this.fill){for(var e=4*(this.notRounded?1:j.roundSubdivisions)+1,f=new Float32Array(e),g=0;e>g;g++)f[g]=g;c.fillVB=d.createVertexBuffer(f);e-=1;f=new Float32Array(3*e);for(g=0;e>g;g++)f[3*g+0]=0,f[3*g+2]=g+1,f[3*
g+1]=g+2;f[3*e-2]=1;c.fillIB=d.createIndexBuffer(f);c.fillIndicesCount=3*e;(g=this.getDataPartEffectInfo(b.Shape2D.SHAPE2D_FILLPARTID,["index"],!0))&&(c.effectFillInstanced=d.createEffect("rect2d",g.attributes,g.uniforms,[],g.defines,null));g=this.getDataPartEffectInfo(b.Shape2D.SHAPE2D_FILLPARTID,["index"],!1);c.effectFill=d.createEffect("rect2d",g.attributes,g.uniforms,[],g.defines,null)}if(this.border){e=8*(this.notRounded?1:j.roundSubdivisions);f=new Float32Array(e);for(g=0;e>g;g++)f[g]=g;c.borderVB=
d.createVertexBuffer(f);for(var m=e/2,f=new Float32Array(3*e),g=0;m>g;g++){var s=g,u=(g+1)%m;f[6*g+0]=m+u;f[6*g+1]=m+s;f[6*g+2]=s;f[6*g+3]=u;f[6*g+4]=m+u;f[6*g+5]=s}c.borderIB=d.createIndexBuffer(f);c.borderIndicesCount=3*e;(g=this.getDataPartEffectInfo(b.Shape2D.SHAPE2D_BORDERPARTID,["index"],!0))&&(c.effectBorderInstanced=d.createEffect("rect2d",g.attributes,g.uniforms,[],g.defines,null));g=this.getDataPartEffectInfo(b.Shape2D.SHAPE2D_BORDERPARTID,["index"],!1);c.effectBorder=d.createEffect("rect2d",
g.attributes,g.uniforms,[],g.defines,null)}return c},j.prototype._getInitialContentAreaToRef=function(b,c,d){if(this._notRounded)m.prototype._getInitialContentAreaToRef.call(this,b,c,d);else{var e=Math.round(1.3*(this.roundRadius-this.roundRadius/Math.sqrt(2)));c.x=c.y=e;d.width=Math.max(0,b.width-2*e);d.height=Math.max(0,b.height-2*e)}},j.prototype.createInstanceDataParts=function(){var c=[];return this.border&&c.push(new d(b.Shape2D.SHAPE2D_BORDERPARTID)),this.fill&&c.push(new d(b.Shape2D.SHAPE2D_FILLPARTID)),
c},j.prototype.refreshInstanceDataPart=function(c){if(!m.prototype.refreshInstanceDataPart.call(this,c))return!1;if(c.id===b.Shape2D.SHAPE2D_BORDERPARTID){var d=this.actualSize;c.properties=new b.Vector3(d.width,d.height,this.roundRadius||0)}else c.id===b.Shape2D.SHAPE2D_FILLPARTID&&(d=this.actualSize,c.properties=new b.Vector3(d.width,d.height,this.roundRadius||0));return!0},j._i0=b.Vector2.Zero(),j._i1=b.Vector2.Zero(),j._i2=b.Vector2.Zero(),j.roundSubdivisions=16,__decorate([b.instanceLevelProperty(b.Shape2D.SHAPE2D_PROPCOUNT+
1,function(b){return j.actualSizeProperty=b},!1,!0)],j.prototype,"actualSize",null),__decorate([b.modelLevelProperty(b.Shape2D.SHAPE2D_PROPCOUNT+2,function(b){return j.notRoundedProperty=b})],j.prototype,"notRounded",null),__decorate([b.instanceLevelProperty(b.Shape2D.SHAPE2D_PROPCOUNT+3,function(b){return j.roundRadiusProperty=b})],j.prototype,"roundRadius",null),j=__decorate([b.className("Rectangle2D")],j));b.Rectangle2D=c}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.ModelRenderCache,c=function(b,c){e.call(this,b,c);this.effectsReady=!1;this.fillIB=this.fillVB=null;this.fillIndicesCount=0;this.borderIB=this.borderVB=this.effectFill=this.effectFillInstanced=this.instancingFillAttributes=null;this.borderIndicesCount=0;this.effectBorder=this.effectBorderInstanced=this.instancingBorderAttributes=null};f=(__extends(c,e),c.prototype.render=function(c,d){if(!this.effectsReady){if(this.effectFill&&(!this.effectFill.isReady()||this.effectFillInstanced&&
!this.effectFillInstanced.isReady())||this.effectBorder&&(!this.effectBorder.isReady()||this.effectBorderInstanced&&!this.effectBorderInstanced.isReady()))return!1;this.effectsReady=!0}var e=c.owner.owner.engine,f=0;this.effectFill&&this.effectBorder&&(f=e.getDepthFunction(),e.setDepthFunctionToLessOrEqual());var g=e.getAlphaMode();if(this.effectFill){var j=c.partIndexFromId.get(b.Shape2D.SHAPE2D_FILLPARTID.toString()),m=d.groupInfoPartData[j];d.renderMode!==b.Render2DContext.RenderModeOpaque&&e.setAlphaMode(b.Engine.ALPHA_COMBINE);
var u=d.useInstancing?this.effectFillInstanced:this.effectFill;if(e.enableEffect(u),e.bindBuffersDirectly(this.fillVB,this.fillIB,[1],4,u),d.useInstancing)this.instancingFillAttributes||(this.instancingFillAttributes=this.loadInstancingAttributes(b.Shape2D.SHAPE2D_FILLPARTID,u)),e.updateAndBindInstancesBuffer(m._partBuffer,null,this.instancingFillAttributes),e.draw(!0,0,this.fillIndicesCount,m._partData.usedElementCount),e.unbindInstanceAttributes();else for(var x=d.partDataStartIndex;x<d.partDataEndIndex;x++)this.setupUniforms(u,
j,m._partData,x),e.draw(!0,0,this.fillIndicesCount)}if(this.effectBorder)if(j=c.partIndexFromId.get(b.Shape2D.SHAPE2D_BORDERPARTID.toString()),m=d.groupInfoPartData[j],d.renderMode!==b.Render2DContext.RenderModeOpaque&&e.setAlphaMode(b.Engine.ALPHA_COMBINE),u=d.useInstancing?this.effectBorderInstanced:this.effectBorder,e.enableEffect(u),e.bindBuffersDirectly(this.borderVB,this.borderIB,[1],4,u),d.useInstancing)this.instancingBorderAttributes||(this.instancingBorderAttributes=this.loadInstancingAttributes(b.Shape2D.SHAPE2D_BORDERPARTID,
u)),e.updateAndBindInstancesBuffer(m._partBuffer,null,this.instancingBorderAttributes),e.draw(!0,0,this.borderIndicesCount,m._partData.usedElementCount),e.unbindInstanceAttributes();else for(x=d.partDataStartIndex;x<d.partDataEndIndex;x++)this.setupUniforms(u,j,m._partData,x),e.draw(!0,0,this.borderIndicesCount);return e.setAlphaMode(g),this.effectFill&&this.effectBorder&&e.setDepthFunction(f),!0},c.prototype.dispose=function(){return e.prototype.dispose.call(this)?(this.fillVB&&(this._engine._releaseBuffer(this.fillVB),
this.fillVB=null),this.fillIB&&(this._engine._releaseBuffer(this.fillIB),this.fillIB=null),this.effectFill&&(this._engine._releaseEffect(this.effectFill),this.effectFill=null),this.effectFillInstanced&&(this._engine._releaseEffect(this.effectFillInstanced),this.effectFillInstanced=null),this.borderVB&&(this._engine._releaseBuffer(this.borderVB),this.borderVB=null),this.borderIB&&(this._engine._releaseBuffer(this.borderIB),this.borderIB=null),this.effectBorder&&(this._engine._releaseEffect(this.effectBorder),
this.effectBorder=null),this.effectBorderInstanced&&(this._engine._releaseEffect(this.effectBorderInstanced),this.effectBorderInstanced=null),!0):!1},c);b.Ellipse2DRenderCache=f;var d,g=b.Shape2DInstanceData,c=function(b){g.call(this,b,1)};d=(__extends(c,g),Object.defineProperty(c.prototype,"properties",{get:function(){return null},enumerable:!0,configurable:!0}),__decorate([b.instanceData()],c.prototype,"properties",null),c);b.Ellipse2DInstanceData=d;var m=b.Shape2D,j=function(c){if(null==c&&(c=
{}),m.call(this,c),null!=c.size)this.size=c.size;else if(c.width||c.height)this.size=new b.Size(c.width,c.height);this.subdivisions=null==c.subdivisions?64:c.subdivisions},c=(__extends(j,m),Object.defineProperty(j.prototype,"actualSize",{get:function(){return this._actualSize?this._actualSize:this.size},set:function(b){this._actualSize=b},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"subdivisions",{get:function(){return this._subdivisions},set:function(b){this._subdivisions=b},
enumerable:!0,configurable:!0}),j.prototype.levelIntersect=function(b){var c=this.size.width/2,d=this.size.height/2,e=b._localPickPosition.x-c;b=b._localPickPosition.y-d;return 1>=e*e/(c*c)+b*b/(d*d)},j.prototype.updateLevelBoundingInfo=function(){b.BoundingInfo2D.CreateFromSizeToRef(this.actualSize,this._levelBoundingInfo)},j.prototype.createModelRenderCache=function(b){return new f(this.owner.engine,b)},j.prototype.setupModelRenderCache=function(c){var d=this.owner.engine;if(this.fill){for(var e=
this.subdivisions+1,f=new Float32Array(e),g=0;e>g;g++)f[g]=g;c.fillVB=d.createVertexBuffer(f);e-=1;f=new Float32Array(3*e);for(g=0;e>g;g++)f[3*g+0]=0,f[3*g+2]=g+1,f[3*g+1]=g+2;f[3*e-2]=1;c.fillIB=d.createIndexBuffer(f);c.fillIndicesCount=3*e;(g=this.getDataPartEffectInfo(b.Shape2D.SHAPE2D_FILLPARTID,["index"],!0))&&(c.effectFillInstanced=d.createEffect({vertex:"ellipse2d",fragment:"ellipse2d"},g.attributes,g.uniforms,[],g.defines,null));g=this.getDataPartEffectInfo(b.Shape2D.SHAPE2D_FILLPARTID,["index"],
!1);c.effectFill=d.createEffect({vertex:"ellipse2d",fragment:"ellipse2d"},g.attributes,g.uniforms,[],g.defines,null)}if(this.border){e=2*this.subdivisions;f=new Float32Array(e);for(g=0;e>g;g++)f[g]=g;c.borderVB=d.createVertexBuffer(f);for(var j=e/2,f=new Float32Array(3*e),g=0;j>g;g++){var m=g,u=(g+1)%j;f[6*g+0]=j+u;f[6*g+1]=j+m;f[6*g+2]=m;f[6*g+3]=u;f[6*g+4]=j+u;f[6*g+5]=m}c.borderIB=d.createIndexBuffer(f);c.borderIndicesCount=3*e;(g=this.getDataPartEffectInfo(b.Shape2D.SHAPE2D_BORDERPARTID,["index"],
!0))&&(c.effectBorderInstanced=d.createEffect("ellipse2d",g.attributes,g.uniforms,[],g.defines,null));g=this.getDataPartEffectInfo(b.Shape2D.SHAPE2D_BORDERPARTID,["index"],!1);c.effectBorder=d.createEffect("ellipse2d",g.attributes,g.uniforms,[],g.defines,null)}return c},j.prototype.createInstanceDataParts=function(){var c=[];return this.border&&c.push(new d(b.Shape2D.SHAPE2D_BORDERPARTID)),this.fill&&c.push(new d(b.Shape2D.SHAPE2D_FILLPARTID)),c},j.prototype.refreshInstanceDataPart=function(c){if(!m.prototype.refreshInstanceDataPart.call(this,
c))return!1;if(c.id===b.Shape2D.SHAPE2D_BORDERPARTID){var d=this.actualSize;c.properties=new b.Vector3(d.width,d.height,this.subdivisions)}else c.id===b.Shape2D.SHAPE2D_FILLPARTID&&(d=this.actualSize,c.properties=new b.Vector3(d.width,d.height,this.subdivisions));return!0},__decorate([b.instanceLevelProperty(b.Shape2D.SHAPE2D_PROPCOUNT+1,function(b){return j.acutalSizeProperty=b},!1,!0)],j.prototype,"actualSize",null),__decorate([b.modelLevelProperty(b.Shape2D.SHAPE2D_PROPCOUNT+2,function(b){return j.subdivisionsProperty=
b})],j.prototype,"subdivisions",null),j=__decorate([b.className("Ellipse2D")],j));b.Ellipse2D=c}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.ModelRenderCache,c=function(){e.apply(this,arguments);this.effectsReady=!1;this.effectInstanced=this.effect=this.texture=this.instancingAttributes=this.ib=this.vb=null};f=(__extends(c,e),c.prototype.render=function(c,d){if(!this.effectsReady){if(this.effect&&(!this.effect.isReady()||this.effectInstanced&&!this.effectInstanced.isReady()))return!1;this.effectsReady=!0}var e=c.owner.owner.engine,f=d.useInstancing?this.effectInstanced:this.effect;e.enableEffect(f);f.setTexture("diffuseSampler",
this.texture);e.bindBuffersDirectly(this.vb,this.ib,[1],4,f);var g=e.getAlphaMode();d.renderMode!==b.Render2DContext.RenderModeOpaque&&e.setAlphaMode(b.Engine.ALPHA_COMBINE);var j=d.groupInfoPartData[0];if(d.useInstancing)this.instancingAttributes||(this.instancingAttributes=this.loadInstancingAttributes(m.SPRITE2D_MAINPARTID,f)),e.updateAndBindInstancesBuffer(j._partBuffer,null,this.instancingAttributes),e.draw(!0,0,6,j._partData.usedElementCount),e.unbindInstanceAttributes();else for(var l=d.partDataStartIndex;l<
d.partDataEndIndex;l++)this.setupUniforms(f,0,j._partData,l),e.draw(!0,0,6);return e.setAlphaMode(g),!0},c.prototype.dispose=function(){return e.prototype.dispose.call(this)?(this.vb&&(this._engine._releaseBuffer(this.vb),this.vb=null),this.ib&&(this._engine._releaseBuffer(this.ib),this.ib=null),this.texture&&(this.texture.dispose(),this.texture=null),this.effect&&(this._engine._releaseEffect(this.effect),this.effect=null),this.effectInstanced&&(this._engine._releaseEffect(this.effectInstanced),this.effectInstanced=
null),!0):!1},c);b.Sprite2DRenderCache=f;var d,g=b.InstanceDataBase,c=function(b){g.call(this,b,1)};d=(__extends(c,g),Object.defineProperty(c.prototype,"topLeftUV",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"sizeUV",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"textureSize",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"properties",{get:function(){return null},
enumerable:!0,configurable:!0}),__decorate([b.instanceData()],c.prototype,"topLeftUV",null),__decorate([b.instanceData()],c.prototype,"sizeUV",null),__decorate([b.instanceData()],c.prototype,"textureSize",null),__decorate([b.instanceData()],c.prototype,"properties",null),c);b.Sprite2DInstanceData=d;var m,j=b.RenderablePrim2D,l=function(c,d){if(d||(d={}),j.call(this,d),this.texture=c,this.texture.wrapU=b.Texture.CLAMP_ADDRESSMODE,this.texture.wrapV=b.Texture.CLAMP_ADDRESSMODE,this.size=d.spriteSize||
null,this.spriteLocation=d.spriteLocation||new b.Vector2(0,0),this.spriteFrame=0,this.invertY=null==d.invertY?!1:d.invertY,this.alignToPixel=null==d.alignToPixel?!0:d.alignToPixel,this._isTransparent=!0,!this.size){var e=c.getSize();this.size=new b.Size(e.width,e.height)}};m=(__extends(l,j),Object.defineProperty(l.prototype,"texture",{get:function(){return this._texture},set:function(b){this._texture=b},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"actualSize",{get:function(){return this._actualSize?
this._actualSize:this.size},set:function(b){this._actualSize=b},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"spriteLocation",{get:function(){return this._location},set:function(b){this._location=b},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"spriteFrame",{get:function(){return this._spriteFrame},set:function(b){this._spriteFrame=b},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"invertY",{get:function(){return this._invertY},set:function(b){this._invertY=
b},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"alignToPixel",{get:function(){return this._alignToPixel},set:function(b){this._alignToPixel=b},enumerable:!0,configurable:!0}),l.prototype.updateLevelBoundingInfo=function(){b.BoundingInfo2D.CreateFromSizeToRef(this.size,this._levelBoundingInfo)},l.prototype.getAnimatables=function(){var b=[];return this.texture&&this.texture.animations&&0<this.texture.animations.length&&b.push(this.texture),b},l.prototype.levelIntersect=function(){return!0},
l._createCachedCanvasSprite=function(c,d,e,f){return new l(d,{parent:c,id:"__cachedCanvasSprite__",position:b.Vector2.Zero(),origin:b.Vector2.Zero(),spriteSize:e,spriteLocation:f,alignToPixel:!0})},l.prototype.createModelRenderCache=function(b){return new f(this.owner.engine,b)},l.prototype.setupModelRenderCache=function(b){for(var c=this.owner.engine,d=new Float32Array(4),e=0;4>e;e++)d[e]=e;b.vb=c.createVertexBuffer(d);d=new Float32Array(6);d[0]=0;d[1]=2;d[2]=1;d[3]=0;d[4]=3;d[5]=2;b.ib=c.createIndexBuffer(d);
b.texture=this.texture;d=this.getDataPartEffectInfo(l.SPRITE2D_MAINPARTID,["index"],!0);return d&&(b.effectInstanced=c.createEffect("sprite2d",d.attributes,d.uniforms,["diffuseSampler"],d.defines,null)),d=this.getDataPartEffectInfo(l.SPRITE2D_MAINPARTID,["index"],!1),b.effect=c.createEffect("sprite2d",d.attributes,d.uniforms,["diffuseSampler"],d.defines,null),b},l.prototype.createInstanceDataParts=function(){return[new d(l.SPRITE2D_MAINPARTID)]},l.prototype.refreshInstanceDataPart=function(c){if(!j.prototype.refreshInstanceDataPart.call(this,
c))return!1;if(c.id===l.SPRITE2D_MAINPARTID){c=this._instanceDataParts[0];var d=this.texture.getBaseSize(),e=this.spriteLocation,f=this.actualSize;c.topLeftUV=new b.Vector2(e.x/d.width,e.y/d.height);e=new b.Vector2(f.width/d.width,f.height/d.height);c.sizeUV=e;l._prop.x=this.spriteFrame;l._prop.y=this.invertY?1:0;l._prop.z=this.alignToPixel?1:0;c.properties=l._prop;c.textureSize=new b.Vector2(d.width,d.height)}return!0},l.SPRITE2D_MAINPARTID=1,l._prop=b.Vector3.Zero(),__decorate([b.modelLevelProperty(b.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+
1,function(b){return l.textureProperty=b})],l.prototype,"texture",null),__decorate([b.instanceLevelProperty(b.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+2,function(b){return l.actualSizeProperty=b},!1,!0)],l.prototype,"actualSize",null),__decorate([b.instanceLevelProperty(b.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+3,function(b){return l.spriteLocationProperty=b})],l.prototype,"spriteLocation",null),__decorate([b.instanceLevelProperty(b.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+4,function(b){return l.spriteFrameProperty=
b})],l.prototype,"spriteFrame",null),__decorate([b.instanceLevelProperty(b.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+5,function(b){return l.invertYProperty=b})],l.prototype,"invertY",null),l=__decorate([b.className("Sprite2D")],l));b.Sprite2D=m}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.ModelRenderCache,c=function(){e.apply(this,arguments);this.effectsReady=!1;this.effectInstanced=this.effect=this.fontTexture=this.instancingAttributes=this.ib=this.vb=null};f=(__extends(c,e),c.prototype.render=function(c,d){if(!this.effectsReady){if(this.effect&&(!this.effect.isReady()||this.effectInstanced&&!this.effectInstanced.isReady()))return!1;this.effectsReady=!0}var e=c.owner.owner.engine;this.fontTexture.update();var f=d.useInstancing?this.effectInstanced:this.effect;
e.enableEffect(f);f.setTexture("diffuseSampler",this.fontTexture);e.bindBuffersDirectly(this.vb,this.ib,[1],4,f);var g=e.getAlphaMode();e.setAlphaMode(b.Engine.ALPHA_COMBINE,!0);var j=d.groupInfoPartData[0];if(d.useInstancing)this.instancingAttributes||(this.instancingAttributes=this.loadInstancingAttributes(m.TEXT2D_MAINPARTID,f)),e.updateAndBindInstancesBuffer(j._partBuffer,null,this.instancingAttributes),e.draw(!0,0,6,j._partData.usedElementCount),e.unbindInstanceAttributes();else for(var l=d.partDataStartIndex;l<
d.partDataEndIndex;l++)this.setupUniforms(f,0,j._partData,l),e.draw(!0,0,6);return e.setAlphaMode(g),!0},c.prototype.dispose=function(){return e.prototype.dispose.call(this)?(this.vb&&(this._engine._releaseBuffer(this.vb),this.vb=null),this.ib&&(this._engine._releaseBuffer(this.ib),this.ib=null),this.fontTexture&&(this.fontTexture.dispose(),this.fontTexture=null),this.effect&&(this._engine._releaseEffect(this.effect),this.effect=null),this.effectInstanced&&(this._engine._releaseEffect(this.effectInstanced),
this.effectInstanced=null),!0):!1},c);b.Text2DRenderCache=f;var d,g=b.InstanceDataBase,c=function(b,c){g.call(this,b,c)};d=(__extends(c,g),Object.defineProperty(c.prototype,"topLeftUV",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"sizeUV",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"textureSize",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"color",
{get:function(){return null},enumerable:!0,configurable:!0}),__decorate([b.instanceData()],c.prototype,"topLeftUV",null),__decorate([b.instanceData()],c.prototype,"sizeUV",null),__decorate([b.instanceData()],c.prototype,"textureSize",null),__decorate([b.instanceData()],c.prototype,"color",null),c);b.Text2DInstanceData=d;var m,j=b.RenderablePrim2D,l=function(c,d){d||(d={});j.call(this,d);this.fontName=null==d.fontName?"12pt Arial":d.fontName;this.defaultFontColor=null==d.defaultFontColor?new b.Color4(1,
1,1,1):d.defaultFontColor;this._tabulationSize=null==d.tabulationSize?4:d.tabulationSize;this._textSize=null;this.text=c;this.size=null==d.size?null:d.size;this.isAlphaTest=!0};m=(__extends(l,j),Object.defineProperty(l.prototype,"fontName",{get:function(){return this._fontName},set:function(b){if(this._fontName)throw Error("Font Name change is not supported right now.");this._fontName=b},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"defaultFontColor",{get:function(){return this._defaultFontColor},
set:function(b){this._defaultFontColor=b},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"text",{get:function(){return this._text},set:function(b){this._text=b;this._size=this._textSize=null;this._updateCharCount();this.textSize},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"size",{get:function(){return null!=this._size?this._size:this.textSize},set:function(b){this._size=b},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"actualSize",{get:function(){return this._actualSize?
this._actualSize:this.size},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"textSize",{get:function(){if(!this._textSize){if(!this.owner)return l.nullSize;var c=this.fontTexture.measureText(this._text,this._tabulationSize);c.equals(this._textSize)||(this.onPrimitivePropertyDirty(b.Prim2DBase.sizeProperty.flagId),this._positioningDirty());this._textSize=c}return this._textSize},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"fontTexture",{get:function(){return this._fontTexture?
this._fontTexture:(this._fontTexture=b.FontTexture.GetCachedFontTexture(this.owner.scene,this.fontName),this._fontTexture)},enumerable:!0,configurable:!0}),l.prototype.dispose=function(){return j.prototype.dispose.call(this)?(this._fontTexture&&(b.FontTexture.ReleaseCachedFontTexture(this.owner.scene,this.fontName),this._fontTexture=null),!0):!1},l.prototype.updateLevelBoundingInfo=function(){b.BoundingInfo2D.CreateFromSizeToRef(this.actualSize,this._levelBoundingInfo)},l.prototype.levelIntersect=
function(){return!0},l.prototype.createModelRenderCache=function(b){return new f(this.owner.engine,b)},l.prototype.setupModelRenderCache=function(b){var c=this.owner.engine;b.fontTexture=this.fontTexture;for(var d=new Float32Array(4),e=0;4>e;e++)d[e]=e;b.vb=c.createVertexBuffer(d);d=new Float32Array(6);d[0]=0;d[1]=2;d[2]=1;d[3]=0;d[4]=3;d[5]=2;b.ib=c.createIndexBuffer(d);d=this.getDataPartEffectInfo(l.TEXT2D_MAINPARTID,["index"],!0);return d&&(b.effectInstanced=c.createEffect("text2d",d.attributes,
d.uniforms,["diffuseSampler"],d.defines,null)),d=this.getDataPartEffectInfo(l.TEXT2D_MAINPARTID,["index"],!1),b.effect=c.createEffect("text2d",d.attributes,d.uniforms,["diffuseSampler"],d.defines,null),b},l.prototype.createInstanceDataParts=function(){return[new d(l.TEXT2D_MAINPARTID,this._charCount)]},l.prototype.beforeRefreshForLayoutConstruction=function(){if(!this._charCount){var b=this._text;return this.text="A",b}},l.prototype.afterRefreshForLayoutConstruction=function(b,c){void 0!==c&&(this.text=
c)},l.prototype.refreshInstanceDataPart=function(c){if(!j.prototype.refreshInstanceDataPart.call(this,c))return!1;if(c.id===l.TEXT2D_MAINPARTID){var d=this.fontTexture,e=d.getSize(),f=b.Vector2.Zero(),g=this.fontTexture.lineHeight;f.y=(this.textSize.height/g-1)*g;g=0;c.dataElementCount=this._charCount;for(var m=c.curElement=0,u=this.text;m<u.length;m++){var x=u[m];("\n"===x&&(f.x=0,f.y-=d.lineHeight),"\t"!==x)?" ">x||(this.updateInstanceDataPart(c,f),x=d.getChar(x),f.x+=x.charWidth,c.topLeftUV=x.topLeftUV,
x=x.bottomRightUV.subtract(x.topLeftUV),c.sizeUV=x,c.textureSize=new b.Vector2(e.width,e.height),c.color=this.defaultFontColor,++c.curElement):(x=g+this._tabulationSize,x-=x%this._tabulationSize,f.x+=(x-g)*d.spaceWidth,g=x)}}return!0},l.prototype._updateCharCount=function(){for(var b=0,c=0,d=this._text;c<d.length;c++){var e=d[c];"\r"===e||"\n"===e||"\t"===e||" ">e||++b}this._charCount=b},l.TEXT2D_MAINPARTID=1,__decorate([b.modelLevelProperty(b.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+1,function(b){return l.fontProperty=
b},!1,!0)],l.prototype,"fontName",null),__decorate([b.dynamicLevelProperty(b.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+2,function(b){return l.defaultFontColorProperty=b})],l.prototype,"defaultFontColor",null),__decorate([b.instanceLevelProperty(b.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+3,function(b){return l.textProperty=b},!1,!0)],l.prototype,"text",null),__decorate([b.instanceLevelProperty(b.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+4,function(b){return l.sizeProperty=b})],l.prototype,"size",
null),l=__decorate([b.className("Text2D")],l));b.Text2D=m}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.ModelRenderCache,c=function(b,c){e.call(this,b,c);this.effectsReady=!1;this.fillIB=this.fillVB=null;this.fillIndicesCount=0;this.borderIB=this.borderVB=this.effectFillInstanced=this.effectFill=this.instancingFillAttributes=null;this.borderIndicesCount=0;this.effectBorderInstanced=this.effectBorder=this.instancingBorderAttributes=null};f=(__extends(c,e),c.prototype.render=function(c,d){if(!this.effectsReady){if(this.effectFill&&(!this.effectFill.isReady()||this.effectFillInstanced&&
!this.effectFillInstanced.isReady())||this.effectBorder&&(!this.effectBorder.isReady()||this.effectBorderInstanced&&!this.effectBorderInstanced.isReady()))return!1;this.effectsReady=!0}var e=c.owner.owner.engine,f=0;this.effectFill&&this.effectBorder&&(f=e.getDepthFunction(),e.setDepthFunctionToLessOrEqual());var g=e.getAlphaMode();if(this.effectFill){var j=c.partIndexFromId.get(b.Shape2D.SHAPE2D_FILLPARTID.toString()),m=d.groupInfoPartData[j];d.renderMode!==b.Render2DContext.RenderModeOpaque&&e.setAlphaMode(b.Engine.ALPHA_COMBINE);
var u=d.useInstancing?this.effectFillInstanced:this.effectFill;if(e.enableEffect(u),e.bindBuffersDirectly(this.fillVB,this.fillIB,[2],8,u),d.useInstancing)this.instancingFillAttributes||(this.instancingFillAttributes=this.loadInstancingAttributes(b.Shape2D.SHAPE2D_FILLPARTID,u)),e.updateAndBindInstancesBuffer(m._partBuffer,null,this.instancingFillAttributes),e.draw(!0,0,this.fillIndicesCount,m._partData.usedElementCount),e.unbindInstanceAttributes();else for(var x=d.partDataStartIndex;x<d.partDataEndIndex;x++)this.setupUniforms(u,
j,m._partData,x),e.draw(!0,0,this.fillIndicesCount)}if(this.effectBorder)if(j=c.partIndexFromId.get(b.Shape2D.SHAPE2D_BORDERPARTID.toString()),m=d.groupInfoPartData[j],d.renderMode!==b.Render2DContext.RenderModeOpaque&&e.setAlphaMode(b.Engine.ALPHA_COMBINE),u=d.useInstancing?this.effectBorderInstanced:this.effectBorder,e.enableEffect(u),e.bindBuffersDirectly(this.borderVB,this.borderIB,[2],8,u),d.useInstancing)this.instancingBorderAttributes||(this.instancingBorderAttributes=this.loadInstancingAttributes(b.Shape2D.SHAPE2D_BORDERPARTID,
u)),e.updateAndBindInstancesBuffer(m._partBuffer,null,this.instancingBorderAttributes),e.draw(!0,0,this.borderIndicesCount,m._partData.usedElementCount),e.unbindInstanceAttributes();else for(x=d.partDataStartIndex;x<d.partDataEndIndex;x++)this.setupUniforms(u,j,m._partData,x),e.draw(!0,0,this.borderIndicesCount);return e.setAlphaMode(g),this.effectFill&&this.effectBorder&&e.setDepthFunction(f),!0},c.prototype.dispose=function(){return e.prototype.dispose.call(this)?(this.fillVB&&(this._engine._releaseBuffer(this.fillVB),
this.fillVB=null),this.fillIB&&(this._engine._releaseBuffer(this.fillIB),this.fillIB=null),this.effectFill&&(this._engine._releaseEffect(this.effectFill),this.effectFill=null),this.effectFillInstanced&&(this._engine._releaseEffect(this.effectFillInstanced),this.effectFillInstanced=null),this.borderVB&&(this._engine._releaseBuffer(this.borderVB),this.borderVB=null),this.borderIB&&(this._engine._releaseBuffer(this.borderIB),this.borderIB=null),this.effectBorder&&(this._engine._releaseEffect(this.effectBorder),
this.effectBorder=null),this.effectBorderInstanced&&(this._engine._releaseEffect(this.effectBorderInstanced),this.effectBorderInstanced=null),!0):!1},c);b.Lines2DRenderCache=f;var d,g=b.Shape2DInstanceData,c=function(b){g.call(this,b,1)};d=(__extends(c,g),Object.defineProperty(c.prototype,"boundingMin",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"boundingMax",{get:function(){return null},enumerable:!0,configurable:!0}),__decorate([b.instanceData(b.Shape2D.SHAPE2D_CATEGORY_FILLGRADIENT)],
c.prototype,"boundingMin",null),__decorate([b.instanceData(b.Shape2D.SHAPE2D_CATEGORY_FILLGRADIENT)],c.prototype,"boundingMax",null),c);b.Lines2DInstanceData=d;var m=b.Shape2D,j=function(c,d){d||(d={});m.call(this,d);this._borderIB=this._borderVB=this._fillIB=this._fillVB=null;this._size=b.Size.Zero();this._boundingMax=this._boundingMin=null;var e=null==d.fillThickness?1:d.fillThickness,f=null==d.startCap?0:d.startCap,g=null==d.endCap?0:d.endCap,j=null==d.closed?!1:d.closed;this.points=c;this.fillThickness=
e;this.startCap=f;this.endCap=g;this.closed=j},c=(__extends(j,m),Object.defineProperty(j,"NoCap",{get:function(){return j._noCap},enumerable:!0,configurable:!0}),Object.defineProperty(j,"RoundCap",{get:function(){return j._roundCap},enumerable:!0,configurable:!0}),Object.defineProperty(j,"TriangleCap",{get:function(){return j._triangleCap},enumerable:!0,configurable:!0}),Object.defineProperty(j,"SquareAnchorCap",{get:function(){return j._squareAnchorCap},enumerable:!0,configurable:!0}),Object.defineProperty(j,
"RoundAnchorCap",{get:function(){return j._roundAnchorCap},enumerable:!0,configurable:!0}),Object.defineProperty(j,"DiamondAnchorCap",{get:function(){return j._diamondAnchorCap},enumerable:!0,configurable:!0}),Object.defineProperty(j,"ArrowCap",{get:function(){return j._arrowCap},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"points",{get:function(){return this._points},set:function(b){this._points=b;this._boundingBoxDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,
"fillThickness",{get:function(){return this._fillThickness},set:function(b){this._fillThickness=b},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"closed",{get:function(){return this._closed},set:function(b){this._closed=b},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"startCap",{get:function(){return this._startCap},set:function(b){this._startCap=b},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"endCap",{get:function(){return this._endCap},
set:function(b){this._endCap=b},enumerable:!0,configurable:!0}),j.prototype.levelIntersect=function(c){var d=this;null==this._contour&&this._computeLines2D();var e=this.points.length,f=this.closed?e+1:e,g=c._localPickPosition;this.transformPointWithOriginToRef(this._contour[0],null,j._prevA);this.transformPointWithOriginToRef(this._contour[1],null,j._prevB);for(c=1;f>c;c++){if((this.transformPointWithOriginToRef(this._contour[2*(c%e)+0],null,j._curA),this.transformPointWithOriginToRef(this._contour[2*
(c%e)+1],null,j._curB),b.Vector2.PointInTriangle(g,j._prevA,j._prevB,j._curA))||b.Vector2.PointInTriangle(g,j._curA,j._prevB,j._curB))return!0;j._prevA.x=j._curA.x;j._prevA.y=j._curA.y;j._prevB.x=j._curB.x;j._prevB.y=j._curB.y}e=function(c,e){for(var f=c.length,l=0;f>l;l+=3)if(j._curA.x=e[2*c[l+0]+0],j._curA.y=e[2*c[l+0]+1],d.transformPointWithOriginToRef(j._curA,null,j._curB),j._curA.x=e[2*c[l+1]+0],j._curA.y=e[2*c[l+1]+1],d.transformPointWithOriginToRef(j._curA,null,j._prevA),j._curA.x=e[2*c[l+
2]+0],j._curA.y=e[2*c[l+2]+1],d.transformPointWithOriginToRef(j._curA,null,j._prevB),b.Vector2.PointInTriangle(g,j._prevA,j._prevB,j._curB))return!0;return!1};return this._startCapTriIndices&&(e(this._startCapTriIndices,this._startCapContour)||e(this._endCapTriIndices,this._endCapContour))?!0:!1},Object.defineProperty(j.prototype,"boundingMin",{get:function(){return this._boundingMin||this._computeLines2D(),this._boundingMin},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"boundingMax",
{get:function(){return this._boundingMax||this._computeLines2D(),this._boundingMax},enumerable:!0,configurable:!0}),j.prototype.getUsedShaderCategories=function(c){c=m.prototype.getUsedShaderCategories.call(this,c);var d=c.indexOf(b.Shape2D.SHAPE2D_CATEGORY_BORDER);return-1!==d&&c.splice(d,1),c},j.prototype.updateLevelBoundingInfo=function(){this._boundingMin||this._computeLines2D();b.BoundingInfo2D.CreateFromMinMaxToRef(this._boundingMin.x,this._boundingMax.x,this._boundingMin.y,this._boundingMax.y,
this._levelBoundingInfo)},j.prototype.createModelRenderCache=function(b){return new f(this.owner.engine,b)},j.prototype._perp=function(b,c){c.x=b.y;c.y=-b.x},j.prototype._direction=function(b,c,d){b.subtractToRef(c,d);d.normalize()},j.prototype._computeMiter=function(c,d,e,f){return e.addToRef(f,c),c.normalize(),d.x=-c.y,d.y=c.x,j._miterTps.x=-e.y,j._miterTps.y=e.x,1/b.Vector2.Dot(d,j._miterTps)},j.prototype._intersect=function(b,c,d,e,f,g,j,m){var x=(b-d)*(g-m)-(c-e)*(f-j);if(0===x)return!1;c=((f-
j)*(b*e-c*d)-(b-d)*(f*m-g*j))/x;return c<Math.min(b,d)||c>Math.max(b,d)?!1:!(c<Math.min(f,j)||c>Math.max(f,j))},j.prototype._updateMinMax=function(b,c){c>=b.length||(this._boundingMin.x=Math.min(this._boundingMin.x,b[c]),this._boundingMax.x=Math.max(this._boundingMax.x,b[c]),this._boundingMin.y=Math.min(this._boundingMin.y,b[c+1]),this._boundingMax.y=Math.max(this._boundingMax.y,b[c+1]))},j.prototype._store=function(c,d,e,f,g,m,s,u,x){var y=null!=u&&!isNaN(u),z=e*(y?8:4);if(!(z>=c.length)){0===e?
this._perp(m,j._startDir):e===f-1&&(this._perp(m,j._endDir),j._endDir.x*=-1,j._endDir.y*=-1);e=!1;if(c[z+0]=g.x+m.x*s,c[z+1]=g.y+m.y*s,c[z+2]=g.x+m.x*-s,c[z+3]=g.y+m.y*-s,this._updateMinMax(c,z),this._updateMinMax(c,z+2),void 0!==x)x*=y?8:4,this._intersect(c[z+0],c[z+1],c[x+0],c[x+1],c[z+2],c[z+3],c[x+2],c[x+3])&&(e=!0,x=c[z+0],c[z+0]=c[z+2],c[z+2]=x,x=c[z+1],c[z+1]=c[z+3],c[z+3]=x);y&&(s+=u,c[z+4]=g.x+m.x*(e?-s:s),c[z+5]=g.y+m.y*(e?-s:s),c[z+6]=g.x+m.x*(e?s:-s),c[z+7]=g.y+m.y*(e?s:-s),this._updateMinMax(c,
z+4),this._updateMinMax(c,z+6));d&&(z+=y?4:0,d.push(new b.Vector2(c[z+0],c[z+1])),d.push(new b.Vector2(c[z+2],c[z+3])))}},j.prototype._getCapSize=function(b,c){void 0===c&&(c=!1);var d=j._roundCapSubDiv,e=0,f=0;switch(b){case j.NoCap:!this.closed&&c?(e=4,f=6):e=f=0;break;case j.RoundCap:c?(e=d,f=3*(d-2)):(e=d/2+1,f=3*(d/2));break;case j.ArrowCap:c?(e=12,f=24):(e=3,f=3);break;case j.TriangleCap:c?(e=6,f=12):(e=3,f=3);break;case j.DiamondAnchorCap:c?(e=10,f=24):(e=5,f=9);break;case j.SquareAnchorCap:c?
(e=12,f=30):(e=4,f=6);break;case j.RoundAnchorCap:c?(e=2*d,f=6*(d-1)):(e=d+1,f=3*(d+1))}return{vbsize:2*e,ibsize:f}},j.prototype._storeVertex=function(b,c,d,e,f,g,m){var u=Math.cos(f);f=Math.sin(f);j._tpsV.x=u*g.x+-f*g.y+e.x;j._tpsV.y=f*g.x+u*g.y+e.y;e=c+2*d;return b[e+0]=j._tpsV.x,b[e+1]=j._tpsV.y,m&&(m.push(j._tpsV.x),m.push(j._tpsV.y)),this._updateMinMax(b,e),(c+2*d)/2},j.prototype._storeIndex=function(b,c,d,e){b[c+d]=e},j.prototype._buildCap=function(c,d,e,f,g,m,s,u,x,y){var z=j._roundCapSubDiv,
A=new b.Vector2(1,0);x=Math.atan2(x.y,x.x)-Math.atan2(A.y,A.x);var A=m/2,B=null!=s;switch(u){case j.NoCap:if(B&&!this.closed){var B=u=0,C=this._storeVertex(c,d,u++,g,x,new b.Vector2(0,A+s),y),D=this._storeVertex(c,d,u++,g,x,new b.Vector2(s,A+s),y),E=this._storeVertex(c,d,u++,g,x,new b.Vector2(s,-(A+s)),y),z=this._storeVertex(c,d,u++,g,x,new b.Vector2(0,-(A+s)),y);this._storeIndex(e,f,B++,C);this._storeIndex(e,f,B++,D);this._storeIndex(e,f,B++,E);this._storeIndex(e,f,B++,C);this._storeIndex(e,f,B++,
E);this._storeIndex(e,f,B++,z)}break;case j.ArrowCap:A*=2;case j.TriangleCap:if(B){var I=u===j.TriangleCap?s:Math.sqrt(2*s*s),C=this._storeVertex(c,d,0,g,x,new b.Vector2(0,A),null),D=this._storeVertex(c,d,1,g,x,new b.Vector2(A,0),null),E=this._storeVertex(c,d,2,g,x,new b.Vector2(0,-A),null),z=this._storeVertex(c,d,3,g,x,new b.Vector2(0,A+I),y),H=this._storeVertex(c,d,4,g,x,new b.Vector2(A+I,0),y),F=this._storeVertex(c,d,5,g,x,new b.Vector2(0,-(A+I)),y),B=0;if(this._storeIndex(e,f,B++,C),this._storeIndex(e,
f,B++,z),this._storeIndex(e,f,B++,H),this._storeIndex(e,f,B++,C),this._storeIndex(e,f,B++,H),this._storeIndex(e,f,B++,D),this._storeIndex(e,f,B++,F),this._storeIndex(e,f,B++,E),this._storeIndex(e,f,B++,D),this._storeIndex(e,f,B++,F),this._storeIndex(e,f,B++,D),this._storeIndex(e,f,B++,H),u===j.ArrowCap){C=m/2;m=this._storeVertex(c,d,9,g,x,new b.Vector2(0,-(C+s)),null);u=this._storeVertex(c,d,11,g,x,new b.Vector2(-s,-(A+I)),y);var J=this._storeVertex(c,d,10,g,x,new b.Vector2(-s,-(C+s)),y),G=this._storeVertex(c,
d,6,g,x,new b.Vector2(0,C+s),null),L=this._storeVertex(c,d,7,g,x,new b.Vector2(-s,C+s),y),N=this._storeVertex(c,d,8,g,x,new b.Vector2(-s,A+I),y);this._storeIndex(e,f,B++,G);this._storeIndex(e,f,B++,L);this._storeIndex(e,f,B++,N);this._storeIndex(e,f,B++,G);this._storeIndex(e,f,B++,N);this._storeIndex(e,f,B++,z);this._storeIndex(e,f,B++,m);this._storeIndex(e,f,B++,u);this._storeIndex(e,f,B++,J);this._storeIndex(e,f,B++,m);this._storeIndex(e,f,B++,F);this._storeIndex(e,f,B++,u)}}else C=this._storeVertex(c,
d,0,g,x,new b.Vector2(0,A),y),D=this._storeVertex(c,d,1,g,x,new b.Vector2(A,0),y),E=this._storeVertex(c,d,2,g,x,new b.Vector2(0,-A),y),this._storeIndex(e,f,0,C),this._storeIndex(e,f,1,D),this._storeIndex(e,f,2,E);break;case j.RoundCap:if(B){E=-Math.PI/2;H=Math.PI/(z/2-1);for(F=B=0;z/2>F;F++)C=this._storeVertex(c,d,2*F+0,g,x,new b.Vector2(Math.cos(E)*A,Math.sin(E)*A),null),D=this._storeVertex(c,d,2*F+1,g,x,new b.Vector2(Math.cos(E)*(A+s),Math.sin(E)*(A+s)),y),0<F&&(this._storeIndex(e,f,B++,C-2),this._storeIndex(e,
f,B++,D-2),this._storeIndex(e,f,B++,D),this._storeIndex(e,f,B++,C-2),this._storeIndex(e,f,B++,D),this._storeIndex(e,f,B++,C)),E+=H}else{I=this._storeVertex(c,d,0,g,x,new b.Vector2(0,0),null);E=-Math.PI/2;H=Math.PI/(z/2-1);this._storeVertex(c,d,1,g,x,new b.Vector2(Math.cos(E)*A,Math.sin(E)*A),null);E+=H;for(F=1;z/2>F;F++)D=this._storeVertex(c,d,F+1,g,x,new b.Vector2(Math.cos(E)*A,Math.sin(E)*A),y),this._storeIndex(e,f,3*F+0,I),this._storeIndex(e,f,3*F+1,D-1),this._storeIndex(e,f,3*F+2,D),E+=H}break;
case j.SquareAnchorCap:u=0;I=B?null:y;C=this._storeVertex(c,d,u++,g,x,new b.Vector2(0,m),I);D=this._storeVertex(c,d,u++,g,x,new b.Vector2(2*m,m),I);E=this._storeVertex(c,d,u++,g,x,new b.Vector2(2*m,-m),I);z=this._storeVertex(c,d,u++,g,x,new b.Vector2(0,-m),I);B?(H=this._storeVertex(c,d,u++,g,x,new b.Vector2(0,A+s),null),F=this._storeVertex(c,d,u++,g,x,new b.Vector2(-s,A+s),y),G=this._storeVertex(c,d,u++,g,x,new b.Vector2(-s,m+s),y),L=this._storeVertex(c,d,u++,g,x,new b.Vector2(2*m+s,m+s),y),N=this._storeVertex(c,
d,u++,g,x,new b.Vector2(2*m+s,-(m+s)),y),m=this._storeVertex(c,d,u++,g,x,new b.Vector2(-s,-(m+s)),y),J=this._storeVertex(c,d,u++,g,x,new b.Vector2(-s,-(A+s)),y),u=this._storeVertex(c,d,u++,g,x,new b.Vector2(0,-(A+s)),null),B=0,this._storeIndex(e,f,B++,F),this._storeIndex(e,f,B++,C),this._storeIndex(e,f,B++,H),this._storeIndex(e,f,B++,F),this._storeIndex(e,f,B++,G),this._storeIndex(e,f,B++,C),this._storeIndex(e,f,B++,C),this._storeIndex(e,f,B++,G),this._storeIndex(e,f,B++,L),this._storeIndex(e,f,B++,
C),this._storeIndex(e,f,B++,L),this._storeIndex(e,f,B++,D),this._storeIndex(e,f,B++,D),this._storeIndex(e,f,B++,L),this._storeIndex(e,f,B++,N),this._storeIndex(e,f,B++,D),this._storeIndex(e,f,B++,N),this._storeIndex(e,f,B++,E),this._storeIndex(e,f,B++,E),this._storeIndex(e,f,B++,N),this._storeIndex(e,f,B++,m),this._storeIndex(e,f,B++,E),this._storeIndex(e,f,B++,m),this._storeIndex(e,f,B++,z),this._storeIndex(e,f,B++,m),this._storeIndex(e,f,B++,J),this._storeIndex(e,f,B++,z),this._storeIndex(e,f,B++,
J),this._storeIndex(e,f,B++,u),this._storeIndex(e,f,B++,z)):(this._storeIndex(e,f,0,C),this._storeIndex(e,f,1,D),this._storeIndex(e,f,2,E),this._storeIndex(e,f,3,C),this._storeIndex(e,f,4,E),this._storeIndex(e,f,5,z));break;case j.RoundAnchorCap:A=Math.sqrt(m*m-A*A);C=new b.Vector2(A,0);E=b.Tools.ToRadians(-150);H=b.Tools.ToRadians(300)/(z-1);if(B)for(F=B=0;z>F;F++)C=this._storeVertex(c,d,2*F+0,g,x,new b.Vector2(A+Math.cos(E)*m,Math.sin(E)*m),null),D=this._storeVertex(c,d,2*F+1,g,x,new b.Vector2(A+
Math.cos(E)*(m+s),Math.sin(E)*(m+s)),y),0<F&&(this._storeIndex(e,f,B++,C-2),this._storeIndex(e,f,B++,D-2),this._storeIndex(e,f,B++,D),this._storeIndex(e,f,B++,C-2),this._storeIndex(e,f,B++,D),this._storeIndex(e,f,B++,C)),E+=H;else{I=this._storeVertex(c,d,0,g,x,C,null);this._storeVertex(c,d,1,g,x,new b.Vector2(A+Math.cos(E)*m,Math.sin(E)*m),null);E+=H;for(F=1;z>F;F++)D=this._storeVertex(c,d,F+1,g,x,new b.Vector2(A+Math.cos(E)*m,Math.sin(E)*m),y),this._storeIndex(e,f,3*F+0,I),this._storeIndex(e,f,3*
F+1,D-1),this._storeIndex(e,f,3*F+2,D),E+=H;this._storeIndex(e,f,3*z+0,I);this._storeIndex(e,f,3*z+1,I+1);this._storeIndex(e,f,3*z+2,I+z)}break;case j.DiamondAnchorCap:u=0,I=B?null:y,C=this._storeVertex(c,d,u++,g,x,new b.Vector2(0,A),I),D=this._storeVertex(c,d,u++,g,x,new b.Vector2(A,m),I),E=this._storeVertex(c,d,u++,g,x,new b.Vector2(3*A,0),I),z=this._storeVertex(c,d,u++,g,x,new b.Vector2(A,-m),I),H=this._storeVertex(c,d,u++,g,x,new b.Vector2(0,-A),I),B?(I=Math.sqrt(2*s*s),F=this._storeVertex(c,
d,u++,g,x,new b.Vector2(-I,A),y),G=this._storeVertex(c,d,u++,g,x,new b.Vector2(A,m+I),y),L=this._storeVertex(c,d,u++,g,x,new b.Vector2(3*A+I,0),y),N=this._storeVertex(c,d,u++,g,x,new b.Vector2(A,-(m+I)),y),m=this._storeVertex(c,d,u++,g,x,new b.Vector2(-I,-A),y),B=0,this._storeIndex(e,f,B++,F),this._storeIndex(e,f,B++,G),this._storeIndex(e,f,B++,C),this._storeIndex(e,f,B++,C),this._storeIndex(e,f,B++,G),this._storeIndex(e,f,B++,D),this._storeIndex(e,f,B++,D),this._storeIndex(e,f,B++,G),this._storeIndex(e,
f,B++,L),this._storeIndex(e,f,B++,D),this._storeIndex(e,f,B++,L),this._storeIndex(e,f,B++,E),this._storeIndex(e,f,B++,E),this._storeIndex(e,f,B++,L),this._storeIndex(e,f,B++,N),this._storeIndex(e,f,B++,E),this._storeIndex(e,f,B++,N),this._storeIndex(e,f,B++,z),this._storeIndex(e,f,B++,z),this._storeIndex(e,f,B++,N),this._storeIndex(e,f,B++,m),this._storeIndex(e,f,B++,z),this._storeIndex(e,f,B++,m),this._storeIndex(e,f,B++,H)):(this._storeIndex(e,f,0,C),this._storeIndex(e,f,1,D),this._storeIndex(e,
f,2,E),this._storeIndex(e,f,3,C),this._storeIndex(e,f,4,E),this._storeIndex(e,f,5,H),this._storeIndex(e,f,6,H),this._storeIndex(e,f,7,E),this._storeIndex(e,f,8,z))}return null},j.prototype._buildLine=function(c,d,e,f){var g=b.Vector2.Zero(),j=b.Vector2.Zero(),m=b.Vector2.Zero(),u=b.Vector2.Zero(),x=null;this.closed&&this.points.push(this.points[0]);for(var y=this.points.length,z=1;y>z;z++){var A=this.points[z],B=z<this.points.length-1?this.points[z+1]:null;(this._direction(A,this.points[z-1],g),x||
(x=b.Vector2.Zero(),this._perp(g,x)),1===z&&this._store(c,d,0,y,this.points[0],x,e,f),B)?(this._direction(B,A,j),A=this._computeMiter(m,u,g,j),this._store(c,d,z,y,this.points[z],u,A*e,A*f,z-1)):(this._perp(g,x),this._store(c,d,z,y,this.points[z],x,e,f,z-1))}if(2<this.points.length&&this.closed&&(z=this.points[0],A=this.points[1],this._direction(z,this.points[y-2],g),this._direction(A,z,j),this._perp(g,x),g=this._computeMiter(m,u,g,j),this._store(c,null,0,y,this.points[0],u,g*e,g*f,1),d))e=null==f?
0:4,d[0].x=c[e+0],d[0].y=c[e+1],d[1].x=c[e+2],d[1].y=c[e+3];this.closed&&this.points.splice(y-1)},j.prototype.setupModelRenderCache=function(c){var d=this.owner.engine;if(null===this._fillVB&&this._computeLines2D(),this.fill){c.fillVB=d.createVertexBuffer(this._fillVB);c.fillIB=d.createIndexBuffer(this._fillIB);c.fillIndicesCount=this._fillIB.length;var e=this.getDataPartEffectInfo(b.Shape2D.SHAPE2D_FILLPARTID,["position"],!0);e&&(c.effectFillInstanced=d.createEffect("lines2d",e.attributes,e.uniforms,
[],e.defines,null));e=this.getDataPartEffectInfo(b.Shape2D.SHAPE2D_FILLPARTID,["position"],!1);c.effectFill=d.createEffect("lines2d",e.attributes,e.uniforms,[],e.defines,null)}this.border&&(c.borderVB=d.createVertexBuffer(this._borderVB),c.borderIB=d.createIndexBuffer(this._borderIB),c.borderIndicesCount=this._borderIB.length,(e=this.getDataPartEffectInfo(b.Shape2D.SHAPE2D_BORDERPARTID,["position"],!0))&&(c.effectBorderInstanced=d.createEffect({vertex:"lines2d",fragment:"lines2d"},e.attributes,e.uniforms,
[],e.defines,null)),e=this.getDataPartEffectInfo(b.Shape2D.SHAPE2D_BORDERPARTID,["position"],!1),c.effectBorder=d.createEffect({vertex:"lines2d",fragment:"lines2d"},e.attributes,e.uniforms,[],e.defines,null));return this._fillVB=null,this._fillIB=null,this._borderVB=null,this._borderIB=null,c},j.prototype._computeLines2D=function(){this._boundingMin=new b.Vector2(Number.MAX_VALUE,Number.MAX_VALUE);this._boundingMax=new b.Vector2(Number.MIN_VALUE,Number.MIN_VALUE);var c=[],d=[],e=[];if(this.fill){var f=
this._getCapSize(this.startCap),g=this._getCapSize(this.endCap),m=this.points.length,s=4*m+f.vbsize+g.vbsize,s=this._fillVB=new Float32Array(s),u=this.fillThickness/2,x=this.points.length;this._buildLine(s,this.border?null:c,u);for(var u=2*x,y=2*(m-(this.closed?0:1)),g=this._fillIB=new Float32Array(3*y+f.ibsize+g.ibsize),z=0;y>z;z+=2)g[3*z+0]=z+0,g[3*z+1]=z+1,g[3*z+2]=(z+2)%u,g[3*z+3]=z+1,g[3*z+4]=(z+3)%u,g[3*z+5]=(z+2)%u;this._buildCap(s,4*m,g,3*y,this.points[0],this.fillThickness,null,this.startCap,
j._startDir,this.border?null:d);this._buildCap(s,4*m+f.vbsize,g,3*y+f.ibsize,this.points[x-1],this.fillThickness,null,this.endCap,j._endDir,this.border?null:d)}if(this.border){f=this._getCapSize(this.startCap,!0);g=this._getCapSize(this.endCap,!0);m=this.points.length;s=8*m+f.vbsize+g.vbsize;s=this._borderVB=new Float32Array(s);u=this.fillThickness/2;y=this.borderThickness;x=this.points.length;this._buildLine(s,c,u,y);u=4*x;y=4*(m-(this.closed?0:1));g=this._borderIB=new Float32Array(3*y+f.ibsize+
g.ibsize);for(z=0;y>z;z+=4)g[3*z+0]=z+0,g[3*z+1]=z+2,g[3*z+2]=(z+6)%u,g[3*z+3]=z+0,g[3*z+4]=(z+6)%u,g[3*z+5]=(z+4)%u,g[3*z+6]=z+3,g[3*z+7]=z+1,g[3*z+8]=(z+5)%u,g[3*z+9]=z+3,g[3*z+10]=(z+5)%u,g[3*z+11]=(z+7)%u;this._buildCap(s,8*m,g,3*y,this.points[0],this.fillThickness,this.borderThickness,this.startCap,j._startDir,d);this._buildCap(s,8*m+f.vbsize,g,3*y+f.ibsize,this.points[x-1],this.fillThickness,this.borderThickness,this.endCap,j._endDir,e)}if(this._contour=c,0<d.length)this._startCapTriIndices=
Earcut.earcut(d,null,2),this._startCapContour=d;0<e.length&&(c=Earcut.earcut(e,null,2),this._endCapContour=e,this._endCapTriIndices=c);e=this._boundingMax.subtract(this._boundingMin);this._size.width=e.x;this._size.height=e.y},Object.defineProperty(j.prototype,"size",{get:function(){return null==this._size&&this._computeLines2D(),this._size},enumerable:!0,configurable:!0}),j.prototype.createInstanceDataParts=function(){var c=[];return this.border&&c.push(new d(b.Shape2D.SHAPE2D_BORDERPARTID)),this.fill&&
c.push(new d(b.Shape2D.SHAPE2D_FILLPARTID)),c},j.prototype.refreshInstanceDataPart=function(c){if(!m.prototype.refreshInstanceDataPart.call(this,c))return!1;c.id===b.Shape2D.SHAPE2D_BORDERPARTID?this.border instanceof b.GradientColorBrush2D&&(c.boundingMin=this.boundingMin,c.boundingMax=this.boundingMax):c.id===b.Shape2D.SHAPE2D_FILLPARTID&&this.fill instanceof b.GradientColorBrush2D&&(c.boundingMin=this.boundingMin,c.boundingMax=this.boundingMax);return!0},j._prevA=b.Vector2.Zero(),j._prevB=b.Vector2.Zero(),
j._curA=b.Vector2.Zero(),j._curB=b.Vector2.Zero(),j._miterTps=b.Vector2.Zero(),j._startDir=b.Vector2.Zero(),j._endDir=b.Vector2.Zero(),j._tpsV=b.Vector2.Zero(),j._noCap=0,j._roundCap=1,j._triangleCap=2,j._squareAnchorCap=3,j._roundAnchorCap=4,j._diamondAnchorCap=5,j._arrowCap=6,j._roundCapSubDiv=36,__decorate([b.modelLevelProperty(b.Shape2D.SHAPE2D_PROPCOUNT+1,function(b){return j.pointsProperty=b})],j.prototype,"points",null),__decorate([b.modelLevelProperty(b.Shape2D.SHAPE2D_PROPCOUNT+2,function(b){return j.fillThicknessProperty=
b})],j.prototype,"fillThickness",null),__decorate([b.modelLevelProperty(b.Shape2D.SHAPE2D_PROPCOUNT+3,function(b){return j.closedProperty=b})],j.prototype,"closed",null),__decorate([b.modelLevelProperty(b.Shape2D.SHAPE2D_PROPCOUNT+4,function(b){return j.startCapProperty=b})],j.prototype,"startCap",null),__decorate([b.modelLevelProperty(b.Shape2D.SHAPE2D_PROPCOUNT+5,function(b){return j.endCapProperty=b})],j.prototype,"endCap",null),j=__decorate([b.className("Lines2D")],j));b.Lines2D=c}(BABYLON||(BABYLON=
{}));
!function(b){var f,e=function(){this._modelCache=new b.StringDictionary};f=(e.prototype.GetOrAddModelCache=function(b,c){return this._modelCache.getOrAddWithFactory(b,c)},e.prototype.DisposeModelRenderCache=function(b){return b.isDisposed?(this._modelCache.remove(b.modelKey),!0):!1},e);b.Canvas2DEngineBoundData=f;var c,d=b.Group2D,g=function(c,e){var m=this;d.call(this,e);this.worldSpaceToNodeLocal=function(c){var d=m._worldSpaceNode;if(d)return d=d.getWorldMatrix().clone(),d.invert(),c=b.Vector3.TransformCoordinates(c,d),
d=m._renderScaleFactor,c=new b.Vector2(c.x*d,c.y*d),d=m.actualSize,m.origin,c.x+=0.5*d.width,c.y+=0.5*d.width,c};this._notifDebugMode=!1;this._mapCounter=0;b.Prim2DBase._isCanvasInit=!1;e||(e={});var q=null==e.renderScaleFactor?1:e.renderScaleFactor;this._cachingStrategy!==g.CACHESTRATEGY_TOPLEVELGROUPS&&(this._background=new b.Rectangle2D({parent:this,id:"###CANVAS BACKGROUND###",size:e.size}),this._background.zOrder=1,this._background.isPickable=!1,this._background.origin=b.Vector2.Zero(),this._background.levelVisible=
!1,null!=e.backgroundRoundRadius&&(this.backgroundRoundRadius=e.backgroundRoundRadius),null!=e.backgroundBorder&&("string"==typeof e.backgroundBorder?this.backgroundBorder=g.GetBrushFromString(e.backgroundBorder):this.backgroundBorder=e.backgroundBorder),null!=e.backgroundBorderThickNess&&(this.backgroundBorderThickness=e.backgroundBorderThickNess),null!=e.backgroundFill&&("string"==typeof e.backgroundFill?this.backgroundFill=g.GetBrushFromString(e.backgroundFill):this.backgroundFill=e.backgroundFill),
this._background._patchHierarchy(this));var p=c.getEngine();this.__engineData=p.getOrAddExternalDataWithFactory("__BJSCANVAS2D__",function(){return new f});this._renderScaleFactor=q;this._primPointerInfo=new b.PrimitivePointerInfo;this._capturedPointers=new b.StringDictionary;this._pickStartingPosition=b.Vector2.Zero();this._hierarchyLevelMaxSiblingCount=50;this._hierarchyDepthOffset=0;this._siblingDepthOffset=1/this._hierarchyLevelMaxSiblingCount;this._scene=c;this._engine=p;this._renderingSize=
new b.Size(0,0);this._trackedGroups=[];this._patchHierarchy(this);var r=null==e.enableInteraction?!0:e.enableInteraction;this._fitRenderingDevice=!e.size;e.size?(e.size.height*=q,e.size.width*=q):e.size=new b.Size(p.getRenderWidth(),p.getRenderHeight());c.onDisposeObservable.add(function(){m.dispose()});this._isScreenSpace?this._afterRenderObserver=this._scene.onAfterRenderObservable.add(function(){m._engine.clear(null,!1,!0);m._render()}):this._beforeRenderObserver=this._scene.onBeforeRenderObservable.add(function(){m._render()});
this._supprtInstancedArray=null!==this._engine.getCaps().instancedArrays;this._setupInteraction(r)};c=(__extends(g,d),g.prototype._canvasPreInit=function(b){this._cachingStrategy=null==b.cachingStrategy?g.CACHESTRATEGY_DONTCACHE:b.cachingStrategy;this._isScreenSpace=null==b.isScreenSpace?!0:b.isScreenSpace},g.prototype._setupInteraction=function(b){var c=this;if(b!==this._interactionEnabled)if(this._interactionEnabled=b,this._isScreenSpace){if(!b)return void(this._scenePrePointerObserver&&(this.scene.onPrePointerObservable.remove(this._scenePrePointerObserver),
this._scenePrePointerObserver=null));this._scenePrePointerObserver=this.scene.onPrePointerObservable.add(function(b,d){var e=1/c.engine.getHardwareScalingLevel(),e=b.localPosition.multiplyByFloats(e,e);c._handlePointerEventForInteraction(b,e,d)})}else{var d=this.scene;b?(d.constantlyUpdateMeshUnderPointer=!0,this._scenePointerObserver=d.onPointerObservable.add(function(b,d){if(b.pickInfo.hit&&b.pickInfo.pickedMesh===c._worldSpaceNode&&c.worldSpaceToNodeLocal){var e=c.worldSpaceToNodeLocal(b.pickInfo.pickedPoint);
c._handlePointerEventForInteraction(b,e,d)}})):this._scenePointerObserver&&(this.scene.onPointerObservable.remove(this._scenePointerObserver),this._scenePointerObserver=null)}},g.prototype._setPointerCapture=function(c,d){if(this.isPointerCaptured(c))return!1;try{this.engine.getRenderingCanvas().setPointerCapture(c)}catch(e){}return this._primPointerInfo.updateRelatedTarget(d,b.Vector2.Zero()),this._bubbleNotifyPrimPointerObserver(d,b.PrimitivePointerInfo.PointerGotCapture,null),this._capturedPointers.add(c.toString(),
d),!0},g.prototype._releasePointerCapture=function(c,d){if(this._capturedPointers.get(c.toString())!==d)return!1;try{this.engine.getRenderingCanvas().releasePointerCapture(c)}catch(e){}return this._primPointerInfo.updateRelatedTarget(d,b.Vector2.Zero()),this._bubbleNotifyPrimPointerObserver(d,b.PrimitivePointerInfo.PointerLostCapture,null),this._capturedPointers.remove(c.toString()),!0},g.prototype.isPointerCaptured=function(b){return this._capturedPointers.contains(b.toString())},g.prototype.getCapturedPrimitive=
function(b){return 0===this._capturedPointers.count?null:this._capturedPointers.get(b.toString())},g.prototype._handlePointerEventForInteraction=function(c,d){if(!this.isDisposed){this._updatePointerInfo(c,d);var e=this.getCapturedPrimitive(this._primPointerInfo.pointerId);if(this._updateIntersectionList(this._primPointerInfo.canvasPointerPos,null!==e),this._updateOverStatus(),this._actualOverPrimitive||e){var f=e||this._actualOverPrimitive.prim,e=e?this._primPointerInfo.canvasPointerPos.subtract(new b.Vector2(f.globalTransform.m[12],
f.globalTransform.m[13])):this._actualOverPrimitive.intersectionLocation;this._primPointerInfo.updateRelatedTarget(f,e);c.type===b.PointerEventTypes.POINTERWHEEL?this._bubbleNotifyPrimPointerObserver(f,b.PrimitivePointerInfo.PointerMouseWheel,c.event):c.type===b.PointerEventTypes.POINTERMOVE?this._bubbleNotifyPrimPointerObserver(f,b.PrimitivePointerInfo.PointerMove,c.event):c.type===b.PointerEventTypes.POINTERDOWN?this._bubbleNotifyPrimPointerObserver(f,b.PrimitivePointerInfo.PointerDown,c.event):
c.type===b.PointerEventTypes.POINTERUP&&this._bubbleNotifyPrimPointerObserver(f,b.PrimitivePointerInfo.PointerUp,c.event)}}},g.prototype._updatePointerInfo=function(c,d){var e=this._primPointerInfo;e.canvasPointerPos||(e.canvasPointerPos=b.Vector2.Zero());var f=this._scene.cameraToUseForPointers||this._scene.activeCamera,g=this._scene.getEngine();if(this._isScreenSpace){var f=f.viewport.toGlobal(g.getRenderWidth(),g.getRenderHeight()),m=d.y-f.y;e.canvasPointerPos.x=d.x-f.x-this.actualPosition.x;e.canvasPointerPos.y=
g.getRenderHeight()-m-this.actualPosition.y}else e.canvasPointerPos.x=d.x,e.canvasPointerPos.y=d.y;(e.mouseWheelDelta=0,c.type===b.PointerEventTypes.POINTERWHEEL)?(g=c.event,g.wheelDelta?e.mouseWheelDelta=g.wheelDelta/(40*b.PrimitivePointerInfo.MouseWheelPrecision):g.detail&&(e.mouseWheelDelta=-g.detail/b.PrimitivePointerInfo.MouseWheelPrecision)):(g=c.event,e.ctrlKey=g.ctrlKey,e.altKey=g.altKey,e.shiftKey=g.shiftKey,e.metaKey=g.metaKey,e.button=g.button,e.buttons=g.buttons,e.pointerId=g.pointerId,
e.width=g.width,e.height=g.height,e.presssure=g.pressure,e.tilt.x=g.tiltX,e.tilt.y=g.tiltY,e.isCaptured=null!==this.getCapturedPrimitive(g.pointerId))},g.prototype._updateIntersectionList=function(b,c){if(this.scene.getRenderId()!==this._intersectionRenderId){this._globalTransform||this.updateCachedStates(!0);var d=g._interInfo;if(d.pickPosition.x=b.x,d.pickPosition.y=b.y,d.findFirstOnly=!1,!c&&!this.boundingInfo.doesIntersect(d.pickPosition))return this._previousIntersectionList=this._actualIntersectionList,
this._actualIntersectionList=null,this._previousOverPrimitive=this._actualOverPrimitive,void(this._actualOverPrimitive=null);this.intersect(d);this._previousIntersectionList=this._actualIntersectionList;this._actualIntersectionList=d.intersectedPrimitives;this._previousOverPrimitive=this._actualOverPrimitive;this._actualOverPrimitive=d.topMostIntersectedPrimitive;this._intersectionRenderId=this.scene.getRenderId()}},g.prototype._updateOverStatus=function(){if(this.scene.getRenderId()!==this._hoverStatusRenderId&&
this._previousIntersectionList&&this._actualIntersectionList){var c=this._previousOverPrimitive?this._previousOverPrimitive.prim:null,d=this._actualOverPrimitive?this._actualOverPrimitive.prim:null;if(c!==d){var e=this.getCapturedPrimitive(this._primPointerInfo.pointerId);(e&&e===c||!e&&c)&&(this._primPointerInfo.updateRelatedTarget(c,this._previousOverPrimitive.intersectionLocation),this._bubbleNotifyPrimPointerObserver(c,b.PrimitivePointerInfo.PointerOut,null));(e&&e===d||!e&&d)&&(this._primPointerInfo.updateRelatedTarget(d,
this._actualOverPrimitive.intersectionLocation),this._bubbleNotifyPrimPointerObserver(d,b.PrimitivePointerInfo.PointerOver,null))}this._hoverStatusRenderId=this.scene.getRenderId()}},g.prototype._updatePrimPointerPos=function(b){if(this._primPointerInfo.isCaptured)this._primPointerInfo.primitivePointerPos=this._primPointerInfo.relatedTargetPointerPos;else for(var c=0,d=this._actualIntersectionList;c<d.length;c++){var e=d[c];if(e.prim===b)return void(this._primPointerInfo.primitivePointerPos=e.intersectionLocation)}},
g.prototype._debugExecObserver=function(c,d){if(this._notifDebugMode){for(var e="",f=0;f<c.hierarchyDepth;f++)e+="  ";f=this._primPointerInfo;e+="[RID:"+this.scene.getRenderId()+"] ["+c.hierarchyDepth+"] event:"+b.PrimitivePointerInfo.getEventTypeName(d)+", id: "+c.id+" ("+b.Tools.getClassName(c)+"), primPos: "+f.primitivePointerPos.toString()+", canvasPos: "+f.canvasPointerPos.toString();console.log(e)}},g.prototype._bubbleNotifyPrimPointerObserver=function(c,d,e){var f=this._primPointerInfo;0!==
(d&(b.PrimitivePointerInfo.PointerOver|b.PrimitivePointerInfo.PointerOut))&&this._notifParents(c,d);for(var g=!1;c;){if(!g&&(this._updatePrimPointerPos(c),this._debugExecObserver(c,d),c._pointerEventObservable.notifyObservers(f,d),this._triggerActionManager(c,f,d,e),f.cancelBubble)){if(0===(d&(b.PrimitivePointerInfo.PointerOver|b.PrimitivePointerInfo.PointerOut)))break;g=!0}g&&this._updatePrimPointerPos(c);d===b.PrimitivePointerInfo.PointerOver?(this._debugExecObserver(c,b.PrimitivePointerInfo.PointerEnter),
c._pointerEventObservable.notifyObservers(f,b.PrimitivePointerInfo.PointerEnter)):d===b.PrimitivePointerInfo.PointerOut&&(this._debugExecObserver(c,b.PrimitivePointerInfo.PointerLeave),c._pointerEventObservable.notifyObservers(f,b.PrimitivePointerInfo.PointerLeave));c=c.parent}},g.prototype._triggerActionManager=function(c,d,e,f){var g=this;if(this._globalTransform||this.updateCachedStates(!0),0!==(e&b.PrimitivePointerInfo.PointerDown)){if(this._pickStartingPosition=d.primitivePointerPos.clone(),
this._pickStartingTime=(new Date).getTime(),this._pickedDownPrim=null,c.actionManager){if(this._pickedDownPrim=c,c.actionManager.hasPickTriggers){e=b.ActionEvent.CreateNewFromPrimitive(c,d.primitivePointerPos,f);switch(f.button){case 0:c.actionManager.processTrigger(b.ActionManager.OnLeftPickTrigger,e);break;case 1:c.actionManager.processTrigger(b.ActionManager.OnCenterPickTrigger,e);break;case 2:c.actionManager.processTrigger(b.ActionManager.OnRightPickTrigger,e)}c.actionManager.processTrigger(b.ActionManager.OnPickDownTrigger,
e)}c.actionManager.hasSpecificTrigger(b.ActionManager.OnLongPressTrigger)&&window.setTimeout(function(){var d=g._primPointerInfo,e=g.getCapturedPrimitive(d.pointerId);g._updateIntersectionList(d.canvasPointerPos,null!==e);e=new b.IntersectInfo2D;e.pickPosition=d.canvasPointerPos.clone();e.findFirstOnly=!1;g.intersect(e);null!==e.isPrimIntersected(c)&&c.actionManager&&0!==g._pickStartingTime&&(new Date).getTime()-g._pickStartingTime>b.ActionManager.LongPressDelay&&Math.abs(g._pickStartingPosition.x-
e.pickPosition.x)<b.ActionManager.DragMovementThreshold&&Math.abs(g._pickStartingPosition.y-e.pickPosition.y)<b.ActionManager.DragMovementThreshold&&(g._pickStartingTime=0,c.actionManager.processTrigger(b.ActionManager.OnLongPressTrigger,b.ActionEvent.CreateNewFromPrimitive(c,d.primitivePointerPos,f)))},b.ActionManager.LongPressDelay)}}else 0!==(e&b.PrimitivePointerInfo.PointerUp)?(this._pickStartingTime=0,e=b.ActionEvent.CreateNewFromPrimitive(c,d.primitivePointerPos,f),c.actionManager&&(c.actionManager.processTrigger(b.ActionManager.OnPickUpTrigger,
e),Math.abs(this._pickStartingPosition.x-d.canvasPointerPos.x)<b.ActionManager.DragMovementThreshold&&Math.abs(this._pickStartingPosition.y-d.canvasPointerPos.y)<b.ActionManager.DragMovementThreshold&&c.actionManager.processTrigger(b.ActionManager.OnPickTrigger,e)),this._pickedDownPrim&&this._pickedDownPrim.actionManager&&this._pickedDownPrim!==c&&this._pickedDownPrim.actionManager.processTrigger(b.ActionManager.OnPickOutTrigger,e)):0!==(e&b.PrimitivePointerInfo.PointerOver)?c.actionManager&&(e=b.ActionEvent.CreateNewFromPrimitive(c,
d.primitivePointerPos,f),c.actionManager.processTrigger(b.ActionManager.OnPointerOverTrigger,e)):0!==(e&b.PrimitivePointerInfo.PointerOut)&&c.actionManager&&(e=b.ActionEvent.CreateNewFromPrimitive(c,d.primitivePointerPos,f),c.actionManager.processTrigger(b.ActionManager.OnPointerOutTrigger,e))},g.prototype._notifParents=function(c,d){for(var e=this._primPointerInfo,f=this;f;)this._updatePrimPointerPos(f),d===b.PrimitivePointerInfo.PointerOver?(this._debugExecObserver(f,b.PrimitivePointerInfo.PointerEnter),
f._pointerEventObservable.notifyObservers(e,b.PrimitivePointerInfo.PointerEnter)):d===b.PrimitivePointerInfo.PointerOut&&(this._debugExecObserver(f,b.PrimitivePointerInfo.PointerLeave),f._pointerEventObservable.notifyObservers(e,b.PrimitivePointerInfo.PointerLeave)),f=f.parent},g.prototype.dispose=function(){return d.prototype.dispose.call(this)?(this.interactionEnabled&&this._setupInteraction(!1),this._beforeRenderObserver&&(this._scene.onBeforeRenderObservable.remove(this._beforeRenderObserver),
this._beforeRenderObserver=null),this._afterRenderObserver&&(this._scene.onAfterRenderObservable.remove(this._afterRenderObserver),this._afterRenderObserver=null),void(this._groupCacheMaps&&(this._groupCacheMaps.forEach(function(b){return b.dispose()}),this._groupCacheMaps=null))):!1},Object.defineProperty(g.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"engine",{get:function(){return this._engine},enumerable:!0,configurable:!0}),
Object.defineProperty(g.prototype,"cachingStrategy",{get:function(){return this._cachingStrategy},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"worldSpaceCanvasNode",{get:function(){return this._worldSpaceNode},set:function(b){this._worldSpaceNode=b},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"supportInstancedArray",{get:function(){return this._supprtInstancedArray},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"backgroundFill",{get:function(){return this._background&&
this._background.isVisible?this._background.fill:null},set:function(b){this.checkBackgroundAvailability();b!==this._background.fill&&(this._background.fill=b,this._background.levelVisible=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"backgroundBorder",{get:function(){return this._background&&this._background.isVisible?this._background.border:null},set:function(b){this.checkBackgroundAvailability();b!==this._background.border&&(this._background.border=b,this._background.levelVisible=
!0)},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"backgroundBorderThickness",{get:function(){return this._background&&this._background.isVisible?this._background.borderThickness:null},set:function(b){this.checkBackgroundAvailability();b!==this._background.borderThickness&&(this._background.borderThickness=b)},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"backgroundRoundRadius",{get:function(){return this._background&&this._background.isVisible?this._background.roundRadius:
null},set:function(b){this.checkBackgroundAvailability();b!==this._background.roundRadius&&(this._background.roundRadius=b,this._background.levelVisible=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"interactionEnabled",{get:function(){return this._interactionEnabled},set:function(b){this._setupInteraction(b)},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"_engineData",{get:function(){return this.__engineData},enumerable:!0,configurable:!0}),g.prototype.checkBackgroundAvailability=
function(){if(this._cachingStrategy===g.CACHESTRATEGY_TOPLEVELGROUPS)throw Error("Can't use Canvas Background with the caching strategy TOPLEVELGROUPS");},g.prototype.onPrimBecomesDirty=function(){this._addPrimToDirtyList(this)},g.prototype._updateTrackedNodes=function(){var c=this.scene.cameraToUseForPointers||this.scene.activeCamera;c.getViewMatrix().multiplyToRef(c.getProjectionMatrix(),g._m);for(var d=this.engine.getRenderHeight(),c=c.viewport.toGlobal(this.engine.getRenderWidth(),d),e=0,f=this._trackedGroups;e<
f.length;e++){var m=f[e];if(!m.isDisposed&&m.isVisible){var r=m.trackedNode.getWorldMatrix(),r=b.Vector3.Project(g._v,r,g._m,c);m.x=Math.round(r.x);m.y=Math.round(d-r.y)}}},g.prototype._updateCanvasState=function(){if(this.scene.getRenderId()!==this._updateRenderId){var c=!1,d=this.engine.getRenderWidth();d!==this._renderingSize.width&&(c=!0);this._renderingSize.width=d;d=this.engine.getRenderHeight();d!==this._renderingSize.height&&(c=!0);this._renderingSize.height=d;c&&this._fitRenderingDevice&&
(this.size=this._renderingSize,this._background&&(this._background.size=this.size),this._setLayoutDirty());c=new b.PrepareRender2DContext;++this._globalTransformProcessStep;this.updateCachedStates(!1);this._prepareGroupRender(c);this._updateRenderId=this.scene.getRenderId()}},g.prototype._render=function(){this._updateTrackedNodes();this._updateCanvasState();this._primPointerInfo.canvasPointerPos&&(this._updateIntersectionList(this._primPointerInfo.canvasPointerPos,!1),this._updateOverStatus());this.engine.setState(!1);
this._groupRender();this._cachingStrategy===g.CACHESTRATEGY_CANVAS&&this._cachedCanvasGroup&&this._cachedCanvasGroup._renderCachedCanvas()},g.prototype._allocateGroupCache=function(c,d,e){var f=c.actualSize,f=new b.Size(Math.ceil(f.width),Math.ceil(f.height));e&&(f.width=Math.max(e.width,f.width),f.height=Math.max(e.height,f.height));this._groupCacheMaps||(this._groupCacheMaps=[]);e=null;for(var m=0,r=this._groupCacheMaps;m<r.length;m++){var t=r[m],s=t.allocateRect(f);if(s){e={node:s,texture:t};break}}e||
(e=new b.Size(g._groupTextureCacheSize,g._groupTextureCacheSize),(f.width>e.width||f.height>e.height)&&(e.width=Math.pow(2,Math.ceil(Math.log(f.width)/Math.log(2))),e.height=Math.pow(2,Math.ceil(Math.log(f.height)/Math.log(2)))),t=new b.MapTexture("groupsMapChache"+this._mapCounter+"forCanvas"+this.id,this._scene,e),this._groupCacheMaps.push(t),s=t.allocateRect(f),e={node:s,texture:t});if(c!==this||this._isScreenSpace)s=e.node,this._cachingStrategy===g.CACHESTRATEGY_CANVAS?(this._cachedCanvasGroup=
b.Group2D._createCachedCanvasGroup(this),d=new b.Sprite2D(t,{parent:this._cachedCanvasGroup,id:"__cachedCanvasSprite__",spriteSize:s.contentSize,spriteLocation:s.pos}),d.zOrder=1,d.origin=b.Vector2.Zero()):(d=new b.Sprite2D(t,{parent:d,id:"__cachedSpriteOfGroup__"+c.id,x:c.actualPosition.x,y:c.actualPosition.y,spriteSize:s.contentSize,spriteLocation:s.pos}),d.origin=c.origin.clone(),e.sprite=d);return e},g.prototype._registerTrackedNode=function(c){c._isFlagSet(b.SmartPropertyPrim.flagTrackedGroup)||
(this._trackedGroups.push(c),c._setFlags(b.SmartPropertyPrim.flagTrackedGroup))},g.prototype._unregisterTrackedNode=function(c){if(c._isFlagSet(b.SmartPropertyPrim.flagTrackedGroup)){var d=this._trackedGroups.indexOf(c);-1!==d&&this._trackedGroups.splice(d,1);c._clearFlags(b.SmartPropertyPrim.flagTrackedGroup)}},g.GetSolidColorBrush=function(c){return g._solidColorBrushes.getOrAddWithFactory(c.toHexString(),function(){return new b.SolidColorBrush2D(c.clone(),!0)})},g.GetSolidColorBrushFromHex=function(c){return g._solidColorBrushes.getOrAddWithFactory(c,
function(){return new b.SolidColorBrush2D(b.Color4.FromHexString(c),!0)})},g.GetGradientColorBrush=function(c,d,e,f,m){return void 0===e&&(e=b.Vector2.Zero()),void 0===f&&(f=0),void 0===m&&(m=1),g._gradientColorBrushes.getOrAddWithFactory(b.GradientColorBrush2D.BuildKey(c,d,e,f,m),function(){return new b.GradientColorBrush2D(c,d,e,f,m,!0)})},g.GetBrushFromString=function(c){c=c.trim();var d=c.split(",");if(1===d.length){d=null;if(0===c.indexOf("solid:"))d=c.substr(6).trim();else{if(0!==c.indexOf("#"))return null;
d=c}return g.GetSolidColorBrushFromHex(d)}0===d[0].indexOf("gradient:")&&(d[0]=d[0].substr(9).trim());try{var e=b.Color4.FromHexString(d[0].trim()),f=b.Color4.FromHexString(d[1].trim()),m=b.Vector2.Zero();if(2<d.length){var r=d[2].trim();if("["!==r.charAt(0)||"]"!==r.charAt(r.length-1))return null;var t=r.indexOf(":"),s=parseFloat(r.substr(1,t)),u=parseFloat(r.substr(t+1,r.length-(t+1))),m=new b.Vector2(s,u)}c=0;3<d.length&&(c=b.Tools.ToRadians(parseFloat(d[3].trim())));r=1;return 4<d.length&&(r=
parseFloat(d[4].trim())),g.GetGradientColorBrush(e,f,m,c,r)}catch(x){return null}},g.CACHESTRATEGY_TOPLEVELGROUPS=1,g.CACHESTRATEGY_ALLGROUPS=2,g.CACHESTRATEGY_CANVAS=3,g.CACHESTRATEGY_DONTCACHE=4,g.hierarchyLevelMaxSiblingCount=50,g._interInfo=new b.IntersectInfo2D,g._v=b.Vector3.Zero(),g._m=b.Matrix.Identity(),g._groupTextureCacheSize=1024,g._solidColorBrushes=new b.StringDictionary,g._gradientColorBrushes=new b.StringDictionary,g=__decorate([b.className("Canvas2D")],g));b.Canvas2D=c;var m=function(d,
e,f){b.Prim2DBase._isCanvasInit=!0;if(f.isScreenSpace=!1,f.size=e.clone(),f.cachingStrategy=null==f.cachingStrategy?c.CACHESTRATEGY_CANVAS:f.cachingStrategy,f.cachingStrategy!==c.CACHESTRATEGY_CANVAS)throw Error("Right now only the CACHESTRATEGY_CANVAS cache Strategy is supported for WorldSpace Canvas. More will come soon!");c.call(this,d,f);b.Prim2DBase._isCanvasInit=!1;var g=f?f.id||null:null;if(!f||null==f.customWorldSpaceNode){var m=new b.WorldSpaceCanvas2DNode(g,d,this);e=b.VertexData.CreatePlane({width:e.width,
height:e.height,sideOrientation:f&&f.sideOrientation||b.Mesh.DEFAULTSIDE});d=new b.StandardMaterial(g+"_Material",d);this.applyCachedTexture(e,d);e.applyToMesh(m,!1);d.specularColor=new b.Color3(0,0,0);d.disableLighting=!0;d.useAlphaFromDiffuseTexture=!0;m.position=f&&f.worldPosition||b.Vector3.Zero();m.rotationQuaternion=f&&f.worldRotation||b.Quaternion.Identity();m.material=d;this._worldSpaceNode=m}else this._worldSpaceNode=f.customWorldSpaceNode,this.applyCachedTexture(null,null)},e=(__extends(m,
c),m=__decorate([b.className("WorldSpaceCanvas2D")],m));b.WorldSpaceCanvas2D=e;m=function(d,e){b.Prim2DBase._isCanvasInit=!0;c.call(this,d,e)};e=(__extends(m,c),m=__decorate([b.className("ScreenSpaceCanvas2D")],m));b.ScreenSpaceCanvas2D=e}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.Mesh;f=function(b,d,f){e.call(this,b,d);this._canvas=f};f=(__extends(f,e),f.prototype.dispose=function(){e.prototype.dispose.call(this);this._canvas&&(this._canvas.dispose(),this._canvas=null)},f);b.WorldSpaceCanvas2DNode=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(){this.layoutDirtyOnPropertyChangedMask=0};f=(e.prototype.updateLayout=function(){},Object.defineProperty(e.prototype,"isChildPositionAllowed",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype.isLocked=function(){return this._isLocked},e.prototype.lock=function(){return this._isLocked?!1:(this._isLocked=!0,!0)},e=__decorate([b.className("LayoutEngineBase")],e));b.LayoutEngineBase=f;var c=function(){f.apply(this,arguments)},e=(__extends(c,f),c.prototype.updateLayout=
function(c){if(c._isFlagSet(b.SmartPropertyPrim.flagLayoutDirty)){for(var d=0,e=c.children;d<e.length;d++)this._doUpdate(e[d]);c._clearFlags(b.SmartPropertyPrim.flagLayoutDirty)}},c.prototype._doUpdate=function(c){c instanceof b.Canvas2D?c.layoutArea=c.actualSize:c.parent instanceof b.Canvas2D?c.layoutArea=c.owner.actualSize:c.layoutArea=c.parent.contentArea},Object.defineProperty(c.prototype,"isChildPositionAllowed",{get:function(){return!0},enumerable:!0,configurable:!0}),c.Singleton=new c,c=__decorate([b.className("CanvasLayoutEngine")],
c));b.CanvasLayoutEngine=e;var d=function(){f.call(this);this._isHorizontal=!0;this.layoutDirtyOnPropertyChangedMask=b.Prim2DBase.sizeProperty.flagId},e=(__extends(d,f),Object.defineProperty(d,"Horizontal",{get:function(){return d._horizontal||(d._horizontal=new d,d._horizontal.isHorizontal=!0,d._horizontal.lock()),d._horizontal},enumerable:!0,configurable:!0}),Object.defineProperty(d,"Vertical",{get:function(){return d._vertical||(d._vertical=new d,d._vertical.isHorizontal=!1,d._vertical.lock()),
d._vertical},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"isHorizontal",{get:function(){return this._isHorizontal},set:function(b){this.isLocked()||(this._isHorizontal=b)},enumerable:!0,configurable:!0}),d.prototype.updateLayout=function(c){if(c._isFlagSet(b.SmartPropertyPrim.flagLayoutDirty)){for(var d=0,e=0,f=this.isHorizontal,n=0,q=0,p=c.children;q<p.length;q++){var r=p[q],t=r.layoutArea;r.margin.computeArea(r.actualSize,t);n=Math.max(n,f?t.height:t.width)}q=0;for(p=c.children;q<
p.length;q++)r=p[q],r.layoutAreaPos=new b.Vector2(d,e),t=r.layoutArea,f?(d+=t.width,r.layoutArea=new b.Size(t.width,n)):(e+=t.height,r.layoutArea=new b.Size(n,t.height));c._clearFlags(b.SmartPropertyPrim.flagLayoutDirty)}},Object.defineProperty(d.prototype,"isChildPositionAllowed",{get:function(){return!1},enumerable:!0,configurable:!0}),d._horizontal=null,d._vertical=null,d=__decorate([b.className("StackPanelLayoutEngine")],d));b.StackPanelLayoutEngine=e}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.Material,c=function(c,f,m,j){e.call(this,c,f);this._textures={};this._floats={};this._floatsArrays={};this._colors3={};this._colors4={};this._vectors2={};this._vectors3={};this._vectors4={};this._matrices={};this._matrices3x3={};this._matrices2x2={};this._cachedWorldViewMatrix=new b.Matrix;this._shaderPath=m;j.needAlphaBlending=j.needAlphaBlending||!1;j.needAlphaTesting=j.needAlphaTesting||!1;j.attributes=j.attributes||["position","normal","uv"];j.uniforms=j.uniforms||["worldViewProjection"];
j.samplers=j.samplers||[];j.defines=j.defines||[];this._options=j};f=(__extends(c,e),c.prototype.needAlphaBlending=function(){return this._options.needAlphaBlending},c.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},c.prototype._checkUniform=function(b){-1===this._options.uniforms.indexOf(b)&&this._options.uniforms.push(b)},c.prototype.setTexture=function(b,c){return-1===this._options.samplers.indexOf(b)&&this._options.samplers.push(b),this._textures[b]=c,this},c.prototype.setFloat=
function(b,c){return this._checkUniform(b),this._floats[b]=c,this},c.prototype.setFloats=function(b,c){return this._checkUniform(b),this._floatsArrays[b]=c,this},c.prototype.setColor3=function(b,c){return this._checkUniform(b),this._colors3[b]=c,this},c.prototype.setColor4=function(b,c){return this._checkUniform(b),this._colors4[b]=c,this},c.prototype.setVector2=function(b,c){return this._checkUniform(b),this._vectors2[b]=c,this},c.prototype.setVector3=function(b,c){return this._checkUniform(b),this._vectors3[b]=
c,this},c.prototype.setVector4=function(b,c){return this._checkUniform(b),this._vectors4[b]=c,this},c.prototype.setMatrix=function(b,c){return this._checkUniform(b),this._matrices[b]=c,this},c.prototype.setMatrix3x3=function(b,c){return this._checkUniform(b),this._matrices3x3[b]=c,this},c.prototype.setMatrix2x2=function(b,c){return this._checkUniform(b),this._matrices2x2[b]=c,this},c.prototype.isReady=function(c,e){var f=this.getScene(),j=f.getEngine();if(!this.checkReadyOnEveryCall&&this._renderId===
f.getRenderId())return!0;var l=[],n=new b.EffectFallbacks;e&&l.push("#define INSTANCES");for(var q=0;q<this._options.defines.length;q++)l.push(this._options.defines[q]);c&&c.useBones&&c.computeBonesUsingShaders&&(l.push("#define NUM_BONE_INFLUENCERS "+c.numBoneInfluencers),l.push("#define BonesPerMesh "+(c.skeleton.bones.length+1)),n.addCPUSkinningFallback(0,c));j.getAlphaTesting()&&l.push("#define ALPHATEST");q=this._effect;l=l.join("\n");return this._effect=j.createEffect(this._shaderPath,this._options.attributes,
this._options.uniforms,this._options.samplers,l,n,this.onCompiled,this.onError),this._effect.isReady()?(q!==this._effect&&f.resetCachedMaterial(),this._renderId=f.getRenderId(),!0):!1},c.prototype.bindOnlyWorldMatrix=function(b){var c=this.getScene();-1!==this._options.uniforms.indexOf("world")&&this._effect.setMatrix("world",b);-1!==this._options.uniforms.indexOf("worldView")&&(b.multiplyToRef(c.getViewMatrix(),this._cachedWorldViewMatrix),this._effect.setMatrix("worldView",this._cachedWorldViewMatrix));
-1!==this._options.uniforms.indexOf("worldViewProjection")&&this._effect.setMatrix("worldViewProjection",b.multiply(c.getTransformMatrix()))},c.prototype.bind=function(b,c){if(this.bindOnlyWorldMatrix(b),this.getScene().getCachedMaterial()!==this){-1!==this._options.uniforms.indexOf("view")&&this._effect.setMatrix("view",this.getScene().getViewMatrix());-1!==this._options.uniforms.indexOf("projection")&&this._effect.setMatrix("projection",this.getScene().getProjectionMatrix());-1!==this._options.uniforms.indexOf("viewProjection")&&
this._effect.setMatrix("viewProjection",this.getScene().getTransformMatrix());c&&c.useBones&&c.computeBonesUsingShaders&&this._effect.setMatrices("mBones",c.skeleton.getTransformMatrices(c));for(var f in this._textures)this._effect.setTexture(f,this._textures[f]);for(f in this._floats)this._effect.setFloat(f,this._floats[f]);for(f in this._floatsArrays)this._effect.setArray(f,this._floatsArrays[f]);for(f in this._colors3)this._effect.setColor3(f,this._colors3[f]);for(f in this._colors4){var j=this._colors4[f];
this._effect.setFloat4(f,j.r,j.g,j.b,j.a)}for(f in this._vectors2)this._effect.setVector2(f,this._vectors2[f]);for(f in this._vectors3)this._effect.setVector3(f,this._vectors3[f]);for(f in this._vectors4)this._effect.setVector4(f,this._vectors4[f]);for(f in this._matrices)this._effect.setMatrix(f,this._matrices[f]);for(f in this._matrices3x3)this._effect.setMatrix3x3(f,this._matrices3x3[f]);for(f in this._matrices2x2)this._effect.setMatrix2x2(f,this._matrices2x2[f])}e.prototype.bind.call(this,b,c)},
c.prototype.clone=function(b){return new c(b,this.getScene(),this._shaderPath,this._options)},c.prototype.dispose=function(b,c){if(c)for(var f in this._textures)this._textures[f].dispose();this._textures={};e.prototype.dispose.call(this,b,c)},c.prototype.serialize=function(){var c=b.SerializationHelper.Serialize(this);c.customType="BABYLON.ShaderMaterial";c.options=this._options;c.shaderPath=this._shaderPath;c.textures={};for(var e in this._textures)c.textures[e]=this._textures[e].serialize();c.floats=
{};for(e in this._floats)c.floats[e]=this._floats[e];c.floatArrays={};for(e in this._floatsArrays)c.floatArrays[e]=this._floatsArrays[e];c.colors3={};for(e in this._colors3)c.colors3[e]=this._colors3[e].asArray();c.colors4={};for(e in this._colors4)c.colors4[e]=this._colors4[e].asArray();c.vectors2={};for(e in this._vectors2)c.vectors2[e]=this._vectors2[e].asArray();c.vectors3={};for(e in this._vectors3)c.vectors3[e]=this._vectors3[e].asArray();c.vectors4={};for(e in this._vectors4)c.vectors4[e]=
this._vectors4[e].asArray();c.matrices={};for(e in this._matrices)c.matrices[e]=this._matrices[e].asArray();c.matrices3x3={};for(e in this._matrices3x3)c.matrices3x3[e]=this._matrices3x3[e];c.matrices2x2={};for(e in this._matrices2x2)c.matrices2x2[e]=this._matrices2x2[e];return c},c.Parse=function(d,e,f){var j=b.SerializationHelper.Parse(function(){return new c(d.name,e,d.shaderPath,d.options)},d,e,f),l;for(l in d.textures)j.setTexture(l,b.Texture.Parse(d.textures[l],e,f));for(l in d.floats)j.setFloat(l,
d.floats[l]);for(l in d.floatsArrays)j.setFloats(l,d.floatsArrays[l]);for(l in d.colors3)j.setColor3(l,b.Color3.FromArray(d.colors3[l]));for(l in d.colors4)j.setColor4(l,b.Color4.FromArray(d.colors4[l]));for(l in d.vectors2)j.setVector2(l,b.Vector2.FromArray(d.vectors2[l]));for(l in d.vectors3)j.setVector3(l,b.Vector3.FromArray(d.vectors3[l]));for(l in d.vectors4)j.setVector4(l,b.Vector4.FromArray(d.vectors4[l]));for(l in d.matrices)j.setMatrix(l,b.Matrix.FromArray(d.matrices[l]));for(l in d.matrices3x3)j.setMatrix3x3(l,
d.matrices3x3[l]);for(l in d.matrices2x2)j.setMatrix2x2(l,d.matrices2x2[l]);return j},c);b.ShaderMaterial=f}(BABYLON||(BABYLON={}));
!function(b){var f=b.Internals||(b.Internals={}),e=function(b){return b.charCodeAt(0)+(b.charCodeAt(1)<<8)+(b.charCodeAt(2)<<16)+(b.charCodeAt(3)<<24)},c=e("DXT1"),d=e("DXT3"),g=e("DXT5"),m=function(){},e=(m.GetDDSInfo=function(b){b=new Int32Array(b,0,31);var c=1;return b[2]&131072&&(c=Math.max(1,b[7])),{width:b[4],height:b[3],mipmapCount:c,isFourCC:4===(b[20]&4),isRGB:64===(b[20]&64),isLuminance:131072===(b[20]&131072),isCube:512===(b[28]&512)}},m.GetRGBAArrayBuffer=function(b,c,d,e,f){e=new Uint8Array(e);
f=new Uint8Array(f);var g=0;for(c-=1;0<=c;c--)for(var m=0;b>m;m++){var s=d+4*(m+c*b);e[g+2]=f[s];e[g+1]=f[s+1];e[g]=f[s+2];e[g+3]=f[s+3];g+=4}return e},m.GetRGBArrayBuffer=function(b,c,d,e,f){e=new Uint8Array(e);f=new Uint8Array(f);var g=0;for(c-=1;0<=c;c--)for(var m=0;b>m;m++){var s=d+3*(m+c*b);e[g+2]=f[s];e[g+1]=f[s+1];e[g]=f[s+2];g+=3}return e},m.GetLuminanceArrayBuffer=function(b,c,d,e,f){e=new Uint8Array(e);f=new Uint8Array(f);var g=0;for(c-=1;0<=c;c--)for(var m=0;b>m;m++)e[g]=f[d+(m+c*b)],g++;
return e},m.UploadDDSLevels=function(e,f,n,q,p,r){var t,s,u,x,y,z,A,B=new Int32Array(n,0,31);if(542327876!=B[0])return void b.Tools.Error("Invalid magic number in DDS header");if(!q.isFourCC&&!q.isRGB&&!q.isLuminance)return void b.Tools.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(q.isFourCC)switch(t=B[21]){case c:t=8;s=f.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case d:t=16;s=f.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case g:t=16;s=f.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return void console.error("Unsupported FourCC code:",
String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255))}f=1;B[2]&131072&&!1!==p&&(f=Math.max(1,B[7]));for(var C=B[22],D=0;r>D;D++){var E=1===r?e.TEXTURE_2D:e.TEXTURE_CUBE_MAP_POSITIVE_X+D;p=B[4];u=B[3];y=B[1]+4;for(A=0;f>A;++A)q.isRGB?24===C?(x=3*p*u,z=m.GetRGBArrayBuffer(p,u,y,x,n),e.texImage2D(E,A,e.RGB,p,u,0,e.RGB,e.UNSIGNED_BYTE,z)):(x=4*p*u,z=m.GetRGBAArrayBuffer(p,u,y,x,n),e.texImage2D(E,A,e.RGBA,p,u,0,e.RGBA,e.UNSIGNED_BYTE,z)):q.isLuminance?(x=e.getParameter(e.UNPACK_ALIGNMENT),x=Math.floor((p+
x-1)/x)*x*(u-1)+p,z=m.GetLuminanceArrayBuffer(p,u,y,x,n),e.texImage2D(E,A,e.LUMINANCE,p,u,0,e.LUMINANCE,e.UNSIGNED_BYTE,z)):(x=Math.max(4,p)/4*Math.max(4,u)/4*t,z=new Uint8Array(n,y,x),e.compressedTexImage2D(E,A,s,p,u,0,z)),y+=x,p*=0.5,u*=0.5,p=Math.max(1,p),u=Math.max(1,u)}},m);f.DDSTools=e;!0}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(e,c){return void 0===e&&(e=!0),void 0===c&&(c=10),this._useDeltaForWorldStep=e,this.name="CannonJSPlugin",this._physicsMaterials=[],this._fixedTimeStep=1/60,this._currentCollisionGroup=2,this._minus90X=new b.Quaternion(-0.7071067811865475,0,0,0.7071067811865475),this._plus90X=new b.Quaternion(0.7071067811865475,0,0,0.7071067811865475),this._tmpPosition=b.Vector3.Zero(),this._tmpQuaternion=new b.Quaternion,this._tmpDeltaPosition=b.Vector3.Zero(),this._tmpDeltaRotation=
new b.Quaternion,this._tmpUnityRotation=new b.Quaternion,this.isSupported()?(this.world=new CANNON.World,this.world.broadphase=new CANNON.NaiveBroadphase,void(this.world.solver.iterations=c)):void b.Tools.Error("CannonJS is not available. Please make sure you included the js file.")};f=(f.prototype.setGravity=function(b){this.world.gravity.copy(b)},f.prototype.setTimeStep=function(b){this._fixedTimeStep=b},f.prototype.executeStep=function(b){this.world.step(this._fixedTimeStep,this._useDeltaForWorldStep?
1E3*b:0,3)},f.prototype.applyImpulse=function(b,c,d){d=new CANNON.Vec3(d.x,d.y,d.z);c=new CANNON.Vec3(c.x,c.y,c.z);b.physicsBody.applyImpulse(c,d)},f.prototype.applyForce=function(b,c,d){d=new CANNON.Vec3(d.x,d.y,d.z);c=new CANNON.Vec3(c.x,c.y,c.z);b.physicsBody.applyImpulse(c,d)},f.prototype.generatePhysicsBody=function(b){if(b.parent)return void(b.physicsBody&&(this.removePhysicsBody(b),b.forceUpdate()));if(b.isBodyInitRequired()){var c=this._createShape(b),d=b.physicsBody;d&&this.removePhysicsBody(b);
var f=this._addMaterial("mat-"+b.uniqueId,b.getParam("friction"),b.getParam("restitution")),f={mass:b.getParam("mass"),material:f},m=b.getParam("nativeOptions"),j;for(j in m)m.hasOwnProperty(j)&&(f[j]=m[j]);b.physicsBody=new CANNON.Body(f);b.physicsBody.addEventListener("collide",b.onCollide);this.world.addEventListener("preStep",b.beforeStep);this.world.addEventListener("postStep",b.afterStep);b.physicsBody.addShape(c);this.world.add(b.physicsBody);d&&["force","torque","velocity","angularVelocity"].forEach(function(c){b.physicsBody[c].copy(d[c])});
this._processChildMeshes(b)}this._updatePhysicsBodyTransformation(b)},f.prototype._processChildMeshes=function(e){var c=this,d=e.object.getChildMeshes?e.object.getChildMeshes():[];if(d.length){var f=function(b,d){var l=d.getPhysicsImpostor();l&&l.parent!==e&&(b=d.position,l.physicsBody&&(c.removePhysicsBody(l),l.physicsBody=null),l.parent=e,l.resetUpdateFlags(),e.physicsBody.addShape(c._createShape(l),new CANNON.Vec3(b.x,b.y,b.z)),e.physicsBody.mass+=l.getParam("mass"));d.getChildMeshes().forEach(f.bind(c,
d.position))};d.forEach(f.bind(this,b.Vector3.Zero()))}},f.prototype.removePhysicsBody=function(b){b.physicsBody.removeEventListener("collide",b.onCollide);this.world.removeEventListener("preStep",b.beforeStep);this.world.removeEventListener("postStep",b.afterStep);this.world.remove(b.physicsBody)},f.prototype.generateJoint=function(e){var c=e.mainImpostor.physicsBody,d=e.connectedImpostor.physicsBody;if(c&&d){var f,m=e.joint.jointData,j={pivotA:m.mainPivot?(new CANNON.Vec3).copy(m.mainPivot):null,
pivotB:m.connectedPivot?(new CANNON.Vec3).copy(m.connectedPivot):null,axisA:m.mainAxis?(new CANNON.Vec3).copy(m.mainAxis):null,axisB:m.connectedAxis?(new CANNON.Vec3).copy(m.connectedAxis):null,maxForce:m.nativeParams.maxForce,collideConnected:!!m.collision};switch(e.joint.type){case b.PhysicsJoint.HingeJoint:case b.PhysicsJoint.Hinge2Joint:f=new CANNON.HingeConstraint(c,d,j);break;case b.PhysicsJoint.DistanceJoint:f=new CANNON.DistanceConstraint(c,d,m.maxDistance||2);break;case b.PhysicsJoint.SpringJoint:f=
new CANNON.Spring(c,d,{restLength:m.length,stiffness:m.stiffness,damping:m.damping,localAnchorA:j.pivotA,localAnchorB:j.pivotB});break;case b.PhysicsJoint.LockJoint:f=new CANNON.LockConstraint(c,d,j);break;default:f=new CANNON.PointToPointConstraint(c,j.pivotA,d,j.pivotA,j.maxForce)}f.collideConnected=!!m.collision;e.joint.physicsJoint=f;e.joint.type!==b.PhysicsJoint.SpringJoint?this.world.addConstraint(f):e.mainImpostor.registerAfterPhysicsStep(function(){f.applyForce()})}},f.prototype.removeJoint=
function(b){this.world.removeConstraint(b.joint.physicsJoint)},f.prototype._addMaterial=function(b,c,d){var f,m;for(f=0;f<this._physicsMaterials.length;f++)if(m=this._physicsMaterials[f],m.friction===c&&m.restitution===d)return m;b=new CANNON.Material(b);return b.friction=c,b.restitution=d,this._physicsMaterials.push(b),b},f.prototype._checkWithEpsilon=function(e){return e<b.PhysicsEngine.Epsilon?b.PhysicsEngine.Epsilon:e},f.prototype._createShape=function(e){var c,d=e.object,f=e.getObjectExtendSize();
switch(e.type){case b.PhysicsEngine.SphereImpostor:d=f.y;e=f.z;c=new CANNON.Sphere(Math.max(this._checkWithEpsilon(f.x),this._checkWithEpsilon(d),this._checkWithEpsilon(e))/2);break;case b.PhysicsImpostor.CylinderImpostor:c=new CANNON.Cylinder(this._checkWithEpsilon(f.x)/2,this._checkWithEpsilon(f.x)/2,this._checkWithEpsilon(f.y),16);break;case b.PhysicsImpostor.BoxImpostor:f=f.scale(0.5);c=new CANNON.Box(new CANNON.Vec3(this._checkWithEpsilon(f.x),this._checkWithEpsilon(f.y),this._checkWithEpsilon(f.z)));
break;case b.PhysicsImpostor.PlaneImpostor:b.Tools.Warn("Attention, PlaneImposter might not behave as you expect. Consider using BoxImposter instead");c=new CANNON.Plane;break;case b.PhysicsImpostor.MeshImpostor:f=d.getVerticesData?d.getVerticesData(b.VertexBuffer.PositionKind):[];d=d.getIndices?d.getIndices():[];b.Tools.Warn("MeshImpostor only collides against spheres.");c=new CANNON.Trimesh(f,d);break;case b.PhysicsImpostor.HeightmapImpostor:c=this._createHeightmap(d);break;case b.PhysicsImpostor.ParticleImpostor:c=
new CANNON.Particle}return c},f.prototype._createHeightmap=function(e,c){for(var d=e.getVerticesData(b.VertexBuffer.PositionKind),f=[],m=c||~~(Math.sqrt(d.length/3)-1),j=2*Math.min(e.getBoundingInfo().boundingBox.extendSize.x,e.getBoundingInfo().boundingBox.extendSize.z)/m,l=e.getBoundingInfo().boundingBox.extendSize.y,n=0;n<d.length;n+=3){var q=Math.round(d[n+0]/j+m/2),p=Math.round(-1*(d[n+2]/j-m/2)),r=d[n+1]+l;f[q]||(f[q]=[]);f[q][p]||(f[q][p]=r);f[q][p]=Math.max(r,f[q][p])}for(q=0;m>=q;++q){if(!f[q]){for(d=
1;!f[(q+d)%m];)d++;f[q]=f[(q+d)%m].slice()}for(p=0;m>=p;++p)if(!f[q][p]){for(var t,d=1;void 0===t;)t=f[q][(p+d++)%m];f[q][p]=t}}f=new CANNON.Heightfield(f,{elementSize:j});return f.minY=l,f},f.prototype._updatePhysicsBodyTransformation=function(e){var c=e.object;c.computeWorldMatrix&&c.computeWorldMatrix(!0);var d=e.getObjectCenter();e.getObjectExtendSize();this._tmpDeltaPosition.copyFrom(c.position.subtract(d));this._tmpPosition.copyFrom(d);var f=c.rotationQuaternion;if(e.type!==b.PhysicsImpostor.PlaneImpostor&&
e.type!==b.PhysicsImpostor.HeightmapImpostor&&e.type!==b.PhysicsImpostor.CylinderImpostor||(f=f.multiply(this._minus90X),e.setDeltaRotation(this._plus90X)),e.type===b.PhysicsEngine.HeightmapImpostor){var m=c.rotationQuaternion;c.rotationQuaternion=this._tmpUnityRotation;c.computeWorldMatrix(!0);var j=d.clone(),l=c.getPivotMatrix()||b.Matrix.Translation(0,0,0);c.rotationQuaternion=m;m=b.Matrix.Translation(c.getBoundingInfo().boundingBox.extendSize.x,0,-c.getBoundingInfo().boundingBox.extendSize.z);
c.setPivotMatrix(m);c.computeWorldMatrix(!0);d=c.getBoundingInfo().boundingBox.center.subtract(d).subtract(c.position).negate();this._tmpPosition.copyFromFloats(d.x,d.y-c.getBoundingInfo().boundingBox.extendSize.y,d.z);this._tmpDeltaPosition.copyFrom(c.getBoundingInfo().boundingBox.center.subtract(j));this._tmpDeltaPosition.y+=c.getBoundingInfo().boundingBox.extendSize.y;c.setPivotMatrix(l);c.computeWorldMatrix(!0)}else e.type===b.PhysicsEngine.MeshImpostor&&(this._tmpDeltaPosition.copyFromFloats(0,
0,0),this._tmpPosition.copyFrom(c.position));e.setDeltaPosition(this._tmpDeltaPosition);e.physicsBody.position.copy(this._tmpPosition);e.physicsBody.quaternion.copy(f)},f.prototype.setTransformationFromPhysicsBody=function(b){b.object.position.copyFrom(b.physicsBody.position);b.object.rotationQuaternion.copyFrom(b.physicsBody.quaternion)},f.prototype.setPhysicsBodyTransformation=function(b,c,d){b.physicsBody.position.copy(c);b.physicsBody.quaternion.copy(d)},f.prototype.isSupported=function(){return void 0!==
window.CANNON},f.prototype.setLinearVelocity=function(b,c){b.physicsBody.velocity.copy(c)},f.prototype.setAngularVelocity=function(b,c){b.physicsBody.angularVelocity.copy(c)},f.prototype.getLinearVelocity=function(e){return(e=e.physicsBody.velocity)?new b.Vector3(e.x,e.y,e.z):null},f.prototype.getAngularVelocity=function(e){return(e=e.physicsBody.angularVelocity)?new b.Vector3(e.x,e.y,e.z):null},f.prototype.setBodyMass=function(b,c){b.physicsBody.mass=c;b.physicsBody.updateMassProperties()},f.prototype.sleepBody=
function(b){b.physicsBody.sleep()},f.prototype.wakeUpBody=function(b){b.physicsBody.wakeUp()},f.prototype.updateDistanceJoint=function(b,c){b.physicsJoint.distance=c},f.prototype.enableMotor=function(b,c){c||b.physicsJoint.enableMotor()},f.prototype.disableMotor=function(b,c){c||b.physicsJoint.disableMotor()},f.prototype.setMotor=function(b,c,d,f){f||(b.physicsJoint.enableMotor(),b.physicsJoint.setMotorSpeed(c),d&&this.setLimit(b,d))},f.prototype.setLimit=function(b,c,d){b.physicsJoint.motorEquation.maxForce=
c;b.physicsJoint.motorEquation.minForce=void 0===d?-c:d},f.prototype.dispose=function(){},f);b.CannonJSPlugin=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(e){this.name="OimoJSPlugin";this._tmpImpostorsArray=[];this._tmpPositionVector=b.Vector3.Zero();this.world=new OIMO.World(1/60,2,e,!0);this.world.clear();this.world.isNoStat=!0};f=(f.prototype.setGravity=function(b){this.world.gravity.copy(b)},f.prototype.setTimeStep=function(b){this.world.timeStep=b},f.prototype.executeStep=function(b,c){var d=this;c.forEach(function(b){b.beforeStep()});this.world.step();c.forEach(function(b){b.afterStep();d._tmpImpostorsArray[b.uniqueId]=
b});for(var f=this.world.contacts;null!==f;)if(!f.touching||f.body1.sleeping||f.body2.sleeping){var m=this._tmpImpostorsArray[+f.body1.name],j=this._tmpImpostorsArray[+f.body2.name];m&&j?(m.onCollide({body:j.physicsBody}),j.onCollide({body:m.physicsBody}),f=f.next):f=f.next}else f=f.next},f.prototype.applyImpulse=function(b,c,d){var f=b.physicsBody.massInfo.mass;b.physicsBody.applyImpulse(d.scale(OIMO.INV_SCALE),c.scale(OIMO.INV_SCALE*f))},f.prototype.applyForce=function(e,c,d){b.Tools.Warn("Oimo doesn't support applying force. Using impule instead.");
this.applyImpulse(e,c,d)},f.prototype.generatePhysicsBody=function(e){function c(c){return Math.max(c,b.PhysicsEngine.Epsilon)}var d=this;if(e.parent)return void(e.physicsBody&&(this.removePhysicsBody(e),e.forceUpdate()));if(e.isBodyInitRequired()){var f={name:e.uniqueId,config:[e.getParam("mass")||1,e.getParam("friction"),e.getParam("restitution")],size:[],type:[],pos:[],rot:[],move:0!==e.getParam("mass"),world:this.world},m=[e],j=e.object;j.getChildMeshes&&j.getChildMeshes().forEach(function(b){b.physicsImpostor&&
(m.push(b.physicsImpostor),b.physicsImpostor._init())});m.forEach(function(j){var m=j.object.rotationQuaternion,q=(new OIMO.Euler).setFromQuaternion({x:e.object.rotationQuaternion.x,y:e.object.rotationQuaternion.y,z:e.object.rotationQuaternion.z,s:e.object.rotationQuaternion.w}),p=j.getObjectExtendSize();if(j===e){var r=e.getObjectCenter();e.object.position.subtractToRef(r,d._tmpPositionVector);f.pos.push(r.x);f.pos.push(r.y);f.pos.push(r.z);f.rot.push(q.x/(OIMO.degtorad||OIMO.TO_RAD));f.rot.push(q.y/
(OIMO.degtorad||OIMO.TO_RAD));f.rot.push(q.z/(OIMO.degtorad||OIMO.TO_RAD))}else f.pos.push(j.object.position.x),f.pos.push(j.object.position.y),f.pos.push(j.object.position.z),f.rot.push(0),f.rot.push(0),f.rot.push(0);switch(j.type){case b.PhysicsImpostor.ParticleImpostor:b.Tools.Warn("No Particle support in Oimo.js. using SphereImpostor instead");case b.PhysicsImpostor.SphereImpostor:q=p.y;r=p.z;p=Math.max(c(p.x),c(q),c(r))/2;f.type.push("sphere");f.size.push(p);f.size.push(p);f.size.push(p);break;
case b.PhysicsImpostor.CylinderImpostor:q=c(p.x)/2;r=c(p.y);f.type.push("cylinder");f.size.push(q);f.size.push(r);f.size.push(r);break;default:q=c(p.x),r=c(p.y),p=c(p.z),f.type.push("box"),f.size.push(q),f.size.push(r),f.size.push(p)}j.object.rotationQuaternion=m});e.physicsBody=(new OIMO.Body(f)).body}else this._tmpPositionVector.copyFromFloats(0,0,0);e.setDeltaPosition(this._tmpPositionVector)},f.prototype.removePhysicsBody=function(b){this.world.removeRigidBody(b.physicsBody)},f.prototype.generateJoint=
function(e){var c=e.mainImpostor.physicsBody,d=e.connectedImpostor.physicsBody;if(c&&d){var f=e.joint.jointData,m=f.nativeParams||{},d={body1:c,body2:d,axe1:m.axe1||(f.mainAxis?f.mainAxis.asArray():null),axe2:m.axe2||(f.connectedAxis?f.connectedAxis.asArray():null),pos1:m.pos1||(f.mainPivot?f.mainPivot.asArray():null),pos2:m.pos2||(f.connectedPivot?f.connectedPivot.asArray():null),min:m.min,max:m.max,collision:m.collision||f.collision,spring:m.spring,world:this.world};switch(e.joint.type){case b.PhysicsJoint.BallAndSocketJoint:c=
"jointBall";break;case b.PhysicsJoint.SpringJoint:b.Tools.Warn("Oimo.js doesn't support Spring Constraint. Simulating using DistanceJoint instead"),d.min=f.length||d.min,d.max=Math.max(d.min,d.max);case b.PhysicsJoint.DistanceJoint:c="jointDistance";d.max=f.maxDistance;break;case b.PhysicsJoint.PrismaticJoint:c="jointPrisme";break;case b.PhysicsJoint.SliderJoint:c="jointSlide";break;case b.PhysicsJoint.WheelJoint:c="jointWheel";break;default:c="jointHinge"}d.type=c;e.joint.physicsJoint=(new OIMO.Link(d)).joint}},
f.prototype.removeJoint=function(e){try{this.world.removeJoint(e.joint.physicsJoint)}catch(c){b.Tools.Warn(c)}},f.prototype.isSupported=function(){return void 0!==OIMO},f.prototype.setTransformationFromPhysicsBody=function(b){if(!b.physicsBody.sleeping){if(b.physicsBody.shapes.next){var c=this._getLastShape(b.physicsBody);b.object.position.x=c.position.x*OIMO.WORLD_SCALE;b.object.position.y=c.position.y*OIMO.WORLD_SCALE;b.object.position.z=c.position.z*OIMO.WORLD_SCALE}else b.object.position.copyFrom(b.physicsBody.getPosition());
b.object.rotationQuaternion.copyFrom(b.physicsBody.getQuaternion());b.object.rotationQuaternion.normalize()}},f.prototype.setPhysicsBodyTransformation=function(b,c,d){b=b.physicsBody;b.position.init(c.x*OIMO.INV_SCALE,c.y*OIMO.INV_SCALE,c.z*OIMO.INV_SCALE);b.orientation.init(d.w,d.x,d.y,d.z);b.syncShapes();b.awake()},f.prototype._getLastShape=function(b){for(b=b.shapes;b.next;)b=b.next;return b},f.prototype.setLinearVelocity=function(b,c){b.physicsBody.linearVelocity.init(c.x,c.y,c.z)},f.prototype.setAngularVelocity=
function(b,c){b.physicsBody.angularVelocity.init(c.x,c.y,c.z)},f.prototype.getLinearVelocity=function(e){return(e=e.physicsBody.linearVelocity)?new b.Vector3(e.x,e.y,e.z):null},f.prototype.getAngularVelocity=function(e){return(e=e.physicsBody.angularVelocity)?new b.Vector3(e.x,e.y,e.z):null},f.prototype.setBodyMass=function(b,c){var d=0===c;b.physicsBody.shapes.density=d?1:c;b.physicsBody.setupMass(d?2:1)},f.prototype.sleepBody=function(b){b.physicsBody.sleep()},f.prototype.wakeUpBody=function(b){b.physicsBody.awake()},
f.prototype.updateDistanceJoint=function(b,c,d){b.physicsJoint.limitMotoe.upperLimit=c;void 0!==d&&(b.physicsJoint.limitMotoe.lowerLimit=d)},f.prototype.setMotor=function(b,c,d,f){(b=f?b.physicsJoint.rotationalLimitMotor2:b.physicsJoint.rotationalLimitMotor1||b.physicsJoint.rotationalLimitMotor||b.physicsJoint.limitMotor)&&b.setMotor(c,d)},f.prototype.setLimit=function(b,c,d,f){(b=f?b.physicsJoint.rotationalLimitMotor2:b.physicsJoint.rotationalLimitMotor1||b.physicsJoint.rotationalLimitMotor||b.physicsJoint.limitMotor)&&
b.setLimit(c,void 0===d?-c:d)},f.prototype.dispose=function(){this.world.clear()},f);b.OimoJSPlugin=f}(BABYLON||(BABYLON={}));!function(b){var f,e=b.PostProcess;f=function(b,d,f,m,j,l){e.call(this,b,"displayPass",["passSampler"],["passSampler"],d,f,m,j,l)};f=(__extends(f,e),f);b.DisplayPassPostProcess=f}(BABYLON||(BABYLON={}));
!function(b){b.SimplificationSettings=function(b,c,d){this.quality=b;this.distance=c;this.optimizeMesh=d};var f;f=function(){this.running=!1;this._simplificationArray=[]};f=(f.prototype.addTask=function(b){this._simplificationArray.push(b)},f.prototype.executeNext=function(){var b=this._simplificationArray.pop();b?(this.running=!0,this.runSimplification(b)):this.running=!1},f.prototype.runSimplification=function(c){var d=this;if(c.parallelProcessing)c.settings.forEach(function(b){d.getSimplifier(c).simplify(b,
function(e){c.mesh.addLODLevel(b.distance,e);e.isVisible=!0;b.quality===c.settings[c.settings.length-1].quality&&c.successCallback&&c.successCallback();d.executeNext()})});else{var e=this.getSimplifier(c);b.AsyncLoop.Run(c.settings.length,function(b){var d=c.settings[b.index];e.simplify(d,function(e){c.mesh.addLODLevel(d.distance,e);e.isVisible=!0;b.executeNext()})},function(){c.successCallback&&c.successCallback();d.executeNext()})}},f.prototype.getSimplifier=function(b){switch(b.simplificationType){default:return new j(b.mesh)}},
f);b.SimplificationQueue=f;f=b.SimplificationType||(b.SimplificationType={});f[f.QUADRATIC=0]="QUADRATIC";var e;e=function(b){this.vertices=b;this.error=Array(4);this.deletePending=this.isDirty=this.deleted=!1;this.borderFactor=0};b.DecimationTriangle=e;var c;f=function(b,c){this.position=b;this.id=c;this.isBorder=!0;this.q=new d;this.triangleStart=this.triangleCount=0;this.originalOffsets=[]};c=(f.prototype.updatePosition=function(b){this.position.copyFrom(b)},f);b.DecimationVertex=c;var d,g=function(b){this.data=
Array(10);for(var c=0;10>c;++c)b&&b[c]?this.data[c]=b[c]:this.data[c]=0};d=(g.prototype.det=function(b,c,d,e,f,g,j,m,x){return this.data[b]*this.data[f]*this.data[x]+this.data[d]*this.data[e]*this.data[m]+this.data[c]*this.data[g]*this.data[j]-this.data[d]*this.data[f]*this.data[j]-this.data[b]*this.data[g]*this.data[m]-this.data[c]*this.data[e]*this.data[x]},g.prototype.addInPlace=function(b){for(var c=0;10>c;++c)this.data[c]+=b.data[c]},g.prototype.addArrayInPlace=function(b){for(var c=0;10>c;++c)this.data[c]+=
b[c]},g.prototype.add=function(b){for(var c=new g,d=0;10>d;++d)c.data[d]=this.data[d]+b.data[d];return c},g.FromData=function(b,c,d,e){return new g(g.DataFromNumbers(b,c,d,e))},g.DataFromNumbers=function(b,c,d,e){return[b*b,b*c,b*d,b*e,c*c,c*d,c*e,d*d,d*e,e*e]},g);b.QuadraticMatrix=d;var m;m=function(b,c){this.vertexId=b;this.triangleId=c};b.Reference=m;var j;f=function(c){this._mesh=c;this.initialized=!1;this.syncIterations=5E3;this.aggressiveness=7;this.decimationIterations=100;this.boundingBoxEpsilon=
b.Epsilon};j=(f.prototype.simplify=function(c,d){var e=this;this.initDecimatedMesh();b.AsyncLoop.Run(this._mesh.subMeshes.length,function(b){e.initWithMesh(b.index,function(){e.runDecimation(c,b.index,function(){b.executeNext()})},c.optimizeMesh)},function(){setTimeout(function(){d(e._reconstructedMesh)},0)})},f.prototype.isTriangleOnBoundingBox=function(b){var c=this,d=0;return b.vertices.forEach(function(b){var e=0;b=b.position;var f=c._mesh.getBoundingInfo().boundingBox;(f.maximum.x-b.x<c.boundingBoxEpsilon||
b.x-f.minimum.x>c.boundingBoxEpsilon)&&++e;f.maximum.y!==b.y&&b.y!==f.minimum.y||++e;f.maximum.z!==b.z&&b.z!==f.minimum.z||++e;1<e&&++d}),1<d&&console.log(b,d),1<d},f.prototype.runDecimation=function(c,d,e){var f=this,g=~~(this.triangles.length*c.quality),j=0,m=this.triangles.length;b.AsyncLoop.Run(this.decimationIterations,function(c){if(g>=m-j)c.breakLoop();else{var d=c.index,e=function(){c.executeNext()};setTimeout(function(){0===d%5&&f.updateMesh(0===d);for(var c=0;c<f.triangles.length;++c)f.triangles[c].isDirty=
!1;var l=1E-9*Math.pow(d+3,f.aggressiveness);b.AsyncLoop.SyncAsyncForLoop(f.triangles.length,f.syncIterations,function(c){var d=f.triangles[~~((f.triangles.length/2+c)%f.triangles.length)];if(d&&!(d.error[3]>l||d.deleted||d.isDirty))for(var e=0;3>e;++e)if(d.error[e]<l){var g=[],m=[];c=d.vertices[e];var n=d.vertices[(e+1)%3];if(!c.isBorder&&!n.isBorder){var q=b.Vector3.Zero(),r=b.Vector3.Zero(),s=b.Vector2.Zero(),u=new b.Color4(0,0,0,1);f.calculateError(c,n,q,r,s,u);r=[];if(!f.isFlipped(c,n,q,g,d.borderFactor,
r)&&!f.isFlipped(n,c,q,m,d.borderFactor,r)&&!(0>g.indexOf(!0)||0>m.indexOf(!0))){var x=[];if(!(r.forEach(function(b){-1===x.indexOf(b)&&(b.deletePending=!0,x.push(b))}),0!==x.length%2)){c.q=n.q.add(c.q);c.updatePosition(q);d=f.references.length;j=f.updateTriangles(c,c,g,j);j=f.updateTriangles(c,n,m,j);g=f.references.length-d;if(g<=c.triangleCount){if(g)for(m=0;g>m;m++)f.references[c.triangleStart+m]=f.references[d+m]}else c.triangleStart=d;c.triangleCount=g;break}}}}},e,function(){return g>=m-j})},
0)}},function(){setTimeout(function(){f.reconstructMesh(d);e()},0)})},f.prototype.initWithMesh=function(d,f,g){var j=this;this.vertices=[];this.triangles=[];var m=this._mesh.getVerticesData(b.VertexBuffer.PositionKind),t=this._mesh.getIndices(),s=this._mesh.subMeshes[d],u=[];b.AsyncLoop.SyncAsyncForLoop(s.verticesCount,this.syncIterations/4>>0,function(d){d+=s.verticesStart;var e=b.Vector3.FromArray(m,3*d),f;a:{if(g)for(f=0;f<j.vertices.length;++f)if(j.vertices[f].position.equals(e)){f=j.vertices[f];
break a}f=null}e=f||new c(e,j.vertices.length);e.originalOffsets.push(d);e.id===j.vertices.length&&j.vertices.push(e);u.push(e.id)},function(){b.AsyncLoop.SyncAsyncForLoop(s.indexCount/3,j.syncIterations,function(b){b=3*(s.indexStart/3+b);var c=new e([j.vertices[u[t[b+0]-s.verticesStart]],j.vertices[u[t[b+1]-s.verticesStart]],j.vertices[u[t[b+2]-s.verticesStart]]]);c.originalOffset=b;j.triangles.push(c)},function(){j.init(f)})})},f.prototype.init=function(c){var e=this;b.AsyncLoop.SyncAsyncForLoop(this.triangles.length,
this.syncIterations,function(c){c=e.triangles[c];c.normal=b.Vector3.Cross(c.vertices[1].position.subtract(c.vertices[0].position),c.vertices[2].position.subtract(c.vertices[0].position)).normalize();for(var f=0;3>f;f++)c.vertices[f].q.addArrayInPlace(d.DataFromNumbers(c.normal.x,c.normal.y,c.normal.z,-b.Vector3.Dot(c.normal,c.vertices[0].position)))},function(){b.AsyncLoop.SyncAsyncForLoop(e.triangles.length,e.syncIterations,function(b){b=e.triangles[b];for(var c=0;3>c;++c)b.error[c]=e.calculateError(b.vertices[c],
b.vertices[(c+1)%3]);b.error[3]=Math.min(b.error[0],b.error[1],b.error[2])},function(){e.initialized=!0;c()})})},f.prototype.reconstructMesh=function(c){var d,e=[];for(d=0;d<this.vertices.length;++d)this.vertices[d].triangleCount=0;var f,g;for(d=0;d<this.triangles.length;++d)if(!this.triangles[d].deleted){f=this.triangles[d];for(g=0;3>g;++g)f.vertices[g].triangleCount=1;e.push(f)}var j=this._reconstructedMesh.getVerticesData(b.VertexBuffer.PositionKind)||[],m=this._reconstructedMesh.getVerticesData(b.VertexBuffer.NormalKind)||
[],u=this._reconstructedMesh.getVerticesData(b.VertexBuffer.UVKind)||[],x=this._reconstructedMesh.getVerticesData(b.VertexBuffer.ColorKind)||[],y=this._mesh.getVerticesData(b.VertexBuffer.NormalKind),z=this._mesh.getVerticesData(b.VertexBuffer.UVKind),A=this._mesh.getVerticesData(b.VertexBuffer.ColorKind),B=0;for(d=0;d<this.vertices.length;++d){var C=this.vertices[d];C.id=B;C.triangleCount&&C.originalOffsets.forEach(function(b){j.push(C.position.x);j.push(C.position.y);j.push(C.position.z);m.push(y[3*
b]);m.push(y[3*b+1]);m.push(y[3*b+2]);z&&z.length?(u.push(z[2*b]),u.push(z[2*b+1])):A&&A.length&&(x.push(A[4*b]),x.push(A[4*b+1]),x.push(A[4*b+2]),x.push(A[4*b+3]));++B})}g=this._reconstructedMesh.getTotalIndices();var D=this._reconstructedMesh.getTotalVertices(),E=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var I=this._reconstructedMesh.getIndices(),H=this._mesh.getIndices();for(d=0;d<e.length;++d)f=e[d],[0,1,2].forEach(function(b){var c=f.vertices[b].originalOffsets.indexOf(H[f.originalOffset+
b]);0>c&&(c=0);I.push(f.vertices[b].id+c+D)});this._reconstructedMesh.setIndices(I);this._reconstructedMesh.setVerticesData(b.VertexBuffer.PositionKind,j);this._reconstructedMesh.setVerticesData(b.VertexBuffer.NormalKind,m);0<u.length&&this._reconstructedMesh.setVerticesData(b.VertexBuffer.UVKind,u);0<x.length&&this._reconstructedMesh.setVerticesData(b.VertexBuffer.ColorKind,x);d=this._mesh.subMeshes[c];0<c&&(this._reconstructedMesh.subMeshes=[],E.forEach(function(c){new b.SubMesh(c.materialIndex,
c.verticesStart,c.verticesCount,c.indexStart,c.indexCount,c.getMesh())}),new b.SubMesh(d.materialIndex,D,B,g,3*e.length,this._reconstructedMesh))},f.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new b.Mesh(this._mesh.name+"Decimated",this._mesh.getScene());this._reconstructedMesh.material=this._mesh.material;this._reconstructedMesh.parent=this._mesh.parent;this._reconstructedMesh.isVisible=!1;this._reconstructedMesh.renderingGroupId=this._mesh.renderingGroupId},f.prototype.isFlipped=
function(c,d,e,f,g,j){for(g=0;g<c.triangleCount;++g){var m=this.triangles[this.references[c.triangleStart+g].triangleId];if(!m.deleted){var u=this.references[c.triangleStart+g].vertexId,x=m.vertices[(u+1)%3],u=m.vertices[(u+2)%3];if(x!==d&&u!==d){x=x.position.subtract(e);x=x.normalize();u=u.position.subtract(e);if(u=u.normalize(),0.999<Math.abs(b.Vector3.Dot(x,u)))return!0;x=b.Vector3.Cross(x,u).normalize();if(f[g]=!1,0.2>b.Vector3.Dot(x,m.normal))return!0}else f[g]=!0,j.push(m)}}return!1},f.prototype.updateTriangles=
function(b,c,d,e){for(var f=0;f<c.triangleCount;++f){var g=this.references[c.triangleStart+f],j=this.triangles[g.triangleId];j.deleted||(d[f]&&j.deletePending?(j.deleted=!0,e++):(j.vertices[g.vertexId]=b,j.isDirty=!0,j.error[0]=this.calculateError(j.vertices[0],j.vertices[1])+j.borderFactor/2,j.error[1]=this.calculateError(j.vertices[1],j.vertices[2])+j.borderFactor/2,j.error[2]=this.calculateError(j.vertices[2],j.vertices[0])+j.borderFactor/2,j.error[3]=Math.min(j.error[0],j.error[1],j.error[2]),
this.references.push(g)))}return e},f.prototype.identifyBorder=function(){for(var b=0;b<this.vertices.length;++b){var c,d=[],e=[],f=this.vertices[b];for(c=0;c<f.triangleCount;++c)for(var g=this.triangles[this.references[f.triangleStart+c].triangleId],j=0;3>j;j++){for(var m=0,x=g.vertices[j];m<d.length&&e[m]!==x.id;)++m;m===d.length?(d.push(1),e.push(x.id)):d[m]++}for(c=0;c<d.length;++c)1===d[c]?this.vertices[e[c]].isBorder=!0:this.vertices[e[c]].isBorder=!1}},f.prototype.updateMesh=function(b){void 0===
b&&(b=!1);var c;if(!b){var d=[];for(c=0;c<this.triangles.length;++c)this.triangles[c].deleted||d.push(this.triangles[c]);this.triangles=d}for(c=0;c<this.vertices.length;++c)this.vertices[c].triangleCount=0,this.vertices[c].triangleStart=0;var e,f;for(c=0;c<this.triangles.length;++c){d=this.triangles[c];for(e=0;3>e;++e)f=d.vertices[e],f.triangleCount++}for(c=d=0;c<this.vertices.length;++c)this.vertices[c].triangleStart=d,d+=this.vertices[c].triangleCount,this.vertices[c].triangleCount=0;var g=Array(3*
this.triangles.length);for(c=0;c<this.triangles.length;++c){d=this.triangles[c];for(e=0;3>e;++e)f=d.vertices[e],g[f.triangleStart+f.triangleCount]=new m(e,c),f.triangleCount++}this.references=g;b&&this.identifyBorder()},f.prototype.vertexError=function(b,c){var d=c.x,e=c.y,f=c.z;return b.data[0]*d*d+2*b.data[1]*d*e+2*b.data[2]*d*f+2*b.data[3]*d+b.data[4]*e*e+2*b.data[5]*e*f+2*b.data[6]*e+b.data[7]*f*f+2*b.data[8]*f+b.data[9]},f.prototype.calculateError=function(c,d,e){var f=c.q.add(d.q),g=c.isBorder&&
d.isBorder,j=0,j=f.det(0,1,2,1,4,5,2,5,7);if(0===j||g){var g=c.position.add(d.position).divide(new b.Vector3(2,2,2)),m=this.vertexError(f,c.position),u=this.vertexError(f,d.position),f=this.vertexError(f,g),j=Math.min(m,u,f);j===m?e&&e.copyFrom(c.position):j===u?e&&e.copyFrom(d.position):e&&e.copyFrom(g)}else e||(e=b.Vector3.Zero()),e.x=-1/j*f.det(1,2,3,4,5,6,5,7,8),e.y=1/j*f.det(0,2,3,1,5,6,2,7,8),e.z=-1/j*f.det(0,1,3,1,4,6,2,5,8),j=this.vertexError(f,e);return j},f);b.QuadraticErrorSimplification=
j}(BABYLON||(BABYLON={}));
!function(b){var f=[],e=function(c,d){if(!f[c.id]){if(c instanceof b.Geometry.Primitives.Box)d.boxes.push(c.serialize());else if(c instanceof b.Geometry.Primitives.Sphere)d.spheres.push(c.serialize());else if(c instanceof b.Geometry.Primitives.Cylinder)d.cylinders.push(c.serialize());else if(c instanceof b.Geometry.Primitives.Torus)d.toruses.push(c.serialize());else if(c instanceof b.Geometry.Primitives.Ground)d.grounds.push(c.serialize());else if(c instanceof b.Geometry.Primitives.Plane)d.planes.push(c.serialize());else if(c instanceof
b.Geometry.Primitives.TorusKnot)d.torusKnots.push(c.serialize());else{if(c instanceof b.Geometry.Primitives._Primitive)throw Error("Unknown primitive type");d.vertexData.push(c.serializeVerticeData())}f[c.id]=!0}},c=function(c,d){var f={};f.name=c.name;f.id=c.id;b.Tags.HasTags(c)&&(f.tags=b.Tags.GetTags(c));f.position=c.position.asArray();c.rotationQuaternion?f.rotationQuaternion=c.rotationQuaternion.asArray():c.rotation&&(f.rotation=c.rotation.asArray());f.scaling=c.scaling.asArray();f.localMatrix=
c.getPivotMatrix().asArray();f.isEnabled=c.isEnabled();f.isVisible=c.isVisible;f.infiniteDistance=c.infiniteDistance;f.pickable=c.isPickable;f.receiveShadows=c.receiveShadows;f.billboardMode=c.billboardMode;f.visibility=c.visibility;f.checkCollisions=c.checkCollisions;c.parent&&(f.parentId=c.parent.id);var l=c._geometry;if(l){var n=l.id;f.geometryId=n;c.getScene().getGeometryByID(n)||e(l,d.geometries);f.subMeshes=[];for(l=0;l<c.subMeshes.length;l++)n=c.subMeshes[l],f.subMeshes.push({materialIndex:n.materialIndex,
verticesStart:n.verticesStart,verticesCount:n.verticesCount,indexStart:n.indexStart,indexCount:n.indexCount})}c.material?f.materialId=c.material.id:c.material=null;c.skeleton&&(f.skeletonId=c.skeleton.id);c.getPhysicsImpostor()&&(f.physicsMass=c.getPhysicsMass(),f.physicsFriction=c.getPhysicsFriction(),f.physicsRestitution=c.getPhysicsRestitution(),f.physicsImpostor=c.getPhysicsImpostor().type);f.instances=[];for(l=0;l<c.instances.length;l++){var n=c.instances[l],q={name:n.name,position:n.position.asArray(),
scaling:n.scaling.asArray()};n.rotationQuaternion?q.rotationQuaternion=n.rotationQuaternion.asArray():n.rotation&&(q.rotation=n.rotation.asArray());f.instances.push(q);b.Animation.AppendSerializedAnimations(n,q);q.ranges=n.serializeAnimationRanges()}return b.Animation.AppendSerializedAnimations(c,f),f.ranges=c.serializeAnimationRanges(),f.layerMask=c.layerMask,c.actionManager&&(f.actions=c.actionManager.serialize(c.name)),f},d;d=function(){};d=(d.ClearCache=function(){f=[]},d.Serialize=function(d){var m=
{};m.useDelayedTextureLoading=d.useDelayedTextureLoading;m.autoClear=d.autoClear;m.clearColor=d.clearColor.asArray();m.ambientColor=d.ambientColor.asArray();m.gravity=d.gravity.asArray();m.collisionsEnabled=d.collisionsEnabled;m.workerCollisions=d.workerCollisions;d.fogMode&&0!==d.fogMode&&(m.fogMode=d.fogMode,m.fogColor=d.fogColor.asArray(),m.fogStart=d.fogStart,m.fogEnd=d.fogEnd,m.fogDensity=d.fogDensity);d.isPhysicsEnabled()&&(m.physicsEnabled=!0,m.physicsGravity=d.getPhysicsEngine().gravity.asArray(),
m.physicsEngine=d.getPhysicsEngine().getPhysicsPluginName());m.lights=[];var j,l;for(j=0;j<d.lights.length;j++)l=d.lights[j],m.lights.push(l.serialize());m.cameras=[];for(j=0;j<d.cameras.length;j++)m.cameras.push(d.cameras[j].serialize());d.activeCamera&&(m.activeCameraID=d.activeCamera.id);b.Animation.AppendSerializedAnimations(d,m);m.materials=[];m.multiMaterials=[];for(j=0;j<d.materials.length;j++)l=d.materials[j],m.materials.push(l.serialize());m.multiMaterials=[];for(j=0;j<d.multiMaterials.length;j++)m.multiMaterials.push(d.multiMaterials[j].serialize());
m.skeletons=[];for(j=0;j<d.skeletons.length;j++)m.skeletons.push(d.skeletons[j].serialize());m.geometries={};m.geometries.boxes=[];m.geometries.spheres=[];m.geometries.cylinders=[];m.geometries.toruses=[];m.geometries.grounds=[];m.geometries.planes=[];m.geometries.torusKnots=[];m.geometries.vertexData=[];f=[];l=d.getGeometries();for(j=0;j<l.length;j++){var n=l[j];n.isReady()&&e(n,m.geometries)}m.meshes=[];for(j=0;j<d.meshes.length;j++)l=d.meshes[j],l instanceof b.Mesh&&(l.delayLoadState!==b.Engine.DELAYLOADSTATE_LOADED&&
l.delayLoadState!==b.Engine.DELAYLOADSTATE_NONE||m.meshes.push(c(l,m)));m.particleSystems=[];for(j=0;j<d.particleSystems.length;j++)m.particleSystems.push(d.particleSystems[j].serialize());m.lensFlareSystems=[];for(j=0;j<d.lensFlareSystems.length;j++)m.lensFlareSystems.push(d.lensFlareSystems[j].serialize());m.shadowGenerators=[];for(j=0;j<d.lights.length;j++)l=d.lights[j],l.getShadowGenerator()&&m.shadowGenerators.push(l.getShadowGenerator().serialize());return d.actionManager&&(m.actions=d.actionManager.serialize("scene")),
m},d.SerializeMesh=function(d,f,j){void 0===f&&(f=!1);void 0===j&&(j=!1);var l={};if(d=d instanceof Array?d:[d],f||j)for(var n=0;n<d.length;++n)j&&d[n].getDescendants().forEach(function(c){c instanceof b.Mesh&&0>d.indexOf(c)&&d.push(c)}),f&&d[n].parent&&0>d.indexOf(d[n].parent)&&d.push(d[n].parent);return d.forEach(function(d){if(d.delayLoadState===b.Engine.DELAYLOADSTATE_LOADED||d.delayLoadState===b.Engine.DELAYLOADSTATE_NONE){d.material&&(d.material instanceof b.StandardMaterial?(l.materials=l.materials||
[],l.materials.some(function(b){return b.id===d.material.id})||l.materials.push(d.material.serialize())):d.material instanceof b.MultiMaterial&&(l.multiMaterials=l.multiMaterials||[],l.multiMaterials.some(function(b){return b.id===d.material.id})||l.multiMaterials.push(d.material.serialize())));var f=d._geometry;f&&(l.geometries||(l.geometries={},l.geometries.boxes=[],l.geometries.spheres=[],l.geometries.cylinders=[],l.geometries.toruses=[],l.geometries.grounds=[],l.geometries.planes=[],l.geometries.torusKnots=
[],l.geometries.vertexData=[]),e(f,l.geometries));d.skeleton&&(l.skeletons=l.skeletons||[],l.skeletons.push(d.skeleton.serialize()));l.meshes=l.meshes||[];l.meshes.push(c(d,l))}}),l},d);b.SceneSerializer=d}(BABYLON||(BABYLON={}));var Earcut;
!function(b){function f(b,c,d,e,f){var g;if(f===0<y(b,c,d,e))for(f=c;d>f;f+=e)g=s(f,b[f],b[f+1],g);else for(f=d-e;f>=c;f-=e)g=s(f,b[f],b[f+1],g);return g&&q(g,g.next)&&(u(g),g=g.next),g}function e(b,c){if(!b)return b;c||(c=b);var d,e=b;do if(d=!1,e.steiner||!q(e,e.next)&&0!==n(e.prev,e,e.next))e=e.next;else{if(u(e),e=c=e.prev,e===e.next)return null;d=!0}while(d||e!==c);return c}function c(b,d,f,g,j,s,x){if(b){if(!x&&s){var y=b,F=y;do null===F.z&&(F.z=m(F.x,F.y,g,j,s)),F.prevZ=F.prev,F=F.nextZ=F.next;
while(F!==y);F.prevZ.nextZ=null;F.prevZ=null;var y=F,J,G,L,N,R,P,K=1;do{F=y;N=y=null;for(R=0;F;){R++;G=F;for(J=P=0;K>J&&(P++,G=G.nextZ,G);J++);for(J=K;0<P||0<J&&G;)0===P?(L=G,G=G.nextZ,J--):0!==J&&G?F.z<=G.z?(L=F,F=F.nextZ,P--):(L=G,G=G.nextZ,J--):(L=F,F=F.nextZ,P--),N?N.nextZ=L:y=L,L.prevZ=N,N=L;F=G}N.nextZ=null;K*=2}while(1<R)}for(F=b;b.prev!==b.next;){L=b.prev;y=b.next;if(s)a:{G=b;J=g;var O=j,M=s;N=G.prev;R=G;P=G.next;if(0<=n(N,R,P))G=!1;else{var W=N.x>R.x?N.x>P.x?N.x:P.x:R.x>P.x?R.x:P.x,Ga=N.y>
R.y?N.y>P.y?N.y:P.y:R.y>P.y?R.y:P.y,K=m(N.x<R.x?N.x<P.x?N.x:P.x:R.x<P.x?R.x:P.x,N.y<R.y?N.y<P.y?N.y:P.y:R.y<P.y?R.y:P.y,J,O,M);J=m(W,Ga,J,O,M);for(O=G.nextZ;O&&O.z<=J;){if(O!==G.prev&&O!==G.next&&l(N.x,N.y,R.x,R.y,P.x,P.y,O.x,O.y)&&0<=n(O.prev,O,O.next)){G=!1;break a}O=O.nextZ}for(O=G.prevZ;O&&O.z>=K;){if(O!==G.prev&&O!==G.next&&l(N.x,N.y,R.x,R.y,P.x,P.y,O.x,O.y)&&0<=n(O.prev,O,O.next)){G=!1;break a}O=O.prevZ}G=!0}}else a:if(G=b,N=G.prev,R=G,P=G.next,0<=n(N,R,P))G=!1;else{for(K=G.next.next;K!==G.prev;){if(l(N.x,
N.y,R.x,R.y,P.x,P.y,K.x,K.y)&&0<=n(K.prev,K,K.next)){G=!1;break a}K=K.next}G=!0}if(G)d.push(L.i/f),d.push(b.i/f),d.push(y.i/f),u(b),F=b=y.next;else if(b=y,b===F){if(x)if(1===x){x=d;L=f;y=b;do F=y.prev,G=y.next.next,!q(F,G)&&p(F,y,y.next,G)&&r(F,G)&&r(G,F)&&(x.push(F.i/L),x.push(y.i/L),x.push(G.i/L),u(y),u(y.next),y=b=G),y=y.next;while(y!==b);b=y;c(b,d,f,g,j,s,2)}else{if(2===x)a:{x=b;do{for(L=x.next.next;L!==x.prev;){if(y=x.i!==L.i){y=x;F=L;G=void 0;if(G=y.next.i!==F.i)if(G=void 0,G=y.prev.i!==F.i){G=
void 0;b:{G=y;do{if(G.i!==y.i&&G.next.i!==y.i&&G.i!==F.i&&G.next.i!==F.i&&p(G,G.next,y,F)){G=!0;break b}G=G.next}while(G!==y);G=!1}N=void 0;if(N=!G){G=void 0;if(G=r(y,F))if(G=void 0,G=r(F,y)){G=y;N=!1;R=(y.x+F.x)/2;F=(y.y+F.y)/2;do G.y>F!=G.next.y>F&&R<(G.next.x-G.x)*(F-G.y)/(G.next.y-G.y)+G.x&&(N=!N),G=G.next;while(G!==y);G=N}N=G}G=N}y=G}if(y){b=t(x,L);x=e(x,x.next);b=e(b,b.next);c(x,d,f,g,j,s,void 0);c(b,d,f,g,j,s,void 0);break a}L=L.next}x=x.next}while(x!==b)}}else c(e(b,void 0),d,f,g,j,s,1);break}}}}
function d(b,c){return b.x-c.x}function g(b,c){var d,e=c,f=b.x,g=b.y,j=-(1/0);do{if(g<=e.y&&g>=e.next.y){var m=e.x+(g-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(f>=m&&m>j){if(j=m,m===f){if(g===e.y)return e;if(g===e.next.y)return e.next}d=e.x<e.next.x?e:e.next}}e=e.next}while(e!==c);if(!d)return null;if(f===j)return d.prev;for(var n,m=d,q=d.x,p=d.y,s=1/0,e=d.next;e!==m;)f>=e.x&&e.x>=q&&l(p>g?f:j,g,q,p,p>g?j:f,g,e.x,e.y)&&(n=Math.abs(g-e.y)/(f-e.x),(s>n||n===s&&e.x>d.x)&&r(e,b)&&(d=e,s=n)),e=e.next;return d}
function m(b,c,d,e,f){return b=32767*(b-d)/f,c=32767*(c-e)/f,b=16711935&(b|b<<8),b=252645135&(b|b<<4),b=858993459&(b|b<<2),b=1431655765&(b|b<<1),c=16711935&(c|c<<8),c=252645135&(c|c<<4),c=858993459&(c|c<<2),c=1431655765&(c|c<<1),b|c<<1}function j(b){var c=b,d=b;do c.x<d.x&&(d=c),c=c.next;while(c!==b);return d}function l(b,c,d,e,f,g,j,l){return 0<=(f-j)*(c-l)-(b-j)*(g-l)&&0<=(b-j)*(e-l)-(d-j)*(c-l)&&0<=(d-j)*(g-l)-(f-j)*(e-l)}function n(b,c,d){return(c.y-b.y)*(d.x-c.x)-(c.x-b.x)*(d.y-c.y)}function q(b,
c){return b.x===c.x&&b.y===c.y}function p(b,c,d,e){return q(b,c)&&q(d,e)||q(b,e)&&q(d,c)?!0:0<n(b,c,d)!=0<n(b,c,e)&&0<n(d,e,b)!=0<n(d,e,c)}function r(b,c){return 0>n(b.prev,b,b.next)?0<=n(b,c,b.next)&&0<=n(b,b.prev,c):0>n(b,c,b.prev)||0>n(b,b.next,c)}function t(b,c){var d=new x(b.i,b.x,b.y),e=new x(c.i,c.x,c.y),f=b.next,g=c.prev;return b.next=c,c.prev=b,d.next=f,f.prev=d,e.next=d,d.prev=e,g.next=e,e.prev=g,e}function s(b,c,d,e){b=new x(b,c,d);return e?(b.next=e.next,b.prev=e,e.next.prev=b,e.next=
b):(b.prev=b,b.next=b),b}function u(b){b.next.prev=b.prev;b.prev.next=b.next;b.prevZ&&(b.prevZ.nextZ=b.nextZ);b.nextZ&&(b.nextZ.prevZ=b.prevZ)}function x(b,c,d){this.i=b;this.x=c;this.y=d;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function y(b,c,d,e){for(var f=0,g=d-e;d>c;c+=e)f+=(b[g]-b[c])*(b[c+1]+b[g+1]),g=c;return f}b.earcut=function(b,l,m){m=m||2;var n=l&&l.length,q=n?l[0]*m:b.length,p=f(b,0,q,m,!0),r=[];if(!p)return r;var s,u,x,y;if(n){var L=m,N,R,P;y=[];n=0;for(N=
l.length;N>n;n++)R=l[n]*L,P=N-1>n?l[n+1]*L:b.length,R=f(b,R,P,L,!1),R===R.next&&(R.steiner=!0),y.push(j(R));y.sort(d);for(n=0;n<y.length;n++){l=y[n];L=p;if(L=g(l,L))l=t(L,l),e(l,l.next);p=e(p,p.next)}}if(b.length>80*m){s=x=b[0];u=n=b[1];for(L=m;q>L;L+=m)y=b[L],l=b[L+1],s>y&&(s=y),u>l&&(u=l),y>x&&(x=y),l>n&&(n=l);x=Math.max(x-s,n-u)}return c(p,r,m,s,u,x,void 0),r};b.deviation=function(b,c,d,e){var f=c&&c.length,g=Math.abs(y(b,0,f?c[0]*d:b.length,d));if(f)for(var f=0,j=c.length;j>f;f++)g-=Math.abs(y(b,
c[f]*d,j-1>f?c[f+1]*d:b.length,d));for(f=c=0;f<e.length;f+=3){var j=e[f]*d,l=e[f+1]*d,m=e[f+2]*d;c+=Math.abs((b[j]-b[m])*(b[l+1]-b[j+1])-(b[j]-b[l])*(b[m+1]-b[j+1]))}return 0===g&&0===c?0:Math.abs((c-g)/g)};b.flatten=function(b){for(var c=b[0][0].length,d={vertices:[],holes:[],dimensions:c},e=0,f=0;f<b.length;f++){for(var g=0;g<b[f].length;g++)for(var j=0;c>j;j++)d.vertices.push(b[f][g][j]);0<f&&(e+=b[f-1].length,d.holes.push(e))}return d}}(Earcut||(Earcut={}));
!function(b){var f=0,e,c=function(b,c,d){this.pos=b;this.normal=c;this.uv=d};e=(c.prototype.clone=function(){return new c(this.pos.clone(),this.normal.clone(),this.uv.clone())},c.prototype.flip=function(){this.normal=this.normal.scale(-1)},c.prototype.interpolate=function(d,e){return new c(b.Vector3.Lerp(this.pos,d.pos,e),b.Vector3.Lerp(this.normal,d.normal,e),b.Vector2.Lerp(this.uv,d.uv,e))},c);var d,g=function(b,c){this.normal=b;this.w=c};d=(g.FromPoints=function(c,d,e){e=e.subtract(c);d=d.subtract(c);
if(0===e.lengthSquared()||0===d.lengthSquared())return null;d=b.Vector3.Normalize(b.Vector3.Cross(e,d));return new g(d,b.Vector3.Dot(d,c))},g.prototype.clone=function(){return new g(this.normal.clone(),this.w)},g.prototype.flip=function(){this.normal.scaleInPlace(-1);this.w=-this.w},g.prototype.splitPolygon=function(c,d,e,f,j){var l,n,q=0,p=[];for(l=0;l<c.vertices.length;l++)n=b.Vector3.Dot(this.normal,c.vertices[l].pos)-this.w,n=n<-g.EPSILON?2:n>g.EPSILON?1:0,q|=n,p.push(n);switch(q){case 0:(0<b.Vector3.Dot(this.normal,
c.plane.normal)?d:e).push(c);break;case 1:f.push(c);break;case 2:j.push(c);break;case 3:d=[];e=[];for(l=0;l<c.vertices.length;l++){var C=(l+1)%c.vertices.length;n=p[l];var D=p[C],q=c.vertices[l],C=c.vertices[C];if(2!==n&&d.push(q),1!==n&&e.push(2!==n?q.clone():q),3===(n|D))n=(this.w-b.Vector3.Dot(this.normal,q.pos))/b.Vector3.Dot(this.normal,C.pos.subtract(q.pos)),n=q.interpolate(C,n),d.push(n),e.push(n.clone())}var E;3<=d.length&&(E=new m(d,c.shared),E.plane&&f.push(E));3<=e.length&&(E=new m(e,c.shared),
E.plane&&j.push(E))}},g.EPSILON=1E-5,g);var m,j=function(b,c){this.vertices=b;this.shared=c;this.plane=d.FromPoints(b[0].pos,b[1].pos,b[2].pos)};m=(j.prototype.clone=function(){var b=this.vertices.map(function(b){return b.clone()});return new j(b,this.shared)},j.prototype.flip=function(){this.vertices.reverse().map(function(b){b.flip()});this.plane.flip()},j);var l,n=function(b){this.back=this.front=this.plane=null;this.polygons=[];b&&this.build(b)};l=(n.prototype.clone=function(){var b=new n;return b.plane=
this.plane&&this.plane.clone(),b.front=this.front&&this.front.clone(),b.back=this.back&&this.back.clone(),b.polygons=this.polygons.map(function(b){return b.clone()}),b},n.prototype.invert=function(){for(var b=0;b<this.polygons.length;b++)this.polygons[b].flip();this.plane&&this.plane.flip();this.front&&this.front.invert();this.back&&this.back.invert();b=this.front;this.front=this.back;this.back=b},n.prototype.clipPolygons=function(b){if(!this.plane)return b.slice();for(var c=[],d=[],e=0;e<b.length;e++)this.plane.splitPolygon(b[e],
c,d,c,d);return this.front&&(c=this.front.clipPolygons(c)),d=this.back?this.back.clipPolygons(d):[],c.concat(d)},n.prototype.clipTo=function(b){this.polygons=b.clipPolygons(this.polygons);this.front&&this.front.clipTo(b);this.back&&this.back.clipTo(b)},n.prototype.allPolygons=function(){var b=this.polygons.slice();return this.front&&(b=b.concat(this.front.allPolygons())),this.back&&(b=b.concat(this.back.allPolygons())),b},n.prototype.build=function(b){if(b.length){this.plane||(this.plane=b[0].plane.clone());
for(var c=[],d=[],e=0;e<b.length;e++)this.plane.splitPolygon(b[e],this.polygons,this.polygons,c,d);c.length&&(this.front||(this.front=new n),this.front.build(c));d.length&&(this.back||(this.back=new n),this.back.build(d))}},n);var q,p=function(){this.polygons=[]};q=(p.FromMesh=function(c){var d,g,j,l,n,q,A,B,C,D=[];if(!(c instanceof b.Mesh))throw"BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh";c.computeWorldMatrix(!0);n=c.getWorldMatrix();q=c.position.clone();A=c.rotation.clone();c.rotationQuaternion&&
(B=c.rotationQuaternion.clone());C=c.scaling.clone();var E=c.getIndices(),I=c.getVerticesData(b.VertexBuffer.PositionKind),H=c.getVerticesData(b.VertexBuffer.NormalKind),F=c.getVerticesData(b.VertexBuffer.UVKind);c=c.subMeshes;for(var J=0,G=c.length;G>J;J++)for(var L=c[J].indexStart,N=c[J].indexCount+c[J].indexStart;N>L;L+=3){l=[];for(var R=0;3>R;R++)g=new b.Vector3(H[3*E[L+R]],H[3*E[L+R]+1],H[3*E[L+R]+2]),d=new b.Vector2(F[2*E[L+R]],F[2*E[L+R]+1]),j=new b.Vector3(I[3*E[L+R]],I[3*E[L+R]+1],I[3*E[L+
R]+2]),j=b.Vector3.TransformCoordinates(j,n),g=b.Vector3.TransformNormal(g,n),d=new e(j,g,d),l.push(d);l=new m(l,{subMeshId:J,meshId:f,materialIndex:c[J].materialIndex});l.plane&&D.push(l)}D=p.FromPolygons(D);return D.matrix=n,D.position=q,D.rotation=A,D.scaling=C,D.rotationQuaternion=B,f++,D},p.FromPolygons=function(b){var c=new p;return c.polygons=b,c},p.prototype.clone=function(){var b=new p;return b.polygons=this.polygons.map(function(b){return b.clone()}),b.copyTransformAttributes(this),b},p.prototype.toPolygons=
function(){return this.polygons},p.prototype.union=function(b){var c=new l(this.clone().polygons);b=new l(b.clone().polygons);return c.clipTo(b),b.clipTo(c),b.invert(),b.clipTo(c),b.invert(),c.build(b.allPolygons()),p.FromPolygons(c.allPolygons()).copyTransformAttributes(this)},p.prototype.unionInPlace=function(b){var c=new l(this.polygons);b=new l(b.polygons);c.clipTo(b);b.clipTo(c);b.invert();b.clipTo(c);b.invert();c.build(b.allPolygons());this.polygons=c.allPolygons()},p.prototype.subtract=function(b){var c=
new l(this.clone().polygons);b=new l(b.clone().polygons);return c.invert(),c.clipTo(b),b.clipTo(c),b.invert(),b.clipTo(c),b.invert(),c.build(b.allPolygons()),c.invert(),p.FromPolygons(c.allPolygons()).copyTransformAttributes(this)},p.prototype.subtractInPlace=function(b){var c=new l(this.polygons);b=new l(b.polygons);c.invert();c.clipTo(b);b.clipTo(c);b.invert();b.clipTo(c);b.invert();c.build(b.allPolygons());c.invert();this.polygons=c.allPolygons()},p.prototype.intersect=function(b){var c=new l(this.clone().polygons);
b=new l(b.clone().polygons);return c.invert(),b.clipTo(c),b.invert(),c.clipTo(b),b.clipTo(c),c.build(b.allPolygons()),c.invert(),p.FromPolygons(c.allPolygons()).copyTransformAttributes(this)},p.prototype.intersectInPlace=function(b){var c=new l(this.polygons);b=new l(b.polygons);c.invert();b.clipTo(c);b.invert();c.clipTo(b);b.clipTo(c);c.build(b.allPolygons());c.invert();this.polygons=c.allPolygons()},p.prototype.inverse=function(){var b=this.clone();return b.inverseInPlace(),b},p.prototype.inverseInPlace=
function(){this.polygons.map(function(b){b.flip()})},p.prototype.copyTransformAttributes=function(b){return this.matrix=b.matrix,this.position=b.position,this.rotation=b.rotation,this.scaling=b.scaling,this.rotationQuaternion=b.rotationQuaternion,this},p.prototype.buildMeshGeometry=function(c,d,e){var f=this.matrix.clone();f.invert();var g,j;d=new b.Mesh(c,d);var l=[],m=[],n=[],q=[],p=b.Vector3.Zero(),E=b.Vector3.Zero(),I=b.Vector2.Zero(),H=this.polygons,F=[0,0,0],J={},G=0,L={};e&&H.sort(function(b,
c){return b.shared.meshId===c.shared.meshId?b.shared.subMeshId-c.shared.subMeshId:b.shared.meshId-c.shared.meshId});for(var N=0,R=H.length;R>N;N++){g=H[N];L[g.shared.meshId]||(L[g.shared.meshId]={});L[g.shared.meshId][g.shared.subMeshId]||(L[g.shared.meshId][g.shared.subMeshId]={indexStart:+(1/0),indexEnd:-(1/0),materialIndex:g.shared.materialIndex});c=L[g.shared.meshId][g.shared.subMeshId];for(var P=2,K=g.vertices.length;K>P;P++){F[0]=0;F[1]=P-1;F[2]=P;for(var O=0;3>O;O++){p.copyFrom(g.vertices[F[O]].pos);
E.copyFrom(g.vertices[F[O]].normal);I.copyFrom(g.vertices[F[O]].uv);var M=b.Vector3.TransformCoordinates(p,f),W=b.Vector3.TransformNormal(E,f);j=J[M.x+","+M.y+","+M.z];"undefined"!=typeof j&&n[3*j]===W.x&&n[3*j+1]===W.y&&n[3*j+2]===W.z&&q[2*j]===I.x&&q[2*j+1]===I.y||(l.push(M.x,M.y,M.z),q.push(I.x,I.y),n.push(E.x,E.y,E.z),j=J[M.x+","+M.y+","+M.z]=l.length/3-1);m.push(j);c.indexStart=Math.min(G,c.indexStart);c.indexEnd=Math.max(G,c.indexEnd);G++}}}if(d.setVerticesData(b.VertexBuffer.PositionKind,l),
d.setVerticesData(b.VertexBuffer.NormalKind,n),d.setVerticesData(b.VertexBuffer.UVKind,q),d.setIndices(m),e){f=0;d.subMeshes=[];for(var Ga in L){e=-1;for(var qa in L[Ga])c=L[Ga][qa],b.SubMesh.CreateFromIndices(c.materialIndex+f,c.indexStart,c.indexEnd-c.indexStart+1,d),e=Math.max(c.materialIndex,e);f+=++e}}return d},p.prototype.toMesh=function(b,c,d,e){b=this.buildMeshGeometry(b,d,e);return b.material=c,b.position.copyFrom(this.position),b.rotation.copyFrom(this.rotation),this.rotationQuaternion&&
(b.rotationQuaternion=this.rotationQuaternion.clone()),b.scaling.copyFrom(this.scaling),b.computeWorldMatrix(!0),b},p);b.CSG=q}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.PostProcess;f=function(c,d,f,m){var j=this;e.call(this,c,"vrDistortionCorrection",["LensCenter","Scale","ScaleIn","HmdWarpParam"],null,m.postProcessScaleFactor,d,b.Texture.BILINEAR_SAMPLINGMODE,null,null);this._isRightEye=f;this._distortionFactors=m.distortionK;this._postProcessScaleFactor=m.postProcessScaleFactor;this._lensCenterOffset=m.lensCenterOffset;this.onSizeChangedObservable.add(function(){j.aspectRatio=0.5*j.width/j.height;j._scaleIn=new b.Vector2(2,2/j.aspectRatio);
j._scaleFactor=new b.Vector2(0.5*(1/j._postProcessScaleFactor),0.5*(1/j._postProcessScaleFactor)*j.aspectRatio);j._lensCenter=new b.Vector2(j._isRightEye?0.5-0.5*j._lensCenterOffset:0.5+0.5*j._lensCenterOffset,0.5)});this.onApplyObservable.add(function(b){b.setFloat2("LensCenter",j._lensCenter.x,j._lensCenter.y);b.setFloat2("Scale",j._scaleFactor.x,j._scaleFactor.y);b.setFloat2("ScaleIn",j._scaleIn.x,j._scaleIn.y);b.setFloat4("HmdWarpParam",j._distortionFactors[0],j._distortionFactors[1],j._distortionFactors[2],
j._distortionFactors[3])})};f=(__extends(f,e),f);b.VRDistortionCorrectionPostProcess=f}(BABYLON||(BABYLON={}));
!function(b){var f=b.JoystickAxis||(b.JoystickAxis={});f[f.X=0]="X";f[f.Y=1]="Y";f[f.Z=2]="Z";!0;var e=b.JoystickAxis,c=function(d){var f=this;d?this._leftJoystick=!0:this._leftJoystick=!1;this._joystickIndex=c._globalJoystickIndex;c._globalJoystickIndex++;this._axisTargetedByLeftAndRight=e.X;this._axisTargetedByUpAndDown=e.Y;this.reverseUpDown=this.reverseLeftRight=!1;this._touches=new b.StringDictionary;this.deltaPosition=b.Vector3.Zero();this._joystickSensibility=25;this._inversedSensibility=1/
(this._joystickSensibility/1E3);this._rotationSpeed=25;this._inverseRotationSpeed=1/(this._rotationSpeed/1E3);this._rotateOnAxisRelativeToMesh=!1;this._onResize=function(){c.vjCanvasWidth=window.innerWidth;c.vjCanvasHeight=window.innerHeight;c.vjCanvas.width=c.vjCanvasWidth;c.vjCanvas.height=c.vjCanvasHeight;c.halfWidth=c.vjCanvasWidth/2;c.halfHeight=c.vjCanvasHeight/2};c.vjCanvas||(window.addEventListener("resize",this._onResize,!1),c.vjCanvas=document.createElement("canvas"),c.vjCanvasWidth=window.innerWidth,
c.vjCanvasHeight=window.innerHeight,c.vjCanvas.width=window.innerWidth,c.vjCanvas.height=window.innerHeight,c.vjCanvas.style.width="100%",c.vjCanvas.style.height="100%",c.vjCanvas.style.position="absolute",c.vjCanvas.style.backgroundColor="transparent",c.vjCanvas.style.top="0px",c.vjCanvas.style.left="0px",c.vjCanvas.style.zIndex="5",c.vjCanvas.style.msTouchAction="none",c.vjCanvas.setAttribute("touch-action","none"),c.vjCanvasContext=c.vjCanvas.getContext("2d"),c.vjCanvasContext.strokeStyle="#ffffff",
c.vjCanvasContext.lineWidth=2,document.body.appendChild(c.vjCanvas));c.halfWidth=c.vjCanvas.width/2;c.halfHeight=c.vjCanvas.height/2;this.pressed=!1;this._joystickColor="cyan";this._joystickPointerID=-1;this._joystickPointerPos=new b.Vector2(0,0);this._joystickPreviousPointerPos=new b.Vector2(0,0);this._joystickPointerStartPos=new b.Vector2(0,0);this._deltaJoystickVector=new b.Vector2(0,0);this._onPointerDownHandlerRef=function(b){f._onPointerDown(b)};this._onPointerMoveHandlerRef=function(b){f._onPointerMove(b)};
this._onPointerOutHandlerRef=function(b){f._onPointerUp(b)};this._onPointerUpHandlerRef=function(b){f._onPointerUp(b)};c.vjCanvas.addEventListener("pointerdown",this._onPointerDownHandlerRef,!1);c.vjCanvas.addEventListener("pointermove",this._onPointerMoveHandlerRef,!1);c.vjCanvas.addEventListener("pointerup",this._onPointerUpHandlerRef,!1);c.vjCanvas.addEventListener("pointerout",this._onPointerUpHandlerRef,!1);c.vjCanvas.addEventListener("contextmenu",function(b){b.preventDefault()},!1);requestAnimationFrame(function(){f._drawVirtualJoystick()})},
f=(c.prototype.setJoystickSensibility=function(b){this._joystickSensibility=b;this._inversedSensibility=1/(this._joystickSensibility/1E3)},c.prototype._onPointerDown=function(b){b.preventDefault();(!0===this._leftJoystick?b.clientX<c.halfWidth:b.clientX>c.halfWidth)&&0>this._joystickPointerID?(this._joystickPointerID=b.pointerId,this._joystickPointerStartPos.x=b.clientX,this._joystickPointerStartPos.y=b.clientY,this._joystickPointerPos=this._joystickPointerStartPos.clone(),this._joystickPreviousPointerPos=
this._joystickPointerStartPos.clone(),this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this.pressed=!0,this._touches.add(b.pointerId.toString(),b)):2>c._globalJoystickIndex&&this._action&&(this._action(),this._touches.add(b.pointerId.toString(),{x:b.clientX,y:b.clientY,prevX:b.clientX,prevY:b.clientY}))},c.prototype._onPointerMove=function(b){if(this._joystickPointerID==b.pointerId){this._joystickPointerPos.x=b.clientX;this._joystickPointerPos.y=b.clientY;this._deltaJoystickVector=this._joystickPointerPos.clone();
this._deltaJoystickVector=this._deltaJoystickVector.subtract(this._joystickPointerStartPos);b=(this.reverseLeftRight?-1:1)*this._deltaJoystickVector.x/this._inversedSensibility;switch(this._axisTargetedByLeftAndRight){case e.X:this.deltaPosition.x=Math.min(1,Math.max(-1,b));break;case e.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,b));break;case e.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,b))}b=(this.reverseUpDown?1:-1)*this._deltaJoystickVector.y/this._inversedSensibility;switch(this._axisTargetedByUpAndDown){case e.X:this.deltaPosition.x=
Math.min(1,Math.max(-1,b));break;case e.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,b));break;case e.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,b))}}else{var c=this._touches.get(b.pointerId.toString());c&&(c.x=b.clientX,c.y=b.clientY)}},c.prototype._onPointerUp=function(b){if(this._joystickPointerID==b.pointerId)c.vjCanvasContext.clearRect(this._joystickPointerStartPos.x-63,this._joystickPointerStartPos.y-63,126,126),c.vjCanvasContext.clearRect(this._joystickPreviousPointerPos.x-41,this._joystickPreviousPointerPos.y-
41,82,82),this._joystickPointerID=-1,this.pressed=!1;else{var e=this._touches.get(b.pointerId.toString());e&&c.vjCanvasContext.clearRect(e.prevX-43,e.prevY-43,86,86)}this._deltaJoystickVector.x=0;this._deltaJoystickVector.y=0;this._touches.remove(b.pointerId.toString())},c.prototype.setJoystickColor=function(b){this._joystickColor=b},c.prototype.setActionOnTouch=function(b){this._action=b},c.prototype.setAxisForLeftRight=function(b){switch(b){case e.X:case e.Y:case e.Z:this._axisTargetedByLeftAndRight=
b;break;default:this._axisTargetedByLeftAndRight=e.X}},c.prototype.setAxisForUpDown=function(b){switch(b){case e.X:case e.Y:case e.Z:this._axisTargetedByUpAndDown=b;break;default:this._axisTargetedByUpAndDown=e.Y}},c.prototype._clearCanvas=function(){this._leftJoystick?c.vjCanvasContext.clearRect(0,0,c.vjCanvasWidth/2,c.vjCanvasHeight):c.vjCanvasContext.clearRect(c.vjCanvasWidth/2,0,c.vjCanvasWidth,c.vjCanvasHeight)},c.prototype._drawVirtualJoystick=function(){var b=this;this.pressed&&this._touches.forEach(function(e){e.pointerId===
b._joystickPointerID?(c.vjCanvasContext.clearRect(b._joystickPointerStartPos.x-63,b._joystickPointerStartPos.y-63,126,126),c.vjCanvasContext.clearRect(b._joystickPreviousPointerPos.x-41,b._joystickPreviousPointerPos.y-41,82,82),c.vjCanvasContext.beginPath(),c.vjCanvasContext.lineWidth=6,c.vjCanvasContext.strokeStyle=b._joystickColor,c.vjCanvasContext.arc(b._joystickPointerStartPos.x,b._joystickPointerStartPos.y,40,0,2*Math.PI,!0),c.vjCanvasContext.stroke(),c.vjCanvasContext.closePath(),c.vjCanvasContext.beginPath(),
c.vjCanvasContext.strokeStyle=b._joystickColor,c.vjCanvasContext.lineWidth=2,c.vjCanvasContext.arc(b._joystickPointerStartPos.x,b._joystickPointerStartPos.y,60,0,2*Math.PI,!0),c.vjCanvasContext.stroke(),c.vjCanvasContext.closePath(),c.vjCanvasContext.beginPath(),c.vjCanvasContext.strokeStyle=b._joystickColor,c.vjCanvasContext.arc(b._joystickPointerPos.x,b._joystickPointerPos.y,40,0,2*Math.PI,!0),c.vjCanvasContext.stroke(),c.vjCanvasContext.closePath(),b._joystickPreviousPointerPos=b._joystickPointerPos.clone()):
(c.vjCanvasContext.clearRect(e.prevX-43,e.prevY-43,86,86),c.vjCanvasContext.beginPath(),c.vjCanvasContext.fillStyle="white",c.vjCanvasContext.beginPath(),c.vjCanvasContext.strokeStyle="red",c.vjCanvasContext.lineWidth=6,c.vjCanvasContext.arc(e.x,e.y,40,0,2*Math.PI,!0),c.vjCanvasContext.stroke(),c.vjCanvasContext.closePath(),e.prevX=e.x,e.prevY=e.y)});requestAnimationFrame(function(){b._drawVirtualJoystick()})},c.prototype.releaseCanvas=function(){c.vjCanvas&&(c.vjCanvas.removeEventListener("pointerdown",
this._onPointerDownHandlerRef),c.vjCanvas.removeEventListener("pointermove",this._onPointerMoveHandlerRef),c.vjCanvas.removeEventListener("pointerup",this._onPointerUpHandlerRef),c.vjCanvas.removeEventListener("pointerout",this._onPointerUpHandlerRef),window.removeEventListener("resize",this._onResize),document.body.removeChild(c.vjCanvas),c.vjCanvas=null)},c._globalJoystickIndex=0,c);b.VirtualJoystick=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.FreeCamera;f=function(b,d,f){e.call(this,b,d,f);this.inputs.addVirtualJoystick()};f=(__extends(f,e),f);b.VirtualJoysticksCamera=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(){};f=(f.prototype.getLeftJoystick=function(){return this._leftjoystick},f.prototype.getRightJoystick=function(){return this._rightjoystick},f.prototype.checkInputs=function(){if(this._leftjoystick){var e=this.camera,c=50*e._computeLocalCameraSpeed(),d=b.Matrix.RotationYawPitchRoll(e.rotation.y,e.rotation.x,0),c=b.Vector3.TransformCoordinates(new b.Vector3(this._leftjoystick.deltaPosition.x*c,this._leftjoystick.deltaPosition.y*c,this._leftjoystick.deltaPosition.z*c),
d);e.cameraDirection=e.cameraDirection.add(c);e.cameraRotation=e.cameraRotation.addVector3(this._rightjoystick.deltaPosition);this._leftjoystick.pressed||(this._leftjoystick.deltaPosition=this._leftjoystick.deltaPosition.scale(0.9));this._rightjoystick.pressed||(this._rightjoystick.deltaPosition=this._rightjoystick.deltaPosition.scale(0.9))}},f.prototype.attachControl=function(){this._leftjoystick=new b.VirtualJoystick(!0);this._leftjoystick.setAxisForUpDown(b.JoystickAxis.Z);this._leftjoystick.setAxisForLeftRight(b.JoystickAxis.X);
this._leftjoystick.setJoystickSensibility(0.15);this._rightjoystick=new b.VirtualJoystick(!1);this._rightjoystick.setAxisForUpDown(b.JoystickAxis.X);this._rightjoystick.setAxisForLeftRight(b.JoystickAxis.Y);this._rightjoystick.reverseUpDown=!0;this._rightjoystick.setJoystickSensibility(0.05);this._rightjoystick.setJoystickColor("yellow")},f.prototype.detachControl=function(){this._leftjoystick.releaseCanvas();this._rightjoystick.releaseCanvas()},f.prototype.getTypeName=function(){return"FreeCameraVirtualJoystickInput"},
f.prototype.getSimpleName=function(){return"virtualJoystick"},f);b.FreeCameraVirtualJoystickInput=f;b.CameraInputTypes.FreeCameraVirtualJoystickInput=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.PostProcess;f=function(b,d,f,m,j,l){var n=this;e.call(this,b,"anaglyph",null,["leftSampler"],d,f[1],m,j,l);this._passedProcess=f[0]._rigPostProcess;this.onApplyObservable.add(function(b){b.setTextureFromPostProcess("leftSampler",n._passedProcess)})};f=(__extends(f,e),f);b.AnaglyphPostProcess=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(b){this._scene=b};f=(f.prototype.render=function(e,c,d){var f=this;void 0===d&&(d=!1);var m=this._scene,j=this._scene.getEngine(),l=null!==j.getCaps().instancedArrays&&null!==c.visibleInstances[e._id]&&void 0!==c.visibleInstances[e._id];if(this.isReady(e,l)){var n=e.getRenderingMesh(),q=e.getMaterial();if(j.enableEffect(this._effect),this._effect.setFloat("offset",d?0:n.outlineWidth),this._effect.setColor4("color",d?n.overlayColor:n.outlineColor,d?n.overlayAlpha:1),this._effect.setMatrix("viewProjection",
m.getTransformMatrix()),n.useBones&&n.computeBonesUsingShaders&&this._effect.setMatrices("mBones",n.skeleton.getTransformMatrices(n)),n._bind(e,this._effect,b.Material.TriangleFillMode),q&&q.needAlphaTesting())d=q.getAlphaTestTexture(),this._effect.setTexture("diffuseSampler",d),this._effect.setMatrix("diffuseMatrix",d.getTextureMatrix());n._processRendering(e,this._effect,b.Material.TriangleFillMode,c,l,function(b,c){f._effect.setMatrix("world",c)})}},f.prototype.isReady=function(e,c){var d=[],f=
[b.VertexBuffer.PositionKind,b.VertexBuffer.NormalKind],m=e.getMesh(),j=e.getMaterial();j&&j.needAlphaTesting()&&(d.push("#define ALPHATEST"),m.isVerticesDataPresent(b.VertexBuffer.UVKind)&&(f.push(b.VertexBuffer.UVKind),d.push("#define UV1")),m.isVerticesDataPresent(b.VertexBuffer.UV2Kind)&&(f.push(b.VertexBuffer.UV2Kind),d.push("#define UV2")));m.useBones&&m.computeBonesUsingShaders?(f.push(b.VertexBuffer.MatricesIndicesKind),f.push(b.VertexBuffer.MatricesWeightsKind),4<m.numBoneInfluencers&&(f.push(b.VertexBuffer.MatricesIndicesExtraKind),
f.push(b.VertexBuffer.MatricesWeightsExtraKind)),d.push("#define NUM_BONE_INFLUENCERS "+m.numBoneInfluencers),d.push("#define BonesPerMesh "+(m.skeleton.bones.length+1))):d.push("#define NUM_BONE_INFLUENCERS 0");c&&(d.push("#define INSTANCES"),f.push("world0"),f.push("world1"),f.push("world2"),f.push("world3"));d=d.join("\n");return this._cachedDefines!==d&&(this._cachedDefines=d,this._effect=this._scene.getEngine().createEffect("outline",f,"world mBones viewProjection diffuseMatrix offset color".split(" "),
["diffuseSampler"],d)),this._effect.isReady()},f);b.OutlineRenderer=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(b,c,d,e){this.name=b;this.meshesNames=c;this.rootUrl=d;this.sceneFilename=e;this.isCompleted=!1};f=(e.prototype.run=function(c,d,e){var f=this;b.SceneLoader.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,c,function(b,c,e){f.loadedMeshes=b;f.loadedParticleSystems=c;f.loadedSkeletons=e;f.isCompleted=!0;f.onSuccess&&f.onSuccess(f);d()},null,function(){f.onError&&f.onError(f);e()})},e);b.MeshAssetTask=f;var c,e=function(b,c){this.name=b;this.url=c;this.isCompleted=
!1};c=(e.prototype.run=function(c,d,e){var f=this;b.Tools.LoadFile(this.url,function(b){f.text=b;f.isCompleted=!0;f.onSuccess&&f.onSuccess(f);d()},null,c.database,!1,function(){f.onError&&f.onError(f);e()})},e);b.TextFileAssetTask=c;var d,e=function(b,c){this.name=b;this.url=c;this.isCompleted=!1};d=(e.prototype.run=function(c,d,e){var f=this;b.Tools.LoadFile(this.url,function(b){f.data=b;f.isCompleted=!0;f.onSuccess&&f.onSuccess(f);d()},null,c.database,!0,function(){f.onError&&f.onError(f);e()})},
e);b.BinaryFileAssetTask=d;var g,e=function(b,c){this.name=b;this.url=c;this.isCompleted=!1};g=(e.prototype.run=function(b,c,d){var e=this,f=new Image;f.onload=function(){e.image=f;e.isCompleted=!0;e.onSuccess&&e.onSuccess(e);c()};f.onerror=function(){e.onError&&e.onError(e);d()};f.src=this.url},e);b.ImageAssetTask=g;var m,e=function(c,d,e,f,g){void 0===g&&(g=b.Texture.TRILINEAR_SAMPLINGMODE);this.name=c;this.url=d;this.noMipmap=e;this.invertY=f;this.samplingMode=g;this.isCompleted=!1};m=(e.prototype.run=
function(c,d,e){var f=this;this.texture=new b.Texture(this.url,c,this.noMipmap,this.invertY,this.samplingMode,function(){f.isCompleted=!0;f.onSuccess&&f.onSuccess(f);d()},function(){f.onError&&f.onError(f);e()})},e);b.TextureAssetTask=m;e=function(b){this._tasks=[];this._waitingTasksCount=0;this.useDefaultLoadingScreen=!0;this._scene=b};e=(e.prototype.addMeshTask=function(b,c,d,e){b=new f(b,c,d,e);return this._tasks.push(b),b},e.prototype.addTextFileTask=function(b,d){var e=new c(b,d);return this._tasks.push(e),
e},e.prototype.addBinaryFileTask=function(b,c){var e=new d(b,c);return this._tasks.push(e),e},e.prototype.addImageTask=function(b,c){var d=new g(b,c);return this._tasks.push(d),d},e.prototype.addTextureTask=function(c,d,e,f,g){void 0===g&&(g=b.Texture.TRILINEAR_SAMPLINGMODE);c=new m(c,d,e,f,g);return this._tasks.push(c),c},e.prototype._decreaseWaitingTasksCount=function(){this._waitingTasksCount--;0===this._waitingTasksCount&&(this.onFinish&&this.onFinish(this._tasks),this._scene.getEngine().hideLoadingUI())},
e.prototype._runTask=function(b){var c=this;b.run(this._scene,function(){c.onTaskSuccess&&c.onTaskSuccess(b);c._decreaseWaitingTasksCount()},function(){c.onTaskError&&c.onTaskError(b);c._decreaseWaitingTasksCount()})},e.prototype.reset=function(){return this._tasks=[],this},e.prototype.load=function(){if(this._waitingTasksCount=this._tasks.length,0===this._waitingTasksCount)return this.onFinish&&this.onFinish(this._tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();
for(var b=0;b<this._tasks.length;b++)this._runTask(this._tasks[b]);return this},e);b.AssetsManager=e}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(){this.compensateDistortion=!0};f=(Object.defineProperty(e.prototype,"aspectRatio",{get:function(){return this.hResolution/(2*this.vResolution)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspectRatioFov",{get:function(){return 2*Math.atan(this.postProcessScaleFactor*this.vScreenSize/(2*this.eyeToScreenDistance))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftHMatrix",{get:function(){return b.Matrix.Translation(4*(this.hScreenSize/
4-this.lensSeparationDistance/2)/this.hScreenSize,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightHMatrix",{get:function(){return b.Matrix.Translation(-(4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize),0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftPreViewMatrix",{get:function(){return b.Matrix.Translation(0.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightPreViewMatrix",
{get:function(){return b.Matrix.Translation(-0.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),e.GetDefault=function(){var b=new e;return b.hResolution=1280,b.vResolution=800,b.hScreenSize=0.149759993,b.vScreenSize=0.0935999975,b.vScreenCenter=0.0467999987,b.eyeToScreenDistance=0.0410000011,b.lensSeparationDistance=0.063500002,b.interpupillaryDistance=0.064000003,b.distortionK=[1,0.219999999,0.239999995,0],b.chromaAbCorrection=[0.995999992,-0.00400000019,1.01400006,0],b.postProcessScaleFactor=
1.714605507808412,b.lensCenterOffset=0.151976421,b},e);b.VRCameraMetrics=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.FreeCamera;f=function(c,f,m,j){void 0===j&&(j=!0);e.call(this,c,f,m);this.rotationQuaternion=new b.Quaternion;c=b.VRCameraMetrics.GetDefault();c.compensateDistortion=j;this.setCameraRigMode(b.Camera.RIG_MODE_VR,{vrCameraMetrics:c});this.inputs.addDeviceOrientation()};f=(__extends(f,e),f.prototype.getTypeName=function(){return"VRDeviceOrientationFreeCamera"},f);b.VRDeviceOrientationFreeCamera=f;var c=b.ArcRotateCamera;f=function(d,e,f,j,l,n,q){void 0===q&&(q=!0);c.call(this,
d,e,f,j,l,n);d=b.VRCameraMetrics.GetDefault();d.compensateDistortion=q;this.setCameraRigMode(b.Camera.RIG_MODE_VR,{vrCameraMetrics:d});this.inputs.addVRDeviceOrientation()};f=(__extends(f,c),f.prototype.getTypeName=function(){return"VRDeviceOrientationArcRotateCamera"},f);b.VRDeviceOrientationArcRotateCamera=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.FreeCamera;f=function(c,d,f,m){void 0===m&&(m=!0);e.call(this,c,d,f);this._cacheState=this._sensorDevice=this._hmdDevice=null;this._vrEnabled=!1;c=b.VRCameraMetrics.GetDefault();c.compensateDistortion=m;this.setCameraRigMode(b.Camera.RIG_MODE_VR,{vrCameraMetrics:c});this._getWebVRDevices=this._getWebVRDevices.bind(this);this.rotationQuaternion=new b.Quaternion};f=(__extends(f,e),f.prototype._getWebVRDevices=function(b){var d=b.length,e=0;for(this._hmdDevice=this._sensorDevice=
null;d>e&&null===this._hmdDevice;)b[e]instanceof HMDVRDevice&&(this._hmdDevice=b[e]),e++;for(e=0;d>e&&null===this._sensorDevice;)b[e]instanceof PositionSensorVRDevice&&(!this._hmdDevice||b[e].hardwareUnitId===this._hmdDevice.hardwareUnitId)&&(this._sensorDevice=b[e]),e++;this._vrEnabled=!(!this._sensorDevice||!this._hmdDevice)},f.prototype._checkInputs=function(){this._vrEnabled&&(this._cacheState=this._sensorDevice.getState(),this.rotationQuaternion.copyFrom(this._cacheState.orientation),this.rotationQuaternion.z*=
-1,this.rotationQuaternion.w*=-1);e.prototype._checkInputs.call(this)},f.prototype.attachControl=function(b,d){e.prototype.attachControl.call(this,b,d);navigator.getVRDevices?navigator.getVRDevices().then(this._getWebVRDevices):navigator.mozGetVRDevices&&navigator.mozGetVRDevices(this._getWebVRDevices)},f.prototype.detachControl=function(b){e.prototype.detachControl.call(this,b);this._vrEnabled=!1},f.prototype.requestVRFullscreen=function(b){this._hmdDevice&&this.getEngine().switchFullscreen(b,{vrDisplay:this._hmdDevice})},
f.prototype.getTypeName=function(){return"WebVRFreeCamera"},f);b.WebVRFreeCamera=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(b){void 0===b&&(b=0);this.priority=b;this.apply=function(){return!0}};b.SceneOptimization=f;var e,c=function(b,c){var d=this;void 0===b&&(b=0);void 0===c&&(c=1024);f.call(this,b);this.priority=b;this.maximumSize=c;this.apply=function(b){for(var c=!0,e=0;e<b.textures.length;e++){var f=b.textures[e];if(f.canRescale){var g=f.getSize();Math.max(g.width,g.height)>d.maximumSize&&(f.scale(0.5),c=!1)}}return c}};e=(__extends(c,f),c);b.TextureOptimization=e;var d,c=function(b,
c){var d=this;void 0===b&&(b=0);void 0===c&&(c=2);f.call(this,b);this.priority=b;this.maximumScale=c;this._currentScale=1;this.apply=function(b){return d._currentScale++,b.getEngine().setHardwareScalingLevel(d._currentScale),d._currentScale>=d.maximumScale}};d=(__extends(c,f),c);b.HardwareScalingOptimization=d;var g,c=function(){f.apply(this,arguments);this.apply=function(b){return b.shadowsEnabled=!1,!0}};g=(__extends(c,f),c);b.ShadowsOptimization=g;var m,c=function(){f.apply(this,arguments);this.apply=
function(b){return b.postProcessesEnabled=!1,!0}};m=(__extends(c,f),c);b.PostProcessesOptimization=m;var j,c=function(){f.apply(this,arguments);this.apply=function(b){return b.lensFlaresEnabled=!1,!0}};j=(__extends(c,f),c);b.LensFlaresOptimization=j;var l,c=function(){f.apply(this,arguments);this.apply=function(b){return b.particlesEnabled=!1,!0}};l=(__extends(c,f),c);b.ParticlesOptimization=l;var n,c=function(){f.apply(this,arguments);this.apply=function(b){return b.renderTargetsEnabled=!1,!0}};
n=(__extends(c,f),c);b.RenderTargetsOptimization=n;var q,p=function(){var c=this;f.apply(this,arguments);this._canBeMerged=function(c){return!(c instanceof b.Mesh)?!1:c.isVisible&&c.isEnabled()?0<c.instances.length?!1:c.skeleton||c.hasLODLevels?!1:!c.parent:!1};this.apply=function(d,e){for(var f=d.meshes.slice(0),g=f.length,j=0;g>j;j++){var l=[],m=f[j];if(c._canBeMerged(m)){l.push(m);for(var n=j+1;g>n;n++){var q=f[n];c._canBeMerged(q)&&q.material===m.material&&q.checkCollisions===m.checkCollisions&&
(l.push(q),g--,f.splice(n,1),n--)}2>l.length||b.Mesh.MergeMeshes(l)}}return void 0!=e?e&&d.createOrUpdateSelectionOctree():p.UpdateSelectionTree&&d.createOrUpdateSelectionOctree(),!0}};q=(__extends(p,f),Object.defineProperty(p,"UpdateSelectionTree",{get:function(){return p._UpdateSelectionTree},set:function(b){p._UpdateSelectionTree=b},enumerable:!0,configurable:!0}),p._UpdateSelectionTree=!1,p);b.MergeMeshesOptimization=q;var r,t=function(b,c){void 0===b&&(b=60);void 0===c&&(c=2E3);this.targetFrameRate=
b;this.trackerDuration=c;this.optimizations=[]};r=(t.LowDegradationAllowed=function(b){b=new t(b);var c=0;return b.optimizations.push(new q(c)),b.optimizations.push(new g(c)),b.optimizations.push(new j(c)),c++,b.optimizations.push(new m(c)),b.optimizations.push(new l(c)),c++,b.optimizations.push(new e(c,1024)),b},t.ModerateDegradationAllowed=function(b){b=new t(b);var c=0;return b.optimizations.push(new q(c)),b.optimizations.push(new g(c)),b.optimizations.push(new j(c)),c++,b.optimizations.push(new m(c)),
b.optimizations.push(new l(c)),c++,b.optimizations.push(new e(c,512)),c++,b.optimizations.push(new n(c)),c++,b.optimizations.push(new d(c,2)),b},t.HighDegradationAllowed=function(b){b=new t(b);var c=0;return b.optimizations.push(new q(c)),b.optimizations.push(new g(c)),b.optimizations.push(new j(c)),c++,b.optimizations.push(new m(c)),b.optimizations.push(new l(c)),c++,b.optimizations.push(new e(c,256)),c++,b.optimizations.push(new n(c)),c++,b.optimizations.push(new d(c,4)),b},t);b.SceneOptimizerOptions=
r;var s=function(){},c=(s._CheckCurrentState=function(b,c,d,e,f){if(b.getEngine().getFps()>=c.targetFrameRate)return void(e&&e());for(var g=!0,j=!0,l=0;l<c.optimizations.length;l++){var m=c.optimizations[l];m.priority===d&&(j=!1,g=g&&m.apply(b))}return j?void(f&&f()):(g&&d++,void b.executeWhenReady(function(){setTimeout(function(){s._CheckCurrentState(b,c,d,e,f)},c.trackerDuration)}))},s.OptimizeAsync=function(b,c,d,e){c||(c=r.ModerateDegradationAllowed());b.executeWhenReady(function(){setTimeout(function(){s._CheckCurrentState(b,
c,0,d,e)},c.trackerDuration)})},s);b.SceneOptimizer=c}(BABYLON||(BABYLON={}));!function(b){(b.Internals||(b.Internals={})).MeshLODLevel=function(b,e){this.distance=b;this.mesh=e};!0}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.Texture,c=function(c,f,m,j,l,n,q,p){void 0===n&&(n=!0);void 0===q&&(q=!1);void 0===p&&(p=b.Texture.TRILINEAR_SAMPLINGMODE);e.call(this,null,l,!n,q);this.format=j;this._texture=l.getEngine().createRawTexture(c,f,m,j,n,q,p);this.wrapV=this.wrapU=b.Texture.CLAMP_ADDRESSMODE};f=(__extends(c,e),c.prototype.update=function(b){this.getScene().getEngine().updateRawTexture(this._texture,b,this.format,this._invertY)},c.CreateLuminanceTexture=function(d,e,f,j,l,n,q){return void 0===l&&
(l=!0),void 0===n&&(n=!1),void 0===q&&(q=b.Texture.TRILINEAR_SAMPLINGMODE),new c(d,e,f,b.Engine.TEXTUREFORMAT_LUMINANCE,j,l,n,q)},c.CreateLuminanceAlphaTexture=function(d,e,f,j,l,n,q){return void 0===l&&(l=!0),void 0===n&&(n=!1),void 0===q&&(q=b.Texture.TRILINEAR_SAMPLINGMODE),new c(d,e,f,b.Engine.TEXTUREFORMAT_LUMINANCE_ALPHA,j,l,n,q)},c.CreateAlphaTexture=function(d,e,f,j,l,n,q){return void 0===l&&(l=!0),void 0===n&&(n=!1),void 0===q&&(q=b.Texture.TRILINEAR_SAMPLINGMODE),new c(d,e,f,b.Engine.TEXTUREFORMAT_ALPHA,
j,l,n,q)},c.CreateRGBTexture=function(d,e,f,j,l,n,q){return void 0===l&&(l=!0),void 0===n&&(n=!1),void 0===q&&(q=b.Texture.TRILINEAR_SAMPLINGMODE),new c(d,e,f,b.Engine.TEXTUREFORMAT_RGB,j,l,n,q)},c.CreateRGBATexture=function(d,e,f,j,l,n,q){return void 0===l&&(l=!0),void 0===n&&(n=!1),void 0===q&&(q=b.Texture.TRILINEAR_SAMPLINGMODE),new c(d,e,f,b.Engine.TEXTUREFORMAT_RGBA,j,l,n,q)},c);b.RawTexture=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.Vector2,c=function(b,c){e.call(this,b.x,b.y);this.index=c};f=(__extends(c,e),c);var d,c=function(){this.elements=[]};d=(c.prototype.add=function(b){var c=this,d=[];return b.forEach(function(b){if(0===d.length||!b.equalsWithEpsilon(d[0]))b=new f(b,c.elements.length),d.push(b),c.elements.push(b)}),d},c.prototype.computeBounds=function(){var c=new b.Vector2(this.elements[0].x,this.elements[0].y),d=new b.Vector2(this.elements[0].x,this.elements[0].y);return this.elements.forEach(function(b){b.x<
c.x?c.x=b.x:b.x>d.x&&(d.x=b.x);b.y<c.y?c.y=b.y:b.y>d.y&&(d.y=b.y)}),{min:c,max:d,width:d.x-c.x,height:d.y-c.y}},c);c=function(){};c=(c.Rectangle=function(c,d,e,f){return[new b.Vector2(c,d),new b.Vector2(e,d),new b.Vector2(e,f),new b.Vector2(c,f)]},c.Circle=function(c,d,e,f){void 0===d&&(d=0);void 0===e&&(e=0);void 0===f&&(f=32);for(var n=[],q=0,p=2*Math.PI/f,r=0;f>r;r++)n.push(new b.Vector2(d+Math.cos(q)*c,e+Math.sin(q)*c)),q-=p;return n},c.Parse=function(c){var d=c.split(/[^-+eE\.\d]+/).map(parseFloat).filter(function(b){return!isNaN(b)}),
e=[];for(c=0;c<(2147483646&d.length);c+=2)e.push(new b.Vector2(d[c],d[c+1]));return e},c.StartingAt=function(c,d){return b.Path2.StartingAt(c,d)},c);b.Polygon=c;c=function(c,e,f){this._points=new d;this._outlinepoints=new d;this._holes=[];this._epoints=[];this._eholes=[];this._name=c;this._scene=f;c=e instanceof b.Path2?e.getPoints():e;this._addToepoint(c);this._points.add(c);this._outlinepoints.add(c)};c=(c.prototype._addToepoint=function(b){for(var c=0;c<b.length;c++){var d=b[c];this._epoints.push(d.x,
d.y)}},c.prototype.addHole=function(b){this._points.add(b);var c=new d;return c.add(b),this._holes.push(c),this._eholes.push(this._epoints.length/2),this._addToepoint(b),this},c.prototype.build=function(c,d){var e=this;void 0===c&&(c=!1);var f=new b.Mesh(this._name,this._scene),n=[],q=[],p=[],r=this._points.computeBounds();this._points.elements.forEach(function(b){n.push(0,1,0);q.push(b.x,0,b.y);p.push((b.x-r.min.x)/r.width,(b.y-r.min.y)/r.height)});for(var t=[],s=Earcut.earcut(this._epoints,this._eholes,
2),u=0;u<s.length;u++)t.push(s[u]);if(0<d){s=q.length/3;this._points.elements.forEach(function(b){n.push(0,-1,0);q.push(b.x,-d,b.y);p.push(1-(b.x-r.min.x)/r.width,1-(b.y-r.min.y)/r.height)});for(var x=t.length,u=0;x>u;u+=3){var y=t[u+0],z=t[u+1];t.push(t[u+2]+s);t.push(z+s);t.push(y+s)}this.addSide(q,n,p,t,r,this._outlinepoints,d,!1);this._holes.forEach(function(b){e.addSide(q,n,p,t,r,b,d,!0)})}return f.setVerticesData(b.VertexBuffer.PositionKind,q,c),f.setVerticesData(b.VertexBuffer.NormalKind,n,
c),f.setVerticesData(b.VertexBuffer.UVKind,p,c),f.setIndices(t),f},c.prototype.addSide=function(c,d,e,f,n,q,p,r){for(var t=c.length/3,s=0,u=0;u<q.elements.length;u++){var x,y=q.elements[u];x=u+1>q.elements.length-1?q.elements[0]:q.elements[u+1];c.push(y.x,0,y.y);c.push(y.x,-p,y.y);c.push(x.x,0,x.y);c.push(x.x,-p,x.y);y=new b.Vector3(y.x,0,y.y);x=(new b.Vector3(x.x,0,x.y)).subtract(y);y=new b.Vector3(0,1,0);y=b.Vector3.Cross(x,y);y=y.normalize();e.push(s/n.width,0);e.push(s/n.width,1);s+=x.length();
e.push(s/n.width,0);e.push(s/n.width,1);r?(d.push(y.x,y.y,y.z),d.push(y.x,y.y,y.z),d.push(y.x,y.y,y.z),d.push(y.x,y.y,y.z),f.push(t),f.push(t+2),f.push(t+1),f.push(t+1),f.push(t+2),f.push(t+3)):(d.push(-y.x,-y.y,-y.z),d.push(-y.x,-y.y,-y.z),d.push(-y.x,-y.y,-y.z),d.push(-y.x,-y.y,-y.z),f.push(t),f.push(t+1),f.push(t+2),f.push(t+1),f.push(t+3),f.push(t+2));t+=4}},c);b.PolygonMeshBuilder=c}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(c,d,e){void 0===e&&(e=2);this.maxDepth=e;this.dynamicContent=[];this._maxBlockCapacity=d||64;this._selectionContent=new b.SmartArray(1024);this._creationFunc=c};f=(e.prototype.update=function(b,d,f){e._CreateBlocks(b,d,f,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)},e.prototype.addMesh=function(b){for(var d=0;d<this.blocks.length;d++)this.blocks[d].addEntry(b)},e.prototype.select=function(b,d){this._selectionContent.reset();for(var e=0;e<this.blocks.length;e++)this.blocks[e].select(b,
this._selectionContent,d);return d?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},e.prototype.intersects=function(b,d,e){this._selectionContent.reset();for(var f=0;f<this.blocks.length;f++)this.blocks[f].intersects(b,d,this._selectionContent,e);return e?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},e.prototype.intersectsRay=
function(b){this._selectionContent.reset();for(var d=0;d<this.blocks.length;d++)this.blocks[d].intersectsRay(b,this._selectionContent);return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},e._CreateBlocks=function(c,d,e,f,j,l,n,q){n.blocks=[];d=new b.Vector3((d.x-c.x)/2,(d.y-c.y)/2,(d.z-c.z)/2);for(var p=0;2>p;p++)for(var r=0;2>r;r++)for(var t=0;2>t;t++){var s=c.add(d.multiplyByFloats(p,r,t)),u=c.add(d.multiplyByFloats(p+1,r+1,t+1)),s=new b.OctreeBlock(s,
u,f,j+1,l,q);s.addEntries(e);n.blocks.push(s)}},e.CreationFuncForMeshes=function(b,d){!b.isBlocked&&b.getBoundingInfo().boundingBox.intersectsMinMax(d.minPoint,d.maxPoint)&&d.entries.push(b)},e.CreationFuncForSubMeshes=function(b,d){b.getBoundingInfo().boundingBox.intersectsMinMax(d.minPoint,d.maxPoint)&&d.entries.push(b)},e);b.Octree=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(b,c,d,f,m,j){this.entries=[];this._boundingVectors=[];this._capacity=d;this._depth=f;this._maxDepth=m;this._creationFunc=j;this._minPoint=b;this._maxPoint=c;this._boundingVectors.push(b.clone());this._boundingVectors.push(c.clone());this._boundingVectors.push(b.clone());this._boundingVectors[2].x=c.x;this._boundingVectors.push(b.clone());this._boundingVectors[3].y=c.y;this._boundingVectors.push(b.clone());this._boundingVectors[4].z=c.z;this._boundingVectors.push(c.clone());
this._boundingVectors[5].z=b.z;this._boundingVectors.push(c.clone());this._boundingVectors[6].x=b.x;this._boundingVectors.push(c.clone());this._boundingVectors[7].y=b.y};f=(Object.defineProperty(f.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"minPoint",{get:function(){return this._minPoint},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"maxPoint",{get:function(){return this._maxPoint},enumerable:!0,
configurable:!0}),f.prototype.addEntry=function(b){if(this.blocks)for(var c=0;c<this.blocks.length;c++)this.blocks[c].addEntry(b);else this._creationFunc(b,this),this.entries.length>this.capacity&&this._depth<this._maxDepth&&this.createInnerBlocks()},f.prototype.addEntries=function(b){for(var c=0;c<b.length;c++)this.addEntry(b[c])},f.prototype.select=function(e,c,d){if(b.BoundingBox.IsInFrustum(this._boundingVectors,e))if(this.blocks)for(var f=0;f<this.blocks.length;f++)this.blocks[f].select(e,c,
d);else d?c.concat(this.entries):c.concatWithNoDuplicate(this.entries)},f.prototype.intersects=function(e,c,d,f){if(b.BoundingBox.IntersectsSphere(this._minPoint,this._maxPoint,e,c))if(this.blocks)for(var m=0;m<this.blocks.length;m++)this.blocks[m].intersects(e,c,d,f);else f?d.concat(this.entries):d.concatWithNoDuplicate(this.entries)},f.prototype.intersectsRay=function(b,c){if(b.intersectsBoxMinMax(this._minPoint,this._maxPoint))if(this.blocks)for(var d=0;d<this.blocks.length;d++)this.blocks[d].intersectsRay(b,
c);else c.concatWithNoDuplicate(this.entries)},f.prototype.createInnerBlocks=function(){b.Octree._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc)},f);b.OctreeBlock=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.PostProcess;f=function(c,d,f,m,j,l,n,q){var p=this;void 0===l&&(l=b.Texture.BILINEAR_SAMPLINGMODE);e.call(this,c,"blur",["screenSize","direction","blurWidth"],null,m,j,l,n,q);this.direction=d;this.blurWidth=f;this.onApplyObservable.add(function(b){b.setFloat2("screenSize",p.width,p.height);b.setVector2("direction",p.direction);b.setFloat("blurWidth",p.blurWidth)})};f=(__extends(f,e),f);b.BlurPostProcess=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.PostProcess;f=function(c,d,f,m,j,l,n,q,p,r){var t=this;e.call(this,c,"refraction",["baseColor","depth","colorLevel"],["refractionSampler"],l,n,q,p,r);this.color=f;this.depth=m;this.colorLevel=j;this.onActivateObservable.add(function(c){t._refRexture=t._refRexture||new b.Texture(d,c.getScene())});this.onApplyObservable.add(function(b){b.setColor3("baseColor",t.color);b.setFloat("depth",t.depth);b.setFloat("colorLevel",t.colorLevel);b.setTexture("refractionSampler",t._refRexture)})};
f=(__extends(f,e),f.prototype.dispose=function(b){this._refRexture&&this._refRexture.dispose();e.prototype.dispose.call(this,b)},f);b.RefractionPostProcess=f}(BABYLON||(BABYLON={}));!function(b){var f,e=b.PostProcess;f=function(b,d,f,m,j,l){e.call(this,b,"blackAndWhite",null,null,d,f,m,j,l)};f=(__extends(f,e),f);b.BlackAndWhitePostProcess=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.PostProcess;f=function(b,d,f,m,j,l,n){var q=this;e.call(this,b,"convolution",["kernel","screenSize"],null,f,m,j,l,n);this.kernel=d;this.onApply=function(b){b.setFloat2("screenSize",q.width,q.height);b.setArray("kernel",q.kernel)}};f=(__extends(f,e),f.EdgeDetect0Kernel=[1,0,-1,0,0,0,-1,0,1],f.EdgeDetect1Kernel=[0,1,0,1,-4,1,0,1,0],f.EdgeDetect2Kernel=[-1,-1,-1,-1,8,-1,-1,-1,-1],f.SharpenKernel=[0,-1,0,-1,5,-1,0,-1,0],f.EmbossKernel=[-2,-1,0,-1,1,1,0,1,2],f.GaussianKernel=[0,
1,0,1,1,1,0,1,0],f);b.ConvolutionPostProcess=f}(BABYLON||(BABYLON={}));!function(b){var f,e=b.PostProcess;f=function(b,d,f,m,j,l,n){var q=this;e.call(this,b,"filter",["kernelMatrix"],null,f,m,j,l,n);this.kernelMatrix=d;this.onApply=function(b){b.setMatrix("kernelMatrix",q.kernelMatrix)}};f=(__extends(f,e),f);b.FilterPostProcess=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.PostProcess;f=function(b,d,f,m,j,l){var n=this;e.call(this,b,"fxaa",["texelSize"],null,d,f,m,j,l);this.onSizeChangedObservable.add(function(){n.texelWidth=1/n.width;n.texelHeight=1/n.height});this.onApplyObservable.add(function(b){b.setFloat2("texelSize",n.texelWidth,n.texelHeight)})};f=(__extends(f,e),f);b.FxaaPostProcess=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.PostProcess;f=function(c,d,f,m,j,l){var n=this;e.call(this,c,"stereoscopicInterlace",["stepSize"],["camASampler"],1,d[1],m,j,l,f?"#define IS_STEREOSCOPIC_HORIZ 1":void 0);this._passedProcess=d[0]._rigPostProcess;this._stepSize=new b.Vector2(1/this.width,1/this.height);this.onSizeChangedObservable.add(function(){n._stepSize=new b.Vector2(1/n.width,1/n.height)});this.onApplyObservable.add(function(b){b.setTextureFromPostProcess("camASampler",n._passedProcess);b.setFloat2("stepSize",
n._stepSize.x,n._stepSize.y)})};f=(__extends(f,e),f);b.StereoscopicInterlacePostProcess=f}(BABYLON||(BABYLON={}));!function(b){b.LensFlare=function(f,e,c,d,g){this.size=f;this.position=e;this.dispose=function(){this.texture&&this.texture.dispose();var b=this._system.lensFlares.indexOf(this);this._system.lensFlares.splice(b,1)};this.color=c||new b.Color3(1,1,1);this.texture=d?new b.Texture(d,g.getScene(),!0):null;this._system=g;g.lensFlares.push(this)}}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(c,d,e){this.name=c;this.lensFlares=[];this.borderLimit=300;this.layerMask=268435455;this._vertexBuffers={};this._isEnabled=!0;this._scene=e;this._emitter=d;this.id=c;e.lensFlareSystems.push(this);this.meshesSelectionPredicate=function(b){return b.material&&b.isVisible&&b.isEnabled()&&b.isBlocker&&0!=(b.layerMask&e.activeCamera.layerMask)};c=e.getEngine();d=[];d.push(1,1);d.push(-1,1);d.push(-1,-1);d.push(1,-1);this._vertexBuffers[b.VertexBuffer.PositionKind]=new b.VertexBuffer(c,
d,b.VertexBuffer.PositionKind,!1,!1,2);d=[];d.push(0);d.push(1);d.push(2);d.push(0);d.push(2);d.push(3);this._indexBuffer=c.createIndexBuffer(d);this._effect=c.createEffect("lensFlare",[b.VertexBuffer.PositionKind],["color","viewportMatrix"],["textureSampler"],"")};f=(Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(b){this._isEnabled=b},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype.getEmitter=function(){return this._emitter},
e.prototype.setEmitter=function(b){this._emitter=b},e.prototype.getEmitterPosition=function(){return this._emitter.getAbsolutePosition?this._emitter.getAbsolutePosition():this._emitter.position},e.prototype.computeEffectivePosition=function(c){var d=this.getEmitterPosition();return d=b.Vector3.Project(d,b.Matrix.Identity(),this._scene.getTransformMatrix(),c),this._positionX=d.x,this._positionY=d.y,d=b.Vector3.TransformCoordinates(this.getEmitterPosition(),this._scene.getViewMatrix()),0<d.z&&this._positionX>
c.x&&this._positionX<c.x+c.width&&this._positionY>c.y&&this._positionY<c.y+c.height},e.prototype._isVisible=function(){if(!this._isEnabled)return!1;var c=this.getEmitterPosition().subtract(this._scene.activeCamera.position),d=c.length();c.normalize();c=new b.Ray(this._scene.activeCamera.position,c);c=this._scene.pickWithRay(c,this.meshesSelectionPredicate,!0);return!c.hit||c.distance>d},e.prototype.render=function(){if(!this._effect.isReady())return!1;var c=this._scene.getEngine(),d=this._scene.activeCamera.viewport.toGlobal(c.getRenderWidth(!0),
c.getRenderHeight(!0));if(!this.computeEffectivePosition(d)||!this._isVisible())return!1;var e,f;e=this._positionX<this.borderLimit+d.x?this.borderLimit+d.x-this._positionX:this._positionX>d.x+d.width-this.borderLimit?this._positionX-d.x-d.width+this.borderLimit:0;f=this._positionY<this.borderLimit+d.y?this.borderLimit+d.y-this._positionY:this._positionY>d.y+d.height-this.borderLimit?this._positionY-d.y-d.height+this.borderLimit:0;e=e>f?e:f;e>this.borderLimit&&(e=this.borderLimit);e=1-e/this.borderLimit;
if(0>e)return!1;1<e&&(e=1);f=d.x+d.width/2;var j=d.y+d.height/2,l=f-this._positionX,n=j-this._positionY;c.enableEffect(this._effect);c.setState(!1);c.setDepthBuffer(!1);c.setAlphaMode(b.Engine.ALPHA_ONEONE);c.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect);for(var q=0;q<this.lensFlares.length;q++){var p=this.lensFlares[q],r=f-l*p.position,t=j-n*p.position,s=p.size,u=p.size*c.getAspectRatio(this._scene.activeCamera,!0),r=b.Matrix.FromValues(s/2,0,0,0,0,u/2,0,0,0,0,1,0,2*(r/d.width)-
1,1-2*(t/d.height),0,1);this._effect.setMatrix("viewportMatrix",r);this._effect.setTexture("textureSampler",p.texture);this._effect.setFloat4("color",p.color.r*e,p.color.g*e,p.color.b*e,1);c.draw(!0,0,6)}return c.setDepthBuffer(!0),c.setAlphaMode(b.Engine.ALPHA_DISABLE),!0},e.prototype.dispose=function(){var c=this._vertexBuffers[b.VertexBuffer.PositionKind];c&&(c.dispose(),this._vertexBuffers[b.VertexBuffer.PositionKind]=null);for(this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),
this._indexBuffer=null);this.lensFlares.length;)this.lensFlares[0].dispose();c=this._scene.lensFlareSystems.indexOf(this);this._scene.lensFlareSystems.splice(c,1)},e.Parse=function(c,d,f){var m=d.getLastEntryByID(c.emitterId),j=c.name||"lensFlareSystem#"+c.emitterId;d=new e(j,m,d);d.id=c.id||j;d.borderLimit=c.borderLimit;for(j=0;j<c.flares.length;j++)m=c.flares[j],new b.LensFlare(m.size,m.position,b.Color3.FromArray(m.color),f+m.textureName,d);return d},e.prototype.serialize=function(){var c={};c.id=
this.id;c.name=this.name;c.emitterId=this.getEmitter().id;c.borderLimit=this.borderLimit;c.flares=[];for(var d=0;d<this.lensFlares.length;d++){var e=this.lensFlares[d];c.flares.push({size:e.size,position:e.position,color:e.color.asArray(),textureName:b.Tools.GetFilename(e.texture.name)})}return c},e);b.LensFlareSystem=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.FreeCamera;f=function(b,d,f){e.call(this,b,d,f);this.inputs.addDeviceOrientation()};f=(__extends(f,e),Object.defineProperty(f.prototype,"angularSensibility",{get:function(){return 0},set:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"moveSensibility",{get:function(){return 0},set:function(){},enumerable:!0,configurable:!0}),f.prototype.getTypeName=function(){return"DeviceOrientationCamera"},f);b.DeviceOrientationCamera=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.TouchCamera;f=function(b,d,f){e.call(this,b,d,f);this.inputs.addGamepad()};f=(__extends(f,e),Object.defineProperty(f.prototype,"gamepadAngularSensibility",{get:function(){var b=this.inputs.attached.gamepad;return b?b.gamepadAngularSensibility:void 0},set:function(b){var d=this.inputs.attached.gamepad;d&&(d.gamepadAngularSensibility=b)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"gamepadMoveSensibility",{get:function(){var b=this.inputs.attached.gamepad;
return b?b.gamepadMoveSensibility:void 0},set:function(b){var d=this.inputs.attached.gamepad;d&&(d.gamepadMoveSensibility=b)},enumerable:!0,configurable:!0}),f.prototype.getTypeName=function(){return"UniversalCamera"},f);b.UniversalCamera=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=function(b){var c=this;this.babylonGamepads=[];this.isMonitoring=this.oneGamepadConnected=!1;this.gamepadEventSupported="GamepadEvent"in window;this.gamepadSupportAvailable=navigator.getGamepads||!!navigator.webkitGetGamepads||!!navigator.msGetGamepads||!!navigator.webkitGamepads;this._callbackGamepadConnected=b;this.gamepadSupportAvailable&&(this.gamepadEventSupported?(this._onGamepadConnectedEvent=function(b){c._onGamepadConnected(b)},this._onGamepadDisonnectedEvent=function(b){c._onGamepadDisconnected(b)},
window.addEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),window.addEventListener("gamepaddisconnected",this._onGamepadDisonnectedEvent,!1)):this._startMonitoringGamepads())};f=(e.prototype.dispose=function(){e.gamepadDOMInfo&&document.body.removeChild(e.gamepadDOMInfo);this._onGamepadConnectedEvent&&(window.removeEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),window.removeEventListener("gamepaddisconnected",this._onGamepadDisonnectedEvent,!1),this._onGamepadConnectedEvent=
null,this._onGamepadDisonnectedEvent=null)},e.prototype._onGamepadConnected=function(b){b=this._addNewGamepad(b.gamepad);this._callbackGamepadConnected&&this._callbackGamepadConnected(b);this._startMonitoringGamepads()},e.prototype._addNewGamepad=function(b){this.oneGamepadConnected||(this.oneGamepadConnected=!0,e.gamepadDOMInfo&&(document.body.removeChild(e.gamepadDOMInfo),e.gamepadDOMInfo=null));var c;return c=-1!==b.id.search("Xbox 360")||-1!==b.id.search("xinput")?new j(b.id,b.index,b):new d(b.id,
b.index,b),this.babylonGamepads.push(c),c},e.prototype._onGamepadDisconnected=function(b){for(var c in this.babylonGamepads)if(this.babylonGamepads[c].index==b.gamepad.index){this.babylonGamepads.splice(+c,1);break}0==this.babylonGamepads.length&&this._stopMonitoringGamepads()},e.prototype._startMonitoringGamepads=function(){this.isMonitoring||(this.isMonitoring=!0,this._checkGamepadsStatus())},e.prototype._stopMonitoringGamepads=function(){this.isMonitoring=!1},e.prototype._checkGamepadsStatus=function(){var b=
this;this._updateGamepadObjects();for(var c in this.babylonGamepads)this.babylonGamepads[c].update();this.isMonitoring&&(window.requestAnimationFrame?window.requestAnimationFrame(function(){b._checkGamepadsStatus()}):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(function(){b._checkGamepadsStatus()}):window.webkitRequestAnimationFrame&&window.webkitRequestAnimationFrame(function(){b._checkGamepadsStatus()}))},e.prototype._updateGamepadObjects=function(){for(var b=navigator.getGamepads?
navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],c=0;c<b.length;c++)if(b[c])if(b[c].index in this.babylonGamepads)this.babylonGamepads[c].browserGamepad=b[c];else{var d=this._addNewGamepad(b[c]);this._callbackGamepadConnected&&this._callbackGamepadConnected(d)}},e);b.Gamepads=f;b.StickValues=function(b,c){this.x=b;this.y=c};var c;f=function(b,c,d){this.id=b;this.index=c;this.browserGamepad=d;2<=this.browserGamepad.axes.length&&(this._leftStick={x:this.browserGamepad.axes[0],
y:this.browserGamepad.axes[1]});4<=this.browserGamepad.axes.length&&(this._rightStick={x:this.browserGamepad.axes[2],y:this.browserGamepad.axes[3]})};c=(f.prototype.onleftstickchanged=function(b){this._onleftstickchanged=b},f.prototype.onrightstickchanged=function(b){this._onrightstickchanged=b},Object.defineProperty(f.prototype,"leftStick",{get:function(){return this._leftStick},set:function(b){!this._onleftstickchanged||this._leftStick.x===b.x&&this._leftStick.y===b.y||this._onleftstickchanged(b);
this._leftStick=b},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"rightStick",{get:function(){return this._rightStick},set:function(b){!this._onrightstickchanged||this._rightStick.x===b.x&&this._rightStick.y===b.y||this._onrightstickchanged(b);this._rightStick=b},enumerable:!0,configurable:!0}),f.prototype.update=function(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[0],y:this.browserGamepad.axes[1]});this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[2],
y:this.browserGamepad.axes[3]})},f);b.Gamepad=c;var d;f=function(b,d,e){c.call(this,b,d,e);this.id=b;this.index=d;this.gamepad=e;this._buttons=Array(e.buttons.length)};d=(__extends(f,c),f.prototype.onbuttondown=function(b){this._onbuttondown=b},f.prototype.onbuttonup=function(b){this._onbuttonup=b},f.prototype._setButtonValue=function(b,c,d){return b!==c&&(this._onbuttondown&&1===b&&this._onbuttondown(d),this._onbuttonup&&0===b&&this._onbuttonup(d)),b},f.prototype.update=function(){c.prototype.update.call(this);
for(var b=0;b<this._buttons.length;b++)this._buttons[b]=this._setButtonValue(this.gamepad.buttons[b].value,this._buttons[b],b)},f);b.GenericPad=d;f=b.Xbox360Button||(b.Xbox360Button={});f[f.A=0]="A";f[f.B=1]="B";f[f.X=2]="X";f[f.Y=3]="Y";f[f.Start=4]="Start";f[f.Back=5]="Back";f[f.LB=6]="LB";f[f.RB=7]="RB";f[f.LeftStick=8]="LeftStick";f[f.RightStick=9]="RightStick";var g=b.Xbox360Button;f=b.Xbox360Dpad||(b.Xbox360Dpad={});f[f.Up=0]="Up";f[f.Down=1]="Down";f[f.Left=2]="Left";f[f.Right=3]="Right";!0;
var m=b.Xbox360Dpad,j;f=function(){c.apply(this,arguments);this._dPadRight=this._dPadLeft=this._dPadDown=this._dPadUp=this._buttonRightStick=this._buttonLeftStick=this._buttonRB=this._buttonLB=this._buttonStart=this._buttonBack=this._buttonY=this._buttonX=this._buttonB=this._buttonA=this._rightTrigger=this._leftTrigger=0};j=(__extends(f,c),f.prototype.onlefttriggerchanged=function(b){this._onlefttriggerchanged=b},f.prototype.onrighttriggerchanged=function(b){this._onrighttriggerchanged=b},Object.defineProperty(f.prototype,
"leftTrigger",{get:function(){return this._leftTrigger},set:function(b){this._onlefttriggerchanged&&this._leftTrigger!==b&&this._onlefttriggerchanged(b);this._leftTrigger=b},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(b){this._onrighttriggerchanged&&this._rightTrigger!==b&&this._onrighttriggerchanged(b);this._rightTrigger=b},enumerable:!0,configurable:!0}),f.prototype.onbuttondown=function(b){this._onbuttondown=
b},f.prototype.onbuttonup=function(b){this._onbuttonup=b},f.prototype.ondpaddown=function(b){this._ondpaddown=b},f.prototype.ondpadup=function(b){this._ondpadup=b},f.prototype._setButtonValue=function(b,c,d){return b!==c&&(this._onbuttondown&&1===b&&this._onbuttondown(d),this._onbuttonup&&0===b&&this._onbuttonup(d)),b},f.prototype._setDPadValue=function(b,c,d){return b!==c&&(this._ondpaddown&&1===b&&this._ondpaddown(d),this._ondpadup&&0===b&&this._ondpadup(d)),b},Object.defineProperty(f.prototype,
"buttonA",{get:function(){return this._buttonA},set:function(b){this._buttonA=this._setButtonValue(b,this._buttonA,g.A)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"buttonB",{get:function(){return this._buttonB},set:function(b){this._buttonB=this._setButtonValue(b,this._buttonB,g.B)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"buttonX",{get:function(){return this._buttonX},set:function(b){this._buttonX=this._setButtonValue(b,this._buttonX,g.X)},enumerable:!0,
configurable:!0}),Object.defineProperty(f.prototype,"buttonY",{get:function(){return this._buttonY},set:function(b){this._buttonY=this._setButtonValue(b,this._buttonY,g.Y)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"buttonStart",{get:function(){return this._buttonStart},set:function(b){this._buttonStart=this._setButtonValue(b,this._buttonStart,g.Start)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"buttonBack",{get:function(){return this._buttonBack},set:function(b){this._buttonBack=
this._setButtonValue(b,this._buttonBack,g.Back)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"buttonLB",{get:function(){return this._buttonLB},set:function(b){this._buttonLB=this._setButtonValue(b,this._buttonLB,g.LB)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"buttonRB",{get:function(){return this._buttonRB},set:function(b){this._buttonRB=this._setButtonValue(b,this._buttonRB,g.RB)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"buttonLeftStick",
{get:function(){return this._buttonLeftStick},set:function(b){this._buttonLeftStick=this._setButtonValue(b,this._buttonLeftStick,g.LeftStick)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(b){this._buttonRightStick=this._setButtonValue(b,this._buttonRightStick,g.RightStick)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(b){this._dPadUp=
this._setDPadValue(b,this._dPadUp,m.Up)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(b){this._dPadDown=this._setDPadValue(b,this._dPadDown,m.Down)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(b){this._dPadLeft=this._setDPadValue(b,this._dPadLeft,m.Left)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"dPadRight",
{get:function(){return this._dPadRight},set:function(b){this._dPadRight=this._setDPadValue(b,this._dPadRight,m.Right)},enumerable:!0,configurable:!0}),f.prototype.update=function(){c.prototype.update.call(this);this.buttonA=this.browserGamepad.buttons[0].value;this.buttonB=this.browserGamepad.buttons[1].value;this.buttonX=this.browserGamepad.buttons[2].value;this.buttonY=this.browserGamepad.buttons[3].value;this.buttonLB=this.browserGamepad.buttons[4].value;this.buttonRB=this.browserGamepad.buttons[5].value;
this.leftTrigger=this.browserGamepad.buttons[6].value;this.rightTrigger=this.browserGamepad.buttons[7].value;this.buttonBack=this.browserGamepad.buttons[8].value;this.buttonStart=this.browserGamepad.buttons[9].value;this.buttonLeftStick=this.browserGamepad.buttons[10].value;this.buttonRightStick=this.browserGamepad.buttons[11].value;this.dPadUp=this.browserGamepad.buttons[12].value;this.dPadDown=this.browserGamepad.buttons[13].value;this.dPadLeft=this.browserGamepad.buttons[14].value;this.dPadRight=
this.browserGamepad.buttons[15].value},f);b.Xbox360Pad=j}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.UniversalCamera;f=function(c,d,f){b.Tools.Warn("Deprecated. Please use Universal Camera instead.");e.call(this,c,d,f)};f=(__extends(f,e),Object.defineProperty(f.prototype,"gamepadAngularSensibility",{get:function(){var b=this.inputs.attached.gamepad;return b?b.gamepadAngularSensibility:void 0},set:function(b){var d=this.inputs.attached.gamepad;d&&(d.gamepadAngularSensibility=b)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"gamepadMoveSensibility",{get:function(){var b=
this.inputs.attached.gamepad;return b?b.gamepadMoveSensibility:void 0},set:function(b){var d=this.inputs.attached.gamepad;d&&(d.gamepadMoveSensibility=b)},enumerable:!0,configurable:!0}),f.prototype.getTypeName=function(){return"GamepadCamera"},f);b.GamepadCamera=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(e){this.SMOOTHING=0.75;this.FFT_SIZE=512;this.BARGRAPHAMPLITUDE=256;this.DEBUGCANVASPOS={x:20,y:20};this.DEBUGCANVASSIZE={width:320,height:200};this._scene=e;this._audioEngine=b.Engine.audioEngine;this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser=this._audioEngine.audioContext.createAnalyser(),this._webAudioAnalyser.minDecibels=-140,this._webAudioAnalyser.maxDecibels=0,this._byteFreqs=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._byteTime=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),
this._floatFreqs=new Float32Array(this._webAudioAnalyser.frequencyBinCount))};f=(f.prototype.getFrequencyBinCount=function(){return this._audioEngine.canUseWebAudio?this._webAudioAnalyser.frequencyBinCount:0},f.prototype.getByteFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteFrequencyData(this._byteFreqs)),this._byteFreqs},f.prototype.getByteTimeDomainData=
function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteTimeDomainData(this._byteTime)),this._byteTime},f.prototype.getFloatFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getFloatFrequencyData(this._floatFreqs)),this._floatFreqs},
f.prototype.drawDebugCanvas=function(){var b=this;if(this._audioEngine.canUseWebAudio&&(this._debugCanvas||(this._debugCanvas=document.createElement("canvas"),this._debugCanvas.width=this.DEBUGCANVASSIZE.width,this._debugCanvas.height=this.DEBUGCANVASSIZE.height,this._debugCanvas.style.position="absolute",this._debugCanvas.style.top=this.DEBUGCANVASPOS.y+"px",this._debugCanvas.style.left=this.DEBUGCANVASPOS.x+"px",this._debugCanvasContext=this._debugCanvas.getContext("2d"),document.body.appendChild(this._debugCanvas),
this._registerFunc=function(){b.drawDebugCanvas()},this._scene.registerBeforeRender(this._registerFunc)),this._registerFunc)){var c=this.getByteFrequencyData();this._debugCanvasContext.fillStyle="rgb(0, 0, 0)";this._debugCanvasContext.fillRect(0,0,this.DEBUGCANVASSIZE.width,this.DEBUGCANVASSIZE.height);for(var d=0;d<this.getFrequencyBinCount();d++){var f=this.DEBUGCANVASSIZE.height*(c[d]/this.BARGRAPHAMPLITUDE),m=this.DEBUGCANVASSIZE.height-f-1,j=this.DEBUGCANVASSIZE.width/this.getFrequencyBinCount(),
l=360*(d/this.getFrequencyBinCount());this._debugCanvasContext.fillStyle="hsl("+l+", 100%, 50%)";this._debugCanvasContext.fillRect(d*j,m,j,f)}}},f.prototype.stopDebugCanvas=function(){this._debugCanvas&&(this._scene.unregisterBeforeRender(this._registerFunc),this._registerFunc=null,document.body.removeChild(this._debugCanvas),this._debugCanvas=null,this._debugCanvasContext=null)},f.prototype.connectAudioNodes=function(b,c){this._audioEngine.canUseWebAudio&&(b.connect(this._webAudioAnalyser),this._webAudioAnalyser.connect(c))},
f.prototype.dispose=function(){this._audioEngine.canUseWebAudio&&this._webAudioAnalyser.disconnect()},f);b.Analyser=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(e,c){var d=this;void 0===c&&(c=b.Engine.TEXTURETYPE_FLOAT);this._viewMatrix=b.Matrix.Zero();this._projectionMatrix=b.Matrix.Zero();this._transformMatrix=b.Matrix.Zero();this._worldViewProjection=b.Matrix.Zero();this._scene=e;var f=e.getEngine();this._depthMap=new b.RenderTargetTexture("depthMap",{width:f.getRenderWidth(),height:f.getRenderHeight()},this._scene,!1,!0,c);this._depthMap.wrapU=b.Texture.CLAMP_ADDRESSMODE;this._depthMap.wrapV=b.Texture.CLAMP_ADDRESSMODE;this._depthMap.refreshRate=
1;this._depthMap.renderParticles=!1;this._depthMap.renderList=null;this._depthMap.onClearObservable.add(function(c){c.clear(new b.Color4(1,1,1,1),!0,!0)});var m=function(c){var e=c.getRenderingMesh(),f=d._scene,g=f.getEngine();g.setState(c.getMaterial().backFaceCulling);var m=e._getInstancesRenderList(c._id);if(!m.mustReturn){var r=null!==g.getCaps().instancedArrays&&null!==m.visibleInstances[c._id];if(d.isReady(c,r)){g.enableEffect(d._effect);e._bind(c,d._effect,b.Material.TriangleFillMode);g=c.getMaterial();
if(d._effect.setMatrix("viewProjection",f.getTransformMatrix()),d._effect.setFloat("far",f.activeCamera.maxZ),g&&g.needAlphaTesting())f=g.getAlphaTestTexture(),d._effect.setTexture("diffuseSampler",f),d._effect.setMatrix("diffuseMatrix",f.getTextureMatrix());e.useBones&&e.computeBonesUsingShaders&&d._effect.setMatrices("mBones",e.skeleton.getTransformMatrices(e));e._processRendering(c,d._effect,b.Material.TriangleFillMode,m,r,function(b,c){return d._effect.setMatrix("world",c)})}}};this._depthMap.customRenderFunction=
function(b,c){var d;for(d=0;d<b.length;d++)m(b.data[d]);for(d=0;d<c.length;d++)m(c.data[d])}};f=(f.prototype.isReady=function(e,c){var d=e.getMaterial();if(d.disableDepthWrite)return!1;var f=[],m=[b.VertexBuffer.PositionKind],j=e.getMesh();j.getScene();d&&d.needAlphaTesting()&&(f.push("#define ALPHATEST"),j.isVerticesDataPresent(b.VertexBuffer.UVKind)&&(m.push(b.VertexBuffer.UVKind),f.push("#define UV1")),j.isVerticesDataPresent(b.VertexBuffer.UV2Kind)&&(m.push(b.VertexBuffer.UV2Kind),f.push("#define UV2")));
j.useBones&&j.computeBonesUsingShaders?(m.push(b.VertexBuffer.MatricesIndicesKind),m.push(b.VertexBuffer.MatricesWeightsKind),4<j.numBoneInfluencers&&(m.push(b.VertexBuffer.MatricesIndicesExtraKind),m.push(b.VertexBuffer.MatricesWeightsExtraKind)),f.push("#define NUM_BONE_INFLUENCERS "+j.numBoneInfluencers),f.push("#define BonesPerMesh "+(j.skeleton.bones.length+1))):f.push("#define NUM_BONE_INFLUENCERS 0");c&&(f.push("#define INSTANCES"),m.push("world0"),m.push("world1"),m.push("world2"),m.push("world3"));
d=f.join("\n");return this._cachedDefines!==d&&(this._cachedDefines=d,this._effect=this._scene.getEngine().createEffect("depth",m,["world","mBones","viewProjection","diffuseMatrix","far"],["diffuseSampler"],d)),this._effect.isReady()},f.prototype.getDepthMap=function(){return this._depthMap},f.prototype.dispose=function(){this._depthMap.dispose()},f);b.DepthRenderer=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.PostProcessRenderPipeline;f=function(c,d,f,m){var j=this;e.call(this,d.getEngine(),c);this.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect";this.SSAORenderEffect="SSAORenderEffect";this.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect";this.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect";this.SSAOCombineRenderEffect="SSAOCombineRenderEffect";this.totalStrength=1;this.radius=1E-4;this.area=0.0075;this.fallOff=1E-6;this.base=0.5;this._firstUpdate=!0;this._scene=d;this._createRandomTexture();
this._depthTexture=d.enableDepthRenderer().getDepthMap();var l=f.ssaoRatio||f;f=f.combineRatio||f;this._ratio={ssaoRatio:l,combineRatio:f};this._originalColorPostProcess=new b.PassPostProcess("SSAOOriginalSceneColor",f,null,b.Texture.BILINEAR_SAMPLINGMODE,d.getEngine(),!1);this._createSSAOPostProcess(l);this._createBlurPostProcess(l);this._createSSAOCombinePostProcess(f);this.addEffect(new b.PostProcessRenderEffect(d.getEngine(),this.SSAOOriginalSceneColorEffect,function(){return j._originalColorPostProcess},
!0));this.addEffect(new b.PostProcessRenderEffect(d.getEngine(),this.SSAORenderEffect,function(){return j._ssaoPostProcess},!0));this.addEffect(new b.PostProcessRenderEffect(d.getEngine(),this.SSAOBlurHRenderEffect,function(){return j._blurHPostProcess},!0));this.addEffect(new b.PostProcessRenderEffect(d.getEngine(),this.SSAOBlurVRenderEffect,function(){return j._blurVPostProcess},!0));this.addEffect(new b.PostProcessRenderEffect(d.getEngine(),this.SSAOCombineRenderEffect,function(){return j._ssaoCombinePostProcess},
!0));d.postProcessRenderPipelineManager.addPipeline(this);m&&d.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(c,m)};f=(__extends(f,e),f.prototype.getBlurHPostProcess=function(){return b.Tools.Error("SSAORenderinPipeline.getBlurHPostProcess() is deprecated, no more blur post-process exists"),null},f.prototype.getBlurVPostProcess=function(){return b.Tools.Error("SSAORenderinPipeline.getBlurVPostProcess() is deprecated, no more blur post-process exists"),null},f.prototype.dispose=function(b){void 0===
b&&(b=!1);for(var d=0;d<this._scene.cameras.length;d++){var e=this._scene.cameras[d];this._originalColorPostProcess.dispose(e);this._ssaoPostProcess.dispose(e);this._blurHPostProcess.dispose(e);this._blurVPostProcess.dispose(e);this._ssaoCombinePostProcess.dispose(e)}this._randomTexture.dispose();b&&this._scene.disableDepthRenderer();this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras)},f.prototype._createBlurPostProcess=function(c){for(var d=
this,e=[],f=-8;8>f;f++)e.push(2*f);this._blurHPostProcess=new b.PostProcess("BlurH","ssao",["outSize","samplerOffsets"],["depthSampler"],c,null,b.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define BILATERAL_BLUR_H\n#define SAMPLES 16");this._blurHPostProcess.onApply=function(b){b.setFloat("outSize",d._ssaoCombinePostProcess.width);b.setTexture("depthSampler",d._depthTexture);d._firstUpdate&&b.setArray("samplerOffsets",e)};this._blurVPostProcess=new b.PostProcess("BlurV",
"ssao",["outSize","samplerOffsets"],["depthSampler"],c,null,b.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define SAMPLES 16");this._blurVPostProcess.onApply=function(b){b.setFloat("outSize",d._ssaoCombinePostProcess.height);b.setTexture("depthSampler",d._depthTexture);d._firstUpdate&&(b.setArray("samplerOffsets",e),d._firstUpdate=!1)}},f.prototype._createSSAOPostProcess=function(c){var d=this,e=[0.5381,0.1856,-0.4319,0.1379,0.2486,0.443,0.3371,0.5679,-0.0057,
-0.6999,-0.0451,-0.0019,0.0689,-0.1598,-0.8547,0.056,0.0069,-0.1843,-0.0146,0.1402,0.0762,0.01,-0.1924,-0.0344,-0.3577,-0.5301,-0.4358,-0.3169,0.1063,0.0158,0.0103,-0.5869,0.0046,-0.0897,-0.494,0.3287,0.7119,-0.0154,-0.0918,-0.0533,0.0596,-0.5411,0.0352,-0.0631,0.546,-0.4776,0.2847,-0.0271];this._ssaoPostProcess=new b.PostProcess("ssao","ssao","sampleSphere samplesFactor randTextureTiles totalStrength radius area fallOff base range viewport".split(" "),["randomSampler"],c,null,b.Texture.BILINEAR_SAMPLINGMODE,
this._scene.getEngine(),!1,"#define SAMPLES 16\n#define SSAO");new b.Vector2(0,0);this._ssaoPostProcess.onApply=function(b){d._firstUpdate&&(b.setArray3("sampleSphere",e),b.setFloat("samplesFactor",0.0625),b.setFloat("randTextureTiles",4));b.setFloat("totalStrength",d.totalStrength);b.setFloat("radius",d.radius);b.setFloat("area",d.area);b.setFloat("fallOff",d.fallOff);b.setFloat("base",d.base);b.setTexture("textureSampler",d._depthTexture);b.setTexture("randomSampler",d._randomTexture)}},f.prototype._createSSAOCombinePostProcess=
function(c){var d=this;this._ssaoCombinePostProcess=new b.PostProcess("ssaoCombine","ssaoCombine",[],["originalColor"],c,null,b.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1);this._ssaoCombinePostProcess.onApply=function(b){b.setTextureFromPostProcess("originalColor",d._originalColorPostProcess)}},f.prototype._createRandomTexture=function(){this._randomTexture=new b.DynamicTexture("SSAORandomTexture",512,this._scene,!1,b.Texture.TRILINEAR_SAMPLINGMODE);this._randomTexture.wrapU=b.Texture.WRAP_ADDRESSMODE;
this._randomTexture.wrapV=b.Texture.WRAP_ADDRESSMODE;for(var c=this._randomTexture.getContext(),d=b.Vector3.Zero(),e=0;512>e;e++)for(var f=0;512>f;f++)d.x=Math.floor(255*(2*Math.random()+-1)),d.y=Math.floor(255*(2*Math.random()+-1)),d.z=Math.floor(255*(2*Math.random()+-1)),c.fillStyle="rgb("+d.x+", "+d.y+", "+d.z+")",c.fillRect(e,f,1,1);this._randomTexture.update(!1)},__decorate([b.serialize()],f.prototype,"totalStrength",void 0),__decorate([b.serialize()],f.prototype,"radius",void 0),__decorate([b.serialize()],
f.prototype,"area",void 0),__decorate([b.serialize()],f.prototype,"fallOff",void 0),__decorate([b.serialize()],f.prototype,"base",void 0),__decorate([b.serialize()],f.prototype,"_ratio",void 0),f);b.SSAORenderingPipeline=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.PostProcess,c=function(d,f,m,j,l,n,q,p,r){var t=this;void 0===l&&(l=100);void 0===n&&(n=b.Texture.BILINEAR_SAMPLINGMODE);e.call(this,d,"volumetricLightScattering",["decay","exposure","weight","meshPositionOnScreen","density"],["lightScatteringSampler"],f.postProcessRatio||f,m,n,q,p,"#define NUM_SAMPLES "+l);this._screenCoordinates=b.Vector2.Zero();this.customMeshPosition=b.Vector3.Zero();this.useCustomMeshPosition=!1;this.invert=!0;this.excludedMeshes=[];this.exposure=0.3;this.decay=
0.96815;this.weight=0.58767;this.density=0.926;r=null===m?r:m.getScene();q=r.getEngine();this._viewPort=(new b.Viewport(0,0,1,1)).toGlobal(q.getRenderWidth(),q.getRenderHeight());this.mesh=null!==j?j:c.CreateDefaultMesh("VolumetricLightScatteringMesh",r);this._createPass(r,f.passRatio||f);this.onActivate=function(b){t.isSupported||t.dispose(b);t.onActivate=null};this.onApplyObservable.add(function(b){t._updateMeshScreenCoordinates(r);b.setTexture("lightScatteringSampler",t._volumetricLightScatteringRTT);
b.setFloat("exposure",t.exposure);b.setFloat("decay",t.decay);b.setFloat("weight",t.weight);b.setFloat("density",t.density);b.setVector2("meshPositionOnScreen",t._screenCoordinates)})};f=(__extends(c,e),Object.defineProperty(c.prototype,"useDiffuseColor",{get:function(){return b.Tools.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead"),!1},set:function(){b.Tools.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead")},
enumerable:!0,configurable:!0}),c.prototype.isReady=function(c,e){var f=c.getMesh();if(f===this.mesh)return f.material.isReady(f);var j=[],l=[b.VertexBuffer.PositionKind],n=c.getMaterial();n&&(n.needAlphaTesting()&&j.push("#define ALPHATEST"),f.isVerticesDataPresent(b.VertexBuffer.UVKind)&&(l.push(b.VertexBuffer.UVKind),j.push("#define UV1")),f.isVerticesDataPresent(b.VertexBuffer.UV2Kind)&&(l.push(b.VertexBuffer.UV2Kind),j.push("#define UV2")));f.useBones&&f.computeBonesUsingShaders?(l.push(b.VertexBuffer.MatricesIndicesKind),
l.push(b.VertexBuffer.MatricesWeightsKind),j.push("#define NUM_BONE_INFLUENCERS "+f.numBoneInfluencers),j.push("#define BonesPerMesh "+(f.skeleton.bones.length+1))):j.push("#define NUM_BONE_INFLUENCERS 0");e&&(j.push("#define INSTANCES"),l.push("world0"),l.push("world1"),l.push("world2"),l.push("world3"));j=j.join("\n");return this._cachedDefines!==j&&(this._cachedDefines=j,this._volumetricLightScatteringPass=f.getScene().getEngine().createEffect({vertexElement:"depth",fragmentElement:"volumetricLightScatteringPass"},
l,["world","mBones","viewProjection","diffuseMatrix"],["diffuseSampler"],j)),this._volumetricLightScatteringPass.isReady()},c.prototype.setCustomMeshPosition=function(b){this.customMeshPosition=b},c.prototype.getCustomMeshPosition=function(){return this.customMeshPosition},c.prototype.dispose=function(b){var c=b.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT);-1!==c&&b.getScene().customRenderTargets.splice(c,1);this._volumetricLightScatteringRTT.dispose();e.prototype.dispose.call(this,
b)},c.prototype.getPass=function(){return this._volumetricLightScatteringRTT},c.prototype._meshExcluded=function(b){return 0<this.excludedMeshes.length&&-1!==this.excludedMeshes.indexOf(b)},c.prototype._createPass=function(c,e){var f=this,j=c.getEngine();this._volumetricLightScatteringRTT=new b.RenderTargetTexture("volumetricLightScatteringMap",{width:j.getRenderWidth()*e,height:j.getRenderHeight()*e},c,!1,!0,b.Engine.TEXTURETYPE_UNSIGNED_INT);this._volumetricLightScatteringRTT.wrapU=b.Texture.CLAMP_ADDRESSMODE;
this._volumetricLightScatteringRTT.wrapV=b.Texture.CLAMP_ADDRESSMODE;this._volumetricLightScatteringRTT.renderList=null;this._volumetricLightScatteringRTT.renderParticles=!1;c.customRenderTargets.push(this._volumetricLightScatteringRTT);var l,n=function(c){var d=c.getRenderingMesh();if(!f._meshExcluded(d)){var e=d.getScene(),g=e.getEngine();g.setState(c.getMaterial().backFaceCulling);var j=d._getInstancesRenderList(c._id);if(!j.mustReturn){var l=null!==g.getCaps().instancedArrays&&null!==j.visibleInstances[c._id];
if(f.isReady(c,l)){var n=f._volumetricLightScatteringPass;if(d===f.mesh&&(n=c.getMaterial().getEffect()),g.enableEffect(n),d._bind(c,n,b.Material.TriangleFillMode),d===f.mesh)c.getMaterial().bind(d.getWorldMatrix(),d);else{g=c.getMaterial();if(f._volumetricLightScatteringPass.setMatrix("viewProjection",e.getTransformMatrix()),g&&g.needAlphaTesting())e=g.getAlphaTestTexture(),f._volumetricLightScatteringPass.setTexture("diffuseSampler",e),e&&f._volumetricLightScatteringPass.setMatrix("diffuseMatrix",
e.getTextureMatrix());d.useBones&&d.computeBonesUsingShaders&&f._volumetricLightScatteringPass.setMatrices("mBones",d.skeleton.getTransformMatrices(d))}d._processRendering(c,f._volumetricLightScatteringPass,b.Material.TriangleFillMode,j,l,function(b,c){return n.setMatrix("world",c)})}}}},q=new b.Color4(0,0,0,1);this._volumetricLightScatteringRTT.onBeforeRenderObservable.add(function(){l=c.clearColor;c.clearColor=q});this._volumetricLightScatteringRTT.onAfterRenderObservable.add(function(){c.clearColor=
l});this._volumetricLightScatteringRTT.customRenderFunction=function(e,f,g){var j,l=c.getEngine();for(j=0;j<e.length;j++)n(e.data[j]);l.setAlphaTesting(!0);for(j=0;j<f.length;j++)n(f.data[j]);if(l.setAlphaTesting(!1),g.length){for(j=0;j<g.length;j++)e=g.data[j],e._alphaIndex=e.getMesh().alphaIndex,e._distanceToCamera=e.getBoundingInfo().boundingSphere.centerWorld.subtract(c.activeCamera.position).length();g=g.data.slice(0,g.length);g.sort(function(b,c){return b._alphaIndex>c._alphaIndex?1:b._alphaIndex<
c._alphaIndex?-1:b._distanceToCamera<c._distanceToCamera?1:b._distanceToCamera>c._distanceToCamera?-1:0});l.setAlphaMode(b.Engine.ALPHA_COMBINE);for(j=0;j<g.length;j++)n(g[j]);l.setAlphaMode(b.Engine.ALPHA_DISABLE)}}},c.prototype._updateMeshScreenCoordinates=function(c){var e=c.getTransformMatrix();c=this.useCustomMeshPosition?this.customMeshPosition:this.attachedNode?this.attachedNode.position:this.mesh.parent?this.mesh.getAbsolutePosition():this.mesh.position;c=b.Vector3.Project(c,b.Matrix.Identity(),
e,this._viewPort);this._screenCoordinates.x=c.x/this._viewPort.width;this._screenCoordinates.y=c.y/this._viewPort.height;this.invert&&(this._screenCoordinates.y=1-this._screenCoordinates.y)},c.CreateDefaultMesh=function(c,e){var f=b.Mesh.CreatePlane(c,1,e);f.billboardMode=b.AbstractMesh.BILLBOARDMODE_ALL;var j=new b.StandardMaterial(c+"Material",e);return j.emissiveColor=new b.Color3(1,1,1),f.material=j,f},__decorate([b.serializeAsVector3()],c.prototype,"customMeshPosition",void 0),__decorate([b.serialize()],
c.prototype,"useCustomMeshPosition",void 0),__decorate([b.serialize()],c.prototype,"invert",void 0),__decorate([b.serializeAsMeshReference()],c.prototype,"mesh",void 0),__decorate([b.serialize()],c.prototype,"excludedMeshes",void 0),__decorate([b.serialize()],c.prototype,"exposure",void 0),__decorate([b.serialize()],c.prototype,"decay",void 0),__decorate([b.serialize()],c.prototype,"weight",void 0),__decorate([b.serialize()],c.prototype,"density",void 0),c);b.VolumetricLightScatteringPostProcess=
f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.PostProcessRenderPipeline;f=function(c,d,f,m,j){var l=this;void 0===m&&(m=1);e.call(this,f.getEngine(),c);this.LensChromaticAberrationEffect="LensChromaticAberrationEffect";this.HighlightsEnhancingEffect="HighlightsEnhancingEffect";this.LensDepthOfFieldEffect="LensDepthOfFieldEffect";this._scene=f;this._depthTexture=f.enableDepthRenderer().getDepthMap();d.grain_texture?this._grainTexture=d.grain_texture:this._createGrainTexture();this._edgeBlur=d.edge_blur?d.edge_blur:0;this._grainAmount=
d.grain_amount?d.grain_amount:0;this._chromaticAberration=d.chromatic_aberration?d.chromatic_aberration:0;this._distortion=d.distortion?d.distortion:0;this._highlightsGain=void 0!==d.dof_gain?d.dof_gain:-1;this._highlightsThreshold=d.dof_threshold?d.dof_threshold:1;this._dofDistance=void 0!==d.dof_focus_distance?d.dof_focus_distance:-1;this._dofAperture=d.dof_aperture?d.dof_aperture:1;this._dofDarken=d.dof_darken?d.dof_darken:0;this._dofPentagon=void 0!==d.dof_pentagon?d.dof_pentagon:!0;this._blurNoise=
void 0!==d.blur_noise?d.blur_noise:!0;this._createChromaticAberrationPostProcess(m);this._createHighlightsPostProcess(m);this._createDepthOfFieldPostProcess(m/4);this.addEffect(new b.PostProcessRenderEffect(f.getEngine(),this.LensChromaticAberrationEffect,function(){return l._chromaticAberrationPostProcess},!0));this.addEffect(new b.PostProcessRenderEffect(f.getEngine(),this.HighlightsEnhancingEffect,function(){return l._highlightsPostProcess},!0));this.addEffect(new b.PostProcessRenderEffect(f.getEngine(),
this.LensDepthOfFieldEffect,function(){return l._depthOfFieldPostProcess},!0));-1===this._highlightsGain&&this._disableEffect(this.HighlightsEnhancingEffect,null);f.postProcessRenderPipelineManager.addPipeline(this);j&&f.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(c,j)};f=(__extends(f,e),f.prototype.setEdgeBlur=function(b){this._edgeBlur=b},f.prototype.disableEdgeBlur=function(){this._edgeBlur=0},f.prototype.setGrainAmount=function(b){this._grainAmount=b},f.prototype.disableGrain=
function(){this._grainAmount=0},f.prototype.setChromaticAberration=function(b){this._chromaticAberration=b},f.prototype.disableChromaticAberration=function(){this._chromaticAberration=0},f.prototype.setEdgeDistortion=function(b){this._distortion=b},f.prototype.disableEdgeDistortion=function(){this._distortion=0},f.prototype.setFocusDistance=function(b){this._dofDistance=b},f.prototype.disableDepthOfField=function(){this._dofDistance=-1},f.prototype.setAperture=function(b){this._dofAperture=b},f.prototype.setDarkenOutOfFocus=
function(b){this._dofDarken=b},f.prototype.enablePentagonBokeh=function(){this._highlightsPostProcess.updateEffect("#define PENTAGON\n")},f.prototype.disablePentagonBokeh=function(){this._highlightsPostProcess.updateEffect()},f.prototype.enableNoiseBlur=function(){this._blurNoise=!0},f.prototype.disableNoiseBlur=function(){this._blurNoise=!1},f.prototype.setHighlightsGain=function(b){this._highlightsGain=b},f.prototype.setHighlightsThreshold=function(b){-1===this._highlightsGain&&(this._highlightsGain=
1);this._highlightsThreshold=b},f.prototype.disableHighlights=function(){this._highlightsGain=-1},f.prototype.dispose=function(b){void 0===b&&(b=!1);this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras);this._depthOfFieldPostProcess=this._highlightsPostProcess=this._chromaticAberrationPostProcess=void 0;this._grainTexture.dispose();b&&this._scene.disableDepthRenderer()},f.prototype._createChromaticAberrationPostProcess=function(c){var d=this;
this._chromaticAberrationPostProcess=new b.PostProcess("LensChromaticAberration","chromaticAberration",["chromatic_aberration","screen_width","screen_height"],[],c,null,b.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1);this._chromaticAberrationPostProcess.onApply=function(b){b.setFloat("chromatic_aberration",d._chromaticAberration);b.setFloat("screen_width",d._scene.getEngine().getRenderingCanvas().width);b.setFloat("screen_height",d._scene.getEngine().getRenderingCanvas().height)}},f.prototype._createHighlightsPostProcess=
function(c){var d=this;this._highlightsPostProcess=new b.PostProcess("LensHighlights","lensHighlights",["gain","threshold","screen_width","screen_height"],[],c,null,b.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,this._dofPentagon?"#define PENTAGON\n":"");this._highlightsPostProcess.onApply=function(b){b.setFloat("gain",d._highlightsGain);b.setFloat("threshold",d._highlightsThreshold);b.setTextureFromPostProcess("textureSampler",d._chromaticAberrationPostProcess);b.setFloat("screen_width",
d._scene.getEngine().getRenderingCanvas().width);b.setFloat("screen_height",d._scene.getEngine().getRenderingCanvas().height)}},f.prototype._createDepthOfFieldPostProcess=function(c){var d=this;this._depthOfFieldPostProcess=new b.PostProcess("LensDepthOfField","depthOfField","grain_amount blur_noise screen_width screen_height distortion dof_enabled screen_distance aperture darken edge_blur highlights near far".split(" "),["depthSampler","grainSampler","highlightsSampler"],c,null,b.Texture.TRILINEAR_SAMPLINGMODE,
this._scene.getEngine(),!1);this._depthOfFieldPostProcess.onApply=function(b){b.setTexture("depthSampler",d._depthTexture);b.setTexture("grainSampler",d._grainTexture);b.setTextureFromPostProcess("textureSampler",d._highlightsPostProcess);b.setTextureFromPostProcess("highlightsSampler",d._depthOfFieldPostProcess);b.setFloat("grain_amount",d._grainAmount);b.setBool("blur_noise",d._blurNoise);b.setFloat("screen_width",d._scene.getEngine().getRenderingCanvas().width);b.setFloat("screen_height",d._scene.getEngine().getRenderingCanvas().height);
b.setFloat("distortion",d._distortion);b.setBool("dof_enabled",-1!==d._dofDistance);b.setFloat("screen_distance",1/(0.1-1/d._dofDistance));b.setFloat("aperture",d._dofAperture);b.setFloat("darken",d._dofDarken);b.setFloat("edge_blur",d._edgeBlur);b.setBool("highlights",-1!==d._highlightsGain);b.setFloat("near",d._scene.activeCamera.minZ);b.setFloat("far",d._scene.activeCamera.maxZ)}},f.prototype._createGrainTexture=function(){this._grainTexture=new b.DynamicTexture("LensNoiseTexture",512,this._scene,
!1,b.Texture.BILINEAR_SAMPLINGMODE);this._grainTexture.wrapU=b.Texture.WRAP_ADDRESSMODE;this._grainTexture.wrapV=b.Texture.WRAP_ADDRESSMODE;for(var c,d=this._grainTexture.getContext(),e=0;512>e;e++)for(var f=0;512>f;f++)c=Math.floor(255*(Math.random()*(0.58-0.42)+0.42)),d.fillStyle="rgb("+c+", "+c+", "+c+")",d.fillRect(e,f,1,1);this._grainTexture.update(!1)},f);b.LensRenderingPipeline=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.PostProcess;f=function(c,d,f,m,j,l,n){var q=this;e.call(this,c,"colorCorrection",null,["colorTable"],f,m,j,l,n);this._colorTableTexture=new b.Texture(d,m.getScene(),!0,!1,b.Texture.TRILINEAR_SAMPLINGMODE);this._colorTableTexture.anisotropicFilteringLevel=1;this._colorTableTexture.wrapU=b.Texture.CLAMP_ADDRESSMODE;this._colorTableTexture.wrapV=b.Texture.CLAMP_ADDRESSMODE;this.onApply=function(b){b.setTexture("colorTable",q._colorTableTexture)}};f=(__extends(f,e),f);b.ColorCorrectionPostProcess=
f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.FreeCamera;f=function(c,d,f,g){e.call(this,c,d,g);this.interaxialDistance=f;this.setCameraRigMode(b.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:f})};f=(__extends(f,e),f.prototype.getTypeName=function(){return"AnaglyphFreeCamera"},f);b.AnaglyphFreeCamera=f;var c=b.ArcRotateCamera;f=function(d,e,f,g,j,l,m){c.call(this,d,e,f,g,j,m);this.interaxialDistance=l;this.setCameraRigMode(b.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:l})};f=(__extends(f,c),f.prototype.getTypeName=
function(){return"AnaglyphArcRotateCamera"},f);b.AnaglyphArcRotateCamera=f;var d=b.GamepadCamera;f=function(c,e,f,g){d.call(this,c,e,g);this.interaxialDistance=f;this.setCameraRigMode(b.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:f})};f=(__extends(f,d),f.prototype.getTypeName=function(){return"AnaglyphGamepadCamera"},f);b.AnaglyphGamepadCamera=f;var g=b.UniversalCamera;f=function(c,d,e,f){g.call(this,c,d,f);this.interaxialDistance=e;this.setCameraRigMode(b.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,
{interaxialDistance:e})};f=(__extends(f,g),f.prototype.getTypeName=function(){return"AnaglyphUniversalCamera"},f);b.AnaglyphUniversalCamera=f;var m=b.FreeCamera;f=function(c,d,e,f,g){m.call(this,c,d,g);this.interaxialDistance=e;this.isStereoscopicSideBySide=f;this.setCameraRigMode(f?b.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:b.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:e})};f=(__extends(f,m),f.prototype.getTypeName=function(){return"StereoscopicFreeCamera"},f);b.StereoscopicFreeCamera=
f;var j=b.ArcRotateCamera;f=function(c,d,e,f,g,l,m,n){j.call(this,c,d,e,f,g,n);this.interaxialDistance=l;this.isStereoscopicSideBySide=m;this.setCameraRigMode(m?b.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:b.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:l})};f=(__extends(f,j),f.prototype.getTypeName=function(){return"StereoscopicArcRotateCamera"},f);b.StereoscopicArcRotateCamera=f;var l=b.GamepadCamera;f=function(c,d,e,f,g){l.call(this,c,d,g);this.interaxialDistance=e;this.isStereoscopicSideBySide=
f;this.setCameraRigMode(f?b.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:b.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:e})};f=(__extends(f,l),f.prototype.getTypeName=function(){return"StereoscopicGamepadCamera"},f);b.StereoscopicGamepadCamera=f;var n=b.UniversalCamera;f=function(c,d,e,f,g){n.call(this,c,d,g);this.interaxialDistance=e;this.isStereoscopicSideBySide=f;this.setCameraRigMode(f?b.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:b.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,
{interaxialDistance:e})};f=(__extends(f,n),f.prototype.getTypeName=function(){return"StereoscopicUniversalCamera"},f);b.StereoscopicUniversalCamera=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.PostProcessRenderPipeline,c=function(d,f,m,j,l){var n=this;void 0===j&&(j=null);e.call(this,f.getEngine(),d);this.gaussCoeff=0.3;this.gaussMean=1;this.gaussStandDev=0.8;this.gaussMultiplier=4;this.minimumLuminance=this.exposure=1;this.maximumLuminance=1E20;this.luminanceDecreaseRate=this.luminanceIncreaserate=0.5;this.brightThreshold=0.8;this._needUpdate=!0;this._scene=f;this._createBrightPassPostProcess(f,m);this._createDownSampleX4PostProcess(f,m);this._createGaussianBlurPostProcess(f,
m);this._createTextureAdderPostProcess(f,m);this._createLuminanceGeneratorPostProcess(f);this._createHDRPostProcess(f,m);null===j?this._originalPostProcess=new b.PassPostProcess("hdr",m,null,b.Texture.BILINEAR_SAMPLINGMODE,f.getEngine(),!1):this._originalPostProcess=j;this.addEffect(new b.PostProcessRenderEffect(f.getEngine(),"HDRPassPostProcess",function(){return n._originalPostProcess},!0));this.addEffect(new b.PostProcessRenderEffect(f.getEngine(),"HDRBrightPass",function(){return n._brightPassPostProcess},
!0));this.addEffect(new b.PostProcessRenderEffect(f.getEngine(),"HDRDownSampleX4",function(){return n._downSampleX4PostProcess},!0));this.addEffect(new b.PostProcessRenderEffect(f.getEngine(),"HDRGaussianBlurH",function(){return n._guassianBlurHPostProcess},!0));this.addEffect(new b.PostProcessRenderEffect(f.getEngine(),"HDRGaussianBlurV",function(){return n._guassianBlurVPostProcess},!0));this.addEffect(new b.PostProcessRenderEffect(f.getEngine(),"HDRTextureAdder",function(){return n._textureAdderPostProcess},
!0));m=function(c){n.addEffect(new b.PostProcessRenderEffect(f.getEngine(),"HDRDownSampler"+c,function(){return n._downSamplePostProcesses[c]},!0))};for(j=c.LUM_STEPS-1;0<=j;j--)m(j);this.addEffect(new b.PostProcessRenderEffect(f.getEngine(),"HDR",function(){return n._hdrPostProcess},!0));f.postProcessRenderPipelineManager.addPipeline(this);null!==l&&f.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(d,l);this.update()};f=(__extends(c,e),c.prototype.update=function(){this._needUpdate=
!0},c.prototype.getCurrentLuminance=function(){return this._hdrCurrentLuminance},c.prototype.getOutputLuminance=function(){return this._hdrOutputLuminance},c.prototype.dispose=function(){this._textureAdderPostProcess=this._guassianBlurVPostProcess=this._guassianBlurHPostProcess=this._downSampleX4PostProcess=this._brightPassPostProcess=this._originalPostProcess=void 0;for(var b=c.LUM_STEPS-1;0<=b;b--)this._downSamplePostProcesses[b]=void 0;this._hdrPostProcess=void 0;this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,
this._scene.cameras)},c.prototype._createHDRPostProcess=function(c,e){var f=this,j=0;this._hdrOutputLuminance=-1;this._hdrCurrentLuminance=1;this._hdrPostProcess=new b.PostProcess("hdr","hdr",["exposure","avgLuminance"],["otherSampler"],e,null,b.Texture.BILINEAR_SAMPLINGMODE,c.getEngine(),!1,"#define HDR");this._hdrPostProcess.onApply=function(e){if(0>f._hdrOutputLuminance)f._hdrOutputLuminance=f._hdrCurrentLuminance;else{var g=(j-(j+c.getEngine().getDeltaTime()))/1E3;f._hdrCurrentLuminance<f._hdrOutputLuminance+
f.luminanceDecreaseRate*g?f._hdrOutputLuminance+=f.luminanceDecreaseRate*g:f._hdrCurrentLuminance>f._hdrOutputLuminance-f.luminanceIncreaserate*g?f._hdrOutputLuminance-=f.luminanceIncreaserate*g:f._hdrOutputLuminance=f._hdrCurrentLuminance}f._hdrOutputLuminance=b.MathTools.Clamp(f._hdrOutputLuminance,f.minimumLuminance,f.maximumLuminance);j+=c.getEngine().getDeltaTime();e.setTextureFromPostProcess("textureSampler",f._textureAdderPostProcess);e.setTextureFromPostProcess("otherSampler",f._originalPostProcess);
e.setFloat("exposure",f.exposure);e.setFloat("avgLuminance",f._hdrOutputLuminance);f._needUpdate=!1}},c.prototype._createTextureAdderPostProcess=function(c,e){var f=this;this._textureAdderPostProcess=new b.PostProcess("hdr","hdr",[],["otherSampler"],e,null,b.Texture.BILINEAR_SAMPLINGMODE,c.getEngine(),!1,"#define TEXTURE_ADDER");this._textureAdderPostProcess.onApply=function(b){b.setTextureFromPostProcess("otherSampler",f._originalPostProcess)}},c.prototype._createDownSampleX4PostProcess=function(c,
e){var f=this,j=Array(32);this._downSampleX4PostProcess=new b.PostProcess("hdr","hdr",["dsOffsets"],[],e/4,null,b.Texture.BILINEAR_SAMPLINGMODE,c.getEngine(),!1,"#define DOWN_SAMPLE_X4");this._downSampleX4PostProcess.onApply=function(b){if(f._needUpdate)for(var c=0,d=-2;2>d;d++)for(var e=-2;2>e;e++)j[c]=(d+0.5)*(1/f._downSampleX4PostProcess.width),j[c+1]=(e+0.5)*(1/f._downSampleX4PostProcess.height),c+=2;b.setArray2("dsOffsets",j)}},c.prototype._createBrightPassPostProcess=function(c,e){var f=this,
j=Array(8);this._brightPassPostProcess=new b.PostProcess("hdr","hdr",["dsOffsets","brightThreshold"],[],e,null,b.Texture.BILINEAR_SAMPLINGMODE,c.getEngine(),!1,"#define BRIGHT_PASS");this._brightPassPostProcess.onApply=function(b){if(f._needUpdate){var c=1/f._brightPassPostProcess.width,d=1/f._brightPassPostProcess.height;j[0]=-0.5*c;j[1]=0.5*d;j[2]=0.5*c;j[3]=0.5*d;j[4]=-0.5*c;j[5]=-0.5*d;j[6]=0.5*c;j[7]=-0.5*d}b.setArray2("dsOffsets",j);b.setFloat("brightThreshold",f.brightThreshold)}},c.prototype._createLuminanceGeneratorPostProcess=
function(d){var e,f=this,j=c.LUM_STEPS,l=Array(8),n=Array(18);this._downSamplePostProcesses=Array(j);var q=function(b,c){var d=1/b,e=1/c;l[0]=-0.5*d;l[1]=0.5*e;l[2]=0.5*d;l[3]=0.5*e;l[4]=-0.5*d;l[5]=-0.5*e;l[6]=0.5*d;l[7]=-0.5*e},p=function(b){return function(c){q(f._downSamplePostProcesses[b].width,f._downSamplePostProcesses[b].height);for(var d=f._downSamplePostProcesses[b].width,j=f._downSamplePostProcesses[b].height,l=0,p=-1;2>p;p++)for(var r=-1;2>r;r++)n[l]=p/d,n[l+1]=r/j,l+=2;e=0.5/f._downSamplePostProcesses[b].width;
c.setTextureFromPostProcess("textureSampler",f._downSamplePostProcesses[b+1]);c.setFloat("halfDestPixelSize",e);c.setArray2("dsOffsets",n)}},r=function(){var c=d.getEngine().readPixels(0,0,1,1),e=new b.Vector4(1/16581375,1/65025,1/255,1);f._hdrCurrentLuminance=(c[0]*e.x+c[1]*e.y+c[2]*e.z+c[3]*e.w)/100},t={width:Math.pow(3,j-1),height:Math.pow(3,j-1)};this._downSamplePostProcesses[j-1]=new b.PostProcess("hdr","hdr",["lumOffsets"],[],t,null,b.Texture.NEAREST_SAMPLINGMODE,d.getEngine(),!1,"#define LUMINANCE_GENERATOR",
b.Engine.TEXTURETYPE_FLOAT);this._downSamplePostProcesses[j-1].onApply=function(b){f._needUpdate&&q(f._textureAdderPostProcess.width,f._textureAdderPostProcess.height);b.setTextureFromPostProcess("textureSampler",f._textureAdderPostProcess);b.setArray2("lumOffsets",l)};for(j-=2;0<=j;j--){var t=Math.pow(3,j),t={width:t,height:t},s="#define DOWN_SAMPLE\n";0===j&&(s+="#define FINAL_DOWN_SAMPLE\n");this._downSamplePostProcesses[j]=new b.PostProcess("hdr","hdr",["dsOffsets","halfDestPixelSize"],[],t,null,
b.Texture.NEAREST_SAMPLINGMODE,d.getEngine(),!1,s,b.Engine.TEXTURETYPE_FLOAT);this._downSamplePostProcesses[j].onApply=p(j);0===j&&(this._downSamplePostProcesses[j].onAfterRender=r)}},c.prototype._createGaussianBlurPostProcess=function(c,e){var f=this,j=Array(9),l=Array(9),n=Array(9),q=["blurOffsets","blurWeights","multiplier"],p=function(b){return function(e){if(f._needUpdate){for(var g=0,q=0;9>q;q++)g=(q-4)/4,n[q]=f.gaussCoeff*(1/Math.sqrt(2*Math.PI*f.gaussStandDev))*Math.exp(-((g-f.gaussMean)*
(g-f.gaussMean))/(2*f.gaussStandDev*f.gaussStandDev));for(var g=c.getEngine().getRenderWidth(),q=c.getEngine().getRenderHeight(),p=0;9>p;p++){var y=(p-4)*(1/(!0===b?q:g));b?l[p]=y:j[p]=y}}e.setArray("blurOffsets",b?l:j);e.setArray("blurWeights",n);e.setFloat("multiplier",f.gaussMultiplier)}};this._guassianBlurHPostProcess=new b.PostProcess("hdr","hdr",q,[],e/4,null,b.Texture.BILINEAR_SAMPLINGMODE,c.getEngine(),!1,"#define GAUSSIAN_BLUR_H");this._guassianBlurHPostProcess.onApply=p(!1);this._guassianBlurVPostProcess=
new b.PostProcess("hdr","hdr",q,[],e/4,null,b.Texture.BILINEAR_SAMPLINGMODE,c.getEngine(),!1,"#define GAUSSIAN_BLUR_V");this._guassianBlurVPostProcess.onApply=p(!0)},c.LUM_STEPS=6,c);b.HDRRenderingPipeline=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(){this.edges=[];this.edgesConnectedCount=0};var e;e=function(b,d,e){void 0===d&&(d=0.95);void 0===e&&(e=!1);this.edgesWidthScalerForOrthographic=1E3;this.edgesWidthScalerForPerspective=50;this._linesPositions=[];this._linesNormals=[];this._linesIndices=[];this._buffers={};this._checkVerticesInsteadOfIndices=!1;this._source=b;this._checkVerticesInsteadOfIndices=e;this._epsilon=d;this._prepareRessources();this._generateEdgesLines()};e=(e.prototype._prepareRessources=function(){this._lineShader||
(this._lineShader=new b.ShaderMaterial("lineShader",this._source.getScene(),"line",{attributes:["position","normal"],uniforms:["worldViewProjection","color","width","aspectRatio"]}),this._lineShader.disableDepthWrite=!0,this._lineShader.backFaceCulling=!1)},e.prototype.dispose=function(){var c=this._buffers[b.VertexBuffer.PositionKind];c&&(c.dispose(),this._buffers[b.VertexBuffer.PositionKind]=null);(c=this._buffers[b.VertexBuffer.NormalKind])&&(c.dispose(),this._buffers[b.VertexBuffer.NormalKind]=
null);this._source.getScene().getEngine()._releaseBuffer(this._ib);this._lineShader.dispose()},e.prototype._processEdgeForAdjacencies=function(b,d,e,f,j){return b===e&&d===f||b===f&&d===e?0:b===f&&d===j||b===j&&d===f?1:b===j&&d===e||b===e&&d===j?2:-1},e.prototype._processEdgeForAdjacenciesWithVertices=function(b,d,e,f,j){return b.equalsWithEpsilon(e)&&d.equalsWithEpsilon(f)||b.equalsWithEpsilon(f)&&d.equalsWithEpsilon(e)?0:b.equalsWithEpsilon(f)&&d.equalsWithEpsilon(j)||b.equalsWithEpsilon(j)&&d.equalsWithEpsilon(f)?
1:b.equalsWithEpsilon(j)&&d.equalsWithEpsilon(e)||b.equalsWithEpsilon(e)&&d.equalsWithEpsilon(j)?2:-1},e.prototype._checkEdge=function(c,d,e,f,j){if(void 0===d||b.Vector3.Dot(e[c],e[d])<this._epsilon)c=this._linesPositions.length/3,f.subtract(j).normalize(),this._linesPositions.push(f.x),this._linesPositions.push(f.y),this._linesPositions.push(f.z),this._linesPositions.push(f.x),this._linesPositions.push(f.y),this._linesPositions.push(f.z),this._linesPositions.push(j.x),this._linesPositions.push(j.y),
this._linesPositions.push(j.z),this._linesPositions.push(j.x),this._linesPositions.push(j.y),this._linesPositions.push(j.z),this._linesNormals.push(j.x),this._linesNormals.push(j.y),this._linesNormals.push(j.z),this._linesNormals.push(-1),this._linesNormals.push(j.x),this._linesNormals.push(j.y),this._linesNormals.push(j.z),this._linesNormals.push(1),this._linesNormals.push(f.x),this._linesNormals.push(f.y),this._linesNormals.push(f.z),this._linesNormals.push(-1),this._linesNormals.push(f.x),this._linesNormals.push(f.y),
this._linesNormals.push(f.z),this._linesNormals.push(1),this._linesIndices.push(c),this._linesIndices.push(c+1),this._linesIndices.push(c+2),this._linesIndices.push(c),this._linesIndices.push(c+2),this._linesIndices.push(c+3)},e.prototype._generateEdgesLines=function(){var c,d,e=this._source.getVerticesData(b.VertexBuffer.PositionKind),m=this._source.getIndices(),j=[],l=[];for(c=0;c<m.length;c+=3){d=new f;var n=m[c],q=m[c+1],p=m[c+2];d.p0=new b.Vector3(e[3*n],e[3*n+1],e[3*n+2]);d.p1=new b.Vector3(e[3*
q],e[3*q+1],e[3*q+2]);d.p2=new b.Vector3(e[3*p],e[3*p+1],e[3*p+2]);n=b.Vector3.Cross(d.p1.subtract(d.p0),d.p2.subtract(d.p1));n.normalize();l.push(n);j.push(d)}for(c=0;c<j.length;c++){d=j[c];for(e=c+1;e<j.length;e++){n=j[e];if(3===d.edgesConnectedCount)break;if(3!==n.edgesConnectedCount)for(var q=m[3*e],p=m[3*e+1],r=m[3*e+2],t=0;3>t;t++){var s;if(void 0===d.edges[t]){switch(t){case 0:s=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(d.p0,d.p1,n.p0,n.p1,n.p2):this._processEdgeForAdjacencies(m[3*
c],m[3*c+1],q,p,r);break;case 1:s=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(d.p1,d.p2,n.p0,n.p1,n.p2):this._processEdgeForAdjacencies(m[3*c+1],m[3*c+2],q,p,r);break;case 2:s=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(d.p2,d.p0,n.p0,n.p1,n.p2):this._processEdgeForAdjacencies(m[3*c+2],m[3*c],q,p,r)}if(-1!==s&&(d.edges[t]=e,n.edges[s]=c,d.edgesConnectedCount++,n.edgesConnectedCount++,3===d.edgesConnectedCount))break}}}}for(c=
0;c<j.length;c++)d=j[c],this._checkEdge(c,d.edges[0],l,d.p0,d.p1),this._checkEdge(c,d.edges[1],l,d.p1,d.p2),this._checkEdge(c,d.edges[2],l,d.p2,d.p0);c=this._source.getScene().getEngine();this._buffers[b.VertexBuffer.PositionKind]=new b.VertexBuffer(c,this._linesPositions,b.VertexBuffer.PositionKind,!1);this._buffers[b.VertexBuffer.NormalKind]=new b.VertexBuffer(c,this._linesNormals,b.VertexBuffer.NormalKind,!1,!1,4);this._ib=c.createIndexBuffer(this._linesIndices);this._indicesCount=this._linesIndices.length},
e.prototype.render=function(){if(this._lineShader.isReady()){var c=this._source.getScene(),d=c.getEngine();this._lineShader._preBind();d.bindBuffers(this._buffers,this._ib,this._lineShader.getEffect());c.resetCachedMaterial();this._lineShader.setColor4("color",this._source.edgesColor);c.activeCamera.mode===b.Camera.ORTHOGRAPHIC_CAMERA?this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForOrthographic):this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForPerspective);
this._lineShader.setFloat("aspectRatio",d.getAspectRatio(c.activeCamera));this._lineShader.bind(this._source.getWorldMatrix());d.draw(!0,0,this._indicesCount);this._lineShader.unbind();d.setDepthWrite(!0)}},e);b.EdgesRenderer=e}(BABYLON||(BABYLON={}));
!function(b){var f=b.TonemappingOperator||(b.TonemappingOperator={});f[f.Hable=0]="Hable";f[f.Reinhard=1]="Reinhard";f[f.HejiDawson=2]="HejiDawson";f[f.Photographic=3]="Photographic";!0;var e=b.TonemappingOperator,c=b.PostProcess,f=function(d,f,m,j,l,n,q){var p=this;void 0===l&&(l=b.Texture.BILINEAR_SAMPLINGMODE);void 0===q&&(q=b.Engine.TEXTURETYPE_UNSIGNED_INT);c.call(this,d,"tonemap",["_ExposureAdjustment"],null,1,j,l,n,!0,r,q);this._operator=f;this.exposureAdjustment=m;var r="#define ";this._operator===
e.Hable?r+="HABLE_TONEMAPPING":this._operator===e.Reinhard?r+="REINHARD_TONEMAPPING":this._operator===e.HejiDawson?r+="OPTIMIZED_HEJIDAWSON_TONEMAPPING":this._operator===e.Photographic&&(r+="PHOTOGRAPHIC_TONEMAPPING");this.updateEffect(r);this.onApply=function(b){b.setFloat("_ExposureAdjustment",p.exposureAdjustment)}},f=(__extends(f,c),f);b.TonemapPostProcess=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(e,c,d,f){var m=this;void 0===f&&(f=!0);this.name=e;this._viewMatrix=b.Matrix.Identity();this._target=b.Vector3.Zero();this._add=b.Vector3.Zero();this.invertYAxis=!1;this.position=b.Vector3.Zero();this._scene=d;this._scene.reflectionProbes.push(this);this._renderTargetTexture=new b.RenderTargetTexture(e,c,d,f,!0,b.Engine.TEXTURETYPE_UNSIGNED_INT,!0);this._renderTargetTexture.onBeforeRenderObservable.add(function(c){switch(c){case 0:m._add.copyFromFloats(1,0,0);break;case 1:m._add.copyFromFloats(-1,
0,0);break;case 2:m._add.copyFromFloats(0,m.invertYAxis?1:-1,0);break;case 3:m._add.copyFromFloats(0,m.invertYAxis?-1:1,0);break;case 4:m._add.copyFromFloats(0,0,1);break;case 5:m._add.copyFromFloats(0,0,-1)}m._attachedMesh&&m.position.copyFrom(m._attachedMesh.getAbsolutePosition());m.position.addToRef(m._add,m._target);b.Matrix.LookAtLHToRef(m.position,m._target,b.Vector3.Up(),m._viewMatrix);d.setTransformMatrix(m._viewMatrix,m._projectionMatrix)});this._renderTargetTexture.onAfterUnbindObservable.add(function(){d.updateTransformMatrix(!0)});
this._projectionMatrix=b.Matrix.PerspectiveFovLH(Math.PI/2,1,d.activeCamera.minZ,d.activeCamera.maxZ)};f=(Object.defineProperty(f.prototype,"refreshRate",{get:function(){return this._renderTargetTexture.refreshRate},set:function(b){this._renderTargetTexture.refreshRate=b},enumerable:!0,configurable:!0}),f.prototype.getScene=function(){return this._scene},Object.defineProperty(f.prototype,"cubeTexture",{get:function(){return this._renderTargetTexture},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,
"renderList",{get:function(){return this._renderTargetTexture.renderList},enumerable:!0,configurable:!0}),f.prototype.attachToMesh=function(b){this._attachedMesh=b},f.prototype.dispose=function(){var b=this._scene.reflectionProbes.indexOf(this);-1!==b&&this._scene.reflectionProbes.splice(b,1);this._renderTargetTexture&&(this._renderTargetTexture.dispose(),this._renderTargetTexture=null)},f);b.ReflectionProbe=f}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(e,c,d,f,m){this.color=new b.Color4(1,1,1,1);this.position=b.Vector3.Zero();this.rotation=b.Vector3.Zero();this.scaling=new b.Vector3(1,1,1);this.uvs=new b.Vector4(0,0,1,1);this.velocity=b.Vector3.Zero();this.isVisible=this.alive=!0;this.idx=e;this._pos=c;this._model=d;this.shapeId=f;this.idxInShape=m};f=(Object.defineProperty(f.prototype,"scale",{get:function(){return this.scaling},set:function(b){this.scaling=b},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,
"quaternion",{get:function(){return this.rotationQuaternion},set:function(b){this.rotationQuaternion=b},enumerable:!0,configurable:!0}),f);b.SolidParticle=f;b.ModelShape=function(b,c,d,f,m){this.shapeID=b;this._shape=c;this._shapeUV=d;this._positionFunction=f;this._vertexFunction=m}}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(e,c,d){this.particles=[];this.nbParticles=0;this.billboard=!1;this.counter=0;this.vars={};this._positions=[];this._indices=[];this._normals=[];this._colors=[];this._uvs=[];this._index=0;this._updatable=!0;this._alwaysVisible=this._isVisibilityBoxLocked=this._pickable=!1;this._shapeCounter=0;this._copy=new b.SolidParticle(null,null,null,null,null);this._color=new b.Color4(0,0,0,0);this._computeParticleRotation=this._computeParticleTexture=this._computeParticleColor=!0;
this._computeBoundingBox=this._computeParticleVertex=!1;this._cam_axisZ=b.Vector3.Zero();this._cam_axisY=b.Vector3.Zero();this._cam_axisX=b.Vector3.Zero();this._axisX=b.Axis.X;this._axisY=b.Axis.Y;this._axisZ=b.Axis.Z;this._fakeCamPos=b.Vector3.Zero();this._rotMatrix=new b.Matrix;this._invertMatrix=new b.Matrix;this._rotated=b.Vector3.Zero();this._quaternion=new b.Quaternion;this._vertex=b.Vector3.Zero();this._normal=b.Vector3.Zero();this._w=this._cosYaw=this._sinYaw=this._cosPitch=this._sinPitch=
this._cosRoll=this._sinRoll=this._halfyaw=this._halfpitch=this._halfroll=this._roll=this._pitch=this._yaw=0;this._minimum=b.Tmp.Vector3[0];this._maximum=b.Tmp.Vector3[1];this.name=e;this._scene=c;this._camera=c.activeCamera;this._pickable=d?d.isPickable:!1;d&&d.updatable?this._updatable=d.updatable:this._updatable=!0;this._pickable&&(this.pickedParticles=[])};f=(f.prototype.buildMesh=function(){if(0===this.nbParticles){var e=b.MeshBuilder.CreateDisc("",{radius:1,tessellation:3},this._scene);this.addShape(e,
1);e.dispose()}this._positions32=new Float32Array(this._positions);this._uvs32=new Float32Array(this._uvs);this._colors32=new Float32Array(this._colors);b.VertexData.ComputeNormals(this._positions32,this._indices,this._normals);this._normals32=new Float32Array(this._normals);this._fixedNormal32=new Float32Array(this._normals);e=new b.VertexData;e.set(this._positions32,b.VertexBuffer.PositionKind);e.indices=this._indices;e.set(this._normals32,b.VertexBuffer.NormalKind);this._uvs32&&e.set(this._uvs32,
b.VertexBuffer.UVKind);this._colors32&&e.set(this._colors32,b.VertexBuffer.ColorKind);var c=new b.Mesh(this.name,this._scene);return e.applyToMesh(c,this._updatable),this.mesh=c,this.mesh.isPickable=this._pickable,this._positions=null,this._normals=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0),c},f.prototype.digest=function(e,c){var d=c&&c.facetNb||1,f=c&&c.number,m=c&&c.delta||0,j=e.getVerticesData(b.VertexBuffer.PositionKind),l=e.getIndices(),n=e.getVerticesData(b.VertexBuffer.UVKind),
q=e.getVerticesData(b.VertexBuffer.ColorKind),p=0,r=l.length/3;f?(f=f>r?r:f,d=Math.round(r/f),m=0):d=d>r?r:d;for(var f=[],t=[],s=[],u=[],x=b.Tmp.Vector3[0],y=d;r>p;){d=y+Math.floor((1+m)*Math.random());p>r-d&&(d=r-p);f.length=0;t.length=0;s.length=0;for(var z=u.length=0,A=3*p;3*(p+d)>A;A++){t.push(z);var B=l[A];f.push(j[3*B],j[3*B+1],j[3*B+2]);n&&s.push(n[2*B],n[2*B+1]);q&&u.push(q[4*B],q[4*B+1],q[4*B+2],q[4*B+3]);z++}for(var z=this.nbParticles,A=this._posToShape(f),C=this._uvsToShapeUV(s),B=0;B<
A.length;B++)x.addInPlace(A[B]);x.scaleInPlace(1/A.length);for(B=0;B<A.length;B++)A[B].subtractInPlace(x);B=new b.ModelShape(this._shapeCounter,A,C,null,null);this._meshBuilder(this._index,A,this._positions,t,this._indices,s,this._uvs,u,this._colors,z,0,null);this._addParticle(z,this._positions.length,B,this._shapeCounter,0);this.particles[this.nbParticles].position.addInPlace(x);this._index+=A.length;this.nbParticles++;this._shapeCounter++;p+=d}return this},f.prototype._resetCopy=function(){this._copy.position.x=
0;this._copy.position.y=0;this._copy.position.z=0;this._copy.rotation.x=0;this._copy.rotation.y=0;this._copy.rotation.z=0;this._copy.rotationQuaternion=null;this._copy.scaling.x=1;this._copy.scaling.y=1;this._copy.scaling.z=1;this._copy.uvs.x=0;this._copy.uvs.y=0;this._copy.uvs.z=1;this._copy.uvs.w=1;this._copy.color=null},f.prototype._meshBuilder=function(e,c,d,f,m,j,l,n,q,p,r,t){var s=0,u=0;this._resetCopy();t&&t.positionFunction&&t.positionFunction(this._copy,p,r);this._copy.rotationQuaternion?
this._quaternion.copyFrom(this._copy.rotationQuaternion):(this._yaw=this._copy.rotation.y,this._pitch=this._copy.rotation.x,this._roll=this._copy.rotation.z,this._quaternionRotationYPR());this._quaternionToRotationMatrix();for(r=0;r<c.length;r++)this._vertex.x=c[r].x,this._vertex.y=c[r].y,this._vertex.z=c[r].z,t&&t.vertexFunction&&t.vertexFunction(this._copy,this._vertex,r),this._vertex.x*=this._copy.scaling.x,this._vertex.y*=this._copy.scaling.y,this._vertex.z*=this._copy.scaling.z,b.Vector3.TransformCoordinatesToRef(this._vertex,
this._rotMatrix,this._rotated),d.push(this._copy.position.x+this._rotated.x,this._copy.position.y+this._rotated.y,this._copy.position.z+this._rotated.z),j&&(l.push((this._copy.uvs.z-this._copy.uvs.x)*j[s]+this._copy.uvs.x,(this._copy.uvs.w-this._copy.uvs.y)*j[s+1]+this._copy.uvs.y),s+=2),this._copy.color?this._color=this._copy.color:n&&n[u]?(this._color.r=n[u],this._color.g=n[u+1],this._color.b=n[u+2],this._color.a=n[u+3]):(this._color.r=1,this._color.g=1,this._color.b=1,this._color.a=1),q.push(this._color.r,
this._color.g,this._color.b,this._color.a),u+=4;for(r=0;r<f.length;r++)m.push(e+f[r]);if(this._pickable){e=f.length/3;for(r=0;e>r;r++)this.pickedParticles.push({idx:p,faceId:r})}},f.prototype._posToShape=function(e){for(var c=[],d=0;d<e.length;d+=3)c.push(new b.Vector3(e[d],e[d+1],e[d+2]));return c},f.prototype._uvsToShapeUV=function(b){var c=[];if(b)for(var d=0;d<b.length;d++)c.push(b[d]);return c},f.prototype._addParticle=function(e,c,d,f,m){this.particles.push(new b.SolidParticle(e,c,d,f,m))},
f.prototype.addShape=function(e,c,d){var f=e.getVerticesData(b.VertexBuffer.PositionKind),m=e.getIndices(),j=e.getVerticesData(b.VertexBuffer.UVKind);e=e.getVerticesData(b.VertexBuffer.ColorKind);for(var f=this._posToShape(f),l=this._uvsToShapeUV(j),l=new b.ModelShape(this._shapeCounter,f,l,d?d.positionFunction:null,d?d.vertexFunction:null),n=this.nbParticles,q=0;c>q;q++)this._meshBuilder(this._index,f,this._positions,m,this._indices,j,this._uvs,e,this._colors,n,q,d),this._updatable&&this._addParticle(n,
this._positions.length,l,this._shapeCounter,q),this._index+=f.length,n++;return this.nbParticles+=c,this._shapeCounter++,this._shapeCounter-1},f.prototype._rebuildParticle=function(e){this._resetCopy();e._model._positionFunction&&e._model._positionFunction(this._copy,e.idx,e.idxInShape);this._copy.rotationQuaternion?this._quaternion.copyFrom(this._copy.rotationQuaternion):(this._yaw=this._copy.rotation.y,this._pitch=this._copy.rotation.x,this._roll=this._copy.rotation.z,this._quaternionRotationYPR());
this._quaternionToRotationMatrix();this._shape=e._model._shape;for(var c=0;c<this._shape.length;c++)this._vertex.x=this._shape[c].x,this._vertex.y=this._shape[c].y,this._vertex.z=this._shape[c].z,e._model._vertexFunction&&e._model._vertexFunction(this._copy,this._vertex,c),this._vertex.x*=this._copy.scaling.x,this._vertex.y*=this._copy.scaling.y,this._vertex.z*=this._copy.scaling.z,b.Vector3.TransformCoordinatesToRef(this._vertex,this._rotMatrix,this._rotated),this._positions32[e._pos+3*c]=this._copy.position.x+
this._rotated.x,this._positions32[e._pos+3*c+1]=this._copy.position.y+this._rotated.y,this._positions32[e._pos+3*c+2]=this._copy.position.z+this._rotated.z;e.position.x=0;e.position.y=0;e.position.z=0;e.rotation.x=0;e.rotation.y=0;e.rotation.z=0;e.rotationQuaternion=null;e.scaling.x=1;e.scaling.y=1;e.scaling.z=1},f.prototype.rebuildMesh=function(){for(var e=0;e<this.particles.length;e++)this._rebuildParticle(this.particles[e]);this.mesh.updateVerticesData(b.VertexBuffer.PositionKind,this._positions32,
!1,!1)},f.prototype.setParticles=function(e,c,d){if(void 0===e&&(e=0),void 0===c&&(c=this.nbParticles-1),void 0===d&&(d=!0),this._updatable){this.beforeUpdateParticles(e,c,d);this._cam_axisX.x=1;this._cam_axisX.y=0;this._cam_axisX.z=0;this._cam_axisY.x=0;this._cam_axisY.y=1;this._cam_axisY.z=0;this._cam_axisZ.x=0;this._cam_axisZ.y=0;this._cam_axisZ.z=1;this.billboard&&(this._yaw=this.mesh.rotation.y,this._pitch=this.mesh.rotation.x,this._roll=this.mesh.rotation.z,this._quaternionRotationYPR(),this._quaternionToRotationMatrix(),
this._rotMatrix.invertToRef(this._invertMatrix),b.Vector3.TransformCoordinatesToRef(this._camera.globalPosition,this._invertMatrix,this._fakeCamPos),this._fakeCamPos.subtractToRef(this.mesh.position,this._cam_axisZ),b.Vector3.CrossToRef(this._cam_axisZ,this._axisX,this._cam_axisY),b.Vector3.CrossToRef(this._cam_axisZ,this._cam_axisY,this._cam_axisX),this._cam_axisY.normalize(),this._cam_axisX.normalize(),this._cam_axisZ.normalize());b.Matrix.IdentityToRef(this._rotMatrix);var f=0,m=0,j=0,l=0,n=0,
q=0,p=0;this._computeBoundingBox&&(b.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this._minimum),b.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this._maximum));c=c>this.nbParticles-1?this.nbParticles-1:c;for(var r=e;c>=r;r++){if(this._particle=this.particles[r],this._shape=this._particle._model._shape,this._shapeUV=this._particle._model._shapeUV,this.updateParticle(this._particle),this._particle.isVisible){this.billboard&&(this._particle.rotation.x=
0,this._particle.rotation.y=0);this._computeParticleRotation&&(this._particle.rotationQuaternion?this._quaternion.copyFrom(this._particle.rotationQuaternion):(this._yaw=this._particle.rotation.y,this._pitch=this._particle.rotation.x,this._roll=this._particle.rotation.z,this._quaternionRotationYPR()),this._quaternionToRotationMatrix());for(p=0;p<this._shape.length;p++)f=m+3*p,j=l+4*p,n=q+2*p,this._vertex.x=this._shape[p].x,this._vertex.y=this._shape[p].y,this._vertex.z=this._shape[p].z,this._computeParticleVertex&&
this.updateParticleVertex(this._particle,this._vertex,p),this._vertex.x*=this._particle.scaling.x,this._vertex.y*=this._particle.scaling.y,this._vertex.z*=this._particle.scaling.z,this._w=this._vertex.x*this._rotMatrix.m[3]+this._vertex.y*this._rotMatrix.m[7]+this._vertex.z*this._rotMatrix.m[11]+this._rotMatrix.m[15],this._rotated.x=(this._vertex.x*this._rotMatrix.m[0]+this._vertex.y*this._rotMatrix.m[4]+this._vertex.z*this._rotMatrix.m[8]+this._rotMatrix.m[12])/this._w,this._rotated.y=(this._vertex.x*
this._rotMatrix.m[1]+this._vertex.y*this._rotMatrix.m[5]+this._vertex.z*this._rotMatrix.m[9]+this._rotMatrix.m[13])/this._w,this._rotated.z=(this._vertex.x*this._rotMatrix.m[2]+this._vertex.y*this._rotMatrix.m[6]+this._vertex.z*this._rotMatrix.m[10]+this._rotMatrix.m[14])/this._w,this._positions32[f]=this._particle.position.x+this._cam_axisX.x*this._rotated.x+this._cam_axisY.x*this._rotated.y+this._cam_axisZ.x*this._rotated.z,this._positions32[f+1]=this._particle.position.y+this._cam_axisX.y*this._rotated.x+
this._cam_axisY.y*this._rotated.y+this._cam_axisZ.y*this._rotated.z,this._positions32[f+2]=this._particle.position.z+this._cam_axisX.z*this._rotated.x+this._cam_axisY.z*this._rotated.y+this._cam_axisZ.z*this._rotated.z,this._computeBoundingBox&&(this._positions32[f]<this._minimum.x&&(this._minimum.x=this._positions32[f]),this._positions32[f]>this._maximum.x&&(this._maximum.x=this._positions32[f]),this._positions32[f+1]<this._minimum.y&&(this._minimum.y=this._positions32[f+1]),this._positions32[f+
1]>this._maximum.y&&(this._maximum.y=this._positions32[f+1]),this._positions32[f+2]<this._minimum.z&&(this._minimum.z=this._positions32[f+2]),this._positions32[f+2]>this._maximum.z&&(this._maximum.z=this._positions32[f+2])),this._computeParticleVertex||this.billboard||(this._normal.x=this._fixedNormal32[f],this._normal.y=this._fixedNormal32[f+1],this._normal.z=this._fixedNormal32[f+2],this._w=this._normal.x*this._rotMatrix.m[3]+this._normal.y*this._rotMatrix.m[7]+this._normal.z*this._rotMatrix.m[11]+
this._rotMatrix.m[15],this._rotated.x=(this._normal.x*this._rotMatrix.m[0]+this._normal.y*this._rotMatrix.m[4]+this._normal.z*this._rotMatrix.m[8]+this._rotMatrix.m[12])/this._w,this._rotated.y=(this._normal.x*this._rotMatrix.m[1]+this._normal.y*this._rotMatrix.m[5]+this._normal.z*this._rotMatrix.m[9]+this._rotMatrix.m[13])/this._w,this._rotated.z=(this._normal.x*this._rotMatrix.m[2]+this._normal.y*this._rotMatrix.m[6]+this._normal.z*this._rotMatrix.m[10]+this._rotMatrix.m[14])/this._w,this._normals32[f]=
this._cam_axisX.x*this._rotated.x+this._cam_axisY.x*this._rotated.y+this._cam_axisZ.x*this._rotated.z,this._normals32[f+1]=this._cam_axisX.y*this._rotated.x+this._cam_axisY.y*this._rotated.y+this._cam_axisZ.y*this._rotated.z,this._normals32[f+2]=this._cam_axisX.z*this._rotated.x+this._cam_axisY.z*this._rotated.y+this._cam_axisZ.z*this._rotated.z),this._computeParticleColor&&(this._colors32[j]=this._particle.color.r,this._colors32[j+1]=this._particle.color.g,this._colors32[j+2]=this._particle.color.b,
this._colors32[j+3]=this._particle.color.a),this._computeParticleTexture&&(this._uvs32[n]=this._shapeUV[2*p]*(this._particle.uvs.z-this._particle.uvs.x)+this._particle.uvs.x,this._uvs32[n+1]=this._shapeUV[2*p+1]*(this._particle.uvs.w-this._particle.uvs.y)+this._particle.uvs.y)}else for(p=0;p<this._shape.length;p++)f=m+3*p,j=l+4*p,n=q+2*p,this._positions32[f]=this._camera.position.x,this._positions32[f+1]=this._camera.position.y,this._positions32[f+2]=this._camera.position.z,this._normals32[f]=0,this._normals32[f+
1]=0,this._normals32[f+2]=0,this._computeParticleColor&&(this._colors32[j]=this._particle.color.r,this._colors32[j+1]=this._particle.color.g,this._colors32[j+2]=this._particle.color.b,this._colors32[j+3]=this._particle.color.a),this._computeParticleTexture&&(this._uvs32[n]=this._shapeUV[2*p]*(this._particle.uvs.z-this._particle.uvs.x)+this._particle.uvs.x,this._uvs32[n+1]=this._shapeUV[2*p+1]*(this._particle.uvs.w-this._particle.uvs.y)+this._particle.uvs.y);m=f+3;l=j+4;q=n+2}if(d&&(this._computeParticleColor&&
this.mesh.updateVerticesData(b.VertexBuffer.ColorKind,this._colors32,!1,!1),this._computeParticleTexture&&this.mesh.updateVerticesData(b.VertexBuffer.UVKind,this._uvs32,!1,!1),this.mesh.updateVerticesData(b.VertexBuffer.PositionKind,this._positions32,!1,!1),!this.mesh.areNormalsFrozen)){if(this._computeParticleVertex||this.billboard){b.VertexData.ComputeNormals(this._positions32,this._indices,this._normals32);for(f=0;f<this._normals32.length;f++)this._fixedNormal32[f]=this._normals32[f]}this.mesh.updateVerticesData(b.VertexBuffer.NormalKind,
this._normals32,!1,!1)}this._computeBoundingBox&&(this.mesh._boundingInfo=new b.BoundingInfo(this._minimum,this._maximum),this.mesh._boundingInfo.update(this.mesh._worldMatrix));this.afterUpdateParticles(e,c,d)}},f.prototype._quaternionRotationYPR=function(){this._halfroll=0.5*this._roll;this._halfpitch=0.5*this._pitch;this._halfyaw=0.5*this._yaw;this._sinRoll=Math.sin(this._halfroll);this._cosRoll=Math.cos(this._halfroll);this._sinPitch=Math.sin(this._halfpitch);this._cosPitch=Math.cos(this._halfpitch);
this._sinYaw=Math.sin(this._halfyaw);this._cosYaw=Math.cos(this._halfyaw);this._quaternion.x=this._cosYaw*this._sinPitch*this._cosRoll+this._sinYaw*this._cosPitch*this._sinRoll;this._quaternion.y=this._sinYaw*this._cosPitch*this._cosRoll-this._cosYaw*this._sinPitch*this._sinRoll;this._quaternion.z=this._cosYaw*this._cosPitch*this._sinRoll-this._sinYaw*this._sinPitch*this._cosRoll;this._quaternion.w=this._cosYaw*this._cosPitch*this._cosRoll+this._sinYaw*this._sinPitch*this._sinRoll},f.prototype._quaternionToRotationMatrix=
function(){this._rotMatrix.m[0]=1-2*(this._quaternion.y*this._quaternion.y+this._quaternion.z*this._quaternion.z);this._rotMatrix.m[1]=2*(this._quaternion.x*this._quaternion.y+this._quaternion.z*this._quaternion.w);this._rotMatrix.m[2]=2*(this._quaternion.z*this._quaternion.x-this._quaternion.y*this._quaternion.w);this._rotMatrix.m[3]=0;this._rotMatrix.m[4]=2*(this._quaternion.x*this._quaternion.y-this._quaternion.z*this._quaternion.w);this._rotMatrix.m[5]=1-2*(this._quaternion.z*this._quaternion.z+
this._quaternion.x*this._quaternion.x);this._rotMatrix.m[6]=2*(this._quaternion.y*this._quaternion.z+this._quaternion.x*this._quaternion.w);this._rotMatrix.m[7]=0;this._rotMatrix.m[8]=2*(this._quaternion.z*this._quaternion.x+this._quaternion.y*this._quaternion.w);this._rotMatrix.m[9]=2*(this._quaternion.y*this._quaternion.z-this._quaternion.x*this._quaternion.w);this._rotMatrix.m[10]=1-2*(this._quaternion.y*this._quaternion.y+this._quaternion.x*this._quaternion.x);this._rotMatrix.m[11]=0;this._rotMatrix.m[12]=
0;this._rotMatrix.m[13]=0;this._rotMatrix.m[14]=0;this._rotMatrix.m[15]=1},f.prototype.dispose=function(){this.mesh.dispose();this.pickedParticles=this._colors32=this._uvs32=this._fixedNormal32=this._normals32=this._positions32=this._colors=this._uvs=this._normals=this._indices=this._positions=this.vars=null},f.prototype.refreshVisibleSize=function(){this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo()},f.prototype.setVisibilityBox=function(e){e/=2;this.mesh._boundingInfo=new b.BoundingInfo(new b.Vector3(-e,
-e,-e),new b.Vector3(e,e,e))},Object.defineProperty(f.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(b){this._alwaysVisible=b;this.mesh.alwaysSelectAsActiveMesh=b},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"isVisibilityBoxLocked",{get:function(){return this._isVisibilityBoxLocked},set:function(b){this._isVisibilityBoxLocked=b;this.mesh.getBoundingInfo().isLocked=b},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"computeParticleRotation",
{get:function(){return this._computeParticleRotation},set:function(b){this._computeParticleRotation=b},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(b){this._computeParticleColor=b},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(b){this._computeParticleTexture=b},enumerable:!0,configurable:!0}),
Object.defineProperty(f.prototype,"computeParticleVertex",{get:function(){return this._computeParticleVertex},set:function(b){this._computeParticleVertex=b},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(b){this._computeBoundingBox=b},enumerable:!0,configurable:!0}),f.prototype.initParticles=function(){},f.prototype.recycleParticle=function(b){return b},f.prototype.updateParticle=function(b){return b},
f.prototype.updateParticleVertex=function(b,c){return c},f.prototype.beforeUpdateParticles=function(){},f.prototype.afterUpdateParticles=function(){},f);b.SolidParticleSystem=f}(BABYLON||(BABYLON={}));
!function(b){var f=b.Internals||(b.Internals={}),e=function(b,c,e,f){this.name=b;this.worldAxisForNormal=c;this.worldAxisForFileX=e;this.worldAxisForFileY=f},c=function(){},e=(c.ConvertCubeMapToSphericalPolynomial=function(c){for(var e=new b.SphericalHarmonics,f=0,j=2/c.size,l=0.5*j-1,n=0;6>n;n++)for(var q=this.FileFaces[n],p=c[q.name],r=l,t=0;t<c.size;t++){for(var s=l,u=0;u<c.size;u++){var x=q.worldAxisForFileX.scale(s).add(q.worldAxisForFileY.scale(r)).add(q.worldAxisForNormal);x.normalize();var y,
z=Math.pow(1+s*s+r*r,-1.5);y=new b.Color3(p[3*t*c.size+3*u+0],p[3*t*c.size+3*u+1],p[3*t*c.size+3*u+2]);e.addLight(x,y,z);f+=z;s+=j}r+=j}return e.scale(4*Math.PI/f),e.scale(1/Math.PI),b.SphericalPolynomial.getSphericalPolynomialFromHarmonics(e)},c.FileFaces=[new e("right",new b.Vector3(1,0,0),new b.Vector3(0,0,-1),new b.Vector3(0,-1,0)),new e("left",new b.Vector3(-1,0,0),new b.Vector3(0,0,1),new b.Vector3(0,-1,0)),new e("up",new b.Vector3(0,1,0),new b.Vector3(1,0,0),new b.Vector3(0,0,1)),new e("down",
new b.Vector3(0,-1,0),new b.Vector3(1,0,0),new b.Vector3(0,0,-1)),new e("front",new b.Vector3(0,0,1),new b.Vector3(1,0,0),new b.Vector3(0,-1,0)),new e("back",new b.Vector3(0,0,-1),new b.Vector3(-1,0,0),new b.Vector3(0,-1,0))],c);f.CubeMapToSphericalPolynomialTools=e;!0}(BABYLON||(BABYLON={}));
!function(b){var f=b.Internals||(b.Internals={}),e=function(){};b=(e.ConvertPanoramaToCubemap=function(b,d,e,f){if(!b)throw"ConvertPanoramaToCubemap: input cannot be null";if(b.length!=3*d*e)throw"ConvertPanoramaToCubemap: input size is wrong";var j=this.CreateCubemapTexture(f,this.FACE_FRONT,b,d,e),l=this.CreateCubemapTexture(f,this.FACE_BACK,b,d,e),n=this.CreateCubemapTexture(f,this.FACE_LEFT,b,d,e),q=this.CreateCubemapTexture(f,this.FACE_RIGHT,b,d,e),p=this.CreateCubemapTexture(f,this.FACE_UP,
b,d,e);b=this.CreateCubemapTexture(f,this.FACE_DOWN,b,d,e);return{front:j,back:l,left:n,right:q,up:p,down:b,size:f}},e.CreateCubemapTexture=function(b,d,e,f,j){for(var l=new ArrayBuffer(12*b*b),l=new Float32Array(l),n=d[1].subtract(d[0]).scale(1/b),q=d[3].subtract(d[2]).scale(1/b),p=1/b,r=0,t=0;b>t;t++){for(var s=d[0],u=d[2],x=0;b>x;x++){var y=u.subtract(s).scale(r).add(s);y.normalize();y=this.CalcProjectionSpherical(y,e,f,j);l[3*t*b+3*x+0]=y.r;l[3*t*b+3*x+1]=y.g;l[3*t*b+3*x+2]=y.b;s=s.add(n);u=u.add(q)}r+=
p}return l},e.CalcProjectionSpherical=function(b,d,e,f){var j=Math.atan2(b.z,b.x);for(b=Math.acos(b.y);j<-Math.PI;)j+=2*Math.PI;for(;j>Math.PI;)j-=2*Math.PI;j/=Math.PI;b/=Math.PI;j=Math.round((0.5*j+0.5)*e);0>j?j=0:j>=e&&(j=e-1);b=Math.round(b*f);0>b?b=0:b>=f&&(b=f-1);f=f-b-1;return{r:d[3*f*e+3*j+0],g:d[3*f*e+3*j+1],b:d[3*f*e+3*j+2]}},e.FACE_FRONT=[new b.Vector3(-1,-1,-1),new b.Vector3(1,-1,-1),new b.Vector3(-1,1,-1),new b.Vector3(1,1,-1)],e.FACE_BACK=[new b.Vector3(1,-1,1),new b.Vector3(-1,-1,1),
new b.Vector3(1,1,1),new b.Vector3(-1,1,1)],e.FACE_RIGHT=[new b.Vector3(1,-1,-1),new b.Vector3(1,-1,1),new b.Vector3(1,1,-1),new b.Vector3(1,1,1)],e.FACE_LEFT=[new b.Vector3(-1,-1,1),new b.Vector3(-1,-1,-1),new b.Vector3(-1,1,1),new b.Vector3(-1,1,-1)],e.FACE_DOWN=[new b.Vector3(-1,1,-1),new b.Vector3(1,1,-1),new b.Vector3(-1,1,1),new b.Vector3(1,1,1)],e.FACE_UP=[new b.Vector3(-1,-1,1),new b.Vector3(1,-1,1),new b.Vector3(-1,-1,-1),new b.Vector3(1,-1,-1)],e);f.PanoramaToCubeMapTools=b;!0}(BABYLON||
(BABYLON={}));
!function(b){var f=b.Internals||(b.Internals={});b=function(){};b=(b.Ldexp=function(b,c){return 1023<c?b*Math.pow(2,1023)*Math.pow(2,c-1023):-1074>c?b*Math.pow(2,-1074)*Math.pow(2,c+1074):b*Math.pow(2,c)},b.Rgbe2float=function(b,c,d,f,m,j){0<m?(m=this.Ldexp(1,m-136),b[j+0]=c*m,b[j+1]=d*m,b[j+2]=f*m):(b[j+0]=0,b[j+1]=0,b[j+2]=0)},b.readStringLine=function(b,c){for(var d="",f="",m=c;m<b.length-c&&(f=String.fromCharCode(b[m]),"\n"!=f);m++)d+=f;return d},b.RGBE_ReadHeader=function(b){var c=0,d=0,f=this.readStringLine(b,
0);if("#"!=f[0]||"?"!=f[1])throw"Bad HDR Format.";var m=c=!1,j=0;do j+=f.length+1,f=this.readStringLine(b,j),"FORMAT=32-bit_rle_rgbe"==f?m=!0:0==f.length&&(c=!0);while(!c);if(!m)throw"HDR Bad header format, unsupported FORMAT";j+=f.length+1;f=this.readStringLine(b,j);b=/^\-Y (.*) \+X (.*)$/g.exec(f);if(3>b.length)throw"HDR Bad header format, no size";if(d=parseInt(b[2]),c=parseInt(b[1]),8>d||32767<d)throw"HDR Bad header format, unsupported size";return j+=f.length+1,{height:c,width:d,dataPosition:j}},
b.GetCubeMapTextureData=function(b,c){var d=new Uint8Array(b),g=this.RGBE_ReadHeader(d),d=this.RGBE_ReadPixels_RLE(d,g);return f.PanoramaToCubeMapTools.ConvertPanoramaToCubemap(d,g.width,g.height,c)},b.RGBE_ReadPixels=function(b,c){return this.RGBE_ReadPixels_RLE(b,c)},b.RGBE_ReadPixels_RLE=function(b,c){for(var d,f,m,j,l,n=c.height,q=c.width,p=c.dataPosition,r=j=0,t=0,s=new ArrayBuffer(4*q),s=new Uint8Array(s),t=new ArrayBuffer(12*c.width*c.height),u=new Float32Array(t);0<n;){if(d=b[p++],f=b[p++],
m=b[p++],j=b[p++],2!=d||2!=f||128&m)throw"HDR Bad header format, not RLE";if((m<<8|j)!=q)throw"HDR Bad header format, wrong scan line width";for(t=j=0;4>t;t++)for(r=(t+1)*q;r>j;)if(d=b[p++],f=b[p++],128<d){if(l=d-128,0==l||l>r-j)throw"HDR Bad Format, bad scanline data (run)";for(;0<l--;)s[j++]=f}else{if(l=d,0==l||l>r-j)throw"HDR Bad Format, bad scanline data (non-run)";if(s[j++]=f,0<--l)for(var x=0;l>x;x++)s[j++]=b[p++]}for(t=0;q>t;t++)d=s[t],f=s[t+q],m=s[t+2*q],j=s[t+3*q],this.Rgbe2float(u,d,f,m,
j,3*(c.height-n)*q+3*t);n--}return u},b);f.HDRTools=b;!0}(BABYLON||(BABYLON={}));
!function(b){var f=b.Internals||(b.Internals={}),e,c=function(){this.min=new b.Vector3(0,0,0);this.max=new b.Vector3(0,0,0);this.clear()};e=(c.prototype.clear=function(){this.min.x=c.MAX;this.min.y=c.MAX;this.min.z=c.MAX;this.max.x=c.MIN;this.max.y=c.MIN;this.max.z=c.MIN},c.prototype.augment=function(b,c,d){this.min.x=Math.min(this.min.x,b);this.min.y=Math.min(this.min.y,c);this.min.z=Math.min(this.min.z,d);this.max.x=Math.max(this.max.x,b);this.max.y=Math.max(this.max.y,c);this.max.z=Math.max(this.max.z,
d)},c.prototype.clampMin=function(b,c,d){this.min.x=Math.max(this.min.x,b);this.min.y=Math.max(this.min.y,c);this.min.z=Math.max(this.min.z,d)},c.prototype.clampMax=function(b,c,d){this.max.x=Math.min(this.max.x,b);this.max.y=Math.min(this.max.y,c);this.max.z=Math.min(this.max.z,d)},c.prototype.empty=function(){return this.min.x>this.max.y||this.min.y>this.max.y||this.min.z>this.max.y},c.MAX=Number.MAX_VALUE,c.MIN=Number.MIN_VALUE,c);var d,g=function(b,c,d,e,f,g,r,t,s,u){this.input=b;this.inputSize=
c;this.outputSize=d;this.maxNumMipLevels=e;this.numChannels=f;this.isFloat=g;this.specularPower=r;this.cosinePowerDropPerMip=t;this.excludeBase=s;this.fixup=u;this._outputSurface=[];this._numMipLevels=0};d=(g.prototype.filterCubeMap=function(){return this.init(),this.filterCubeMapMipChain(),this._outputSurface},g.prototype.init=function(){var b,c,d;0==this.maxNumMipLevels&&(this.maxNumMipLevels=g.CP_MAX_MIPLEVELS);d=this.outputSize;for(c=0;c<this.maxNumMipLevels;c++){this._outputSurface.length++;
this._outputSurface[c]=[];for(b=0;6>b;b++)this._outputSurface[c].length++,this.isFloat?this._outputSurface[c][b]=new Float32Array(d*d*this.numChannels):this._outputSurface[c][b]=new Uint32Array(d*d*this.numChannels);if(d>>=1,this._numMipLevels++,0==d)return void(this.maxNumMipLevels=c)}},g.prototype.filterCubeMapMipChain=function(){var b=this.specularPower;this.precomputeFilterLookupTables(this.inputSize);for(var c=0;c<this._numMipLevels;c++){this.excludeBase&&0==c&&(b=1E5);var d=this.input,e=this._outputSurface[c],
f=this.outputSize>>c,g=this.getBaseFilterAngle(b);this.filterCubeSurfaces(d,this.inputSize,e,f,g,b);this.fixup&&this.fixupCubeEdges(e,f);this.excludeBase&&0==c&&(b=this.specularPower);b*=this.cosinePowerDropPerMip}},g.prototype.getBaseFilterAngle=function(b){var c=180;return c=Math.acos(Math.pow(1E-6,1/b)),c*=180/Math.PI,2*c},g.prototype.precomputeFilterLookupTables=function(b){this._normCubeMap=[];this.buildNormalizerSolidAngleCubemap(b)},g.prototype.buildNormalizerSolidAngleCubemap=function(b){var c,
d,e;for(c=0;6>c;c++){this._normCubeMap.push(new Float32Array(4*b*b));this.input[c];for(e=0;b>e;e++)for(d=0;b>d;d++){var f=this.texelCoordToVect(c,d,e,b,this.fixup);this._normCubeMap[c][4*(e*b+d)+0]=f.x;this._normCubeMap[c][4*(e*b+d)+1]=f.y;this._normCubeMap[c][4*(e*b+d)+2]=f.z;f=this.texelCoordSolidAngle(c,d,e,b);this._normCubeMap[c][4*(e*b+d)+4]=f}}},g.prototype.texelCoordToVect=function(b,c,d,e,f){if(c=2*(c+0.5)/e-1,d=2*(d+0.5)/e-1,f&&1<e)e=Math.pow(e,2)/Math.pow(e-1,3),c=e*Math.pow(c,3)+c,d=e*
Math.pow(d,3)+d;e=g._sgFace2DMapping[b][g.CP_UDIR];g._vectorTemp.x=e[0]*c;g._vectorTemp.y=e[1]*c;g._vectorTemp.z=e[2]*c;c=g._sgFace2DMapping[b][g.CP_VDIR];g._vectorTemp.x+=c[0]*d;g._vectorTemp.y+=c[1]*d;g._vectorTemp.z+=c[2]*d;b=g._sgFace2DMapping[b][g.CP_FACEAXIS];return g._vectorTemp.x+=b[0],g._vectorTemp.y+=b[1],g._vectorTemp.z+=b[2],g._vectorTemp.normalize(),g._vectorTemp},g.prototype.vectToTexelCoord=function(b,c,d,e){var f,p,r=Math.abs(b),t=Math.abs(c),s=Math.abs(d);r>=t&&r>=s?(f=r,p=0<=b?g.CP_FACE_X_POS:
g.CP_FACE_X_NEG):t>=r&&t>=s?(f=t,p=0<=c?g.CP_FACE_Y_POS:g.CP_FACE_Y_NEG):(f=s,p=0<=d?g.CP_FACE_Z_POS:g.CP_FACE_Z_NEG);f=1/f;b*=f;c*=f;d*=f;f=g._sgFace2DMapping[p][g.CP_UDIR];r=f[0]*b+f[1]*c+f[2]*d;f=g._sgFace2DMapping[p][g.CP_VDIR];r=Math.floor(0.5*(e-1)*(r+1));b=Math.floor(0.5*(e-1)*(f[0]*b+f[1]*c+f[2]*d+1));return g._vectorTemp.x=p,g._vectorTemp.y=r,g._vectorTemp.z=b,g._vectorTemp},g.prototype.areaElement=function(b,c){return Math.atan2(b*c,Math.sqrt(b*b+c*c+1))},g.prototype.texelCoordSolidAngle=
function(b,c,d,e){c=2*(c+0.5)/e-1;d=2*(d+0.5)/e-1;var f=1/e;b=c-f;e=d-f;c+=f;d+=f;return this.areaElement(b,e)-this.areaElement(b,d)-this.areaElement(c,e)+this.areaElement(c,d)},g.prototype.filterCubeSurfaces=function(b,c,d,f,g,p){var r,t,s,u=[];for(r=0;6>r;r++)u.push(new e);r=180/Math.PI*Math.atan2(1,c);t=g/2;r>t&&(t=r);90<t&&(t=90);g=Math.ceil(t/r);1>g&&(g=1);var x=Math.cos(Math.PI/180*t);for(r=0;6>r;r++)for(s=0;f>s;s++)for(t=0;f>t;t++){var y=this.texelCoordToVect(r,t,s,f,this.fixup).clone();this.clearFilterExtents(u);
this.determineFilterExtents(y,c,g,u);y=this.processFilterExtents(y,x,u,b,c,p);d[r][(s*f+t)*this.numChannels+0]=y.x;d[r][(s*f+t)*this.numChannels+1]=y.y;d[r][(s*f+t)*this.numChannels+2]=y.z}},g.prototype.clearFilterExtents=function(b){for(var c=0;6>c;c++)b[c].clear()},g.prototype.determineFilterExtents=function(b,c,d,e){var f,p,r=[0,0,0,0],t=[0,0,0,0],s=[0,0,0,0],u=this.vectToTexelCoord(b.x,b.y,b.z,c);b=u.x;var x=u.y,u=u.z;e[b].augment(x-d,u-d,0);e[b].augment(x+d,u+d,0);e[b].clampMin(0,0,0);e[b].clampMax(c-
1,c-1,0);var y=e[b].min.x,z=e[b].min.y,A=e[b].max.x,B=e[b].max.y;r[0]=d-x;t[0]=z;s[0]=B;r[1]=x+d-(c-1);t[1]=z;s[1]=B;r[2]=d-u;t[2]=y;s[2]=A;r[3]=u+d-(c-1);t[3]=y;s[3]=A;for(x=0;4>x;x++){if(0<r[x]){switch(d=g._sgCubeNgh[b][x][0],f=g._sgCubeNgh[b][x][1],x!=f&&3!=x+f||(t[x]=c-1-t[x],s[x]=c-1-s[x]),g._sgCubeNgh[b][x][1]){case g.CP_EDGE_LEFT:e[d].augment(0,t[x],0);e[d].augment(r[x],s[x],0);break;case g.CP_EDGE_RIGHT:e[d].augment(c-1,t[x],0);e[d].augment(c-1-r[x],s[x],0);break;case g.CP_EDGE_TOP:e[d].augment(t[x],
0,0);e[d].augment(s[x],r[x],0);break;case g.CP_EDGE_BOTTOM:e[d].augment(t[x],c-1,0),e[d].augment(s[x],c-1-r[x],0)}e[d].clampMin(0,0,0);e[d].clampMax(c-1,c-1,0)}if(r[x]>c){switch(b){case g.CP_FACE_X_POS:p=g.CP_FACE_X_NEG;break;case g.CP_FACE_X_NEG:p=g.CP_FACE_X_POS;break;case g.CP_FACE_Y_POS:p=g.CP_FACE_Y_NEG;break;case g.CP_FACE_Y_NEG:p=g.CP_FACE_Y_POS;break;case g.CP_FACE_Z_POS:p=g.CP_FACE_Z_NEG;break;case g.CP_FACE_Z_NEG:p=g.CP_FACE_Z_POS}e[p].augment(0,0,0);e[p].augment(c-1,c-1,0)}}},g.prototype.processFilterExtents=
function(b,c,d,e,f,p){for(var r=[0,0,0,0],t=0,s=0,u=this.numChannels,x=4*f,y=f*this.numChannels,z=0;6>z;z++)if(!d[z].empty())for(var A=d[z].min.x,B=d[z].min.y,C=d[z].max.x,D=d[z].max.y,E=4*(B*f+A),I=this.numChannels*(B*f+A);D>=B;B++){for(var H=0,F=0,J=A;C>=J;J++){s=this._normCubeMap[z][E+H+0]*b.x+this._normCubeMap[z][E+H+1]*b.y+this._normCubeMap[z][E+H+2]*b.z;if(s>=c&&0<s){for(var G=this._normCubeMap[z][E+H+3],G=G*Math.pow(s,p+1),s=0;u>s;s++)r[s]+=G*e[z][I+F],F++;t+=G}else F+=u;H+=4}E+=x;I+=y}0!=
t?(g._vectorTemp.x=r[0]/t,g._vectorTemp.y=r[1]/t,g._vectorTemp.z=r[2]/t,3<this.numChannels&&(g._vectorTemp.w=r[3]/t)):(b=this.vectToTexelCoord(b.x,b.y,b.z,f).clone(),g._vectorTemp.x=e[b.x][this.numChannels*(b.z*f+b.y)+0],g._vectorTemp.y=e[b.x][this.numChannels*(b.z*f+b.y)+1],g._vectorTemp.z=e[b.x][this.numChannels*(b.z*f+b.y)+2],3<this.numChannels&&(g._vectorTemp.z=e[b.x][this.numChannels*(b.z*f+b.y)+3]));return g._vectorTemp},g.prototype.fixupCubeEdges=function(b,c){var d,e,f,p=0;d=[0,0,0,0,0,0,
0,0];var r=[[],[],[],[]],t=[[[],[],[]],[[],[],[]],[[],[],[]],[[],[],[]],[[],[],[]],[[],[],[]],[[],[],[]],[[],[],[]]];if(!(1>c))if(1!=c){for(f=0;6>f;f++){r[0]=[f,0];r[1]=[f,(c-1)*this.numChannels];r[2]=[f,c*(c-1)*this.numChannels];r[3]=[f,(c*(c-1)+(c-1))*this.numChannels];for(p=0;4>p;p++){var s=g._sgCubeCornerList[f][p];t[s][d[s]]=r[p];d[s]++}}for(p=0;8>p;p++)for(d=0;d<this.numChannels;d++){for(f=r=0;3>f;f++)r+=b[t[p][f][0]][t[p][f][1]+d];r*=1/3;for(f=0;3>f;f++)b[t[p][f][0]][t[p][f][1]+d]=r}for(f=
0;12>f;f++){p=g._sgCubeEdgeList[f][0];d=g._sgCubeEdgeList[f][1];t=g._sgCubeNgh[p][d][0];e=g._sgCubeNgh[p][d][1];var u=s=r=0,x=0;switch(d){case g.CP_EDGE_LEFT:u=this.numChannels*c;break;case g.CP_EDGE_RIGHT:r+=(c-1)*this.numChannels;u=this.numChannels*c;break;case g.CP_EDGE_TOP:u=this.numChannels;break;case g.CP_EDGE_BOTTOM:r+=c*(c-1)*this.numChannels,u=this.numChannels}if(d==e||3==d+e)switch(e){case g.CP_EDGE_LEFT:s+=(c-1)*c*this.numChannels;x=-(this.numChannels*c);break;case g.CP_EDGE_RIGHT:s+=((c-
1)*c+(c-1))*this.numChannels;x=-(this.numChannels*c);break;case g.CP_EDGE_TOP:s+=(c-1)*this.numChannels;x=-this.numChannels;break;case g.CP_EDGE_BOTTOM:s+=((c-1)*c+(c-1))*this.numChannels,x=-this.numChannels}else switch(e){case g.CP_EDGE_LEFT:x=this.numChannels*c;break;case g.CP_EDGE_RIGHT:s+=(c-1)*this.numChannels;x=this.numChannels*c;break;case g.CP_EDGE_TOP:x=this.numChannels;break;case g.CP_EDGE_BOTTOM:s+=c*(c-1)*this.numChannels,x=this.numChannels}r+=u;s+=x;for(e=1;c-1>e;e++){for(d=0;d<this.numChannels;d++){var y=
0.5*(b[p][r+d]+b[t][s+d]);b[p][r+d]=y;b[t][s+d]=y}r+=u;s+=x}}}else for(d=0;d<this.numChannels;d++){for(f=p=0;6>f;f++)p+=b[f][d];p/=6;for(f=0;6>f;f++)b[f][d]=p}},g.CP_MAX_MIPLEVELS=16,g.CP_UDIR=0,g.CP_VDIR=1,g.CP_FACEAXIS=2,g.CP_FACE_X_POS=0,g.CP_FACE_X_NEG=1,g.CP_FACE_Y_POS=2,g.CP_FACE_Y_NEG=3,g.CP_FACE_Z_POS=4,g.CP_FACE_Z_NEG=5,g.CP_EDGE_LEFT=0,g.CP_EDGE_RIGHT=1,g.CP_EDGE_TOP=2,g.CP_EDGE_BOTTOM=3,g.CP_CORNER_NNN=0,g.CP_CORNER_NNP=1,g.CP_CORNER_NPN=2,g.CP_CORNER_NPP=3,g.CP_CORNER_PNN=4,g.CP_CORNER_PNP=
5,g.CP_CORNER_PPN=6,g.CP_CORNER_PPP=7,g._vectorTemp=new b.Vector4(0,0,0,0),g._sgFace2DMapping=[[[0,0,-1],[0,-1,0],[1,0,0]],[[0,0,1],[0,-1,0],[-1,0,0]],[[1,0,0],[0,0,1],[0,1,0]],[[1,0,0],[0,0,-1],[0,-1,0]],[[1,0,0],[0,-1,0],[0,0,1]],[[-1,0,0],[0,-1,0],[0,0,-1]]],g._sgCubeNgh=[[[g.CP_FACE_Z_POS,g.CP_EDGE_RIGHT],[g.CP_FACE_Z_NEG,g.CP_EDGE_LEFT],[g.CP_FACE_Y_POS,g.CP_EDGE_RIGHT],[g.CP_FACE_Y_NEG,g.CP_EDGE_RIGHT]],[[g.CP_FACE_Z_NEG,g.CP_EDGE_RIGHT],[g.CP_FACE_Z_POS,g.CP_EDGE_LEFT],[g.CP_FACE_Y_POS,g.CP_EDGE_LEFT],
[g.CP_FACE_Y_NEG,g.CP_EDGE_LEFT]],[[g.CP_FACE_X_NEG,g.CP_EDGE_TOP],[g.CP_FACE_X_POS,g.CP_EDGE_TOP],[g.CP_FACE_Z_NEG,g.CP_EDGE_TOP],[g.CP_FACE_Z_POS,g.CP_EDGE_TOP]],[[g.CP_FACE_X_NEG,g.CP_EDGE_BOTTOM],[g.CP_FACE_X_POS,g.CP_EDGE_BOTTOM],[g.CP_FACE_Z_POS,g.CP_EDGE_BOTTOM],[g.CP_FACE_Z_NEG,g.CP_EDGE_BOTTOM]],[[g.CP_FACE_X_NEG,g.CP_EDGE_RIGHT],[g.CP_FACE_X_POS,g.CP_EDGE_LEFT],[g.CP_FACE_Y_POS,g.CP_EDGE_BOTTOM],[g.CP_FACE_Y_NEG,g.CP_EDGE_TOP]],[[g.CP_FACE_X_POS,g.CP_EDGE_RIGHT],[g.CP_FACE_X_NEG,g.CP_EDGE_LEFT],
[g.CP_FACE_Y_POS,g.CP_EDGE_TOP],[g.CP_FACE_Y_NEG,g.CP_EDGE_BOTTOM]]],g._sgCubeEdgeList=[[g.CP_FACE_X_POS,g.CP_EDGE_LEFT],[g.CP_FACE_X_POS,g.CP_EDGE_RIGHT],[g.CP_FACE_X_POS,g.CP_EDGE_TOP],[g.CP_FACE_X_POS,g.CP_EDGE_BOTTOM],[g.CP_FACE_X_NEG,g.CP_EDGE_LEFT],[g.CP_FACE_X_NEG,g.CP_EDGE_RIGHT],[g.CP_FACE_X_NEG,g.CP_EDGE_TOP],[g.CP_FACE_X_NEG,g.CP_EDGE_BOTTOM],[g.CP_FACE_Z_POS,g.CP_EDGE_TOP],[g.CP_FACE_Z_POS,g.CP_EDGE_BOTTOM],[g.CP_FACE_Z_NEG,g.CP_EDGE_TOP],[g.CP_FACE_Z_NEG,g.CP_EDGE_BOTTOM]],g._sgCubeCornerList=
[[g.CP_CORNER_PPP,g.CP_CORNER_PPN,g.CP_CORNER_PNP,g.CP_CORNER_PNN],[g.CP_CORNER_NPN,g.CP_CORNER_NPP,g.CP_CORNER_NNN,g.CP_CORNER_NNP],[g.CP_CORNER_NPN,g.CP_CORNER_PPN,g.CP_CORNER_NPP,g.CP_CORNER_PPP],[g.CP_CORNER_NNP,g.CP_CORNER_PNP,g.CP_CORNER_NNN,g.CP_CORNER_PNN],[g.CP_CORNER_NPP,g.CP_CORNER_PPP,g.CP_CORNER_NNP,g.CP_CORNER_PNP],[g.CP_CORNER_PPN,g.CP_CORNER_NPN,g.CP_CORNER_PNN,g.CP_CORNER_NNN]],g);f.PMREMGenerator=d;!0}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.BaseTexture,c=function(c,f,m,j,l,n,q){void 0===j&&(j=!1);void 0===n&&(n=!1);void 0===q&&(q=!1);e.call(this,f);this._useInGammaSpace=!1;this._generateHarmonics=!0;this._isBABYLONPreprocessed=!1;this.coordinatesMode=b.Texture.CUBIC_MODE;this.sphericalPolynomial=null;this.isPMREM=!1;c&&(this.name=c,this.url=c,this.hasAlpha=!1,this.isCube=!0,this._textureMatrix=b.Matrix.Identity(),m?(this._isBABYLONPreprocessed=!1,this._noMipmap=j,this._size=m,this._useInGammaSpace=n,this._usePMREMGenerator=
q&&f.getEngine().getCaps().textureLOD&&this.getScene().getEngine().getCaps().textureFloat&&!this._useInGammaSpace):(this._isBABYLONPreprocessed=!0,this._noMipmap=!1,this._useInGammaSpace=!1,this._usePMREMGenerator=f.getEngine().getCaps().textureLOD&&this.getScene().getEngine().getCaps().textureFloat&&!this._useInGammaSpace),this.isPMREM=this._usePMREMGenerator,this._texture=this._getFromCache(c,this._noMipmap),this._texture||(f.useDelayedTextureLoading?this.delayLoadState=b.Engine.DELAYLOADSTATE_NOTLOADED:
this.loadTexture()))};f=(__extends(c,e),c.prototype.loadBabylonTexture=function(){var c=this,e=0,f=null,j=!this._useInGammaSpace&&this.getScene().getEngine().getCaps().textureFloat?function(){for(var b=[],j=30,q=0;e>q;q++){b.push([]);for(var p=3*Math.pow(c._size>>q,2),r=0;6>r;r++){var t=f.subarray(j,j+p);b[q].push(t);j+=p}}return b}:null;this._texture=this.getScene().getEngine().createRawCubeTexture(this.url,this.getScene(),this._size,b.Engine.TEXTUREFORMAT_RGB,this.getScene().getEngine().getCaps().textureFloat?
b.Engine.TEXTURETYPE_FLOAT:b.Engine.TEXTURETYPE_UNSIGNED_INT,this._noMipmap,function(l){var n=new Int32Array(l);f=new Float32Array(l);n[0];c._size=n[1];c.getScene().getEngine().updateTextureSize(c._texture,c._size,c._size);c.sphericalPolynomial=new b.SphericalPolynomial;c.sphericalPolynomial.x.copyFromFloats(f[2],f[3],f[4]);c.sphericalPolynomial.y.copyFromFloats(f[5],f[6],f[7]);c.sphericalPolynomial.z.copyFromFloats(f[8],f[9],f[10]);c.sphericalPolynomial.xx.copyFromFloats(f[11],f[12],f[13]);c.sphericalPolynomial.yy.copyFromFloats(f[14],
f[15],f[16]);c.sphericalPolynomial.zz.copyFromFloats(f[17],f[18],f[19]);c.sphericalPolynomial.xy.copyFromFloats(f[20],f[21],f[22]);c.sphericalPolynomial.yz.copyFromFloats(f[23],f[24],f[25]);c.sphericalPolynomial.zx.copyFromFloats(f[26],f[27],f[28]);e=n[29];var q=30;l=[];for(var n=3*Math.pow(c._size,2),p=0;6>p;p++)l.push(f.subarray(q,q+n)),q+=n;for(var q=[],r=null,p=0;6>p;p++){var t=null;if(j)t=l[p];else{if(t=l[[0,2,4,1,3,5][p]],!c.getScene().getEngine().getCaps().textureFloat)r=new ArrayBuffer(n),
r=new Uint8Array(r);for(var s=0;s<c._size*c._size;s++)if(c._useInGammaSpace&&(t[3*s+0]=Math.pow(t[3*s+0],b.ToGammaSpace),t[3*s+1]=Math.pow(t[3*s+1],b.ToGammaSpace),t[3*s+2]=Math.pow(t[3*s+2],b.ToGammaSpace)),r){var u=Math.max(255*t[3*s+0],0),x=Math.max(255*t[3*s+1],0),y=Math.max(255*t[3*s+2],0),z=Math.max(Math.max(u,x),y);255<z&&(z=255/z,u*=z,x*=z,y*=z);r[3*s+0]=u;r[3*s+1]=x;r[3*s+2]=y}}r?q.push(r):q.push(t)}return q},j)},c.prototype.loadHDRTexture=function(){var d=this,e=null;!this._noMipmap&&this._usePMREMGenerator&&
(e=function(c){return(new b.Internals.PMREMGenerator(c,d._size,d._size,0,3,d.getScene().getEngine().getCaps().textureFloat,2048,0.25,!1,!0)).filterCubeMap()});this._texture=this.getScene().getEngine().createRawCubeTexture(this.url,this.getScene(),this._size,b.Engine.TEXTUREFORMAT_RGB,this.getScene().getEngine().getCaps().textureFloat?b.Engine.TEXTURETYPE_FLOAT:b.Engine.TEXTURETYPE_UNSIGNED_INT,this._noMipmap,function(e){e=b.Internals.HDRTools.GetCubeMapTextureData(e,d._size);d._generateHarmonics&&
(d.sphericalPolynomial=b.Internals.CubeMapToSphericalPolynomialTools.ConvertCubeMapToSphericalPolynomial(e));for(var f=[],g=null,n=0;6>n;n++){d.getScene().getEngine().getCaps().textureFloat||(g=new ArrayBuffer(3*d._size*d._size),g=new Uint8Array(g));var q=e[c._facesMapping[n]];if(d._useInGammaSpace||g)for(var p=0;p<d._size*d._size;p++)if(d._useInGammaSpace&&(q[3*p+0]=Math.pow(q[3*p+0],b.ToGammaSpace),q[3*p+1]=Math.pow(q[3*p+1],b.ToGammaSpace),q[3*p+2]=Math.pow(q[3*p+2],b.ToGammaSpace)),g){var r=Math.max(255*
q[3*p+0],0),t=Math.max(255*q[3*p+1],0),s=Math.max(255*q[3*p+2],0),u=Math.max(Math.max(r,t),s);255<u&&(u=255/u,r*=u,t*=u,s*=u);g[3*p+0]=r;g[3*p+1]=t;g[3*p+2]=s}g?f.push(g):f.push(q)}return f},e)},c.prototype.loadTexture=function(){this._isBABYLONPreprocessed?this.loadBabylonTexture():this.loadHDRTexture()},c.prototype.clone=function(){var b=this._isBABYLONPreprocessed?null:this._size,b=new c(this.url,this.getScene(),b,this._noMipmap,this._generateHarmonics,this._useInGammaSpace,this._usePMREMGenerator);
return b.level=this.level,b.wrapU=this.wrapU,b.wrapV=this.wrapV,b.coordinatesIndex=this.coordinatesIndex,b.coordinatesMode=this.coordinatesMode,b},c.prototype.delayLoad=function(){this.delayLoadState===b.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=b.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||this.loadTexture())},c.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},c.Parse=function(c,e,f){var j=null;c.name&&
!c.isRenderTarget&&(j=new b.HDRCubeTexture(f+c.name,e,c.isBABYLONPreprocessed?null:c.size,j.generateHarmonics,j.useInGammaSpace,j.usePMREMGenerator),j.name=c.name,j.hasAlpha=c.hasAlpha,j.level=c.level,j.coordinatesMode=c.coordinatesMode);return j},c.prototype.serialize=function(){if(!this.name)return null;var b={};return b.name=this.name,b.hasAlpha=this.hasAlpha,b.isCube=!0,b.level=this.level,b.size=this._size,b.coordinatesMode=this.coordinatesMode,b.useInGammaSpace=this._useInGammaSpace,b.generateHarmonics=
this._generateHarmonics,b.usePMREMGenerator=this._usePMREMGenerator,b.isBABYLONPreprocessed=this._isBABYLONPreprocessed,b},c.generateBabylonHDROnDisk=function(b,e,f){void 0===f&&(f=null);c.generateBabylonHDR(b,e,function(b){b=new Blob([b],{type:"application/octet-stream"});b=window.URL.createObjectURL(b);var c=document.createElement("a");document.body.appendChild(c);c.style.display="none";c.href=b;c.download="envmap.babylon.hdr";c.click()},f)},c.generateBabylonHDR=function(c,e,f,j){if((void 0===j&&
(j=null),!c)||!b.Tools.IsExponentOfTwo(e))return null;b.Tools.LoadFile(c,function(c){c=b.Internals.HDRTools.GetCubeMapTextureData(c,e);var d=b.Internals.CubeMapToSphericalPolynomialTools.ConvertCubeMapToSphericalPolynomial(c),j=[];j.push(c.right);j.push(c.left);j.push(c.up);j.push(c.down);j.push(c.front);j.push(c.back);c=(new b.Internals.PMREMGenerator(j,e,e,0,3,!0,2048,0.25,!1,!0)).filterCubeMap();var p;p=116;p+=4;for(j=0;j<c.length;j++){var r=e>>j;p+=12*6*r*r}p=new ArrayBuffer(p);j=new Int32Array(p);
r=new Float32Array(p);j[0]=1;j[1]=e;d.x.toArray(r,2);d.y.toArray(r,5);d.z.toArray(r,8);d.xx.toArray(r,11);d.yy.toArray(r,14);d.zz.toArray(r,17);d.xy.toArray(r,20);d.yz.toArray(r,23);d.zx.toArray(r,26);j[29]=c.length;d=30;for(j=0;j<c.length;j++)for(var t=3*Math.pow(e>>j,2),s=0;6>s;s++)r.set(c[j][s],d),d+=t;f(p)},null,null,!0,j)},c._facesMapping="right up front left down back".split(" "),c);b.HDRCubeTexture=f}(BABYLON||(BABYLON={}));
!function(b){var f=b.Debug||(b.Debug={}),e;e=function(c,d,e,f,j){void 0===f&&(f=!0);void 0===j&&(j=1);this.skeleton=c;this.mesh=d;this.autoUpdateBonesMatrices=f;this.renderingGroupId=j;this.color=b.Color3.White();this._debugLines=[];this._isEnabled=!1;this._scene=e;this.update();this._renderFunction=this.update.bind(this)};e=(Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(b){this._isEnabled!==b&&(this._isEnabled=b,b?this._scene.registerBeforeRender(this._renderFunction):
this._scene.unregisterBeforeRender(this._renderFunction))},enumerable:!0,configurable:!0}),e.prototype._getBonePosition=function(c,d,e,f,j,l){void 0===f&&(f=0);void 0===j&&(j=0);void 0===l&&(l=0);var n=b.Tmp.Matrix[0],q=d.getParent();if(n.copyFrom(d.getLocalMatrix()),0!==f||0!==j||0!==l)d=b.Tmp.Matrix[1],b.Matrix.IdentityToRef(d),d.m[12]=f,d.m[13]=j,d.m[14]=l,d.multiplyToRef(n,n);q&&n.multiplyToRef(q.getAbsoluteTransform(),n);n.multiplyToRef(e,n);c.x=n.m[12];c.y=n.m[13];c.z=n.m[14]},e.prototype._getLinesForBonesWithLength=
function(c,d){for(var e=c.length,f=0;e>f;f++){var j=c[f],l=this._debugLines[f];l||(l=[b.Vector3.Zero(),b.Vector3.Zero()],this._debugLines[f]=l);this._getBonePosition(l[0],j,d);this._getBonePosition(l[1],j,d,0,j.length,0)}},e.prototype._getLinesForBonesNoLength=function(c,d){for(var e=0,f=c.length-1;0<=f;f--){var j=c[f],l=j.getParent();if(l){var n=this._debugLines[e];n||(n=[b.Vector3.Zero(),b.Vector3.Zero()],this._debugLines[e]=n);this._getBonePosition(n[0],j,d);this._getBonePosition(n[1],l,d);e++}}},
e.prototype.update=function(){this.autoUpdateBonesMatrices&&this._updateBoneMatrix(this.skeleton.bones[0]);void 0===this.skeleton.bones[0].length?this._getLinesForBonesNoLength(this.skeleton.bones,this.mesh.getWorldMatrix()):this._getLinesForBonesWithLength(this.skeleton.bones,this.mesh.getWorldMatrix());this._debugMesh?b.MeshBuilder.CreateLineSystem(null,{lines:this._debugLines,updatable:!0,instance:this._debugMesh},this._scene):(this._debugMesh=b.MeshBuilder.CreateLineSystem(null,{lines:this._debugLines,
updatable:!0},this._scene),this._debugMesh.renderingGroupId=this.renderingGroupId);this._debugMesh.color=this.color},e.prototype._updateBoneMatrix=function(b){b.getParent()&&b.getLocalMatrix().multiplyToRef(b.getParent().getAbsoluteTransform(),b.getAbsoluteTransform());b=b.children;for(var d=b.length,e=0;d>e;e++)this._updateBoneMatrix(b[e])},e.prototype.dispose=function(){this._debugMesh&&(this.isEnabled=!1,this._debugMesh.dispose(),this._debugMesh=null)},e);f.SkeletonViewer=e;!0}(BABYLON||(BABYLON=
{}));
!function(b){var f,e=function(){this._dirty=!0;this._tempColor=new b.Color4(0,0,0,0);this._globalCurve=new b.Color4(0,0,0,0);this._highlightsCurve=new b.Color4(0,0,0,0);this._midtonesCurve=new b.Color4(0,0,0,0);this._shadowsCurve=new b.Color4(0,0,0,0);this._positiveCurve=new b.Color4(0,0,0,0);this._negativeCurve=new b.Color4(0,0,0,0);this._globalHue=30;this._globalExposure=this._globalSaturation=this._globalDensity=0;this._highlightsHue=30;this._highlightsExposure=this._highlightsSaturation=this._highlightsDensity=
0;this._midtonesHue=30;this._midtonesExposure=this._midtonesSaturation=this._midtonesDensity=0;this._shadowsHue=30;this._shadowsExposure=this._shadowsSaturation=this._shadowsDensity=0};f=(Object.defineProperty(e.prototype,"GlobalHue",{get:function(){return this._globalHue},set:function(b){this._globalHue=b;this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"GlobalDensity",{get:function(){return this._globalDensity},set:function(b){this._globalDensity=b;this._dirty=!0},
enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"GlobalSaturation",{get:function(){return this._globalSaturation},set:function(b){this._globalSaturation=b;this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"HighlightsHue",{get:function(){return this._highlightsHue},set:function(b){this._highlightsHue=b;this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"HighlightsDensity",{get:function(){return this._highlightsDensity},
set:function(b){this._highlightsDensity=b;this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"HighlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(b){this._highlightsSaturation=b;this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"HighlightsExposure",{get:function(){return this._highlightsExposure},set:function(b){this._highlightsExposure=b;this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,
"MidtonesHue",{get:function(){return this._midtonesHue},set:function(b){this._midtonesHue=b;this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"MidtonesDensity",{get:function(){return this._midtonesDensity},set:function(b){this._midtonesDensity=b;this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"MidtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(b){this._midtonesSaturation=b;this._dirty=!0},enumerable:!0,
configurable:!0}),Object.defineProperty(e.prototype,"MidtonesExposure",{get:function(){return this._midtonesExposure},set:function(b){this._midtonesExposure=b;this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ShadowsHue",{get:function(){return this._shadowsHue},set:function(b){this._shadowsHue=b;this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ShadowsDensity",{get:function(){return this._shadowsDensity},set:function(b){this._shadowsDensity=
b;this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ShadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(b){this._shadowsSaturation=b;this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ShadowsExposure",{get:function(){return this._shadowsExposure},set:function(b){this._shadowsExposure=b;this._dirty=!0},enumerable:!0,configurable:!0}),e.Bind=function(b,d){b._dirty&&(b._dirty=!1,b.getColorGradingDataToRef(b._globalHue,
b._globalDensity,b._globalSaturation,b._globalExposure,b._globalCurve),b.getColorGradingDataToRef(b._highlightsHue,b._highlightsDensity,b._highlightsSaturation,b._highlightsExposure,b._tempColor),b._tempColor.multiplyToRef(b._globalCurve,b._highlightsCurve),b.getColorGradingDataToRef(b._midtonesHue,b._midtonesDensity,b._midtonesSaturation,b._midtonesExposure,b._tempColor),b._tempColor.multiplyToRef(b._globalCurve,b._midtonesCurve),b.getColorGradingDataToRef(b._shadowsHue,b._shadowsDensity,b._shadowsSaturation,
b._shadowsExposure,b._tempColor),b._tempColor.multiplyToRef(b._globalCurve,b._shadowsCurve),b._highlightsCurve.subtractToRef(b._midtonesCurve,b._positiveCurve),b._midtonesCurve.subtractToRef(b._shadowsCurve,b._negativeCurve));d.setFloat4("vCameraColorCurvePositive",b._positiveCurve.r,b._positiveCurve.g,b._positiveCurve.b,b._positiveCurve.a);d.setFloat4("vCameraColorCurveNeutral",b._midtonesCurve.r,b._midtonesCurve.g,b._midtonesCurve.b,b._midtonesCurve.a);d.setFloat4("vCameraColorCurveNegative",b._negativeCurve.r,
b._negativeCurve.g,b._negativeCurve.b,b._negativeCurve.a)},e.PrepareUniforms=function(b){b.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},e.prototype.getColorGradingDataToRef=function(b,d,f,m,j){null!=b&&(b=e.clamp(b,0,360),d=e.clamp(d,-100,100),f=e.clamp(f,-100,100),m=e.clamp(m,-100,100),d=e.applyColorGradingSliderNonlinear(d),d*=0.5,m=e.applyColorGradingSliderNonlinear(m),0>d&&(d*=-1,b=(b+180)%360),e.fromHSBToRef(b,d,50+0.25*m,j),j.scaleToRef(2,j),j.a=
1+0.01*f)},e.applyColorGradingSliderNonlinear=function(b){b/=100;var d=Math.abs(b);return d=Math.pow(d,2),0>b&&(d*=-1),100*d},e.fromHSBToRef=function(b,d,f,m){var j=e.clamp(b,0,360);d=e.clamp(d/100,0,1);f=e.clamp(f/100,0,1);if(0===d)m.r=f,m.g=f,m.b=f;else{j/=60;b=Math.floor(j);var l=j-b,j=f*(1-d),n=f*(1-d*l);d=f*(1-d*(1-l));switch(b){case 0:m.r=f;m.g=d;m.b=j;break;case 1:m.r=n;m.g=f;m.b=j;break;case 2:m.r=j;m.g=f;m.b=d;break;case 3:m.r=j;m.g=n;m.b=f;break;case 4:m.r=d;m.g=j;m.b=f;break;default:m.r=
f,m.g=j,m.b=n}}m.a=1},e.clamp=function(b,d,e){return Math.min(Math.max(b,d),e)},e.prototype.clone=function(){return b.SerializationHelper.Clone(function(){return new e},this)},e.prototype.serialize=function(){return b.SerializationHelper.Serialize(this)},e.Parse=function(c){return b.SerializationHelper.Parse(function(){return new e},c,null,null)},__decorate([b.serialize()],e.prototype,"_globalHue",void 0),__decorate([b.serialize()],e.prototype,"_globalDensity",void 0),__decorate([b.serialize()],e.prototype,
"_globalSaturation",void 0),__decorate([b.serialize()],e.prototype,"_globalExposure",void 0),__decorate([b.serialize()],e.prototype,"_highlightsHue",void 0),__decorate([b.serialize()],e.prototype,"_highlightsDensity",void 0),__decorate([b.serialize()],e.prototype,"_highlightsSaturation",void 0),__decorate([b.serialize()],e.prototype,"_highlightsExposure",void 0),__decorate([b.serialize()],e.prototype,"_midtonesHue",void 0),__decorate([b.serialize()],e.prototype,"_midtonesDensity",void 0),__decorate([b.serialize()],
e.prototype,"_midtonesSaturation",void 0),__decorate([b.serialize()],e.prototype,"_midtonesExposure",void 0),e);b.ColorCurves=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.BaseTexture,c=function(c,f){e.call(this,f);c&&(this._textureMatrix=b.Matrix.Identity(),this.name=c,this.url=c,this.hasAlpha=!1,this.isCube=!1,this.wrapU=b.Texture.CLAMP_ADDRESSMODE,this.wrapV=b.Texture.CLAMP_ADDRESSMODE,this.anisotropicFilteringLevel=1,this._texture=this._getFromCache(c,!0),this._texture||(f.useDelayedTextureLoading?this.delayLoadState=b.Engine.DELAYLOADSTATE_NOTLOADED:this.loadTexture()))};f=(__extends(c,e),c.prototype.getTextureMatrix=function(){return this._textureMatrix},
c.prototype.load3dlTexture=function(){var d=this,e=this.getScene().getEngine().createRawTexture(null,1,1,b.Engine.TEXTUREFORMAT_RGBA,!1,!1,b.Texture.BILINEAR_SAMPLINGMODE);this._texture=e;return b.Tools.LoadFile(this.url,function(f){var j,l,n;f=f.split("\n");for(var q=0,p=0,r=0,t=0,s=0,u=0;u<f.length;u++)if(n=f[u],c._noneEmptyLineRegex.test(n)&&0!==n.indexOf("#")){var x=n.split(" ");if(0!==q){if(0!=q){var y=Math.max(parseInt(x[0]),0),z=Math.max(parseInt(x[1]),0),x=Math.max(parseInt(x[2]),0),s=Math.max(y,
s),s=Math.max(z,s),s=Math.max(x,s),A=4*(p+t*q+r*q*q);l[A+0]=y;l[A+1]=z;l[A+2]=x;l[A+3]=0;t++;0==t%q&&(r++,t=0,0==r%q&&(p++,r=0))}}else q=x.length,j=new Uint8Array(4*q*q*q),l=new Float32Array(4*q*q*q)}for(u=0;u<l.length;u++)j[u]=255*(l[u]/s);d.getScene().getEngine().updateTextureSize(e,q*q,q);d.getScene().getEngine().updateRawTexture(e,j,b.Engine.TEXTUREFORMAT_RGBA,!1)}),this._texture},c.prototype.loadTexture=function(){this.url&&this.url.toLocaleLowerCase().indexOf(".3dl")==this.url.length-4&&this.load3dlTexture()},
c.prototype.clone=function(){var b=new c(this.url,this.getScene());return b.level=this.level,b},c.prototype.delayLoad=function(){this.delayLoadState===b.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=b.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,!0),this._texture||this.loadTexture())},c.Parse=function(c,e){var f=null;return c.name&&!c.isRenderTarget&&(f=new b.ColorGradingTexture(c.name,e),f.name=c.name,f.level=c.level),f},c.prototype.serialize=function(){if(!this.name)return null;
var b={};return b.name=this.name,b.level=this.level,b},c._noneEmptyLineRegex=/\S+/,c);b.ColorGradingTexture=f}(BABYLON||(BABYLON={}));
!function(b){var f,e=b.MaterialDefines,c=function(){e.call(this);this.VERTEXALPHA=this.VERTEXCOLOR=this.UV2=this.UV1=this.NORMAL=this.FRESNEL=this.EMISSIVEFRESNEL=this.OPACITYFRESNEL=this.SPECULARTERM=this.FOG=this.POINTSIZE=this.ALPHAFROMALBEDO=this.ALPHATEST=this.CLIPPLANE=this.SPECULAROVERALPHA=this.PARALLAXOCCLUSION=this.PARALLAX=this.BUMP=this.REFLECTIVITY=this.EMISSIVE=this.REFLECTION=this.OPACITYRGB=this.OPACITY=this.AMBIENT=this.ALBEDO=!1;this.BonesPerMesh=this.NUM_BONE_INFLUENCERS=0;this.INVERTNORMALMAPY=
this.INVERTNORMALMAPX=this.OPENGLNORMALMAP=this.USEPMREMREFRACTION=this.USEPMREMREFLECTION=this.RADIANCEOVERALPHA=this.USEPHYSICALLIGHTFALLOFF=this.LODBASEDMICROSFURACE=this.REFRACTIONMAPINLINEARSPACE=this.LINKREFRACTIONTOTRANSPARENCY=this.REFRACTIONMAP_3D=this.REFRACTION=this.USESPHERICALFROMREFLECTIONMAP=this.OVERLOADEDSHADOWVALUES=this.OVERLOADEDVALUES=this.CAMERACOLORCURVES=this.CAMERACOLORGRADING=this.CAMERACONTRAST=this.CAMERATONEMAP=this.LOGARITHMICDEPTH=this.INVERTCUBICMAP=this.REFLECTIONMAP_EQUIRECTANGULAR=
this.REFLECTIONMAP_EXPLICIT=this.REFLECTIONMAP_SKYBOX=this.REFLECTIONMAP_PROJECTION=this.REFLECTIONMAP_CUBIC=this.REFLECTIONMAP_PLANAR=this.REFLECTIONMAP_SPHERICAL=this.REFLECTIONMAP_3D=this.USELIGHTMAPASSHADOWMAP=this.LIGHTMAP=this.LINKEMISSIVEWITHALBEDO=this.EMISSIVEASILLUMINATION=this.MICROSURFACEAUTOMATIC=this.MICROSURFACEFROMREFLECTIVITYMAP=this.INSTANCES=!1;this.rebuild()};f=(__extends(c,e),c);var d=b.Material,g=function(c,e){var g=this;d.call(this,c,e);this.specularIntensity=this.environmentIntensity=
this.emissiveIntensity=this.directIntensity=1;this._lightingInfos=new b.Vector4(this.directIntensity,this.emissiveIntensity,this.environmentIntensity,this.specularIntensity);this.disableBumpMap=!1;this.overloadedShadeIntensity=this.overloadedShadowIntensity=1;this._overloadedShadowInfos=new b.Vector4(this.overloadedShadowIntensity,this.overloadedShadeIntensity,0,0);this.cameraContrast=this.cameraExposure=1;this.cameraColorGradingTexture=null;this._cameraColorGradingScaleOffset=new b.Vector4(1,1,0,
0);this._cameraColorGradingInfos=new b.Vector4(1,1,0,0);this.cameraColorCurves=null;this._cameraInfos=new b.Vector4(1,1,0,0);this._microsurfaceTextureLods=new b.Vector2(0,0);this.overloadedAmbient=b.Color3.White();this.overloadedAmbientIntensity=0;this.overloadedAlbedo=b.Color3.White();this.overloadedAlbedoIntensity=0;this.overloadedReflectivity=new b.Color3(0.3,0.3,0.3);this.overloadedReflectivityIntensity=0;this.overloadedEmissive=b.Color3.White();this.overloadedEmissiveIntensity=0;this._overloadedIntensity=
new b.Vector4(this.overloadedAmbientIntensity,this.overloadedAlbedoIntensity,this.overloadedReflectivityIntensity,this.overloadedEmissiveIntensity);this.overloadedReflection=b.Color3.White();this.overloadedMicroSurfaceIntensity=this.overloadedMicroSurface=this.overloadedReflectionIntensity=0;this._overloadedMicroSurface=new b.Vector3(this.overloadedMicroSurface,this.overloadedMicroSurfaceIntensity,this.overloadedReflectionIntensity);this.ambientColor=new b.Color3(0,0,0);this.albedoColor=new b.Color3(1,
1,1);this.reflectivityColor=new b.Color3(1,1,1);this.reflectionColor=new b.Color3(0.5,0.5,0.5);this.emissiveColor=new b.Color3(0,0,0);this.microSurface=0.9;this.indexOfRefraction=0.66;this.useAlphaFromAlbedoTexture=this.useEmissiveAsIllumination=this.useLightmapAsShadowmap=this.linkEmissiveWithAlbedo=this.linkRefractionWithTransparency=this.invertRefractionY=!1;this.useSpecularOverAlpha=!0;this.useScalarInLinearSpace=this.useAutoMicroSurfaceFromReflectivityMap=this.useMicroSurfaceFromReflectivityMapAlpha=
!1;this.useRadianceOverAlpha=this.usePhysicalLightFalloff=!0;this.useParallaxOcclusion=this.useParallax=!1;this.parallaxScaleBias=0.05;this.disableLighting=!1;this.maxSimultaneousLights=4;this.invertNormalMapY=this.invertNormalMapX=!1;this._renderTargets=new b.SmartArray(16);this._worldViewProjectionMatrix=b.Matrix.Zero();this._globalAmbientColor=new b.Color3(0,0,0);this._tempColor=new b.Color3;this._defines=new f;this._cachedDefines=new f;this._myShadowGenerator=this._myScene=null;this._cachedDefines.BonesPerMesh=
-1;this.getRenderTargetTextures=function(){return g._renderTargets.reset(),g.reflectionTexture&&g.reflectionTexture.isRenderTarget&&g._renderTargets.push(g.reflectionTexture),g.refractionTexture&&g.refractionTexture.isRenderTarget&&g._renderTargets.push(g.refractionTexture),g._renderTargets}},c=(__extends(g,d),Object.defineProperty(g.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(b){this._useLogarithmicDepth=b&&this.getScene().getEngine().getCaps().fragmentDepthSupported},
enumerable:!0,configurable:!0}),g.prototype.needAlphaBlending=function(){return this.linkRefractionWithTransparency?!1:1>this.alpha||null!=this.opacityTexture||this._shouldUseAlphaFromAlbedoTexture()||this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled},g.prototype.needAlphaTesting=function(){return this.linkRefractionWithTransparency?!1:null!=this.albedoTexture&&this.albedoTexture.hasAlpha},g.prototype._shouldUseAlphaFromAlbedoTexture=function(){return null!=this.albedoTexture&&
this.albedoTexture.hasAlpha&&this.useAlphaFromAlbedoTexture},g.prototype.getAlphaTestTexture=function(){return this.albedoTexture},g.prototype._checkCache=function(b,c,d){return c?this._defines.INSTANCES!==d?!1:!(!c._materialDefines||!c._materialDefines.isEqual(this._defines)):!0},g.prototype.convertColorToLinearSpaceToRef=function(b,c){g.convertColorToLinearSpaceToRef(b,c,this.useScalarInLinearSpace)},g.convertColorToLinearSpaceToRef=function(b,c,d){d?(c.r=b.r,c.g=b.g,c.b=b.b):b.toLinearSpaceToRef(c)},
g.BindLights=function(c,d,e,f,q,p,r){for(var t=0,s=!1,u=0;u<c.lights.length;u++){var x=c.lights[u];if(x.isEnabled()&&x.canAffectMesh(d)&&(b.MaterialHelper.BindLightProperties(x,e,t),this.convertColorToLinearSpaceToRef(x.diffuse,g._scaledAlbedo,q),g._scaledAlbedo.scaleToRef(x.intensity,g._scaledAlbedo),e.setColor4("vLightDiffuse"+t,g._scaledAlbedo,r?x.radius:x.range),f.SPECULARTERM&&(this.convertColorToLinearSpaceToRef(x.specular,g._scaledReflectivity,q),g._scaledReflectivity.scaleToRef(x.intensity,
g._scaledReflectivity),e.setColor3("vLightSpecular"+t,g._scaledReflectivity)),c.shadowsEnabled&&(s=b.MaterialHelper.BindLightShadow(x,c,d,t,e,s)),t++,t===p))break}},g.prototype.isReady=function(c,d){if(this.checkReadyOnlyOnce&&this._wasPreviouslyReady)return!0;var e=this.getScene();if(!this.checkReadyOnEveryCall&&this._renderId===e.getRenderId()&&this._checkCache(e,c,d))return!0;var g=e.getEngine(),q=!1,p=!1;if(this._defines.reset(),e.texturesEnabled){if(e.texturesEnabled){if(e.getEngine().getCaps().textureLOD&&
(this._defines.LODBASEDMICROSFURACE=!0),this.albedoTexture&&b.StandardMaterial.DiffuseTextureEnabled){if(!this.albedoTexture.isReady())return!1;p=!0;this._defines.ALBEDO=!0}if(this.ambientTexture&&b.StandardMaterial.AmbientTextureEnabled){if(!this.ambientTexture.isReady())return!1;p=!0;this._defines.AMBIENT=!0}if(this.opacityTexture&&b.StandardMaterial.OpacityTextureEnabled){if(!this.opacityTexture.isReady())return!1;p=!0;this._defines.OPACITY=!0;this.opacityTexture.getAlphaFromRGB&&(this._defines.OPACITYRGB=
!0)}if(this.reflectionTexture&&b.StandardMaterial.ReflectionTextureEnabled){if(!this.reflectionTexture.isReady())return!1;switch(q=!0,this._defines.REFLECTION=!0,this.reflectionTexture.coordinatesMode===b.Texture.INVCUBIC_MODE&&(this._defines.INVERTCUBICMAP=!0),this._defines.REFLECTIONMAP_3D=this.reflectionTexture.isCube,this.reflectionTexture.coordinatesMode){case b.Texture.CUBIC_MODE:case b.Texture.INVCUBIC_MODE:this._defines.REFLECTIONMAP_CUBIC=!0;break;case b.Texture.EXPLICIT_MODE:this._defines.REFLECTIONMAP_EXPLICIT=
!0;break;case b.Texture.PLANAR_MODE:this._defines.REFLECTIONMAP_PLANAR=!0;break;case b.Texture.PROJECTION_MODE:this._defines.REFLECTIONMAP_PROJECTION=!0;break;case b.Texture.SKYBOX_MODE:this._defines.REFLECTIONMAP_SKYBOX=!0;break;case b.Texture.SPHERICAL_MODE:this._defines.REFLECTIONMAP_SPHERICAL=!0;break;case b.Texture.EQUIRECTANGULAR_MODE:this._defines.REFLECTIONMAP_EQUIRECTANGULAR=!0}this.reflectionTexture instanceof b.HDRCubeTexture&&this.reflectionTexture&&(this._defines.USESPHERICALFROMREFLECTIONMAP=
!0,q=!0,this.reflectionTexture.isPMREM&&(this._defines.USEPMREMREFLECTION=!0))}if(this.lightmapTexture&&b.StandardMaterial.LightmapTextureEnabled){if(!this.lightmapTexture.isReady())return!1;p=!0;this._defines.LIGHTMAP=!0;this._defines.USELIGHTMAPASSHADOWMAP=this.useLightmapAsShadowmap}if(this.emissiveTexture&&b.StandardMaterial.EmissiveTextureEnabled){if(!this.emissiveTexture.isReady())return!1;p=!0;this._defines.EMISSIVE=!0}if(this.reflectivityTexture&&b.StandardMaterial.SpecularTextureEnabled){if(!this.reflectivityTexture.isReady())return!1;
p=!0;this._defines.REFLECTIVITY=!0;this._defines.MICROSURFACEFROMREFLECTIVITYMAP=this.useMicroSurfaceFromReflectivityMapAlpha;this._defines.MICROSURFACEAUTOMATIC=this.useAutoMicroSurfaceFromReflectivityMap}}if(e.getEngine().getCaps().standardDerivatives&&this.bumpTexture&&b.StandardMaterial.BumpTextureEnabled&&!this.disableBumpMap){if(!this.bumpTexture.isReady())return!1;p=!0;this._defines.BUMP=!0;this.useParallax&&(this._defines.PARALLAX=!0,this.useParallaxOcclusion&&(this._defines.PARALLAXOCCLUSION=
!0));this.invertNormalMapX&&(this._defines.INVERTNORMALMAPX=!0);this.invertNormalMapY&&(this._defines.INVERTNORMALMAPY=!0)}if(this.refractionTexture&&b.StandardMaterial.RefractionTextureEnabled){if(!this.refractionTexture.isReady())return!1;p=!0;this._defines.REFRACTION=!0;this._defines.REFRACTIONMAP_3D=this.refractionTexture.isCube;this.linkRefractionWithTransparency&&(this._defines.LINKREFRACTIONTOTRANSPARENCY=!0);this.refractionTexture instanceof b.HDRCubeTexture&&(this._defines.REFRACTIONMAPINLINEARSPACE=
!0,this.refractionTexture.isPMREM&&(this._defines.USEPMREMREFRACTION=!0))}if(this.cameraColorGradingTexture){if(!this.cameraColorGradingTexture.isReady())return!1;this._defines.CAMERACOLORGRADING=!0}}if(e.clipPlane&&(this._defines.CLIPPLANE=!0),g.getAlphaTesting()&&(this._defines.ALPHATEST=!0),this._shouldUseAlphaFromAlbedoTexture()&&(this._defines.ALPHAFROMALBEDO=!0),this.useEmissiveAsIllumination&&(this._defines.EMISSIVEASILLUMINATION=!0),this.linkEmissiveWithAlbedo&&(this._defines.LINKEMISSIVEWITHALBEDO=
!0),this.useLogarithmicDepth&&(this._defines.LOGARITHMICDEPTH=!0),1!=this.cameraContrast&&(this._defines.CAMERACONTRAST=!0),1!=this.cameraExposure&&(this._defines.CAMERATONEMAP=!0),this.cameraColorCurves&&(this._defines.CAMERACOLORCURVES=!0),1==this.overloadedShadeIntensity&&1==this.overloadedShadowIntensity||(this._defines.OVERLOADEDSHADOWVALUES=!0),(0<this.overloadedMicroSurfaceIntensity||0<this.overloadedEmissiveIntensity||0<this.overloadedReflectivityIntensity||0<this.overloadedAlbedoIntensity||
0<this.overloadedAmbientIntensity||0<this.overloadedReflectionIntensity)&&(this._defines.OVERLOADEDVALUES=!0),(this.pointsCloud||e.forcePointsCloud)&&(this._defines.POINTSIZE=!0),e.fogEnabled&&c&&c.applyFog&&e.fogMode!==b.Scene.FOGMODE_NONE&&this.fogEnabled&&(this._defines.FOG=!0),e.lightsEnabled&&!this.disableLighting&&(q=b.MaterialHelper.PrepareDefinesForLights(e,c,this._defines,this.maxSimultaneousLights)||q),b.StandardMaterial.FresnelEnabled&&(this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled||
this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled)&&(this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&(this._defines.OPACITYFRESNEL=!0),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._defines.EMISSIVEFRESNEL=!0),q=!0,this._defines.FRESNEL=!0),this._defines.SPECULARTERM&&this.useSpecularOverAlpha&&(this._defines.SPECULAROVERALPHA=!0),this.usePhysicalLightFalloff&&(this._defines.USEPHYSICALLIGHTFALLOFF=!0),this.useRadianceOverAlpha&&
(this._defines.RADIANCEOVERALPHA=!0),c&&(q&&c.isVerticesDataPresent(b.VertexBuffer.NormalKind)&&(this._defines.NORMAL=!0),p&&(c.isVerticesDataPresent(b.VertexBuffer.UVKind)&&(this._defines.UV1=!0),c.isVerticesDataPresent(b.VertexBuffer.UV2Kind)&&(this._defines.UV2=!0)),c.useVertexColors&&c.isVerticesDataPresent(b.VertexBuffer.ColorKind)&&(this._defines.VERTEXCOLOR=!0,c.hasVertexAlpha&&(this._defines.VERTEXALPHA=!0)),c.useBones&&c.computeBonesUsingShaders&&(this._defines.NUM_BONE_INFLUENCERS=c.numBoneInfluencers,
this._defines.BonesPerMesh=c.skeleton.bones.length+1),d&&(this._defines.INSTANCES=!0)),!this._defines.isEqual(this._cachedDefines)){this._defines.cloneTo(this._cachedDefines);e.resetCachedMaterial();g=new b.EffectFallbacks;this._defines.REFLECTION&&g.addFallback(0,"REFLECTION");this._defines.REFRACTION&&g.addFallback(0,"REFRACTION");this._defines.REFLECTIVITY&&g.addFallback(0,"REFLECTIVITY");this._defines.BUMP&&g.addFallback(0,"BUMP");this._defines.PARALLAX&&g.addFallback(1,"PARALLAX");this._defines.PARALLAXOCCLUSION&&
g.addFallback(0,"PARALLAXOCCLUSION");this._defines.SPECULAROVERALPHA&&g.addFallback(0,"SPECULAROVERALPHA");this._defines.FOG&&g.addFallback(1,"FOG");this._defines.POINTSIZE&&g.addFallback(0,"POINTSIZE");this._defines.LOGARITHMICDEPTH&&g.addFallback(0,"LOGARITHMICDEPTH");b.MaterialHelper.HandleFallbacksForShadows(this._defines,g,this.maxSimultaneousLights);this._defines.SPECULARTERM&&g.addFallback(0,"SPECULARTERM");this._defines.OPACITYFRESNEL&&g.addFallback(1,"OPACITYFRESNEL");this._defines.EMISSIVEFRESNEL&&
g.addFallback(2,"EMISSIVEFRESNEL");this._defines.FRESNEL&&g.addFallback(3,"FRESNEL");0<this._defines.NUM_BONE_INFLUENCERS&&g.addCPUSkinningFallback(0,c);q=[b.VertexBuffer.PositionKind];this._defines.NORMAL&&q.push(b.VertexBuffer.NormalKind);this._defines.UV1&&q.push(b.VertexBuffer.UVKind);this._defines.UV2&&q.push(b.VertexBuffer.UV2Kind);this._defines.VERTEXCOLOR&&q.push(b.VertexBuffer.ColorKind);b.MaterialHelper.PrepareAttributesForBones(q,c,this._defines,g);b.MaterialHelper.PrepareAttributesForInstances(q,
this._defines);p="pbr";e.getEngine().getCaps().standardDerivatives||(p="legacypbr");var r=this._defines.toString(),t="world view viewProjection vEyePosition vLightsType vAmbientColor vAlbedoColor vReflectivityColor vEmissiveColor vReflectionColor vFogInfos vFogColor pointSize vAlbedoInfos vAmbientInfos vOpacityInfos vReflectionInfos vEmissiveInfos vReflectivityInfos vBumpInfos vLightmapInfos vRefractionInfos mBones vClipPlane albedoMatrix ambientMatrix opacityMatrix reflectionMatrix emissiveMatrix reflectivityMatrix bumpMatrix lightmapMatrix refractionMatrix depthValues opacityParts emissiveLeftColor emissiveRightColor vLightingIntensity vOverloadedShadowIntensity vOverloadedIntensity vOverloadedAlbedo vOverloadedReflection vOverloadedReflectivity vOverloadedEmissive vOverloadedMicroSurface logarithmicDepthConstant vSphericalX vSphericalY vSphericalZ vSphericalXX vSphericalYY vSphericalZZ vSphericalXY vSphericalYZ vSphericalZX vMicrosurfaceTextureLods vCameraInfos vCameraColorGradingInfos vCameraColorGradingScaleOffset".split(" "),
s="albedoSampler ambientSampler opacitySampler reflectionCubeSampler reflection2DSampler emissiveSampler reflectivitySampler bumpSampler lightmapSampler refractionCubeSampler refraction2DSampler cameraColorGrading2DSampler".split(" ");b.ColorCurves.PrepareUniforms(t);b.MaterialHelper.PrepareUniformsAndSamplersList(t,s,this._defines,this.maxSimultaneousLights);this._effect=e.getEngine().createEffect(p,q,t,s,r,g,this.onCompiled,this.onError,{maxSimultaneousLights:this.maxSimultaneousLights})}return this._effect.isReady()?
(this._renderId=e.getRenderId(),this._wasPreviouslyReady=!0,c&&(c._materialDefines||(c._materialDefines=new f),this._defines.cloneTo(c._materialDefines)),!0):!1},g.prototype.unbind=function(){this.reflectionTexture&&this.reflectionTexture.isRenderTarget&&this._effect.setTexture("reflection2DSampler",null);this.refractionTexture&&this.refractionTexture.isRenderTarget&&this._effect.setTexture("refraction2DSampler",null);d.prototype.unbind.call(this)},g.prototype.bindOnlyWorldMatrix=function(b){this._effect.setMatrix("world",
b)},g.prototype.bind=function(c,e){if(this._myScene=this.getScene(),this.bindOnlyWorldMatrix(c),b.MaterialHelper.BindBonesParameters(e,this._effect),this._myScene.getCachedMaterial()!==this){if(this._effect.setMatrix("viewProjection",this._myScene.getTransformMatrix()),b.StandardMaterial.FresnelEnabled&&(this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&this._effect.setColor4("opacityParts",new b.Color3(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),
this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._effect.setColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),this._effect.setColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),this._myScene.texturesEnabled){if(this.albedoTexture&&b.StandardMaterial.DiffuseTextureEnabled&&(this._effect.setTexture("albedoSampler",
this.albedoTexture),this._effect.setFloat2("vAlbedoInfos",this.albedoTexture.coordinatesIndex,this.albedoTexture.level),this._effect.setMatrix("albedoMatrix",this.albedoTexture.getTextureMatrix())),this.ambientTexture&&b.StandardMaterial.AmbientTextureEnabled&&(this._effect.setTexture("ambientSampler",this.ambientTexture),this._effect.setFloat2("vAmbientInfos",this.ambientTexture.coordinatesIndex,this.ambientTexture.level),this._effect.setMatrix("ambientMatrix",this.ambientTexture.getTextureMatrix())),
this.opacityTexture&&b.StandardMaterial.OpacityTextureEnabled&&(this._effect.setTexture("opacitySampler",this.opacityTexture),this._effect.setFloat2("vOpacityInfos",this.opacityTexture.coordinatesIndex,this.opacityTexture.level),this._effect.setMatrix("opacityMatrix",this.opacityTexture.getTextureMatrix())),this.reflectionTexture&&b.StandardMaterial.ReflectionTextureEnabled&&(this._microsurfaceTextureLods.x=Math.round(Math.log(this.reflectionTexture.getSize().width)*Math.LOG2E),this.reflectionTexture.isCube?
this._effect.setTexture("reflectionCubeSampler",this.reflectionTexture):this._effect.setTexture("reflection2DSampler",this.reflectionTexture),this._effect.setMatrix("reflectionMatrix",this.reflectionTexture.getReflectionTextureMatrix()),this._effect.setFloat2("vReflectionInfos",this.reflectionTexture.level,0),this._defines.USESPHERICALFROMREFLECTIONMAP&&(this._effect.setFloat3("vSphericalX",this.reflectionTexture.sphericalPolynomial.x.x,this.reflectionTexture.sphericalPolynomial.x.y,this.reflectionTexture.sphericalPolynomial.x.z),
this._effect.setFloat3("vSphericalY",this.reflectionTexture.sphericalPolynomial.y.x,this.reflectionTexture.sphericalPolynomial.y.y,this.reflectionTexture.sphericalPolynomial.y.z),this._effect.setFloat3("vSphericalZ",this.reflectionTexture.sphericalPolynomial.z.x,this.reflectionTexture.sphericalPolynomial.z.y,this.reflectionTexture.sphericalPolynomial.z.z),this._effect.setFloat3("vSphericalXX",this.reflectionTexture.sphericalPolynomial.xx.x,this.reflectionTexture.sphericalPolynomial.xx.y,this.reflectionTexture.sphericalPolynomial.xx.z),
this._effect.setFloat3("vSphericalYY",this.reflectionTexture.sphericalPolynomial.yy.x,this.reflectionTexture.sphericalPolynomial.yy.y,this.reflectionTexture.sphericalPolynomial.yy.z),this._effect.setFloat3("vSphericalZZ",this.reflectionTexture.sphericalPolynomial.zz.x,this.reflectionTexture.sphericalPolynomial.zz.y,this.reflectionTexture.sphericalPolynomial.zz.z),this._effect.setFloat3("vSphericalXY",this.reflectionTexture.sphericalPolynomial.xy.x,this.reflectionTexture.sphericalPolynomial.xy.y,this.reflectionTexture.sphericalPolynomial.xy.z),
this._effect.setFloat3("vSphericalYZ",this.reflectionTexture.sphericalPolynomial.yz.x,this.reflectionTexture.sphericalPolynomial.yz.y,this.reflectionTexture.sphericalPolynomial.yz.z),this._effect.setFloat3("vSphericalZX",this.reflectionTexture.sphericalPolynomial.zx.x,this.reflectionTexture.sphericalPolynomial.zx.y,this.reflectionTexture.sphericalPolynomial.zx.z))),this.emissiveTexture&&b.StandardMaterial.EmissiveTextureEnabled&&(this._effect.setTexture("emissiveSampler",this.emissiveTexture),this._effect.setFloat2("vEmissiveInfos",
this.emissiveTexture.coordinatesIndex,this.emissiveTexture.level),this._effect.setMatrix("emissiveMatrix",this.emissiveTexture.getTextureMatrix())),this.lightmapTexture&&b.StandardMaterial.LightmapTextureEnabled&&(this._effect.setTexture("lightmapSampler",this.lightmapTexture),this._effect.setFloat2("vLightmapInfos",this.lightmapTexture.coordinatesIndex,this.lightmapTexture.level),this._effect.setMatrix("lightmapMatrix",this.lightmapTexture.getTextureMatrix())),this.reflectivityTexture&&b.StandardMaterial.SpecularTextureEnabled&&
(this._effect.setTexture("reflectivitySampler",this.reflectivityTexture),this._effect.setFloat2("vReflectivityInfos",this.reflectivityTexture.coordinatesIndex,this.reflectivityTexture.level),this._effect.setMatrix("reflectivityMatrix",this.reflectivityTexture.getTextureMatrix())),this.bumpTexture&&this._myScene.getEngine().getCaps().standardDerivatives&&b.StandardMaterial.BumpTextureEnabled&&!this.disableBumpMap&&(this._effect.setTexture("bumpSampler",this.bumpTexture),this._effect.setFloat3("vBumpInfos",
this.bumpTexture.coordinatesIndex,1/this.bumpTexture.level,this.parallaxScaleBias),this._effect.setMatrix("bumpMatrix",this.bumpTexture.getTextureMatrix())),this.refractionTexture&&b.StandardMaterial.RefractionTextureEnabled){this._microsurfaceTextureLods.y=Math.round(Math.log(this.refractionTexture.getSize().width)*Math.LOG2E);var f=1;this.refractionTexture.isCube?this._effect.setTexture("refractionCubeSampler",this.refractionTexture):(this._effect.setTexture("refraction2DSampler",this.refractionTexture),
this._effect.setMatrix("refractionMatrix",this.refractionTexture.getReflectionTextureMatrix()),this.refractionTexture.depth&&(f=this.refractionTexture.depth));this._effect.setFloat4("vRefractionInfos",this.refractionTexture.level,this.indexOfRefraction,f,this.invertRefractionY?-1:1)}if((this.reflectionTexture||this.refractionTexture)&&this._effect.setFloat2("vMicrosurfaceTextureLods",this._microsurfaceTextureLods.x,this._microsurfaceTextureLods.y),this.cameraColorGradingTexture){this._effect.setTexture("cameraColorGrading2DSampler",
this.cameraColorGradingTexture);this._cameraColorGradingInfos.x=this.cameraColorGradingTexture.level;this._cameraColorGradingInfos.y=this.cameraColorGradingTexture.getSize().height;this._cameraColorGradingInfos.z=this._cameraColorGradingInfos.y-1;this._cameraColorGradingInfos.w=1/this._cameraColorGradingInfos.y;this._effect.setFloat4("vCameraColorGradingInfos",this._cameraColorGradingInfos.x,this._cameraColorGradingInfos.y,this._cameraColorGradingInfos.z,this._cameraColorGradingInfos.w);var f=this._cameraColorGradingInfos.w/
this._cameraColorGradingInfos.y,n=1/this._cameraColorGradingInfos.y;this._cameraColorGradingScaleOffset.x=this._cameraColorGradingInfos.z*f;this._cameraColorGradingScaleOffset.y=this._cameraColorGradingInfos.z/this._cameraColorGradingInfos.y;this._cameraColorGradingScaleOffset.z=0.5*f;this._cameraColorGradingScaleOffset.w=0.5*n;this._effect.setFloat4("vCameraColorGradingScaleOffset",this._cameraColorGradingScaleOffset.x,this._cameraColorGradingScaleOffset.y,this._cameraColorGradingScaleOffset.z,this._cameraColorGradingScaleOffset.w)}}b.MaterialHelper.BindClipPlane(this._effect,
this._myScene);this.pointsCloud&&this._effect.setFloat("pointSize",this.pointSize);this._myScene.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor);this.convertColorToLinearSpaceToRef(this.reflectivityColor,g._scaledReflectivity);this._effect.setVector3("vEyePosition",this._myScene._mirroredCameraPosition?this._myScene._mirroredCameraPosition:this._myScene.activeCamera.position);this._effect.setColor3("vAmbientColor",this._globalAmbientColor);this._effect.setColor4("vReflectivityColor",
g._scaledReflectivity,this.microSurface);this.convertColorToLinearSpaceToRef(this.emissiveColor,g._scaledEmissive);this._effect.setColor3("vEmissiveColor",g._scaledEmissive);this.convertColorToLinearSpaceToRef(this.reflectionColor,g._scaledReflection);this._effect.setColor3("vReflectionColor",g._scaledReflection)}this._myScene.getCachedMaterial()===this&&this.isFrozen||(this.convertColorToLinearSpaceToRef(this.albedoColor,g._scaledAlbedo),this._effect.setColor4("vAlbedoColor",g._scaledAlbedo,this.alpha*
e.visibility),this._myScene.lightsEnabled&&!this.disableLighting&&g.BindLights(this._myScene,e,this._effect,this._defines,this.useScalarInLinearSpace,this.maxSimultaneousLights,this.usePhysicalLightFalloff),(this._myScene.fogEnabled&&e.applyFog&&this._myScene.fogMode!==b.Scene.FOGMODE_NONE||this.reflectionTexture)&&this._effect.setMatrix("view",this._myScene.getViewMatrix()),b.MaterialHelper.BindFogParameters(this._myScene,e,this._effect),this._lightingInfos.x=this.directIntensity,this._lightingInfos.y=
this.emissiveIntensity,this._lightingInfos.z=this.environmentIntensity,this._lightingInfos.w=this.specularIntensity,this._effect.setVector4("vLightingIntensity",this._lightingInfos),this._overloadedShadowInfos.x=this.overloadedShadowIntensity,this._overloadedShadowInfos.y=this.overloadedShadeIntensity,this._effect.setVector4("vOverloadedShadowIntensity",this._overloadedShadowInfos),this._cameraInfos.x=this.cameraExposure,this._cameraInfos.y=this.cameraContrast,this._effect.setVector4("vCameraInfos",
this._cameraInfos),this.cameraColorCurves&&b.ColorCurves.Bind(this.cameraColorCurves,this._effect),this._overloadedIntensity.x=this.overloadedAmbientIntensity,this._overloadedIntensity.y=this.overloadedAlbedoIntensity,this._overloadedIntensity.z=this.overloadedReflectivityIntensity,this._overloadedIntensity.w=this.overloadedEmissiveIntensity,this._effect.setVector4("vOverloadedIntensity",this._overloadedIntensity),this.convertColorToLinearSpaceToRef(this.overloadedAmbient,this._tempColor),this._effect.setColor3("vOverloadedAmbient",
this._tempColor),this.convertColorToLinearSpaceToRef(this.overloadedAlbedo,this._tempColor),this._effect.setColor3("vOverloadedAlbedo",this._tempColor),this.convertColorToLinearSpaceToRef(this.overloadedReflectivity,this._tempColor),this._effect.setColor3("vOverloadedReflectivity",this._tempColor),this.convertColorToLinearSpaceToRef(this.overloadedEmissive,this._tempColor),this._effect.setColor3("vOverloadedEmissive",this._tempColor),this.convertColorToLinearSpaceToRef(this.overloadedReflection,this._tempColor),
this._effect.setColor3("vOverloadedReflection",this._tempColor),this._overloadedMicroSurface.x=this.overloadedMicroSurface,this._overloadedMicroSurface.y=this.overloadedMicroSurfaceIntensity,this._overloadedMicroSurface.z=this.overloadedReflectionIntensity,this._effect.setVector3("vOverloadedMicroSurface",this._overloadedMicroSurface),b.MaterialHelper.BindLogDepth(this._defines,this._effect,this._myScene));d.prototype.bind.call(this,c,e);this._myScene=null},g.prototype.getAnimatables=function(){var b=
[];return this.albedoTexture&&this.albedoTexture.animations&&0<this.albedoTexture.animations.length&&b.push(this.albedoTexture),this.ambientTexture&&this.ambientTexture.animations&&0<this.ambientTexture.animations.length&&b.push(this.ambientTexture),this.opacityTexture&&this.opacityTexture.animations&&0<this.opacityTexture.animations.length&&b.push(this.opacityTexture),this.reflectionTexture&&this.reflectionTexture.animations&&0<this.reflectionTexture.animations.length&&b.push(this.reflectionTexture),
this.emissiveTexture&&this.emissiveTexture.animations&&0<this.emissiveTexture.animations.length&&b.push(this.emissiveTexture),this.reflectivityTexture&&this.reflectivityTexture.animations&&0<this.reflectivityTexture.animations.length&&b.push(this.reflectivityTexture),this.bumpTexture&&this.bumpTexture.animations&&0<this.bumpTexture.animations.length&&b.push(this.bumpTexture),this.lightmapTexture&&this.lightmapTexture.animations&&0<this.lightmapTexture.animations.length&&b.push(this.lightmapTexture),
this.refractionTexture&&this.refractionTexture.animations&&0<this.refractionTexture.animations.length&&b.push(this.refractionTexture),this.cameraColorGradingTexture&&this.cameraColorGradingTexture.animations&&0<this.cameraColorGradingTexture.animations.length&&b.push(this.cameraColorGradingTexture),b},g.prototype.dispose=function(b,c){c&&(this.albedoTexture&&this.albedoTexture.dispose(),this.ambientTexture&&this.ambientTexture.dispose(),this.opacityTexture&&this.opacityTexture.dispose(),this.reflectionTexture&&
this.reflectionTexture.dispose(),this.emissiveTexture&&this.emissiveTexture.dispose(),this.reflectivityTexture&&this.reflectivityTexture.dispose(),this.bumpTexture&&this.bumpTexture.dispose(),this.lightmapTexture&&this.lightmapTexture.dispose(),this.refractionTexture&&this.refractionTexture.dispose(),this.cameraColorGradingTexture&&this.cameraColorGradingTexture.dispose());d.prototype.dispose.call(this,b,c)},g.prototype.clone=function(c){var d=this;return b.SerializationHelper.Clone(function(){return new g(c,
d.getScene())},this)},g.prototype.serialize=function(){var c=b.SerializationHelper.Serialize(this);return c.customType="BABYLON.PBRMaterial",c},g.Parse=function(c,d,e){return b.SerializationHelper.Parse(function(){return new g(c.name,d)},c,d,e)},g._scaledAlbedo=new b.Color3,g._scaledReflectivity=new b.Color3,g._scaledEmissive=new b.Color3,g._scaledReflection=new b.Color3,__decorate([b.serialize()],g.prototype,"directIntensity",void 0),__decorate([b.serialize()],g.prototype,"emissiveIntensity",void 0),
__decorate([b.serialize()],g.prototype,"environmentIntensity",void 0),__decorate([b.serialize()],g.prototype,"specularIntensity",void 0),__decorate([b.serialize()],g.prototype,"disableBumpMap",void 0),__decorate([b.serialize()],g.prototype,"overloadedShadowIntensity",void 0),__decorate([b.serialize()],g.prototype,"overloadedShadeIntensity",void 0),__decorate([b.serialize()],g.prototype,"cameraExposure",void 0),__decorate([b.serialize()],g.prototype,"cameraContrast",void 0),__decorate([b.serializeAsTexture()],
g.prototype,"cameraColorGradingTexture",void 0),__decorate([b.serializeAsColorCurves()],g.prototype,"cameraColorCurves",void 0),__decorate([b.serializeAsColor3()],g.prototype,"overloadedAmbient",void 0),__decorate([b.serialize()],g.prototype,"overloadedAmbientIntensity",void 0),__decorate([b.serializeAsColor3()],g.prototype,"overloadedAlbedo",void 0),__decorate([b.serialize()],g.prototype,"overloadedAlbedoIntensity",void 0),__decorate([b.serializeAsColor3()],g.prototype,"overloadedReflectivity",void 0),
__decorate([b.serialize()],g.prototype,"overloadedReflectivityIntensity",void 0),__decorate([b.serializeAsColor3()],g.prototype,"overloadedEmissive",void 0),__decorate([b.serialize()],g.prototype,"overloadedEmissiveIntensity",void 0),__decorate([b.serializeAsColor3()],g.prototype,"overloadedReflection",void 0),__decorate([b.serialize()],g.prototype,"overloadedReflectionIntensity",void 0),__decorate([b.serialize()],g.prototype,"overloadedMicroSurface",void 0),__decorate([b.serialize()],g.prototype,
"overloadedMicroSurfaceIntensity",void 0),__decorate([b.serializeAsTexture()],g.prototype,"albedoTexture",void 0),__decorate([b.serializeAsTexture()],g.prototype,"ambientTexture",void 0),__decorate([b.serializeAsTexture()],g.prototype,"opacityTexture",void 0),__decorate([b.serializeAsTexture()],g.prototype,"reflectionTexture",void 0),__decorate([b.serializeAsTexture()],g.prototype,"emissiveTexture",void 0),__decorate([b.serializeAsTexture()],g.prototype,"reflectivityTexture",void 0),__decorate([b.serializeAsTexture()],
g.prototype,"bumpTexture",void 0),__decorate([b.serializeAsTexture()],g.prototype,"lightmapTexture",void 0),__decorate([b.serializeAsTexture()],g.prototype,"refractionTexture",void 0),__decorate([b.serializeAsColor3("ambient")],g.prototype,"ambientColor",void 0),__decorate([b.serializeAsColor3("albedo")],g.prototype,"albedoColor",void 0),__decorate([b.serializeAsColor3("reflectivity")],g.prototype,"reflectivityColor",void 0),__decorate([b.serializeAsColor3("reflection")],g.prototype,"reflectionColor",
void 0),__decorate([b.serializeAsColor3("emissive")],g.prototype,"emissiveColor",void 0),__decorate([b.serialize()],g.prototype,"microSurface",void 0),__decorate([b.serialize()],g.prototype,"indexOfRefraction",void 0),__decorate([b.serialize()],g.prototype,"invertRefractionY",void 0),__decorate([b.serializeAsFresnelParameters()],g.prototype,"opacityFresnelParameters",void 0),__decorate([b.serializeAsFresnelParameters()],g.prototype,"emissiveFresnelParameters",void 0),__decorate([b.serialize()],g.prototype,
"linkRefractionWithTransparency",void 0),__decorate([b.serialize()],g.prototype,"linkEmissiveWithAlbedo",void 0),__decorate([b.serialize()],g.prototype,"useLightmapAsShadowmap",void 0),__decorate([b.serialize()],g.prototype,"useEmissiveAsIllumination",void 0),__decorate([b.serialize()],g.prototype,"useAlphaFromAlbedoTexture",void 0),__decorate([b.serialize()],g.prototype,"useSpecularOverAlpha",void 0),__decorate([b.serialize()],g.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),__decorate([b.serialize()],
g.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),__decorate([b.serialize()],g.prototype,"useScalarInLinearSpace",void 0),__decorate([b.serialize()],g.prototype,"usePhysicalLightFalloff",void 0),__decorate([b.serialize()],g.prototype,"useRadianceOverAlpha",void 0),__decorate([b.serialize()],g.prototype,"useParallax",void 0),__decorate([b.serialize()],g.prototype,"useParallaxOcclusion",void 0),__decorate([b.serialize()],g.prototype,"parallaxScaleBias",void 0),__decorate([b.serialize()],
g.prototype,"disableLighting",void 0),__decorate([b.serialize()],g.prototype,"maxSimultaneousLights",void 0),__decorate([b.serialize()],g.prototype,"invertNormalMapX",void 0),__decorate([b.serialize()],g.prototype,"invertNormalMapY",void 0),__decorate([b.serialize()],g.prototype,"useLogarithmicDepth",null),g);b.PBRMaterial=c}(BABYLON||(BABYLON={}));
!function(b){var f;f=function(e){var c=this;this._transformationMatrix=b.Matrix.Identity();this._labelsEnabled=this._enabled=!1;this._displayStatistics=!0;this._displayLogs=this._displayTree=!1;this._skeletonViewers=[];this._identityMatrix=b.Matrix.Identity();this.axisRatio=0.02;this.accentColor="orange";this._scene=e;this._syncPositions=function(){var b=c._scene.getEngine(),e=b.getRenderingCanvasClientRect();c._showUI&&(c._statsDiv.style.left=e.width-410+"px",c._statsDiv.style.top=e.height-290+"px",
c._statsDiv.style.width="400px",c._statsDiv.style.height="auto",c._statsSubsetDiv.style.maxHeight="240px",c._optionsDiv.style.left="0px",c._optionsDiv.style.top="10px",c._optionsDiv.style.width="200px",c._optionsDiv.style.height="auto",c._optionsSubsetDiv.style.maxHeight=e.height-225+"px",c._logDiv.style.left="0px",c._logDiv.style.top=e.height-170+"px",c._logDiv.style.width="600px",c._logDiv.style.height="160px",c._treeDiv.style.left=e.width-310+"px",c._treeDiv.style.top="10px",c._treeDiv.style.width=
"300px",c._treeDiv.style.height="auto",c._treeSubsetDiv.style.maxHeight=e.height-340+"px");c._globalDiv.style.left=e.left+"px";c._globalDiv.style.top=e.top+"px";c._drawingCanvas.style.left="0px";c._drawingCanvas.style.top="0px";c._drawingCanvas.style.width=b.getRenderWidth()+"px";c._drawingCanvas.style.height=b.getRenderHeight()+"px";e=c._drawingContext;c._ratio=(window.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||
e.backingStorePixelRatio||1);c._drawingCanvas.width=b.getRenderWidth()*c._ratio;c._drawingCanvas.height=b.getRenderHeight()*c._ratio};this._onCanvasClick=function(b){c._clickPosition={x:b.clientX*c._ratio,y:b.clientY*c._ratio}};this._syncUI=function(){c._showUI&&(c._displayStatistics?(c._displayStats(),c._statsDiv.style.display=""):c._statsDiv.style.display="none",c._displayLogs?c._logDiv.style.display="":c._logDiv.style.display="none",c._displayTree?(c._treeDiv.style.display="",c._needToRefreshMeshesTree&&
(c._needToRefreshMeshesTree=!1,c._refreshMeshesTreeContent())):c._treeDiv.style.display="none")};this._syncData=function(){if(c._labelsEnabled||!c._showUI){c._camera.getViewMatrix().multiplyToRef(c._camera.getProjectionMatrix(),c._transformationMatrix);c._drawingContext.clearRect(0,0,c._drawingCanvas.width,c._drawingCanvas.height);var d,e,f=c._scene.getEngine(),j=c._camera.viewport.toGlobal(f.getRenderWidth(),f.getRenderHeight()),l=c._camera.getActiveMeshes();for(d=0;d<l.length;d++){var n=l.data[d];
e=n.getBoundingInfo().boundingSphere.center;e=b.Vector3.Project(e,n.getWorldMatrix(),c._transformationMatrix,j);(n.renderOverlay||c.shouldDisplayAxis&&c.shouldDisplayAxis(n))&&c._renderAxis(e,n,j);c.shouldDisplayLabel&&!c.shouldDisplayLabel(n)||c._renderLabel(n.name,e,12,function(){n.renderOverlay=!n.renderOverlay},function(){return n.renderOverlay?"red":"black"})}l=c._scene.cameras;for(d=0;d<l.length;d++){var q=l[d];q!==c._camera&&(e=b.Vector3.Project(b.Vector3.Zero(),q.getWorldMatrix(),c._transformationMatrix,
j),c.shouldDisplayLabel&&!c.shouldDisplayLabel(q)||c._renderLabel(q.name,e,12,function(){c._camera.detachControl(f.getRenderingCanvas());c._camera=q;c._camera.attachControl(f.getRenderingCanvas())},function(){return"purple"}))}l=c._scene.lights;for(d=0;d<l.length;d++){var p=l[d];p.position&&(e=b.Vector3.Project(p.getAbsolutePosition(),c._identityMatrix,c._transformationMatrix,j),c.shouldDisplayLabel&&!c.shouldDisplayLabel(p)||c._renderLabel(p.name,e,-20,function(){p.setEnabled(!p.isEnabled())},function(){return p.isEnabled()?
"orange":"gray"}))}}c._clickPosition=void 0}};f=(f.prototype._refreshMeshesTreeContent=function(){for(;this._treeSubsetDiv.hasChildNodes();)this._treeSubsetDiv.removeChild(this._treeSubsetDiv.lastChild);var b=this._scene.meshes.slice(0,this._scene.meshes.length);b.sort(function(b,c){return b.name===c.name?0:b.name>c.name?1:-1});for(var c=0;c<b.length;c++){var d=b[c];d.isEnabled()&&this._generateAdvancedCheckBox(this._treeSubsetDiv,d.name,d.getTotalVertices()+" verts",d.isVisible,function(b,c){c.isVisible=
b.checked},d)}},f.prototype._renderSingleAxis=function(b,c,d,f,m){this._drawingContext.beginPath();this._drawingContext.moveTo(b.x,b.y);this._drawingContext.lineTo(c.x,c.y);this._drawingContext.strokeStyle=m;this._drawingContext.lineWidth=4;this._drawingContext.stroke();this._drawingContext.font="normal 14px Segoe UI";this._drawingContext.fillStyle=m;this._drawingContext.fillText(f,d.x,d.y)},f.prototype._renderAxis=function(e,c,d){var f=c.getBoundingInfo().boundingSphere.center;c=c.getWorldMatrix();
var m=b.Vector3.UnprojectFromTransform(e.add(new b.Vector3(this._drawingCanvas.width*this.axisRatio,0,0)),d.width,d.height,c,this._transformationMatrix).subtract(f).length(),j=b.Vector3.Project(f.add(new b.Vector3(m,0,0)),c,this._transformationMatrix,d),l=b.Vector3.Project(f.add(new b.Vector3(1.5*m,0,0)),c,this._transformationMatrix,d);this._renderSingleAxis(e,j,l,"x","#FF0000");j=b.Vector3.Project(f.add(new b.Vector3(0,m,0)),c,this._transformationMatrix,d);l=b.Vector3.Project(f.add(new b.Vector3(0,
1.5*m,0)),c,this._transformationMatrix,d);this._renderSingleAxis(e,j,l,"y","#00FF00");j=b.Vector3.Project(f.add(new b.Vector3(0,0,m)),c,this._transformationMatrix,d);d=b.Vector3.Project(f.add(new b.Vector3(0,0,1.5*m)),c,this._transformationMatrix,d);this._renderSingleAxis(e,j,d,"z","#0000FF")},f.prototype._renderLabel=function(b,c,d,f,m){if(0<c.z&&1>c.z){this._drawingContext.font="normal 12px Segoe UI";var j=this._drawingContext.measureText(b),l=c.x-j.width/2,n=c.y,q=this._drawingCanvas.getBoundingClientRect();
this._showUI&&this._isClickInsideRect(q.left*this._ratio+l-5,q.top*this._ratio+n-d-12,j.width+10,17)&&f();this._drawingContext.beginPath();this._drawingContext.rect(l-5,n-d-12,j.width+10,17);this._drawingContext.fillStyle=m();this._drawingContext.globalAlpha=0.5;this._drawingContext.fill();this._drawingContext.globalAlpha=1;this._drawingContext.strokeStyle="#FFFFFF";this._drawingContext.lineWidth=1;this._drawingContext.stroke();this._drawingContext.fillStyle="#FFFFFF";this._drawingContext.fillText(b,
l,n-d);this._drawingContext.beginPath();this._drawingContext.arc(c.x,n,5,0,2*Math.PI,!1);this._drawingContext.fill()}},f.prototype._isClickInsideRect=function(b,c,d,f){return this._clickPosition?this._clickPosition.x<b||this._clickPosition.x>b+d?!1:!(this._clickPosition.y<c||this._clickPosition.y>c+f):!1},f.prototype.isVisible=function(){return this._enabled},f.prototype.hide=function(){if(this._enabled){this._enabled=!1;var e=this._scene.getEngine();this._scene.unregisterBeforeRender(this._syncData);
this._scene.unregisterAfterRender(this._syncUI);this._rootElement.removeChild(this._globalDiv);this._scene.forceShowBoundingBoxes=!1;this._scene.forceWireframe=!1;b.StandardMaterial.DiffuseTextureEnabled=!0;b.StandardMaterial.AmbientTextureEnabled=!0;b.StandardMaterial.SpecularTextureEnabled=!0;b.StandardMaterial.EmissiveTextureEnabled=!0;b.StandardMaterial.BumpTextureEnabled=!0;b.StandardMaterial.OpacityTextureEnabled=!0;b.StandardMaterial.ReflectionTextureEnabled=!0;b.StandardMaterial.LightmapTextureEnabled=
!0;b.StandardMaterial.RefractionTextureEnabled=!0;this._scene.shadowsEnabled=!0;this._scene.particlesEnabled=!0;this._scene.postProcessesEnabled=!0;this._scene.collisionsEnabled=!0;this._scene.lightsEnabled=!0;this._scene.texturesEnabled=!0;this._scene.lensFlaresEnabled=!0;this._scene.proceduralTexturesEnabled=!0;this._scene.renderTargetsEnabled=!0;this._scene.probesEnabled=!0;e.getRenderingCanvas().removeEventListener("click",this._onCanvasClick);this._clearSkeletonViewers()}},f.prototype._clearSkeletonViewers=
function(){for(var b=0;b<this._skeletonViewers.length;b++)this._skeletonViewers[b].dispose();this._skeletonViewers=[]},f.prototype.show=function(b,c,d){if(void 0===b&&(b=!0),void 0===c&&(c=null),void 0===d&&(d=null),!this._enabled)this._enabled=!0,c?this._camera=c:this._camera=this._scene.activeCamera,this._showUI=b,b=this._scene.getEngine(),this._globalDiv=document.createElement("div"),this._rootElement=d||document.body,this._rootElement.appendChild(this._globalDiv),this._generateDOMelements(),b.getRenderingCanvas().addEventListener("click",
this._onCanvasClick),this._syncPositions(),this._scene.registerBeforeRender(this._syncData),this._scene.registerAfterRender(this._syncUI)},f.prototype._clearLabels=function(){this._drawingContext.clearRect(0,0,this._drawingCanvas.width,this._drawingCanvas.height);for(var b=0;b<this._scene.meshes.length;b++)this._scene.meshes[b].renderOverlay=!1},f.prototype._generateheader=function(b,c){var d=document.createElement("div");d.innerHTML=c+"&nbsp;";d.style.textAlign="right";d.style.width="100%";d.style.color=
"white";d.style.backgroundColor="Black";d.style.padding="5px 5px 4px 0px";d.style.marginLeft="-5px";d.style.fontWeight="bold";b.appendChild(d)},f.prototype._generateTexBox=function(b,c,d){var f=document.createElement("label");f.style.display="inline";f.innerHTML=c;f.style.color=d;b.appendChild(f);b.appendChild(document.createElement("br"))},f.prototype._generateAdvancedCheckBox=function(b,c,d,f,m,j){void 0===j&&(j=null);var l=document.createElement("label");l.style.display="inline";var n=document.createElement("input");
n.type="checkbox";n.checked=f;n.style.display="inline";n.style.margin="0px 5px 0px 0px";n.style.verticalAlign="sub";n.addEventListener("change",function(b){m(b.target,j)});l.appendChild(n);f=document.createElement("span");var n=document.createElement("span"),q=document.createElement("span");q.style.cssFloat="right";n.innerHTML=c;q.innerHTML=d;q.style.fontSize="12px";q.style.maxWidth="200px";f.appendChild(n);f.appendChild(q);l.appendChild(f);b.appendChild(l);b.appendChild(document.createElement("br"))},
f.prototype._generateCheckBox=function(b,c,d,f,m){void 0===m&&(m=null);var j=document.createElement("label");j.style.display="inline";var l=document.createElement("input");l.type="checkbox";l.checked=d;l.style.display="inline";l.style.margin="0px 5px 0px 0px";l.style.verticalAlign="sub";l.addEventListener("change",function(b){f(b.target,m)});j.appendChild(l);j.appendChild(document.createTextNode(c));b.appendChild(j);b.appendChild(document.createElement("br"))},f.prototype._generateButton=function(b,
c,d,f){void 0===f&&(f=null);var m=document.createElement("button");m.innerHTML=c;m.style.height="24px";m.style.width="150px";m.style.marginBottom="5px";m.style.color="#444444";m.style.border="1px solid white";m.className="debugLayerButton";m.addEventListener("click",function(b){d(b.target,f)});b.appendChild(m);b.appendChild(document.createElement("br"))},f.prototype._generateRadio=function(b,c,d,f,m,j){void 0===j&&(j=null);var l=document.createElement("label");l.style.display="inline";var n=document.createElement("input");
n.type="radio";n.name=d;n.checked=f;n.style.display="inline";n.style.margin="0px 5px 0px 0px";n.style.verticalAlign="sub";n.addEventListener("change",function(b){m(b.target,j)});l.appendChild(n);l.appendChild(document.createTextNode(c));b.appendChild(l);b.appendChild(document.createElement("br"))},f.prototype._generateDOMelements=function(){var e=this;if(this._globalDiv.id="DebugLayer",this._globalDiv.style.position="absolute",this._globalDiv.style.fontFamily="Segoe UI, Arial",this._globalDiv.style.fontSize=
"14px",this._globalDiv.style.color="white",this._drawingCanvas=document.createElement("canvas"),this._drawingCanvas.id="DebugLayerDrawingCanvas",this._drawingCanvas.style.position="absolute",this._drawingCanvas.style.pointerEvents="none",this._drawingCanvas.style.backgroundColor="transparent",this._drawingContext=this._drawingCanvas.getContext("2d"),this._globalDiv.appendChild(this._drawingCanvas),this._showUI)this._statsDiv=document.createElement("div"),this._statsDiv.id="DebugLayerStats",this._statsDiv.style.border=
"rgb(180, 180, 180) solid 1px",this._statsDiv.style.position="absolute",this._statsDiv.style.background="rgba(128, 128, 128, 0.4)",this._statsDiv.style.padding="0px 0px 0px 5px",this._generateheader(this._statsDiv,"STATISTICS"),this._statsSubsetDiv=document.createElement("div"),this._statsSubsetDiv.style.paddingTop="5px",this._statsSubsetDiv.style.paddingBottom="5px",this._statsSubsetDiv.style.overflowY="auto",this._statsDiv.appendChild(this._statsSubsetDiv),this._treeDiv=document.createElement("div"),
this._treeDiv.id="DebugLayerTree",this._treeDiv.style.border="rgb(180, 180, 180) solid 1px",this._treeDiv.style.position="absolute",this._treeDiv.style.background="rgba(128, 128, 128, 0.4)",this._treeDiv.style.padding="0px 0px 0px 5px",this._treeDiv.style.display="none",this._generateheader(this._treeDiv,"MESHES TREE"),this._treeSubsetDiv=document.createElement("div"),this._treeSubsetDiv.style.paddingTop="5px",this._treeSubsetDiv.style.paddingRight="5px",this._treeSubsetDiv.style.overflowY="auto",
this._treeSubsetDiv.style.maxHeight="300px",this._treeDiv.appendChild(this._treeSubsetDiv),this._needToRefreshMeshesTree=!0,this._logDiv=document.createElement("div"),this._logDiv.style.border="rgb(180, 180, 180) solid 1px",this._logDiv.id="DebugLayerLogs",this._logDiv.style.position="absolute",this._logDiv.style.background="rgba(128, 128, 128, 0.4)",this._logDiv.style.padding="0px 0px 0px 5px",this._logDiv.style.display="none",this._generateheader(this._logDiv,"LOGS"),this._logSubsetDiv=document.createElement("div"),
this._logSubsetDiv.style.height="127px",this._logSubsetDiv.style.paddingTop="5px",this._logSubsetDiv.style.overflowY="auto",this._logSubsetDiv.style.fontSize="12px",this._logSubsetDiv.style.fontFamily="consolas",this._logSubsetDiv.innerHTML=b.Tools.LogCache,this._logDiv.appendChild(this._logSubsetDiv),b.Tools.OnNewCacheEntry=function(b){e._logSubsetDiv.innerHTML=b+e._logSubsetDiv.innerHTML},this._optionsDiv=document.createElement("div"),this._optionsDiv.id="DebugLayerOptions",this._optionsDiv.style.border=
"rgb(180, 180, 180) solid 1px",this._optionsDiv.style.position="absolute",this._optionsDiv.style.background="rgba(128, 128, 128, 0.4)",this._optionsDiv.style.padding="0px 0px 0px 5px",this._optionsDiv.style.overflowY="auto",this._generateheader(this._optionsDiv,"OPTIONS"),this._optionsSubsetDiv=document.createElement("div"),this._optionsSubsetDiv.style.paddingTop="5px",this._optionsSubsetDiv.style.paddingBottom="5px",this._optionsSubsetDiv.style.overflowY="auto",this._optionsSubsetDiv.style.maxHeight=
"200px",this._optionsDiv.appendChild(this._optionsSubsetDiv),this._generateTexBox(this._optionsSubsetDiv,"<b>Windows:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Statistics",this._displayStatistics,function(b){e._displayStatistics=b.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Logs",this._displayLogs,function(b){e._displayLogs=b.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Meshes tree",this._displayTree,function(b){e._displayTree=b.checked;e._needToRefreshMeshesTree=
!0}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>General:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Bounding boxes",this._scene.forceShowBoundingBoxes,function(b){e._scene.forceShowBoundingBoxes=b.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Clickable labels",this._labelsEnabled,function(b){e._labelsEnabled=b.checked;e._labelsEnabled||e._clearLabels()}),this._generateCheckBox(this._optionsSubsetDiv,
"Generate user marks (F12)",b.Tools.PerformanceLogLevel===b.Tools.PerformanceUserMarkLogLevel,function(c){c.checked?b.Tools.PerformanceLogLevel=b.Tools.PerformanceUserMarkLogLevel:b.Tools.PerformanceLogLevel=b.Tools.PerformanceNoneLogLevel}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Rendering mode:</b>",this.accentColor),this._generateRadio(this._optionsSubsetDiv,"Solid","renderMode",!this._scene.forceWireframe&&!this._scene.forcePointsCloud,
function(b){b.checked&&(e._scene.forceWireframe=!1,e._scene.forcePointsCloud=!1)}),this._generateRadio(this._optionsSubsetDiv,"Wireframe","renderMode",this._scene.forceWireframe,function(b){b.checked&&(e._scene.forceWireframe=!0,e._scene.forcePointsCloud=!1)}),this._generateRadio(this._optionsSubsetDiv,"Point","renderMode",this._scene.forcePointsCloud,function(b){b.checked&&(e._scene.forceWireframe=!1,e._scene.forcePointsCloud=!0)}),this._optionsSubsetDiv.appendChild(document.createElement("br")),
this._generateTexBox(this._optionsSubsetDiv,"<b>Texture channels:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Diffuse",b.StandardMaterial.DiffuseTextureEnabled,function(c){b.StandardMaterial.DiffuseTextureEnabled=c.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Ambient",b.StandardMaterial.AmbientTextureEnabled,function(c){b.StandardMaterial.AmbientTextureEnabled=c.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Specular",b.StandardMaterial.SpecularTextureEnabled,
function(c){b.StandardMaterial.SpecularTextureEnabled=c.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Emissive",b.StandardMaterial.EmissiveTextureEnabled,function(c){b.StandardMaterial.EmissiveTextureEnabled=c.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Bump",b.StandardMaterial.BumpTextureEnabled,function(c){b.StandardMaterial.BumpTextureEnabled=c.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Opacity",b.StandardMaterial.OpacityTextureEnabled,function(c){b.StandardMaterial.OpacityTextureEnabled=
c.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Reflection",b.StandardMaterial.ReflectionTextureEnabled,function(c){b.StandardMaterial.ReflectionTextureEnabled=c.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Refraction",b.StandardMaterial.RefractionTextureEnabled,function(c){b.StandardMaterial.RefractionTextureEnabled=c.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Lightmap",b.StandardMaterial.LightmapTextureEnabled,function(c){b.StandardMaterial.LightmapTextureEnabled=
c.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Fresnel",b.StandardMaterial.FresnelEnabled,function(c){b.StandardMaterial.FresnelEnabled=c.checked}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Options:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Animations",this._scene.animationsEnabled,function(b){e._scene.animationsEnabled=b.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Collisions",
this._scene.collisionsEnabled,function(b){e._scene.collisionsEnabled=b.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Fog",this._scene.fogEnabled,function(b){e._scene.fogEnabled=b.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Lens flares",this._scene.lensFlaresEnabled,function(b){e._scene.lensFlaresEnabled=b.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Lights",this._scene.lightsEnabled,function(b){e._scene.lightsEnabled=b.checked}),this._generateCheckBox(this._optionsSubsetDiv,
"Particles",this._scene.particlesEnabled,function(b){e._scene.particlesEnabled=b.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Post-processes",this._scene.postProcessesEnabled,function(b){e._scene.postProcessesEnabled=b.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Probes",this._scene.probesEnabled,function(b){e._scene.probesEnabled=b.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Procedural textures",this._scene.proceduralTexturesEnabled,function(b){e._scene.proceduralTexturesEnabled=
b.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Render targets",this._scene.renderTargetsEnabled,function(b){e._scene.renderTargetsEnabled=b.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Shadows",this._scene.shadowsEnabled,function(b){e._scene.shadowsEnabled=b.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Skeletons",this._scene.skeletonsEnabled,function(b){e._scene.skeletonsEnabled=b.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Sprites",this._scene.spritesEnabled,
function(b){e._scene.spritesEnabled=b.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Textures",this._scene.texturesEnabled,function(b){e._scene.texturesEnabled=b.checked}),b.AudioEngine&&b.Engine.audioEngine.canUseWebAudio&&(this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Audio:</b>",this.accentColor),this._generateRadio(this._optionsSubsetDiv,"Headphones","panningModel",this._scene.headphone,function(b){b.checked&&(e._scene.headphone=
!0)}),this._generateRadio(this._optionsSubsetDiv,"Normal Speakers","panningModel",!this._scene.headphone,function(b){b.checked&&(e._scene.headphone=!1)}),this._generateCheckBox(this._optionsSubsetDiv,"Disable audio",!this._scene.audioEnabled,function(b){e._scene.audioEnabled=!b.checked})),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Viewers:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Skeletons",!1,function(c){if(!c.checked)return void e._clearSkeletonViewers();
for(c=0;c<e._scene.meshes.length;c++){var d=e._scene.meshes[c];if(d.skeleton){for(var f=!1,m=0;m<e._skeletonViewers.length;m++)if(e._skeletonViewers[m].skeleton===d.skeleton){f=!0;break}f||(d=new b.Debug.SkeletonViewer(d.skeleton,d,e._scene),d.isEnabled=!0,e._skeletonViewers.push(d))}}}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Tools:</b>",this.accentColor),this._generateButton(this._optionsSubsetDiv,"Dump rendertargets",function(){e._scene.dumpNextRenderTargets=
!0}),this._generateButton(this._optionsSubsetDiv,"Run SceneOptimizer",function(){b.SceneOptimizer.OptimizeAsync(e._scene)}),this._generateButton(this._optionsSubsetDiv,"Log camera object",function(){e._camera?console.log(e._camera):console.warn("No camera defined, or debug layer created before camera creation!")}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._globalDiv.appendChild(this._statsDiv),this._globalDiv.appendChild(this._logDiv),this._globalDiv.appendChild(this._optionsDiv),
this._globalDiv.appendChild(this._treeDiv)},f.prototype._displayStats=function(){var e=this._scene,c=e.getEngine(),d=c.getGlInfo();this._statsSubsetDiv.innerHTML="Babylon.js v"+b.Engine.Version+" - <b>"+b.Tools.Format(c.getFps(),0)+" fps</b><br><br><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Count</b><br>Total meshes: "+e.meshes.length+"<br>Total lights: "+e.lights.length+"<br>Total vertices: "+e.getTotalVertices()+"<br>Total materials: "+e.materials.length+"<br>Total textures: "+
e.textures.length+"<br>Active meshes: "+e.getActiveMeshes().length+"<br>Active indices: "+e.getActiveIndices()+"<br>Active bones: "+e.getActiveBones()+"<br>Active particles: "+e.getActiveParticles()+"<br><b>Draw calls: "+c.drawCalls+"</b><br><br><b>Duration</b><br>Meshes selection:</i> "+b.Tools.Format(e.getEvaluateActiveMeshesDuration())+" ms<br>Render Targets: "+b.Tools.Format(e.getRenderTargetsDuration())+" ms<br>Particles: "+b.Tools.Format(e.getParticlesDuration())+" ms<br>Sprites: "+b.Tools.Format(e.getSpritesDuration())+
" ms<br><br>Render: <b>"+b.Tools.Format(e.getRenderDuration())+" ms</b><br>Frame: "+b.Tools.Format(e.getLastFrameDuration())+" ms<br>Potential FPS: "+b.Tools.Format(1E3/e.getLastFrameDuration(),0)+"<br>Resolution: "+c.getRenderWidth()+"x"+c.getRenderHeight()+"<br><br></div><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Extensions</b><br>Std derivatives: "+(c.getCaps().standardDerivatives?"Yes":"No")+"<br>Compressed textures: "+(c.getCaps().s3tc?"Yes":"No")+"<br>Hardware instances: "+
(c.getCaps().instancedArrays?"Yes":"No")+"<br>Texture float: "+(c.getCaps().textureFloat?"Yes":"No")+"<br><br>32bits indices: "+(c.getCaps().uintIndices?"Yes":"No")+"<br>Fragment depth: "+(c.getCaps().fragmentDepthSupported?"Yes":"No")+"<br>High precision shaders: "+(c.getCaps().highPrecisionShaderSupported?"Yes":"No")+"<br>Draw buffers: "+(c.getCaps().drawBuffersExtension?"Yes":"No")+"<br></div><br><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Caps.</b><br>Max textures units: "+
c.getCaps().maxTexturesImageUnits+"<br>Max textures size: "+c.getCaps().maxTextureSize+"<br>Max anisotropy: "+c.getCaps().maxAnisotropy+"<br><b>Info</b><br>WebGL feature level: "+c.webGLVersion+"<br>"+d.version+"<br></div><br>"+d.renderer+"<br>";this.customStatsFunction&&(this._statsSubsetDiv.innerHTML+=this.customStatsFunction())},f);b.DebugLayer=f}(BABYLON||(BABYLON={}));
BABYLON.Effect.ShadersStore={anaglyphPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D leftSampler;\nvoid main(void)\n{\nvec4 leftFrag=texture2D(leftSampler,vUV);\nleftFrag=vec4(1.0,leftFrag.g,leftFrag.b,1.0);\nvec4 rightFrag=texture2D(textureSampler,vUV);\nrightFrag=vec4(rightFrag.r,1.0,1.0,1.0);\ngl_FragColor=vec4(rightFrag.rgb*leftFrag.rgb,1.0);\n}",blackAndWhitePixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nvoid main(void) \n{\nfloat luminance=dot(texture2D(textureSampler,vUV).rgb,vec3(0.3,0.59,0.11));\ngl_FragColor=vec4(luminance,luminance,luminance,1.0);\n}",
blurPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nuniform vec2 direction;\nuniform float blurWidth;\nvoid main(void)\n{\nfloat weights[7];\nweights[0]=0.05;\nweights[1]=0.1;\nweights[2]=0.2;\nweights[3]=0.3;\nweights[4]=0.2;\nweights[5]=0.1;\nweights[6]=0.05;\nvec2 texelSize=vec2(1.0/screenSize.x,1.0/screenSize.y);\nvec2 texelStep=texelSize*direction*blurWidth;\nvec2 start=vUV-3.0*texelStep;\nvec4 baseColor=vec4(0.,0.,0.,0.);\nvec2 texelOffset=vec2(0.,0.);\nfor (int i=0; i<7; i++)\n{\nbaseColor+=texture2D(textureSampler,start+texelOffset)*weights[i];\ntexelOffset+=texelStep;\n}\ngl_FragColor=baseColor;\n}",
chromaticAberrationPixelShader:"\nuniform sampler2D textureSampler; \n\nuniform float chromatic_aberration;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\nvoid main(void)\n{\nvec2 centered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);\nfloat radius2=centered_screen_pos.x*centered_screen_pos.x\n+centered_screen_pos.y*centered_screen_pos.y;\nfloat radius=sqrt(radius2);\nvec4 original=texture2D(textureSampler,vUV);\nif (chromatic_aberration>0.0) {\n\nvec3 ref_indices=vec3(-0.3,0.0,0.3);\nfloat ref_shiftX=chromatic_aberration*radius*17.0/screen_width;\nfloat ref_shiftY=chromatic_aberration*radius*17.0/screen_height;\n\nvec2 ref_coords_r=vec2(vUV.x+ref_indices.r*ref_shiftX,vUV.y+ref_indices.r*ref_shiftY*0.5);\nvec2 ref_coords_g=vec2(vUV.x+ref_indices.g*ref_shiftX,vUV.y+ref_indices.g*ref_shiftY*0.5);\nvec2 ref_coords_b=vec2(vUV.x+ref_indices.b*ref_shiftX,vUV.y+ref_indices.b*ref_shiftY*0.5);\noriginal.r=texture2D(textureSampler,ref_coords_r).r;\noriginal.g=texture2D(textureSampler,ref_coords_g).g;\noriginal.b=texture2D(textureSampler,ref_coords_b).b;\n}\ngl_FragColor=original;\n}",
colorPixelShader:"uniform vec4 color;\nvoid main(void) {\ngl_FragColor=color;\n}",colorVertexShader:"\nattribute vec3 position;\n\nuniform mat4 worldViewProjection;\nvoid main(void) {\ngl_Position=worldViewProjection*vec4(position,1.0);\n}",colorCorrectionPixelShader:"\nuniform sampler2D textureSampler; \nuniform sampler2D colorTable; \n\nvarying vec2 vUV;\n\nconst float SLICE_COUNT=16.0; \n\nvec4 sampleAs3DTexture(sampler2D texture,vec3 uv,float width) {\nfloat sliceSize=1.0/width; \nfloat slicePixelSize=sliceSize/width; \nfloat sliceInnerSize=slicePixelSize*(width-1.0); \nfloat zSlice0=min(floor(uv.z*width),width-1.0);\nfloat zSlice1=min(zSlice0+1.0,width-1.0);\nfloat xOffset=slicePixelSize*0.5+uv.x*sliceInnerSize;\nfloat s0=xOffset+(zSlice0*sliceSize);\nfloat s1=xOffset+(zSlice1*sliceSize);\nvec4 slice0Color=texture2D(texture,vec2(s0,uv.y));\nvec4 slice1Color=texture2D(texture,vec2(s1,uv.y));\nfloat zOffset=mod(uv.z*width,1.0);\nvec4 result=mix(slice0Color,slice1Color,zOffset);\nreturn result;\n}\nvoid main(void)\n{\nvec4 screen_color=texture2D(textureSampler,vUV);\ngl_FragColor=sampleAs3DTexture(colorTable,screen_color.rgb,SLICE_COUNT);\n}",
convolutionPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 screenSize;\nuniform float kernel[9];\nvoid main(void)\n{\nvec2 onePixel=vec2(1.0,1.0)/screenSize;\nvec4 colorSum =\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,-1))*kernel[0] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,-1))*kernel[1] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,-1))*kernel[2] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,0))*kernel[3] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,0))*kernel[4] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,0))*kernel[5] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,1))*kernel[6] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,1))*kernel[7] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,1))*kernel[8];\nfloat kernelWeight =\nkernel[0] +\nkernel[1] +\nkernel[2] +\nkernel[3] +\nkernel[4] +\nkernel[5] +\nkernel[6] +\nkernel[7] +\nkernel[8];\nif (kernelWeight<=0.0) {\nkernelWeight=1.0;\n}\ngl_FragColor=vec4((colorSum/kernelWeight).rgb,1);\n}",
defaultPixelShader:"#ifdef BUMP\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n\n#define RECIPROCAL_PI2 0.15915494\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<lightFragmentDeclaration>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform sampler2D lightmapSampler;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\nuniform mat4 refractionMatrix;\n#endif\n#ifdef REFRACTIONFRESNEL\nuniform vec4 refractionLeftColor;\nuniform vec4 refractionRightColor;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform sampler2D specularSampler;\n#endif\n\n#include<fresnelFunction>\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION)\nuniform mat4 reflectionMatrix;\n#endif\n#endif\n#include<reflectionFunction>\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#endif\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#ifdef DIFFUSE\nvec2 diffuseUV=vDiffuseUV;\n#endif\n#include<bumpFragment>\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,diffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV).rgb*vAmbientInfos.y;\n#endif\n\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV);\nspecularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;\n#include<lightFragment>[0..maxSimultaneousLights]\n\nvec3 refractionColor=vec3(0.,0.,0.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0)\n{\nrefractionColor=textureCube(refractionCubeSampler,refractionVector).rgb*vRefractionInfos.x;\n}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\nrefractionColor=texture2D(refraction2DSampler,refractionCoords).rgb*vRefractionInfos.x;\n#endif\n#endif\n\nvec3 reflectionColor=vec3(0.,0.,0.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias).rgb*vReflectionInfos.x;\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb*vReflectionInfos.x;\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords).rgb*vReflectionInfos.x;\n#endif\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);\nrefractionColor*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+emissiveColor+refractionColor,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+refractionColor,alpha);\n#endif\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV).rgb*vLightmapInfos.y;\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor;\n#else\ncolor.rgb+=lightmapColor;\n#endif\n#endif\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n}",
defaultVertexShader:"\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#include<pointCloudVertexDeclaration>\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<shadowsVertexDeclaration>[0..maxSimultaneousLights]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=position;\n#endif \n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvDirectionW=normalize(vec3(finalWorld*vec4(position,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef AMBIENT\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef OPACITY\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef EMISSIVE\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef LIGHTMAP\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nif (vSpecularInfos.x == 0.)\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef BUMP\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#include<pointCloudVertex>\n#include<logDepthVertex>\n}",
depthPixelShader:"#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nuniform float far;\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\nfloat depth=(gl_FragCoord.z/gl_FragCoord.w)/far;\ngl_FragColor=vec4(depth,depth*depth,0.0,1.0);\n}",depthVertexShader:"\nattribute vec3 position;\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}",
depthBoxBlurPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nvoid main(void)\n{\nvec4 colorDepth=vec4(0.0);\nfor (int x=-OFFSET; x<=OFFSET; x++)\nfor (int y=-OFFSET; y<=OFFSET; y++)\ncolorDepth+=texture2D(textureSampler,vUV+vec2(x,y)/screenSize);\ngl_FragColor=(colorDepth/float((OFFSET*2+1)*(OFFSET*2+1)));\n}",depthOfFieldPixelShader:"\n\n\n\n\nuniform sampler2D textureSampler;\nuniform sampler2D highlightsSampler;\nuniform sampler2D depthSampler;\nuniform sampler2D grainSampler;\n\nuniform float grain_amount;\nuniform bool blur_noise;\nuniform float screen_width;\nuniform float screen_height;\nuniform float distortion;\nuniform bool dof_enabled;\n\nuniform float screen_distance; \nuniform float aperture;\nuniform float darken;\nuniform float edge_blur;\nuniform bool highlights;\n\nuniform float near;\nuniform float far;\n\nvarying vec2 vUV;\n\n#define PI 3.14159265\n#define TWOPI 6.28318530\n#define inverse_focal_length 0.1 \n\nvec2 centered_screen_pos;\nvec2 distorted_coords;\nfloat radius2;\nfloat radius;\n\nvec2 rand(vec2 co)\n{\nfloat noise1=(fract(sin(dot(co,vec2(12.9898,78.233)))*43758.5453));\nfloat noise2=(fract(sin(dot(co,vec2(12.9898,78.233)*2.0))*43758.5453));\nreturn clamp(vec2(noise1,noise2),0.0,1.0);\n}\n\nvec2 getDistortedCoords(vec2 coords) {\nif (distortion == 0.0) { return coords; }\nvec2 direction=1.0*normalize(centered_screen_pos);\nvec2 dist_coords=vec2(0.5,0.5);\ndist_coords.x=0.5+direction.x*radius2*1.0;\ndist_coords.y=0.5+direction.y*radius2*1.0;\nfloat dist_amount=clamp(distortion*0.23,0.0,1.0);\ndist_coords=mix(coords,dist_coords,dist_amount);\nreturn dist_coords;\n}\n\nfloat sampleScreen(inout vec4 color,const in vec2 offset,const in float weight) {\n\nvec2 coords=distorted_coords;\nfloat angle=rand(coords*100.0).x*TWOPI;\ncoords+=vec2(offset.x*cos(angle)-offset.y*sin(angle),offset.x*sin(angle)+offset.y*cos(angle));\ncolor+=texture2D(textureSampler,coords)*weight;\nreturn weight;\n}\n\nfloat getBlurLevel(float size) {\nreturn min(3.0,ceil(size/1.0));\n}\n\nvec4 getBlurColor(float size) {\nvec4 col=texture2D(textureSampler,distorted_coords);\nif (size == 0.0) { return col; }\n\n\nfloat blur_level=getBlurLevel(size);\nfloat w=(size/screen_width);\nfloat h=(size/screen_height);\nfloat total_weight=1.0;\nvec2 sample_coords;\ntotal_weight+=sampleScreen(col,vec2(-0.50*w,0.24*h),0.93);\ntotal_weight+=sampleScreen(col,vec2(0.30*w,-0.75*h),0.90);\ntotal_weight+=sampleScreen(col,vec2(0.36*w,0.96*h),0.87);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,-0.55*h),0.85);\ntotal_weight+=sampleScreen(col,vec2(1.33*w,-0.37*h),0.83);\ntotal_weight+=sampleScreen(col,vec2(-0.82*w,1.31*h),0.80);\ntotal_weight+=sampleScreen(col,vec2(-0.31*w,-1.67*h),0.78);\ntotal_weight+=sampleScreen(col,vec2(1.47*w,1.11*h),0.76);\ntotal_weight+=sampleScreen(col,vec2(-1.97*w,0.19*h),0.74);\ntotal_weight+=sampleScreen(col,vec2(1.42*w,-1.57*h),0.72);\nif (blur_level>1.0) {\ntotal_weight+=sampleScreen(col,vec2(0.01*w,2.25*h),0.70);\ntotal_weight+=sampleScreen(col,vec2(-1.62*w,-1.74*h),0.67);\ntotal_weight+=sampleScreen(col,vec2(2.49*w,0.20*h),0.65);\ntotal_weight+=sampleScreen(col,vec2(-2.07*w,1.61*h),0.63);\ntotal_weight+=sampleScreen(col,vec2(0.46*w,-2.70*h),0.61);\ntotal_weight+=sampleScreen(col,vec2(1.55*w,2.40*h),0.59);\ntotal_weight+=sampleScreen(col,vec2(-2.88*w,-0.75*h),0.56);\ntotal_weight+=sampleScreen(col,vec2(2.73*w,-1.44*h),0.54);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,3.02*h),0.52);\ntotal_weight+=sampleScreen(col,vec2(-1.28*w,-3.05*h),0.49);\n}\nif (blur_level>2.0) {\ntotal_weight+=sampleScreen(col,vec2(3.11*w,1.43*h),0.46);\ntotal_weight+=sampleScreen(col,vec2(-3.36*w,1.08*h),0.44);\ntotal_weight+=sampleScreen(col,vec2(1.80*w,-3.16*h),0.41);\ntotal_weight+=sampleScreen(col,vec2(0.83*w,3.65*h),0.38);\ntotal_weight+=sampleScreen(col,vec2(-3.16*w,-2.19*h),0.34);\ntotal_weight+=sampleScreen(col,vec2(3.92*w,-0.53*h),0.31);\ntotal_weight+=sampleScreen(col,vec2(-2.59*w,3.12*h),0.26);\ntotal_weight+=sampleScreen(col,vec2(-0.20*w,-4.15*h),0.22);\ntotal_weight+=sampleScreen(col,vec2(3.02*w,3.00*h),0.15);\n}\ncol/=total_weight; \n\nif (darken>0.0) {\ncol.rgb*=clamp(0.3,1.0,1.05-size*0.5*darken);\n}\n\n\n\n\nreturn col;\n}\nvoid main(void)\n{\n\ncentered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);\nradius2=centered_screen_pos.x*centered_screen_pos.x+centered_screen_pos.y*centered_screen_pos.y;\nradius=sqrt(radius2);\ndistorted_coords=getDistortedCoords(vUV); \nvec2 texels_coords=vec2(vUV.x*screen_width,vUV.y*screen_height); \nfloat depth=texture2D(depthSampler,distorted_coords).r; \nfloat distance=near+(far-near)*depth; \nvec4 color=texture2D(textureSampler,vUV); \n\n\nfloat coc=abs(aperture*(screen_distance*(inverse_focal_length-1.0/distance)-1.0));\n\nif (dof_enabled == false || coc<0.07) { coc=0.0; }\n\nfloat edge_blur_amount=0.0;\nif (edge_blur>0.0) {\nedge_blur_amount=clamp((radius*2.0-1.0+0.15*edge_blur)*1.5,0.0,1.0)*1.3;\n}\n\nfloat blur_amount=max(edge_blur_amount,coc);\n\nif (blur_amount == 0.0) {\ngl_FragColor=texture2D(textureSampler,distorted_coords);\n}\nelse {\n\ngl_FragColor=getBlurColor(blur_amount*1.7);\n\nif (highlights) {\ngl_FragColor.rgb+=clamp(coc,0.0,1.0)*texture2D(highlightsSampler,distorted_coords).rgb;\n}\nif (blur_noise) {\n\nvec2 noise=rand(distorted_coords)*0.01*blur_amount;\nvec2 blurred_coord=vec2(distorted_coords.x+noise.x,distorted_coords.y+noise.y);\ngl_FragColor=0.04*texture2D(textureSampler,blurred_coord)+0.96*gl_FragColor;\n}\n}\n\nif (grain_amount>0.0) {\nvec4 grain_color=texture2D(grainSampler,texels_coords*0.003);\ngl_FragColor.rgb+=(-0.5+grain_color.rgb)*0.30*grain_amount;\n}\n}\n",
displayPassPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D passSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(passSampler,vUV);\n}",ellipse2dPixelShader:"varying vec4 vColor;\nvoid main(void) {\ngl_FragColor=vColor;\n}",ellipse2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\nattribute float index;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\n#ifdef Border\natt float borderThickness;\n#endif\n#ifdef FillSolid\natt vec4 fillSolidColor;\n#endif\n#ifdef BorderSolid\natt vec4 borderSolidColor;\n#endif\n#ifdef FillGradient\natt vec4 fillGradientColor1;\natt vec4 fillGradientColor2;\natt vec4 fillGradientTY;\n#endif\n#ifdef BorderGradient\natt vec4 borderGradientColor1;\natt vec4 borderGradientColor2;\natt vec4 borderGradientTY;\n#endif\n\natt vec3 properties;\n#define TWOPI 6.28318530\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\nvec2 pos2;\n#ifdef Border\nfloat w=properties.x;\nfloat h=properties.y;\nfloat ms=properties.z;\nvec2 borderOffset=vec2(1.0,1.0);\nfloat segi=index;\nif (index<ms) {\nborderOffset=vec2(1.0-(borderThickness*2.0/w),1.0-(borderThickness*2.0/h));\n}\nelse {\nsegi-=ms;\n}\nfloat angle=TWOPI*segi/ms;\npos2.x=(cos(angle)/2.0)+0.5;\npos2.y=(sin(angle)/2.0)+0.5;\npos2.x=((pos2.x-0.5)*borderOffset.x)+0.5;\npos2.y=((pos2.y-0.5)*borderOffset.y)+0.5;\n#else\nif (index == 0.0) {\npos2=vec2(0.5,0.5);\n}\nelse {\nfloat ms=properties.z;\nfloat angle=TWOPI*(index-1.0)/ms;\npos2.x=(cos(angle)/2.0)+0.5;\npos2.y=(sin(angle)/2.0)+0.5;\n}\n#endif\n#ifdef FillSolid\nvColor=fillSolidColor;\n#endif\n#ifdef BorderSolid\nvColor=borderSolidColor;\n#endif\n#ifdef FillGradient\nfloat v=dot(vec4(pos2.xy,1,1),fillGradientTY);\nvColor=mix(fillGradientColor2,fillGradientColor1,v); \n#endif\n#ifdef BorderGradient\nfloat v=dot(vec4(pos2.xy,1,1),borderGradientTY);\nvColor=mix(borderGradientColor2,borderGradientColor1,v); \n#endif\nvec4 pos;\npos.xy=pos2.xy*properties.xy;\npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n}",
filterPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform mat4 kernelMatrix;\nvoid main(void)\n{\nvec3 baseColor=texture2D(textureSampler,vUV).rgb;\nvec3 updatedColor=(kernelMatrix*vec4(baseColor,1.0)).rgb;\ngl_FragColor=vec4(updatedColor,1.0);\n}",fxaaPixelShader:"#define FXAA_REDUCE_MIN (1.0/128.0)\n#define FXAA_REDUCE_MUL (1.0/8.0)\n#define FXAA_SPAN_MAX 8.0\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 texelSize;\nvoid main(){\nvec2 localTexelSize=texelSize;\nvec4 rgbNW=texture2D(textureSampler,(vUV+vec2(-1.0,-1.0)*localTexelSize));\nvec4 rgbNE=texture2D(textureSampler,(vUV+vec2(1.0,-1.0)*localTexelSize));\nvec4 rgbSW=texture2D(textureSampler,(vUV+vec2(-1.0,1.0)*localTexelSize));\nvec4 rgbSE=texture2D(textureSampler,(vUV+vec2(1.0,1.0)*localTexelSize));\nvec4 rgbM=texture2D(textureSampler,vUV);\nvec4 luma=vec4(0.299,0.587,0.114,1.0);\nfloat lumaNW=dot(rgbNW,luma);\nfloat lumaNE=dot(rgbNE,luma);\nfloat lumaSW=dot(rgbSW,luma);\nfloat lumaSE=dot(rgbSE,luma);\nfloat lumaM=dot(rgbM,luma);\nfloat lumaMin=min(lumaM,min(min(lumaNW,lumaNE),min(lumaSW,lumaSE)));\nfloat lumaMax=max(lumaM,max(max(lumaNW,lumaNE),max(lumaSW,lumaSE)));\nvec2 dir=vec2(-((lumaNW+lumaNE)-(lumaSW+lumaSE)),((lumaNW+lumaSW)-(lumaNE+lumaSE)));\nfloat dirReduce=max(\n(lumaNW+lumaNE+lumaSW+lumaSE)*(0.25*FXAA_REDUCE_MUL),\nFXAA_REDUCE_MIN);\nfloat rcpDirMin=1.0/(min(abs(dir.x),abs(dir.y))+dirReduce);\ndir=min(vec2(FXAA_SPAN_MAX,FXAA_SPAN_MAX),\nmax(vec2(-FXAA_SPAN_MAX,-FXAA_SPAN_MAX),\ndir*rcpDirMin))*localTexelSize;\nvec4 rgbA=0.5*(\ntexture2D(textureSampler,vUV+dir*(1.0/3.0-0.5)) +\ntexture2D(textureSampler,vUV+dir*(2.0/3.0-0.5)));\nvec4 rgbB=rgbA*0.5+0.25*(\ntexture2D(textureSampler,vUV+dir*-0.5) +\ntexture2D(textureSampler,vUV+dir*0.5));\nfloat lumaB=dot(rgbB,luma);\nif ((lumaB<lumaMin) || (lumaB>lumaMax)) {\ngl_FragColor=rgbA;\n}\nelse {\ngl_FragColor=rgbB;\n}\n}",
hdrPixelShader:"uniform sampler2D textureSampler;\nvarying vec2 vUV;\n#if defined(GAUSSIAN_BLUR_H) || defined(GAUSSIAN_BLUR_V)\nuniform float blurOffsets[9];\nuniform float blurWeights[9];\nuniform float multiplier;\nvoid main(void) {\nvec4 color=vec4(0.0,0.0,0.0,0.0);\nfor (int i=0; i<9; i++) {\n#ifdef GAUSSIAN_BLUR_H\ncolor+=(texture2D(textureSampler,vUV+vec2(blurOffsets[i]*multiplier,0.0))*blurWeights[i]);\n#else\ncolor+=(texture2D(textureSampler,vUV+vec2(0.0,blurOffsets[i]*multiplier))*blurWeights[i]);\n#endif\n}\ncolor.a=1.0;\ngl_FragColor=color;\n}\n#endif\n#if defined(TEXTURE_ADDER)\nuniform sampler2D otherSampler;\nvoid main() {\nvec4 sum=texture2D(textureSampler,vUV)+texture2D(otherSampler,vUV);\nsum.a=clamp(sum.a,0.0,1.0);\ngl_FragColor=sum;\n}\n#endif\n#if defined(LUMINANCE_GENERATOR)\nuniform vec2 lumOffsets[4];\nvoid main() {\nfloat average=0.0;\nvec4 color=vec4(0.0,0.0,0.0,0.0);\nfloat maximum=-1e20;\nfor (int i=0; i<4; i++) {\ncolor=texture2D(textureSampler,vUV+lumOffsets[i]);\nfloat GreyValue=length(color.rgb);\nmaximum=max(maximum,GreyValue);\naverage+=(0.25*log(1e-5+GreyValue));\n}\naverage=exp(average);\ngl_FragColor=vec4(average,maximum,0.0,1.0);\n}\n#endif\n#if defined(DOWN_SAMPLE)\nuniform vec2 dsOffsets[9];\nuniform float halfDestPixelSize;\n#ifdef FINAL_DOWN_SAMPLE\nvec4 pack(float value) {\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(value*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\n#endif\nvoid main() {\nvec4 color=vec4(0.0,0.0,0.0,0.0);\nfloat average=0.0;\nfor (int i=0; i<9; i++) {\ncolor=texture2D(textureSampler,vUV+vec2(halfDestPixelSize,halfDestPixelSize)+dsOffsets[i]);\naverage+=color.r;\n}\naverage/=9.0;\n#ifndef FINAL_DOWN_SAMPLE\ngl_FragColor=vec4(average,average,0.0,1.0);\n#else\ngl_FragColor=pack(average);\n#endif\n}\n#endif\n#if defined(BRIGHT_PASS)\nuniform vec2 dsOffsets[4];\nuniform float brightThreshold;\nvoid main() {\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+vec2(dsOffsets[0].x,dsOffsets[0].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[1].x,dsOffsets[1].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[2].x,dsOffsets[2].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[3].x,dsOffsets[3].y));\naverage*=0.25;\nfloat luminance=length(average.rgb);\nif (luminance<brightThreshold) {\naverage=vec4(0.0,0.0,0.0,1.0);\n}\ngl_FragColor=average;\n}\n#endif\n#if defined(DOWN_SAMPLE_X4)\nuniform vec2 dsOffsets[16];\nvoid main() {\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+dsOffsets[0]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[1]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[2]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[3]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[4]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[5]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[6]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[7]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[8]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[9]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[10]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[11]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[12]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[13]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[14]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[15]);\naverage/=16.0;\ngl_FragColor=average;\n}\n#endif\n#if defined(HDR)\nuniform sampler2D otherSampler;\nuniform float exposure;\nuniform float avgLuminance;\nvoid main() {\nvec4 color=texture2D(textureSampler,vUV)+texture2D(otherSampler,vUV);\nvec4 adjustedColor=color/avgLuminance*exposure;\ncolor=adjustedColor;\ncolor.a=1.0;\ngl_FragColor=color;\n}\n#endif\n",
layerPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=baseColor*color;\n}",layerVertexShader:"\nattribute vec2 position;\n\nuniform vec2 scale;\nuniform vec2 offset;\nuniform mat4 textureMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvec2 shiftedPosition=position*scale+offset;\nvUV=vec2(textureMatrix*vec4(shiftedPosition*madd+madd,1.0,0.0));\ngl_Position=vec4(shiftedPosition,0.0,1.0);\n}",
legacydefaultPixelShader:"#define MAP_PROJECTION 4.\n\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\n\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<lightFragmentDeclaration>[0..3]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef REFLECTION\nvarying vec3 vReflectionUVW;\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\nuniform vec2 vReflectionInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform sampler2D specularSampler;\n#endif\n\n#include<fresnelFunction>\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\nvec3 normalW=normalize(vNormalW);\n\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV).rgb*vAmbientInfos.y;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat glossiness=0.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\nglossiness=vSpecularColor.a;\n#endif\nfloat shadow=1.;\n#include<lightFragment>[0..3]\n\nvec3 reflectionColor=vec3(0.,0.,0.);\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb*vReflectionInfos.x;\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords).rgb*vReflectionInfos.x;\n#endif\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n\nfloat alpha=vDiffuseColor.a;\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef SPECULARTERM\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nspecularColor=texture2D(specularSampler,vSpecularUV).rgb*vSpecularInfos.y;\n#endif\n#endif\n\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n}",
legacydefaultVertexShader:"\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec2 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<shadowsVertexDeclaration>[0..maxSimultaneousLights]\n#ifdef REFLECTION\nuniform vec3 vEyePosition;\nvarying vec3 vReflectionUVW;\nuniform mat4 reflectionMatrix;\nvec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#ifdef REFLECTIONMAP_SPHERICAL\nvec3 coords=vec3(view*vec4(worldNormal,0.0));\nreturn vec3(reflectionMatrix*vec4(coords,1.0));\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nvec3 viewDir=worldPos.xyz-vEyePosition;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n#endif\n#ifdef REFLECTIONMAP_CUBIC\nvec3 viewDir=worldPos.xyz-vEyePosition;\nvec3 coords=reflect(viewDir,worldNormal);\n#ifdef INVERTCUBICMAP\ncoords.y=1.0-coords.y;\n#endif\nreturn vec3(reflectionMatrix*vec4(coords,0));\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn vec3(reflectionMatrix*(view*worldPos));\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn position;\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}\n#endif\nvoid main(void) {\nmat4 finalWorld=world;\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef AMBIENT\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef OPACITY\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef REFLECTION\nvReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),vNormalW);\n#endif\n#ifdef EMISSIVE\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nif (vSpecularInfos.x == 0.)\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef BUMP\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n}",
legacypbrPixelShader:"precision mediump float;\n\n#define RECIPROCAL_PI2 0.15915494\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vAlbedoColor;\nuniform vec3 vReflectionColor;\n\nuniform vec4 vLightingIntensity;\nuniform vec4 vCameraInfos;\n#ifdef OVERLOADEDVALUES\nuniform vec4 vOverloadedIntensity;\nuniform vec3 vOverloadedAmbient;\nuniform vec3 vOverloadedAlbedo;\nuniform vec3 vOverloadedReflectivity;\nuniform vec3 vOverloadedEmissive;\nuniform vec3 vOverloadedReflection;\nuniform vec3 vOverloadedMicroSurface;\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nuniform vec4 vOverloadedShadowIntensity;\n#endif\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<lightFragmentDeclaration>[0..maxSimultaneousLights]\n\n#ifdef ALBEDO\nvarying vec2 vAlbedoUV;\nuniform sampler2D albedoSampler;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform sampler2D lightmapSampler;\n#endif\n#if defined(REFLECTIVITY)\nvarying vec2 vReflectivityUV;\nuniform vec2 vReflectivityInfos;\nuniform sampler2D reflectivitySampler;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#ifdef CAMERACOLORGRADING\nuniform sampler2D cameraColorGrading2DSampler;\nuniform vec4 vCameraColorGradingInfos;\nuniform vec4 vCameraColorGradingScaleOffset;\n#endif\n\n#include<pbrFunctions>\n#include<harmonicsFunctions>\n#include<pbrLightFunctions>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 surfaceAlbedo=vec4(1.,1.,1.,1.);\nvec3 surfaceAlbedoContribution=vAlbedoColor.rgb;\n\nfloat alpha=vAlbedoColor.a;\n#ifdef ALBEDO\nsurfaceAlbedo=texture2D(albedoSampler,vAlbedoUV);\nsurfaceAlbedo=vec4(toLinearSpace(surfaceAlbedo.rgb),surfaceAlbedo.a);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#ifdef ALPHAFROMALBEDO\nalpha*=surfaceAlbedo.a;\n#endif\nsurfaceAlbedo.rgb*=vAlbedoInfos.y;\n#else\n\nsurfaceAlbedo.rgb=surfaceAlbedoContribution;\nsurfaceAlbedoContribution=vec3(1.,1.,1.);\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n#ifdef OVERLOADEDVALUES\nsurfaceAlbedo.rgb=mix(surfaceAlbedo.rgb,vOverloadedAlbedo,vOverloadedIntensity.y);\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n\nvec3 ambientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nambientColor=texture2D(ambientSampler,vAmbientUV).rgb*vAmbientInfos.y;\n#ifdef OVERLOADEDVALUES\nambientColor.rgb=mix(ambientColor.rgb,vOverloadedAmbient,vOverloadedIntensity.x);\n#endif\n#endif\n\nfloat microSurface=vReflectivityColor.a;\nvec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef OVERLOADEDVALUES\nsurfaceReflectivityColor.rgb=mix(surfaceReflectivityColor.rgb,vOverloadedReflectivity,vOverloadedIntensity.z);\n#endif\n#ifdef REFLECTIVITY\nvec4 surfaceReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV);\nsurfaceReflectivityColor=surfaceReflectivityColorMap.rgb;\nsurfaceReflectivityColor=toLinearSpace(surfaceReflectivityColor);\n#ifdef OVERLOADEDVALUES\nsurfaceReflectivityColor=mix(surfaceReflectivityColor,vOverloadedReflectivity,vOverloadedIntensity.z);\n#endif\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface=surfaceReflectivityColorMap.a;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#endif\n#endif\n#ifdef OVERLOADEDVALUES\nmicroSurface=mix(microSurface,vOverloadedMicroSurface.x,vOverloadedMicroSurface.y);\n#endif\n\nfloat NdotV=max(0.00000000001,dot(normalW,viewDirectionW));\n\nmicroSurface=clamp(microSurface,0.,1.)*0.98;\n\nfloat roughness=clamp(1.-microSurface,0.000001,1.0);\n\nvec3 lightDiffuseContribution=vec3(0.,0.,0.);\n#ifdef OVERLOADEDSHADOWVALUES\nvec3 shadowedOnlyLightDiffuseContribution=vec3(1.,1.,1.);\n#endif\n#ifdef SPECULARTERM\nvec3 lightSpecularContribution= vec3(0.,0.,0.);\n#endif\nfloat notShadowLevel=1.; \nfloat NdotL=-1.;\nlightingInfo info;\n#include<pbrLightFunctionsCall>[0..maxSimultaneousLights]\n#ifdef SPECULARTERM\nlightSpecularContribution*=vLightingIntensity.w;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n\nvec3 environmentRadiance=vReflectionColor.rgb;\nvec3 environmentIrradiance=vReflectionColor.rgb;\n#ifdef OVERLOADEDVALUES\nenvironmentIrradiance=mix(environmentIrradiance,vOverloadedReflection,vOverloadedMicroSurface.z);\nenvironmentRadiance=mix(environmentRadiance,vOverloadedReflection,vOverloadedMicroSurface.z);\n#endif\nenvironmentRadiance*=vLightingIntensity.z;\nenvironmentIrradiance*=vLightingIntensity.z;\n\nvec3 specularEnvironmentR0=surfaceReflectivityColor.rgb;\nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0);\nvec3 specularEnvironmentReflectance=FresnelSchlickEnvironmentGGX(clamp(NdotV,0.,1.),specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n\nfloat reflectance=max(max(surfaceReflectivityColor.r,surfaceReflectivityColor.g),surfaceReflectivityColor.b);\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\nenvironmentRadiance*=specularEnvironmentReflectance;\n\nvec3 surfaceEmissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV).rgb;\nsurfaceEmissiveColor=toLinearSpace(emissiveColorTex.rgb)*surfaceEmissiveColor*vEmissiveInfos.y;\n#endif\n#ifdef OVERLOADEDVALUES\nsurfaceEmissiveColor=mix(surfaceEmissiveColor,vOverloadedEmissive,vOverloadedIntensity.w);\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=max(lightDiffuseContribution*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max(shadowedOnlyLightDiffuseContribution*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#else\n#ifdef LINKEMISSIVEWITHALBEDO\nvec3 finalDiffuse=max((lightDiffuseContribution+surfaceEmissiveColor)*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max((shadowedOnlyLightDiffuseContribution+surfaceEmissiveColor)*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#else\nvec3 finalDiffuse=max(lightDiffuseContribution*surfaceAlbedoContribution+surfaceEmissiveColor+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max(shadowedOnlyLightDiffuseContribution*surfaceAlbedoContribution+surfaceEmissiveColor+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#endif\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nfinalDiffuse=mix(finalDiffuse,shadowedOnlyLightDiffuseContribution,(1.0-vOverloadedShadowIntensity.y));\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=lightSpecularContribution*surfaceReflectivityColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+getLuminance(finalSpecular),0.,1.);\n#endif\n#ifdef RADIANCEOVERALPHA\nalpha=clamp(alpha+getLuminance(environmentRadiance),0.,1.);\n#endif\n\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 finalColor=vec4(finalDiffuse*ambientColor*vLightingIntensity.x+surfaceAlbedo.rgb*environmentIrradiance+finalSpecular*vLightingIntensity.x+environmentRadiance+surfaceEmissiveColor*vLightingIntensity.y,alpha);\n#else\nvec4 finalColor=vec4(finalDiffuse*ambientColor*vLightingIntensity.x+surfaceAlbedo.rgb*environmentIrradiance+finalSpecular*vLightingIntensity.x+environmentRadiance,alpha);\n#endif\nfinalColor=max(finalColor,0.0);\n#ifdef CAMERATONEMAP\nfinalColor.rgb=toneMaps(finalColor.rgb);\n#endif\nfinalColor.rgb=toGammaSpace(finalColor.rgb);\n#ifdef CAMERACONTRAST\nfinalColor=contrasts(finalColor);\n#endif\nfinalColor.rgb=clamp(finalColor.rgb,0.,1.);\n#ifdef CAMERACOLORGRADING\nfinalColor=colorGrades(finalColor,cameraColorGrading2DSampler,vCameraColorGradingInfos,vCameraColorGradingScaleOffset);\n#endif\ngl_FragColor=finalColor;\n}",
legacypbrVertexShader:"precision mediump float;\n\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef ALBEDO\nvarying vec2 vAlbedoUV;\nuniform mat4 albedoMatrix;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#if defined(REFLECTIVITY)\nvarying vec2 vReflectivityUV;\nuniform vec2 vReflectivityInfos;\nuniform mat4 reflectivityMatrix;\n#endif\n\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\nvoid main(void) {\nmat4 finalWorld=world;\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef ALBEDO\nif (vAlbedoInfos.x == 0.)\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef AMBIENT\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef OPACITY\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef EMISSIVE\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(REFLECTIVITY)\nif (vReflectivityInfos.x == 0.)\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<clipPlaneVertex>\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n}",
lensFlarePixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\ngl_FragColor=baseColor*color;\n}",lensFlareVertexShader:"\nattribute vec2 position;\n\nuniform mat4 viewportMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvUV=position*madd+madd;\ngl_Position=viewportMatrix*vec4(position,0.0,1.0);\n}",lensHighlightsPixelShader:"\nuniform sampler2D textureSampler; \n\nuniform float gain;\nuniform float threshold;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\n\nvec4 highlightColor(vec4 color) {\nvec4 highlight=color;\nfloat luminance=dot(highlight.rgb,vec3(0.2125,0.7154,0.0721));\nfloat lum_threshold;\nif (threshold>1.0) { lum_threshold=0.94+0.01*threshold; }\nelse { lum_threshold=0.5+0.44*threshold; }\nluminance=clamp((luminance-lum_threshold)*(1.0/(1.0-lum_threshold)),0.0,1.0);\nhighlight*=luminance*gain;\nhighlight.a=1.0;\nreturn highlight;\n}\nvoid main(void)\n{\nvec4 original=texture2D(textureSampler,vUV);\n\nif (gain == -1.0) {\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\nreturn;\n}\nfloat w=2.0/screen_width;\nfloat h=2.0/screen_height;\nfloat weight=1.0;\n\nvec4 blurred=vec4(0.0,0.0,0.0,0.0);\n#ifdef PENTAGON\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.84*w,0.43*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.48*w,-1.29*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.61*w,1.51*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.55*w,-0.74*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.71*w,-0.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.94*w,1.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.40*w,-1.87*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.62*w,1.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.09*w,0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.46*w,-1.71*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.08*w,2.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.85*w,-1.89*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.89*w,0.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.29*w,1.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.40*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.54*w,2.26*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.60*w,-0.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.31*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.83*w,2.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.12*w,-2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.60*w,1.11*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.99*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.50*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.85*w,3.33*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.94*w,-1.92*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.27*w,-0.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.95*w,2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.23*w,-3.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.17*w,2.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.97*w,-0.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.25*w,-2.00*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.31*w,3.08*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.94*w,-2.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.37*w,0.64*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.13*w,1.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.03*w,-3.65*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.60*w,3.17*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.14*w,-1.19*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.00*w,-1.19*h)));\n#else\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.85*w,0.36*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.52*w,-1.14*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.46*w,1.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.46*w,-0.83*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.79*w,-0.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.11*w,1.62*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.29*w,-2.07*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.69*w,1.39*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.28*w,0.12*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.65*w,-1.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.08*w,2.44*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.63*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.55*w,0.31*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.13*w,1.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.56*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.38*w,2.34*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.64*w,-0.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.53*w,-1.21*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.06*w,2.63*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.00*w,-2.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.59*w,1.32*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.78*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.57*w,-2.50*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.54*w,2.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.39*w,-1.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,-0.28*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.04*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.02*w,-3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.09*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.07*w,-0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.44*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.52*w,3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.68*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,0.79*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.76*w,1.46*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.05*w,-2.94*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.21*w,2.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.84*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.98*w,-0.96*h)));\n#endif\nblurred/=39.0;\ngl_FragColor=blurred;\n\n}",
linePixelShader:"uniform vec4 color;\nvoid main(void) {\ngl_FragColor=color;\n}",lineVertexShader:"\nattribute vec3 position;\nattribute vec4 normal;\n\nuniform mat4 worldViewProjection;\nuniform float width;\nuniform float aspectRatio;\nvoid main(void) {\nvec4 viewPosition=worldViewProjection*vec4(position,1.0);\nvec4 viewPositionNext=worldViewProjection*vec4(normal.xyz,1.0);\nvec2 currentScreen=viewPosition.xy/viewPosition.w;\nvec2 nextScreen=viewPositionNext.xy/viewPositionNext.w;\ncurrentScreen.x*=aspectRatio;\nnextScreen.x*=aspectRatio;\nvec2 dir=normalize(nextScreen-currentScreen);\nvec2 normalDir=vec2(-dir.y,dir.x);\nnormalDir*=width/2.0;\nnormalDir.x/=aspectRatio;\nvec4 offset=vec4(normalDir*normal.w,0.0,0.0);\ngl_Position=viewPosition+offset;\n}",
lines2dPixelShader:"varying vec4 vColor;\nvoid main(void) {\ngl_FragColor=vColor;\n}",lines2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\nattribute vec2 position;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\n#ifdef FillSolid\natt vec4 fillSolidColor;\n#endif\n#ifdef BorderSolid\natt vec4 borderSolidColor;\n#endif\n#ifdef FillGradient\natt vec2 boundingMin;\natt vec2 boundingMax;\natt vec4 fillGradientColor1;\natt vec4 fillGradientColor2;\natt vec4 fillGradientTY;\n#endif\n#ifdef BorderGradient\natt vec4 borderGradientColor1;\natt vec4 borderGradientColor2;\natt vec4 borderGradientTY;\n#endif\n#define TWOPI 6.28318530\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\n#ifdef FillSolid\nvColor=fillSolidColor;\n#endif\n#ifdef BorderSolid\nvColor=borderSolidColor;\n#endif\n#ifdef FillGradient\nfloat v=dot(vec4((position.xy-boundingMin)/(boundingMax-boundingMin),1,1),fillGradientTY);\nvColor=mix(fillGradientColor2,fillGradientColor1,v); \n#endif\n#ifdef BorderGradient\nfloat v=dot(vec4((position.xy-boundingMin)/(boundingMax-boundingMin),1,1),borderGradientTY);\nvColor=mix(borderGradientColor2,borderGradientColor1,v); \n#endif\nvec4 pos;\npos.xy=position.xy;\npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n}",
outlinePixelShader:"uniform vec4 color;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nvoid main(void) {\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\ngl_FragColor=color;\n}",outlineVertexShader:"\nattribute vec3 position;\nattribute vec3 normal;\n#include<bonesDeclaration>\n\nuniform float offset;\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\nvec3 offsetPosition=position+normal*offset;\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(offsetPosition,1.0);\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}\n",
particlesPixelShader:"\nvarying vec2 vUV;\nvarying vec4 vColor;\nuniform vec4 textureMask;\nuniform sampler2D diffuseSampler;\n#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\nvoid main(void) {\n#ifdef CLIPPLANE\nif (fClipDistance>0.0)\ndiscard;\n#endif\nvec4 baseColor=texture2D(diffuseSampler,vUV);\ngl_FragColor=(baseColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n}",particlesVertexShader:"\nattribute vec3 position;\nattribute vec4 color;\nattribute vec4 options;\n\nuniform mat4 view;\nuniform mat4 projection;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nuniform mat4 invView;\nvarying float fClipDistance;\n#endif\nvoid main(void) { \nvec3 viewPos=(view*vec4(position,1.0)).xyz; \nvec3 cornerPos;\nfloat size=options.y;\nfloat angle=options.x;\nvec2 offset=options.zw;\ncornerPos=vec3(offset.x-0.5,offset.y-0.5,0.)*size;\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nviewPos+=rotatedCorner;\ngl_Position=projection*vec4(viewPos,1.0); \nvColor=color;\nvUV=offset;\n\n#ifdef CLIPPLANE\nvec4 worldPos=invView*vec4(viewPos,1.0);\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n}",
passPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nvoid main(void) \n{\ngl_FragColor=texture2D(textureSampler,vUV);\n}",pbrPixelShader:"#ifdef BUMP\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LODBASEDMICROSFURACE\n#extension GL_EXT_shader_texture_lod : enable\n#endif\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nprecision highp float;\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\n\nuniform vec4 vLightingIntensity;\nuniform vec4 vCameraInfos;\n#ifdef OVERLOADEDVALUES\nuniform vec4 vOverloadedIntensity;\nuniform vec3 vOverloadedAmbient;\nuniform vec3 vOverloadedAlbedo;\nuniform vec3 vOverloadedReflectivity;\nuniform vec3 vOverloadedEmissive;\nuniform vec3 vOverloadedReflection;\nuniform vec3 vOverloadedMicroSurface;\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nuniform vec4 vOverloadedShadowIntensity;\n#endif\n#if defined(REFLECTION) || defined(REFRACTION)\nuniform vec2 vMicrosurfaceTextureLods;\n#endif\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<lightFragmentDeclaration>[0..maxSimultaneousLights]\n\n#ifdef ALBEDO\nvarying vec2 vAlbedoUV;\nuniform sampler2D albedoSampler;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform sampler2D lightmapSampler;\n#endif\n#if defined(REFLECTIVITY)\nvarying vec2 vReflectivityUV;\nuniform vec2 vReflectivityInfos;\nuniform sampler2D reflectivitySampler;\n#endif\n\n#include<fresnelFunction>\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\nuniform mat4 refractionMatrix;\n#endif\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION)\nuniform mat4 reflectionMatrix;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#ifdef CAMERACOLORGRADING\n#include<colorGradingDefinition>\n#endif\n#ifdef CAMERACOLORCURVES\n#include<colorCurvesDefinition>\n#endif\n\n#include<pbrShadowFunctions>\n#include<pbrFunctions>\n#ifdef CAMERACOLORGRADING\n#include<colorGrading>\n#endif\n#ifdef CAMERACOLORCURVES\n#include<colorCurves>\n#endif\n#include<harmonicsFunctions>\n#include<pbrLightFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 surfaceAlbedo=vec4(1.,1.,1.,1.);\nvec3 surfaceAlbedoContribution=vAlbedoColor.rgb;\n\nfloat alpha=vAlbedoColor.a;\n#ifdef ALBEDO\nsurfaceAlbedo=texture2D(albedoSampler,vAlbedoUV);\nsurfaceAlbedo=vec4(toLinearSpace(surfaceAlbedo.rgb),surfaceAlbedo.a);\n#ifndef LINKREFRACTIONTOTRANSPARENCY\n#ifdef ALPHATEST\nif (surfaceAlbedo.a<0.4)\ndiscard;\n#endif\n#endif\n#ifdef ALPHAFROMALBEDO\nalpha*=surfaceAlbedo.a;\n#endif\nsurfaceAlbedo.rgb*=vAlbedoInfos.y;\n#else\n\nsurfaceAlbedo.rgb=surfaceAlbedoContribution;\nsurfaceAlbedoContribution=vec3(1.,1.,1.);\n#endif\n#ifdef VERTEXCOLOR\nsurfaceAlbedo.rgb*=vColor.rgb;\n#endif\n#ifdef OVERLOADEDVALUES\nsurfaceAlbedo.rgb=mix(surfaceAlbedo.rgb,vOverloadedAlbedo,vOverloadedIntensity.y);\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#include<bumpFragment>\n\nvec3 ambientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nambientColor=texture2D(ambientSampler,vAmbientUV).rgb*vAmbientInfos.y;\n#ifdef OVERLOADEDVALUES\nambientColor.rgb=mix(ambientColor.rgb,vOverloadedAmbient,vOverloadedIntensity.x);\n#endif\n#endif\n\nfloat microSurface=vReflectivityColor.a;\nvec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef OVERLOADEDVALUES\nsurfaceReflectivityColor.rgb=mix(surfaceReflectivityColor.rgb,vOverloadedReflectivity,vOverloadedIntensity.z);\n#endif\n#ifdef REFLECTIVITY\nvec4 surfaceReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV);\nsurfaceReflectivityColor=surfaceReflectivityColorMap.rgb;\nsurfaceReflectivityColor=toLinearSpace(surfaceReflectivityColor);\n#ifdef OVERLOADEDVALUES\nsurfaceReflectivityColor=mix(surfaceReflectivityColor,vOverloadedReflectivity,vOverloadedIntensity.z);\n#endif\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface=surfaceReflectivityColorMap.a;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#endif\n#endif\n#ifdef OVERLOADEDVALUES\nmicroSurface=mix(microSurface,vOverloadedMicroSurface.x,vOverloadedMicroSurface.y);\n#endif\n\nfloat NdotV=max(0.00000000001,dot(normalW,viewDirectionW));\n\nmicroSurface=clamp(microSurface,0.,1.)*0.98;\n\nfloat roughness=clamp(1.-microSurface,0.000001,1.0);\n\nvec3 lightDiffuseContribution=vec3(0.,0.,0.);\n#ifdef OVERLOADEDSHADOWVALUES\nvec3 shadowedOnlyLightDiffuseContribution=vec3(1.,1.,1.);\n#endif\n#ifdef SPECULARTERM\nvec3 lightSpecularContribution=vec3(0.,0.,0.);\n#endif\nfloat notShadowLevel=1.; \nfloat NdotL=-1.;\nlightingInfo info;\n\nfloat reflectance=max(max(surfaceReflectivityColor.r,surfaceReflectivityColor.g),surfaceReflectivityColor.b);\n\n\nfloat reflectance90=clamp(reflectance*25.0,0.0,1.0);\nvec3 specularEnvironmentR0=surfaceReflectivityColor.rgb;\nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0)*reflectance90;\n#include<pbrLightFunctionsCall>[0..maxSimultaneousLights]\n#ifdef SPECULARTERM\nlightSpecularContribution*=vLightingIntensity.w;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 surfaceRefractionColor=vec3(0.,0.,0.);\n\n#ifdef LODBASEDMICROSFURACE\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\n#endif\n#ifdef REFRACTION\nvec3 refractionVector=refract(-viewDirectionW,normalW,vRefractionInfos.y);\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFRACTION\nfloat lodRefraction=getMipMapIndexFromAverageSlopeWithPMREM(vMicrosurfaceTextureLods.y,alphaG);\n#else\nfloat lodRefraction=getMipMapIndexFromAverageSlope(vMicrosurfaceTextureLods.y,alphaG);\n#endif\n#else\nfloat biasRefraction=(vMicrosurfaceTextureLods.y+2.)*(1.0-microSurface);\n#endif\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0)\n{\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFRACTION\n\nif ((vMicrosurfaceTextureLods.y-lodRefraction)>4.0)\n{\n\nfloat scaleRefraction=1.-exp2(lodRefraction)/exp2(vMicrosurfaceTextureLods.y); \nfloat maxRefraction=max(max(abs(refractionVector.x),abs(refractionVector.y)),abs(refractionVector.z));\nif (abs(refractionVector.x) != maxRefraction) refractionVector.x*=scaleRefraction;\nif (abs(refractionVector.y) != maxRefraction) refractionVector.y*=scaleRefraction;\nif (abs(refractionVector.z) != maxRefraction) refractionVector.z*=scaleRefraction;\n}\n#endif\nsurfaceRefractionColor=textureCubeLodEXT(refractionCubeSampler,refractionVector,lodRefraction).rgb*vRefractionInfos.x;\n#else\nsurfaceRefractionColor=textureCube(refractionCubeSampler,refractionVector,biasRefraction).rgb*vRefractionInfos.x;\n#endif\n}\n#ifndef REFRACTIONMAPINLINEARSPACE\nsurfaceRefractionColor=toLinearSpace(surfaceRefractionColor.rgb);\n#endif\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\n#ifdef LODBASEDMICROSFURACE\nsurfaceRefractionColor=texture2DLodEXT(refraction2DSampler,refractionCoords,lodRefraction).rgb*vRefractionInfos.x;\n#else\nsurfaceRefractionColor=texture2D(refraction2DSampler,refractionCoords,biasRefraction).rgb*vRefractionInfos.x;\n#endif \nsurfaceRefractionColor=toLinearSpace(surfaceRefractionColor.rgb);\n#endif\n#endif\n\nvec3 environmentRadiance=vReflectionColor.rgb;\nvec3 environmentIrradiance=vReflectionColor.rgb;\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFLECTION\nfloat lodReflection=getMipMapIndexFromAverageSlopeWithPMREM(vMicrosurfaceTextureLods.x,alphaG);\n#else\nfloat lodReflection=getMipMapIndexFromAverageSlope(vMicrosurfaceTextureLods.x,alphaG);\n#endif\n#else\nfloat biasReflection=(vMicrosurfaceTextureLods.x+2.)*(1.0-microSurface);\n#endif\n#ifdef REFLECTIONMAP_3D\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFLECTION\n\nif ((vMicrosurfaceTextureLods.y-lodReflection)>4.0)\n{\n\nfloat scaleReflection=1.-exp2(lodReflection)/exp2(vMicrosurfaceTextureLods.x); \nfloat maxReflection=max(max(abs(vReflectionUVW.x),abs(vReflectionUVW.y)),abs(vReflectionUVW.z));\nif (abs(vReflectionUVW.x) != maxReflection) vReflectionUVW.x*=scaleReflection;\nif (abs(vReflectionUVW.y) != maxReflection) vReflectionUVW.y*=scaleReflection;\nif (abs(vReflectionUVW.z) != maxReflection) vReflectionUVW.z*=scaleReflection;\n}\n#endif\nenvironmentRadiance=textureCubeLodEXT(reflectionCubeSampler,vReflectionUVW,lodReflection).rgb*vReflectionInfos.x;\n#else\nenvironmentRadiance=textureCube(reflectionCubeSampler,vReflectionUVW,biasReflection).rgb*vReflectionInfos.x;\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifndef REFLECTIONMAP_SKYBOX\nvec3 normalEnvironmentSpace=(reflectionMatrix*vec4(normalW,1)).xyz;\nenvironmentIrradiance=EnvironmentIrradiance(normalEnvironmentSpace);\n#endif\n#else\nenvironmentRadiance=toLinearSpace(environmentRadiance.rgb);\nenvironmentIrradiance=textureCube(reflectionCubeSampler,normalW,20.).rgb*vReflectionInfos.x;\nenvironmentIrradiance=toLinearSpace(environmentIrradiance.rgb);\nenvironmentIrradiance*=0.2; \n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\n#ifdef LODBASEDMICROSFURACE\nenvironmentRadiance=texture2DLodEXT(reflection2DSampler,coords,lodReflection).rgb*vReflectionInfos.x;\n#else\nenvironmentRadiance=texture2D(reflection2DSampler,coords,biasReflection).rgb*vReflectionInfos.x;\n#endif\nenvironmentRadiance=toLinearSpace(environmentRadiance.rgb);\nenvironmentIrradiance=texture2D(reflection2DSampler,coords,20.).rgb*vReflectionInfos.x;\nenvironmentIrradiance=toLinearSpace(environmentIrradiance.rgb);\n#endif\n#endif\n#ifdef OVERLOADEDVALUES\nenvironmentIrradiance=mix(environmentIrradiance,vOverloadedReflection,vOverloadedMicroSurface.z);\nenvironmentRadiance=mix(environmentRadiance,vOverloadedReflection,vOverloadedMicroSurface.z);\n#endif\nenvironmentRadiance*=vLightingIntensity.z;\nenvironmentIrradiance*=vLightingIntensity.z;\n\nvec3 specularEnvironmentReflectance=FresnelSchlickEnvironmentGGX(clamp(NdotV,0.,1.),specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n\nvec3 refractance=vec3(0.0,0.0,0.0);\n#ifdef REFRACTION\nvec3 transmission=vec3(1.0,1.0,1.0);\n#ifdef LINKREFRACTIONTOTRANSPARENCY\n\ntransmission*=(1.0-alpha);\n\n\nvec3 mixedAlbedo=surfaceAlbedoContribution.rgb*surfaceAlbedo.rgb;\nfloat maxChannel=max(max(mixedAlbedo.r,mixedAlbedo.g),mixedAlbedo.b);\nvec3 tint=clamp(maxChannel*mixedAlbedo,0.0,1.0);\n\nsurfaceAlbedoContribution*=alpha;\n\nenvironmentIrradiance*=alpha;\n\nsurfaceRefractionColor*=tint;\n\nalpha=1.0;\n#endif\n\nvec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);\nspecularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,alpha);\n\ntransmission*=1.0-specularEnvironmentReflectance;\n\nrefractance=surfaceRefractionColor*transmission;\n#endif\n\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\nrefractance*=vLightingIntensity.z;\nenvironmentRadiance*=specularEnvironmentReflectance;\n\nvec3 surfaceEmissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV).rgb;\nsurfaceEmissiveColor=toLinearSpace(emissiveColorTex.rgb)*surfaceEmissiveColor*vEmissiveInfos.y;\n#endif\n#ifdef OVERLOADEDVALUES\nsurfaceEmissiveColor=mix(surfaceEmissiveColor,vOverloadedEmissive,vOverloadedIntensity.w);\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nsurfaceEmissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=max(lightDiffuseContribution*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max(shadowedOnlyLightDiffuseContribution*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#else\n#ifdef LINKEMISSIVEWITHALBEDO\nvec3 finalDiffuse=max((lightDiffuseContribution+surfaceEmissiveColor)*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max((shadowedOnlyLightDiffuseContribution+surfaceEmissiveColor)*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#else\nvec3 finalDiffuse=max(lightDiffuseContribution*surfaceAlbedoContribution+surfaceEmissiveColor+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max(shadowedOnlyLightDiffuseContribution*surfaceAlbedoContribution+surfaceEmissiveColor+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#endif\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nfinalDiffuse=mix(finalDiffuse,shadowedOnlyLightDiffuseContribution,(1.0-vOverloadedShadowIntensity.y));\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=lightSpecularContribution*surfaceReflectivityColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+getLuminance(finalSpecular),0.,1.);\n#endif\n#ifdef RADIANCEOVERALPHA\nalpha=clamp(alpha+getLuminance(environmentRadiance),0.,1.);\n#endif\n\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 finalColor=vec4(finalDiffuse*ambientColor*vLightingIntensity.x+surfaceAlbedo.rgb*environmentIrradiance+finalSpecular*vLightingIntensity.x+environmentRadiance+surfaceEmissiveColor*vLightingIntensity.y+refractance,alpha);\n#else\nvec4 finalColor=vec4(finalDiffuse*ambientColor*vLightingIntensity.x+surfaceAlbedo.rgb*environmentIrradiance+finalSpecular*vLightingIntensity.x+environmentRadiance+refractance,alpha);\n#endif\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV).rgb*vLightmapInfos.y;\n#ifdef USELIGHTMAPASSHADOWMAP\nfinalColor.rgb*=lightmapColor;\n#else\nfinalColor.rgb+=lightmapColor;\n#endif\n#endif\nfinalColor=max(finalColor,0.0);\n#ifdef CAMERATONEMAP\nfinalColor.rgb=toneMaps(finalColor.rgb);\n#endif\nfinalColor.rgb=toGammaSpace(finalColor.rgb);\n#include<logDepthFragment>\n#include<fogFragment>(color,finalColor)\n#ifdef CAMERACONTRAST\nfinalColor=contrasts(finalColor);\n#endif\nfinalColor.rgb=clamp(finalColor.rgb,0.,1.);\n#ifdef CAMERACOLORGRADING\nfinalColor=colorGrades(finalColor);\n#endif\n#ifdef CAMERACOLORCURVES\nfinalColor.rgb=applyColorCurves(finalColor.rgb);\n#endif\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ngl_FragColor=finalColor;\n}",
pbrVertexShader:"precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef ALBEDO\nvarying vec2 vAlbedoUV;\nuniform mat4 albedoMatrix;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(REFLECTIVITY)\nvarying vec2 vReflectivityUV;\nuniform vec2 vReflectivityInfos;\nuniform mat4 reflectivityMatrix;\n#endif\n#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<shadowsVertexDeclaration>[0..maxSimultaneousLights]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=position;\n#endif \n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvDirectionW=normalize(vec3(finalWorld*vec4(position,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef ALBEDO\nif (vAlbedoInfos.x == 0.)\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef AMBIENT\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef OPACITY\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef EMISSIVE\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef LIGHTMAP\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(REFLECTIVITY)\nif (vReflectivityInfos.x == 0.)\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef BUMP\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n\n#include<logDepthVertex>\n}",
postprocessVertexShader:"\nattribute vec2 position;\nuniform vec2 scale;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvUV=(position*madd+madd)*scale;\ngl_Position=vec4(position,0.0,1.0);\n}",proceduralVertexShader:"\nattribute vec2 position;\n\nvarying vec2 vPosition;\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvPosition=position;\nvUV=position*madd+madd;\ngl_Position=vec4(position,0.0,1.0);\n}",rect2dPixelShader:"varying vec4 vColor;\nvoid main(void) {\ngl_FragColor=vColor;\n}",
rect2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\nattribute float index;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\n#ifdef Border\natt float borderThickness;\n#endif\n#ifdef FillSolid\natt vec4 fillSolidColor;\n#endif\n#ifdef BorderSolid\natt vec4 borderSolidColor;\n#endif\n#ifdef FillGradient\natt vec4 fillGradientColor1;\natt vec4 fillGradientColor2;\natt vec4 fillGradientTY;\n#endif\n#ifdef BorderGradient\natt vec4 borderGradientColor1;\natt vec4 borderGradientColor2;\natt vec4 borderGradientTY;\n#endif\n\natt vec3 properties;\n\n#define rsub0 17.0\n#define rsub1 33.0\n#define rsub2 49.0\n#define rsub3 65.0\n#define rsub 64.0\n#define TWOPI 6.28318530\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\nvec2 pos2;\n\nif (properties.z == 0.0) {\n#ifdef Border\nfloat w=properties.x;\nfloat h=properties.y;\nvec2 borderOffset=vec2(1.0,1.0);\nfloat segi=index;\nif (index<4.0) {\nborderOffset=vec2(1.0-(borderThickness*2.0/w),1.0-(borderThickness*2.0/h));\n}\nelse {\nsegi-=4.0;\n}\nif (segi == 0.0) {\npos2=vec2(1.0,1.0);\n} \nelse if (segi == 1.0) {\npos2=vec2(1.0,0.0);\n}\nelse if (segi == 2.0) {\npos2=vec2(0.0,0.0);\n} \nelse {\npos2=vec2(0.0,1.0);\n}\npos2.x=((pos2.x-0.5)*borderOffset.x)+0.5;\npos2.y=((pos2.y-0.5)*borderOffset.y)+0.5;\n#else\nif (index == 0.0) {\npos2=vec2(0.5,0.5);\n}\nelse if (index == 1.0) {\npos2=vec2(1.0,1.0);\n}\nelse if (index == 2.0) {\npos2=vec2(1.0,0.0);\n}\nelse if (index == 3.0) {\npos2=vec2(0.0,0.0);\n}\nelse {\npos2=vec2(0.0,1.0);\n}\n#endif\n}\nelse\n{\n#ifdef Border\nfloat w=properties.x;\nfloat h=properties.y;\nfloat r=properties.z;\nfloat nru=r/w;\nfloat nrv=r/h;\nvec2 borderOffset=vec2(1.0,1.0);\nfloat segi=index;\nif (index<rsub) {\nborderOffset=vec2(1.0-(borderThickness*2.0/w),1.0-(borderThickness*2.0/h));\n}\nelse {\nsegi-=rsub;\n}\n\nif (segi<rsub0) {\npos2=vec2(1.0-nru,nrv);\n}\n\nelse if (segi<rsub1) {\npos2=vec2(nru,nrv);\n}\n\nelse if (segi<rsub2) {\npos2=vec2(nru,1.0-nrv);\n}\n\nelse {\npos2=vec2(1.0-nru,1.0-nrv);\n}\nfloat angle=TWOPI-((index-1.0)*TWOPI/(rsub-0.5));\npos2.x+=cos(angle)*nru;\npos2.y+=sin(angle)*nrv;\npos2.x=((pos2.x-0.5)*borderOffset.x)+0.5;\npos2.y=((pos2.y-0.5)*borderOffset.y)+0.5;\n#else\nif (index == 0.0) {\npos2=vec2(0.5,0.5);\n}\nelse {\nfloat w=properties.x;\nfloat h=properties.y;\nfloat r=properties.z;\nfloat nru=r/w;\nfloat nrv=r/h;\n\nif (index<rsub0) {\npos2=vec2(1.0-nru,nrv);\n}\n\nelse if (index<rsub1) {\npos2=vec2(nru,nrv);\n}\n\nelse if (index<rsub2) {\npos2=vec2(nru,1.0-nrv);\n}\n\nelse {\npos2=vec2(1.0-nru,1.0-nrv);\n}\nfloat angle=TWOPI-((index-1.0)*TWOPI/(rsub-0.5));\npos2.x+=cos(angle)*nru;\npos2.y+=sin(angle)*nrv;\n}\n#endif\n}\n#ifdef FillSolid\nvColor=fillSolidColor;\n#endif\n#ifdef BorderSolid\nvColor=borderSolidColor;\n#endif\n#ifdef FillGradient\nfloat v=dot(vec4(pos2.xy,1,1),fillGradientTY);\nvColor=mix(fillGradientColor2,fillGradientColor1,v); \n#endif\n#ifdef BorderGradient\nfloat v=dot(vec4(pos2.xy,1,1),borderGradientTY);\nvColor=mix(borderGradientColor2,borderGradientColor1,v); \n#endif\nvec4 pos;\npos.xy=pos2.xy*properties.xy;\npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n}",
refractionPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D refractionSampler;\n\nuniform vec3 baseColor;\nuniform float depth;\nuniform float colorLevel;\nvoid main() {\nfloat ref=1.0-texture2D(refractionSampler,vUV).r;\nvec2 uv=vUV-vec2(0.5);\nvec2 offset=uv*depth*ref;\nvec3 sourceColor=texture2D(textureSampler,vUV-offset).rgb;\ngl_FragColor=vec4(sourceColor+sourceColor*ref*colorLevel,1.0);\n}",shadowMapPixelShader:"vec4 pack(float depth)\n{\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(depth*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\n\nvec2 packHalf(float depth) \n{ \nconst vec2 bitOffset=vec2(1.0/255.,0.);\nvec2 color=vec2(depth,fract(depth*255.));\nreturn color-(color.yy*bitOffset);\n}\nvarying vec4 vPosition;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef CUBEMAP\nuniform vec3 lightPosition;\nuniform vec2 depthValues;\n#endif\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\n#ifdef CUBEMAP\nvec3 directionToLight=vPosition.xyz-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\n#else\nfloat depth=vPosition.z/vPosition.w;\ndepth=depth*0.5+0.5;\n#endif\n#ifdef VSM\nfloat moment1=depth;\nfloat moment2=moment1*moment1;\ngl_FragColor=vec4(packHalf(moment1),packHalf(moment2));\n#else\ngl_FragColor=pack(depth);\n#endif\n}",
shadowMapVertexShader:"\nattribute vec3 position;\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nvarying vec4 vPosition;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef CUBEMAP\nvPosition=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#else\nvPosition=viewProjection*finalWorld*vec4(position,1.0);\ngl_Position=vPosition;\n#endif\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}",
sprite2dPixelShader:"varying vec2 vUV;\nuniform sampler2D diffuseSampler;\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\nif (color.a == 0.05) {\ndiscard;\n}\ngl_FragColor=color;\n}",sprite2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\n\nattribute float index;\natt vec2 topLeftUV;\natt vec2 sizeUV;\natt vec2 textureSize;\n\natt vec3 properties;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\n\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\nvec2 pos2;\n\nvec2 off=vec2(0.0,0.0);\nfloat frame=properties.x;\nfloat invertY=properties.y;\nfloat alignToPixel=properties.z;\n\nif (index == 0.0) {\npos2=vec2(0.0,0.0);\nvUV=vec2(topLeftUV.x+(frame*sizeUV.x)+off.x,topLeftUV.y-off.y);\n}\n\nelse if (index == 1.0) {\npos2=vec2(0.0,1.0);\nvUV=vec2(topLeftUV.x+(frame*sizeUV.x)+off.x,(topLeftUV.y+sizeUV.y));\n}\n\nelse if (index == 2.0) {\npos2=vec2( 1.0,1.0);\nvUV=vec2(topLeftUV.x+sizeUV.x+(frame*sizeUV.x),(topLeftUV.y+sizeUV.y));\n}\n\nelse if (index == 3.0) {\npos2=vec2( 1.0,0.0);\nvUV=vec2(topLeftUV.x+sizeUV.x+(frame*sizeUV.x),topLeftUV.y-off.y);\n}\nif (invertY == 1.0) {\nvUV.y=1.0-vUV.y;\n}\nvec4 pos;\nif (alignToPixel == 1.0)\n{\npos.xy=floor(pos2.xy*sizeUV*textureSize);\n} else {\npos.xy=pos2.xy*sizeUV*textureSize;\n}\npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n} ",
spritesPixelShader:"uniform bool alphaTest;\nvarying vec4 vColor;\n\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\nif (alphaTest) \n{\nif (color.a<0.95)\ndiscard;\n}\ncolor*=vColor;\n#include<fogFragment>\ngl_FragColor=color;\n}",spritesVertexShader:"\nattribute vec4 position;\nattribute vec4 options;\nattribute vec4 cellInfo;\nattribute vec4 color;\n\nuniform vec2 textureInfos;\nuniform mat4 view;\nuniform mat4 projection;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#include<fogVertexDeclaration>\nvoid main(void) { \nvec3 viewPos=(view*vec4(position.xyz,1.0)).xyz; \nvec2 cornerPos;\nfloat angle=position.w;\nvec2 size=vec2(options.x,options.y);\nvec2 offset=options.zw;\nvec2 uvScale=textureInfos.xy;\ncornerPos=vec2(offset.x-0.5,offset.y-0.5)*size;\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nviewPos+=rotatedCorner;\ngl_Position=projection*vec4(viewPos,1.0); \n\nvColor=color;\n\nvec2 uvOffset=vec2(abs(offset.x-cellInfo.x),1.0-abs(offset.y-cellInfo.y));\nvUV=(uvOffset+cellInfo.zw)*uvScale;\n\n#ifdef FOG\nfFogDistance=viewPos.z;\n#endif\n}",
ssaoPixelShader:"\nuniform sampler2D textureSampler;\nvarying vec2 vUV;\n#ifdef SSAO\nuniform sampler2D randomSampler;\nuniform float randTextureTiles;\nuniform float samplesFactor;\nuniform vec3 sampleSphere[SAMPLES];\nuniform float totalStrength;\nuniform float radius;\nuniform float area;\nuniform float fallOff;\nuniform float base;\nvec3 normalFromDepth(float depth,vec2 coords)\n{\nvec2 offset1=vec2(0.0,radius);\nvec2 offset2=vec2(radius,0.0);\nfloat depth1=texture2D(textureSampler,coords+offset1).r;\nfloat depth2=texture2D(textureSampler,coords+offset2).r;\nvec3 p1=vec3(offset1,depth1-depth);\nvec3 p2=vec3(offset2,depth2-depth);\nvec3 normal=cross(p1,p2);\nnormal.z=-normal.z;\nreturn normalize(normal);\n}\nvoid main()\n{\nvec3 random=normalize(texture2D(randomSampler,vUV*randTextureTiles).rgb);\nfloat depth=texture2D(textureSampler,vUV).r;\nvec3 position=vec3(vUV,depth);\nvec3 normal=normalFromDepth(depth,vUV);\nfloat radiusDepth=radius/depth;\nfloat occlusion=0.0;\nvec3 ray;\nvec3 hemiRay;\nfloat occlusionDepth;\nfloat difference;\nfor (int i=0; i<SAMPLES; i++)\n{\nray=radiusDepth*reflect(sampleSphere[i],random);\nhemiRay=position+sign(dot(ray,normal))*ray;\nocclusionDepth=texture2D(textureSampler,clamp(hemiRay.xy,vec2(0.001,0.001),vec2(0.999,0.999))).r;\ndifference=depth-occlusionDepth;\nocclusion+=step(fallOff,difference)*(1.0-smoothstep(fallOff,area,difference));\n}\nfloat ao=1.0-totalStrength*occlusion*samplesFactor;\nfloat result=clamp(ao+base,0.0,1.0);\ngl_FragColor.r=result;\ngl_FragColor.g=result;\ngl_FragColor.b=result;\ngl_FragColor.a=1.0;\n}\n#endif\n#ifdef BILATERAL_BLUR\nuniform sampler2D depthSampler;\nuniform float outSize;\nuniform float samplerOffsets[SAMPLES];\nvoid main()\n{\nfloat texelsize=1.0/outSize;\nfloat compareDepth=texture2D(depthSampler,vUV).r;\nfloat result=0.0;\nfloat weightSum=0.0;\nfor (int i=0; i<SAMPLES; ++i)\n{\n#ifdef BILATERAL_BLUR_H\nvec2 sampleOffset=vec2(texelsize*samplerOffsets[i],0.0);\n#else\nvec2 sampleOffset=vec2(0.0,texelsize*samplerOffsets[i]);\n#endif\nvec2 samplePos=vUV+sampleOffset;\nfloat sampleDepth=texture2D(depthSampler,samplePos).r;\nfloat weight=(1.0/(0.0001+abs(compareDepth-sampleDepth)));\nresult+=texture2D(textureSampler,samplePos).r*weight;\nweightSum+=weight;\n}\nresult/=weightSum;\ngl_FragColor.rgb=vec3(result);\ngl_FragColor.a=1.0;\n}\n#endif\n",
ssaoCombinePixelShader:"uniform sampler2D textureSampler;\nuniform sampler2D originalColor;\nvarying vec2 vUV;\nvoid main(void) {\nvec4 ssaoColor=texture2D(textureSampler,vUV);\nvec4 sceneColor=texture2D(originalColor,vUV);\ngl_FragColor=sceneColor*ssaoColor;\n}\n",stereoscopicInterlacePixelShader:"const vec3 TWO=vec3(2.0,2.0,2.0);\nvarying vec2 vUV;\nuniform sampler2D camASampler;\nuniform sampler2D textureSampler;\nuniform vec2 stepSize;\nvoid main(void)\n{\nbool useCamB;\nvec2 texCoord1;\nvec2 texCoord2;\nvec3 frag1;\nvec3 frag2;\n#ifdef IS_STEREOSCOPIC_HORIZ\nuseCamB=vUV.x>0.5;\ntexCoord1=vec2(useCamB ? (vUV.x-0.5)*2.0 : vUV.x*2.0,vUV.y);\ntexCoord2=vec2(texCoord1.x+stepSize.x,vUV.y);\n#else\nuseCamB=vUV.y>0.5;\ntexCoord1=vec2(vUV.x,useCamB ? (vUV.y-0.5)*2.0 : vUV.y*2.0);\ntexCoord2=vec2(vUV.x,texCoord1.y+stepSize.y);\n#endif\n\nif (useCamB){\nfrag1=texture2D(textureSampler,texCoord1).rgb;\nfrag2=texture2D(textureSampler,texCoord2).rgb;\n}else{\nfrag1=texture2D(camASampler ,texCoord1).rgb;\nfrag2=texture2D(camASampler ,texCoord2).rgb;\n}\ngl_FragColor=vec4((frag1+frag2)/TWO,1.0);\n}",
text2dPixelShader:"varying vec4 vColor;\nvarying vec2 vUV;\n\nuniform sampler2D diffuseSampler;\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\nif (color.a<0.05)\ndiscard;\ngl_FragColor=color*vColor;\n}",text2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\n\nattribute float index;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\natt vec2 topLeftUV;\natt vec2 sizeUV;\natt vec2 textureSize;\natt vec4 color;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\nvec2 pos2;\n\nif (index == 0.0) {\npos2=vec2(0.0,0.0);\nvUV=vec2(topLeftUV.x,topLeftUV.y+sizeUV.y);\n}\n\nelse if (index == 1.0) {\npos2=vec2(0.0,1.0);\nvUV=vec2(topLeftUV.x,topLeftUV.y);\n}\n\nelse if (index == 2.0) {\npos2=vec2(1.0,1.0);\nvUV=vec2(topLeftUV.x+sizeUV.x,topLeftUV.y);\n}\n\nelse if (index == 3.0) {\npos2=vec2(1.0,0.0);\nvUV=vec2(topLeftUV.x+sizeUV.x,topLeftUV.y+sizeUV.y);\n}\n\nvUV=(floor(vUV*textureSize)+vec2(0.0,0.0))/textureSize;\nvColor=color;\nvec4 pos;\npos.xy=floor(pos2.xy*sizeUV*textureSize); \npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n}",
tonemapPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform float _ExposureAdjustment;\n#if defined(HABLE_TONEMAPPING)\nconst float A=0.15;\nconst float B=0.50;\nconst float C=0.10;\nconst float D=0.20;\nconst float E=0.02;\nconst float F=0.30;\nconst float W=11.2;\n#endif\nfloat Luminance(vec3 c)\n{\nreturn dot(c,vec3(0.22,0.707,0.071));\n}\nvoid main(void) \n{\nvec3 colour=texture2D(textureSampler,vUV).rgb;\n#if defined(REINHARD_TONEMAPPING)\nfloat lum=Luminance(colour.rgb); \nfloat lumTm=lum*_ExposureAdjustment;\nfloat scale=lumTm/(1.0+lumTm); \ncolour*=scale/lum;\n#elif defined(HABLE_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nconst float ExposureBias=2.0;\nvec3 x=ExposureBias*colour;\nvec3 curr=((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\nx=vec3(W,W,W);\nvec3 whiteScale=1.0/(((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F);\ncolour=curr*whiteScale;\n#elif defined(OPTIMIZED_HEJIDAWSON_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nvec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);\nvec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);\ncolour=retColor*retColor;\n#elif defined(PHOTOGRAPHIC_TONEMAPPING)\ncolour=vec3(1.0,1.0,1.0)-exp2(-_ExposureAdjustment*colour);\n#endif\ngl_FragColor=vec4(colour.rgb,1.0);\n}",
volumetricLightScatteringPixelShader:"uniform sampler2D textureSampler;\nuniform sampler2D lightScatteringSampler;\nuniform float decay;\nuniform float exposure;\nuniform float weight;\nuniform float density;\nuniform vec2 meshPositionOnScreen;\nvarying vec2 vUV;\nvoid main(void) {\nvec2 tc=vUV;\nvec2 deltaTexCoord=(tc-meshPositionOnScreen.xy);\ndeltaTexCoord*=1.0/float(NUM_SAMPLES)*density;\nfloat illuminationDecay=1.0;\nvec4 color=texture2D(lightScatteringSampler,tc)*0.4;\nfor(int i=0; i<NUM_SAMPLES; i++) {\ntc-=deltaTexCoord;\nvec4 sample=texture2D(lightScatteringSampler,tc)*0.4;\nsample*=illuminationDecay*weight;\ncolor+=sample;\nilluminationDecay*=decay;\n}\nvec4 realColor=texture2D(textureSampler,vUV);\ngl_FragColor=((vec4((vec3(color.r,color.g,color.b)*exposure),1))+(realColor*(1.5-0.4)));\n}\n",
volumetricLightScatteringPassPixelShader:"#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\n#endif\n#if defined(ALPHATEST)\nuniform sampler2D diffuseSampler;\n#endif\nvoid main(void)\n{\n#if defined(ALPHATEST)\nvec4 diffuseColor=texture2D(diffuseSampler,vUV);\nif (diffuseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\n}\n",vrDistortionCorrectionPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 LensCenter;\nuniform vec2 Scale;\nuniform vec2 ScaleIn;\nuniform vec4 HmdWarpParam;\nvec2 HmdWarp(vec2 in01) {\nvec2 theta=(in01-LensCenter)*ScaleIn; \nfloat rSq=theta.x*theta.x+theta.y*theta.y;\nvec2 rvector=theta*(HmdWarpParam.x+HmdWarpParam.y*rSq+HmdWarpParam.z*rSq*rSq+HmdWarpParam.w*rSq*rSq*rSq);\nreturn LensCenter+Scale*rvector;\n}\nvoid main(void)\n{\nvec2 tc=HmdWarp(vUV);\nif (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\nelse{\ngl_FragColor=vec4(texture2D(textureSampler,tc).rgb,1.0);\n}\n}"};
BABYLON.Effect.IncludesShadersStore={bonesDeclaration:"#if NUM_BONE_INFLUENCERS>0\nuniform mat4 mBones[BonesPerMesh];\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;\nattribute vec4 matricesWeightsExtra;\n#endif\n#endif",bonesVertex:"#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif \n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif \n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif \n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif \n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif \n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif \n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif \nfinalWorld=finalWorld*influence;\n#endif",
bumpFragment:"#ifdef BUMP\nvec2 bumpUV=vBumpUV;\n#endif\n#if defined(BUMP) || defined(PARALLAX)\nmat3 TBN=cotangent_frame(normalW*vBumpInfos.y,-viewDirectionW,bumpUV);\n#endif\n#ifdef PARALLAX\nmat3 invTBN=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nvec2 uvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,bumpUV,vBumpInfos.z);\n#else\nvec2 uvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);\n#endif\ndiffuseUV+=uvOffset;\nbumpUV+=uvOffset;\n#endif\n#ifdef BUMP\nnormalW=perturbNormal(viewDirectionW,TBN,bumpUV);\n#endif",
bumpFragmentFunctions:"#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec3 vBumpInfos;\nuniform sampler2D bumpSampler;\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)\n{\n\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\n\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 binormal=dp2perp*duv1.y+dp1perp*duv2.y;\n\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(binormal,binormal)));\nreturn mat3(tangent*invmax,binormal*invmax,normal);\n}\nvec3 perturbNormal(vec3 viewDir,mat3 cotangentFrame,vec2 uv)\n{\nvec3 map=texture2D(bumpSampler,uv).xyz;\n#ifdef INVERTNORMALMAPX\nmap.x=1.0-map.x;\n#endif\n#ifdef INVERTNORMALMAPY\nmap.y=1.0-map.y;\n#endif\nmap=map*255./127.-128./127.;\nreturn normalize(cotangentFrame*map);\n}\n#ifdef PARALLAX\nconst float minSamples=4.;\nconst float maxSamples=15.;\nconst int iMaxSamples=15;\n\nvec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {\nfloat parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;\nparallaxLimit*=parallaxScale;\nvec2 vOffsetDir=normalize(vViewDirCoT.xy);\nvec2 vMaxOffset=vOffsetDir*parallaxLimit;\nfloat numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));\nfloat stepSize=1.0/numSamples;\n\nfloat currRayHeight=1.0;\nvec2 vCurrOffset=vec2(0,0);\nvec2 vLastOffset=vec2(0,0);\nfloat lastSampledHeight=1.0;\nfloat currSampledHeight=1.0;\nfor (int i=0; i<iMaxSamples; i++)\n{\ncurrSampledHeight=texture2D(bumpSampler,vBumpUV+vCurrOffset).w;\n\nif (currSampledHeight>currRayHeight)\n{\nfloat delta1=currSampledHeight-currRayHeight;\nfloat delta2=(currRayHeight+stepSize)-lastSampledHeight;\nfloat ratio=delta1/(delta1+delta2);\nvCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;\n\nbreak;\n}\nelse\n{\ncurrRayHeight-=stepSize;\nvLastOffset=vCurrOffset;\nvCurrOffset+=stepSize*vMaxOffset;\nlastSampledHeight=currSampledHeight;\n}\n}\nreturn vCurrOffset;\n}\nvec2 parallaxOffset(vec3 viewDir,float heightScale)\n{\n\nfloat height=texture2D(bumpSampler,vBumpUV).w;\nvec2 texCoordOffset=heightScale*viewDir.xy*height;\nreturn -texCoordOffset;\n}\n#endif\n#endif",
clipPlaneFragment:"#ifdef CLIPPLANE\nif (fClipDistance>0.0)\n{\ndiscard;\n}\n#endif",clipPlaneFragmentDeclaration:"#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif",clipPlaneVertex:"#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif",clipPlaneVertexDeclaration:"#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif",colorCurves:"const vec3 HDTVRec709_RGBLuminanceCoefficients=vec3(0.2126,0.7152,0.0722);\nvec3 applyColorCurves(vec3 original) {\nvec3 result=original;\n\n\n\nfloat luma=dot(result.rgb,HDTVRec709_RGBLuminanceCoefficients);\nvec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0,0.0),vec2(1.0,1.0));\nvec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;\nresult.rgb*=colorCurve.rgb;\nresult.rgb=mix(vec3(luma,luma,luma),result.rgb,colorCurve.a);\nreturn result;\n}",
colorCurvesDefinition:"uniform vec4 vCameraColorCurveNeutral;\nuniform vec4 vCameraColorCurvePositive;\nuniform vec4 vCameraColorCurveNegative;",colorGrading:"vec4 colorGrades(vec4 color) \n{ \n\nfloat sliceContinuous=color.z*vCameraColorGradingInfos.z;\nfloat sliceInteger=floor(sliceContinuous);\n\n\nfloat sliceFraction=sliceContinuous-sliceInteger; \n\nvec2 sliceUV=color.xy*vCameraColorGradingScaleOffset.xy+vCameraColorGradingScaleOffset.zw;\n\n\nsliceUV.x+=sliceInteger*vCameraColorGradingInfos.w;\nvec4 slice0Color=texture2D(cameraColorGrading2DSampler,sliceUV);\nsliceUV.x+=vCameraColorGradingInfos.w;\nvec4 slice1Color=texture2D(cameraColorGrading2DSampler,sliceUV);\nvec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\ncolor.rgb=mix(color.rgb,result,vCameraColorGradingInfos.x);\nreturn color;\n}",
colorGradingDefinition:"uniform sampler2D cameraColorGrading2DSampler;\nuniform vec4 vCameraColorGradingInfos;\nuniform vec4 vCameraColorGradingScaleOffset;",fogFragment:"#ifdef FOG\nfloat fog=CalcFogFactor();\ncolor.rgb=fog*color.rgb+(1.0-fog)*vFogColor;\n#endif",fogFragmentDeclaration:"#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying float fFogDistance;\nfloat CalcFogFactor()\n{\nfloat fogCoeff=1.0;\nfloat fogStart=vFogInfos.y;\nfloat fogEnd=vFogInfos.z;\nfloat fogDensity=vFogInfos.w;\nif (FOGMODE_LINEAR == vFogInfos.x)\n{\nfogCoeff=(fogEnd-fFogDistance)/(fogEnd-fogStart);\n}\nelse if (FOGMODE_EXP == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fFogDistance*fogDensity);\n}\nelse if (FOGMODE_EXP2 == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fFogDistance*fFogDistance*fogDensity*fogDensity);\n}\nreturn clamp(fogCoeff,0.0,1.0);\n}\n#endif",
fogVertex:"#ifdef FOG\nfFogDistance=(view*worldPos).z;\n#endif",fogVertexDeclaration:"#ifdef FOG\nvarying float fFogDistance;\n#endif",fresnelFunction:"#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)\n{\nfloat fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);\nreturn clamp(fresnelTerm,0.,1.);\n}\n#endif",harmonicsFunctions:"#ifdef USESPHERICALFROMREFLECTIONMAP\nuniform vec3 vSphericalX;\nuniform vec3 vSphericalY;\nuniform vec3 vSphericalZ;\nuniform vec3 vSphericalXX;\nuniform vec3 vSphericalYY;\nuniform vec3 vSphericalZZ;\nuniform vec3 vSphericalXY;\nuniform vec3 vSphericalYZ;\nuniform vec3 vSphericalZX;\nvec3 EnvironmentIrradiance(vec3 normal)\n{\n\n\n\nvec3 result =\nvSphericalX*normal.x +\nvSphericalY*normal.y +\nvSphericalZ*normal.z +\nvSphericalXX*normal.x*normal.x +\nvSphericalYY*normal.y*normal.y +\nvSphericalZZ*normal.z*normal.z +\nvSphericalYZ*normal.y*normal.z +\nvSphericalZX*normal.z*normal.x +\nvSphericalXY*normal.x*normal.y;\nreturn result.rgb;\n}\n#endif",
helperFunctions:"mat3 transposeMat3(mat3 inMatrix) {\nvec3 i0=inMatrix[0];\nvec3 i1=inMatrix[1];\nvec3 i2=inMatrix[2];\nmat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);\nreturn outMatrix;\n}",instancesDeclaration:"#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#else\nuniform mat4 world;\n#endif",instancesVertex:"#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#else\nmat4 finalWorld=world;\n#endif",
lightFragment:"#ifdef LIGHT{X}\n#ifndef SPECULARTERM\nvec3 vLightSpecular{X}=vec3(0.);\n#endif\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,vLightData{X},vLightDirection{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,glossiness);\n#endif\n#ifdef HEMILIGHT{X}\ninfo=computeHemisphericLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightGround{X},glossiness);\n#endif\n#if defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,glossiness);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWVSM{X}\nshadow=computeShadowWithVSM(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\n#ifdef SHADOWPCF{X}\n#if defined(POINTLIGHT{X})\nshadow=computeShadowWithPCFCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\nshadow=computeShadowWithPCF(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#endif\n#else\n#if defined(POINTLIGHT{X})\nshadow=computeShadowCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#else\nshadow=computeShadow(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#endif\n#endif\n#endif\n#else\nshadow=1.;\n#endif\ndiffuseBase+=info.diffuse*shadow;\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#endif",
lightFragmentDeclaration:"#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec3 vLightSpecular{X};\n#endif\n#ifdef SHADOW{X}\n#if defined(SPOTLIGHT{X}) || defined(DIRLIGHT{X})\nvarying vec4 vPositionFromLight{X};\nuniform sampler2D shadowSampler{X};\n#else\nuniform samplerCube shadowSampler{X};\n#endif\nuniform vec3 shadowsInfo{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\n#endif\n#ifdef HEMILIGHT{X}\nuniform vec3 vLightGround{X};\n#endif\n#endif",
lightsFragmentFunctions:"\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n};\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 lightVectorW;\nfloat attenuation=1.0;\nif (lightData.w == 0.)\n{\nvec3 direction=lightData.xyz-vPositionW;\nattenuation=max(0.,1.0-length(direction)/range);\nlightVectorW=normalize(direction);\n}\nelse\n{\nlightVectorW=normalize(-lightData.xyz);\n}\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 direction=lightData.xyz-vPositionW;\nvec3 lightVectorW=normalize(direction);\nfloat attenuation=max(0.,1.0-length(direction)/range);\n\nfloat cosAngle=max(0.,dot(-lightDirection.xyz,lightVectorW));\nif (cosAngle>=lightDirection.w)\n{\ncosAngle=max(0.,pow(cosAngle,lightData.w));\nattenuation*=cosAngle;\n\nfloat ndl=max(0.,dot(vNormal,-lightDirection.xyz));\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW-lightDirection.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nresult.diffuse=vec3(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3(0.);\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {\nlightingInfo result;\n\nfloat ndl=dot(vNormal,lightData.xyz)*0.5+0.5;\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightData.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor;\n#endif\nreturn result;\n}\n",
logDepthDeclaration:"#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;\nvarying float vFragmentDepth;\n#endif",logDepthFragment:"#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif",logDepthVertex:"#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;\ngl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif",pbrFunctions:"\n#define RECIPROCAL_PI2 0.15915494\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n\nconst float kPi=3.1415926535897932384626433832795;\nconst float kRougnhessToAlphaScale=0.1;\nconst float kRougnhessToAlphaOffset=0.29248125;\nfloat Square(float value)\n{\nreturn value*value;\n}\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,vec3(0.2126,0.7152,0.0722)),0.,1.);\n}\nfloat convertRoughnessToAverageSlope(float roughness)\n{\n\nconst float kMinimumVariance=0.0005;\nfloat alphaG=Square(roughness)+kMinimumVariance;\nreturn alphaG;\n}\n\nfloat getMipMapIndexFromAverageSlope(float maxMipLevel,float alpha)\n{\n\n\n\n\n\n\n\nfloat mip=kRougnhessToAlphaOffset+maxMipLevel+(maxMipLevel*kRougnhessToAlphaScale*log2(alpha));\nreturn clamp(mip,0.,maxMipLevel);\n}\nfloat getMipMapIndexFromAverageSlopeWithPMREM(float maxMipLevel,float alphaG)\n{\nfloat specularPower=clamp(2./alphaG-2.,0.000001,2048.);\n\nreturn clamp(- 0.5*log2(specularPower)+5.5,0.,maxMipLevel);\n}\n\nfloat smithVisibilityG1_TrowbridgeReitzGGX(float dot,float alphaG)\n{\nfloat tanSquared=(1.0-dot*dot)/(dot*dot);\nreturn 2.0/(1.0+sqrt(1.0+alphaG*alphaG*tanSquared));\n}\nfloat smithVisibilityG_TrowbridgeReitzGGX_Walter(float NdotL,float NdotV,float alphaG)\n{\nreturn smithVisibilityG1_TrowbridgeReitzGGX(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGX(NdotV,alphaG);\n}\n\n\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)\n{\n\n\n\nfloat a2=Square(alphaG);\nfloat d=NdotH*NdotH*(a2-1.0)+1.0;\nreturn a2/(kPi*d*d);\n}\nvec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow(clamp(1.0-VdotH,0.,1.),5.0);\n}\nvec3 FresnelSchlickEnvironmentGGX(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\n\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow(clamp(1.0-VdotN,0.,1.),5.0);\n}\n\nvec3 computeSpecularTerm(float NdotH,float NdotL,float NdotV,float VdotH,float roughness,vec3 specularColor,vec3 reflectance90)\n{\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);\nfloat visibility=smithVisibilityG_TrowbridgeReitzGGX_Walter(NdotL,NdotV,alphaG);\nvisibility/=(4.0*NdotL*NdotV); \nvec3 fresnel=fresnelSchlickGGX(VdotH,specularColor,reflectance90);\nfloat specTerm=max(0.,visibility*distribution)*NdotL;\nreturn fresnel*specTerm*kPi; \n}\nfloat computeDiffuseTerm(float NdotL,float NdotV,float VdotH,float roughness)\n{\n\n\nfloat diffuseFresnelNV=pow(clamp(1.0-NdotL,0.000001,1.),5.0);\nfloat diffuseFresnelNL=pow(clamp(1.0-NdotV,0.000001,1.),5.0);\nfloat diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;\nfloat diffuseFresnelTerm =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);\nreturn diffuseFresnelTerm*NdotL;\n\n\n}\nfloat adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\n\nfloat lightRoughness=lightRadius/lightDistance;\n\nfloat totalRoughness=clamp(lightRoughness+roughness,0.,1.);\nreturn totalRoughness;\n#else\nreturn roughness;\n#endif\n}\nfloat computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)\n{\nfloat kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;\nfloat reflectivityLuminance=getLuminance(reflectivityColor);\nfloat reflectivityLuma=sqrt(reflectivityLuminance);\nmicroSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;\nreturn microSurface;\n}\nvec3 toLinearSpace(vec3 color)\n{\nreturn vec3(pow(color.r,2.2),pow(color.g,2.2),pow(color.b,2.2));\n}\nvec3 toGammaSpace(vec3 color)\n{\nreturn vec3(pow(color.r,1.0/2.2),pow(color.g,1.0/2.2),pow(color.b,1.0/2.2));\n}\n#ifdef CAMERATONEMAP\nvec3 toneMaps(vec3 color)\n{\ncolor=max(color,0.0);\n\ncolor.rgb=color.rgb*vCameraInfos.x;\nfloat tuning=1.5; \n\n\nvec3 tonemapped=1.0-exp2(-color.rgb*tuning); \ncolor.rgb=mix(color.rgb,tonemapped,1.0);\nreturn color;\n}\n#endif\n#ifdef CAMERACONTRAST\nvec4 contrasts(vec4 color)\n{\ncolor=clamp(color,0.0,1.0);\nvec3 resultHighContrast=color.rgb*color.rgb*(3.0-2.0*color.rgb);\nfloat contrast=vCameraInfos.y;\nif (contrast<1.0)\n{\n\ncolor.rgb=mix(vec3(0.5,0.5,0.5),color.rgb,contrast);\n}\nelse\n{\n\ncolor.rgb=mix(color.rgb,resultHighContrast,contrast-1.0);\n}\nreturn color;\n}\n#endif",
pbrLightFunctions:"\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n};\nfloat computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range)\n{ \n#ifdef USEPHYSICALLIGHTFALLOFF\nfloat lightDistanceFalloff=1.0/((lightDistanceSquared+0.0001));\n#else\nfloat lightDistanceFalloff=max(0.,1.0-length(lightOffset)/range);\n#endif\nreturn lightDistanceFalloff;\n}\nfloat computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngle,float exponent)\n{\nfloat falloff=0.0;\n#ifdef USEPHYSICALLIGHTFALLOFF\nfloat cosHalfAngle=cos(lightAngle*0.5);\nconst float kMinusLog2ConeAngleIntensityRatio=6.64385618977; \n\n\n\n\n\nfloat concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);\n\n\nvec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);\nfalloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));\n#else\nfloat cosAngle=max(0.000000000000001,dot(-lightDirection,directionToLightCenterW));\nif (cosAngle>=lightAngle)\n{\nfalloff=max(0.,pow(cosAngle,exponent));\n}\n#endif\nreturn falloff;\n}\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float rangeRadius,float roughness,float NdotV,vec3 reflectance90,out float NdotL) {\nlightingInfo result;\nvec3 lightDirection;\nfloat attenuation=1.0;\nfloat lightDistance;\n\nif (lightData.w == 0.)\n{\nvec3 lightOffset=lightData.xyz-vPositionW;\nfloat lightDistanceSquared=dot(lightOffset,lightOffset);\nattenuation=computeDistanceLightFalloff(lightOffset,lightDistanceSquared,rangeRadius);\nlightDistance=sqrt(lightDistanceSquared);\nlightDirection=normalize(lightOffset);\n}\n\nelse\n{\nlightDistance=length(-lightData.xyz);\nlightDirection=normalize(-lightData.xyz);\n}\n\nroughness=adjustRoughnessFromLightProperties(roughness,rangeRadius,lightDistance);\n\nvec3 H=normalize(viewDirectionW+lightDirection);\nNdotL=max(0.00000000001,dot(vNormal,lightDirection));\nfloat VdotH=clamp(0.00000000001,1.0,dot(viewDirectionW,H));\nfloat diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);\nresult.diffuse=diffuseTerm*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nfloat NdotH=max(0.00000000001,dot(vNormal,H));\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,specularColor,reflectance90);\nresult.specular=specTerm*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float rangeRadius,float roughness,float NdotV,vec3 reflectance90,out float NdotL) {\nlightingInfo result;\nvec3 lightOffset=lightData.xyz-vPositionW;\nvec3 directionToLightCenterW=normalize(lightOffset);\n\nfloat lightDistanceSquared=dot(lightOffset,lightOffset);\nfloat attenuation=computeDistanceLightFalloff(lightOffset,lightDistanceSquared,rangeRadius);\n\nfloat directionalAttenuation=computeDirectionalLightFalloff(lightDirection.xyz,directionToLightCenterW,lightDirection.w,lightData.w);\nattenuation*=directionalAttenuation;\n\nfloat lightDistance=sqrt(lightDistanceSquared);\nroughness=adjustRoughnessFromLightProperties(roughness,rangeRadius,lightDistance);\n\nvec3 H=normalize(viewDirectionW-lightDirection.xyz);\nNdotL=max(0.00000000001,dot(vNormal,-lightDirection.xyz));\nfloat VdotH=clamp(dot(viewDirectionW,H),0.00000000001,1.0);\nfloat diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);\nresult.diffuse=diffuseTerm*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nfloat NdotH=max(0.00000000001,dot(vNormal,H));\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,specularColor,reflectance90);\nresult.specular=specTerm*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float roughness,float NdotV,vec3 reflectance90,out float NdotL) {\nlightingInfo result;\n\n\n\nNdotL=dot(vNormal,lightData.xyz)*0.5+0.5;\nresult.diffuse=mix(groundColor,diffuseColor,NdotL);\n#ifdef SPECULARTERM\n\nvec3 lightVectorW=normalize(lightData.xyz);\nvec3 H=normalize(viewDirectionW+lightVectorW);\nfloat NdotH=max(0.00000000001,dot(vNormal,H));\nNdotL=max(0.00000000001,NdotL);\nfloat VdotH=clamp(0.00000000001,1.0,dot(viewDirectionW,H));\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,specularColor,reflectance90);\nresult.specular=specTerm;\n#endif\nreturn result;\n}",
pbrLightFunctionsCall:"#ifdef LIGHT{X}\n#ifndef SPECULARTERM\nvec3 vLightSpecular{X}=vec3(0.0);\n#endif\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,vLightData{X},vLightDirection{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,roughness,NdotV,specularEnvironmentR90,NdotL);\n#endif\n#ifdef HEMILIGHT{X}\ninfo=computeHemisphericLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightGround{X},roughness,NdotV,specularEnvironmentR90,NdotL);\n#endif\n#if defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,roughness,NdotV,specularEnvironmentR90,NdotL);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWVSM{X}\nnotShadowLevel=computeShadowWithVSM(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\n#ifdef SHADOWPCF{X}\n#if defined(POINTLIGHT{X})\nnotShadowLevel=computeShadowWithPCFCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\nnotShadowLevel=computeShadowWithPCF(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#endif\n#else\n#if defined(POINTLIGHT{X})\nnotShadowLevel=computeShadowCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#else\nnotShadowLevel=computeShadow(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#endif\n#endif\n#endif\n#else\nnotShadowLevel=1.;\n#endif\nlightDiffuseContribution+=info.diffuse*notShadowLevel;\n#ifdef OVERLOADEDSHADOWVALUES\nif (NdotL<0.000000000011)\n{\nnotShadowLevel=1.;\n}\nshadowedOnlyLightDiffuseContribution*=notShadowLevel;\n#endif\n#ifdef SPECULARTERM\nlightSpecularContribution+=info.specular*notShadowLevel;\n#endif\n#endif",
pbrShadowFunctions:"\n#ifdef SHADOWS\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\nuniform vec2 depthValues;\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float bias)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y =-directionToLight.y;\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight))+bias;\nif (depth>shadow)\n{\n#ifdef OVERLOADEDSHADOWVALUES\nreturn mix(1.0,darkness,vOverloadedShadowIntensity.x);\n#else\nreturn darkness;\n#endif\n}\nreturn 1.0;\n}\nfloat computeShadowWithPCFCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n\nfloat biasedDepth=depth-bias;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\n#ifdef OVERLOADEDSHADOWVALUES\nreturn min(1.0,mix(1.0,visibility+darkness,vOverloadedShadowIntensity.x));\n#else\nreturn min(1.0,visibility+darkness);\n#endif\n}\nfloat computeShadow(vec4 vPositionFromLight,sampler2D shadowSampler,float darkness,float bias)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadow=unpack(texture2D(shadowSampler,uv))+bias;\nif (depth.z>shadow)\n{\n#ifdef OVERLOADEDSHADOWVALUES\nreturn mix(1.0,darkness,vOverloadedShadowIntensity.x);\n#else\nreturn darkness;\n#endif\n}\nreturn 1.;\n}\nfloat computeShadowWithPCF(vec4 vPositionFromLight,sampler2D shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\nfloat biasedDepth=depth.z-bias;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\n#ifdef OVERLOADEDSHADOWVALUES\nreturn min(1.0,mix(1.0,visibility+darkness,vOverloadedShadowIntensity.x));\n#else\nreturn min(1.0,visibility+darkness);\n#endif\n}\n\nfloat unpackHalf(vec2 color)\n{\nreturn color.x+(color.y/255.0);\n}\nfloat linstep(float low,float high,float v) {\nreturn clamp((v-low)/(high-low),0.0,1.0);\n}\nfloat ChebychevInequality(vec2 moments,float compare,float bias)\n{\nfloat p=smoothstep(compare-bias,compare,moments.x);\nfloat variance=max(moments.y-moments.x*moments.x,0.02);\nfloat d=compare-moments.x;\nfloat p_max=linstep(0.2,1.0,variance/(variance+d*d));\nreturn clamp(max(p,p_max),0.0,1.0);\n}\nfloat computeShadowWithVSM(vec4 vPositionFromLight,sampler2D shadowSampler,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0 || depth.z>=1.0)\n{\nreturn 1.0;\n}\nvec4 texel=texture2D(shadowSampler,uv);\nvec2 moments=vec2(unpackHalf(texel.xy),unpackHalf(texel.zw));\n#ifdef OVERLOADEDSHADOWVALUES\nreturn min(1.0,mix(1.0,1.0-ChebychevInequality(moments,depth.z,bias)+darkness,vOverloadedShadowIntensity.x));\n#else\nreturn min(1.0,1.0-ChebychevInequality(moments,depth.z,bias)+darkness);\n#endif\n}\n#endif",
pointCloudVertex:"#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif",pointCloudVertexDeclaration:"#ifdef POINTSIZE\nuniform float pointSize;\n#endif",reflectionFunction:"vec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);\nfloat t=clamp(direction.y*-0.5+0.5,0.,1.0);\nfloat s=atan(direction.z,direction.x)*RECIPROCAL_PI2+0.5;\nreturn vec3(s,t,0);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nvec3 cameraToVertex=normalize(worldPos.xyz-vEyePosition);\nvec3 r=reflect(cameraToVertex,worldNormal);\nfloat t=clamp(r.y*-0.5+0.5,0.,1.0);\nfloat s=atan(r.z,r.x)*RECIPROCAL_PI2+0.5;\nreturn vec3(s,t,0);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nvec3 viewDir=normalize(vec3(view*worldPos));\nvec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));\nvec3 r=reflect(viewDir,viewNormal);\nr.z=r.z-1.0;\nfloat m=2.0*length(r);\nreturn vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nvec3 viewDir=worldPos.xyz-vEyePosition;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n#endif\n#ifdef REFLECTIONMAP_CUBIC\nvec3 viewDir=worldPos.xyz-vEyePosition;\nvec3 coords=reflect(viewDir,worldNormal);\n#ifdef INVERTCUBICMAP\ncoords.y=1.0-coords.y;\n#endif\nreturn vec3(reflectionMatrix*vec4(coords,0));\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn vec3(reflectionMatrix*(view*worldPos));\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn vPositionUVW;\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}",
shadowsFragmentFunctions:"#ifdef SHADOWS\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\nuniform vec2 depthValues;\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float bias)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight))+bias;\nif (depth>shadow)\n{\nreturn darkness;\n}\nreturn 1.0;\n}\nfloat computeShadowWithPCFCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n\nfloat biasedDepth=depth-bias;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\nreturn min(1.0,visibility+darkness);\n}\nfloat computeShadow(vec4 vPositionFromLight,sampler2D shadowSampler,float darkness,float bias)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadow=unpack(texture2D(shadowSampler,uv))+bias;\nif (depth.z>shadow)\n{\nreturn darkness;\n}\nreturn 1.;\n}\nfloat computeShadowWithPCF(vec4 vPositionFromLight,sampler2D shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\nfloat biasedDepth=depth.z-bias;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\nreturn min(1.0,visibility+darkness);\n}\n\nfloat unpackHalf(vec2 color)\n{\nreturn color.x+(color.y/255.0);\n}\nfloat linstep(float low,float high,float v) {\nreturn clamp((v-low)/(high-low),0.0,1.0);\n}\nfloat ChebychevInequality(vec2 moments,float compare,float bias)\n{\nfloat p=smoothstep(compare-bias,compare,moments.x);\nfloat variance=max(moments.y-moments.x*moments.x,0.02);\nfloat d=compare-moments.x;\nfloat p_max=linstep(0.2,1.0,variance/(variance+d*d));\nreturn clamp(max(p,p_max),0.0,1.0);\n}\nfloat computeShadowWithVSM(vec4 vPositionFromLight,sampler2D shadowSampler,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0 || depth.z>=1.0)\n{\nreturn 1.0;\n}\nvec4 texel=texture2D(shadowSampler,uv);\nvec2 moments=vec2(unpackHalf(texel.xy),unpackHalf(texel.zw));\nreturn min(1.0,1.0-ChebychevInequality(moments,depth.z,bias)+darkness);\n}\n#endif",
shadowsVertex:"#ifdef SHADOWS\n#if defined(SPOTLIGHT{X}) || defined(DIRLIGHT{X})\nvPositionFromLight{X}=lightMatrix{X}*worldPos;\n#endif\n#endif",shadowsVertexDeclaration:"#ifdef SHADOWS\n#if defined(SPOTLIGHT{X}) || defined(DIRLIGHT{X})\nuniform mat4 lightMatrix{X};\nvarying vec4 vPositionFromLight{X};\n#endif\n#endif\n"};BABYLON.CollisionWorker='var BABYLON;!function(t){var e=function(t,e,o,i){return t.x>o.x+i?!1:o.x-i>e.x?!1:t.y>o.y+i?!1:o.y-i>e.y?!1:t.z>o.z+i?!1:!(o.z-i>e.z)},o=function(t,e,o,i){var s=e*e-4*t*o,r={root:0,found:!1};if(0>s)return r;var n=Math.sqrt(s),c=(-e-n)/(2*t),h=(-e+n)/(2*t);if(c>h){var a=h;h=c,c=a}return c>0&&i>c?(r.root=c,r.found=!0,r):h>0&&i>h?(r.root=h,r.found=!0,r):r},i=function(){function i(){this.radius=new t.Vector3(1,1,1),this.retry=0,this.basePointWorld=t.Vector3.Zero(),this.velocityWorld=t.Vector3.Zero(),this.normalizedVelocity=t.Vector3.Zero(),this._collisionPoint=t.Vector3.Zero(),this._planeIntersectionPoint=t.Vector3.Zero(),this._tempVector=t.Vector3.Zero(),this._tempVector2=t.Vector3.Zero(),this._tempVector3=t.Vector3.Zero(),this._tempVector4=t.Vector3.Zero(),this._edge=t.Vector3.Zero(),this._baseToVertex=t.Vector3.Zero(),this._destinationPoint=t.Vector3.Zero(),this._slidePlaneNormal=t.Vector3.Zero(),this._displacementVector=t.Vector3.Zero()}return i.prototype._initialize=function(e,o,i){this.velocity=o,t.Vector3.NormalizeToRef(o,this.normalizedVelocity),this.basePoint=e,e.multiplyToRef(this.radius,this.basePointWorld),o.multiplyToRef(this.radius,this.velocityWorld),this.velocityWorldLength=this.velocityWorld.length(),this.epsilon=i,this.collisionFound=!1},i.prototype._checkPointInTriangle=function(e,o,i,s,r){o.subtractToRef(e,this._tempVector),i.subtractToRef(e,this._tempVector2),t.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var n=t.Vector3.Dot(this._tempVector4,r);return 0>n?!1:(s.subtractToRef(e,this._tempVector3),t.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),n=t.Vector3.Dot(this._tempVector4,r),0>n?!1:(t.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),n=t.Vector3.Dot(this._tempVector4,r),n>=0))},i.prototype._canDoCollision=function(o,i,s,r){var n=t.Vector3.Distance(this.basePointWorld,o),c=Math.max(this.radius.x,this.radius.y,this.radius.z);return n>this.velocityWorldLength+c+i?!1:!!e(s,r,this.basePointWorld,this.velocityWorldLength+c)},i.prototype._testTriangle=function(e,i,s,r,n,c){var h,a=!1;i||(i=[]),i[e]||(i[e]=new t.Plane(0,0,0,0),i[e].copyFromPoints(s,r,n));var l=i[e];if(c||l.isFrontFacingTo(this.normalizedVelocity,0)){var _=l.signedDistanceTo(this.basePoint),d=t.Vector3.Dot(l.normal,this.velocity);if(0==d){if(Math.abs(_)>=1)return;a=!0,h=0}else{h=(-1-_)/d;var V=(1-_)/d;if(h>V){var u=V;V=h,h=u}if(h>1||0>V)return;0>h&&(h=0),h>1&&(h=1)}this._collisionPoint.copyFromFloats(0,0,0);var P=!1,p=1;if(a||(this.basePoint.subtractToRef(l.normal,this._planeIntersectionPoint),this.velocity.scaleToRef(h,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,s,r,n,l.normal)&&(P=!0,p=h,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!P){var m=this.velocity.lengthSquared(),f=m;this.basePoint.subtractToRef(s,this._tempVector);var T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p);y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(s)),this.basePoint.subtractToRef(r,this._tempVector),T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p),y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(r)),this.basePoint.subtractToRef(n,this._tempVector),T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p),y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(n)),r.subtractToRef(s,this._edge),s.subtractToRef(this.basePoint,this._baseToVertex);var g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex);if(f=g*-m+v*v,T=g*(2*t.Vector3.Dot(this.velocity,this._baseToVertex))-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found){var D=(v*y.root-R)/g;D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),s.addToRef(this._edge,this._collisionPoint))}n.subtractToRef(r,this._edge),r.subtractToRef(this.basePoint,this._baseToVertex),g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex),f=g*-m+v*v,T=g*(2*t.Vector3.Dot(this.velocity,this._baseToVertex))-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found&&(D=(v*y.root-R)/g,D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),r.addToRef(this._edge,this._collisionPoint))),s.subtractToRef(n,this._edge),n.subtractToRef(this.basePoint,this._baseToVertex),g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex),f=g*-m+v*v,T=g*(2*t.Vector3.Dot(this.velocity,this._baseToVertex))-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found&&(D=(v*y.root-R)/g,D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),n.addToRef(this._edge,this._collisionPoint)))}if(P){var x=p*this.velocity.length();(!this.collisionFound||x<this.nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this.nearestDistance=x,this.collisionFound=!0)}}},i.prototype._collide=function(t,e,o,i,s,r,n){for(var c=i;s>c;c+=3){var h=e[o[c]-r],a=e[o[c+1]-r],l=e[o[c+2]-r];this._testTriangle(c,t,l,a,h,n)}},i.prototype._getResponse=function(e,o){e.addToRef(o,this._destinationPoint),o.scaleInPlace(this.nearestDistance/o.length()),this.basePoint.addToRef(o,e),e.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this.epsilon,this._displacementVector),e.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(t.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,o)},i}();t.Collider=i}(BABYLON||(BABYLON={}));var BABYLON;!function(o){o.WorkerIncluded=!0;var e=function(){function o(){this._meshes={},this._geometries={}}return o.prototype.getMeshes=function(){return this._meshes},o.prototype.getGeometries=function(){return this._geometries},o.prototype.getMesh=function(o){return this._meshes[o]},o.prototype.addMesh=function(o){this._meshes[o.uniqueId]=o},o.prototype.removeMesh=function(o){delete this._meshes[o]},o.prototype.getGeometry=function(o){return this._geometries[o]},o.prototype.addGeometry=function(o){this._geometries[o.id]=o},o.prototype.removeGeometry=function(o){delete this._geometries[o]},o}();o.CollisionCache=e;var i=function(){function e(e,i,r){this.collider=e,this._collisionCache=i,this.finalPosition=r,this.collisionsScalingMatrix=o.Matrix.Zero(),this.collisionTranformationMatrix=o.Matrix.Zero()}return e.prototype.collideWithWorld=function(o,e,i,r){var t=.01;if(this.collider.retry>=i)return void this.finalPosition.copyFrom(o);this.collider._initialize(o,e,t);for(var s,l=this._collisionCache.getMeshes(),n=Object.keys(l),a=n.length,c=0;a>c;++c)if(s=n[c],parseInt(s)!=r){var d=l[s];d.checkCollisions&&this.checkCollision(d)}return this.collider.collisionFound?(0===e.x&&0===e.y&&0===e.z||this.collider._getResponse(o,e),e.length()<=t?void this.finalPosition.copyFrom(o):(this.collider.retry++,void this.collideWithWorld(o,e,i,r))):void o.addToRef(e,this.finalPosition)},e.prototype.checkCollision=function(e){if(this.collider._canDoCollision(o.Vector3.FromArray(e.sphereCenter),e.sphereRadius,o.Vector3.FromArray(e.boxMinimum),o.Vector3.FromArray(e.boxMaximum))){o.Matrix.ScalingToRef(1/this.collider.radius.x,1/this.collider.radius.y,1/this.collider.radius.z,this.collisionsScalingMatrix);var i=o.Matrix.FromArray(e.worldMatrixFromCache);i.multiplyToRef(this.collisionsScalingMatrix,this.collisionTranformationMatrix),this.processCollisionsForSubMeshes(this.collisionTranformationMatrix,e)}},e.prototype.processCollisionsForSubMeshes=function(o,e){var i=e.subMeshes,r=i.length;if(!e.geometryId)return void console.log("no mesh geometry id");var t=this._collisionCache.getGeometry(e.geometryId);if(!t)return void console.log("couldn\'t find geometry",e.geometryId);for(var s=0;r>s;s++){var l=i[s];r>1&&!this.checkSubmeshCollision(l)||(this.collideForSubMesh(l,o,t),this.collider.collisionFound&&(this.collider.collidedMesh=e.uniqueId))}},e.prototype.collideForSubMesh=function(e,i,r){if(!r.positionsArray){r.positionsArray=[];for(var t=0,s=r.positions.length;s>t;t+=3){var l=o.Vector3.FromArray([r.positions[t],r.positions[t+1],r.positions[t+2]]);r.positionsArray.push(l)}}if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(i)){e._lastColliderTransformMatrix=i.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];for(var n=e.verticesStart,a=e.verticesStart+e.verticesCount,t=n;a>t;t++)e._lastColliderWorldVertices.push(o.Vector3.TransformCoordinates(r.positionsArray[t],i))}this.collider._collide(e._trianglePlanes,e._lastColliderWorldVertices,r.indices,e.indexStart,e.indexStart+e.indexCount,e.verticesStart,e.hasMaterial)},e.prototype.checkSubmeshCollision=function(e){return this.collider._canDoCollision(o.Vector3.FromArray(e.sphereCenter),e.sphereRadius,o.Vector3.FromArray(e.boxMinimum),o.Vector3.FromArray(e.boxMaximum))},e}();o.CollideWorker=i;var r=function(){function r(){}return r.prototype.onInit=function(i){this._collisionCache=new e;var r={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.INIT};postMessage(r,void 0)},r.prototype.onUpdate=function(e){var i=this,r={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.UPDATE};try{for(var t in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(t)&&this._collisionCache.addGeometry(e.updatedGeometries[t]);for(var s in e.updatedMeshes)e.updatedMeshes.hasOwnProperty(s)&&this._collisionCache.addMesh(e.updatedMeshes[s]);e.removedGeometries.forEach(function(o){i._collisionCache.removeGeometry(o)}),e.removedMeshes.forEach(function(o){i._collisionCache.removeMesh(o)})}catch(l){r.error=o.WorkerReplyType.UNKNOWN_ERROR}postMessage(r,void 0)},r.prototype.onCollision=function(e){var r=o.Vector3.Zero(),t=new o.Collider;t.radius=o.Vector3.FromArray(e.collider.radius);var s=new i(t,this._collisionCache,r);s.collideWithWorld(o.Vector3.FromArray(e.collider.position),o.Vector3.FromArray(e.collider.velocity),e.maximumRetry,e.excludedMeshUniqueId);var l={collidedMeshUniqueId:t.collidedMesh,collisionId:e.collisionId,newPosition:r.asArray()},n={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.COLLIDE,payload:l};postMessage(n,void 0)},r}();o.CollisionDetectorTransferable=r;try{if(self&&self instanceof WorkerGlobalScope){window={},o.Collider||(importScripts("./babylon.collisionCoordinator.js"),importScripts("./babylon.collider.js"),importScripts("../Math/babylon.math.js"));var t=new r,s=function(e){var i=e.data;switch(i.taskType){case o.WorkerTaskType.INIT:t.onInit(i.payload);break;case o.WorkerTaskType.COLLIDE:t.onCollision(i.payload);break;case o.WorkerTaskType.UPDATE:t.onUpdate(i.payload)}};self.onmessage=s}}catch(l){console.log("single worker init")}}(BABYLON||(BABYLON={}));var BABYLON;!function(e){e.CollisionWorker="",function(e){e[e.INIT=0]="INIT",e[e.UPDATE=1]="UPDATE",e[e.COLLIDE=2]="COLLIDE"}(e.WorkerTaskType||(e.WorkerTaskType={}));var o=e.WorkerTaskType;!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.UNKNOWN_ERROR=1]="UNKNOWN_ERROR"}(e.WorkerReplyType||(e.WorkerReplyType={}));var i=e.WorkerReplyType,t=function(){function t(){var r=this;this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this.onMeshUpdated=function(e){r._addUpdateMeshesList[e.uniqueId]=t.SerializeMesh(e)},this.onGeometryUpdated=function(e){r._addUpdateGeometriesList[e.id]=t.SerializeGeometry(e)},this._afterRender=function(){if(r._init&&!(0==r._toRemoveGeometryArray.length&&0==r._toRemoveMeshesArray.length&&0==Object.keys(r._addUpdateGeometriesList).length&&0==Object.keys(r._addUpdateMeshesList).length||r._runningUpdated>4)){++r._runningUpdated;var e={updatedMeshes:r._addUpdateMeshesList,updatedGeometries:r._addUpdateGeometriesList,removedGeometries:r._toRemoveGeometryArray,removedMeshes:r._toRemoveMeshesArray},i={payload:e,taskType:o.UPDATE},t=[];for(var s in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(s)&&(t.push(i.payload.updatedGeometries[s].indices.buffer),t.push(i.payload.updatedGeometries[s].normals.buffer),t.push(i.payload.updatedGeometries[s].positions.buffer));r._worker.postMessage(i,t),r._addUpdateMeshesList={},r._addUpdateGeometriesList={},r._toRemoveGeometryArray=[],r._toRemoveMeshesArray=[]}},this._onMessageFromWorker=function(t){var s=t.data;if(s.error!=i.SUCCESS)return void e.Tools.Warn("error returned from worker!");switch(s.taskType){case o.INIT:r._init=!0,r._scene.meshes.forEach(function(e){r.onMeshAdded(e)}),r._scene.getGeometries().forEach(function(e){r.onGeometryAdded(e)});break;case o.UPDATE:r._runningUpdated--;break;case o.COLLIDE:r._runningCollisionTask=!1;var n=s.payload;if(!r._collisionsCallbackArray[n.collisionId])return;r._collisionsCallbackArray[n.collisionId](n.collisionId,e.Vector3.FromArray(n.newPosition),r._scene.getMeshByUniqueID(n.collidedMeshUniqueId)),r._collisionsCallbackArray[n.collisionId]=void 0}},this._collisionsCallbackArray=[],this._init=!1,this._runningUpdated=0,this._runningCollisionTask=!1,this._addUpdateMeshesList={},this._addUpdateGeometriesList={},this._toRemoveGeometryArray=[],this._toRemoveMeshesArray=[]}return t.prototype.getNewPosition=function(e,i,t,r,s,n,a){if(this._init&&!this._collisionsCallbackArray[a]&&!this._collisionsCallbackArray[a+1e5]){e.divideToRef(t.radius,this._scaledPosition),i.divideToRef(t.radius,this._scaledVelocity),this._collisionsCallbackArray[a]=n;var d={collider:{position:this._scaledPosition.asArray(),velocity:this._scaledVelocity.asArray(),radius:t.radius.asArray()},collisionId:a,excludedMeshUniqueId:s?s.uniqueId:null,maximumRetry:r},l={payload:d,taskType:o.COLLIDE};this._worker.postMessage(l)}},t.prototype.init=function(i){this._scene=i,this._scene.registerAfterRender(this._afterRender);var t=e.WorkerIncluded?e.Engine.CodeRepository+"Collisions/babylon.collisionWorker.js":URL.createObjectURL(new Blob([e.CollisionWorker],{type:"application/javascript"}));this._worker=new Worker(t),this._worker.onmessage=this._onMessageFromWorker;var r={payload:{},taskType:o.INIT};this._worker.postMessage(r)},t.prototype.destroy=function(){this._scene.unregisterAfterRender(this._afterRender),this._worker.terminate()},t.prototype.onMeshAdded=function(e){e.registerAfterWorldMatrixUpdate(this.onMeshUpdated),this.onMeshUpdated(e)},t.prototype.onMeshRemoved=function(e){this._toRemoveMeshesArray.push(e.uniqueId)},t.prototype.onGeometryAdded=function(e){e.onGeometryUpdated=this.onGeometryUpdated,this.onGeometryUpdated(e)},t.prototype.onGeometryDeleted=function(e){this._toRemoveGeometryArray.push(e.id)},t.SerializeMesh=function(o){var i=[];o.subMeshes&&(i=o.subMeshes.map(function(e,o){return{position:o,verticesStart:e.verticesStart,verticesCount:e.verticesCount,indexStart:e.indexStart,indexCount:e.indexCount,hasMaterial:!!e.getMaterial(),sphereCenter:e.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:e.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:e.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:e.getBoundingInfo().boundingBox.maximumWorld.asArray()}}));var t=null;return o instanceof e.Mesh?t=o.geometry?o.geometry.id:null:o instanceof e.InstancedMesh&&(t=o.sourceMesh&&o.sourceMesh.geometry?o.sourceMesh.geometry.id:null),{uniqueId:o.uniqueId,id:o.id,name:o.name,geometryId:t,sphereCenter:o.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:o.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:o.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:o.getBoundingInfo().boundingBox.maximumWorld.asArray(),worldMatrixFromCache:o.worldMatrixFromCache.asArray(),subMeshes:i,checkCollisions:o.checkCollisions}},t.SerializeGeometry=function(o){return{id:o.id,positions:new Float32Array(o.getVerticesData(e.VertexBuffer.PositionKind)||[]),normals:new Float32Array(o.getVerticesData(e.VertexBuffer.NormalKind)||[]),indices:new Int32Array(o.getIndices()||[])}},t}();e.CollisionCoordinatorWorker=t;var r=function(){function o(){this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this._finalPosition=e.Vector3.Zero()}return o.prototype.getNewPosition=function(e,o,i,t,r,s,n){e.divideToRef(i.radius,this._scaledPosition),o.divideToRef(i.radius,this._scaledVelocity),i.collidedMesh=null,i.retry=0,i.initialVelocity=this._scaledVelocity,i.initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,i,t,this._finalPosition,r),this._finalPosition.multiplyInPlace(i.radius),s(n,this._finalPosition,i.collidedMesh)},o.prototype.init=function(e){this._scene=e},o.prototype.destroy=function(){},o.prototype.onMeshAdded=function(e){},o.prototype.onMeshUpdated=function(e){},o.prototype.onMeshRemoved=function(e){},o.prototype.onGeometryAdded=function(e){},o.prototype.onGeometryUpdated=function(e){},o.prototype.onGeometryDeleted=function(e){},o.prototype._collideWithWorld=function(o,i,t,r,s,n){void 0===n&&(n=null);var a=10*e.Engine.CollisionsEpsilon;if(t.retry>=r)return void s.copyFrom(o);t._initialize(o,i,a);for(var d=0;d<this._scene.meshes.length;d++){var l=this._scene.meshes[d];l.isEnabled()&&l.checkCollisions&&l.subMeshes&&l!==n&&l._checkCollision(t)}return t.collisionFound?(0===i.x&&0===i.y&&0===i.z||t._getResponse(o,i),i.length()<=a?void s.copyFrom(o):(t.retry++,void this._collideWithWorld(o,i,t,r,s,n))):void o.addToRef(i,s)},o}();e.CollisionCoordinatorLegacy=r}(BABYLON||(BABYLON={}));var BABYLON;!function(t){t.ToGammaSpace=1/2.2,t.ToLinearSpace=2.2,t.Epsilon=.001;var i=function(){function t(){}return t.WithinEpsilon=function(t,i,n){void 0===n&&(n=1.401298e-45);var r=t-i;return r>=-n&&n>=r},t.ToHex=function(t){var i=t.toString(16);return 15>=t?("0"+i).toUpperCase():i.toUpperCase()},t.Sign=function(t){return t=+t,0===t||isNaN(t)?t:t>0?1:-1},t.Clamp=function(t,i,n){return void 0===i&&(i=0),void 0===n&&(n=1),Math.min(n,Math.max(i,t))},t}();t.MathTools=i;var n=function(){function n(t,i,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),this.r=t,this.g=i,this.b=n}return n.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},n.prototype.getClassName=function(){return"Color3"},n.prototype.getHashCode=function(){var t=this.r||0;return t=397*t^(this.g||0),t=397*t^(this.b||0)},n.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,this},n.prototype.toColor4=function(t){return void 0===t&&(t=1),new r(this.r,this.g,this.b,t)},n.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},n.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},n.prototype.multiply=function(t){return new n(this.r*t.r,this.g*t.g,this.b*t.b)},n.prototype.multiplyToRef=function(t,i){return i.r=this.r*t.r,i.g=this.g*t.g,i.b=this.b*t.b,this},n.prototype.equals=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b},n.prototype.equalsFloats=function(t,i,n){return this.r===t&&this.g===i&&this.b===n},n.prototype.scale=function(t){return new n(this.r*t,this.g*t,this.b*t)},n.prototype.scaleToRef=function(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,this},n.prototype.add=function(t){return new n(this.r+t.r,this.g+t.g,this.b+t.b)},n.prototype.addToRef=function(t,i){return i.r=this.r+t.r,i.g=this.g+t.g,i.b=this.b+t.b,this},n.prototype.subtract=function(t){return new n(this.r-t.r,this.g-t.g,this.b-t.b)},n.prototype.subtractToRef=function(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,this},n.prototype.clone=function(){return new n(this.r,this.g,this.b)},n.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},n.prototype.copyFromFloats=function(t,i,n){return this.r=t,this.g=i,this.b=n,this},n.prototype.toHexString=function(){var t=255*this.r|0,n=255*this.g|0,r=255*this.b|0;return"#"+i.ToHex(t)+i.ToHex(n)+i.ToHex(r)},n.prototype.toLinearSpace=function(){var t=new n;return this.toLinearSpaceToRef(t),t},n.prototype.toLinearSpaceToRef=function(i){return i.r=Math.pow(this.r,t.ToLinearSpace),i.g=Math.pow(this.g,t.ToLinearSpace),i.b=Math.pow(this.b,t.ToLinearSpace),this},n.prototype.toGammaSpace=function(){var t=new n;return this.toGammaSpaceToRef(t),t},n.prototype.toGammaSpaceToRef=function(i){return i.r=Math.pow(this.r,t.ToGammaSpace),i.g=Math.pow(this.g,t.ToGammaSpace),i.b=Math.pow(this.b,t.ToGammaSpace),this},n.FromHexString=function(t){if("#"!==t.substring(0,1)||7!==t.length)return new n(0,0,0);var i=parseInt(t.substring(1,3),16),r=parseInt(t.substring(3,5),16),o=parseInt(t.substring(5,7),16);return n.FromInts(i,r,o)},n.FromArray=function(t,i){return void 0===i&&(i=0),new n(t[i],t[i+1],t[i+2])},n.FromInts=function(t,i,r){return new n(t/255,i/255,r/255)},n.Lerp=function(t,i,r){var o=t.r+(i.r-t.r)*r,s=t.g+(i.g-t.g)*r,e=t.b+(i.b-t.b)*r;return new n(o,s,e)},n.Red=function(){return new n(1,0,0)},n.Green=function(){return new n(0,1,0)},n.Blue=function(){return new n(0,0,1)},n.Black=function(){return new n(0,0,0)},n.White=function(){return new n(1,1,1)},n.Purple=function(){return new n(.5,0,.5)},n.Magenta=function(){return new n(1,0,1)},n.Yellow=function(){return new n(1,1,0)},n.Gray=function(){return new n(.5,.5,.5)},n}();t.Color3=n;var r=function(){function t(t,i,n,r){this.r=t,this.g=i,this.b=n,this.a=r}return t.prototype.addInPlace=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this},t.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},t.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t[i+3]=this.a,this},t.prototype.add=function(i){return new t(this.r+i.r,this.g+i.g,this.b+i.b,this.a+i.a)},t.prototype.subtract=function(i){return new t(this.r-i.r,this.g-i.g,this.b-i.b,this.a-i.a)},t.prototype.subtractToRef=function(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,i.a=this.a-t.a,this},t.prototype.scale=function(i){return new t(this.r*i,this.g*i,this.b*i,this.a*i)},t.prototype.scaleToRef=function(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,i.a=this.a*t,this},t.prototype.multiply=function(i){return new t(this.r*i.r,this.g*i.g,this.b*i.b,this.a*i.a)},t.prototype.multiplyToRef=function(t,i){return i.r=this.r*t.r,i.g=this.g*t.g,i.b=this.b*t.b,i.a=this.a*t.a,i},t.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},t.prototype.getClassName=function(){return"Color4"},t.prototype.getHashCode=function(){var t=this.r||0;return t=397*t^(this.g||0),t=397*t^(this.b||0),t=397*t^(this.a||0)},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.prototype.toHexString=function(){var t=255*this.r|0,n=255*this.g|0,r=255*this.b|0,o=255*this.a|0;return"#"+i.ToHex(t)+i.ToHex(n)+i.ToHex(r)+i.ToHex(o)},t.FromHexString=function(i){if("#"!==i.substring(0,1)||9!==i.length)return new t(0,0,0,0);var n=parseInt(i.substring(1,3),16),r=parseInt(i.substring(3,5),16),o=parseInt(i.substring(5,7),16),s=parseInt(i.substring(7,9),16);return t.FromInts(n,r,o,s)},t.Lerp=function(i,n,r){var o=new t(0,0,0,0);return t.LerpToRef(i,n,r,o),o},t.LerpToRef=function(t,i,n,r){r.r=t.r+(i.r-t.r)*n,r.g=t.g+(i.g-t.g)*n,r.b=t.b+(i.b-t.b)*n,r.a=t.a+(i.a-t.a)*n},t.FromArray=function(i,n){return void 0===n&&(n=0),new t(i[n],i[n+1],i[n+2],i[n+3])},t.FromInts=function(i,n,r,o){return new t(i/255,n/255,r/255,o/255)},t.CheckColors4=function(t,i){if(t.length===3*i){for(var n=[],r=0;r<t.length;r+=3){var o=r/3*4;n[o]=t[r],n[o+1]=t[r+1],n[o+2]=t[r+2],n[o+3]=1}return n}return t},t}();t.Color4=r;var o=function(){function n(t,i){this.x=t,this.y=i}return n.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},n.prototype.getClassName=function(){return"Vector2"},n.prototype.getHashCode=function(){var t=this.x||0;return t=397*t^(this.y||0)},n.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,this},n.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},n.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},n.prototype.copyFromFloats=function(t,i){return this.x=t,this.y=i,this},n.prototype.add=function(t){return new n(this.x+t.x,this.y+t.y)},n.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,this},n.prototype.addVector3=function(t){return new n(this.x+t.x,this.y+t.y)},n.prototype.subtract=function(t){return new n(this.x-t.x,this.y-t.y)},n.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,this},n.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this},n.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this},n.prototype.multiply=function(t){return new n(this.x*t.x,this.y*t.y)},n.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,this},n.prototype.multiplyByFloats=function(t,i){return new n(this.x*t,this.y*i)},n.prototype.divide=function(t){return new n(this.x/t.x,this.y/t.y)},n.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,this},n.prototype.negate=function(){return new n(-this.x,-this.y)},n.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this},n.prototype.scale=function(t){return new n(this.x*t,this.y*t)},n.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y},n.prototype.equalsWithEpsilon=function(n,r){return void 0===r&&(r=t.Epsilon),n&&i.WithinEpsilon(this.x,n.x,r)&&i.WithinEpsilon(this.y,n.y,r)},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},n.prototype.normalize=function(){var t=this.length();if(0===t)return this;var i=1/t;return this.x*=i,this.y*=i,this},n.prototype.clone=function(){return new n(this.x,this.y)},n.Zero=function(){return new n(0,0)},n.FromArray=function(t,i){return void 0===i&&(i=0),new n(t[i],t[i+1])},n.FromArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1]},n.CatmullRom=function(t,i,r,o,s){var e=s*s,h=s*e,a=.5*(2*i.x+(-t.x+r.x)*s+(2*t.x-5*i.x+4*r.x-o.x)*e+(-t.x+3*i.x-3*r.x+o.x)*h),u=.5*(2*i.y+(-t.y+r.y)*s+(2*t.y-5*i.y+4*r.y-o.y)*e+(-t.y+3*i.y-3*r.y+o.y)*h);return new n(a,u)},n.Clamp=function(t,i,r){var o=t.x;o=o>r.x?r.x:o,o=o<i.x?i.x:o;var s=t.y;return s=s>r.y?r.y:s,s=s<i.y?i.y:s,new n(o,s)},n.Hermite=function(t,i,r,o,s){var e=s*s,h=s*e,a=2*h-3*e+1,u=-2*h+3*e,m=h-2*e+s,y=h-e,c=t.x*a+r.x*u+i.x*m+o.x*y,p=t.y*a+r.y*u+i.y*m+o.y*y;return new n(c,p)},n.Lerp=function(t,i,r){var o=t.x+(i.x-t.x)*r,s=t.y+(i.y-t.y)*r;return new n(o,s)},n.Dot=function(t,i){return t.x*i.x+t.y*i.y},n.Normalize=function(t){var i=t.clone();return i.normalize(),i},n.Minimize=function(t,i){var r=t.x<i.x?t.x:i.x,o=t.y<i.y?t.y:i.y;return new n(r,o)},n.Maximize=function(t,i){var r=t.x>i.x?t.x:i.x,o=t.y>i.y?t.y:i.y;return new n(r,o)},n.Transform=function(t,i){var r=n.Zero();return n.TransformToRef(t,i,r),r},n.TransformToRef=function(t,i,n){var r=t.x*i.m[0]+t.y*i.m[4]+i.m[12],o=t.x*i.m[1]+t.y*i.m[5]+i.m[13];n.x=r,n.y=o},n.PointInTriangle=function(t,i,n,r){var o=.5*(-n.y*r.x+i.y*(-n.x+r.x)+i.x*(n.y-r.y)+n.x*r.y),s=0>o?-1:1,e=(i.y*r.x-i.x*r.y+(r.y-i.y)*t.x+(i.x-r.x)*t.y)*s,h=(i.x*n.y-i.y*n.x+(i.y-n.y)*t.x+(n.x-i.x)*t.y)*s;return e>0&&h>0&&2*o*s>e+h},n.Distance=function(t,i){return Math.sqrt(n.DistanceSquared(t,i))},n.DistanceSquared=function(t,i){var n=t.x-i.x,r=t.y-i.y;return n*n+r*r},n.DistanceOfPointFromSegment=function(t,i,r){var o=n.DistanceSquared(i,r);if(0===o)return n.Distance(t,i);var s=r.subtract(i),e=Math.max(0,Math.min(1,n.Dot(t.subtract(i),s)/o)),h=i.add(s.multiplyByFloats(e,e));return n.Distance(t,h)},n}();t.Vector2=o;var s=function(){function n(t,i,n){this.x=t,this.y=i,this.z=n}return n.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}"},n.prototype.getClassName=function(){return"Vector3"},n.prototype.getHashCode=function(){var t=this.x||0;return t=397*t^(this.y||0),t=397*t^(this.z||0)},n.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},n.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,this},n.prototype.toQuaternion=function(){var t=new a(0,0,0,1),i=Math.cos(.5*(this.x+this.z)),n=Math.sin(.5*(this.x+this.z)),r=Math.cos(.5*(this.z-this.x)),o=Math.sin(.5*(this.z-this.x)),s=Math.cos(.5*this.y),e=Math.sin(.5*this.y);return t.x=r*e,t.y=-o*e,t.z=n*s,t.w=i*s,t},n.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},n.prototype.add=function(t){return new n(this.x+t.x,this.y+t.y,this.z+t.z)},n.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,i.z=this.z+t.z,this},n.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},n.prototype.subtract=function(t){return new n(this.x-t.x,this.y-t.y,this.z-t.z)},n.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,this},n.prototype.subtractFromFloats=function(t,i,r){return new n(this.x-t,this.y-i,this.z-r)},n.prototype.subtractFromFloatsToRef=function(t,i,n,r){return r.x=this.x-t,r.y=this.y-i,r.z=this.z-n,this},n.prototype.negate=function(){return new n(-this.x,-this.y,-this.z)},n.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this},n.prototype.scale=function(t){return new n(this.x*t,this.y*t,this.z*t)},n.prototype.scaleToRef=function(t,i){i.x=this.x*t,i.y=this.y*t,i.z=this.z*t},n.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z},n.prototype.equalsWithEpsilon=function(n,r){return void 0===r&&(r=t.Epsilon),n&&i.WithinEpsilon(this.x,n.x,r)&&i.WithinEpsilon(this.y,n.y,r)&&i.WithinEpsilon(this.z,n.z,r)},n.prototype.equalsToFloats=function(t,i,n){return this.x===t&&this.y===i&&this.z===n},n.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},n.prototype.multiply=function(t){return new n(this.x*t.x,this.y*t.y,this.z*t.z)},n.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,i.z=this.z*t.z,this},n.prototype.multiplyByFloats=function(t,i,r){return new n(this.x*t,this.y*i,this.z*r)},n.prototype.divide=function(t){return new n(this.x/t.x,this.y/t.y,this.z/t.z)},n.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,i.z=this.z/t.z,this},n.prototype.MinimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),this},n.prototype.MaximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),this},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},n.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},n.prototype.normalize=function(){var t=this.length();if(0===t||1===t)return this;var i=1/t;return this.x*=i,this.y*=i,this.z*=i,this},n.prototype.clone=function(){return new n(this.x,this.y,this.z)},n.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},n.prototype.copyFromFloats=function(t,i,n){return this.x=t,this.y=i,this.z=n,this},n.GetClipFactor=function(t,i,r,o){var s=n.Dot(t,r)-o,e=n.Dot(i,r)-o,h=s/(s-e);return h},n.FromArray=function(t,i){return i||(i=0),new n(t[i],t[i+1],t[i+2])},n.FromFloatArray=function(t,i){return i||(i=0),new n(t[i],t[i+1],t[i+2])},n.FromArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1],n.z=t[i+2]},n.FromFloatArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1],n.z=t[i+2]},n.FromFloatsToRef=function(t,i,n,r){r.x=t,r.y=i,r.z=n},n.Zero=function(){return new n(0,0,0)},n.Up=function(){return new n(0,1,0)},n.TransformCoordinates=function(t,i){var r=n.Zero();return n.TransformCoordinatesToRef(t,i,r),r},n.TransformCoordinatesToRef=function(t,i,n){var r=t.x*i.m[0]+t.y*i.m[4]+t.z*i.m[8]+i.m[12],o=t.x*i.m[1]+t.y*i.m[5]+t.z*i.m[9]+i.m[13],s=t.x*i.m[2]+t.y*i.m[6]+t.z*i.m[10]+i.m[14],e=t.x*i.m[3]+t.y*i.m[7]+t.z*i.m[11]+i.m[15];n.x=r/e,n.y=o/e,n.z=s/e},n.TransformCoordinatesFromFloatsToRef=function(t,i,n,r,o){var s=t*r.m[0]+i*r.m[4]+n*r.m[8]+r.m[12],e=t*r.m[1]+i*r.m[5]+n*r.m[9]+r.m[13],h=t*r.m[2]+i*r.m[6]+n*r.m[10]+r.m[14],a=t*r.m[3]+i*r.m[7]+n*r.m[11]+r.m[15];o.x=s/a,o.y=e/a,o.z=h/a},n.TransformNormal=function(t,i){var r=n.Zero();return n.TransformNormalToRef(t,i,r),r},n.TransformNormalToRef=function(t,i,n){n.x=t.x*i.m[0]+t.y*i.m[4]+t.z*i.m[8],n.y=t.x*i.m[1]+t.y*i.m[5]+t.z*i.m[9],n.z=t.x*i.m[2]+t.y*i.m[6]+t.z*i.m[10]},n.TransformNormalFromFloatsToRef=function(t,i,n,r,o){o.x=t*r.m[0]+i*r.m[4]+n*r.m[8],o.y=t*r.m[1]+i*r.m[5]+n*r.m[9],o.z=t*r.m[2]+i*r.m[6]+n*r.m[10]},n.CatmullRom=function(t,i,r,o,s){var e=s*s,h=s*e,a=.5*(2*i.x+(-t.x+r.x)*s+(2*t.x-5*i.x+4*r.x-o.x)*e+(-t.x+3*i.x-3*r.x+o.x)*h),u=.5*(2*i.y+(-t.y+r.y)*s+(2*t.y-5*i.y+4*r.y-o.y)*e+(-t.y+3*i.y-3*r.y+o.y)*h),m=.5*(2*i.z+(-t.z+r.z)*s+(2*t.z-5*i.z+4*r.z-o.z)*e+(-t.z+3*i.z-3*r.z+o.z)*h);return new n(a,u,m)},n.Clamp=function(t,i,r){var o=t.x;o=o>r.x?r.x:o,o=o<i.x?i.x:o;var s=t.y;s=s>r.y?r.y:s,s=s<i.y?i.y:s;var e=t.z;return e=e>r.z?r.z:e,e=e<i.z?i.z:e,new n(o,s,e)},n.Hermite=function(t,i,r,o,s){var e=s*s,h=s*e,a=2*h-3*e+1,u=-2*h+3*e,m=h-2*e+s,y=h-e,c=t.x*a+r.x*u+i.x*m+o.x*y,p=t.y*a+r.y*u+i.y*m+o.y*y,f=t.z*a+r.z*u+i.z*m+o.z*y;return new n(c,p,f)},n.Lerp=function(t,i,r){var o=t.x+(i.x-t.x)*r,s=t.y+(i.y-t.y)*r,e=t.z+(i.z-t.z)*r;return new n(o,s,e)},n.Dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},n.Cross=function(t,i){var r=n.Zero();return n.CrossToRef(t,i,r),r},n.CrossToRef=function(t,i,n){M.Vector3[0].x=t.y*i.z-t.z*i.y,M.Vector3[0].y=t.z*i.x-t.x*i.z,M.Vector3[0].z=t.x*i.y-t.y*i.x,n.copyFrom(M.Vector3[0])},n.Normalize=function(t){var i=n.Zero();return n.NormalizeToRef(t,i),i},n.NormalizeToRef=function(t,i){i.copyFrom(t),i.normalize()},n.Project=function(t,i,r,o){var s=o.width,e=o.height,h=o.x,a=o.y,m=u.FromValues(s/2,0,0,0,0,-e/2,0,0,0,0,1,0,h+s/2,e/2+a,0,1),y=i.multiply(r).multiply(m);return n.TransformCoordinates(t,y)},n.UnprojectFromTransform=function(t,r,o,s,e){var h=s.multiply(e);h.invert(),t.x=t.x/r*2-1,t.y=-(t.y/o*2-1);var a=n.TransformCoordinates(t,h),u=t.x*h.m[3]+t.y*h.m[7]+t.z*h.m[11]+h.m[15];return i.WithinEpsilon(u,1)&&(a=a.scale(1/u)),a},n.Unproject=function(t,r,o,s,e,h){var a=s.multiply(e).multiply(h);a.invert();var u=new n(t.x/r*2-1,-(t.y/o*2-1),t.z),m=n.TransformCoordinates(u,a),y=u.x*a.m[3]+u.y*a.m[7]+u.z*a.m[11]+a.m[15];return i.WithinEpsilon(y,1)&&(m=m.scale(1/y)),m},n.Minimize=function(t,i){var n=t.clone();return n.MinimizeInPlace(i),n},n.Maximize=function(t,i){var n=t.clone();return n.MaximizeInPlace(i),n},n.Distance=function(t,i){return Math.sqrt(n.DistanceSquared(t,i))},n.DistanceSquared=function(t,i){var n=t.x-i.x,r=t.y-i.y,o=t.z-i.z;return n*n+r*r+o*o},n.Center=function(t,i){var n=t.add(i);return n.scaleInPlace(.5),n},n.RotationFromAxis=function(t,i,r){var o=n.Zero();return n.RotationFromAxisToRef(t,i,r,o),o},n.RotationFromAxisToRef=function(r,o,s,e){var h=r.normalize(),a=s.normalize(),u=p.X,m=p.Y,y=0,c=0,f=0,l=0,x=0,z=0,w=0,v=-1,d=0,g=M.Vector3[0],T=0,R=M.Vector3[1];i.WithinEpsilon(a.z,0,t.Epsilon)?z=1:i.WithinEpsilon(a.x,0,t.Epsilon)?l=1:(w=a.z/a.x,l=-w*Math.sqrt(1/(1+w*w)),z=Math.sqrt(1/(1+w*w))),R.x=l,R.y=x,R.z=z,R.normalize(),n.CrossToRef(h,R,g),g.normalize(),n.Dot(a,g)<0&&(v=1),T=n.Dot(h,R),T=Math.min(1,Math.max(-1,T)),f=Math.acos(T)*v,n.Dot(R,u)<0&&(f=Math.PI+f,R=R.scaleInPlace(-1),d++);var _=M.Vector3[2],b=M.Vector3[3];l=0,x=0,z=0,v=-1,i.WithinEpsilon(a.z,0,t.Epsilon)?l=1:(w=R.z/R.x,l=-w*Math.sqrt(1/(1+w*w)),z=Math.sqrt(1/(1+w*w))),_.x=l,_.y=x,_.z=z,_.normalize(),n.CrossToRef(_,R,b),b.normalize(),n.CrossToRef(a,_,g),g.normalize(),n.Dot(R,g)<0&&(v=1),T=n.Dot(a,_),T=Math.min(1,Math.max(-1,T)),c=Math.acos(T)*v,n.Dot(b,m)<0&&(c=Math.PI+c,d++),v=-1,n.CrossToRef(u,R,g),g.normalize(),n.Dot(g,m)<0&&(v=1),T=n.Dot(R,u),T=Math.min(1,Math.max(-1,T)),y=-Math.acos(T)*v,0>T&&2>d&&(y=Math.PI+y),e.x=c,e.y=y,e.z=f},n}();t.Vector3=s;var e=function(){function n(t,i,n,r){this.x=t,this.y=i,this.z=n,this.w=r}return n.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"W:"+this.w+"}"},n.prototype.getClassName=function(){return"Vector4"},n.prototype.getHashCode=function(){var t=this.x||0;return t=397*t^(this.y||0),t=397*t^(this.z||0),t=397*t^(this.w||0)},n.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},n.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,this},n.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},n.prototype.add=function(t){return new n(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},n.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,i.z=this.z+t.z,i.w=this.w+t.w,this},n.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},n.prototype.subtract=function(t){return new n(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},n.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,i.w=this.w-t.w,this},n.prototype.subtractFromFloats=function(t,i,r,o){return new n(this.x-t,this.y-i,this.z-r,this.w-o)},n.prototype.subtractFromFloatsToRef=function(t,i,n,r,o){return o.x=this.x-t,o.y=this.y-i,o.z=this.z-n,o.w=this.w-r,this},n.prototype.negate=function(){return new n(-this.x,-this.y,-this.z,-this.w)},n.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},n.prototype.scale=function(t){return new n(this.x*t,this.y*t,this.z*t,this.w*t)},n.prototype.scaleToRef=function(t,i){i.x=this.x*t,i.y=this.y*t,i.z=this.z*t,i.w=this.w*t},n.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},n.prototype.equalsWithEpsilon=function(n,r){return void 0===r&&(r=t.Epsilon),n&&i.WithinEpsilon(this.x,n.x,r)&&i.WithinEpsilon(this.y,n.y,r)&&i.WithinEpsilon(this.z,n.z,r)&&i.WithinEpsilon(this.w,n.w,r)},n.prototype.equalsToFloats=function(t,i,n,r){return this.x===t&&this.y===i&&this.z===n&&this.w===r},n.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},n.prototype.multiply=function(t){return new n(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},n.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,i.z=this.z*t.z,i.w=this.w*t.w,this},n.prototype.multiplyByFloats=function(t,i,r,o){return new n(this.x*t,this.y*i,this.z*r,this.w*o)},n.prototype.divide=function(t){return new n(this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w)},n.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,i.z=this.z/t.z,i.w=this.w/t.w,this},n.prototype.MinimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),t.w<this.w&&(this.w=t.w),this},n.prototype.MaximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),t.w>this.w&&(this.w=t.w),this},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},n.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},n.prototype.normalize=function(){var t=this.length();if(0===t)return this;var i=1/t;return this.x*=i,this.y*=i,this.z*=i,this.w*=i,this},n.prototype.toVector3=function(){return new s(this.x,this.y,this.z)},n.prototype.clone=function(){return new n(this.x,this.y,this.z,this.w)},n.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},n.prototype.copyFromFloats=function(t,i,n,r){return this.x=t,this.y=i,this.z=n,this.w=r,this},n.FromArray=function(t,i){return i||(i=0),new n(t[i],t[i+1],t[i+2],t[i+3])},n.FromArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1],n.z=t[i+2],n.w=t[i+3]},n.FromFloatArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1],n.z=t[i+2],n.w=t[i+3]},n.FromFloatsToRef=function(t,i,n,r,o){o.x=t,o.y=i,o.z=n,o.w=r},n.Zero=function(){return new n(0,0,0,0)},n.Normalize=function(t){var i=n.Zero();return n.NormalizeToRef(t,i),i},n.NormalizeToRef=function(t,i){i.copyFrom(t),i.normalize()},n.Minimize=function(t,i){var n=t.clone();return n.MinimizeInPlace(i),n},n.Maximize=function(t,i){var n=t.clone();return n.MaximizeInPlace(i),n},n.Distance=function(t,i){return Math.sqrt(n.DistanceSquared(t,i))},n.DistanceSquared=function(t,i){var n=t.x-i.x,r=t.y-i.y,o=t.z-i.z,s=t.w-i.w;return n*n+r*r+o*o+s*s},n.Center=function(t,i){var n=t.add(i);return n.scaleInPlace(.5),n},n}();t.Vector4=e;var h=function(){function t(t,i){this.width=t,this.height=i}return t.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},t.prototype.getClassName=function(){return"Size"},t.prototype.getHashCode=function(){var t=this.width||0;return t=397*t^(this.height||0)},t.prototype.copyFrom=function(t){this.width=t.width,this.height=t.height},t.prototype.clone=function(){return new t(this.width,this.height)},t.prototype.equals=function(t){return t?this.width===t.width&&this.height===t.height:!1},Object.defineProperty(t.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),t.Zero=function(){return new t(0,0)},t.prototype.add=function(i){var n=new t(this.width+i.width,this.height+i.height);return n},t.prototype.substract=function(i){var n=new t(this.width-i.width,this.height-i.height);return n},t.Lerp=function(i,n,r){var o=i.width+(n.width-i.width)*r,s=i.height+(n.height-i.height)*r;return new t(o,s)},t}();t.Size=h;var a=function(){function t(t,i,n,r){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=1),this.x=t,this.y=i,this.z=n,this.w=r}return t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},t.prototype.getClassName=function(){return"Quaternion"},t.prototype.getHashCode=function(){var t=this.x||0;return t=397*t^(this.y||0),t=397*t^(this.z||0),t=397*t^(this.w||0)},t.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},t.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.copyFromFloats=function(t,i,n,r){return this.x=t,this.y=i,this.z=n,this.w=r,this},t.prototype.add=function(i){return new t(this.x+i.x,this.y+i.y,this.z+i.z,this.w+i.w)},t.prototype.subtract=function(i){return new t(this.x-i.x,this.y-i.y,this.z-i.z,this.w-i.w)},t.prototype.scale=function(i){return new t(this.x*i,this.y*i,this.z*i,this.w*i)},t.prototype.multiply=function(i){var n=new t(0,0,0,1);return this.multiplyToRef(i,n),n},t.prototype.multiplyToRef=function(t,i){var n=this.x*t.w+this.y*t.z-this.z*t.y+this.w*t.x,r=-this.x*t.z+this.y*t.w+this.z*t.x+this.w*t.y,o=this.x*t.y-this.y*t.x+this.z*t.w+this.w*t.z,s=-this.x*t.x-this.y*t.y-this.z*t.z+this.w*t.w;return i.copyFromFloats(n,r,o,s),this},t.prototype.multiplyInPlace=function(t){return this.multiplyToRef(t,this),this},t.prototype.conjugateToRef=function(t){return t.copyFromFloats(-this.x,-this.y,-this.z,this.w),this},t.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},t.prototype.conjugate=function(){var i=new t(-this.x,-this.y,-this.z,this.w);return i},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},t.prototype.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},t.prototype.toEulerAngles=function(t){void 0===t&&(t="YZX");var i=s.Zero();return this.toEulerAnglesToRef(i,t),i},t.prototype.toEulerAnglesToRef=function(t,i){void 0===i&&(i="YZX");var n,r,o,s=this.x,e=this.y,h=this.z,a=this.w;switch(i){case"YZX":var u=s*e+h*a;if(u>.499&&(n=2*Math.atan2(s,a),r=Math.PI/2,o=0),-.499>u&&(n=-2*Math.atan2(s,a),r=-Math.PI/2,o=0),isNaN(n)){var m=s*s,y=e*e,c=h*h;n=Math.atan2(2*e*a-2*s*h,1-2*y-2*c),r=Math.asin(2*u),o=Math.atan2(2*s*a-2*e*h,1-2*m-2*c)}break;default:throw new Error("Euler order "+i+" not supported yet.")}return t.y=n,t.z=r,t.x=o,this},t.prototype.toRotationMatrix=function(t){var i=this.x*this.x,n=this.y*this.y,r=this.z*this.z,o=this.x*this.y,s=this.z*this.w,e=this.z*this.x,h=this.y*this.w,a=this.y*this.z,u=this.x*this.w;return t.m[0]=1-2*(n+r),t.m[1]=2*(o+s),t.m[2]=2*(e-h),t.m[3]=0,t.m[4]=2*(o-s),t.m[5]=1-2*(r+i),t.m[6]=2*(a+u),t.m[7]=0,t.m[8]=2*(e+h),t.m[9]=2*(a-u),t.m[10]=1-2*(n+i),t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0,t.m[15]=1,this},t.prototype.fromRotationMatrix=function(i){return t.FromRotationMatrixToRef(i,this),this},t.FromRotationMatrix=function(i){var n=new t;return t.FromRotationMatrixToRef(i,n),n},t.FromRotationMatrixToRef=function(t,i){var n,r=t.m,o=r[0],s=r[4],e=r[8],h=r[1],a=r[5],u=r[9],m=r[2],y=r[6],c=r[10],p=o+a+c;p>0?(n=.5/Math.sqrt(p+1),i.w=.25/n,i.x=(y-u)*n,i.y=(e-m)*n,i.z=(h-s)*n):o>a&&o>c?(n=2*Math.sqrt(1+o-a-c),i.w=(y-u)/n,i.x=.25*n,i.y=(s+h)/n,i.z=(e+m)/n):a>c?(n=2*Math.sqrt(1+a-o-c),i.w=(e-m)/n,i.x=(s+h)/n,i.y=.25*n,i.z=(u+y)/n):(n=2*Math.sqrt(1+c-o-a),i.w=(h-s)/n,i.x=(e+m)/n,i.y=(u+y)/n,i.z=.25*n)},t.Inverse=function(i){return new t(-i.x,-i.y,-i.z,i.w)},t.Identity=function(){return new t(0,0,0,1)},t.RotationAxis=function(i,n){var r=new t,o=Math.sin(n/2);return i.normalize(),r.w=Math.cos(n/2),r.x=i.x*o,r.y=i.y*o,r.z=i.z*o,r},t.FromArray=function(i,n){return n||(n=0),new t(i[n],i[n+1],i[n+2],i[n+3])},t.RotationYawPitchRoll=function(i,n,r){var o=new t;return t.RotationYawPitchRollToRef(i,n,r,o),o},t.RotationYawPitchRollToRef=function(t,i,n,r){var o=.5*n,s=.5*i,e=.5*t,h=Math.sin(o),a=Math.cos(o),u=Math.sin(s),m=Math.cos(s),y=Math.sin(e),c=Math.cos(e);r.x=c*u*a+y*m*h,r.y=y*m*a-c*u*h,r.z=c*m*h-y*u*a,r.w=c*m*a+y*u*h},t.RotationAlphaBetaGamma=function(i,n,r){var o=new t;return t.RotationAlphaBetaGammaToRef(i,n,r,o),o},t.RotationAlphaBetaGammaToRef=function(t,i,n,r){var o=.5*(n+t),s=.5*(n-t),e=.5*i;r.x=Math.cos(s)*Math.sin(e),r.y=Math.sin(s)*Math.sin(e),r.z=Math.sin(o)*Math.cos(e),r.w=Math.cos(o)*Math.cos(e)},t.Slerp=function(i,n,r){var o,s,e=r,h=i.x*n.x+i.y*n.y+i.z*n.z+i.w*n.w,a=!1;if(0>h&&(a=!0,h=-h),h>.999999)s=1-e,o=a?-e:e;else{var u=Math.acos(h),m=1/Math.sin(u);s=Math.sin((1-e)*u)*m,o=a?-Math.sin(e*u)*m:Math.sin(e*u)*m}return new t(s*i.x+o*n.x,s*i.y+o*n.y,s*i.z+o*n.z,s*i.w+o*n.w)},t}();t.Quaternion=a;var u=function(){function t(){this.m=new Float32Array(16)}return t.prototype.isIdentity=function(){return 1!==this.m[0]||1!==this.m[5]||1!==this.m[10]||1!==this.m[15]?!1:0===this.m[1]&&0===this.m[2]&&0===this.m[3]&&0===this.m[4]&&0===this.m[6]&&0===this.m[7]&&0===this.m[8]&&0===this.m[9]&&0===this.m[11]&&0===this.m[12]&&0===this.m[13]&&0===this.m[14]},t.prototype.determinant=function(){var t=this.m[10]*this.m[15]-this.m[11]*this.m[14],i=this.m[9]*this.m[15]-this.m[11]*this.m[13],n=this.m[9]*this.m[14]-this.m[10]*this.m[13],r=this.m[8]*this.m[15]-this.m[11]*this.m[12],o=this.m[8]*this.m[14]-this.m[10]*this.m[12],s=this.m[8]*this.m[13]-this.m[9]*this.m[12];return this.m[0]*(this.m[5]*t-this.m[6]*i+this.m[7]*n)-this.m[1]*(this.m[4]*t-this.m[6]*r+this.m[7]*o)+this.m[2]*(this.m[4]*i-this.m[5]*r+this.m[7]*s)-this.m[3]*(this.m[4]*n-this.m[5]*o+this.m[6]*s)},t.prototype.toArray=function(){return this.m},t.prototype.asArray=function(){return this.toArray()},t.prototype.invert=function(){return this.invertToRef(this),this},t.prototype.reset=function(){for(var t=0;16>t;t++)this.m[t]=0;return this},t.prototype.add=function(i){var n=new t;return this.addToRef(i,n),n},t.prototype.addToRef=function(t,i){for(var n=0;16>n;n++)i.m[n]=this.m[n]+t.m[n];return this},t.prototype.addToSelf=function(t){for(var i=0;16>i;i++)this.m[i]+=t.m[i];return this},t.prototype.invertToRef=function(t){var i=this.m[0],n=this.m[1],r=this.m[2],o=this.m[3],s=this.m[4],e=this.m[5],h=this.m[6],a=this.m[7],u=this.m[8],m=this.m[9],y=this.m[10],c=this.m[11],p=this.m[12],f=this.m[13],l=this.m[14],x=this.m[15],z=y*x-c*l,w=m*x-c*f,v=m*l-y*f,d=u*x-c*p,g=u*l-y*p,T=u*f-m*p,R=e*z-h*w+a*v,_=-(s*z-h*d+a*g),M=s*w-e*d+a*T,b=-(s*v-e*g+h*T),F=1/(i*R+n*_+r*M+o*b),A=h*x-a*l,L=e*x-a*f,P=e*l-h*f,C=s*x-a*p,Z=s*l-h*p,S=s*f-e*p,I=h*c-a*y,q=e*c-a*m,H=e*y-h*m,N=s*c-a*u,V=s*y-h*u,D=s*m-e*u;return t.m[0]=R*F,t.m[4]=_*F,t.m[8]=M*F,t.m[12]=b*F,t.m[1]=-(n*z-r*w+o*v)*F,t.m[5]=(i*z-r*d+o*g)*F,t.m[9]=-(i*w-n*d+o*T)*F,t.m[13]=(i*v-n*g+r*T)*F,t.m[2]=(n*A-r*L+o*P)*F,t.m[6]=-(i*A-r*C+o*Z)*F,t.m[10]=(i*L-n*C+o*S)*F,t.m[14]=-(i*P-n*Z+r*S)*F,t.m[3]=-(n*I-r*q+o*H)*F,t.m[7]=(i*I-r*N+o*V)*F,t.m[11]=-(i*q-n*N+o*D)*F,t.m[15]=(i*H-n*V+r*D)*F,this},t.prototype.setTranslation=function(t){return this.m[12]=t.x,this.m[13]=t.y,this.m[14]=t.z,this},t.prototype.getTranslation=function(){return new s(this.m[12],this.m[13],this.m[14])},t.prototype.multiply=function(i){var n=new t;return this.multiplyToRef(i,n),n},t.prototype.copyFrom=function(t){for(var i=0;16>i;i++)this.m[i]=t.m[i];return this},t.prototype.copyToArray=function(t,i){void 0===i&&(i=0);for(var n=0;16>n;n++)t[i+n]=this.m[n];return this},t.prototype.multiplyToRef=function(t,i){return this.multiplyToArray(t,i.m,0),this},t.prototype.multiplyToArray=function(t,i,n){var r=this.m[0],o=this.m[1],s=this.m[2],e=this.m[3],h=this.m[4],a=this.m[5],u=this.m[6],m=this.m[7],y=this.m[8],c=this.m[9],p=this.m[10],f=this.m[11],l=this.m[12],x=this.m[13],z=this.m[14],w=this.m[15],v=t.m[0],d=t.m[1],g=t.m[2],T=t.m[3],R=t.m[4],_=t.m[5],M=t.m[6],b=t.m[7],F=t.m[8],A=t.m[9],L=t.m[10],P=t.m[11],C=t.m[12],Z=t.m[13],S=t.m[14],I=t.m[15];return i[n]=r*v+o*R+s*F+e*C,i[n+1]=r*d+o*_+s*A+e*Z,i[n+2]=r*g+o*M+s*L+e*S,i[n+3]=r*T+o*b+s*P+e*I,i[n+4]=h*v+a*R+u*F+m*C,i[n+5]=h*d+a*_+u*A+m*Z,i[n+6]=h*g+a*M+u*L+m*S,i[n+7]=h*T+a*b+u*P+m*I,i[n+8]=y*v+c*R+p*F+f*C,\ni[n+9]=y*d+c*_+p*A+f*Z,i[n+10]=y*g+c*M+p*L+f*S,i[n+11]=y*T+c*b+p*P+f*I,i[n+12]=l*v+x*R+z*F+w*C,i[n+13]=l*d+x*_+z*A+w*Z,i[n+14]=l*g+x*M+z*L+w*S,i[n+15]=l*T+x*b+z*P+w*I,this},t.prototype.equals=function(t){return t&&this.m[0]===t.m[0]&&this.m[1]===t.m[1]&&this.m[2]===t.m[2]&&this.m[3]===t.m[3]&&this.m[4]===t.m[4]&&this.m[5]===t.m[5]&&this.m[6]===t.m[6]&&this.m[7]===t.m[7]&&this.m[8]===t.m[8]&&this.m[9]===t.m[9]&&this.m[10]===t.m[10]&&this.m[11]===t.m[11]&&this.m[12]===t.m[12]&&this.m[13]===t.m[13]&&this.m[14]===t.m[14]&&this.m[15]===t.m[15]},t.prototype.clone=function(){return t.FromValues(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5],this.m[6],this.m[7],this.m[8],this.m[9],this.m[10],this.m[11],this.m[12],this.m[13],this.m[14],this.m[15])},t.prototype.getClassName=function(){return"Matrix"},t.prototype.getHashCode=function(){for(var t=this.m[0]||0,i=1;16>i;i++)t=397*t^(this.m[i]||0);return t},t.prototype.decompose=function(n,r,o){o.x=this.m[12],o.y=this.m[13],o.z=this.m[14];var s=i.Sign(this.m[0]*this.m[1]*this.m[2]*this.m[3])<0?-1:1,e=i.Sign(this.m[4]*this.m[5]*this.m[6]*this.m[7])<0?-1:1,h=i.Sign(this.m[8]*this.m[9]*this.m[10]*this.m[11])<0?-1:1;if(n.x=s*Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),n.y=e*Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),n.z=h*Math.sqrt(this.m[8]*this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),0===n.x||0===n.y||0===n.z)return r.x=0,r.y=0,r.z=0,r.w=1,!1;var u=t.FromValues(this.m[0]/n.x,this.m[1]/n.x,this.m[2]/n.x,0,this.m[4]/n.y,this.m[5]/n.y,this.m[6]/n.y,0,this.m[8]/n.z,this.m[9]/n.z,this.m[10]/n.z,0,0,0,0,1);return a.FromRotationMatrixToRef(u,r),!0},t.FromArray=function(i,n){var r=new t;return n||(n=0),t.FromArrayToRef(i,n,r),r},t.FromArrayToRef=function(t,i,n){for(var r=0;16>r;r++)n.m[r]=t[r+i]},t.FromFloat32ArrayToRefScaled=function(t,i,n,r){for(var o=0;16>o;o++)r.m[o]=t[o+i]*n},t.FromValuesToRef=function(t,i,n,r,o,s,e,h,a,u,m,y,c,p,f,l,x){x.m[0]=t,x.m[1]=i,x.m[2]=n,x.m[3]=r,x.m[4]=o,x.m[5]=s,x.m[6]=e,x.m[7]=h,x.m[8]=a,x.m[9]=u,x.m[10]=m,x.m[11]=y,x.m[12]=c,x.m[13]=p,x.m[14]=f,x.m[15]=l},t.prototype.getRow=function(t){if(0>t||t>3)return null;var i=4*t;return new e(this.m[i+0],this.m[i+1],this.m[i+2],this.m[i+3])},t.prototype.setRow=function(t,i){if(0>t||t>3)return this;var n=4*t;return this.m[n+0]=i.x,this.m[n+1]=i.y,this.m[n+2]=i.z,this.m[n+3]=i.w,this},t.FromValues=function(i,n,r,o,s,e,h,a,u,m,y,c,p,f,l,x){var z=new t;return z.m[0]=i,z.m[1]=n,z.m[2]=r,z.m[3]=o,z.m[4]=s,z.m[5]=e,z.m[6]=h,z.m[7]=a,z.m[8]=u,z.m[9]=m,z.m[10]=y,z.m[11]=c,z.m[12]=p,z.m[13]=f,z.m[14]=l,z.m[15]=x,z},t.Compose=function(i,n,r){var o=t.FromValues(i.x,0,0,0,0,i.y,0,0,0,0,i.z,0,0,0,0,1),s=t.Identity();return n.toRotationMatrix(s),o=o.multiply(s),o.setTranslation(r),o},t.Identity=function(){return t.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},t.IdentityToRef=function(i){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,i)},t.Zero=function(){return t.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},t.RotationX=function(i){var n=new t;return t.RotationXToRef(i,n),n},t.Invert=function(i){var n=new t;return i.invertToRef(n),n},t.RotationXToRef=function(t,i){var n=Math.sin(t),r=Math.cos(t);i.m[0]=1,i.m[15]=1,i.m[5]=r,i.m[10]=r,i.m[9]=-n,i.m[6]=n,i.m[1]=0,i.m[2]=0,i.m[3]=0,i.m[4]=0,i.m[7]=0,i.m[8]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},t.RotationY=function(i){var n=new t;return t.RotationYToRef(i,n),n},t.RotationYToRef=function(t,i){var n=Math.sin(t),r=Math.cos(t);i.m[5]=1,i.m[15]=1,i.m[0]=r,i.m[2]=-n,i.m[8]=n,i.m[10]=r,i.m[1]=0,i.m[3]=0,i.m[4]=0,i.m[6]=0,i.m[7]=0,i.m[9]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},t.RotationZ=function(i){var n=new t;return t.RotationZToRef(i,n),n},t.RotationZToRef=function(t,i){var n=Math.sin(t),r=Math.cos(t);i.m[10]=1,i.m[15]=1,i.m[0]=r,i.m[1]=n,i.m[4]=-n,i.m[5]=r,i.m[2]=0,i.m[3]=0,i.m[6]=0,i.m[7]=0,i.m[8]=0,i.m[9]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},t.RotationAxis=function(i,n){var r=t.Zero();return t.RotationAxisToRef(i,n,r),r},t.RotationAxisToRef=function(t,i,n){var r=Math.sin(-i),o=Math.cos(-i),s=1-o;t.normalize(),n.m[0]=t.x*t.x*s+o,n.m[1]=t.x*t.y*s-t.z*r,n.m[2]=t.x*t.z*s+t.y*r,n.m[3]=0,n.m[4]=t.y*t.x*s+t.z*r,n.m[5]=t.y*t.y*s+o,n.m[6]=t.y*t.z*s-t.x*r,n.m[7]=0,n.m[8]=t.z*t.x*s-t.y*r,n.m[9]=t.z*t.y*s+t.x*r,n.m[10]=t.z*t.z*s+o,n.m[11]=0,n.m[15]=1},t.RotationYawPitchRoll=function(i,n,r){var o=new t;return t.RotationYawPitchRollToRef(i,n,r,o),o},t.RotationYawPitchRollToRef=function(t,i,n,r){a.RotationYawPitchRollToRef(t,i,n,this._tempQuaternion),this._tempQuaternion.toRotationMatrix(r)},t.Scaling=function(i,n,r){var o=t.Zero();return t.ScalingToRef(i,n,r,o),o},t.ScalingToRef=function(t,i,n,r){r.m[0]=t,r.m[1]=0,r.m[2]=0,r.m[3]=0,r.m[4]=0,r.m[5]=i,r.m[6]=0,r.m[7]=0,r.m[8]=0,r.m[9]=0,r.m[10]=n,r.m[11]=0,r.m[12]=0,r.m[13]=0,r.m[14]=0,r.m[15]=1},t.Translation=function(i,n,r){var o=t.Identity();return t.TranslationToRef(i,n,r,o),o},t.TranslationToRef=function(i,n,r,o){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,i,n,r,1,o)},t.Lerp=function(i,n,r){for(var o=t.Zero(),s=0;16>s;s++)o.m[s]=i.m[s]*(1-r)+n.m[s]*r;return o},t.DecomposeLerp=function(i,n,r){var o=new s(0,0,0),e=new a,h=new s(0,0,0);i.decompose(o,e,h);var u=new s(0,0,0),m=new a,y=new s(0,0,0);n.decompose(u,m,y);var c=s.Lerp(o,u,r),p=a.Slerp(e,m,r),f=s.Lerp(h,y,r);return t.Compose(c,p,f)},t.LookAtLH=function(i,n,r){var o=t.Zero();return t.LookAtLHToRef(i,n,r,o),o},t.LookAtLHToRef=function(i,n,r,o){n.subtractToRef(i,this._zAxis),this._zAxis.normalize(),s.CrossToRef(r,this._zAxis,this._xAxis),0===this._xAxis.lengthSquared()?this._xAxis.x=1:this._xAxis.normalize(),s.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var e=-s.Dot(this._xAxis,i),h=-s.Dot(this._yAxis,i),a=-s.Dot(this._zAxis,i);return t.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,e,h,a,1,o)},t.OrthoLH=function(i,n,r,o){var s=t.Zero();return t.OrthoLHToRef(i,n,r,o,s),s},t.OrthoLHToRef=function(i,n,r,o,s){var e=2/i,h=2/n,a=1/(o-r),u=r/(r-o);t.FromValuesToRef(e,0,0,0,0,h,0,0,0,0,a,0,0,0,u,1,s)},t.OrthoOffCenterLH=function(i,n,r,o,s,e){var h=t.Zero();return t.OrthoOffCenterLHToRef(i,n,r,o,s,e,h),h},t.OrthoOffCenterLHToRef=function(t,i,n,r,o,s,e){e.m[0]=2/(i-t),e.m[1]=e.m[2]=e.m[3]=0,e.m[5]=2/(r-n),e.m[4]=e.m[6]=e.m[7]=0,e.m[10]=-1/(o-s),e.m[8]=e.m[9]=e.m[11]=0,e.m[12]=(t+i)/(t-i),e.m[13]=(r+n)/(n-r),e.m[14]=o/(o-s),e.m[15]=1},t.PerspectiveLH=function(i,n,r,o){var s=t.Zero();return s.m[0]=2*r/i,s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=2*r/n,s.m[4]=s.m[6]=s.m[7]=0,s.m[10]=-o/(r-o),s.m[8]=s.m[9]=0,s.m[11]=1,s.m[12]=s.m[13]=s.m[15]=0,s.m[14]=r*o/(r-o),s},t.PerspectiveFovLH=function(i,n,r,o){var s=t.Zero();return t.PerspectiveFovLHToRef(i,n,r,o,s),s},t.PerspectiveFovLHToRef=function(t,i,n,r,o,s){void 0===s&&(s=!0);var e=1/Math.tan(.5*t);s?o.m[0]=e/i:o.m[0]=e,o.m[1]=o.m[2]=o.m[3]=0,s?o.m[5]=e:o.m[5]=e*i,o.m[4]=o.m[6]=o.m[7]=0,o.m[8]=o.m[9]=0,o.m[10]=-r/(n-r),o.m[11]=1,o.m[12]=o.m[13]=o.m[15]=0,o.m[14]=n*r/(n-r)},t.GetFinalMatrix=function(i,n,r,o,s,e){var h=i.width,a=i.height,u=i.x,m=i.y,y=t.FromValues(h/2,0,0,0,0,-a/2,0,0,0,0,e-s,0,u+h/2,a/2+m,s,1);return n.multiply(r).multiply(o).multiply(y)},t.GetAsMatrix2x2=function(t){return new Float32Array([t.m[0],t.m[1],t.m[4],t.m[5]])},t.GetAsMatrix3x3=function(t){return new Float32Array([t.m[0],t.m[1],t.m[2],t.m[4],t.m[5],t.m[6],t.m[8],t.m[9],t.m[10]])},t.Transpose=function(i){var n=new t;return n.m[0]=i.m[0],n.m[1]=i.m[4],n.m[2]=i.m[8],n.m[3]=i.m[12],n.m[4]=i.m[1],n.m[5]=i.m[5],n.m[6]=i.m[9],n.m[7]=i.m[13],n.m[8]=i.m[2],n.m[9]=i.m[6],n.m[10]=i.m[10],n.m[11]=i.m[14],n.m[12]=i.m[3],n.m[13]=i.m[7],n.m[14]=i.m[11],n.m[15]=i.m[15],n},t.Reflection=function(i){var n=new t;return t.ReflectionToRef(i,n),n},t.ReflectionToRef=function(t,i){t.normalize();var n=t.normal.x,r=t.normal.y,o=t.normal.z,s=-2*n,e=-2*r,h=-2*o;i.m[0]=s*n+1,i.m[1]=e*n,i.m[2]=h*n,i.m[3]=0,i.m[4]=s*r,i.m[5]=e*r+1,i.m[6]=h*r,i.m[7]=0,i.m[8]=s*o,i.m[9]=e*o,i.m[10]=h*o+1,i.m[11]=0,i.m[12]=s*t.d,i.m[13]=e*t.d,i.m[14]=h*t.d,i.m[15]=1},t._tempQuaternion=new a,t._xAxis=s.Zero(),t._yAxis=s.Zero(),t._zAxis=s.Zero(),t}();t.Matrix=u;var m=function(){function t(t,i,n,r){this.normal=new s(t,i,n),this.d=r}return t.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},t.prototype.clone=function(){return new t(this.normal.x,this.normal.y,this.normal.z,this.d)},t.prototype.getClassName=function(){return"Plane"},t.prototype.getHashCode=function(){var t=this.normal.getHashCode();return t=397*t^(this.d||0)},t.prototype.normalize=function(){var t=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),i=0;return 0!==t&&(i=1/t),this.normal.x*=i,this.normal.y*=i,this.normal.z*=i,this.d*=i,this},t.prototype.transform=function(i){var n=u.Transpose(i),r=this.normal.x,o=this.normal.y,s=this.normal.z,e=this.d,h=r*n.m[0]+o*n.m[1]+s*n.m[2]+e*n.m[3],a=r*n.m[4]+o*n.m[5]+s*n.m[6]+e*n.m[7],m=r*n.m[8]+o*n.m[9]+s*n.m[10]+e*n.m[11],y=r*n.m[12]+o*n.m[13]+s*n.m[14]+e*n.m[15];return new t(h,a,m,y)},t.prototype.dotCoordinate=function(t){return this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.d},t.prototype.copyFromPoints=function(t,i,n){var r,o=i.x-t.x,s=i.y-t.y,e=i.z-t.z,h=n.x-t.x,a=n.y-t.y,u=n.z-t.z,m=s*u-e*a,y=e*h-o*u,c=o*a-s*h,p=Math.sqrt(m*m+y*y+c*c);return r=0!==p?1/p:0,this.normal.x=m*r,this.normal.y=y*r,this.normal.z=c*r,this.d=-(this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z),this},t.prototype.isFrontFacingTo=function(t,i){var n=s.Dot(this.normal,t);return i>=n},t.prototype.signedDistanceTo=function(t){return s.Dot(t,this.normal)+this.d},t.FromArray=function(i){return new t(i[0],i[1],i[2],i[3])},t.FromPoints=function(i,n,r){var o=new t(0,0,0,0);return o.copyFromPoints(i,n,r),o},t.FromPositionAndNormal=function(i,n){var r=new t(0,0,0,0);return n.normalize(),r.normal=n,r.d=-(n.x*i.x+n.y*i.y+n.z*i.z),r},t.SignedDistanceToPlaneFromPositionAndNormal=function(t,i,n){var r=-(i.x*t.x+i.y*t.y+i.z*t.z);return s.Dot(n,i)+r},t}();t.Plane=m;var y=function(){function t(t,i,n,r){this.x=t,this.y=i,this.width=n,this.height=r}return t.prototype.toGlobal=function(i,n){return new t(this.x*i,this.y*n,this.width*i,this.height*n)},t}();t.Viewport=y;var c=function(){function t(){}return t.GetPlanes=function(i){for(var n=[],r=0;6>r;r++)n.push(new m(0,0,0,0));return t.GetPlanesToRef(i,n),n},t.GetPlanesToRef=function(t,i){i[0].normal.x=t.m[3]+t.m[2],i[0].normal.y=t.m[7]+t.m[6],i[0].normal.z=t.m[11]+t.m[10],i[0].d=t.m[15]+t.m[14],i[0].normalize(),i[1].normal.x=t.m[3]-t.m[2],i[1].normal.y=t.m[7]-t.m[6],i[1].normal.z=t.m[11]-t.m[10],i[1].d=t.m[15]-t.m[14],i[1].normalize(),i[2].normal.x=t.m[3]+t.m[0],i[2].normal.y=t.m[7]+t.m[4],i[2].normal.z=t.m[11]+t.m[8],i[2].d=t.m[15]+t.m[12],i[2].normalize(),i[3].normal.x=t.m[3]-t.m[0],i[3].normal.y=t.m[7]-t.m[4],i[3].normal.z=t.m[11]-t.m[8],i[3].d=t.m[15]-t.m[12],i[3].normalize(),i[4].normal.x=t.m[3]-t.m[1],i[4].normal.y=t.m[7]-t.m[5],i[4].normal.z=t.m[11]-t.m[9],i[4].d=t.m[15]-t.m[13],i[4].normalize(),i[5].normal.x=t.m[3]+t.m[1],i[5].normal.y=t.m[7]+t.m[5],i[5].normal.z=t.m[11]+t.m[9],i[5].d=t.m[15]+t.m[13],i[5].normalize()},t}();t.Frustum=c,function(t){t[t.LOCAL=0]="LOCAL",t[t.WORLD=1]="WORLD"}(t.Space||(t.Space={}));var p=(t.Space,function(){function t(){}return t.X=new s(1,0,0),t.Y=new s(0,1,0),t.Z=new s(0,0,1),t}());t.Axis=p;var f=function(){function t(){}return t.interpolate=function(t,i,n,r,o){for(var s=1-3*r+3*i,e=3*r-6*i,h=3*i,a=t,u=0;5>u;u++){var m=a*a,y=m*a,c=s*y+e*m+h*a,p=1/(3*s*m+2*e*a+h);a-=(c-t)*p,a=Math.min(1,Math.max(0,a))}return 3*Math.pow(1-a,2)*a*n+3*(1-a)*Math.pow(a,2)*o+Math.pow(a,3)},t}();t.BezierCurve=f,function(t){t[t.CW=0]="CW",t[t.CCW=1]="CCW"}(t.Orientation||(t.Orientation={}));var l=t.Orientation,x=function(){function t(t){var i=this;this.degrees=function(){return 180*i._radians/Math.PI},this.radians=function(){return i._radians},this._radians=t,this._radians<0&&(this._radians+=2*Math.PI)}return t.BetweenTwoPoints=function(i,n){var r=n.subtract(i),o=Math.atan2(r.y,r.x);return new t(o)},t.FromRadians=function(i){return new t(i)},t.FromDegrees=function(i){return new t(i*Math.PI/180)},t}();t.Angle=x;var z=function(){function t(t,i,n){this.startPoint=t,this.midPoint=i,this.endPoint=n;var r=Math.pow(i.x,2)+Math.pow(i.y,2),s=(Math.pow(t.x,2)+Math.pow(t.y,2)-r)/2,e=(r-Math.pow(n.x,2)-Math.pow(n.y,2))/2,h=(t.x-i.x)*(i.y-n.y)-(i.x-n.x)*(t.y-i.y);this.centerPoint=new o((s*(i.y-n.y)-e*(t.y-i.y))/h,((t.x-i.x)*e-(i.x-n.x)*s)/h),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=x.BetweenTwoPoints(this.centerPoint,this.startPoint);var a=this.startAngle.degrees(),u=x.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),m=x.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();u-a>180&&(u-=360),-180>u-a&&(u+=360),m-u>180&&(m-=360),-180>m-u&&(m+=360),this.orientation=0>u-a?l.CW:l.CCW,this.angle=x.FromDegrees(this.orientation===l.CW?a-m:m-a)}return t}();t.Arc2=z;var w=function(){function t(t,i){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new o(t,i))}return t.prototype.addLineTo=function(t,i){if(closed)return this;var n=new o(t,i),r=this._points[this._points.length-1];return this._points.push(n),this._length+=n.subtract(r).length(),this},t.prototype.addArcTo=function(t,i,n,r,s){if(void 0===s&&(s=36),closed)return this;var e=this._points[this._points.length-1],h=new o(t,i),a=new o(n,r),u=new z(e,h,a),m=u.angle.radians()/s;u.orientation===l.CW&&(m*=-1);for(var y=u.startAngle.radians()+m,c=0;s>c;c++){var p=Math.cos(y)*u.radius+u.centerPoint.x,f=Math.sin(y)*u.radius+u.centerPoint.y;this.addLineTo(p,f),y+=m}return this},t.prototype.close=function(){return this.closed=!0,this},t.prototype.length=function(){var t=this._length;if(!this.closed){var i=this._points[this._points.length-1],n=this._points[0];t+=n.subtract(i).length()}return t},t.prototype.getPoints=function(){return this._points},t.prototype.getPointAtLengthPosition=function(t){if(0>t||t>1)return o.Zero();for(var i=t*this.length(),n=0,r=0;r<this._points.length;r++){var s=(r+1)%this._points.length,e=this._points[r],h=this._points[s],a=h.subtract(e),u=a.length()+n;if(i>=n&&u>=i){var m=a.normalize(),y=i-n;return new o(e.x+m.x*y,e.y+m.y*y)}n=u}return o.Zero()},t.StartingAt=function(i,n){return new t(i,n)},t}();t.Path2=w;var v=function(){function n(t,i,n){this.path=t,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var r=0;r<t.length;r++)this._curve[r]=t[r].clone();this._raw=n||!1,this._compute(i)}return n.prototype.getCurve=function(){return this._curve},n.prototype.getTangents=function(){return this._tangents},n.prototype.getNormals=function(){return this._normals},n.prototype.getBinormals=function(){return this._binormals},n.prototype.getDistances=function(){return this._distances},n.prototype.update=function(t,i){for(var n=0;n<t.length;n++)this._curve[n].x=t[n].x,this._curve[n].y=t[n].y,this._curve[n].z=t[n].z;return this._compute(i),this},n.prototype._compute=function(t){var i=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[i-1]=this._curve[i-1].subtract(this._curve[i-2]),this._raw||this._tangents[i-1].normalize();var n=this._tangents[0],r=this._normalVector(this._curve[0],n,t);this._normals[0]=r,this._raw||this._normals[0].normalize(),this._binormals[0]=s.Cross(n,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var o,e,h,a,u=1;i>u;u++)o=this._getLastNonNullVector(u),i-1>u&&(e=this._getFirstNonNullVector(u),this._tangents[u]=o.add(e),this._tangents[u].normalize()),this._distances[u]=this._distances[u-1]+o.length(),h=this._tangents[u],a=this._binormals[u-1],this._normals[u]=s.Cross(a,h),this._raw||this._normals[u].normalize(),this._binormals[u]=s.Cross(h,this._normals[u]),this._raw||this._binormals[u].normalize()},n.prototype._getFirstNonNullVector=function(t){for(var i=1,n=this._curve[t+i].subtract(this._curve[t]);0===n.length()&&t+i+1<this._curve.length;)i++,n=this._curve[t+i].subtract(this._curve[t]);return n},n.prototype._getLastNonNullVector=function(t){for(var i=1,n=this._curve[t].subtract(this._curve[t-i]);0===n.length()&&t>i+1;)i++,n=this._curve[t].subtract(this._curve[t-i]);return n},n.prototype._normalVector=function(n,r,o){var e;if(void 0===o||null===o){var h;i.WithinEpsilon(r.y,1,t.Epsilon)?i.WithinEpsilon(r.x,1,t.Epsilon)?i.WithinEpsilon(r.z,1,t.Epsilon)||(h=new s(0,0,1)):h=new s(1,0,0):h=new s(0,-1,0),e=s.Cross(r,h)}else e=s.Cross(r,o),s.CrossToRef(e,r,e);return e.normalize(),e},n}();t.Path3D=v;var d=function(){function t(t){this._length=0,this._points=t,this._length=this._computeLength(t)}return t.CreateQuadraticBezier=function(i,n,r,o){o=o>2?o:3;for(var e=new Array,h=function(t,i,n,r){var o=(1-t)*(1-t)*i+2*t*(1-t)*n+t*t*r;return o},a=0;o>=a;a++)e.push(new s(h(a/o,i.x,n.x,r.x),h(a/o,i.y,n.y,r.y),h(a/o,i.z,n.z,r.z)));return new t(e)},t.CreateCubicBezier=function(i,n,r,o,e){e=e>3?e:4;for(var h=new Array,a=function(t,i,n,r,o){var s=(1-t)*(1-t)*(1-t)*i+3*t*(1-t)*(1-t)*n+3*t*t*(1-t)*r+t*t*t*o;return s},u=0;e>=u;u++)h.push(new s(a(u/e,i.x,n.x,r.x,o.x),a(u/e,i.y,n.y,r.y,o.y),a(u/e,i.z,n.z,r.z,o.z)));return new t(h)},t.CreateHermiteSpline=function(i,n,r,o,e){for(var h=new Array,a=1/e,u=0;e>=u;u++)h.push(s.Hermite(i,n,r,o,u*a));return new t(h)},t.prototype.getPoints=function(){return this._points},t.prototype.length=function(){return this._length},t.prototype["continue"]=function(i){for(var n=this._points[this._points.length-1],r=this._points.slice(),o=i.getPoints(),s=1;s<o.length;s++)r.push(o[s].subtract(o[0]).add(n));var e=new t(r);return e},t.prototype._computeLength=function(t){for(var i=0,n=1;n<t.length;n++)i+=t[n].subtract(t[n-1]).length();return i},t}();t.Curve3=d;var g=function(){function t(){this.L00=s.Zero(),this.L1_1=s.Zero(),this.L10=s.Zero(),this.L11=s.Zero(),this.L2_2=s.Zero(),this.L2_1=s.Zero(),this.L20=s.Zero(),this.L21=s.Zero(),this.L22=s.Zero()}return t.prototype.addLight=function(t,i,n){var r=new s(i.r,i.g,i.b),o=r.scale(n);this.L00=this.L00.add(o.scale(.282095)),this.L1_1=this.L1_1.add(o.scale(.488603*t.y)),this.L10=this.L10.add(o.scale(.488603*t.z)),this.L11=this.L11.add(o.scale(.488603*t.x)),this.L2_2=this.L2_2.add(o.scale(1.092548*t.x*t.y)),this.L2_1=this.L2_1.add(o.scale(1.092548*t.y*t.z)),this.L21=this.L21.add(o.scale(1.092548*t.x*t.z)),this.L20=this.L20.add(o.scale(.315392*(3*t.z*t.z-1))),this.L22=this.L22.add(o.scale(.546274*(t.x*t.x-t.y*t.y)))},t.prototype.scale=function(t){this.L00=this.L00.scale(t),this.L1_1=this.L1_1.scale(t),this.L10=this.L10.scale(t),this.L11=this.L11.scale(t),this.L2_2=this.L2_2.scale(t),this.L2_1=this.L2_1.scale(t),this.L20=this.L20.scale(t),this.L21=this.L21.scale(t),this.L22=this.L22.scale(t)},t}();t.SphericalHarmonics=g;var T=function(){function t(){this.x=s.Zero(),this.y=s.Zero(),this.z=s.Zero(),this.xx=s.Zero(),this.yy=s.Zero(),this.zz=s.Zero(),this.xy=s.Zero(),this.yz=s.Zero(),this.zx=s.Zero()}return t.prototype.addAmbient=function(t){var i=new s(t.r,t.g,t.b);this.xx=this.xx.add(i),this.yy=this.yy.add(i),this.zz=this.zz.add(i)},t.getSphericalPolynomialFromHarmonics=function(i){var n=new t;return n.x=i.L11.scale(1.02333),n.y=i.L1_1.scale(1.02333),n.z=i.L10.scale(1.02333),n.xx=i.L00.scale(.886277).subtract(i.L20.scale(.247708)).add(i.L22.scale(.429043)),n.yy=i.L00.scale(.886277).subtract(i.L20.scale(.247708)).subtract(i.L22.scale(.429043)),n.zz=i.L00.scale(.886277).add(i.L20.scale(.495417)),n.yz=i.L2_1.scale(.858086),n.zx=i.L21.scale(.858086),n.xy=i.L2_2.scale(.858086),n},t}();t.SphericalPolynomial=T;var R=function(){function t(t,i){void 0===t&&(t=s.Zero()),void 0===i&&(i=s.Up()),this.position=t,this.normal=i}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone())},t}();t.PositionNormalVertex=R;var _=function(){function t(t,i,n){void 0===t&&(t=s.Zero()),void 0===i&&(i=s.Up()),void 0===n&&(n=o.Zero()),this.position=t,this.normal=i,this.uv=n}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone(),this.uv.clone())},t}();t.PositionNormalTextureVertex=_;var M=function(){function t(){}return t.Color3=[n.Black(),n.Black(),n.Black()],t.Vector2=[o.Zero(),o.Zero(),o.Zero()],t.Vector3=[s.Zero(),s.Zero(),s.Zero(),s.Zero(),s.Zero(),s.Zero(),s.Zero(),s.Zero(),s.Zero()],t.Vector4=[e.Zero(),e.Zero(),e.Zero()],t.Quaternion=[new a(0,0,0,0)],t.Matrix=[u.Zero(),u.Zero(),u.Zero(),u.Zero(),u.Zero(),u.Zero(),u.Zero(),u.Zero()],t}();t.Tmp=M}(BABYLON||(BABYLON={}));';
("undefined"!=typeof window&&window.module||"undefined"!=typeof module)&&"undefined"!=typeof module.exports&&(module.exports=BABYLON);var OIMO={REVISION:"1.2",nextID:0,proxyID:0,BR_NULL:0,BR_BRUTE_FORCE:1,BR_SWEEP_AND_PRUNE:2,BR_BOUNDING_VOLUME_TREE:3,BODY_NULL:0,BODY_DYNAMIC:1,BODY_STATIC:2,SHAPE_NULL:0,SHAPE_SPHERE:1,SHAPE_BOX:2,SHAPE_CYLINDER:3,SHAPE_TETRA:4,JOINT_NULL:0,JOINT_DISTANCE:1,JOINT_BALL_AND_SOCKET:2,JOINT_HINGE:3,JOINT_WHEEL:4,JOINT_SLIDER:5,JOINT_PRISMATIC:6,WORLD_SCALE:100,INV_SCALE:0.01,AABB_PROX:0.0050,sqrt:Math.sqrt,abs:Math.abs,floor:Math.floor,cos:Math.cos,sin:Math.sin,acos:Math.acos,asin:Math.asin,atan2:Math.atan2,
round:Math.round,pow:Math.pow,max:Math.max,min:Math.min,random:Math.random,lerp:function(b,f,e){return b+(f-b)*e},rand:function(b,f){return OIMO.lerp(b,f,OIMO.random())},randInt:function(b,f,e){return 1*OIMO.lerp(b,f,OIMO.random()).toFixed(e||0)},"int":function(b){return~~b},fix:function(b,f){return b.toFixed(f||3,10)},clamp:function(b,f,e){return OIMO.max(f,OIMO.min(e,b))},degtorad:0.017453292519943295,radtodeg:57.29577951308232,PI:3.141592653589793,TwoPI:6.283185307179586,PI90:1.570796326794896,
PI270:4.712388980384689,CustomError:null,Error:function(b,f){null==OIMO.CustomError?console.error(b,f):OIMO.CustomError.innerHTML+=b+" - "+f+"<br>"}},OIMO_ARRAY_TYPE;OIMO_ARRAY_TYPE||(OIMO_ARRAY_TYPE="undefined"!==typeof Float32Array?Float32Array:Array);
try{(function(b){var f,e=["now","webkitNow","msNow","mozNow"];if(b.performance)for(var c=0;c<e.length;++c){var d=e[c];if(b.performance[d]){f=function(){return b.performance[d]()};break}}f||(f=Date.now);OIMO.now=f})(window)}catch(e$$2549){OIMO.now=function(){return 0}}
OIMO.World=function(b,f,e,c){this.timeStep=b||0.01666;this.numIterations=e||8;switch(f||2){case 1:this.broadPhase=new OIMO.BruteForceBroadPhase;break;default:this.broadPhase=new OIMO.SAPBroadPhase;break;case 3:this.broadPhase=new OIMO.DBVTBroadPhase}this.performance=null;this.isNoStat=c||!1;this.isNoStat||(this.performance=new OIMO.Performance(this));this.enableRandomizer=!0;this.rigidBodies=null;this.numRigidBodies=0;this.unusedContacts=this.contacts=null;this.numContactPoints=this.numContacts=0;
this.joints=null;this.numIslands=this.numJoints=0;this.gravity=new OIMO.Vec3(0,-9.80665,0);this.detectors=[];for(b=this.detectors.length=5;b--;)this.detectors[b]=[],this.detectors[b].length=5;this.detectors[OIMO.SHAPE_SPHERE][OIMO.SHAPE_SPHERE]=new OIMO.SphereSphereCollisionDetector;this.detectors[OIMO.SHAPE_SPHERE][OIMO.SHAPE_BOX]=new OIMO.SphereBoxCollisionDetector(!1);this.detectors[OIMO.SHAPE_BOX][OIMO.SHAPE_SPHERE]=new OIMO.SphereBoxCollisionDetector(!0);this.detectors[OIMO.SHAPE_BOX][OIMO.SHAPE_BOX]=
new OIMO.BoxBoxCollisionDetector;this.detectors[OIMO.SHAPE_CYLINDER][OIMO.SHAPE_CYLINDER]=new OIMO.CylinderCylinderCollisionDetector;this.detectors[OIMO.SHAPE_CYLINDER][OIMO.SHAPE_BOX]=new OIMO.BoxCylinderCollisionDetector(!0);this.detectors[OIMO.SHAPE_BOX][OIMO.SHAPE_CYLINDER]=new OIMO.BoxCylinderCollisionDetector(!1);this.detectors[OIMO.SHAPE_CYLINDER][OIMO.SHAPE_SPHERE]=new OIMO.SphereCylinderCollisionDetector(!0);this.detectors[OIMO.SHAPE_SPHERE][OIMO.SHAPE_CYLINDER]=new OIMO.SphereCylinderCollisionDetector(!1);
this.detectors[OIMO.SHAPE_TETRA][OIMO.SHAPE_TETRA]=new OIMO.TetraTetraCollisionDetector;this.randX=65535;this.randA=98765;this.randB=123456789;this.islandRigidBodies=[];this.islandStack=[];this.islandConstraints=[]};
OIMO.World.prototype={constructor:OIMO.World,clear:function(){for(this.randX=65535;null!==this.joints;)this.removeJoint(this.joints);for(;null!==this.contacts;)this.removeContact(this.contacts);for(;null!==this.rigidBodies;)this.removeRigidBody(this.rigidBodies);OIMO.nextID=0;OIMO.proxyID=0},addRigidBody:function(b){b.parent&&OIMO.Error("World","It is not possible to be added to more than one world one of the rigid body");b.parent=this;b.awake();for(var f=b.shapes;null!==f;f=f.next)this.addShape(f);
null!==this.rigidBodies&&((this.rigidBodies.prev=b).next=this.rigidBodies);this.rigidBodies=b;this.numRigidBodies++},removeRigidBody:function(b){if(b.parent===this){b.awake();for(var f=b.jointLink;null!=f;){var e=f.joint,f=f.next;this.removeJoint(e)}for(f=b.shapes;null!==f;f=f.next)this.removeShape(f);f=b.prev;e=b.next;null!==f&&(f.next=e);null!==e&&(e.prev=f);this.rigidBodies==b&&(this.rigidBodies=e);b.prev=null;b.next=null;b.parent=null;this.numRigidBodies--}},getByName:function(b){for(var f=null,
e=this.rigidBodies;null!==e;)" "!==e.name&&e.name===b&&(f=e),e=e.next;for(e=this.joints;null!==e;)""!==e.name&&e.name===b&&(f=e),e=e.next;return f},addShape:function(b){(!b.parent||!b.parent.parent)&&OIMO.Error("World","It is not possible to be added alone to shape world");b.proxy=this.broadPhase.createProxy(b);b.updateProxy();this.broadPhase.addProxy(b.proxy)},removeShape:function(b){this.broadPhase.removeProxy(b.proxy);b.proxy=null},addJoint:function(b){b.parent&&OIMO.Error("World","It is not possible to be added to more than one world one of the joint");
null!=this.joints&&((this.joints.prev=b).next=this.joints);this.joints=b;b.parent=this;this.numJoints++;b.awake();b.attach()},removeJoint:function(b){var f=b.prev,e=b.next;null!==f&&(f.next=e);null!==e&&(e.prev=f);this.joints==b&&(this.joints=e);b.prev=null;b.next=null;this.numJoints--;b.awake();b.detach();b.parent=null},worldscale:function(b){OIMO.WORLD_SCALE=b||100;OIMO.INV_SCALE=1/OIMO.WORLD_SCALE},addContact:function(b,f){var e;null!==this.unusedContacts?(e=this.unusedContacts,this.unusedContacts=
this.unusedContacts.next):e=new OIMO.Contact;e.attach(b,f);e.detector=this.detectors[b.type][f.type];this.contacts&&((this.contacts.prev=e).next=this.contacts);this.contacts=e;this.numContacts++},removeContact:function(b){var f=b.prev,e=b.next;e&&(e.prev=f);f&&(f.next=e);this.contacts==b&&(this.contacts=e);b.prev=null;b.next=null;b.detach();b.next=this.unusedContacts;this.unusedContacts=b;this.numContacts--},checkContact:function(b,f){for(var e,c,d=this.contacts;null!==d;)if(e=d.body1.name||" ",c=
d.body2.name||" ",e==b&&c==f||c==b&&e==f){if(d.touching)return!0;break}else d=d.next;return!1},callSleep:function(b){return!b.allowSleep||0.04<b.linearVelocity.lengthSq()||0.25<b.angularVelocity.lengthSq()?!1:!0},step:function(){var b,f,e,c=!this.isNoStat?!0:!1;c&&(b=OIMO.now());for(var d=this.rigidBodies;null!==d;)d.addedToIsland=!1,d.sleeping&&(d.linearVelocity.testZero()||d.angularVelocity.testZero()||d.position.testDiff(d.sleepPosition)||d.orientation.testDiff(d.sleepOrientation))&&d.awake(),
d=d.next;c&&(f=OIMO.now());this.broadPhase.detectPairs();for(var g=this.broadPhase.pairs,m=this.broadPhase.numPairs;m--;){var j=g[m],l;j.shape1.id<j.shape2.id?(l=j.shape1,d=j.shape2):(l=j.shape2,d=j.shape1);var n;n=l.numContacts<d.numContacts?l.contactLink:d.contactLink;for(var q=!1;n;){j=n.contact;if(j.shape1==l&&j.shape2==d){q=j.persisting=!0;break}n=n.next}q||this.addContact(l,d)}c&&(e=OIMO.now(),this.performance.broadPhaseTime=e-f);this.numContactPoints=0;for(j=this.contacts;null!==j;)!j.persisting&&
j.shape1.aabb.intersectTest(j.shape2.aabb)?(n=j.next,this.removeContact(j),j=n):(f=j.body1,g=j.body2,(f.isDynamic&&!f.sleeping||g.isDynamic&&!g.sleeping)&&j.updateManifold(),this.numContactPoints+=j.manifold.numPoints,j.persisting=!1,j.constraint.addedToIsland=!1,j=j.next);c&&(f=OIMO.now(),this.performance.narrowPhaseTime=f-e);e=1/this.timeStep;for(f=this.joints;null!==f;f=f.next)f.addedToIsland=!1;this.islandRigidBodies=[];this.islandConstraints=[];this.islandStack=[];f=OIMO.now();this.numIslands=
0;for(g=this.rigidBodies;null!==g;g=g.next)if(!g.addedToIsland&&!g.isStatic&&!g.sleeping){if(g.isLonely())g.isDynamic&&g.linearVelocity.addTime(this.gravity,this.timeStep),this.callSleep(g)?(g.sleepTime+=this.timeStep,0.5<g.sleepTime?g.sleep():g.updatePosition(this.timeStep)):(g.sleepTime=0,g.updatePosition(this.timeStep));else{l=m=0;q=1;this.islandStack[0]=g;g.addedToIsland=!0;do if(d=this.islandStack[--q],this.islandStack[q]=null,d.sleeping=!1,this.islandRigidBodies[m++]=d,!d.isStatic){for(var p=
d.contactLink;null!==p;p=p.next)j=p.contact,n=j.constraint,!n.addedToIsland&&j.touching&&(this.islandConstraints[l++]=n,n.addedToIsland=!0,n=p.body,n.addedToIsland||(this.islandStack[q++]=n,n.addedToIsland=!0));for(j=d.jointLink;null!==j;j=j.next)n=j.joint,n.addedToIsland||(this.islandConstraints[l++]=n,n.addedToIsland=!0,n=j.body,!n.addedToIsland&&n.isDynamic&&(this.islandStack[q++]=n,n.addedToIsland=!0))}while(0!=q);n=(new OIMO.Vec3).addTime(this.gravity,this.timeStep);for(j=m;j--;)d=this.islandRigidBodies[j],
d.isDynamic&&d.linearVelocity.addEqual(n);if(this.enableRandomizer)for(j=l;j--;)0!==j&&(d=(this.randX=this.randX*this.randA+this.randB&2147483647)/2147483648*j|0,n=this.islandConstraints[j],this.islandConstraints[j]=this.islandConstraints[d],this.islandConstraints[d]=n);for(j=l;j--;)this.islandConstraints[j].preSolve(this.timeStep,e);for(d=this.numIterations;d--;)for(j=l;j--;)this.islandConstraints[j].solve();for(j=l;j--;)this.islandConstraints[j].postSolve(),this.islandConstraints[j]=null;l=10;for(j=
m;j--;)d=this.islandRigidBodies[j],this.callSleep(d)?(d.sleepTime+=this.timeStep,d.sleepTime<l&&(l=d.sleepTime)):l=d.sleepTime=0;if(0.5<l)for(j=m;j--;)this.islandRigidBodies[j].sleep(),this.islandRigidBodies[j]=null;else for(j=m;j--;)this.islandRigidBodies[j].updatePosition(this.timeStep),this.islandRigidBodies[j]=null}this.numIslands++}c&&(e=OIMO.now(),this.performance.solvingTime=e-f,e=OIMO.now(),this.performance.upfps(),this.performance.totalTime=e-b)}};
OIMO.RigidBody=function(b,f,e,c,d,g,m){this.name=" ";this.MAX_SHAPES=64;this.next=this.prev=null;this.type=OIMO.BODY_NULL;this.massInfo=new OIMO.MassInfo;this.position=new OIMO.Vec3(b,f,e);this.orientation=this.rotationAxisToQuad(c||0,d||0,g||0,m||0);this.newPosition=new OIMO.Vec3;this.controlPos=!1;this.newOrientation=new OIMO.Quat;this.newRotation=new OIMO.Vec3;this.currentRotation=new OIMO.Vec3;this.controlRotInTime=this.controlRot=!1;this.linearVelocity=new OIMO.Vec3;this.angularVelocity=new OIMO.Vec3;
this.matrix=new OIMO.Mat44;this.contactLink=this.parent=null;this.numContacts=0;this.shapes=null;this.numShapes=0;this.jointLink=null;this.numJoints=0;this.sleepPosition=new OIMO.Vec3;this.sleepOrientation=new OIMO.Quat;this.isDynamic=this.isStatic=!1;this.rotation=new OIMO.Mat33;this.inverseMass=this.mass=NaN;this.inverseInertia=new OIMO.Mat33;this.localInertia=new OIMO.Mat33;this.inverseLocalInertia=new OIMO.Mat33;this.addedToIsland=!1;this.allowSleep=!0;this.sleepTime=0;this.sleeping=!1};
OIMO.RigidBody.prototype={constructor:OIMO.RigidBody,addShape:function(b){b.parent&&OIMO.Error("RigidBody","It is not possible that you add to the multi-rigid body the shape of one");null!=this.shapes&&((this.shapes.prev=b).next=this.shapes);this.shapes=b;b.parent=this;this.parent&&this.parent.addShape(b);this.numShapes++},removeShape:function(b){if(b.parent==this){var f=b.prev,e=b.next;null!=f&&(f.next=e);null!=e&&(e.prev=f);this.shapes==b&&(this.shapes=e);b.prev=null;b.next=null;b.parent=null;this.parent&&
this.parent.removeShape(b);this.numShapes--}},remove:function(){this.dispose()},dispose:function(){this.parent.removeRigidBody(this)},checkContact:function(b){this.parent.checkContact(this.name,b)},setupMass:function(b,f){var e=void 0!==f?f:!0;this.type=b||OIMO.BODY_DYNAMIC;this.isDynamic=this.type==OIMO.BODY_DYNAMIC;this.isStatic=this.type==OIMO.BODY_STATIC;this.mass=0;this.localInertia.set(0,0,0,0,0,0,0,0,0);for(var c=this.localInertia.elements,d=new OIMO.Mat33,g=new OIMO.Vec3,m=this.shapes;null!=
m;m=m.next){m.calculateMassInfo(this.massInfo);var j=this.massInfo.mass,l=m.relativePosition.x,n=m.relativePosition.y,q=m.relativePosition.z;g.addScale(m.relativePosition,j);this.mass+=j;this.rotateInertia(m.relativeRotation,this.massInfo.inertia,d);this.localInertia.addEqual(d);c[0]+=j*(n*n+q*q);c[4]+=j*(l*l+q*q);c[8]+=j*(l*l+n*n);var p=j*l*n,n=j*n*q,j=j*q*l;c[1]-=p;c[3]-=p;c[2]-=n;c[6]-=n;c[5]-=j;c[7]-=j}this.inverseMass=1/this.mass;g.scaleEqual(this.inverseMass);if(e){this.position.addEqual(g);
for(m=this.shapes;null!=m;m=m.next)m.relativePosition.subEqual(g);l=g.x;n=g.y;q=g.z;c[0]-=this.mass*(n*n+q*q);c[4]-=this.mass*(l*l+q*q);c[8]-=this.mass*(l*l+n*n);p=this.mass*l*n;n=this.mass*n*q;j=this.mass*q*l;c[1]+=p;c[3]+=p;c[2]+=n;c[6]+=n;c[5]+=j;c[7]+=j}this.inverseLocalInertia.invert(this.localInertia);this.type==OIMO.BODY_STATIC&&(this.inverseMass=0,this.inverseLocalInertia.set(0,0,0,0,0,0,0,0,0));this.syncShapes();this.awake()},awake:function(){if(this.allowSleep&&this.sleeping){this.sleeping=
!1;this.sleepTime=0;for(var b=this.contactLink;null!=b;)b.body.sleepTime=0,b.body.sleeping=!1,b=b.next;for(b=this.jointLink;null!=b;)b.body.sleepTime=0,b.body.sleeping=!1,b=b.next;for(b=this.shapes;null!=b;b=b.next)b.updateProxy()}},sleep:function(){if(this.allowSleep&&!this.sleeping){this.linearVelocity.set(0,0,0);this.angularVelocity.set(0,0,0);this.sleepPosition.copy(this.position);this.sleepOrientation.copy(this.orientation);this.sleepTime=0;this.sleeping=!0;for(var b=this.shapes;null!=b;b=b.next)b.updateProxy()}},
isLonely:function(){return 0==this.numJoints&&0==this.numContacts},updatePosition:function(b){switch(this.type){case OIMO.BODY_STATIC:this.linearVelocity.set(0,0,0);this.angularVelocity.set(0,0,0);this.controlPos&&(this.position.copy(this.newPosition),this.controlPos=!1);this.controlRot&&(this.orientation.copy(this.newOrientation),this.controlRot=!1);break;case OIMO.BODY_DYNAMIC:this.controlPos&&(this.angularVelocity.set(0,0,0),this.linearVelocity.set(0,0,0),this.linearVelocity.x=(this.newPosition.x-
this.position.x)/b,this.linearVelocity.y=(this.newPosition.y-this.position.y)/b,this.linearVelocity.z=(this.newPosition.z-this.position.z)/b,this.controlPos=!1);this.controlRot&&(this.angularVelocity.set(0,0,0),this.orientation.copy(this.newOrientation),this.controlRot=!1);this.position.addTime(this.linearVelocity,b);this.orientation.addTime(this.angularVelocity,b);break;default:OIMO.Error("RigidBody","Invalid type.")}this.syncShapes()},rotateInertia:function(b,f,e){var c=b.elements,d=f.elements;
f=c[0];b=c[3];var g=c[6],m=c[1],j=c[4],l=c[7],n=c[2],q=c[5],c=c[8],p=d[0],r=d[3],t=d[6],s=d[1],u=d[4],x=d[7],y=d[2],z=d[5],A=d[8],d=f*p+m*r+n*t,B=f*s+m*u+n*x,C=f*y+m*z+n*A,D=b*p+j*r+q*t,E=b*s+j*u+q*x,I=b*y+j*z+q*A,p=g*p+l*r+c*t,s=g*s+l*u+c*x,y=g*y+l*z+c*A;e=e.elements;e[0]=d*f+B*m+C*n;e[1]=d*b+B*j+C*q;e[2]=d*g+B*l+C*c;e[3]=D*f+E*m+I*n;e[4]=D*b+E*j+I*q;e[5]=D*g+E*l+I*c;e[6]=p*f+s*m+y*n;e[7]=p*b+s*j+y*q;e[8]=p*g+s*l+y*c},syncShapes:function(){var b=this.orientation.s,f=this.orientation.x,e=this.orientation.y,
c=this.orientation.z,d=2*f,g=2*e,m=2*c,j=f*d,l=e*g,c=c*m,n=f*g,e=e*m,f=f*m,d=b*d,g=b*g,b=b*m,m=this.rotation.elements;m[0]=1-l-c;m[1]=n-b;m[2]=f+g;m[3]=n+b;m[4]=1-j-c;m[5]=e-d;m[6]=f-g;m[7]=e+d;m[8]=1-j-l;this.rotateInertia(this.rotation,this.inverseLocalInertia,this.inverseInertia);for(j=this.shapes;null!=j;j=j.next)j.position.mul(this.position,j.relativePosition,this.rotation),j.rotation.mul(this.rotation,j.relativeRotation),j.updateProxy()},applyImpulse:function(b,f){this.linearVelocity.addScale(f,
this.inverseMass);var e=new OIMO.Vec3;e.sub(b,this.position).cross(e,f).mulMat(this.inverseInertia,e);this.angularVelocity.addEqual(e)},rotationVectToQuad:function(b){b=OIMO.EulerToAxis(b.x*OIMO.degtorad,b.y*OIMO.degtorad,b.z*OIMO.degtorad);return this.rotationAxisToQuad(b[0],b[1],b[2],b[3])},rotationAxisToQuad:function(b,f,e,c){var d=f*f+e*e+c*c;0<d&&(d=1/OIMO.sqrt(d),f*=d,e*=d,c*=d);d=OIMO.sin(0.5*b);b=OIMO.cos(0.5*b);return new OIMO.Quat(b,d*f,d*e,d*c)},setPosition:function(b){this.newPosition.copy(b).multiplyScalar(OIMO.INV_SCALE);
this.controlPos=!0},setQuaternion:function(b){this.newOrientation.set(b.x,b.y,b.z,b.w);this.controlRot=!0},setRotation:function(b){this.newOrientation=this.rotationVectToQuad(b);this.controlRot=!0},resetPosition:function(b,f,e){this.linearVelocity.set(0,0,0);this.angularVelocity.set(0,0,0);this.position.set(b,f,e).multiplyScalar(OIMO.INV_SCALE);this.awake()},resetQuaternion:function(b){this.angularVelocity.set(0,0,0);this.orientation=new OIMO.Quat(b.w,b.x,b.y,b.z);this.awake()},resetRotation:function(b,
f,e){this.angularVelocity.set(0,0,0);this.orientation=this.rotationVectToQuad(new OIMO.Vec3(b,f,e));this.awake()},getPosition:function(){return(new OIMO.Vec3).scale(this.position,OIMO.WORLD_SCALE)},getRotation:function(){return(new OIMO.Euler).setFromRotationMatrix(this.rotation)},getQuaternion:function(){return(new OIMO.Quaternion).setFromRotationMatrix(this.rotation)},getMatrix:function(){var b=this.matrix.elements,f;this.sleeping?b[15]=1:(f=this.rotation.elements,b[0]=f[0],b[1]=f[3],b[2]=f[6],
b[3]=0,b[4]=f[1],b[5]=f[4],b[6]=f[7],b[7]=0,b[8]=f[2],b[9]=f[5],b[10]=f[8],b[11]=0,f=this.position,b[12]=f.x*OIMO.WORLD_SCALE,b[13]=f.y*OIMO.WORLD_SCALE,b[14]=f.z*OIMO.WORLD_SCALE,b[15]=0);return b}};OIMO.Body=function(b){b=b||{};b.world&&(void 0===b.type&&(b.type="box"),this.name=b.name||"",this.body=b.world.add(b))};
OIMO.Body.prototype={constructor:OIMO.Body,setPosition:function(b){this.body.setPosition(b)},setQuaternion:function(b){this.body.setQuaternion(b)},setRotation:function(b){this.body.setRotation(b)},getPosition:function(){return this.body.getPosition()},getRotation:function(){return this.body.getRotation()},getQuaternion:function(){return this.body.getQuaternion()},getMatrix:function(){return this.body.getMatrix()},getSleep:function(){return this.body.sleeping},resetPosition:function(b,f,e){this.body.resetPosition(b,
f,e)},resetRotation:function(b,f,e){this.body.resetRotation(b,f,e)},awake:function(){this.body.awake()},remove:function(){this.body.dispose()},checkContact:function(b){this.body.checkContact(b)}};OIMO.Link=function(b){b=b||{};b.world&&(void 0===b.type&&(b.type="jointHinge"),this.name=b.name||"",this.joint=b.world.add(b))};
OIMO.Link.prototype={constructor:OIMO.Link,getPosition:function(){return this.joint.getPosition()},getMatrix:function(){return this.joint.getMatrix()},remove:function(){this.joint.dispose()},awake:function(){this.joint.awake()}};OIMO.Dictionary=function(){this.data={};this.keys=[]};
OIMO.Dictionary.prototype={constructor:OIMO.Dictionary,set:function(b){var f=b.id;this.get[f]||this.keys.push(f);this.data[f]=b},get:function(b){return this.data[b]},del:function(b){var f=this.keys;b=f.indexOf(b.id);-1<b&&(delete this.data[f[b]],f.splice(b,1))},reset:function(){for(var b=this.data,f=this.keys,e;0<f.length;)e=f.pop(),delete b[e]}};
OIMO.Performance=function(b){this.parent=b;this.infos=new OIMO_ARRAY_TYPE(13);this.f=[0,0,0];this.types=["None","BruteForce","Sweep & Prune","Bounding Volume Tree"];this.broadPhase=this.types[this.parent.broadPhase.types];this.version=OIMO.REVISION;this.totalTime=this.solvingTime=this.narrowPhaseTime=this.broadPhaseTime=this.fps=0};
OIMO.Performance.prototype={upfps:function(){this.f[1]=Date.now();this.f[1]-1E3>this.f[0]&&(this.f[0]=this.f[1],this.fps=this.f[2],this.f[2]=0);this.f[2]++},updatingTime:function(){return OIMO.fix(this.totalTime-(this.broadPhaseTime+this.narrowPhaseTime+this.solvingTime))},show:function(){return["Oimo.js "+this.version+"<br>",this.broadPhase+"<br><br>","FPS: "+this.fps+" fps<br><br>","rigidbody "+this.parent.numRigidBodies+"<br>","contact &nbsp;&nbsp;"+this.parent.numContacts+"<br>","ct-point &nbsp;"+
this.parent.numContactPoints+"<br>","paircheck "+this.parent.broadPhase.numPairChecks+"<br>","island &nbsp;&nbsp;&nbsp;"+this.parent.numIslands+"<br><br>","Time in milliseconde<br><br>","broad-phase &nbsp;"+OIMO.fix(this.broadPhaseTime)+"<br>","narrow-phase "+OIMO.fix(this.narrowPhaseTime)+"<br>","solving &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+OIMO.fix(this.solvingTime)+"<br>","total &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+OIMO.fix(this.totalTime)+"<br>","updating &nbsp;&nbsp;&nbsp;&nbsp;"+this.updatingTime()+
"<br>"].join("\n")},toArray:function(){this.infos[0]=this.parent.broadPhase.types;this.infos[1]=this.parent.numRigidBodies;this.infos[2]=this.parent.numContacts;this.infos[3]=this.parent.broadPhase.numPairChecks;this.infos[4]=this.parent.numContactPoints;this.infos[5]=this.parent.numIslands;this.infos[6]=this.broadPhaseTime;this.infos[7]=this.narrowPhaseTime;this.infos[8]=this.solvingTime;this.infos[9]=this.updatingTime();this.infos[10]=this.totalTime;this.infos[11]=this.fps;return this.infos}};
OIMO.Mat44=function(b,f,e,c,d,g,m,j,l,n,q,p,r,t,s,u){var x=this.elements=new OIMO_ARRAY_TYPE(16);x[0]=void 0!==b?b:1;x[4]=f||0;x[8]=e||0;x[12]=c||0;x[1]=d||0;x[5]=void 0!==g?g:1;x[9]=m||0;x[13]=j||0;x[2]=l||0;x[6]=n||0;x[10]=void 0!==q?q:1;x[14]=p||0;x[3]=r||0;x[7]=t||0;x[11]=s||0;x[15]=void 0!==u?u:1};
OIMO.Mat44.prototype={constructor:OIMO.Mat44,set:function(b,f,e,c,d,g,m,j,l,n,q,p,r,t,s,u){var x=this.elements;x[0]=b;x[4]=f;x[8]=e;x[12]=c;x[1]=d;x[5]=g;x[9]=m;x[13]=j;x[2]=l;x[6]=n;x[10]=q;x[14]=p;x[3]=r;x[7]=t;x[11]=s;x[15]=u;return this}};OIMO.Mat33=function(b,f,e,c,d,g,m,j,l){this.elements=new OIMO_ARRAY_TYPE(9);this.init(void 0!==b?b:1,f||0,e||0,c||0,void 0!==d?d:1,g||0,m||0,j||0,void 0!==l?l:1)};
OIMO.Mat33.prototype={constructor:OIMO.Mat33,set:function(b,f,e,c,d,g,m,j,l){var n=this.elements;n[0]=b;n[1]=f;n[2]=e;n[3]=c;n[4]=d;n[5]=g;n[6]=m;n[7]=j;n[8]=l;return this},init:function(b,f,e,c,d,g,m,j,l){var n=this.elements;n[0]=b;n[1]=f;n[2]=e;n[3]=c;n[4]=d;n[5]=g;n[6]=m;n[7]=j;n[8]=l;return this},multiply:function(b){var f=this.elements;f[0]*=b;f[1]*=b;f[2]*=b;f[3]*=b;f[4]*=b;f[5]*=b;f[6]*=b;f[7]*=b;f[8]*=b;return this},add:function(b,f){var e=this.elements,c=b.elements,d=f.elements;e[0]=c[0]+
d[0];e[1]=c[1]+d[1];e[2]=c[2]+d[2];e[3]=c[3]+d[3];e[4]=c[4]+d[4];e[5]=c[5]+d[5];e[6]=c[6]+d[6];e[7]=c[7]+d[7];e[8]=c[8]+d[8];return this},addEqual:function(b){var f=this.elements;b=b.elements;f[0]+=b[0];f[1]+=b[1];f[2]+=b[2];f[3]+=b[3];f[4]+=b[4];f[5]+=b[5];f[6]+=b[6];f[7]+=b[7];f[8]+=b[8];return this},sub:function(b,f){var e=this.elements,c=b.elements,d=f.elements;e[0]=c[0]-d[0];e[1]=c[1]-d[1];e[2]=c[2]-d[2];e[3]=c[3]-d[3];e[4]=c[4]-d[4];e[5]=c[5]-d[5];e[6]=c[6]-d[6];e[7]=c[7]-d[7];e[8]=c[8]-d[8];
return this},subEqual:function(b){var f=this.elements;b=b.elements;f[0]-=b[0];f[1]-=b[1];f[2]-=b[2];f[3]-=b[3];f[4]-=b[4];f[5]-=b[5];f[6]-=b[6];f[7]-=b[7];f[8]-=b[8];return this},scale:function(b,f){var e=this.elements,c=b.elements;e[0]=c[0]*f;e[1]=c[1]*f;e[2]=c[2]*f;e[3]=c[3]*f;e[4]=c[4]*f;e[5]=c[5]*f;e[6]=c[6]*f;e[7]=c[7]*f;e[8]=c[8]*f;return this},scaleEqual:function(b){var f=this.elements;f[0]*=b;f[1]*=b;f[2]*=b;f[3]*=b;f[4]*=b;f[5]*=b;f[6]*=b;f[7]*=b;f[8]*=b;return this},mul:function(b,f){var e=
this.elements,c=b.elements,d=f.elements,g=c[0],m=c[3],j=c[6],l=c[1],n=c[4],q=c[7],p=c[2],r=c[5],c=c[8],t=d[0],s=d[3],u=d[6],x=d[1],y=d[4],z=d[7],A=d[2],B=d[5],d=d[8];e[0]=g*t+l*s+p*u;e[1]=g*x+l*y+p*z;e[2]=g*A+l*B+p*d;e[3]=m*t+n*s+r*u;e[4]=m*x+n*y+r*z;e[5]=m*A+n*B+r*d;e[6]=j*t+q*s+c*u;e[7]=j*x+q*y+c*z;e[8]=j*A+q*B+c*d;return this},mulScale:function(b,f,e,c,d){var g=this.elements;b=b.elements;d?(g[0]=f*b[0],g[1]=f*b[1],g[2]=f*b[2],g[3]=e*b[3],g[4]=e*b[4],g[5]=e*b[5],g[6]=c*b[6],g[7]=c*b[7],g[8]=c*b[8]):
(g[0]=b[0]*f,g[1]=b[1]*e,g[2]=b[2]*c,g[3]=b[3]*f,g[4]=b[4]*e,g[5]=b[5]*c,g[6]=b[6]*f,g[7]=b[7]*e,g[8]=b[8]*c);return this},mulRotate:function(b,f,e,c,d,g){g=g||!1;var m=OIMO.sin(f),j=OIMO.cos(f),l=1-j;f=e*e*l+j;var n=e*c*l-d*m,q=e*d*l+c*m,p=c*e*l+d*m,r=c*c*l+j,t=c*d*l-e*m,s=d*e*l-c*m;e=d*c*l+e*m;d=d*d*l+j;var u=b.elements;b=u[0];c=u[3];var m=u[6],j=u[1],l=u[4],x=u[7],y=u[2],z=u[5],u=u[8],A=this.elements;g?(A[0]=f*b+n*c+q*m,A[1]=f*j+n*l+q*x,A[2]=f*y+n*z+q*u,A[3]=p*b+r*c+t*m,A[4]=p*j+r*l+t*x,A[5]=p*
y+r*z+t*u,A[6]=s*b+e*c+d*m,A[7]=s*j+e*l+d*x,A[8]=s*y+e*z+d*u):(A[0]=b*f+j*p+y*s,A[1]=b*n+j*r+y*e,A[2]=b*q+j*t+y*d,A[3]=c*f+l*p+z*s,A[4]=c*n+l*r+z*e,A[5]=c*q+l*t+z*d,A[6]=m*f+x*p+u*s,A[7]=m*n+x*r+u*e,A[8]=m*q+x*t+u*d);return this},transpose:function(b){var f=this.elements;b=b.elements;f[0]=b[0];f[1]=b[3];f[2]=b[6];f[3]=b[1];f[4]=b[4];f[5]=b[7];f[6]=b[2];f[7]=b[5];f[8]=b[8];return this},setQuat:function(b){var f=this.elements,e=2*b.x,c=2*b.y,d=2*b.z,g=b.x*e,m=b.y*c,j=b.z*d,l=b.x*c,n=b.y*d,q=b.x*d,e=
b.s*e,c=b.s*c;b=b.s*d;f[0]=1-m-j;f[1]=l-b;f[2]=q+c;f[3]=l+b;f[4]=1-g-j;f[5]=n-e;f[6]=q-c;f[7]=n+e;f[8]=1-g-m;return this},invert:function(b){var f=this.elements,e=b.elements;b=e[0];var c=e[3],d=e[6],g=e[1],m=e[4],j=e[7],l=e[2],n=e[5],e=e[8],q=m*e-j*n,p=j*l-g*e,r=g*n-m*l,t=b*q+c*p+d*r;0!=t&&(t=1/t);f[0]=t*q;f[1]=t*p;f[2]=t*r;f[3]=t*(n*d-c*e);f[4]=t*(b*e-l*d);f[5]=t*(l*c-b*n);f[6]=t*(c*j-m*d);f[7]=t*(g*d-b*j);f[8]=t*(b*m-g*c);return this},toEuler:function(){var b=this.elements,f=b[0],e=b[3],c=b[6],
d=b[4],g=b[7],m=b[5],b=b[8],j=new OIMO.Vec3;new OIMO.Quat;j.y=OIMO.asin(OIMO.min(OIMO.max(c,-1),1));0.99999>OIMO.abs(c)?(j.x=OIMO.atan2(-g,b),j.z=OIMO.atan2(-e,f)):(j.x=OIMO.atan2(m,d),j.z=0);return j},toString:function(){var b=this.elements;return"Mat33|"+b[0].toFixed(4)+", "+b[1].toFixed(4)+", "+b[2].toFixed(4)+"|\n     |"+b[3].toFixed(4)+", "+b[4].toFixed(4)+", "+b[5].toFixed(4)+"|\n     |"+b[6].toFixed(4)+", "+b[7].toFixed(4)+", "+b[8].toFixed(4)+"|"},multiplyScalar:function(b){var f=this.elements;
f[0]*=b;f[3]*=b;f[6]*=b;f[1]*=b;f[4]*=b;f[7]*=b;f[2]*=b;f[5]*=b;f[8]*=b;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(b){b=b.elements;this.set(b[0],b[3],b[6],b[1],b[4],b[7],b[2],b[5],b[8]);return this},fromArray:function(b){this.elements.set(b);return this},toArray:function(){var b=this.elements;return[b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8]]}};
OIMO.Quat=function(b,f,e,c){this.s=void 0!==b?b:1;this.x=f||0;this.y=e||0;this.z=c||0};
OIMO.Quat.prototype={constructor:OIMO.Quat,set:function(b,f,e,c){this.x=b;this.y=f;this.z=e;this.s=c;return this},init:function(b,f,e,c){this.s=void 0!==b?b:1;this.x=f||0;this.y=e||0;this.z=c||0;return this},add:function(b,f){this.s=b.s+f.s;this.x=b.x+f.x;this.y=b.y+f.y;this.z=b.z+f.z;return this},addTime:function(b,f){var e=b.x,c=b.y,d=b.z,g=this.s,m=this.x,j=this.y,l=this.z;f*=0.5;var n=(e*g+c*l-d*j)*f,q=(-e*l+c*g+d*m)*f,p=(e*j-c*m+d*g)*f,g=g+(-e*m-c*j-d*l)*f,m=m+n,j=j+q,l=l+p,e=1/OIMO.sqrt(g*g+
m*m+j*j+l*l);this.s=g*e;this.x=m*e;this.y=j*e;this.z=l*e;return this},sub:function(b,f){this.s=b.s-f.s;this.x=b.x-f.x;this.y=b.y-f.y;this.z=b.z-f.z;return this},scale:function(b,f){this.s=b.s*f;this.x=b.x*f;this.y=b.y*f;this.z=b.z*f;return this},mul:function(b,f){var e=b.x,c=b.y,d=b.z,g=b.s,m=f.x,j=f.y,l=f.z,n=f.s;this.x=e*n+g*m+c*l-d*j;this.y=c*n+g*j+d*m-e*l;this.z=d*n+g*l+e*j-c*m;this.s=g*n-e*m-c*j-d*l;return this},arc:function(b,f){var e=b.x,c=b.y,d=b.z,g=f.x,m=f.y,j=f.z,l=e*g+c*m+d*j;if(-1==l)return g=
c*e-d*d,m=-d*c-e*e,j=e*d+c*c,l=1/OIMO.sqrt(g*g+m*m+j*j),this.s=0,this.x=g*l,this.y=m*l,this.z=j*l,this;var n=c*j-d*m,d=d*g-e*j,e=e*m-c*g;this.s=OIMO.sqrt(0.5*(1+l));l=0.5/this.s;this.x=n*l;this.y=d*l;this.z=e*l;return this},normalize:function(b){var f=OIMO.sqrt(b.s*b.s+b.x*b.x+b.y*b.y+b.z*b.z);0<f&&(f=1/f);this.s=b.s*f;this.x=b.x*f;this.y=b.y*f;this.z=b.z*f;return this},invert:function(b){this.s=b.s;this.x=-b.x;this.y=-b.y;this.z=-b.z;return this},length:function(){return OIMO.sqrt(this.s*this.s+
this.x*this.x+this.y*this.y+this.z*this.z)},copy:function(b){this.s=b.s;this.x=b.x;this.y=b.y;this.z=b.z;return this},testDiff:function(b){return this.s!==b.s||this.x!==b.x||this.y!==b.y||this.z!==b.z?!0:!1},clone:function(){return new OIMO.Quat(this.s,this.x,this.y,this.z)},toString:function(){return"Quat["+this.s.toFixed(4)+", ("+this.x.toFixed(4)+", "+this.y.toFixed(4)+", "+this.z.toFixed(4)+")]"}};OIMO.Quaternion=function(b,f,e,c){this.x=b||0;this.y=f||0;this.z=e||0;this.w=void 0!==c?c:1};
OIMO.Quaternion.prototype={constructor:OIMO.Quaternion,setFromRotationMatrix:function(b){var f=b.elements,e=f[0];b=f[1];var c=f[2],d=f[3],g=f[4],m=f[5],j=f[6],l=f[7],f=f[8],n=e+g+f;0<n?(e=0.5/OIMO.sqrt(n+1),this.w=0.25/e,this.x=(l-m)*e,this.y=(c-j)*e,this.z=(d-b)*e):e>g&&e>f?(e=2*OIMO.sqrt(1+e-g-f),this.w=(l-m)/e,this.x=0.25*e,this.y=(b+d)/e,this.z=(c+j)/e):g>f?(e=2*OIMO.sqrt(1+g-e-f),this.w=(c-j)/e,this.x=(b+d)/e,this.y=0.25*e,this.z=(m+l)/e):(e=2*OIMO.sqrt(1+f-e-g),this.w=(d-b)/e,this.x=(c+j)/e,
this.y=(m+l)/e,this.z=0.25*e);return this}};OIMO.Vec3=function(b,f,e){this.x=b||0;this.y=f||0;this.z=e||0};
OIMO.Vec3.prototype={constructor:OIMO.Vec3,init:function(b,f,e){this.x=b||0;this.y=f||0;this.z=e||0;return this},set:function(b,f,e){this.x=b;this.y=f;this.z=e;return this},add:function(b,f){this.x=b.x+f.x;this.y=b.y+f.y;this.z=b.z+f.z;return this},addEqual:function(b){this.x+=b.x;this.y+=b.y;this.z+=b.z;return this},addTime:function(b,f){this.x+=b.x*f;this.y+=b.y*f;this.z+=b.z*f;return this},sub:function(b,f){this.x=b.x-f.x;this.y=b.y-f.y;this.z=b.z-f.z;return this},subEqual:function(b){this.x-=
b.x;this.y-=b.y;this.z-=b.z;return this},addScale:function(b,f){this.x+=b.x*f;this.y+=b.y*f;this.z+=b.z*f;return this},scale:function(b,f){this.x=b.x*f;this.y=b.y*f;this.z=b.z*f;return this},scaleEqual:function(b){this.x*=b;this.y*=b;this.z*=b;return this},cross:function(b,f){var e=b.x,c=b.y,d=b.z,g=f.x,m=f.y,j=f.z;this.x=c*j-d*m;this.y=d*g-e*j;this.z=e*m-c*g;return this},mul:function(b,f,e){e=e.elements;this.x=b.x+f.x*e[0]+f.y*e[1]+f.z*e[2];this.y=b.y+f.x*e[3]+f.y*e[4]+f.z*e[5];this.z=b.z+f.x*e[6]+
f.y*e[7]+f.z*e[8];return this},mulMat:function(b,f){var e=b.elements;this.x=e[0]*f.x+e[1]*f.y+e[2]*f.z;this.y=e[3]*f.x+e[4]*f.y+e[5]*f.z;this.z=e[6]*f.x+e[7]*f.y+e[8]*f.z;return this},normalize:function(b){var f=b.x,e=b.y;b=b.z;var c=f*f+e*e+b*b;0<c&&(c=1/OIMO.sqrt(c),this.x=f*c,this.y=e*c,this.z=b*c);return this},invert:function(b){this.x=-b.x;this.y=-b.y;this.z=-b.z;return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(b){return this.x*b.x+this.y*
b.y+this.z*b.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return OIMO.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},copy:function(b){this.x=b.x;this.y=b.y;this.z=b.z;return this},applyQuaternion:function(b){var f=this.x,e=this.y,c=this.z,d=b.x,g=b.y,m=b.z;b=b.s;var j=b*f+g*c-m*e,l=b*e+m*f-d*c,n=b*c+d*e-g*f,f=-d*f-g*e-m*c;this.x=j*b+f*-d+l*-m-n*-g;this.y=l*b+f*-g+n*-d-j*-m;this.z=n*b+f*-m+j*-g-l*-d;return this},testZero:function(){return 0!==this.x||
0!==this.y||0!==this.z?!0:!1},testDiff:function(b){return b.x!==this.x||b.y!==this.y||b.z!==this.z},equals:function(b){return b.x===this.x&&b.y===this.y&&b.z===this.z},clone:function(){return new this.constructor(this.x,this.y,this.z)},toString:function(){return"Vec3["+this.x.toFixed(4)+", "+this.y.toFixed(4)+", "+this.z.toFixed(4)+"]"},multiplyScalar:function(b){isFinite(b)?(this.x*=b,this.y*=b,this.z*=b):this.z=this.y=this.x=0;return this},divideScalar:function(b){return this.multiplyScalar(1/b)},
norm:function(){return this.divideScalar(this.length())}};OIMO.Euler=function(b,f,e,c){this._x=b||0;this._y=f||0;this._z=e||0;this._order=c||OIMO.Euler.DefaultOrder};OIMO.Euler.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" ");OIMO.Euler.DefaultOrder="XYZ";OIMO.clamp=function(b,f,e){return b<f?f:b>e?e:b};
OIMO.Euler.prototype={constructor:OIMO.Euler,_x:0,_y:0,_z:0,_order:OIMO.Euler.DefaultOrder,get x(){return this._x},set x(b){this._x=b;this.onChangeCallback()},get y(){return this._y},set y(b){this._y=b;this.onChangeCallback()},get z(){return this._z},set z(b){this._z=b;this.onChangeCallback()},get order(){return this._order},set order(b){this._order=b;this.onChangeCallback()},set:function(b,f,e,c){this._x=b;this._y=f;this._z=e;this._order=c||this._order;this.onChangeCallback();return this},copy:function(b){this._x=
b._x;this._y=b._y;this._z=b._z;this._order=b._order;this.onChangeCallback();return this},setFromRotationMatrix:function(b,f){var e=OIMO.clamp,c=b.elements,d=c[0],g=c[1],m=c[2],j=c[3],l=c[4],n=c[5],q=c[6],p=c[7],c=c[8];f=f||this._order;"XYZ"===f?(this._y=OIMO.asin(e(m,-1,1)),0.99999>OIMO.abs(m)?(this._x=OIMO.atan2(-n,c),this._z=OIMO.atan2(-g,d)):(this._x=OIMO.atan2(p,l),this._z=0)):"YXZ"===f?(this._x=OIMO.asin(-e(n,-1,1)),0.99999>OIMO.abs(n)?(this._y=OIMO.atan2(m,c),this._z=OIMO.atan2(j,l)):(this._y=
OIMO.atan2(-q,d),this._z=0)):"ZXY"===f?(this._x=OIMO.asin(e(p,-1,1)),0.99999>OIMO.abs(p)?(this._y=OIMO.atan2(-q,c),this._z=OIMO.atan2(-g,l)):(this._y=0,this._z=OIMO.atan2(j,d))):"ZYX"===f?(this._y=OIMO.asin(-e(q,-1,1)),0.99999>OIMO.abs(q)?(this._x=OIMO.atan2(p,c),this._z=OIMO.atan2(j,d)):(this._x=0,this._z=OIMO.atan2(-g,l))):"YZX"===f?(this._z=OIMO.asin(e(j,-1,1)),0.99999>OIMO.abs(j)?(this._x=OIMO.atan2(-n,l),this._y=OIMO.atan2(-q,d)):(this._x=0,this._y=OIMO.atan2(m,c))):"XZY"===f?(this._z=OIMO.asin(-e(g,
-1,1)),0.99999>OIMO.abs(g)?(this._x=OIMO.atan2(p,l),this._y=OIMO.atan2(m,d)):(this._x=OIMO.atan2(-n,c),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+f);this._order=f;this.onChangeCallback();return this},setFromQuaternion:function(b,f,e){var c=OIMO.clamp,d=b.x*b.x,g=b.y*b.y,m=b.z*b.z,j=b.s*b.s;f=f||this._order;"XYZ"===f?(this._x=OIMO.atan2(2*(b.x*b.s-b.y*b.z),j-d-g+m),this._y=OIMO.asin(c(2*(b.x*b.z+b.y*b.s),-1,1)),this._z=OIMO.atan2(2*(b.z*b.s-b.x*b.y),
j+d-g-m)):"YXZ"===f?(this._x=OIMO.asin(c(2*(b.x*b.s-b.y*b.z),-1,1)),this._y=OIMO.atan2(2*(b.x*b.z+b.y*b.s),j-d-g+m),this._z=OIMO.atan2(2*(b.x*b.y+b.z*b.s),j-d+g-m)):"ZXY"===f?(this._x=OIMO.asin(c(2*(b.x*b.s+b.y*b.z),-1,1)),this._y=OIMO.atan2(2*(b.y*b.s-b.z*b.x),j-d-g+m),this._z=OIMO.atan2(2*(b.z*b.s-b.x*b.y),j-d+g-m)):"ZYX"===f?(this._x=OIMO.atan2(2*(b.x*b.s+b.z*b.y),j-d-g+m),this._y=OIMO.asin(c(2*(b.y*b.s-b.x*b.z),-1,1)),this._z=OIMO.atan2(2*(b.x*b.y+b.z*b.s),j+d-g-m)):"YZX"===f?(this._x=OIMO.atan2(2*
(b.x*b.s-b.z*b.y),j-d+g-m),this._y=OIMO.atan2(2*(b.y*b.s-b.x*b.z),j+d-g-m),this._z=OIMO.asin(c(2*(b.x*b.y+b.z*b.s),-1,1))):"XZY"===f?(this._x=OIMO.atan2(2*(b.x*b.s+b.y*b.z),j-d+g-m),this._y=OIMO.atan2(2*(b.x*b.z+b.y*b.s),j+d-g-m),this._z=OIMO.asin(c(2*(b.z*b.s-b.x*b.y),-1,1))):console.warn("OIMO.Euler: .setFromQuaternion() given unsupported order: "+f);this._order=f;if(!1!==e)this.onChangeCallback();return this},reorder:function(){var b=new OIMO.Quat;return function(f){b.setFromEuler(this);this.setFromQuaternion(b,
f)}}(),equals:function(b){return b._x===this._x&&b._y===this._y&&b._z===this._z&&b._order===this._order},fromArray:function(b){this._x=b[0];this._y=b[1];this._z=b[2];void 0!==b[3]&&(this._order=b[3]);this.onChangeCallback();return this},toArray:function(){return[this._x,this._y,this._z,this._order]},onChange:function(b){this.onChangeCallback=b;return this},onChangeCallback:function(){},clone:function(){return new OIMO.Euler(this._x,this._y,this._z,this._order)}};
OIMO.EulerToAxis=function(b,f,e){var c=OIMO.cos(0.5*f);f=OIMO.sin(0.5*f);var d=OIMO.cos(0.5*e),g=OIMO.sin(0.5*e),m=OIMO.cos(0.5*b),j=OIMO.sin(0.5*b),l=c*d,n=f*g;b=l*j+n*m;e=f*d*m+c*g*j;c=c*g*m-f*d*j;f=2*OIMO.acos(l*m-n*j);d=b*b+e*e+c*c;0.0010>d?(b=1,e=c=0):(d=OIMO.sqrt(d),b/=d,e/=d,c/=d);return[f,b,e,c]};
OIMO.EulerToMatrix=function(b,f,e){var c=OIMO.cos(f);f=OIMO.sin(f);var d=OIMO.cos(e);e=OIMO.sin(e);var g=OIMO.cos(b);b=OIMO.sin(b);var m=new OIMO.Mat33,j=m.elements;j[0]=c*d;j[1]=f*b-c*e*g;j[2]=c*e*b+f*g;j[3]=e;j[4]=d*g;j[5]=-d*b;j[6]=-f*d;j[7]=f*e*g+c*b;j[8]=-f*e*b+c*g;return m};
OIMO.MatrixToEuler=function(b){var f=b.elements,e;0.998<f[3]?(e=OIMO.atan2(f[2],f[8]),f=OIMO.PI/2,b=0):-0.998>f[3]?(e=OIMO.atan2(f[2],f[8]),f=-OIMO.PI/2,b=0):(e=OIMO.atan2(-f[6],f[0]),b=OIMO.atan2(-f[5],f[4]),f=OIMO.asin(f[3]));return[b,e,f]};OIMO.unwrapDegrees=function(b){b%=360;180<b&&(b-=360);-180>b&&(b+=360);return b};OIMO.unwrapRadian=function(b){b%=OIMO.TwoPI;b>OIMO.PI&&(b-=OIMO.TwoPI);b<-OIMO.PI&&(b+=OIMO.TwoPI);return b};
OIMO.Distance3d=function(b,f){var e=f[0]-b[0],c=f[1]-b[1],d=f[2]-b[2];return OIMO.sqrt(e*e+c*c+d*d)};OIMO.Constraint=function(){this.body2=this.body1=this.parent=null;this.addedToIsland=!1};OIMO.Constraint.prototype={constructor:OIMO.Constraint,preSolve:function(){OIMO.Error("Constraint","Inheritance error.")},solve:function(){OIMO.Error("Constraint","Inheritance error.")},postSolve:function(){OIMO.Error("Constraint","Inheritance error.")}};
OIMO.Joint=function(b){OIMO.Constraint.call(this);this.name="";this.type=OIMO.JOINT_NULL;this.next=this.prev=null;this.body1=b.body1;this.body2=b.body2;this.localAnchorPoint1=(new OIMO.Vec3).copy(b.localAnchorPoint1);this.localAnchorPoint2=(new OIMO.Vec3).copy(b.localAnchorPoint2);this.relativeAnchorPoint1=new OIMO.Vec3;this.relativeAnchorPoint2=new OIMO.Vec3;this.anchorPoint1=new OIMO.Vec3;this.anchorPoint2=new OIMO.Vec3;this.allowCollision=b.allowCollision;this.b1Link=new OIMO.JointLink(this);this.b2Link=
new OIMO.JointLink(this);this.matrix=new OIMO.Mat44};OIMO.Joint.prototype=Object.create(OIMO.Constraint.prototype);OIMO.Joint.prototype.constructor=OIMO.Joint;OIMO.Joint.prototype.updateAnchorPoints=function(){this.relativeAnchorPoint1.mulMat(this.body1.rotation,this.localAnchorPoint1);this.relativeAnchorPoint2.mulMat(this.body2.rotation,this.localAnchorPoint2);this.anchorPoint1.add(this.relativeAnchorPoint1,this.body1.position);this.anchorPoint2.add(this.relativeAnchorPoint2,this.body2.position)};
OIMO.Joint.prototype.attach=function(){this.b1Link.body=this.body2;this.b2Link.body=this.body1;null!=this.body1.jointLink?(this.b1Link.next=this.body1.jointLink).prev=this.b1Link:this.b1Link.next=null;this.body1.jointLink=this.b1Link;this.body1.numJoints++;null!=this.body2.jointLink?(this.b2Link.next=this.body2.jointLink).prev=this.b2Link:this.b2Link.next=null;this.body2.jointLink=this.b2Link;this.body2.numJoints++};
OIMO.Joint.prototype.detach=function(){var b=this.b1Link.prev,f=this.b1Link.next;null!=b&&(b.next=f);null!=f&&(f.prev=b);this.body1.jointLink==this.b1Link&&(this.body1.jointLink=f);this.b1Link.prev=null;this.b1Link.next=null;this.b1Link.body=null;this.body1.numJoints--;b=this.b2Link.prev;f=this.b2Link.next;null!=b&&(b.next=f);null!=f&&(f.prev=b);this.body2.jointLink==this.b2Link&&(this.body2.jointLink=f);this.b2Link.prev=null;this.b2Link.next=null;this.b2Link.body=null;this.body2.numJoints--;this.b1Link.body=
null;this.b2Link.body=null};OIMO.Joint.prototype.awake=function(){this.body1.awake();this.body2.awake()};OIMO.Joint.prototype.preSolve=function(){};OIMO.Joint.prototype.solve=function(){};OIMO.Joint.prototype.postSolve=function(){};OIMO.Joint.prototype.remove=function(){this.dispose()};OIMO.Joint.prototype.dispose=function(){this.parent.removeJoint(this)};
OIMO.Joint.prototype.getPosition=function(){var b=(new OIMO.Vec3).scale(this.anchorPoint1,OIMO.WORLD_SCALE),f=(new OIMO.Vec3).scale(this.anchorPoint2,OIMO.WORLD_SCALE);return[b,f]};OIMO.Joint.prototype.getMatrix=function(){var b=this.matrix.elements,f=this.anchorPoint1,e=this.anchorPoint2;b[0]=f.x*OIMO.WORLD_SCALE;b[1]=f.y*OIMO.WORLD_SCALE;b[2]=f.z*OIMO.WORLD_SCALE;b[3]=0;b[4]=e.x*OIMO.WORLD_SCALE;b[5]=e.y*OIMO.WORLD_SCALE;b[6]=e.z*OIMO.WORLD_SCALE;b[7]=0;return b};
OIMO.JointConfig=function(){this.body2=this.body1=null;this.localAnchorPoint1=new OIMO.Vec3;this.localAnchorPoint2=new OIMO.Vec3;this.localAxis1=new OIMO.Vec3;this.localAxis2=new OIMO.Vec3;this.allowCollision=!1};OIMO.JointLink=function(b){this.body=this.next=this.prev=null;this.joint=b};OIMO.LimitMotor=function(b,f){this.axis=b;this.angle=0;this.lowerLimit=f?0:1;this.dampingRatio=this.frequency=this.maxMotorForce=this.motorSpeed=this.upperLimit=0};
OIMO.LimitMotor.prototype={constructor:OIMO.LimitMotor,setLimit:function(b,f){this.lowerLimit=b;this.upperLimit=f},setMotor:function(b,f){this.motorSpeed=b;this.maxMotorForce=f},setSpring:function(b,f){this.frequency=b;this.dampingRatio=f}};OIMO.BallAndSocketJoint=function(b){OIMO.Joint.call(this,b);this.type=OIMO.JOINT_BALL_AND_SOCKET;this.lc=new OIMO.LinearConstraint(this)};OIMO.BallAndSocketJoint.prototype=Object.create(OIMO.Joint.prototype);OIMO.BallAndSocketJoint.prototype.constructor=OIMO.BallAndSocketJoint;
OIMO.BallAndSocketJoint.prototype.preSolve=function(b,f){this.updateAnchorPoints();this.lc.preSolve(b,f)};OIMO.BallAndSocketJoint.prototype.solve=function(){this.lc.solve()};OIMO.BallAndSocketJoint.prototype.postSolve=function(){};
OIMO.DistanceJoint=function(b,f,e){OIMO.Joint.call(this,b);this.type=OIMO.JOINT_DISTANCE;this.normal=new OIMO.Vec3;this.nr=new OIMO.Vec3;this.limitMotor=new OIMO.LimitMotor(this.normal,!0);this.limitMotor.lowerLimit=f;this.limitMotor.upperLimit=e;this.t=new OIMO.TranslationalConstraint(this,this.limitMotor)};OIMO.DistanceJoint.prototype=Object.create(OIMO.Joint.prototype);OIMO.DistanceJoint.prototype.constructor=OIMO.DistanceJoint;
OIMO.DistanceJoint.prototype.preSolve=function(b,f){this.updateAnchorPoints();this.nr.sub(this.anchorPoint2,this.anchorPoint1);this.normal.normalize(this.nr);this.t.preSolve(b,f)};OIMO.DistanceJoint.prototype.solve=function(){this.t.solve()};OIMO.DistanceJoint.prototype.postSolve=function(){};
OIMO.HingeJoint=function(b,f,e){OIMO.Joint.call(this,b);this.type=OIMO.JOINT_HINGE;this.localAxis1=b.localAxis1.clone().norm();this.localAxis2=b.localAxis2.clone().norm();this.localAngle1=(new OIMO.Vec3(this.localAxis1.y*this.localAxis1.x-this.localAxis1.z*this.localAxis1.z,-this.localAxis1.z*this.localAxis1.y-this.localAxis1.x*this.localAxis1.x,this.localAxis1.x*this.localAxis1.z+this.localAxis1.y*this.localAxis1.y)).norm();b=(new OIMO.Mat33).setQuat((new OIMO.Quat).arc(this.localAxis1,this.localAxis2));
this.localAngle2=(new OIMO.Vec3).mulMat(b,this.localAngle1);this.nor=new OIMO.Vec3;this.tan=new OIMO.Vec3;this.bin=new OIMO.Vec3;this.ax1=new OIMO.Vec3;this.ax2=new OIMO.Vec3;this.an1=new OIMO.Vec3;this.an2=new OIMO.Vec3;this.limitMotor=new OIMO.LimitMotor(this.nor,!1);this.limitMotor.lowerLimit=f;this.limitMotor.upperLimit=e;this.lc=new OIMO.LinearConstraint(this);this.r3=new OIMO.Rotational3Constraint(this,this.limitMotor,new OIMO.LimitMotor(this.tan,!0),new OIMO.LimitMotor(this.bin,!0))};
OIMO.HingeJoint.prototype=Object.create(OIMO.Joint.prototype);OIMO.HingeJoint.prototype.constructor=OIMO.HingeJoint;
OIMO.HingeJoint.prototype.preSolve=function(b,f){var e,c,d;this.updateAnchorPoints();this.ax1.mulMat(this.body1.rotation,this.localAxis1);this.ax2.mulMat(this.body2.rotation,this.localAxis2);this.an1.mulMat(this.body1.rotation,this.localAngle1);this.an2.mulMat(this.body2.rotation,this.localAngle2);this.nor.set(this.ax1.x*this.body2.inverseMass+this.ax2.x*this.body1.inverseMass,this.ax1.y*this.body2.inverseMass+this.ax2.y*this.body1.inverseMass,this.ax1.z*this.body2.inverseMass+this.ax2.z*this.body1.inverseMass).norm();
this.tan.set(this.nor.y*this.nor.x-this.nor.z*this.nor.z,-this.nor.z*this.nor.y-this.nor.x*this.nor.x,this.nor.x*this.nor.z+this.nor.y*this.nor.y).norm();this.bin.set(this.nor.y*this.tan.z-this.nor.z*this.tan.y,this.nor.z*this.tan.x-this.nor.x*this.tan.z,this.nor.x*this.tan.y-this.nor.y*this.tan.x);e=this.acosClamp(this.an1.x*this.an2.x+this.an1.y*this.an2.y+this.an1.z*this.an2.z);this.limitMotor.angle=0>this.nor.x*(this.an1.y*this.an2.z-this.an1.z*this.an2.y)+this.nor.y*(this.an1.z*this.an2.x-this.an1.x*
this.an2.z)+this.nor.z*(this.an1.x*this.an2.y-this.an1.y*this.an2.x)?-e:e;e=this.ax1.y*this.ax2.z-this.ax1.z*this.ax2.y;c=this.ax1.z*this.ax2.x-this.ax1.x*this.ax2.z;d=this.ax1.x*this.ax2.y-this.ax1.y*this.ax2.x;this.r3.limitMotor2.angle=this.tan.x*e+this.tan.y*c+this.tan.z*d;this.r3.limitMotor3.angle=this.bin.x*e+this.bin.y*c+this.bin.z*d;this.r3.preSolve(b,f);this.lc.preSolve(b,f)};OIMO.HingeJoint.prototype.solve=function(){this.r3.solve();this.lc.solve()};OIMO.HingeJoint.prototype.postSolve=function(){};
OIMO.HingeJoint.prototype.acosClamp=function(b){return 1<b?0:-1>b?OIMO.PI:OIMO.acos(b)};
OIMO.PrismaticJoint=function(b,f,e){OIMO.Joint.call(this,b);this.type=OIMO.JOINT_PRISMATIC;this.localAxis1=(new OIMO.Vec3).normalize(b.localAxis1);this.localAxis2=(new OIMO.Vec3).normalize(b.localAxis2);this.localAxis1X=this.localAxis1.x;this.localAxis1Y=this.localAxis1.y;this.localAxis1Z=this.localAxis1.z;this.localAxis2X=this.localAxis2.x;this.localAxis2Y=this.localAxis2.y;this.localAxis2Z=this.localAxis2.z;this.nor=new OIMO.Vec3;this.tan=new OIMO.Vec3;this.bin=new OIMO.Vec3;this.ac=new OIMO.AngularConstraint(this,
(new OIMO.Quat).arc(this.localAxis1,this.localAxis2));this.limitMotor=new OIMO.LimitMotor(this.nor,!0);this.limitMotor.lowerLimit=f;this.limitMotor.upperLimit=e;this.t3=new OIMO.Translational3Constraint(this,this.limitMotor,new OIMO.LimitMotor(this.tan,!0),new OIMO.LimitMotor(this.bin,!0))};OIMO.PrismaticJoint.prototype=Object.create(OIMO.Joint.prototype);OIMO.PrismaticJoint.prototype.constructor=OIMO.PrismaticJoint;
OIMO.PrismaticJoint.prototype.preSolve=function(b,f){var e,c;this.updateAnchorPoints();e=this.body1.rotation.elements;var d=this.localAxis1X*e[0]+this.localAxis1Y*e[1]+this.localAxis1Z*e[2],g=this.localAxis1X*e[3]+this.localAxis1Y*e[4]+this.localAxis1Z*e[5],m=this.localAxis1X*e[6]+this.localAxis1Y*e[7]+this.localAxis1Z*e[8];e=this.body2.rotation.elements;d=d*this.body2.inverseMass+(this.localAxis2X*e[0]+this.localAxis2Y*e[1]+this.localAxis2Z*e[2])*this.body1.inverseMass;g=g*this.body2.inverseMass+
(this.localAxis2X*e[3]+this.localAxis2Y*e[4]+this.localAxis2Z*e[5])*this.body1.inverseMass;e=m*this.body2.inverseMass+(this.localAxis2X*e[6]+this.localAxis2Y*e[7]+this.localAxis2Z*e[8])*this.body1.inverseMass;c=OIMO.sqrt(d*d+g*g+e*e);0<c&&(c=1/c);d*=c;g*=c;e*=c;var m=g*d-e*e,j=-e*g-d*d,l=d*e+g*g;c=1/OIMO.sqrt(m*m+j*j+l*l);m*=c;j*=c;l*=c;c=g*l-e*j;var n=e*m-d*l,q=d*j-g*m;this.nor.init(d,g,e);this.tan.init(m,j,l);this.bin.init(c,n,q);this.ac.preSolve(b,f);this.t3.preSolve(b,f)};
OIMO.PrismaticJoint.prototype.solve=function(){this.ac.solve();this.t3.solve()};OIMO.PrismaticJoint.prototype.postSolve=function(){};
OIMO.SliderJoint=function(b,f,e){OIMO.Joint.call(this,b);this.type=OIMO.JOINT_SLIDER;this.localAxis1=(new OIMO.Vec3).normalize(b.localAxis1);this.localAxis2=(new OIMO.Vec3).normalize(b.localAxis2);this.localAxis1X=this.localAxis1.x;this.localAxis1Y=this.localAxis1.y;this.localAxis1Z=this.localAxis1.z;this.localAngAxis1X=this.localAxis1Y*this.localAxis1X-this.localAxis1Z*this.localAxis1Z;this.localAngAxis1Y=-this.localAxis1Z*this.localAxis1Y-this.localAxis1X*this.localAxis1X;this.localAngAxis1Z=this.localAxis1X*
this.localAxis1Z+this.localAxis1Y*this.localAxis1Y;b=1/OIMO.sqrt(this.localAngAxis1X*this.localAngAxis1X+this.localAngAxis1Y*this.localAngAxis1Y+this.localAngAxis1Z*this.localAngAxis1Z);this.localAngAxis1X*=b;this.localAngAxis1Y*=b;this.localAngAxis1Z*=b;this.localAxis2X=this.localAxis2.x;this.localAxis2Y=this.localAxis2.y;this.localAxis2Z=this.localAxis2.z;b=(new OIMO.Mat33).setQuat((new OIMO.Quat).arc(this.localAxis1,this.localAxis2)).elements;this.localAngAxis2X=this.localAngAxis1X*b[0]+this.localAngAxis1Y*
b[1]+this.localAngAxis1Z*b[2];this.localAngAxis2Y=this.localAngAxis1X*b[3]+this.localAngAxis1Y*b[4]+this.localAngAxis1Z*b[5];this.localAngAxis2Z=this.localAngAxis1X*b[6]+this.localAngAxis1Y*b[7]+this.localAngAxis1Z*b[8];this.nor=new OIMO.Vec3;this.tan=new OIMO.Vec3;this.bin=new OIMO.Vec3;this.rotationalLimitMotor=new OIMO.LimitMotor(this.nor,!1);this.r3=new OIMO.Rotational3Constraint(this,this.rotationalLimitMotor,new OIMO.LimitMotor(this.tan,!0),new OIMO.LimitMotor(this.bin,!0));this.translationalLimitMotor=
new OIMO.LimitMotor(this.nor,!0);this.translationalLimitMotor.lowerLimit=f;this.translationalLimitMotor.upperLimit=e;this.t3=new OIMO.Translational3Constraint(this,this.translationalLimitMotor,new OIMO.LimitMotor(this.tan,!0),new OIMO.LimitMotor(this.bin,!0))};OIMO.SliderJoint.prototype=Object.create(OIMO.Joint.prototype);OIMO.SliderJoint.prototype.constructor=OIMO.SliderJoint;
OIMO.SliderJoint.prototype.preSolve=function(b,f){var e,c,d;this.updateAnchorPoints();e=this.body1.rotation.elements;d=this.localAxis1X*e[0]+this.localAxis1Y*e[1]+this.localAxis1Z*e[2];var g=this.localAxis1X*e[3]+this.localAxis1Y*e[4]+this.localAxis1Z*e[5];c=this.localAxis1X*e[6]+this.localAxis1Y*e[7]+this.localAxis1Z*e[8];var m=this.localAngAxis1X*e[0]+this.localAngAxis1Y*e[1]+this.localAngAxis1Z*e[2],j=this.localAngAxis1X*e[3]+this.localAngAxis1Y*e[4]+this.localAngAxis1Z*e[5],l=this.localAngAxis1X*
e[6]+this.localAngAxis1Y*e[7]+this.localAngAxis1Z*e[8];e=this.body2.rotation.elements;var n=this.localAxis2X*e[0]+this.localAxis2Y*e[1]+this.localAxis2Z*e[2],q=this.localAxis2X*e[3]+this.localAxis2Y*e[4]+this.localAxis2Z*e[5],p=this.localAxis2X*e[6]+this.localAxis2Y*e[7]+this.localAxis2Z*e[8],r=this.localAngAxis2X*e[0]+this.localAngAxis2Y*e[1]+this.localAngAxis2Z*e[2],t=this.localAngAxis2X*e[3]+this.localAngAxis2Y*e[4]+this.localAngAxis2Z*e[5],s=this.localAngAxis2X*e[6]+this.localAngAxis2Y*e[7]+this.localAngAxis2Z*
e[8],u=d*this.body2.inverseMass+n*this.body1.inverseMass,x=g*this.body2.inverseMass+q*this.body1.inverseMass,y=c*this.body2.inverseMass+p*this.body1.inverseMass;e=OIMO.sqrt(u*u+x*x+y*y);0<e&&(e=1/e);var u=u*e,x=x*e,y=y*e,z=x*u-y*y,A=-y*x-u*u,B=u*y+x*x;e=1/OIMO.sqrt(z*z+A*A+B*B);var z=z*e,A=A*e,B=B*e,C=x*B-y*A,D=y*z-u*B,E=u*A-x*z;this.nor.init(u,x,y);this.tan.init(z,A,B);this.bin.init(C,D,E);this.rotationalLimitMotor.angle=0>u*(j*s-l*t)+x*(l*r-m*s)+y*(m*t-j*r)?-this.acosClamp(m*r+j*t+l*s):this.acosClamp(m*
r+j*t+l*s);e=g*p-c*q;c=c*n-d*p;d=d*q-g*n;this.r3.limitMotor2.angle=z*e+A*c+B*d;this.r3.limitMotor3.angle=C*e+D*c+E*d;this.r3.preSolve(b,f);this.t3.preSolve(b,f)};OIMO.SliderJoint.prototype.solve=function(){this.r3.solve();this.t3.solve()};OIMO.SliderJoint.prototype.postSolve=function(){};OIMO.SliderJoint.prototype.acosClamp=function(b){return 1<b?0:-1>b?OIMO.PI:OIMO.acos(b)};
OIMO.WheelJoint=function(b){OIMO.Joint.call(this,b);this.type=OIMO.JOINT_WHEEL;this.localAxis1=(new OIMO.Vec3).normalize(b.localAxis1);this.localAxis2=(new OIMO.Vec3).normalize(b.localAxis2);this.localAxis1X=this.localAxis1.x;this.localAxis1Y=this.localAxis1.y;this.localAxis1Z=this.localAxis1.z;this.localAxis2X=this.localAxis2.x;this.localAxis2Y=this.localAxis2.y;this.localAxis2Z=this.localAxis2.z;b=this.localAxis1X*this.localAxis2X+this.localAxis1Y*this.localAxis2Y+this.localAxis1Z*this.localAxis2Z;
-1<b&&1>b?(this.localAngAxis1X=this.localAxis2X-b*this.localAxis1X,this.localAngAxis1Y=this.localAxis2Y-b*this.localAxis1Y,this.localAngAxis1Z=this.localAxis2Z-b*this.localAxis1Z,this.localAngAxis2X=this.localAxis1X-b*this.localAxis2X,this.localAngAxis2Y=this.localAxis1Y-b*this.localAxis2Y,this.localAngAxis2Z=this.localAxis1Z-b*this.localAxis2Z,b=1/OIMO.sqrt(this.localAngAxis1X*this.localAngAxis1X+this.localAngAxis1Y*this.localAngAxis1Y+this.localAngAxis1Z*this.localAngAxis1Z),this.localAngAxis1X*=
b,this.localAngAxis1Y*=b,this.localAngAxis1Z*=b,b=1/OIMO.sqrt(this.localAngAxis2X*this.localAngAxis2X+this.localAngAxis2Y*this.localAngAxis2Y+this.localAngAxis2Z*this.localAngAxis2Z),this.localAngAxis2X*=b,this.localAngAxis2Y*=b,this.localAngAxis2Z*=b):(this.localAngAxis1X=this.localAxis1Y*this.localAxis1X-this.localAxis1Z*this.localAxis1Z,this.localAngAxis1Y=-this.localAxis1Z*this.localAxis1Y-this.localAxis1X*this.localAxis1X,this.localAngAxis1Z=this.localAxis1X*this.localAxis1Z+this.localAxis1Y*
this.localAxis1Y,b=1/OIMO.sqrt(this.localAngAxis1X*this.localAngAxis1X+this.localAngAxis1Y*this.localAngAxis1Y+this.localAngAxis1Z*this.localAngAxis1Z),this.localAngAxis1X*=b,this.localAngAxis1Y*=b,this.localAngAxis1Z*=b,b=(new OIMO.Mat33).setQuat((new OIMO.Quat).arc(this.localAxis1,this.localAxis2)).elements,this.localAngAxis2X=this.localAngAxis1X*b[0]+this.localAngAxis1Y*b[1]+this.localAngAxis1Z*b[2],this.localAngAxis2Y=this.localAngAxis1X*b[3]+this.localAngAxis1Y*b[4]+this.localAngAxis1Z*b[5],
this.localAngAxis2Z=this.localAngAxis1X*b[6]+this.localAngAxis1Y*b[7]+this.localAngAxis1Z*b[8]);this.nor=new OIMO.Vec3;this.tan=new OIMO.Vec3;this.bin=new OIMO.Vec3;this.translationalLimitMotor=new OIMO.LimitMotor(this.tan,!0);this.translationalLimitMotor.frequency=8;this.translationalLimitMotor.dampingRatio=1;this.rotationalLimitMotor1=new OIMO.LimitMotor(this.tan,!1);this.rotationalLimitMotor2=new OIMO.LimitMotor(this.bin,!1);this.t3=new OIMO.Translational3Constraint(this,new OIMO.LimitMotor(this.nor,
!0),this.translationalLimitMotor,new OIMO.LimitMotor(this.bin,!0));this.t3.weight=1;this.r3=new OIMO.Rotational3Constraint(this,new OIMO.LimitMotor(this.nor,!0),this.rotationalLimitMotor1,this.rotationalLimitMotor2)};OIMO.WheelJoint.prototype=Object.create(OIMO.Joint.prototype);OIMO.WheelJoint.prototype.constructor=OIMO.WheelJoint;
OIMO.WheelJoint.prototype.preSolve=function(b,f){var e,c;this.updateAnchorPoints();e=this.body1.rotation.elements;var d=this.localAxis1X*e[0]+this.localAxis1Y*e[1]+this.localAxis1Z*e[2],g=this.localAxis1X*e[3]+this.localAxis1Y*e[4]+this.localAxis1Z*e[5],m=this.localAxis1X*e[6]+this.localAxis1Y*e[7]+this.localAxis1Z*e[8];c=this.localAngAxis1X*e[0]+this.localAngAxis1Y*e[1]+this.localAngAxis1Z*e[2];var j=this.localAngAxis1X*e[3]+this.localAngAxis1Y*e[4]+this.localAngAxis1Z*e[5],l=this.localAngAxis1X*
e[6]+this.localAngAxis1Y*e[7]+this.localAngAxis1Z*e[8];e=this.body2.rotation.elements;var n=this.localAxis2X*e[0]+this.localAxis2Y*e[1]+this.localAxis2Z*e[2],q=this.localAxis2X*e[3]+this.localAxis2Y*e[4]+this.localAxis2Z*e[5],p=this.localAxis2X*e[6]+this.localAxis2Y*e[7]+this.localAxis2Z*e[8],r=this.localAngAxis2X*e[0]+this.localAngAxis2Y*e[1]+this.localAngAxis2Z*e[2],t=this.localAngAxis2X*e[3]+this.localAngAxis2Y*e[4]+this.localAngAxis2Z*e[5];e=this.localAngAxis2X*e[6]+this.localAngAxis2Y*e[7]+this.localAngAxis2Z*
e[8];this.r3.limitMotor1.angle=d*n+g*q+m*p;this.rotationalLimitMotor1.angle=0>d*(j*p-l*q)+g*(l*n-c*p)+m*(c*q-j*n)?-this.acosClamp(c*n+j*q+l*p):this.acosClamp(c*n+j*q+l*p);this.rotationalLimitMotor2.angle=0>n*(t*m-e*g)+q*(e*d-r*m)+p*(r*g-t*d)?this.acosClamp(r*d+t*g+e*m):-this.acosClamp(r*d+t*g+e*m);j=q*m-p*g;l=p*d-n*m;r=n*g-q*d;c=OIMO.sqrt(j*j+l*l+r*r);0<c&&(c=1/c);j*=c;l*=c;r*=c;t=l*p-r*q;p=r*n-j*p;n=j*q-l*n;c=OIMO.sqrt(t*t+p*p+n*n);0<c&&(c=1/c);t*=c;p*=c;n*=c;q=g*r-m*l;m=m*j-d*r;d=d*l-g*j;c=OIMO.sqrt(q*
q+m*m+d*d);0<c&&(c=1/c);q*=c;m*=c;d*=c;this.nor.init(j,l,r);this.tan.init(t,p,n);this.bin.init(q,m,d);this.r3.preSolve(b,f);this.t3.preSolve(b,f)};OIMO.WheelJoint.prototype.solve=function(){this.r3.solve();this.t3.solve()};OIMO.WheelJoint.prototype.postSolve=function(){};OIMO.WheelJoint.prototype.acosClamp=function(b){return 1<b?0:-1>b?OIMO.PI:OIMO.acos(b)};
OIMO.AngularConstraint=function(b,f){this.joint=b;this.targetOrientation=(new OIMO.Quat).invert(f);this.relativeOrientation=new OIMO.Quat;this.dd=this.ii2=this.ii1=null;this.vel=new OIMO.Vec3;this.imp=new OIMO.Vec3;this.rn0=new OIMO.Vec3;this.rn1=new OIMO.Vec3;this.rn2=new OIMO.Vec3;this.b1=b.body1;this.b2=b.body2;this.a1=this.b1.angularVelocity;this.a2=this.b2.angularVelocity;this.i1=this.b1.inverseInertia;this.i2=this.b2.inverseInertia};
OIMO.AngularConstraint.prototype={constructor:OIMO.AngularConstraint,preSolve:function(b,f){var e,c;this.ii1=this.i1.clone();this.ii2=this.i2.clone();c=(new OIMO.Mat33).add(this.ii1,this.ii2).elements;e=1/(c[0]*(c[4]*c[8]-c[7]*c[5])+c[3]*(c[7]*c[2]-c[1]*c[8])+c[6]*(c[1]*c[5]-c[4]*c[2]));this.dd=(new OIMO.Mat33(c[4]*c[8]-c[5]*c[7],c[2]*c[7]-c[1]*c[8],c[1]*c[5]-c[2]*c[4],c[5]*c[6]-c[3]*c[8],c[0]*c[8]-c[2]*c[6],c[2]*c[3]-c[0]*c[5],c[3]*c[7]-c[4]*c[6],c[1]*c[6]-c[0]*c[7],c[0]*c[4]-c[1]*c[3])).multiply(e);
this.relativeOrientation.invert(this.b1.orientation);this.relativeOrientation.mul(this.targetOrientation,this.relativeOrientation);this.relativeOrientation.mul(this.b2.orientation,this.relativeOrientation);e=2*this.relativeOrientation.s;this.vel.scale(this.relativeOrientation,e);e=this.vel.length();0.02<e?this.vel.scaleEqual(0.05*(0.02-e)/e*f):this.vel.init();this.rn1.mulMat(this.ii1,this.imp);this.rn2.mulMat(this.ii2,this.imp);this.a1.addEqual(this.rn1);this.a2.subEqual(this.rn2)},solve:function(){var b=
this.a2.clone().subEqual(this.a1).subEqual(this.vel);this.rn0.mulMat(this.dd,b);this.rn1.mulMat(this.ii1,this.rn0);this.rn2.mulMat(this.ii2,this.rn0);this.imp.addEqual(this.rn0);this.a1.addEqual(this.rn1);this.a2.subEqual(this.rn2)}};
OIMO.LinearConstraint=function(b){this.m2=this.m1=NaN;this.dd=this.ii2=this.ii1=null;this.velz=this.vely=this.velx=this.vel=this.az2z=this.az2y=this.az2x=this.ay2z=this.ay2y=this.ay2x=this.ax2z=this.ax2y=this.ax2x=this.az1z=this.az1y=this.az1x=this.ay1z=this.ay1y=this.ay1x=this.ax1z=this.ax1y=this.ax1x=this.r2z=this.r2y=this.r2x=this.r1z=this.r1y=this.r1x=NaN;this.joint=b;this.r1=b.relativeAnchorPoint1;this.r2=b.relativeAnchorPoint2;this.p1=b.anchorPoint1;this.p2=b.anchorPoint2;this.b1=b.body1;this.b2=
b.body2;this.l1=this.b1.linearVelocity;this.l2=this.b2.linearVelocity;this.a1=this.b1.angularVelocity;this.a2=this.b2.angularVelocity;this.i1=this.b1.inverseInertia;this.i2=this.b2.inverseInertia;this.impz=this.impy=this.impx=0};
OIMO.LinearConstraint.prototype={constructor:OIMO.LinearConstraint,preSolve:function(b,f){this.r1x=this.r1.x;this.r1y=this.r1.y;this.r1z=this.r1.z;this.r2x=this.r2.x;this.r2y=this.r2.y;this.r2z=this.r2.z;this.m1=this.b1.inverseMass;this.m2=this.b2.inverseMass;this.ii1=this.i1.clone();this.ii2=this.i2.clone();var e=this.ii1.elements,c=this.ii2.elements;this.ax1x=this.r1z*e[1]+-this.r1y*e[2];this.ax1y=this.r1z*e[4]+-this.r1y*e[5];this.ax1z=this.r1z*e[7]+-this.r1y*e[8];this.ay1x=-this.r1z*e[0]+this.r1x*
e[2];this.ay1y=-this.r1z*e[3]+this.r1x*e[5];this.ay1z=-this.r1z*e[6]+this.r1x*e[8];this.az1x=this.r1y*e[0]+-this.r1x*e[1];this.az1y=this.r1y*e[3]+-this.r1x*e[4];this.az1z=this.r1y*e[6]+-this.r1x*e[7];this.ax2x=this.r2z*c[1]+-this.r2y*c[2];this.ax2y=this.r2z*c[4]+-this.r2y*c[5];this.ax2z=this.r2z*c[7]+-this.r2y*c[8];this.ay2x=-this.r2z*c[0]+this.r2x*c[2];this.ay2y=-this.r2z*c[3]+this.r2x*c[5];this.ay2z=-this.r2z*c[6]+this.r2x*c[8];this.az2x=this.r2y*c[0]+-this.r2x*c[1];this.az2y=this.r2y*c[3]+-this.r2x*
c[4];this.az2z=this.r2y*c[6]+-this.r2x*c[7];var d=this.m1+this.m2,d=(new OIMO.Mat33(d,0,0,0,d,0,0,0,d)).elements;d[0]+=e[4]*this.r1z*this.r1z-(e[7]+e[5])*this.r1y*this.r1z+e[8]*this.r1y*this.r1y;d[1]+=(e[6]*this.r1y+e[5]*this.r1x)*this.r1z-e[3]*this.r1z*this.r1z-e[8]*this.r1x*this.r1y;d[2]+=(e[3]*this.r1y-e[4]*this.r1x)*this.r1z-e[6]*this.r1y*this.r1y+e[7]*this.r1x*this.r1y;d[3]+=(e[2]*this.r1y+e[7]*this.r1x)*this.r1z-e[1]*this.r1z*this.r1z-e[8]*this.r1x*this.r1y;d[4]+=e[0]*this.r1z*this.r1z-(e[6]+
e[2])*this.r1x*this.r1z+e[8]*this.r1x*this.r1x;d[5]+=(e[1]*this.r1x-e[0]*this.r1y)*this.r1z-e[7]*this.r1x*this.r1x+e[6]*this.r1x*this.r1y;d[6]+=(e[1]*this.r1y-e[4]*this.r1x)*this.r1z-e[2]*this.r1y*this.r1y+e[5]*this.r1x*this.r1y;d[7]+=(e[3]*this.r1x-e[0]*this.r1y)*this.r1z-e[5]*this.r1x*this.r1x+e[2]*this.r1x*this.r1y;d[8]+=e[0]*this.r1y*this.r1y-(e[3]+e[1])*this.r1x*this.r1y+e[4]*this.r1x*this.r1x;d[0]+=c[4]*this.r2z*this.r2z-(c[7]+c[5])*this.r2y*this.r2z+c[8]*this.r2y*this.r2y;d[1]+=(c[6]*this.r2y+
c[5]*this.r2x)*this.r2z-c[3]*this.r2z*this.r2z-c[8]*this.r2x*this.r2y;d[2]+=(c[3]*this.r2y-c[4]*this.r2x)*this.r2z-c[6]*this.r2y*this.r2y+c[7]*this.r2x*this.r2y;d[3]+=(c[2]*this.r2y+c[7]*this.r2x)*this.r2z-c[1]*this.r2z*this.r2z-c[8]*this.r2x*this.r2y;d[4]+=c[0]*this.r2z*this.r2z-(c[6]+c[2])*this.r2x*this.r2z+c[8]*this.r2x*this.r2x;d[5]+=(c[1]*this.r2x-c[0]*this.r2y)*this.r2z-c[7]*this.r2x*this.r2x+c[6]*this.r2x*this.r2y;d[6]+=(c[1]*this.r2y-c[4]*this.r2x)*this.r2z-c[2]*this.r2y*this.r2y+c[5]*this.r2x*
this.r2y;d[7]+=(c[3]*this.r2x-c[0]*this.r2y)*this.r2z-c[5]*this.r2x*this.r2x+c[2]*this.r2x*this.r2y;d[8]+=c[0]*this.r2y*this.r2y-(c[3]+c[1])*this.r2x*this.r2y+c[4]*this.r2x*this.r2x;e=1/(d[0]*(d[4]*d[8]-d[7]*d[5])+d[3]*(d[7]*d[2]-d[1]*d[8])+d[6]*(d[1]*d[5]-d[4]*d[2]));this.dd=(new OIMO.Mat33(d[4]*d[8]-d[5]*d[7],d[2]*d[7]-d[1]*d[8],d[1]*d[5]-d[2]*d[4],d[5]*d[6]-d[3]*d[8],d[0]*d[8]-d[2]*d[6],d[2]*d[3]-d[0]*d[5],d[3]*d[7]-d[4]*d[6],d[1]*d[6]-d[0]*d[7],d[0]*d[4]-d[1]*d[3])).multiply(e);this.velx=this.p2.x-
this.p1.x;this.vely=this.p2.y-this.p1.y;this.velz=this.p2.z-this.p1.z;e=OIMO.sqrt(this.velx*this.velx+this.vely*this.vely+this.velz*this.velz);0.0050<e?(e=0.05*(0.0050-e)/e*f,this.velx*=e,this.vely*=e,this.velz*=e):this.velz=this.vely=this.velx=0;this.impx*=0.95;this.impy*=0.95;this.impz*=0.95;this.l1.x+=this.impx*this.m1;this.l1.y+=this.impy*this.m1;this.l1.z+=this.impz*this.m1;this.a1.x+=this.impx*this.ax1x+this.impy*this.ay1x+this.impz*this.az1x;this.a1.y+=this.impx*this.ax1y+this.impy*this.ay1y+
this.impz*this.az1y;this.a1.z+=this.impx*this.ax1z+this.impy*this.ay1z+this.impz*this.az1z;this.l2.x-=this.impx*this.m2;this.l2.y-=this.impy*this.m2;this.l2.z-=this.impz*this.m2;this.a2.x-=this.impx*this.ax2x+this.impy*this.ay2x+this.impz*this.az2x;this.a2.y-=this.impx*this.ax2y+this.impy*this.ay2y+this.impz*this.az2y;this.a2.z-=this.impx*this.ax2z+this.impy*this.ay2z+this.impz*this.az2z},solve:function(){var b=this.dd.elements,f=this.l2.x-this.l1.x+this.a2.y*this.r2z-this.a2.z*this.r2y-this.a1.y*
this.r1z+this.a1.z*this.r1y-this.velx,e=this.l2.y-this.l1.y+this.a2.z*this.r2x-this.a2.x*this.r2z-this.a1.z*this.r1x+this.a1.x*this.r1z-this.vely,c=this.l2.z-this.l1.z+this.a2.x*this.r2y-this.a2.y*this.r2x-this.a1.x*this.r1y+this.a1.y*this.r1x-this.velz,d=f*b[0]+e*b[1]+c*b[2],g=f*b[3]+e*b[4]+c*b[5],b=f*b[6]+e*b[7]+c*b[8];this.impx+=d;this.impy+=g;this.impz+=b;this.l1.x+=d*this.m1;this.l1.y+=g*this.m1;this.l1.z+=b*this.m1;this.a1.x+=d*this.ax1x+g*this.ay1x+b*this.az1x;this.a1.y+=d*this.ax1y+g*this.ay1y+
b*this.az1y;this.a1.z+=d*this.ax1z+g*this.ay1z+b*this.az1z;this.l2.x-=d*this.m2;this.l2.y-=g*this.m2;this.l2.z-=b*this.m2;this.a2.x-=d*this.ax2x+g*this.ay2x+b*this.az2x;this.a2.y-=d*this.ax2y+g*this.ay2y+b*this.az2y;this.a2.z-=d*this.ax2z+g*this.ay2z+b*this.az2z}};
OIMO.Rotational3Constraint=function(b,f,e,c){this.limitVelocity1=this.upperLimit1=this.lowerLimit1=this.a2z3=this.a2y3=this.a2x3=this.a1z3=this.a1y3=this.a1x3=this.a2z2=this.a2y2=this.a2x2=this.a1z2=this.a1y2=this.a1x2=this.a2z1=this.a2y1=this.a2x1=this.a1z1=this.a1y1=this.a1x1=this.az3=this.ay3=this.ax3=this.az2=this.ay2=this.ax2=this.az1=this.ay1=this.ax1=this.i2e22=this.i2e21=this.i2e20=this.i2e12=this.i2e11=this.i2e10=this.i2e02=this.i2e01=this.i2e00=this.i1e22=this.i1e21=this.i1e20=this.i1e12=
this.i1e11=this.i1e10=this.i1e02=this.i1e01=this.i1e00=this.cfm3=this.cfm2=this.cfm1=NaN;this.limitState1=0;this.enableMotor1=!1;this.limitVelocity2=this.upperLimit2=this.lowerLimit2=this.maxMotorImpulse1=this.maxMotorForce1=this.motorSpeed1=NaN;this.limitState2=0;this.enableMotor2=!1;this.limitVelocity3=this.upperLimit3=this.lowerLimit3=this.maxMotorImpulse2=this.maxMotorForce2=this.motorSpeed2=NaN;this.limitState3=0;this.enableMotor3=!1;this.d22=this.d21=this.d20=this.d12=this.d11=this.d10=this.d02=
this.d01=this.d00=this.dv22=this.dv11=this.dv00=this.kv22=this.kv11=this.kv00=this.k22=this.k21=this.k20=this.k12=this.k11=this.k10=this.k02=this.k01=this.k00=this.maxMotorImpulse3=this.maxMotorForce3=this.motorSpeed3=NaN;this.limitMotor1=f;this.limitMotor2=e;this.limitMotor3=c;this.b1=b.body1;this.b2=b.body2;this.a1=this.b1.angularVelocity;this.a2=this.b2.angularVelocity;this.i1=this.b1.inverseInertia;this.i2=this.b2.inverseInertia;this.motorImpulse3=this.limitImpulse3=this.motorImpulse2=this.limitImpulse2=
this.motorImpulse1=this.limitImpulse1=0};
OIMO.Rotational3Constraint.prototype={constructor:OIMO.Rotational3Constraint,preSolve:function(b,f){this.ax1=this.limitMotor1.axis.x;this.ay1=this.limitMotor1.axis.y;this.az1=this.limitMotor1.axis.z;this.ax2=this.limitMotor2.axis.x;this.ay2=this.limitMotor2.axis.y;this.az2=this.limitMotor2.axis.z;this.ax3=this.limitMotor3.axis.x;this.ay3=this.limitMotor3.axis.y;this.az3=this.limitMotor3.axis.z;this.lowerLimit1=this.limitMotor1.lowerLimit;this.upperLimit1=this.limitMotor1.upperLimit;this.motorSpeed1=
this.limitMotor1.motorSpeed;this.maxMotorForce1=this.limitMotor1.maxMotorForce;this.enableMotor1=0<this.maxMotorForce1;this.lowerLimit2=this.limitMotor2.lowerLimit;this.upperLimit2=this.limitMotor2.upperLimit;this.motorSpeed2=this.limitMotor2.motorSpeed;this.maxMotorForce2=this.limitMotor2.maxMotorForce;this.enableMotor2=0<this.maxMotorForce2;this.lowerLimit3=this.limitMotor3.lowerLimit;this.upperLimit3=this.limitMotor3.upperLimit;this.motorSpeed3=this.limitMotor3.motorSpeed;this.maxMotorForce3=this.limitMotor3.maxMotorForce;
this.enableMotor3=0<this.maxMotorForce3;var e=this.i1.elements,c=this.i2.elements;this.i1e00=e[0];this.i1e01=e[1];this.i1e02=e[2];this.i1e10=e[3];this.i1e11=e[4];this.i1e12=e[5];this.i1e20=e[6];this.i1e21=e[7];this.i1e22=e[8];this.i2e00=c[0];this.i2e01=c[1];this.i2e02=c[2];this.i2e10=c[3];this.i2e11=c[4];this.i2e12=c[5];this.i2e20=c[6];this.i2e21=c[7];this.i2e22=c[8];var d=this.limitMotor1.frequency,e=this.limitMotor2.frequency,c=this.limitMotor3.frequency,g=0<d,m=0<e,j=0<c,l=this.lowerLimit2<=this.upperLimit2,
n=this.lowerLimit3<=this.upperLimit3,q=this.limitMotor1.angle;this.lowerLimit1<=this.upperLimit1?(this.lowerLimit1==this.upperLimit1?(0!=this.limitState1&&(this.limitImpulse1=this.limitState1=0),this.limitVelocity1=this.lowerLimit1-q):q<this.lowerLimit1?(-1!=this.limitState1&&(this.limitState1=-1,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-q):q>this.upperLimit1?(1!=this.limitState1&&(this.limitState1=1,this.limitImpulse1=0),this.limitVelocity1=this.upperLimit1-q):(this.limitState1=
2,this.limitVelocity1=this.limitImpulse1=0),g||(this.limitVelocity1=0.02<this.limitVelocity1?this.limitVelocity1-0.02:-0.02>this.limitVelocity1?this.limitVelocity1+0.02:0)):(this.limitState1=2,this.limitImpulse1=0);q=this.limitMotor2.angle;l?(this.lowerLimit2==this.upperLimit2?(0!=this.limitState2&&(this.limitImpulse2=this.limitState2=0),this.limitVelocity2=this.lowerLimit2-q):q<this.lowerLimit2?(-1!=this.limitState2&&(this.limitState2=-1,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-
q):q>this.upperLimit2?(1!=this.limitState2&&(this.limitState2=1,this.limitImpulse2=0),this.limitVelocity2=this.upperLimit2-q):(this.limitState2=2,this.limitVelocity2=this.limitImpulse2=0),m||(this.limitVelocity2=0.02<this.limitVelocity2?this.limitVelocity2-0.02:-0.02>this.limitVelocity2?this.limitVelocity2+0.02:0)):(this.limitState2=2,this.limitImpulse2=0);l=this.limitMotor3.angle;n?(this.lowerLimit3==this.upperLimit3?(0!=this.limitState3&&(this.limitImpulse3=this.limitState3=0),this.limitVelocity3=
this.lowerLimit3-l):l<this.lowerLimit3?(-1!=this.limitState3&&(this.limitState3=-1,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-l):l>this.upperLimit3?(1!=this.limitState3&&(this.limitState3=1,this.limitImpulse3=0),this.limitVelocity3=this.upperLimit3-l):(this.limitState3=2,this.limitVelocity3=this.limitImpulse3=0),j||(this.limitVelocity3=0.02<this.limitVelocity3?this.limitVelocity3-0.02:-0.02>this.limitVelocity3?this.limitVelocity3+0.02:0)):(this.limitState3=2,this.limitImpulse3=0);
this.maxMotorImpulse1=this.enableMotor1&&(0!=this.limitState1||g)?this.maxMotorForce1*b:this.motorImpulse1=0;this.maxMotorImpulse2=this.enableMotor2&&(0!=this.limitState2||m)?this.maxMotorForce2*b:this.motorImpulse2=0;this.maxMotorImpulse3=this.enableMotor3&&(0!=this.limitState3||j)?this.maxMotorForce3*b:this.motorImpulse3=0;this.a1x1=this.ax1*this.i1e00+this.ay1*this.i1e01+this.az1*this.i1e02;this.a1y1=this.ax1*this.i1e10+this.ay1*this.i1e11+this.az1*this.i1e12;this.a1z1=this.ax1*this.i1e20+this.ay1*
this.i1e21+this.az1*this.i1e22;this.a2x1=this.ax1*this.i2e00+this.ay1*this.i2e01+this.az1*this.i2e02;this.a2y1=this.ax1*this.i2e10+this.ay1*this.i2e11+this.az1*this.i2e12;this.a2z1=this.ax1*this.i2e20+this.ay1*this.i2e21+this.az1*this.i2e22;this.a1x2=this.ax2*this.i1e00+this.ay2*this.i1e01+this.az2*this.i1e02;this.a1y2=this.ax2*this.i1e10+this.ay2*this.i1e11+this.az2*this.i1e12;this.a1z2=this.ax2*this.i1e20+this.ay2*this.i1e21+this.az2*this.i1e22;this.a2x2=this.ax2*this.i2e00+this.ay2*this.i2e01+
this.az2*this.i2e02;this.a2y2=this.ax2*this.i2e10+this.ay2*this.i2e11+this.az2*this.i2e12;this.a2z2=this.ax2*this.i2e20+this.ay2*this.i2e21+this.az2*this.i2e22;this.a1x3=this.ax3*this.i1e00+this.ay3*this.i1e01+this.az3*this.i1e02;this.a1y3=this.ax3*this.i1e10+this.ay3*this.i1e11+this.az3*this.i1e12;this.a1z3=this.ax3*this.i1e20+this.ay3*this.i1e21+this.az3*this.i1e22;this.a2x3=this.ax3*this.i2e00+this.ay3*this.i2e01+this.az3*this.i2e02;this.a2y3=this.ax3*this.i2e10+this.ay3*this.i2e11+this.az3*this.i2e12;
this.a2z3=this.ax3*this.i2e20+this.ay3*this.i2e21+this.az3*this.i2e22;this.k00=this.ax1*(this.a1x1+this.a2x1)+this.ay1*(this.a1y1+this.a2y1)+this.az1*(this.a1z1+this.a2z1);this.k01=this.ax1*(this.a1x2+this.a2x2)+this.ay1*(this.a1y2+this.a2y2)+this.az1*(this.a1z2+this.a2z2);this.k02=this.ax1*(this.a1x3+this.a2x3)+this.ay1*(this.a1y3+this.a2y3)+this.az1*(this.a1z3+this.a2z3);this.k10=this.ax2*(this.a1x1+this.a2x1)+this.ay2*(this.a1y1+this.a2y1)+this.az2*(this.a1z1+this.a2z1);this.k11=this.ax2*(this.a1x2+
this.a2x2)+this.ay2*(this.a1y2+this.a2y2)+this.az2*(this.a1z2+this.a2z2);this.k12=this.ax2*(this.a1x3+this.a2x3)+this.ay2*(this.a1y3+this.a2y3)+this.az2*(this.a1z3+this.a2z3);this.k20=this.ax3*(this.a1x1+this.a2x1)+this.ay3*(this.a1y1+this.a2y1)+this.az3*(this.a1z1+this.a2z1);this.k21=this.ax3*(this.a1x2+this.a2x2)+this.ay3*(this.a1y2+this.a2y2)+this.az3*(this.a1z2+this.a2z2);this.k22=this.ax3*(this.a1x3+this.a2x3)+this.ay3*(this.a1y3+this.a2y3)+this.az3*(this.a1z3+this.a2z3);this.kv00=this.k00;this.kv11=
this.k11;this.kv22=this.k22;this.dv00=1/this.kv00;this.dv11=1/this.kv11;this.dv22=1/this.kv22;g&&2!=this.limitState1?(g=6.2831853*d,d=g*g*b,g=f/(d+2*this.limitMotor1.dampingRatio*g),this.cfm1=this.kv00*g,this.limitVelocity1*=d*g):(this.cfm1=0,this.limitVelocity1*=0.05*f);m&&2!=this.limitState2?(g=6.2831853*e,d=g*g*b,g=f/(d+2*this.limitMotor2.dampingRatio*g),this.cfm2=this.kv11*g,this.limitVelocity2*=d*g):(this.cfm2=0,this.limitVelocity2*=0.05*f);j&&2!=this.limitState3?(g=6.2831853*c,d=g*g*b,g=f/(d+
2*this.limitMotor3.dampingRatio*g),this.cfm3=this.kv22*g,this.limitVelocity3*=d*g):(this.cfm3=0,this.limitVelocity3*=0.05*f);this.k00+=this.cfm1;this.k11+=this.cfm2;this.k22+=this.cfm3;e=1/(this.k00*(this.k11*this.k22-this.k21*this.k12)+this.k10*(this.k21*this.k02-this.k01*this.k22)+this.k20*(this.k01*this.k12-this.k11*this.k02));this.d00=(this.k11*this.k22-this.k12*this.k21)*e;this.d01=(this.k02*this.k21-this.k01*this.k22)*e;this.d02=(this.k01*this.k12-this.k02*this.k11)*e;this.d10=(this.k12*this.k20-
this.k10*this.k22)*e;this.d11=(this.k00*this.k22-this.k02*this.k20)*e;this.d12=(this.k02*this.k10-this.k00*this.k12)*e;this.d20=(this.k10*this.k21-this.k11*this.k20)*e;this.d21=(this.k01*this.k20-this.k00*this.k21)*e;this.d22=(this.k00*this.k11-this.k01*this.k10)*e;this.limitImpulse1*=0.95;this.motorImpulse1*=0.95;this.limitImpulse2*=0.95;this.motorImpulse2*=0.95;this.limitImpulse3*=0.95;this.motorImpulse3*=0.95;e=this.limitImpulse1+this.motorImpulse1;c=this.limitImpulse2+this.motorImpulse2;m=this.limitImpulse3+
this.motorImpulse3;this.a1.x+=e*this.a1x1+c*this.a1x2+m*this.a1x3;this.a1.y+=e*this.a1y1+c*this.a1y2+m*this.a1y3;this.a1.z+=e*this.a1z1+c*this.a1z2+m*this.a1z3;this.a2.x-=e*this.a2x1+c*this.a2x2+m*this.a2x3;this.a2.y-=e*this.a2y1+c*this.a2y2+m*this.a2y3;this.a2.z-=e*this.a2z1+c*this.a2z2+m*this.a2z3},solve_:function(){var b=this.a2.x-this.a1.x,f=this.a2.y-this.a1.y,e=this.a2.z-this.a1.z;this.limitVelocity3=30;var c=b*this.ax1+f*this.ay1+e*this.az1-this.limitVelocity1,d=b*this.ax2+f*this.ay2+e*this.az2-
this.limitVelocity2,e=b*this.ax3+f*this.ay3+e*this.az3-this.limitVelocity3,b=c*this.d00+d*this.d01+e*this.d02,f=c*this.d10+d*this.d11+e*this.d12,c=c*this.d20+d*this.d21+e*this.d22;this.limitImpulse1+=b;this.limitImpulse2+=f;this.limitImpulse3+=c;this.a1.x+=b*this.a1x1+f*this.a1x2+c*this.a1x3;this.a1.y+=b*this.a1y1+f*this.a1y2+c*this.a1y3;this.a1.z+=b*this.a1z1+f*this.a1z2+c*this.a1z3;this.a2.x-=b*this.a2x1+f*this.a2x2+c*this.a2x3;this.a2.y-=b*this.a2y1+f*this.a2y2+c*this.a2y3;this.a2.z-=b*this.a2z1+
f*this.a2z2+c*this.a2z3},solve:function(){var b=this.a2.x-this.a1.x,f=this.a2.y-this.a1.y,e=this.a2.z-this.a1.z,c=b*this.ax1+f*this.ay1+e*this.az1,d=b*this.ax2+f*this.ay2+e*this.az2,e=b*this.ax3+f*this.ay3+e*this.az3,g=this.motorImpulse1,m=this.motorImpulse2,j=this.motorImpulse3,l=0,b=f=0;this.enableMotor1&&(l=(c-this.motorSpeed1)*this.dv00,this.motorImpulse1+=l,this.motorImpulse1>this.maxMotorImpulse1?this.motorImpulse1=this.maxMotorImpulse1:this.motorImpulse1<-this.maxMotorImpulse1&&(this.motorImpulse1=
-this.maxMotorImpulse1),l=this.motorImpulse1-g);this.enableMotor2&&(f=(d-this.motorSpeed2)*this.dv11,this.motorImpulse2+=f,this.motorImpulse2>this.maxMotorImpulse2?this.motorImpulse2=this.maxMotorImpulse2:this.motorImpulse2<-this.maxMotorImpulse2&&(this.motorImpulse2=-this.maxMotorImpulse2),f=this.motorImpulse2-m);this.enableMotor3&&(b=(e-this.motorSpeed3)*this.dv22,this.motorImpulse3+=b,this.motorImpulse3>this.maxMotorImpulse3?this.motorImpulse3=this.maxMotorImpulse3:this.motorImpulse3<-this.maxMotorImpulse3&&
(this.motorImpulse3=-this.maxMotorImpulse3),b=this.motorImpulse3-j);var c=c+(l*this.kv00+f*this.k01+b*this.k02),d=d+(l*this.k10+f*this.kv11+b*this.k12),e=e+(l*this.k20+f*this.k21+b*this.kv22),c=c-(this.limitVelocity1+this.limitImpulse1*this.cfm1),d=d-(this.limitVelocity2+this.limitImpulse2*this.cfm2),e=e-(this.limitVelocity3+this.limitImpulse3*this.cfm3),j=this.limitImpulse1,n=this.limitImpulse2,q=this.limitImpulse3,p=c*this.d00+d*this.d01+e*this.d02,m=c*this.d10+d*this.d11+e*this.d12,g=c*this.d20+
d*this.d21+e*this.d22;this.limitImpulse1+=p;this.limitImpulse2+=m;this.limitImpulse3+=g;var r=0;if(2==this.limitState1||0>this.limitImpulse1*this.limitState1)p=-j,d+=p*this.k10,e+=p*this.k20,r|=1;if(2==this.limitState2||0>this.limitImpulse2*this.limitState2)m=-n,c+=m*this.k01,e+=m*this.k21,r|=2;if(2==this.limitState3||0>this.limitImpulse3*this.limitState3)g=-q,c+=g*this.k02,d+=g*this.k12,r|=4;switch(r){case 1:r=1/(this.k11*this.k22-this.k12*this.k21);m=(this.k22*d+-this.k12*e)*r;g=(-this.k21*d+this.k11*
e)*r;break;case 2:r=1/(this.k00*this.k22-this.k02*this.k20);p=(this.k22*c+-this.k02*e)*r;g=(-this.k20*c+this.k00*e)*r;break;case 3:g=e/this.k22;break;case 4:r=1/(this.k00*this.k11-this.k01*this.k10);p=(this.k11*c+-this.k01*d)*r;m=(-this.k10*c+this.k00*d)*r;break;case 5:m=d/this.k11;break;case 6:p=c/this.k00}this.limitImpulse1=p+j;this.limitImpulse2=m+n;this.limitImpulse3=g+q;c=l+p;d=f+m;b+=g;this.a1.x+=c*this.a1x1+d*this.a1x2+b*this.a1x3;this.a1.y+=c*this.a1y1+d*this.a1y2+b*this.a1y3;this.a1.z+=c*
this.a1z1+d*this.a1z2+b*this.a1z3;this.a2.x-=c*this.a2x1+d*this.a2x2+b*this.a2x3;this.a2.y-=c*this.a2y1+d*this.a2y2+b*this.a2y3;this.a2.z-=c*this.a2z1+d*this.a2z2+b*this.a2z3}};
OIMO.RotationalConstraint=function(b,f){this.a2z=this.a2y=this.a2x=this.a1z=this.a1y=this.a1x=this.az=this.ay=this.ax=this.invDenom=this.invMotorDenom=this.motorDenom=this.i2e22=this.i2e21=this.i2e20=this.i2e12=this.i2e11=this.i2e10=this.i2e02=this.i2e01=this.i2e00=this.i1e22=this.i1e21=this.i1e20=this.i1e12=this.i1e11=this.i1e10=this.i1e02=this.i1e01=this.i1e00=this.cfm=NaN;this.enableLimit=!1;this.limitVelocity=this.upperLimit=this.lowerLimit=NaN;this.limitState=0;this.enableMotor=!1;this.maxMotorImpulse=
this.maxMotorForce=this.motorSpeed=NaN;this.limitMotor=f;this.b1=b.body1;this.b2=b.body2;this.a1=this.b1.angularVelocity;this.a2=this.b2.angularVelocity;this.i1=this.b1.inverseInertia;this.i2=this.b2.inverseInertia;this.motorImpulse=this.limitImpulse=0};
OIMO.RotationalConstraint.prototype={constructor:OIMO.RotationalConstraint,preSolve:function(b,f){this.ax=this.limitMotor.axis.x;this.ay=this.limitMotor.axis.y;this.az=this.limitMotor.axis.z;this.lowerLimit=this.limitMotor.lowerLimit;this.upperLimit=this.limitMotor.upperLimit;this.motorSpeed=this.limitMotor.motorSpeed;this.maxMotorForce=this.limitMotor.maxMotorForce;this.enableMotor=0<this.maxMotorForce;var e=this.i1.elements,c=this.i2.elements;this.i1e00=e[0];this.i1e01=e[1];this.i1e02=e[2];this.i1e10=
e[3];this.i1e11=e[4];this.i1e12=e[5];this.i1e20=e[6];this.i1e21=e[7];this.i1e22=e[8];this.i2e00=c[0];this.i2e01=c[1];this.i2e02=c[2];this.i2e10=c[3];this.i2e11=c[4];this.i2e12=c[5];this.i2e20=c[6];this.i2e21=c[7];this.i2e22=c[8];var e=this.limitMotor.frequency,c=0<e,d=this.limitMotor.angle;this.lowerLimit<=this.upperLimit?(this.lowerLimit==this.upperLimit?(0!=this.limitState&&(this.limitImpulse=this.limitState=0),this.limitVelocity=this.lowerLimit-d):d<this.lowerLimit?(-1!=this.limitState&&(this.limitState=
-1,this.limitImpulse=0),this.limitVelocity=this.lowerLimit-d):d>this.upperLimit?(1!=this.limitState&&(this.limitState=1,this.limitImpulse=0),this.limitVelocity=this.upperLimit-d):(this.limitState=2,this.limitVelocity=this.limitImpulse=0),c||(this.limitVelocity=0.02<this.limitVelocity?this.limitVelocity-0.02:-0.02>this.limitVelocity?this.limitVelocity+0.02:0)):(this.limitState=2,this.limitImpulse=0);this.maxMotorImpulse=this.enableMotor&&(0!=this.limitState||c)?this.maxMotorForce*b:this.motorImpulse=
0;this.a1x=this.ax*this.i1e00+this.ay*this.i1e01+this.az*this.i1e02;this.a1y=this.ax*this.i1e10+this.ay*this.i1e11+this.az*this.i1e12;this.a1z=this.ax*this.i1e20+this.ay*this.i1e21+this.az*this.i1e22;this.a2x=this.ax*this.i2e00+this.ay*this.i2e01+this.az*this.i2e02;this.a2y=this.ax*this.i2e10+this.ay*this.i2e11+this.az*this.i2e12;this.a2z=this.ax*this.i2e20+this.ay*this.i2e21+this.az*this.i2e22;this.motorDenom=this.ax*(this.a1x+this.a2x)+this.ay*(this.a1y+this.a2y)+this.az*(this.a1z+this.a2z);this.invMotorDenom=
1/this.motorDenom;c&&2!=this.limitState?(c=6.2831853*e,e=c*c*b,c=f/(e+2*this.limitMotor.dampingRatio*c),this.cfm=this.motorDenom*c,this.limitVelocity*=e*c):(this.cfm=0,this.limitVelocity*=0.05*f);this.invDenom=1/(this.motorDenom+this.cfm);this.limitImpulse*=0.95;this.motorImpulse*=0.95;e=this.limitImpulse+this.motorImpulse;this.a1.x+=e*this.a1x;this.a1.y+=e*this.a1y;this.a1.z+=e*this.a1z;this.a2.x-=e*this.a2x;this.a2.y-=e*this.a2y;this.a2.z-=e*this.a2z},solve:function(){var b=this.ax*(this.a2.x-this.a1.x)+
this.ay*(this.a2.y-this.a1.y)+this.az*(this.a2.z-this.a1.z),f;if(this.enableMotor){f=(b-this.motorSpeed)*this.invMotorDenom;var e=this.motorImpulse;this.motorImpulse+=f;this.motorImpulse>this.maxMotorImpulse?this.motorImpulse=this.maxMotorImpulse:this.motorImpulse<-this.maxMotorImpulse&&(this.motorImpulse=-this.maxMotorImpulse);f=this.motorImpulse-e;b-=f*this.motorDenom}else f=0;2!=this.limitState?(b=(b-this.limitVelocity-this.limitImpulse*this.cfm)*this.invDenom,e=this.limitImpulse,this.limitImpulse+=
b,0>this.limitImpulse*this.limitState&&(this.limitImpulse=0),b=this.limitImpulse-e):b=0;f=b+f;this.a1.x+=f*this.a1x;this.a1.y+=f*this.a1y;this.a1.z+=f*this.a1z;this.a2.x-=f*this.a2x;this.a2.y-=f*this.a2y;this.a2.z-=f*this.a2z}};
OIMO.Translational3Constraint=function(b,f,e,c){this.limitVelocity1=this.upperLimit1=this.lowerLimit1=this.a2z3=this.a2y3=this.a2x3=this.a1z3=this.a1y3=this.a1x3=this.l2z3=this.l2y3=this.l2x3=this.l1z3=this.l1y3=this.l1x3=this.t2z3=this.t2y3=this.t2x3=this.t1z3=this.t1y3=this.t1x3=this.a2z2=this.a2y2=this.a2x2=this.a1z2=this.a1y2=this.a1x2=this.l2z2=this.l2y2=this.l2x2=this.l1z2=this.l1y2=this.l1x2=this.t2z2=this.t2y2=this.t2x2=this.t1z2=this.t1y2=this.t1x2=this.a2z1=this.a2y1=this.a2x1=this.a1z1=
this.a1y1=this.a1x1=this.l2z1=this.l2y1=this.l2x1=this.l1z1=this.l1y1=this.l1x1=this.t2z1=this.t2y1=this.t2x1=this.t1z1=this.t1y1=this.t1x1=this.r2z=this.r2y=this.r2x=this.r1z=this.r1y=this.r1x=this.az3=this.ay3=this.ax3=this.az2=this.ay2=this.ax2=this.az1=this.ay1=this.ax1=this.i2e22=this.i2e21=this.i2e20=this.i2e12=this.i2e11=this.i2e10=this.i2e02=this.i2e01=this.i2e00=this.i1e22=this.i1e21=this.i1e20=this.i1e12=this.i1e11=this.i1e10=this.i1e02=this.i1e01=this.i1e00=this.m2=this.m1=NaN;this.limitState1=
0;this.enableMotor1=!1;this.limitVelocity2=this.upperLimit2=this.lowerLimit2=this.maxMotorImpulse1=this.maxMotorForce1=this.motorSpeed1=NaN;this.limitState2=0;this.enableMotor2=!1;this.limitVelocity3=this.upperLimit3=this.lowerLimit3=this.maxMotorImpulse2=this.maxMotorForce2=this.motorSpeed2=NaN;this.limitState3=0;this.enableMotor3=!1;this.d22=this.d21=this.d20=this.d12=this.d11=this.d10=this.d02=this.d01=this.d00=this.dv22=this.dv11=this.dv00=this.kv22=this.kv11=this.kv00=this.k22=this.k21=this.k20=
this.k12=this.k11=this.k10=this.k02=this.k01=this.k00=this.maxMotorImpulse3=this.maxMotorForce3=this.motorSpeed3=NaN;this.limitMotor1=f;this.limitMotor2=e;this.limitMotor3=c;this.b1=b.body1;this.b2=b.body2;this.p1=b.anchorPoint1;this.p2=b.anchorPoint2;this.r1=b.relativeAnchorPoint1;this.r2=b.relativeAnchorPoint2;this.l1=this.b1.linearVelocity;this.l2=this.b2.linearVelocity;this.a1=this.b1.angularVelocity;this.a2=this.b2.angularVelocity;this.i1=this.b1.inverseInertia;this.i2=this.b2.inverseInertia;
this.cfm3=this.cfm2=this.cfm1=this.motorImpulse3=this.limitImpulse3=this.motorImpulse2=this.limitImpulse2=this.motorImpulse1=this.limitImpulse1=0;this.weight=-1};
OIMO.Translational3Constraint.prototype={constructor:OIMO.Translational3Constraint,preSolve:function(b,f){this.ax1=this.limitMotor1.axis.x;this.ay1=this.limitMotor1.axis.y;this.az1=this.limitMotor1.axis.z;this.ax2=this.limitMotor2.axis.x;this.ay2=this.limitMotor2.axis.y;this.az2=this.limitMotor2.axis.z;this.ax3=this.limitMotor3.axis.x;this.ay3=this.limitMotor3.axis.y;this.az3=this.limitMotor3.axis.z;this.lowerLimit1=this.limitMotor1.lowerLimit;this.upperLimit1=this.limitMotor1.upperLimit;this.motorSpeed1=
this.limitMotor1.motorSpeed;this.maxMotorForce1=this.limitMotor1.maxMotorForce;this.enableMotor1=0<this.maxMotorForce1;this.lowerLimit2=this.limitMotor2.lowerLimit;this.upperLimit2=this.limitMotor2.upperLimit;this.motorSpeed2=this.limitMotor2.motorSpeed;this.maxMotorForce2=this.limitMotor2.maxMotorForce;this.enableMotor2=0<this.maxMotorForce2;this.lowerLimit3=this.limitMotor3.lowerLimit;this.upperLimit3=this.limitMotor3.upperLimit;this.motorSpeed3=this.limitMotor3.motorSpeed;this.maxMotorForce3=this.limitMotor3.maxMotorForce;
this.enableMotor3=0<this.maxMotorForce3;this.m1=this.b1.inverseMass;this.m2=this.b2.inverseMass;var e=this.i1.elements,c=this.i2.elements;this.i1e00=e[0];this.i1e01=e[1];this.i1e02=e[2];this.i1e10=e[3];this.i1e11=e[4];this.i1e12=e[5];this.i1e20=e[6];this.i1e21=e[7];this.i1e22=e[8];this.i2e00=c[0];this.i2e01=c[1];this.i2e02=c[2];this.i2e10=c[3];this.i2e11=c[4];this.i2e12=c[5];this.i2e20=c[6];this.i2e21=c[7];this.i2e22=c[8];var e=this.p2.x-this.p1.x,c=this.p2.y-this.p1.y,d=this.p2.z-this.p1.z,g=e*this.ax1+
c*this.ay1+d*this.az1,m=e*this.ax2+c*this.ay2+d*this.az2,j=e*this.ax3+c*this.ay3+d*this.az3,l=this.limitMotor1.frequency,e=this.limitMotor2.frequency,c=this.limitMotor3.frequency,n=0<l,d=0<e,q=0<c,p=this.lowerLimit1<=this.upperLimit1,r=this.lowerLimit2<=this.upperLimit2,t=this.lowerLimit3<=this.upperLimit3;if(n&&20<g||-20>g)n=!1;if(d&&20<m||-20>m)d=!1;if(q&&20<j||-20>j)q=!1;p?(this.lowerLimit1==this.upperLimit1?(0!=this.limitState1&&(this.limitImpulse1=this.limitState1=0),this.limitVelocity1=this.lowerLimit1-
g,n||(g=this.lowerLimit1)):g<this.lowerLimit1?(-1!=this.limitState1&&(this.limitState1=-1,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-g,n||(g=this.lowerLimit1)):g>this.upperLimit1?(1!=this.limitState1&&(this.limitState1=1,this.limitImpulse1=0),this.limitVelocity1=this.upperLimit1-g,n||(g=this.upperLimit1)):(this.limitState1=2,this.limitVelocity1=this.limitImpulse1=0),n||(this.limitVelocity1=0.0050<this.limitVelocity1?this.limitVelocity1-0.0050:-0.0050>this.limitVelocity1?this.limitVelocity1+
0.0050:0)):(this.limitState1=2,this.limitImpulse1=0);r?(this.lowerLimit2==this.upperLimit2?(0!=this.limitState2&&(this.limitImpulse2=this.limitState2=0),this.limitVelocity2=this.lowerLimit2-m,d||(m=this.lowerLimit2)):m<this.lowerLimit2?(-1!=this.limitState2&&(this.limitState2=-1,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-m,d||(m=this.lowerLimit2)):m>this.upperLimit2?(1!=this.limitState2&&(this.limitState2=1,this.limitImpulse2=0),this.limitVelocity2=this.upperLimit2-m,d||(m=this.upperLimit2)):
(this.limitState2=2,this.limitVelocity2=this.limitImpulse2=0),d||(this.limitVelocity2=0.0050<this.limitVelocity2?this.limitVelocity2-0.0050:-0.0050>this.limitVelocity2?this.limitVelocity2+0.0050:0)):(this.limitState2=2,this.limitImpulse2=0);t?(this.lowerLimit3==this.upperLimit3?(0!=this.limitState3&&(this.limitImpulse3=this.limitState3=0),this.limitVelocity3=this.lowerLimit3-j,q||(j=this.lowerLimit3)):j<this.lowerLimit3?(-1!=this.limitState3&&(this.limitState3=-1,this.limitImpulse3=0),this.limitVelocity3=
this.lowerLimit3-j,q||(j=this.lowerLimit3)):j>this.upperLimit3?(1!=this.limitState3&&(this.limitState3=1,this.limitImpulse3=0),this.limitVelocity3=this.upperLimit3-j,q||(j=this.upperLimit3)):(this.limitState3=2,this.limitVelocity3=this.limitImpulse3=0),q||(this.limitVelocity3=0.0050<this.limitVelocity3?this.limitVelocity3-0.0050:-0.0050>this.limitVelocity3?this.limitVelocity3+0.0050:0)):(this.limitState3=2,this.limitImpulse3=0);this.maxMotorImpulse1=this.enableMotor1&&(0!=this.limitState1||n)?this.maxMotorForce1*
b:this.motorImpulse1=0;this.maxMotorImpulse2=this.enableMotor2&&(0!=this.limitState2||d)?this.maxMotorForce2*b:this.motorImpulse2=0;this.maxMotorImpulse3=this.enableMotor3&&(0!=this.limitState3||q)?this.maxMotorForce3*b:this.motorImpulse3=0;p=g*this.ax1+m*this.ax2+j*this.ax2;r=g*this.ay1+m*this.ay2+j*this.ay2;g=g*this.az1+m*this.az2+j*this.az2;m=this.m2/(this.m1+this.m2);0<=this.weight&&(m=this.weight);j=1-m;this.r1x=this.r1.x+p*m;this.r1y=this.r1.y+r*m;this.r1z=this.r1.z+g*m;this.r2x=this.r2.x-p*
j;this.r2y=this.r2.y-r*j;this.r2z=this.r2.z-g*j;this.t1x1=this.r1y*this.az1-this.r1z*this.ay1;this.t1y1=this.r1z*this.ax1-this.r1x*this.az1;this.t1z1=this.r1x*this.ay1-this.r1y*this.ax1;this.t2x1=this.r2y*this.az1-this.r2z*this.ay1;this.t2y1=this.r2z*this.ax1-this.r2x*this.az1;this.t2z1=this.r2x*this.ay1-this.r2y*this.ax1;this.l1x1=this.ax1*this.m1;this.l1y1=this.ay1*this.m1;this.l1z1=this.az1*this.m1;this.l2x1=this.ax1*this.m2;this.l2y1=this.ay1*this.m2;this.l2z1=this.az1*this.m2;this.a1x1=this.t1x1*
this.i1e00+this.t1y1*this.i1e01+this.t1z1*this.i1e02;this.a1y1=this.t1x1*this.i1e10+this.t1y1*this.i1e11+this.t1z1*this.i1e12;this.a1z1=this.t1x1*this.i1e20+this.t1y1*this.i1e21+this.t1z1*this.i1e22;this.a2x1=this.t2x1*this.i2e00+this.t2y1*this.i2e01+this.t2z1*this.i2e02;this.a2y1=this.t2x1*this.i2e10+this.t2y1*this.i2e11+this.t2z1*this.i2e12;this.a2z1=this.t2x1*this.i2e20+this.t2y1*this.i2e21+this.t2z1*this.i2e22;this.t1x2=this.r1y*this.az2-this.r1z*this.ay2;this.t1y2=this.r1z*this.ax2-this.r1x*
this.az2;this.t1z2=this.r1x*this.ay2-this.r1y*this.ax2;this.t2x2=this.r2y*this.az2-this.r2z*this.ay2;this.t2y2=this.r2z*this.ax2-this.r2x*this.az2;this.t2z2=this.r2x*this.ay2-this.r2y*this.ax2;this.l1x2=this.ax2*this.m1;this.l1y2=this.ay2*this.m1;this.l1z2=this.az2*this.m1;this.l2x2=this.ax2*this.m2;this.l2y2=this.ay2*this.m2;this.l2z2=this.az2*this.m2;this.a1x2=this.t1x2*this.i1e00+this.t1y2*this.i1e01+this.t1z2*this.i1e02;this.a1y2=this.t1x2*this.i1e10+this.t1y2*this.i1e11+this.t1z2*this.i1e12;
this.a1z2=this.t1x2*this.i1e20+this.t1y2*this.i1e21+this.t1z2*this.i1e22;this.a2x2=this.t2x2*this.i2e00+this.t2y2*this.i2e01+this.t2z2*this.i2e02;this.a2y2=this.t2x2*this.i2e10+this.t2y2*this.i2e11+this.t2z2*this.i2e12;this.a2z2=this.t2x2*this.i2e20+this.t2y2*this.i2e21+this.t2z2*this.i2e22;this.t1x3=this.r1y*this.az3-this.r1z*this.ay3;this.t1y3=this.r1z*this.ax3-this.r1x*this.az3;this.t1z3=this.r1x*this.ay3-this.r1y*this.ax3;this.t2x3=this.r2y*this.az3-this.r2z*this.ay3;this.t2y3=this.r2z*this.ax3-
this.r2x*this.az3;this.t2z3=this.r2x*this.ay3-this.r2y*this.ax3;this.l1x3=this.ax3*this.m1;this.l1y3=this.ay3*this.m1;this.l1z3=this.az3*this.m1;this.l2x3=this.ax3*this.m2;this.l2y3=this.ay3*this.m2;this.l2z3=this.az3*this.m2;this.a1x3=this.t1x3*this.i1e00+this.t1y3*this.i1e01+this.t1z3*this.i1e02;this.a1y3=this.t1x3*this.i1e10+this.t1y3*this.i1e11+this.t1z3*this.i1e12;this.a1z3=this.t1x3*this.i1e20+this.t1y3*this.i1e21+this.t1z3*this.i1e22;this.a2x3=this.t2x3*this.i2e00+this.t2y3*this.i2e01+this.t2z3*
this.i2e02;this.a2y3=this.t2x3*this.i2e10+this.t2y3*this.i2e11+this.t2z3*this.i2e12;this.a2z3=this.t2x3*this.i2e20+this.t2y3*this.i2e21+this.t2z3*this.i2e22;g=this.m1+this.m2;this.k00=(this.ax1*this.ax1+this.ay1*this.ay1+this.az1*this.az1)*g;this.k01=(this.ax1*this.ax2+this.ay1*this.ay2+this.az1*this.az2)*g;this.k02=(this.ax1*this.ax3+this.ay1*this.ay3+this.az1*this.az3)*g;this.k10=(this.ax2*this.ax1+this.ay2*this.ay1+this.az2*this.az1)*g;this.k11=(this.ax2*this.ax2+this.ay2*this.ay2+this.az2*this.az2)*
g;this.k12=(this.ax2*this.ax3+this.ay2*this.ay3+this.az2*this.az3)*g;this.k20=(this.ax3*this.ax1+this.ay3*this.ay1+this.az3*this.az1)*g;this.k21=(this.ax3*this.ax2+this.ay3*this.ay2+this.az3*this.az2)*g;this.k22=(this.ax3*this.ax3+this.ay3*this.ay3+this.az3*this.az3)*g;this.k00+=this.t1x1*this.a1x1+this.t1y1*this.a1y1+this.t1z1*this.a1z1;this.k01+=this.t1x1*this.a1x2+this.t1y1*this.a1y2+this.t1z1*this.a1z2;this.k02+=this.t1x1*this.a1x3+this.t1y1*this.a1y3+this.t1z1*this.a1z3;this.k10+=this.t1x2*this.a1x1+
this.t1y2*this.a1y1+this.t1z2*this.a1z1;this.k11+=this.t1x2*this.a1x2+this.t1y2*this.a1y2+this.t1z2*this.a1z2;this.k12+=this.t1x2*this.a1x3+this.t1y2*this.a1y3+this.t1z2*this.a1z3;this.k20+=this.t1x3*this.a1x1+this.t1y3*this.a1y1+this.t1z3*this.a1z1;this.k21+=this.t1x3*this.a1x2+this.t1y3*this.a1y2+this.t1z3*this.a1z2;this.k22+=this.t1x3*this.a1x3+this.t1y3*this.a1y3+this.t1z3*this.a1z3;this.k00+=this.t2x1*this.a2x1+this.t2y1*this.a2y1+this.t2z1*this.a2z1;this.k01+=this.t2x1*this.a2x2+this.t2y1*this.a2y2+
this.t2z1*this.a2z2;this.k02+=this.t2x1*this.a2x3+this.t2y1*this.a2y3+this.t2z1*this.a2z3;this.k10+=this.t2x2*this.a2x1+this.t2y2*this.a2y1+this.t2z2*this.a2z1;this.k11+=this.t2x2*this.a2x2+this.t2y2*this.a2y2+this.t2z2*this.a2z2;this.k12+=this.t2x2*this.a2x3+this.t2y2*this.a2y3+this.t2z2*this.a2z3;this.k20+=this.t2x3*this.a2x1+this.t2y3*this.a2y1+this.t2z3*this.a2z1;this.k21+=this.t2x3*this.a2x2+this.t2y3*this.a2y2+this.t2z3*this.a2z2;this.k22+=this.t2x3*this.a2x3+this.t2y3*this.a2y3+this.t2z3*this.a2z3;
this.kv00=this.k00;this.kv11=this.k11;this.kv22=this.k22;this.dv00=1/this.kv00;this.dv11=1/this.kv11;this.dv22=1/this.kv22;n&&2!=this.limitState1?(n=6.2831853*l,l=n*n*b,n=f/(l+2*this.limitMotor1.dampingRatio*n),this.cfm1=this.kv00*n,this.limitVelocity1*=l*n):(this.cfm1=0,this.limitVelocity1*=0.05*f);d&&2!=this.limitState2?(n=6.2831853*e,l=n*n*b,n=f/(l+2*this.limitMotor2.dampingRatio*n),this.cfm2=this.kv11*n,this.limitVelocity2*=l*n):(this.cfm2=0,this.limitVelocity2*=0.05*f);q&&2!=this.limitState3?
(n=6.2831853*c,l=n*n*b,n=f/(l+2*this.limitMotor3.dampingRatio*n),this.cfm3=this.kv22*n,this.limitVelocity3*=l*n):(this.cfm3=0,this.limitVelocity3*=0.05*f);this.k00+=this.cfm1;this.k11+=this.cfm2;this.k22+=this.cfm3;e=1/(this.k00*(this.k11*this.k22-this.k21*this.k12)+this.k10*(this.k21*this.k02-this.k01*this.k22)+this.k20*(this.k01*this.k12-this.k11*this.k02));this.d00=(this.k11*this.k22-this.k12*this.k21)*e;this.d01=(this.k02*this.k21-this.k01*this.k22)*e;this.d02=(this.k01*this.k12-this.k02*this.k11)*
e;this.d10=(this.k12*this.k20-this.k10*this.k22)*e;this.d11=(this.k00*this.k22-this.k02*this.k20)*e;this.d12=(this.k02*this.k10-this.k00*this.k12)*e;this.d20=(this.k10*this.k21-this.k11*this.k20)*e;this.d21=(this.k01*this.k20-this.k00*this.k21)*e;this.d22=(this.k00*this.k11-this.k01*this.k10)*e;e=this.limitImpulse1+this.motorImpulse1;c=this.limitImpulse2+this.motorImpulse2;d=this.limitImpulse3+this.motorImpulse3;this.l1.x+=e*this.l1x1+c*this.l1x2+d*this.l1x3;this.l1.y+=e*this.l1y1+c*this.l1y2+d*this.l1y3;
this.l1.z+=e*this.l1z1+c*this.l1z2+d*this.l1z3;this.a1.x+=e*this.a1x1+c*this.a1x2+d*this.a1x3;this.a1.y+=e*this.a1y1+c*this.a1y2+d*this.a1y3;this.a1.z+=e*this.a1z1+c*this.a1z2+d*this.a1z3;this.l2.x-=e*this.l2x1+c*this.l2x2+d*this.l2x3;this.l2.y-=e*this.l2y1+c*this.l2y2+d*this.l2y3;this.l2.z-=e*this.l2z1+c*this.l2z2+d*this.l2z3;this.a2.x-=e*this.a2x1+c*this.a2x2+d*this.a2x3;this.a2.y-=e*this.a2y1+c*this.a2y2+d*this.a2y3;this.a2.z-=e*this.a2z1+c*this.a2z2+d*this.a2z3},solve:function(){var b=this.l2.x-
this.l1.x+this.a2.y*this.r2z-this.a2.z*this.r2y-this.a1.y*this.r1z+this.a1.z*this.r1y,f=this.l2.y-this.l1.y+this.a2.z*this.r2x-this.a2.x*this.r2z-this.a1.z*this.r1x+this.a1.x*this.r1z,e=this.l2.z-this.l1.z+this.a2.x*this.r2y-this.a2.y*this.r2x-this.a1.x*this.r1y+this.a1.y*this.r1x,c=b*this.ax1+f*this.ay1+e*this.az1,d=b*this.ax2+f*this.ay2+e*this.az2,e=b*this.ax3+f*this.ay3+e*this.az3,g=this.motorImpulse1,m=this.motorImpulse2,j=this.motorImpulse3,l=0,b=f=0;this.enableMotor1&&(l=(c-this.motorSpeed1)*
this.dv00,this.motorImpulse1+=l,this.motorImpulse1>this.maxMotorImpulse1?this.motorImpulse1=this.maxMotorImpulse1:this.motorImpulse1<-this.maxMotorImpulse1&&(this.motorImpulse1=-this.maxMotorImpulse1),l=this.motorImpulse1-g);this.enableMotor2&&(f=(d-this.motorSpeed2)*this.dv11,this.motorImpulse2+=f,this.motorImpulse2>this.maxMotorImpulse2?this.motorImpulse2=this.maxMotorImpulse2:this.motorImpulse2<-this.maxMotorImpulse2&&(this.motorImpulse2=-this.maxMotorImpulse2),f=this.motorImpulse2-m);this.enableMotor3&&
(b=(e-this.motorSpeed3)*this.dv22,this.motorImpulse3+=b,this.motorImpulse3>this.maxMotorImpulse3?this.motorImpulse3=this.maxMotorImpulse3:this.motorImpulse3<-this.maxMotorImpulse3&&(this.motorImpulse3=-this.maxMotorImpulse3),b=this.motorImpulse3-j);var c=c+(l*this.kv00+f*this.k01+b*this.k02),d=d+(l*this.k10+f*this.kv11+b*this.k12),e=e+(l*this.k20+f*this.k21+b*this.kv22),c=c-(this.limitVelocity1+this.limitImpulse1*this.cfm1),d=d-(this.limitVelocity2+this.limitImpulse2*this.cfm2),e=e-(this.limitVelocity3+
this.limitImpulse3*this.cfm3),j=this.limitImpulse1,n=this.limitImpulse2,q=this.limitImpulse3,p=c*this.d00+d*this.d01+e*this.d02,m=c*this.d10+d*this.d11+e*this.d12,g=c*this.d20+d*this.d21+e*this.d22;this.limitImpulse1+=p;this.limitImpulse2+=m;this.limitImpulse3+=g;var r=0;if(2==this.limitState1||0>this.limitImpulse1*this.limitState1)p=-j,d+=p*this.k10,e+=p*this.k20,r|=1;if(2==this.limitState2||0>this.limitImpulse2*this.limitState2)m=-n,c+=m*this.k01,e+=m*this.k21,r|=2;if(2==this.limitState3||0>this.limitImpulse3*
this.limitState3)g=-q,c+=g*this.k02,d+=g*this.k12,r|=4;switch(r){case 1:r=1/(this.k11*this.k22-this.k12*this.k21);m=(this.k22*d+-this.k12*e)*r;g=(-this.k21*d+this.k11*e)*r;break;case 2:r=1/(this.k00*this.k22-this.k02*this.k20);p=(this.k22*c+-this.k02*e)*r;g=(-this.k20*c+this.k00*e)*r;break;case 3:g=e/this.k22;break;case 4:r=1/(this.k00*this.k11-this.k01*this.k10);p=(this.k11*c+-this.k01*d)*r;m=(-this.k10*c+this.k00*d)*r;break;case 5:m=d/this.k11;break;case 6:p=c/this.k00}this.limitImpulse1=j+p;this.limitImpulse2=
n+m;this.limitImpulse3=q+g;c=l+p;d=f+m;b+=g;this.l1.x+=c*this.l1x1+d*this.l1x2+b*this.l1x3;this.l1.y+=c*this.l1y1+d*this.l1y2+b*this.l1y3;this.l1.z+=c*this.l1z1+d*this.l1z2+b*this.l1z3;this.a1.x+=c*this.a1x1+d*this.a1x2+b*this.a1x3;this.a1.y+=c*this.a1y1+d*this.a1y2+b*this.a1y3;this.a1.z+=c*this.a1z1+d*this.a1z2+b*this.a1z3;this.l2.x-=c*this.l2x1+d*this.l2x2+b*this.l2x3;this.l2.y-=c*this.l2y1+d*this.l2y2+b*this.l2y3;this.l2.z-=c*this.l2z1+d*this.l2z2+b*this.l2z3;this.a2.x-=c*this.a2x1+d*this.a2x2+
b*this.a2x3;this.a2.y-=c*this.a2y1+d*this.a2y2+b*this.a2y3;this.a2.z-=c*this.a2z1+d*this.a2z2+b*this.a2z3}};
OIMO.TranslationalConstraint=function(b,f){this.limitVelocity=this.upperLimit=this.lowerLimit=this.a2z=this.a2y=this.a2x=this.a1z=this.a1y=this.a1x=this.l2z=this.l2y=this.l2x=this.l1z=this.l1y=this.l1x=this.t2z=this.t2y=this.t2x=this.t1z=this.t1y=this.t1x=this.r2z=this.r2y=this.r2x=this.r1z=this.r1y=this.r1x=this.az=this.ay=this.ax=this.invDenom=this.invMotorDenom=this.motorDenom=this.i2e22=this.i2e21=this.i2e20=this.i2e12=this.i2e11=this.i2e10=this.i2e02=this.i2e01=this.i2e00=this.i1e22=this.i1e21=
this.i1e20=this.i1e12=this.i1e11=this.i1e10=this.i1e02=this.i1e01=this.i1e00=this.m2=this.m1=this.cfm=NaN;this.limitState=0;this.enableMotor=!1;this.maxMotorImpulse=this.maxMotorForce=this.motorSpeed=NaN;this.limitMotor=f;this.b1=b.body1;this.b2=b.body2;this.p1=b.anchorPoint1;this.p2=b.anchorPoint2;this.r1=b.relativeAnchorPoint1;this.r2=b.relativeAnchorPoint2;this.l1=this.b1.linearVelocity;this.l2=this.b2.linearVelocity;this.a1=this.b1.angularVelocity;this.a2=this.b2.angularVelocity;this.i1=this.b1.inverseInertia;
this.i2=this.b2.inverseInertia;this.motorImpulse=this.limitImpulse=0};
OIMO.TranslationalConstraint.prototype={constructor:OIMO.TranslationalConstraint,preSolve:function(b,f){this.ax=this.limitMotor.axis.x;this.ay=this.limitMotor.axis.y;this.az=this.limitMotor.axis.z;this.lowerLimit=this.limitMotor.lowerLimit;this.upperLimit=this.limitMotor.upperLimit;this.motorSpeed=this.limitMotor.motorSpeed;this.maxMotorForce=this.limitMotor.maxMotorForce;this.enableMotor=0<this.maxMotorForce;this.m1=this.b1.inverseMass;this.m2=this.b2.inverseMass;var e=this.i1.elements,c=this.i2.elements;
this.i1e00=e[0];this.i1e01=e[1];this.i1e02=e[2];this.i1e10=e[3];this.i1e11=e[4];this.i1e12=e[5];this.i1e20=e[6];this.i1e21=e[7];this.i1e22=e[8];this.i2e00=c[0];this.i2e01=c[1];this.i2e02=c[2];this.i2e10=c[3];this.i2e11=c[4];this.i2e12=c[5];this.i2e20=c[6];this.i2e21=c[7];this.i2e22=c[8];var d=(this.p2.x-this.p1.x)*this.ax+(this.p2.y-this.p1.y)*this.ay+(this.p2.z-this.p1.z)*this.az,e=this.limitMotor.frequency,c=0<e,g=this.lowerLimit<=this.upperLimit;if(c&&20<d||-20>d)c=!1;g?(this.lowerLimit==this.upperLimit?
(0!=this.limitState&&(this.limitImpulse=this.limitState=0),this.limitVelocity=this.lowerLimit-d,c||(d=this.lowerLimit)):d<this.lowerLimit?(-1!=this.limitState&&(this.limitState=-1,this.limitImpulse=0),this.limitVelocity=this.lowerLimit-d,c||(d=this.lowerLimit)):d>this.upperLimit?(1!=this.limitState&&(this.limitState=1,this.limitImpulse=0),this.limitVelocity=this.upperLimit-d,c||(d=this.upperLimit)):(this.limitState=2,this.limitVelocity=this.limitImpulse=0),c||(this.limitVelocity=0.0050<this.limitVelocity?
this.limitVelocity-0.0050:-0.0050>this.limitVelocity?this.limitVelocity+0.0050:0)):(this.limitState=2,this.limitImpulse=0);this.maxMotorImpulse=this.enableMotor&&(0!=this.limitState||c)?this.maxMotorForce*b:this.motorImpulse=0;var g=d*this.ax,m=d*this.ay,d=d*this.az,j=this.m1/(this.m1+this.m2),l=1-j;this.r1x=this.r1.x+g*j;this.r1y=this.r1.y+m*j;this.r1z=this.r1.z+d*j;this.r2x=this.r2.x-g*l;this.r2y=this.r2.y-m*l;this.r2z=this.r2.z-d*l;this.t1x=this.r1y*this.az-this.r1z*this.ay;this.t1y=this.r1z*this.ax-
this.r1x*this.az;this.t1z=this.r1x*this.ay-this.r1y*this.ax;this.t2x=this.r2y*this.az-this.r2z*this.ay;this.t2y=this.r2z*this.ax-this.r2x*this.az;this.t2z=this.r2x*this.ay-this.r2y*this.ax;this.l1x=this.ax*this.m1;this.l1y=this.ay*this.m1;this.l1z=this.az*this.m1;this.l2x=this.ax*this.m2;this.l2y=this.ay*this.m2;this.l2z=this.az*this.m2;this.a1x=this.t1x*this.i1e00+this.t1y*this.i1e01+this.t1z*this.i1e02;this.a1y=this.t1x*this.i1e10+this.t1y*this.i1e11+this.t1z*this.i1e12;this.a1z=this.t1x*this.i1e20+
this.t1y*this.i1e21+this.t1z*this.i1e22;this.a2x=this.t2x*this.i2e00+this.t2y*this.i2e01+this.t2z*this.i2e02;this.a2y=this.t2x*this.i2e10+this.t2y*this.i2e11+this.t2z*this.i2e12;this.a2z=this.t2x*this.i2e20+this.t2y*this.i2e21+this.t2z*this.i2e22;this.motorDenom=this.m1+this.m2+this.ax*(this.a1y*this.r1z-this.a1z*this.r1y+this.a2y*this.r2z-this.a2z*this.r2y)+this.ay*(this.a1z*this.r1x-this.a1x*this.r1z+this.a2z*this.r2x-this.a2x*this.r2z)+this.az*(this.a1x*this.r1y-this.a1y*this.r1x+this.a2x*this.r2y-
this.a2y*this.r2x);this.invMotorDenom=1/this.motorDenom;c&&2!=this.limitState?(c=6.2831853*e,e=c*c*b,c=f/(e+2*this.limitMotor.dampingRatio*c),this.cfm=this.motorDenom*c,this.limitVelocity*=e*c):(this.cfm=0,this.limitVelocity*=0.05*f);this.invDenom=1/(this.motorDenom+this.cfm);e=this.limitImpulse+this.motorImpulse;this.l1.x+=e*this.l1x;this.l1.y+=e*this.l1y;this.l1.z+=e*this.l1z;this.a1.x+=e*this.a1x;this.a1.y+=e*this.a1y;this.a1.z+=e*this.a1z;this.l2.x-=e*this.l2x;this.l2.y-=e*this.l2y;this.l2.z-=
e*this.l2z;this.a2.x-=e*this.a2x;this.a2.y-=e*this.a2y;this.a2.z-=e*this.a2z},solve:function(){var b=this.ax*(this.l2.x-this.l1.x)+this.ay*(this.l2.y-this.l1.y)+this.az*(this.l2.z-this.l1.z)+this.t2x*this.a2.x-this.t1x*this.a1.x+this.t2y*this.a2.y-this.t1y*this.a1.y+this.t2z*this.a2.z-this.t1z*this.a1.z,f;if(this.enableMotor){f=(b-this.motorSpeed)*this.invMotorDenom;var e=this.motorImpulse;this.motorImpulse+=f;this.motorImpulse>this.maxMotorImpulse?this.motorImpulse=this.maxMotorImpulse:this.motorImpulse<
-this.maxMotorImpulse&&(this.motorImpulse=-this.maxMotorImpulse);f=this.motorImpulse-e;b-=f*this.motorDenom}else f=0;2!=this.limitState?(b=(b-this.limitVelocity-this.limitImpulse*this.cfm)*this.invDenom,e=this.limitImpulse,this.limitImpulse+=b,0>this.limitImpulse*this.limitState&&(this.limitImpulse=0),b=this.limitImpulse-e):b=0;f=b+f;this.l1.x+=f*this.l1x;this.l1.y+=f*this.l1y;this.l1.z+=f*this.l1z;this.a1.x+=f*this.a1x;this.a1.y+=f*this.a1y;this.a1.z+=f*this.a1z;this.l2.x-=f*this.l2x;this.l2.y-=
f*this.l2y;this.l2.z-=f*this.l2z;this.a2.x-=f*this.a2x;this.a2.y-=f*this.a2y;this.a2.z-=f*this.a2z}};
OIMO.Contact=function(){this.next=this.prev=this.body2=this.body1=this.shape2=this.shape1=null;this.sleeping=this.persisting=!1;this.constraint=this.detector=null;this.touching=!1;this.b1Link=new OIMO.ContactLink(this);this.b2Link=new OIMO.ContactLink(this);this.s1Link=new OIMO.ContactLink(this);this.s2Link=new OIMO.ContactLink(this);this.manifold=new OIMO.ContactManifold;this.buffer=[];this.buffer.length=4;this.buffer[0]=new OIMO.ImpulseDataBuffer;this.buffer[1]=new OIMO.ImpulseDataBuffer;this.buffer[2]=
new OIMO.ImpulseDataBuffer;this.buffer[3]=new OIMO.ImpulseDataBuffer;this.points=this.manifold.points;this.constraint=new OIMO.ContactConstraint(this.manifold)};
OIMO.Contact.prototype={constructor:OIMO.Contact,mixRestitution:function(b,f){return OIMO.sqrt(b*f)},mixFriction:function(b,f){return OIMO.sqrt(b*f)},updateManifold:function(){this.constraint.restitution=this.mixRestitution(this.shape1.restitution,this.shape2.restitution);this.constraint.friction=this.mixFriction(this.shape1.friction,this.shape2.friction);for(var b=this.manifold.numPoints,f=b;f--;){var e=this.buffer[f],c=this.points[f];e.lp1X=c.localPoint1.x;e.lp1Y=c.localPoint1.y;e.lp1Z=c.localPoint1.z;
e.lp2X=c.localPoint2.x;e.lp2Y=c.localPoint2.y;e.lp2Z=c.localPoint2.z;e.impulse=c.normalImpulse}this.manifold.numPoints=0;this.detector.detectCollision(this.shape1,this.shape2,this.manifold);f=this.manifold.numPoints;if(0==f)this.touching=!1;else for(this.touching=!0;f--;){for(var c=this.points[f],d=c.localPoint1.x,g=c.localPoint1.y,m=c.localPoint1.z,j=c.localPoint2.x,l=c.localPoint2.y,n=c.localPoint2.z,q=-1,p=4E-4,r=b;r--;){var e=this.buffer[r],t=e.lp1X-d,s=e.lp1Y-g,u=e.lp1Z-m,x=t*t+s*s+u*u,t=e.lp2X-
j,s=e.lp2Y-l,u=e.lp2Z-n,e=t*t+s*s+u*u;x<e?x<p&&(p=x,q=r):e<p&&(p=e,q=r)}-1!=q?(d=this.buffer[q],this.buffer[q]=this.buffer[--b],this.buffer[b]=d,c.normalImpulse=d.impulse,c.warmStarted=!0):(c.normalImpulse=0,c.warmStarted=!1)}},attach:function(b,f){this.shape1=b;this.shape2=f;this.body1=b.parent;this.body2=f.parent;this.manifold.body1=this.body1;this.manifold.body2=this.body2;this.constraint.body1=this.body1;this.constraint.body2=this.body2;this.constraint.attach();this.s1Link.shape=f;this.s1Link.body=
this.body2;this.s2Link.shape=b;this.s2Link.body=this.body1;null!=b.contactLink?(this.s1Link.next=b.contactLink).prev=this.s1Link:this.s1Link.next=null;b.contactLink=this.s1Link;b.numContacts++;null!=f.contactLink?(this.s2Link.next=f.contactLink).prev=this.s2Link:this.s2Link.next=null;f.contactLink=this.s2Link;f.numContacts++;this.b1Link.shape=f;this.b1Link.body=this.body2;this.b2Link.shape=b;this.b2Link.body=this.body1;null!=this.body1.contactLink?(this.b1Link.next=this.body1.contactLink).prev=this.b1Link:
this.b1Link.next=null;this.body1.contactLink=this.b1Link;this.body1.numContacts++;null!=this.body2.contactLink?(this.b2Link.next=this.body2.contactLink).prev=this.b2Link:this.b2Link.next=null;this.body2.contactLink=this.b2Link;this.body2.numContacts++;this.next=this.prev=null;this.persisting=!0;this.sleeping=this.body1.sleeping&&this.body2.sleeping;this.manifold.numPoints=0},detach:function(){var b=this.s1Link.prev,f=this.s1Link.next;null!==b&&(b.next=f);null!==f&&(f.prev=b);this.shape1.contactLink==
this.s1Link&&(this.shape1.contactLink=f);this.s1Link.prev=null;this.s1Link.next=null;this.s1Link.shape=null;this.s1Link.body=null;this.shape1.numContacts--;b=this.s2Link.prev;f=this.s2Link.next;null!==b&&(b.next=f);null!==f&&(f.prev=b);this.shape2.contactLink==this.s2Link&&(this.shape2.contactLink=f);this.s2Link.prev=null;this.s2Link.next=null;this.s2Link.shape=null;this.s2Link.body=null;this.shape2.numContacts--;b=this.b1Link.prev;f=this.b1Link.next;null!==b&&(b.next=f);null!==f&&(f.prev=b);this.body1.contactLink==
this.b1Link&&(this.body1.contactLink=f);this.b1Link.prev=null;this.b1Link.next=null;this.b1Link.shape=null;this.b1Link.body=null;this.body1.numContacts--;b=this.b2Link.prev;f=this.b2Link.next;null!==b&&(b.next=f);null!==f&&(f.prev=b);this.body2.contactLink==this.b2Link&&(this.body2.contactLink=f);this.b2Link.prev=null;this.b2Link.next=null;this.b2Link.shape=null;this.b2Link.body=null;this.body2.numContacts--;this.manifold.body1=null;this.manifold.body2=null;this.constraint.body1=null;this.constraint.body2=
null;this.constraint.detach();this.body2=this.body1=this.shape2=this.shape1=null}};OIMO.ContactConstraint=function(b){OIMO.Constraint.call(this);this.manifold=b;this.friction=this.restitution=NaN;this.ii2=this.ii1=this.i2=this.i1=this.av2=this.av1=this.lv2=this.lv1=this.p2=this.p1=null;this.m2=this.m1=NaN;this.num=0;this.ps=b.points;this.cs=new OIMO.ContactPointDataBuffer;this.cs.next=new OIMO.ContactPointDataBuffer;this.cs.next.next=new OIMO.ContactPointDataBuffer;this.cs.next.next.next=new OIMO.ContactPointDataBuffer};
OIMO.ContactConstraint.prototype=Object.create(OIMO.Constraint.prototype);OIMO.ContactConstraint.prototype.attach=function(){this.p1=this.body1.position;this.p2=this.body2.position;this.lv1=this.body1.linearVelocity;this.av1=this.body1.angularVelocity;this.lv2=this.body2.linearVelocity;this.av2=this.body2.angularVelocity;this.i1=this.body1.inverseInertia;this.i2=this.body2.inverseInertia};
OIMO.ContactConstraint.prototype.detach=function(){this.i2=this.i1=this.av2=this.av1=this.lv2=this.lv1=this.p2=this.p1=null};
OIMO.ContactConstraint.prototype.preSolve=function(b,f){this.m1=this.body1.inverseMass;this.m2=this.body2.inverseMass;this.ii1=this.i1.clone();this.ii2=this.i2.clone();var e=this.ii1.elements,c=this.ii2.elements,d=this.p1.x,g=this.p1.y,m=this.p1.z,j=this.p2.x,l=this.p2.y,n=this.p2.z,q=this.m1+this.m2;this.num=this.manifold.numPoints;for(var p=this.cs,r=0;r<this.num;r++){var t=this.ps[r],s,u,x,y,z,A;s=t.position.x;u=t.position.y;x=t.position.z;var B=s-d,C=u-g,D=x-m,E=s-j,I=u-l,H=x-n;p.rp1X=B;p.rp1Y=
C;p.rp1Z=D;p.rp2X=E;p.rp2Y=I;p.rp2Z=H;p.norImp=t.normalImpulse;p.tanImp=t.tangentImpulse;p.binImp=t.binormalImpulse;var F=t.normal.x,J=t.normal.y,G=t.normal.z,L=this.lv2.x+this.av2.y*H-this.av2.z*I-(this.lv1.x+this.av1.y*D-this.av1.z*C),N=this.lv2.y+this.av2.z*E-this.av2.x*H-(this.lv1.y+this.av1.z*B-this.av1.x*D),R=this.lv2.z+this.av2.x*I-this.av2.y*E-(this.lv1.z+this.av1.x*C-this.av1.y*B),P=F*L+J*N+G*R,L=L-P*F,K=N-P*J,O=R-P*G,R=L*L+K*K+O*O;0.04<R?R=1/OIMO.sqrt(R):(L=J*F-G*G,K=-G*J-F*F,O=F*G+J*J,
R=1/OIMO.sqrt(L*L+K*K+O*O));var L=L*R,K=K*R,O=O*R,M=J*O-G*K,W=G*L-F*O,Ga=F*K-J*L;p.norX=F;p.norY=J;p.norZ=G;p.tanX=L;p.tanY=K;p.tanZ=O;p.binX=M;p.binY=W;p.binZ=Ga;p.norU1X=F*this.m1;p.norU1Y=J*this.m1;p.norU1Z=G*this.m1;p.norU2X=F*this.m2;p.norU2Y=J*this.m2;p.norU2Z=G*this.m2;p.tanU1X=L*this.m1;p.tanU1Y=K*this.m1;p.tanU1Z=O*this.m1;p.tanU2X=L*this.m2;p.tanU2Y=K*this.m2;p.tanU2Z=O*this.m2;p.binU1X=M*this.m1;p.binU1Y=W*this.m1;p.binU1Z=Ga*this.m1;p.binU2X=M*this.m2;p.binU2Y=W*this.m2;p.binU2Z=Ga*this.m2;
x=C*G-D*J;y=D*F-B*G;z=B*J-C*F;var qa=I*G-H*J,fa=H*F-E*G,Ba=E*J-I*F,Va=C*O-D*K,Ra=D*L-B*O,Z=B*K-C*L,v=I*O-H*K,U=H*L-E*O,X=E*K-I*L,ba=C*Ga-D*W,da=D*M-B*Ga,ra=B*W-C*M,ga=I*Ga-H*W,xa=H*M-E*Ga,ya=E*W-I*M,R=x*e[0]+y*e[1]+z*e[2],N=x*e[3]+y*e[4]+z*e[5],ma=x*e[6]+y*e[7]+z*e[8],na=qa*c[0]+fa*c[1]+Ba*c[2],aa=qa*c[3]+fa*c[4]+Ba*c[5],ea=qa*c[6]+fa*c[7]+Ba*c[8];s=Va*e[0]+Ra*e[1]+Z*e[2];u=Va*e[3]+Ra*e[4]+Z*e[5];A=Va*e[6]+Ra*e[7]+Z*e[8];var Ha=v*c[0]+U*c[1]+X*c[2],Ca=v*c[3]+U*c[4]+X*c[5],Ia=v*c[6]+U*c[7]+X*c[8],
Ja=ba*e[0]+da*e[1]+ra*e[2],Ma=ba*e[3]+da*e[4]+ra*e[5],Fb=ba*e[6]+da*e[7]+ra*e[8],Wa=ga*c[0]+xa*c[1]+ya*c[2],Ub=ga*c[3]+xa*c[4]+ya*c[5],Kb=ga*c[6]+xa*c[7]+ya*c[8];p.norT1X=x;p.norT1Y=y;p.norT1Z=z;p.tanT1X=Va;p.tanT1Y=Ra;p.tanT1Z=Z;p.binT1X=ba;p.binT1Y=da;p.binT1Z=ra;p.norT2X=qa;p.norT2Y=fa;p.norT2Z=Ba;p.tanT2X=v;p.tanT2Y=U;p.tanT2Z=X;p.binT2X=ga;p.binT2Y=xa;p.binT2Z=ya;p.norTU1X=R;p.norTU1Y=N;p.norTU1Z=ma;p.tanTU1X=s;p.tanTU1Y=u;p.tanTU1Z=A;p.binTU1X=Ja;p.binTU1Y=Ma;p.binTU1Z=Fb;p.norTU2X=na;p.norTU2Y=
aa;p.norTU2Z=ea;p.tanTU2X=Ha;p.tanTU2Y=Ca;p.tanTU2Z=Ia;p.binTU2X=Wa;p.binTU2Y=Ub;p.binTU2Z=Kb;s=x*e[0]+y*e[1]+z*e[2];u=x*e[3]+y*e[4]+z*e[5];x=x*e[6]+y*e[7]+z*e[8];y=u*D-x*C;z=x*B-s*D;A=s*C-u*B;s=qa*c[0]+fa*c[1]+Ba*c[2];u=qa*c[3]+fa*c[4]+Ba*c[5];x=qa*c[6]+fa*c[7]+Ba*c[8];y+=u*H-x*I;z+=x*E-s*H;A+=s*I-u*E;F=1/(q+F*y+J*z+G*A);s=Va*e[0]+Ra*e[1]+Z*e[2];u=Va*e[3]+Ra*e[4]+Z*e[5];x=Va*e[6]+Ra*e[7]+Z*e[8];y=u*D-x*C;z=x*B-s*D;A=s*C-u*B;s=v*c[0]+U*c[1]+X*c[2];u=v*c[3]+U*c[4]+X*c[5];x=v*c[6]+U*c[7]+X*c[8];y+=
u*H-x*I;z+=x*E-s*H;A+=s*I-u*E;J=1/(q+L*y+K*z+O*A);s=ba*e[0]+da*e[1]+ra*e[2];u=ba*e[3]+da*e[4]+ra*e[5];x=ba*e[6]+da*e[7]+ra*e[8];y=u*D-x*C;z=x*B-s*D;A=s*C-u*B;s=ga*c[0]+xa*c[1]+ya*c[2];u=ga*c[3]+xa*c[4]+ya*c[5];x=ga*c[6]+xa*c[7]+ya*c[8];y+=u*H-x*I;z+=x*E-s*H;A+=s*I-u*E;B=1/(q+M*y+W*z+Ga*A);p.norDen=F;p.tanDen=J;p.binDen=B;t.warmStarted?(P=t.normalImpulse,this.lv1.x+=p.norU1X*P,this.lv1.y+=p.norU1Y*P,this.lv1.z+=p.norU1Z*P,this.av1.x+=R*P,this.av1.y+=N*P,this.av1.z+=ma*P,this.lv2.x-=p.norU2X*P,this.lv2.y-=
p.norU2Y*P,this.lv2.z-=p.norU2Z*P,this.av2.x-=na*P,this.av2.y-=aa*P,this.av2.z-=ea*P,p.norImp=P,p.tanImp=0,P=p.binImp=0):(p.norImp=0,p.tanImp=0,p.binImp=0);-1<P&&(P=0);P=this.restitution*-P;t=0.05*-(t.penetration+0.0050)*f;P<t&&(P=t);p.norTar=P;p.last=r==this.num-1;p=p.next}};
OIMO.ContactConstraint.prototype.solve=function(){for(var b=this.lv1.x,f=this.lv1.y,e=this.lv1.z,c=this.lv2.x,d=this.lv2.y,g=this.lv2.z,m=this.av1.x,j=this.av1.y,l=this.av1.z,n=this.av2.x,q=this.av2.y,p=this.av2.z,r=this.cs;;){var t,s,u,x,y=r.norImp,z=r.tanImp,A=r.binImp,B=-y*this.friction;u=c-b;x=d-f;var C=g-e;s=u*r.tanX+x*r.tanY+C*r.tanZ+n*r.tanT2X+q*r.tanT2Y+p*r.tanT2Z-m*r.tanT1X-j*r.tanT1Y-l*r.tanT1Z;t=z;s*=r.tanDen;z+=s;s=u*r.binX+x*r.binY+C*r.binZ+n*r.binT2X+q*r.binT2Y+p*r.binT2Z-m*r.binT1X-
j*r.binT1Y-l*r.binT1Z;u=A;x=s*r.binDen;A+=x;s=z*z+A*A;s>B*B&&(s=B/OIMO.sqrt(s),z*=s,A*=s);s=z-t;x=A-u;b+=r.tanU1X*s+r.binU1X*x;f+=r.tanU1Y*s+r.binU1Y*x;e+=r.tanU1Z*s+r.binU1Z*x;m+=r.tanTU1X*s+r.binTU1X*x;j+=r.tanTU1Y*s+r.binTU1Y*x;l+=r.tanTU1Z*s+r.binTU1Z*x;c-=r.tanU2X*s+r.binU2X*x;d-=r.tanU2Y*s+r.binU2Y*x;g-=r.tanU2Z*s+r.binU2Z*x;n-=r.tanTU2X*s+r.binTU2X*x;q-=r.tanTU2Y*s+r.binTU2Y*x;p-=r.tanTU2Z*s+r.binTU2Z*x;s=(c-b)*r.norX+(d-f)*r.norY+(g-e)*r.norZ+n*r.norT2X+q*r.norT2Y+p*r.norT2Z-m*r.norT1X-j*
r.norT1Y-l*r.norT1Z;t=y;s=(s-r.norTar)*r.norDen;y+=s;0<y&&(y=0);s=y-t;b+=r.norU1X*s;f+=r.norU1Y*s;e+=r.norU1Z*s;m+=r.norTU1X*s;j+=r.norTU1Y*s;l+=r.norTU1Z*s;c-=r.norU2X*s;d-=r.norU2Y*s;g-=r.norU2Z*s;n-=r.norTU2X*s;q-=r.norTU2Y*s;p-=r.norTU2Z*s;r.norImp=y;r.tanImp=z;r.binImp=A;if(r.last)break;r=r.next}this.lv1.x=b;this.lv1.y=f;this.lv1.z=e;this.lv2.x=c;this.lv2.y=d;this.lv2.z=g;this.av1.x=m;this.av1.y=j;this.av1.z=l;this.av2.x=n;this.av2.y=q;this.av2.z=p};
OIMO.ContactConstraint.prototype.postSolve=function(){for(var b=this.cs,f=this.num;f--;){var e=this.ps[f];e.normal.x=b.norX;e.normal.y=b.norY;e.normal.z=b.norZ;e.tangent.x=b.tanX;e.tangent.y=b.tanY;e.tangent.z=b.tanZ;e.binormal.x=b.binX;e.binormal.y=b.binY;e.binormal.z=b.binZ;e.normalImpulse=b.norImp;e.tangentImpulse=b.tanImp;e.binormalImpulse=b.binImp;e.normalDenominator=b.norDen;e.tangentDenominator=b.tanDen;e.binormalDenominator=b.binDen;b=b.next}};
OIMO.ContactLink=function(b){this.body=this.shape=this.next=this.prev=null;this.contact=b};OIMO.ContactManifold=function(){this.body2=this.body1=null;this.numPoints=0;this.points=[];this.points.length=4;this.points[0]=new OIMO.ManifoldPoint;this.points[1]=new OIMO.ManifoldPoint;this.points[2]=new OIMO.ManifoldPoint;this.points[3]=new OIMO.ManifoldPoint};
OIMO.ContactManifold.prototype={constructor:OIMO.ContactManifold,reset:function(b,f){this.body1=b.parent;this.body2=f.parent;this.numPoints=0},addPoint:function(b,f,e,c,d,g,m,j){var l=this.points[this.numPoints++];l.position.x=b;l.position.y=f;l.position.z=e;var n=b-this.body1.position.x,q=f-this.body1.position.y,p=e-this.body1.position.z,r=this.body1.rotation.elements;l.localPoint1.x=n*r[0]+q*r[3]+p*r[6];l.localPoint1.y=n*r[1]+q*r[4]+p*r[7];l.localPoint1.z=n*r[2]+q*r[5]+p*r[8];n=b-this.body2.position.x;
q=f-this.body2.position.y;p=e-this.body2.position.z;l.localPoint2.x=n*r[0]+q*r[3]+p*r[6];l.localPoint2.y=n*r[1]+q*r[4]+p*r[7];l.localPoint2.z=n*r[2]+q*r[5]+p*r[8];l.normalImpulse=0;j?(l.normal.x=-c,l.normal.y=-d,l.normal.z=-g):(l.normal.x=c,l.normal.y=d,l.normal.z=g);l.penetration=m;l.warmStarted=!1}};
OIMO.ContactPointDataBuffer=function(){this.norTar=this.binDen=this.tanDen=this.norDen=this.binImp=this.tanImp=this.norImp=this.binTU2Z=this.binTU2Y=this.binTU2X=this.binTU1Z=this.binTU1Y=this.binTU1X=this.tanTU2Z=this.tanTU2Y=this.tanTU2X=this.tanTU1Z=this.tanTU1Y=this.tanTU1X=this.norTU2Z=this.norTU2Y=this.norTU2X=this.norTU1Z=this.norTU1Y=this.norTU1X=this.binT2Z=this.binT2Y=this.binT2X=this.binT1Z=this.binT1Y=this.binT1X=this.tanT2Z=this.tanT2Y=this.tanT2X=this.tanT1Z=this.tanT1Y=this.tanT1X=
this.norT2Z=this.norT2Y=this.norT2X=this.norT1Z=this.norT1Y=this.norT1X=this.binU2Z=this.binU2Y=this.binU2X=this.binU1Z=this.binU1Y=this.binU1X=this.tanU2Z=this.tanU2Y=this.tanU2X=this.tanU1Z=this.tanU1Y=this.tanU1X=this.norU2Z=this.norU2Y=this.norU2X=this.norU1Z=this.norU1Y=this.norU1X=this.rp2Z=this.rp2Y=this.rp2X=this.rp1Z=this.rp1Y=this.rp1X=this.binZ=this.binY=this.binX=this.tanZ=this.tanY=this.tanX=this.norZ=this.norY=this.norX=NaN;this.next=null;this.last=!1};
OIMO.ImpulseDataBuffer=function(){this.impulse=this.lp2Z=this.lp2Y=this.lp2X=this.lp1Z=this.lp1Y=this.lp1X=NaN};OIMO.ManifoldPoint=function(){this.warmStarted=!1;this.position=new OIMO.Vec3;this.localPoint1=new OIMO.Vec3;this.localPoint2=new OIMO.Vec3;this.normal=new OIMO.Vec3;this.tangent=new OIMO.Vec3;this.binormal=new OIMO.Vec3;this.penetration=this.binormalDenominator=this.tangentDenominator=this.normalDenominator=this.binormalImpulse=this.tangentImpulse=this.normalImpulse=0};
OIMO.MassInfo=function(){this.mass=0;this.inertia=new OIMO.Mat33};
OIMO.Shape=function(b){this.type=OIMO.SHAPE_NULL;this.id=OIMO.nextID++;this.contactLink=this.parent=this.proxy=this.next=this.prev=null;this.numContacts=0;this.position=new OIMO.Vec3;this.rotation=new OIMO.Mat33;this.relativePosition=(new OIMO.Vec3).copy(b.relativePosition);this.relativeRotation=(new OIMO.Mat33).copy(b.relativeRotation);this.aabb=new OIMO.AABB;this.density=b.density;this.friction=b.friction;this.restitution=b.restitution;this.belongsTo=b.belongsTo;this.collidesWith=b.collidesWith};
OIMO.Shape.prototype={constructor:OIMO.Shape,calculateMassInfo:function(){OIMO.Error("Shape","Inheritance error.")},updateProxy:function(){OIMO.Error("Shape","Inheritance error.")}};OIMO.ShapeConfig=function(){this.relativePosition=new OIMO.Vec3;this.relativeRotation=new OIMO.Mat33;this.friction=0.4;this.restitution=0.2;this.belongsTo=this.density=1;this.collidesWith=4294967295};
OIMO.BoxShape=function(b,f,e,c){OIMO.Shape.call(this,b);this.type=OIMO.SHAPE_BOX;this.width=f;this.height=e;this.depth=c;this.halfWidth=0.5*f;this.halfHeight=0.5*e;this.halfDepth=0.5*c;this.dimentions=new OIMO_ARRAY_TYPE(18);this.elements=new OIMO_ARRAY_TYPE(24)};OIMO.BoxShape.prototype=Object.create(OIMO.Shape.prototype);OIMO.BoxShape.prototype.constructor=OIMO.BoxShape;
OIMO.BoxShape.prototype.calculateMassInfo=function(b){var f=this.width*this.height*this.depth*this.density,e=1/12;b.mass=f;b.inertia.set(f*(this.height*this.height+this.depth*this.depth)*e,0,0,0,f*(this.width*this.width+this.depth*this.depth)*e,0,0,0,f*(this.width*this.width+this.height*this.height)*e)};
OIMO.BoxShape.prototype.updateProxy=function(){var b=this.rotation.elements,f=this.dimentions;f[0]=b[0];f[1]=b[3];f[2]=b[6];f[3]=b[1];f[4]=b[4];f[5]=b[7];f[6]=b[2];f[7]=b[5];f[8]=b[8];f[9]=b[0]*this.halfWidth;f[10]=b[3]*this.halfWidth;f[11]=b[6]*this.halfWidth;f[12]=b[1]*this.halfHeight;f[13]=b[4]*this.halfHeight;f[14]=b[7]*this.halfHeight;f[15]=b[2]*this.halfDepth;f[16]=b[5]*this.halfDepth;f[17]=b[8]*this.halfDepth;var b=f[9],e=f[10],c=f[11],d=f[12],g=f[13],m=f[14],j=f[15],l=f[16],n=f[17],q=this.position.x,
p=this.position.y,r=this.position.z,t=this.elements;t[0]=q+b+d+j;t[1]=p+e+g+l;t[2]=r+c+m+n;t[3]=q+b+d-j;t[4]=p+e+g-l;t[5]=r+c+m-n;t[6]=q+b-d+j;t[7]=p+e-g+l;t[8]=r+c-m+n;t[9]=q+b-d-j;t[10]=p+e-g-l;t[11]=r+c-m-n;t[12]=q-b+d+j;t[13]=p-e+g+l;t[14]=r-c+m+n;t[15]=q-b+d-j;t[16]=p-e+g-l;t[17]=r-c+m-n;t[18]=q-b-d+j;t[19]=p-e-g+l;t[20]=r-c-m+n;t[21]=q-b-d-j;t[22]=p-e-g-l;t[23]=r-c-m-n;b=0>f[9]?-f[9]:f[9];e=0>f[10]?-f[10]:f[10];c=0>f[11]?-f[11]:f[11];b=0>f[12]?b-f[12]:b+f[12];e=0>f[13]?e-f[13]:e+f[13];c=0>f[14]?
c-f[14]:c+f[14];b=0>f[15]?b-f[15]:b+f[15];e=0>f[16]?e-f[16]:e+f[16];c=0>f[17]?c-f[17]:c+f[17];f=OIMO.AABB_PROX;this.aabb.set(this.position.x-b-f,this.position.x+b+f,this.position.y-e-f,this.position.y+e+f,this.position.z-c-f,this.position.z+c+f);null!=this.proxy&&this.proxy.update()};OIMO.SphereShape=function(b,f){OIMO.Shape.call(this,b);this.type=OIMO.SHAPE_SPHERE;this.radius=f};OIMO.SphereShape.prototype=Object.create(OIMO.Shape.prototype);OIMO.SphereShape.prototype.constructor=OIMO.SphereShape;
OIMO.SphereShape.prototype.calculateMassInfo=function(b){var f=1.333*OIMO.PI*this.radius*this.radius*this.radius*this.density;b.mass=f;f=0.4*f*this.radius*this.radius;b.inertia.set(f,0,0,0,f,0,0,0,f)};OIMO.SphereShape.prototype.updateProxy=function(){var b=OIMO.AABB_PROX;this.aabb.set(this.position.x-this.radius-b,this.position.x+this.radius+b,this.position.y-this.radius-b,this.position.y+this.radius+b,this.position.z-this.radius-b,this.position.z+this.radius+b);null!=this.proxy&&this.proxy.update()};
OIMO.CylinderShape=function(b,f,e){OIMO.Shape.call(this,b);this.type=OIMO.SHAPE_CYLINDER;this.radius=f;this.height=e;this.halfHeight=0.5*e;this.normalDirection=new OIMO.Vec3;this.halfDirection=new OIMO.Vec3};OIMO.CylinderShape.prototype=Object.create(OIMO.Shape.prototype);OIMO.CylinderShape.prototype.constructor=OIMO.CylinderShape;
OIMO.CylinderShape.prototype.calculateMassInfo=function(b){var f=this.radius*this.radius,e=OIMO.PI*f*this.height*this.density,c=(0.25*f+0.0833*this.height*this.height)*e;b.mass=e;b.inertia.set(c,0,0,0,0.5*f,0,0,0,c)};
OIMO.CylinderShape.prototype.updateProxy=function(){var b=this.rotation.elements,f,e,c,d,g,m;d=b[1]*b[1];g=b[4]*b[4];m=b[7]*b[7];this.normalDirection.set(b[1],b[4],b[7]);this.halfDirection.scale(this.normalDirection,this.halfHeight);b=1-d;f=OIMO.sqrt(b*b+d*g+d*m);0<f&&(f=this.radius/f);b*=f;e=1-g;f=OIMO.sqrt(g*d+e*e+g*m);0<f&&(f=this.radius/f);e*=f;c=1-m;f=OIMO.sqrt(m*d+m*g+c*c);0<f&&(f=this.radius/f);c*=f;d=0>this.halfDirection.x?-this.halfDirection.x:this.halfDirection.x;g=0>this.halfDirection.y?
-this.halfDirection.y:this.halfDirection.y;m=0>this.halfDirection.z?-this.halfDirection.z:this.halfDirection.z;d=0>b?d-b:d+b;g=0>e?g-e:g+e;m=0>c?m-c:m+c;b=OIMO.AABB_PROX;this.aabb.set(this.position.x-d-b,this.position.x+d+b,this.position.y-g-b,this.position.y+g+b,this.position.z-m-b,this.position.z+m+b);null!=this.proxy&&this.proxy.update()};
OIMO.TetraShape=function(b,f,e,c,d){OIMO.Shape.call(this,b);this.type=OIMO.SHAPE_TETRA;this.verts=[f,e,c,d];this.faces=[mtri(0,1,2),mtri(1,2,3),mtri(2,3,4),mtri(4,0,1)]};OIMO.TetraShape.prototype=Object.create(OIMO.Shape.prototype);OIMO.TetraShape.prototype.constructor=OIMO.TetraShape;OIMO.TetraShape.prototype.calculateMassInfo=function(){};OIMO.TetraShape.prototype.updateProxy=function(){this.aabb.setFromPoints(this.verts);null!==this.proxy&&this.proxy.update()};
function mtri(b,f,e){return{a:b,b:f,c:e}}OIMO.CollisionDetector=function(){this.flip=!1};OIMO.CollisionDetector.prototype={constructor:OIMO.CollisionDetector,detectCollision:function(){OIMO.Error("CollisionDetector","Inheritance error.")}};OIMO.BoxBoxCollisionDetector=function(){OIMO.CollisionDetector.call(this);this.clipVertices1=new OIMO_ARRAY_TYPE(24);this.clipVertices2=new OIMO_ARRAY_TYPE(24);this.used=new OIMO_ARRAY_TYPE(8);this.INF=1/0};OIMO.BoxBoxCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype);
OIMO.BoxBoxCollisionDetector.prototype.constructor=OIMO.BoxBoxCollisionDetector;
OIMO.BoxBoxCollisionDetector.prototype.detectCollision=function(b,f,e){var c,d;b.id<f.id?(c=b,d=f):(c=f,d=b);var g=c.elements,m=d.elements,j=c.dimentions,l=d.dimentions,n=c.position,q=d.position,p=n.x,r=n.y,t=n.z,s=q.x,u=q.y,x=q.z,y=s-p,z=u-r,A=x-t,B=c.halfWidth,C=c.halfHeight,D=c.halfDepth,E=d.halfWidth,I=d.halfHeight,H=d.halfDepth,F=j[0],J=j[1],G=j[2],L=j[3],N=j[4],R=j[5],P=j[6],K=j[7],O=j[8],M=j[9],W=j[10],Ga=j[11],qa=j[12],fa=j[13],Ba=j[14],Va=j[15],Ra=j[16],Z=j[17],v=l[0],U=l[1],X=l[2],ba=l[3],
da=l[4],ra=l[5],ga=l[6],xa=l[7],ya=l[8],ma=l[9],na=l[10],aa=l[11],ea=l[12],Ha=l[13],Ca=l[14],Ia=l[15],Ja=l[16],Ma=l[17],Fb=J*X-G*U,Wa=G*v-F*X,Ub=F*U-J*v,Kb=J*ra-G*da,Lb=G*ba-F*ra,cc=F*da-J*ba,ob=J*ya-G*xa,Ob=G*ga-F*ya,dc=F*xa-J*ga,Xa=N*X-R*U,Ta=R*v-L*X,$a=L*U-N*v,ca=N*ra-R*da,kb=R*ba-L*ra,rb=L*da-N*ba,wa=N*ya-R*xa,ha=R*ga-L*ya,va=L*xa-N*ga,pb=K*X-O*U,sb=O*v-P*X,xb=P*U-K*v,yb=K*ra-O*da,Vb=O*ba-P*ra,Wb=P*da-K*ba,Pb=K*ya-O*xa,Qb=O*ga-P*ya,Mb=P*xa-K*ga,wc,ab,bb,cb,sa,zb,Ab,ta,Aa,Ka,gb,Da,Rb,Xb,Yb,Nb,
Sb,Tb,tb,Bb,nc,gc,Qa,bc,ac,ic,fc,hc,Zb,ec,yc=!1,hb=!1,Y=!1,xc=!1,vc=!1,Oc=!1,$c=!1,ad=!1,Mc=!1,T,eb,Oa,Q,S,db;T=F*y+J*z+G*A;(wc=0<T)||(T=-T);eb=B;Q=F*v+J*U+G*X;S=F*ba+J*da+G*ra;db=F*ga+J*xa+G*ya;0>Q&&(Q=-Q);0>S&&(S=-S);0>db&&(db=-db);Oa=Q*E+S*I+db*H;Nb=T-eb-Oa;if(!(0<Nb)&&(T=L*y+N*z+R*A,(ab=0<T)||(T=-T),eb=C,Q=L*v+N*U+R*X,S=L*ba+N*da+R*ra,db=L*ga+N*xa+R*ya,0>Q&&(Q=-Q),0>S&&(S=-S),0>db&&(db=-db),Oa=Q*E+S*I+db*H,Sb=T-eb-Oa,!(0<Sb)&&(T=P*y+K*z+O*A,(bb=0<T)||(T=-T),eb=D,Q=P*v+K*U+O*X,S=P*ba+K*da+O*ra,
db=P*ga+K*xa+O*ya,0>Q&&(Q=-Q),0>S&&(S=-S),0>db&&(db=-db),Oa=Q*E+S*I+db*H,Tb=T-eb-Oa,!(0<Tb)&&(T=v*y+U*z+X*A,(cb=0<T)||(T=-T),Q=v*F+U*J+X*G,S=v*L+U*N+X*R,db=v*P+U*K+X*O,0>Q&&(Q=-Q),0>S&&(S=-S),0>db&&(db=-db),eb=Q*B+S*C+db*D,Oa=E,tb=1*(T-eb-Oa),!(0<tb)&&(T=ba*y+da*z+ra*A,(sa=0<T)||(T=-T),Q=ba*F+da*J+ra*G,S=ba*L+da*N+ra*R,db=ba*P+da*K+ra*O,0>Q&&(Q=-Q),0>S&&(S=-S),0>db&&(db=-db),eb=Q*B+S*C+db*D,Oa=I,Bb=1*(T-eb-Oa),!(0<Bb)&&(T=ga*y+xa*z+ya*A,(zb=0<T)||(T=-T),Q=ga*F+xa*J+ya*G,S=ga*L+xa*N+ya*R,db=ga*P+xa*
K+ya*O,0>Q&&(Q=-Q),0>S&&(S=-S),0>db&&(db=-db),eb=Q*B+S*C+db*D,Oa=H,nc=1*(T-eb-Oa),!(0<nc))))))){T=Fb*Fb+Wa*Wa+Ub*Ub;if(1E-5<T){if(T=1/OIMO.sqrt(T),Fb*=T,Wa*=T,Ub*=T,T=Fb*y+Wa*z+Ub*A,(Ab=0<T)||(T=-T),Q=Fb*L+Wa*N+Ub*R,S=Fb*P+Wa*K+Ub*O,0>Q&&(Q=-Q),0>S&&(S=-S),eb=Q*C+S*D,Q=Fb*ba+Wa*da+Ub*ra,S=Fb*ga+Wa*xa+Ub*ya,0>Q&&(Q=-Q),0>S&&(S=-S),Oa=Q*I+S*H,gc=T-eb-Oa,0<gc)return}else Ab=!1,gc=0,yc=!0;T=Kb*Kb+Lb*Lb+cc*cc;if(1E-5<T){if(T=1/OIMO.sqrt(T),Kb*=T,Lb*=T,cc*=T,T=Kb*y+Lb*z+cc*A,(ta=0<T)||(T=-T),Q=Kb*L+Lb*
N+cc*R,S=Kb*P+Lb*K+cc*O,0>Q&&(Q=-Q),0>S&&(S=-S),eb=Q*C+S*D,Q=Kb*v+Lb*U+cc*X,S=Kb*ga+Lb*xa+cc*ya,0>Q&&(Q=-Q),0>S&&(S=-S),Oa=Q*E+S*H,Qa=T-eb-Oa,0<Qa)return}else ta=!1,Qa=0,hb=!0;T=ob*ob+Ob*Ob+dc*dc;if(1E-5<T){if(T=1/OIMO.sqrt(T),ob*=T,Ob*=T,dc*=T,T=ob*y+Ob*z+dc*A,(Aa=0<T)||(T=-T),Q=ob*L+Ob*N+dc*R,S=ob*P+Ob*K+dc*O,0>Q&&(Q=-Q),0>S&&(S=-S),eb=Q*C+S*D,Q=ob*v+Ob*U+dc*X,S=ob*ba+Ob*da+dc*ra,0>Q&&(Q=-Q),0>S&&(S=-S),Oa=Q*E+S*I,bc=T-eb-Oa,0<bc)return}else Aa=!1,bc=0,Y=!0;T=Xa*Xa+Ta*Ta+$a*$a;if(1E-5<T){if(T=1/
OIMO.sqrt(T),Xa*=T,Ta*=T,$a*=T,T=Xa*y+Ta*z+$a*A,(Ka=0<T)||(T=-T),Q=Xa*F+Ta*J+$a*G,S=Xa*P+Ta*K+$a*O,0>Q&&(Q=-Q),0>S&&(S=-S),eb=Q*B+S*D,Q=Xa*ba+Ta*da+$a*ra,S=Xa*ga+Ta*xa+$a*ya,0>Q&&(Q=-Q),0>S&&(S=-S),Oa=Q*I+S*H,ac=T-eb-Oa,0<ac)return}else Ka=!1,ac=0,xc=!0;T=ca*ca+kb*kb+rb*rb;if(1E-5<T){if(T=1/OIMO.sqrt(T),ca*=T,kb*=T,rb*=T,T=ca*y+kb*z+rb*A,(gb=0<T)||(T=-T),Q=ca*F+kb*J+rb*G,S=ca*P+kb*K+rb*O,0>Q&&(Q=-Q),0>S&&(S=-S),eb=Q*B+S*D,Q=ca*v+kb*U+rb*X,S=ca*ga+kb*xa+rb*ya,0>Q&&(Q=-Q),0>S&&(S=-S),Oa=Q*E+S*H,ic=
T-eb-Oa,0<ic)return}else gb=!1,ic=0,vc=!0;T=wa*wa+ha*ha+va*va;if(1E-5<T){if(T=1/OIMO.sqrt(T),wa*=T,ha*=T,va*=T,T=wa*y+ha*z+va*A,(Da=0<T)||(T=-T),Q=wa*F+ha*J+va*G,S=wa*P+ha*K+va*O,0>Q&&(Q=-Q),0>S&&(S=-S),eb=Q*B+S*D,Q=wa*v+ha*U+va*X,S=wa*ba+ha*da+va*ra,0>Q&&(Q=-Q),0>S&&(S=-S),Oa=Q*E+S*I,fc=T-eb-Oa,0<fc)return}else Da=!1,fc=0,Oc=!0;T=pb*pb+sb*sb+xb*xb;if(1E-5<T){if(T=1/OIMO.sqrt(T),pb*=T,sb*=T,xb*=T,T=pb*y+sb*z+xb*A,(Rb=0<T)||(T=-T),Q=pb*F+sb*J+xb*G,S=pb*L+sb*N+xb*R,0>Q&&(Q=-Q),0>S&&(S=-S),eb=Q*B+S*
C,Q=pb*ba+sb*da+xb*ra,S=pb*ga+sb*xa+xb*ya,0>Q&&(Q=-Q),0>S&&(S=-S),Oa=Q*I+S*H,hc=T-eb-Oa,0<hc)return}else Rb=!1,hc=0,$c=!0;T=yb*yb+Vb*Vb+Wb*Wb;if(1E-5<T){if(T=1/OIMO.sqrt(T),yb*=T,Vb*=T,Wb*=T,T=yb*y+Vb*z+Wb*A,(Xb=0<T)||(T=-T),Q=yb*F+Vb*J+Wb*G,S=yb*L+Vb*N+Wb*R,0>Q&&(Q=-Q),0>S&&(S=-S),eb=Q*B+S*C,Q=yb*v+Vb*U+Wb*X,S=yb*ga+Vb*xa+Wb*ya,0>Q&&(Q=-Q),0>S&&(S=-S),Oa=Q*E+S*H,Zb=T-eb-Oa,0<Zb)return}else Xb=!1,Zb=0,ad=!0;T=Pb*Pb+Qb*Qb+Mb*Mb;if(1E-5<T){if(T=1/OIMO.sqrt(T),Pb*=T,Qb*=T,Mb*=T,T=Pb*y+Qb*z+Mb*A,(Yb=
0<T)||(T=-T),Q=Pb*F+Qb*J+Mb*G,S=Pb*L+Qb*N+Mb*R,0>Q&&(Q=-Q),0>S&&(S=-S),eb=Q*B+S*C,Q=Pb*v+Qb*U+Mb*X,S=Pb*ba+Qb*da+Mb*ra,0>Q&&(Q=-Q),0>S&&(S=-S),Oa=Q*E+S*I,ec=T-eb-Oa,0<ec)return}else Yb=!1,ec=0,Mc=!0;var $b=Nb,lb=Nb,Ya=0,Hb=wc;Sb>lb&&(lb=$b=Sb,Ya=1,Hb=ab);Tb>lb&&(lb=$b=Tb,Ya=2,Hb=bb);tb>lb&&(lb=$b=tb,Ya=3,Hb=cb);Bb>lb&&(lb=$b=Bb,Ya=4,Hb=sa);nc>lb&&(lb=$b=nc,Ya=5,Hb=zb);gc-0.01>lb&&!yc&&($b=gc,lb=gc-0.01,Ya=6,Hb=Ab);Qa-0.01>lb&&!hb&&($b=Qa,lb=Qa-0.01,Ya=7,Hb=ta);bc-0.01>lb&&!Y&&($b=bc,lb=bc-0.01,Ya=
8,Hb=Aa);ac-0.01>lb&&!xc&&($b=ac,lb=ac-0.01,Ya=9,Hb=Ka);ic-0.01>lb&&!vc&&($b=ic,lb=ic-0.01,Ya=10,Hb=gb);fc-0.01>lb&&!Oc&&($b=fc,lb=fc-0.01,Ya=11,Hb=Da);hc-0.01>lb&&!$c&&($b=hc,lb=hc-0.01,Ya=12,Hb=Rb);Zb-0.01>lb&&!ad&&($b=Zb,lb=Zb-0.01,Ya=13,Hb=Xb);ec-0.01>lb&&!Mc&&($b=ec,Ya=14,Hb=Yb);var ia=0,ja=0,ka=0,Gb=0,vb=0,Ib=0,Jb=0,ib=0,ub=0,Za=0,Cb=0,Db=0,Fc=0,Cc=0,Gc=0,Kc=0,Dc=0,Hc=0,Qc=!1;0==Ya?(Hb?(Za=p+M,Cb=r+W,Db=t+Ga,ia=F,ja=J,ka=G):(Za=p-M,Cb=r-W,Db=t-Ga,ia=-F,ja=-J,ka=-G),Fc=qa,Cc=fa,Gc=Ba,Gb=-L,vb=
-N,Ib=-R,Kc=Va,Dc=Ra,Hc=Z,Jb=-P,ib=-K,ub=-O):1==Ya?(Hb?(Za=p+qa,Cb=r+fa,Db=t+Ba,ia=L,ja=N,ka=R):(Za=p-qa,Cb=r-fa,Db=t-Ba,ia=-L,ja=-N,ka=-R),Fc=M,Cc=W,Gc=Ga,Gb=-F,vb=-J,Ib=-G,Kc=Va,Dc=Ra,Hc=Z,Jb=-P,ib=-K,ub=-O):2==Ya?(Hb?(Za=p+Va,Cb=r+Ra,Db=t+Z,ia=P,ja=K,ka=O):(Za=p-Va,Cb=r-Ra,Db=t-Z,ia=-P,ja=-K,ka=-O),Fc=M,Cc=W,Gc=Ga,Gb=-F,vb=-J,Ib=-G,Kc=qa,Dc=fa,Hc=Ba,Jb=-L,ib=-N,ub=-R):3==Ya?(Qc=!0,Hb?(Za=s-ma,Cb=u-na,Db=x-aa,ia=-v,ja=-U,ka=-X):(Za=s+ma,Cb=u+na,Db=x+aa,ia=v,ja=U,ka=X),Fc=ea,Cc=Ha,Gc=Ca,Gb=-ba,vb=
-da,Ib=-ra,Kc=Ia,Dc=Ja,Hc=Ma,Jb=-ga,ib=-xa,ub=-ya):4==Ya?(Qc=!0,Hb?(Za=s-ea,Cb=u-Ha,Db=x-Ca,ia=-ba,ja=-da,ka=-ra):(Za=s+ea,Cb=u+Ha,Db=x+Ca,ia=ba,ja=da,ka=ra),Fc=ma,Cc=na,Gc=aa,Gb=-v,vb=-U,Ib=-X,Kc=Ia,Dc=Ja,Hc=Ma,Jb=-ga,ib=-xa,ub=-ya):5==Ya?(Qc=!0,Hb?(Za=s-Ia,Cb=u-Ja,Db=x-Ma,ia=-ga,ja=-xa,ka=-ya):(Za=s+Ia,Cb=u+Ja,Db=x+Ma,ia=ga,ja=xa,ka=ya),Fc=ma,Cc=na,Gc=aa,Gb=-v,vb=-U,Ib=-X,Kc=ea,Dc=Ha,Hc=Ca,Jb=-ba,ib=-da,ub=-ra):6==Ya?(ia=Fb,ja=Wa,ka=Ub,Gb=F,vb=J,Ib=G,Jb=v,ib=U,ub=X):7==Ya?(ia=Kb,ja=Lb,ka=cc,Gb=
F,vb=J,Ib=G,Jb=ba,ib=da,ub=ra):8==Ya?(ia=ob,ja=Ob,ka=dc,Gb=F,vb=J,Ib=G,Jb=ga,ib=xa,ub=ya):9==Ya?(ia=Xa,ja=Ta,ka=$a,Gb=L,vb=N,Ib=R,Jb=v,ib=U,ub=X):10==Ya?(ia=ca,ja=kb,ka=rb,Gb=L,vb=N,Ib=R,Jb=ba,ib=da,ub=ra):11==Ya?(ia=wa,ja=ha,ka=va,Gb=L,vb=N,Ib=R,Jb=ga,ib=xa,ub=ya):12==Ya?(ia=pb,ja=sb,ka=xb,Gb=P,vb=K,Ib=O,Jb=v,ib=U,ub=X):13==Ya?(ia=yb,ja=Vb,ka=Wb,Gb=P,vb=K,Ib=O,Jb=ba,ib=da,ub=ra):14==Ya&&(ia=Pb,ja=Qb,ka=Mb,Gb=P,vb=K,Ib=O,Jb=ga,ib=xa,ub=ya);if(5<Ya){Hb||(ia=-ia,ja=-ja,ka=-ka);var Na,Pa,Ea,Fa,La,Ec,
Ac,zc,Ic,Bc,Jc;Ec=g[0];Ac=g[1];zc=g[2];Pa=ia*Ec+ja*Ac+ka*zc;Ea=g[3];Fa=g[4];La=g[5];Na=ia*Ea+ja*Fa+ka*La;Na>Pa&&(Pa=Na,Ec=Ea,Ac=Fa,zc=La);Ea=g[6];Fa=g[7];La=g[8];Na=ia*Ea+ja*Fa+ka*La;Na>Pa&&(Pa=Na,Ec=Ea,Ac=Fa,zc=La);Ea=g[9];Fa=g[10];La=g[11];Na=ia*Ea+ja*Fa+ka*La;Na>Pa&&(Pa=Na,Ec=Ea,Ac=Fa,zc=La);Ea=g[12];Fa=g[13];La=g[14];Na=ia*Ea+ja*Fa+ka*La;Na>Pa&&(Pa=Na,Ec=Ea,Ac=Fa,zc=La);Ea=g[15];Fa=g[16];La=g[17];Na=ia*Ea+ja*Fa+ka*La;Na>Pa&&(Pa=Na,Ec=Ea,Ac=Fa,zc=La);Ea=g[18];Fa=g[19];La=g[20];Na=ia*Ea+ja*Fa+ka*
La;Na>Pa&&(Pa=Na,Ec=Ea,Ac=Fa,zc=La);Ea=g[21];Fa=g[22];La=g[23];Na=ia*Ea+ja*Fa+ka*La;Na>Pa&&(Pa=Na,Ec=Ea,Ac=Fa,zc=La);Ic=m[0];Bc=m[1];Jc=m[2];Pa=ia*Ic+ja*Bc+ka*Jc;Ea=m[3];Fa=m[4];La=m[5];Na=ia*Ea+ja*Fa+ka*La;Na<Pa&&(Pa=Na,Ic=Ea,Bc=Fa,Jc=La);Ea=m[6];Fa=m[7];La=m[8];Na=ia*Ea+ja*Fa+ka*La;Na<Pa&&(Pa=Na,Ic=Ea,Bc=Fa,Jc=La);Ea=m[9];Fa=m[10];La=m[11];Na=ia*Ea+ja*Fa+ka*La;Na<Pa&&(Pa=Na,Ic=Ea,Bc=Fa,Jc=La);Ea=m[12];Fa=m[13];La=m[14];Na=ia*Ea+ja*Fa+ka*La;Na<Pa&&(Pa=Na,Ic=Ea,Bc=Fa,Jc=La);Ea=m[15];Fa=m[16];La=m[17];
Na=ia*Ea+ja*Fa+ka*La;Na<Pa&&(Pa=Na,Ic=Ea,Bc=Fa,Jc=La);Ea=m[18];Fa=m[19];La=m[20];Na=ia*Ea+ja*Fa+ka*La;Na<Pa&&(Pa=Na,Ic=Ea,Bc=Fa,Jc=La);Ea=m[21];Fa=m[22];La=m[23];Na=ia*Ea+ja*Fa+ka*La;Na<Pa&&(Pa=Na,Ic=Ea,Bc=Fa,Jc=La);Ea=Ic-Ec;Fa=Bc-Ac;La=Jc-zc;Q=Gb*Jb+vb*ib+Ib*ub;var Sa=(Ea*(Gb-Jb*Q)+Fa*(vb-ib*Q)+La*(Ib-ub*Q))/(1-Q*Q);e.addPoint(Ec+Gb*Sa+0.5*ia*$b,Ac+vb*Sa+0.5*ja*$b,zc+Ib*Sa+0.5*ka*$b,ia,ja,ka,$b,!1)}else{var jc,kc,oc,pc,qc,rc,lc,mc,sc,tc,uc,wb,fb=1,la=0,qb=0;Qc?(la=F*ia+J*ja+G*ka,la<fb&&(fb=la,qb=
0),-la<fb&&(fb=-la,qb=1),la=L*ia+N*ja+R*ka,la<fb&&(fb=la,qb=2),-la<fb&&(fb=-la,qb=3),la=P*ia+K*ja+O*ka,la<fb&&(fb=la,qb=4),-la<fb&&(fb=-la,qb=5),0==qb?(jc=g[0],kc=g[1],oc=g[2],pc=g[6],qc=g[7],rc=g[8],lc=g[9],mc=g[10],sc=g[11],tc=g[3],uc=g[4],wb=g[5]):1==qb?(jc=g[15],kc=g[16],oc=g[17],pc=g[21],qc=g[22],rc=g[23],lc=g[18],mc=g[19],sc=g[20],tc=g[12],uc=g[13],wb=g[14]):2==qb?(jc=g[12],kc=g[13],oc=g[14],pc=g[0],qc=g[1],rc=g[2],lc=g[3],mc=g[4],sc=g[5],tc=g[15],uc=g[16],wb=g[17]):3==qb?(jc=g[21],kc=g[22],
oc=g[23],pc=g[9],qc=g[10],rc=g[11],lc=g[6],mc=g[7],sc=g[8],tc=g[18],uc=g[19],wb=g[20]):4==qb?(jc=g[12],kc=g[13],oc=g[14],pc=g[18],qc=g[19],rc=g[20],lc=g[6],mc=g[7],sc=g[8],tc=g[0],uc=g[1],wb=g[2]):5==qb&&(jc=g[3],kc=g[4],oc=g[5],pc=g[6],qc=g[7],rc=g[8],lc=g[21],mc=g[22],sc=g[23],tc=g[15],uc=g[16],wb=g[17])):(la=v*ia+U*ja+X*ka,la<fb&&(fb=la,qb=0),-la<fb&&(fb=-la,qb=1),la=ba*ia+da*ja+ra*ka,la<fb&&(fb=la,qb=2),-la<fb&&(fb=-la,qb=3),la=ga*ia+xa*ja+ya*ka,la<fb&&(fb=la,qb=4),-la<fb&&(fb=-la,qb=5),0==qb?
(jc=m[0],kc=m[1],oc=m[2],pc=m[6],qc=m[7],rc=m[8],lc=m[9],mc=m[10],sc=m[11],tc=m[3],uc=m[4],wb=m[5]):1==qb?(jc=m[15],kc=m[16],oc=m[17],pc=m[21],qc=m[22],rc=m[23],lc=m[18],mc=m[19],sc=m[20],tc=m[12],uc=m[13],wb=m[14]):2==qb?(jc=m[12],kc=m[13],oc=m[14],pc=m[0],qc=m[1],rc=m[2],lc=m[3],mc=m[4],sc=m[5],tc=m[15],uc=m[16],wb=m[17]):3==qb?(jc=m[21],kc=m[22],oc=m[23],pc=m[9],qc=m[10],rc=m[11],lc=m[6],mc=m[7],sc=m[8],tc=m[18],uc=m[19],wb=m[20]):4==qb?(jc=m[12],kc=m[13],oc=m[14],pc=m[18],qc=m[19],rc=m[20],lc=
m[6],mc=m[7],sc=m[8],tc=m[0],uc=m[1],wb=m[2]):5==qb&&(jc=m[3],kc=m[4],oc=m[5],pc=m[9],qc=m[10],rc=m[11],lc=m[21],mc=m[22],sc=m[23],tc=m[15],uc=m[16],wb=m[17]));var Eb,pa,V,oa,ua,za,mb,nb,jb;this.clipVertices1[0]=jc;this.clipVertices1[1]=kc;this.clipVertices1[2]=oc;this.clipVertices1[3]=pc;this.clipVertices1[4]=qc;this.clipVertices1[5]=rc;this.clipVertices1[6]=lc;this.clipVertices1[7]=mc;this.clipVertices1[8]=sc;this.clipVertices1[9]=tc;this.clipVertices1[10]=uc;this.clipVertices1[11]=wb;pa=0;oa=this.clipVertices1[9];
ua=this.clipVertices1[10];za=this.clipVertices1[11];Q=(oa-Za-Fc)*Gb+(ua-Cb-Cc)*vb+(za-Db-Gc)*Ib;for(var Ua=0;4>Ua;Ua++)V=3*Ua,mb=this.clipVertices1[V],nb=this.clipVertices1[V+1],jb=this.clipVertices1[V+2],S=(mb-Za-Fc)*Gb+(nb-Cb-Cc)*vb+(jb-Db-Gc)*Ib,0<Q?0<S?(V=3*pa,pa++,this.clipVertices2[V]=mb,this.clipVertices2[V+1]=nb,this.clipVertices2[V+2]=jb):(V=3*pa,pa++,Sa=Q/(Q-S),this.clipVertices2[V]=oa+(mb-oa)*Sa,this.clipVertices2[V+1]=ua+(nb-ua)*Sa,this.clipVertices2[V+2]=za+(jb-za)*Sa):0<S&&(V=3*pa,pa++,
Sa=Q/(Q-S),this.clipVertices2[V]=oa+(mb-oa)*Sa,this.clipVertices2[V+1]=ua+(nb-ua)*Sa,this.clipVertices2[V+2]=za+(jb-za)*Sa,V=3*pa,pa++,this.clipVertices2[V]=mb,this.clipVertices2[V+1]=nb,this.clipVertices2[V+2]=jb),oa=mb,ua=nb,za=jb,Q=S;Eb=pa;if(0!=Eb){pa=0;V=3*(Eb-1);oa=this.clipVertices2[V];ua=this.clipVertices2[V+1];za=this.clipVertices2[V+2];Q=(oa-Za-Kc)*Jb+(ua-Cb-Dc)*ib+(za-Db-Hc)*ub;for(Ua=0;Ua<Eb;Ua++)V=3*Ua,mb=this.clipVertices2[V],nb=this.clipVertices2[V+1],jb=this.clipVertices2[V+2],S=(mb-
Za-Kc)*Jb+(nb-Cb-Dc)*ib+(jb-Db-Hc)*ub,0<Q?0<S?(V=3*pa,pa++,this.clipVertices1[V]=mb,this.clipVertices1[V+1]=nb,this.clipVertices1[V+2]=jb):(V=3*pa,pa++,Sa=Q/(Q-S),this.clipVertices1[V]=oa+(mb-oa)*Sa,this.clipVertices1[V+1]=ua+(nb-ua)*Sa,this.clipVertices1[V+2]=za+(jb-za)*Sa):0<S&&(V=3*pa,pa++,Sa=Q/(Q-S),this.clipVertices1[V]=oa+(mb-oa)*Sa,this.clipVertices1[V+1]=ua+(nb-ua)*Sa,this.clipVertices1[V+2]=za+(jb-za)*Sa,V=3*pa,pa++,this.clipVertices1[V]=mb,this.clipVertices1[V+1]=nb,this.clipVertices1[V+
2]=jb),oa=mb,ua=nb,za=jb,Q=S;Eb=pa;if(0!=Eb){pa=0;V=3*(Eb-1);oa=this.clipVertices1[V];ua=this.clipVertices1[V+1];za=this.clipVertices1[V+2];Q=(oa-Za+Fc)*-Gb+(ua-Cb+Cc)*-vb+(za-Db+Gc)*-Ib;for(Ua=0;Ua<Eb;Ua++)V=3*Ua,mb=this.clipVertices1[V],nb=this.clipVertices1[V+1],jb=this.clipVertices1[V+2],S=(mb-Za+Fc)*-Gb+(nb-Cb+Cc)*-vb+(jb-Db+Gc)*-Ib,0<Q?0<S?(V=3*pa,pa++,this.clipVertices2[V]=mb,this.clipVertices2[V+1]=nb,this.clipVertices2[V+2]=jb):(V=3*pa,pa++,Sa=Q/(Q-S),this.clipVertices2[V]=oa+(mb-oa)*Sa,
this.clipVertices2[V+1]=ua+(nb-ua)*Sa,this.clipVertices2[V+2]=za+(jb-za)*Sa):0<S&&(V=3*pa,pa++,Sa=Q/(Q-S),this.clipVertices2[V]=oa+(mb-oa)*Sa,this.clipVertices2[V+1]=ua+(nb-ua)*Sa,this.clipVertices2[V+2]=za+(jb-za)*Sa,V=3*pa,pa++,this.clipVertices2[V]=mb,this.clipVertices2[V+1]=nb,this.clipVertices2[V+2]=jb),oa=mb,ua=nb,za=jb,Q=S;Eb=pa;if(0!=Eb){pa=0;V=3*(Eb-1);oa=this.clipVertices2[V];ua=this.clipVertices2[V+1];za=this.clipVertices2[V+2];Q=(oa-Za+Kc)*-Jb+(ua-Cb+Dc)*-ib+(za-Db+Hc)*-ub;for(Ua=0;Ua<
Eb;Ua++)V=3*Ua,mb=this.clipVertices2[V],nb=this.clipVertices2[V+1],jb=this.clipVertices2[V+2],S=(mb-Za+Kc)*-Jb+(nb-Cb+Dc)*-ib+(jb-Db+Hc)*-ub,0<Q?0<S?(V=3*pa,pa++,this.clipVertices1[V]=mb,this.clipVertices1[V+1]=nb,this.clipVertices1[V+2]=jb):(V=3*pa,pa++,Sa=Q/(Q-S),this.clipVertices1[V]=oa+(mb-oa)*Sa,this.clipVertices1[V+1]=ua+(nb-ua)*Sa,this.clipVertices1[V+2]=za+(jb-za)*Sa):0<S&&(V=3*pa,pa++,Sa=Q/(Q-S),this.clipVertices1[V]=oa+(mb-oa)*Sa,this.clipVertices1[V+1]=ua+(nb-ua)*Sa,this.clipVertices1[V+
2]=za+(jb-za)*Sa,V=3*pa,pa++,this.clipVertices1[V]=mb,this.clipVertices1[V+1]=nb,this.clipVertices1[V+2]=jb),oa=mb,ua=nb,za=jb,Q=S;Eb=pa;if(Qc){var Tc=c;c=d;d=Tc}if(0!=Eb){var Rc=c!=b;if(4<Eb){oa=0.25*(jc+pc+lc+tc);ua=0.25*(kc+qc+mc+uc);za=0.25*(oc+rc+sc+wb);for(var Gb=jc-oa,vb=kc-ua,Ib=oc-za,Jb=pc-oa,ib=qc-ua,ub=rc-za,Pc=0,bd=0,Uc=0,Lc=0,Nc=-this.INF,fb=this.INF,Ua=0;Ua<Eb;Ua++)this.used[Ua]=!1,V=3*Ua,oa=this.clipVertices1[V],ua=this.clipVertices1[V+1],za=this.clipVertices1[V+2],la=oa*Gb+ua*vb+za*
Ib,la<fb&&(fb=la,Pc=Ua),la>Nc&&(Nc=la,Uc=Ua);this.used[Pc]=!0;this.used[Uc]=!0;Nc=-this.INF;fb=this.INF;for(Ua=0;Ua<Eb;Ua++)this.used[Ua]||(V=3*Ua,oa=this.clipVertices1[V],ua=this.clipVertices1[V+1],za=this.clipVertices1[V+2],la=oa*Jb+ua*ib+za*ub,la<fb&&(fb=la,bd=Ua),la>Nc&&(Nc=la,Lc=Ua));V=3*Pc;oa=this.clipVertices1[V];ua=this.clipVertices1[V+1];za=this.clipVertices1[V+2];la=(oa-Za)*ia+(ua-Cb)*ja+(za-Db)*ka;0>la&&e.addPoint(oa,ua,za,ia,ja,ka,la,Rc);V=3*bd;oa=this.clipVertices1[V];ua=this.clipVertices1[V+
1];za=this.clipVertices1[V+2];la=(oa-Za)*ia+(ua-Cb)*ja+(za-Db)*ka;0>la&&e.addPoint(oa,ua,za,ia,ja,ka,la,Rc);V=3*Uc;oa=this.clipVertices1[V];ua=this.clipVertices1[V+1];za=this.clipVertices1[V+2];la=(oa-Za)*ia+(ua-Cb)*ja+(za-Db)*ka;0>la&&e.addPoint(oa,ua,za,ia,ja,ka,la,Rc);V=3*Lc;oa=this.clipVertices1[V];ua=this.clipVertices1[V+1];za=this.clipVertices1[V+2];la=(oa-Za)*ia+(ua-Cb)*ja+(za-Db)*ka;0>la&&e.addPoint(oa,ua,za,ia,ja,ka,la,Rc)}else for(Ua=0;Ua<Eb;Ua++)V=3*Ua,oa=this.clipVertices1[V],ua=this.clipVertices1[V+
1],za=this.clipVertices1[V+2],la=(oa-Za)*ia+(ua-Cb)*ja+(za-Db)*ka,0>la&&e.addPoint(oa,ua,za,ia,ja,ka,la,Rc)}}}}}}};OIMO.SphereBoxCollisionDetector=function(b){OIMO.CollisionDetector.call(this);this.flip=b};OIMO.SphereBoxCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype);OIMO.SphereBoxCollisionDetector.prototype.constructor=OIMO.SphereBoxCollisionDetector;
OIMO.SphereBoxCollisionDetector.prototype.detectCollision=function(b,f,e){var c,d;this.flip?(c=f,d=b):(c=b,d=f);var g=d.dimentions,m=c.position;b=m.x;f=m.y;var j=m.z,l=d.position,n=l.x,q=l.y,l=l.z;c=c.radius;var p=d.halfWidth,r=d.halfHeight,t=d.halfDepth;d=b-n;var s=f-q,u=j-l,x=g[0]*d+g[1]*s+g[2]*u,y=g[3]*d+g[4]*s+g[5]*u,z=g[6]*d+g[7]*s+g[8]*u;d=0;x>p?x=p:x<-p?x=-p:d=1;y>r?y=r:y<-r?y=-r:d|=2;z>t?z=t:z<-t?z=-t:d|=4;7==d?(d=0>x?p+x:p-x,s=0>y?r+y:r-y,u=0>z?t+z:t-z,d<s?d<u?(m=d-p,0>x?(d=g[0],s=g[1],u=
g[2]):(d=-g[0],s=-g[1],u=-g[2])):(m=u-t,0>z?(d=g[6],s=g[7],u=g[8]):(d=-g[6],s=-g[7],u=-g[8])):s<u?(m=s-r,0>y?(d=g[3],s=g[4],u=g[5]):(d=-g[3],s=-g[4],u=-g[5])):(m=u-t,0>z?(d=g[6],s=g[7],u=g[8]):(d=-g[6],s=-g[7],u=-g[8])),e.addPoint(b+c*d,f+c*s,j+c*u,d,s,u,m-c,this.flip)):(n=n+x*g[0]+y*g[3]+z*g[6],q=q+x*g[1]+y*g[4]+z*g[7],g=l+x*g[2]+y*g[5]+z*g[8],d=n-m.x,s=q-m.y,u=g-m.z,m=d*d+s*s+u*u,0<m&&m<c*c&&(m=OIMO.sqrt(m),g=1/m,d*=g,s*=g,u*=g,e.addPoint(b+c*d,f+c*s,j+c*u,d,s,u,m-c,this.flip)))};
OIMO.SphereSphereCollisionDetector=function(){OIMO.CollisionDetector.call(this)};OIMO.SphereSphereCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype);OIMO.SphereSphereCollisionDetector.prototype.constructor=OIMO.SphereSphereCollisionDetector;
OIMO.SphereSphereCollisionDetector.prototype.detectCollision=function(b,f,e){var c=b.position,d=f.position,g=d.x-c.x,m=d.y-c.y,d=d.z-c.z,j=g*g+m*m+d*d;b=b.radius;f=b+f.radius;if(0<j&&j<f*f){var j=OIMO.sqrt(j),l=1/j,g=g*l,m=m*l,d=d*l;e.addPoint(c.x+g*b,c.y+m*b,c.z+d*b,g,m,d,j-f,!1)}};OIMO.BoxCylinderCollisionDetector=function(b){OIMO.CollisionDetector.call(this);this.flip=b};OIMO.BoxCylinderCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype);
OIMO.BoxCylinderCollisionDetector.prototype.constructor=OIMO.BoxCylinderCollisionDetector;
OIMO.BoxCylinderCollisionDetector.prototype.getSep=function(b,f,e,c,d){var g,m,j,l,n,q,p=new OIMO.Vec3,r,t,s,u,x,y,z=b.position.x,A=b.position.y,B=b.position.z,C=f.position.x,D=f.position.y,E=f.position.z,I=C-z,H=D-A,F=E-B;0==I*I+H*H+F*F&&(H=0.0010);var J=-I;q=-H;l=-F;this.supportPointB(b,-J,-q,-l,p);var G=p.x,L=p.y,N=p.z;this.supportPointC(f,J,q,l,p);var R=p.x,P=p.y,K=p.z,O=R-G,M=P-L,W=K-N;if(0>=O*J+M*q+W*l)return!1;J=M*F-W*H;q=W*I-O*F;l=O*H-M*I;if(0==J*J+q*q+l*l)return e.init(O-I,M-H,W-F),e.normalize(e),
c.init(0.5*(G+R),0.5*(L+P),0.5*(N+K)),!0;this.supportPointB(b,-J,-q,-l,p);var Ga=p.x,qa=p.y,fa=p.z;this.supportPointC(f,J,q,l,p);var Ba=p.x,Va=p.y,Ra=p.z,Z=Ba-Ga,v=Va-qa,U=Ra-fa;if(0>=Z*J+v*q+U*l)return!1;g=O-I;m=M-H;j=W-F;l=Z-I;n=v-H;q=U-F;J=m*q-j*n;q=j*l-g*q;l=g*n-m*l;0<J*I+q*H+l*F&&(g=O,m=M,j=W,O=Z,M=v,W=U,Z=g,v=m,U=j,g=G,m=L,j=N,G=Ga,L=qa,N=fa,Ga=g,qa=m,fa=j,g=R,m=P,j=K,R=Ba,P=Va,K=Ra,Ba=g,Va=m,Ra=j,J=-J,q=-q,l=-l);for(var X=0;;){if(100<++X)return!1;this.supportPointB(b,-J,-q,-l,p);var ba=p.x,
da=p.y,ra=p.z;this.supportPointC(f,J,q,l,p);var ga=p.x,xa=p.y,ya=p.z,ma=ga-ba,na=xa-da,aa=ya-ra;if(0>=ma*J+na*q+aa*l)return!1;if(0>(M*aa-W*na)*I+(W*ma-O*aa)*H+(O*na-M*ma)*F)Z=ma,v=na,U=aa,Ga=ba,qa=da,fa=ra,Ba=ga,Va=xa,Ra=ya,g=O-I,m=M-H,j=W-F,l=ma-I,n=na-H,q=aa-F,J=m*q-j*n,q=j*l-g*q,l=g*n-m*l;else if(0>(na*U-aa*v)*I+(aa*Z-ma*U)*H+(ma*v-na*Z)*F)O=ma,M=na,W=aa,G=ba,L=da,N=ra,R=ga,P=xa,K=ya,g=ma-I,m=na-H,j=aa-F,l=Z-I,n=v-H,q=U-F,J=m*q-j*n,q=j*l-g*q,l=g*n-m*l;else for(var ea=!1;;){g=Z-O;m=v-M;j=U-W;l=
ma-O;n=na-M;q=aa-W;J=m*q-j*n;q=j*l-g*q;l=g*n-m*l;g=1/OIMO.sqrt(J*J+q*q+l*l);J*=g;q*=g;l*=g;0<=J*O+q*M+l*W&&!ea&&(y=(M*U-W*v)*ma+(W*Z-O*U)*na+(O*v-M*Z)*aa,ea=(na*U-aa*v)*I+(aa*Z-ma*U)*H+(ma*v-na*Z)*F,g=(H*W-F*M)*ma+(F*O-I*W)*na+(I*M-H*O)*aa,m=(v*W-U*M)*I+(U*O-Z*W)*H+(Z*M-v*O)*F,r=y+ea+g+m,0>=r&&(y=0,ea=(v*aa-U*na)*J+(U*ma-Z*aa)*q+(Z*na-v*ma)*l,g=(na*U-aa*v)*J+(aa*Z-ma*U)*q+(ma*v-na*Z)*l,m=(M*U-W*v)*J+(W*Z-O*U)*q+(O*v-M*Z)*l,r=ea+g+m),j=1/r,r=(z*y+G*ea+Ga*g+ba*m)*j,t=(A*y+L*ea+qa*g+da*m)*j,s=(B*y+N*
ea+fa*g+ra*m)*j,u=(C*y+R*ea+Ba*g+ga*m)*j,x=(D*y+P*ea+Va*g+xa*m)*j,y=(E*y+K*ea+Ra*g+ya*m)*j,ea=!0);this.supportPointB(b,-J,-q,-l,p);g=p.x;m=p.y;j=p.z;this.supportPointC(f,J,q,l,p);n=p.x;var Ha=p.y,Ca=p.z,Ia=n-g,Ja=Ha-m,Ma=Ca-j,Fb=-(Ia*J+Ja*q+Ma*l);if(0.01>=(Ia-ma)*J+(Ja-na)*q+(Ma-aa)*l||0<=Fb)return ea?(e.init(-J,-q,-l),c.init(0.5*(r+u),0.5*(t+x),0.5*(s+y)),d.x=Fb,!0):!1;0>(Ja*W-Ma*M)*I+(Ma*O-Ia*W)*H+(Ia*M-Ja*O)*F?0>(Ja*U-Ma*v)*I+(Ma*Z-Ia*U)*H+(Ia*v-Ja*Z)*F?(O=Ia,M=Ja,W=Ma,G=g,L=m,N=j,R=n,P=Ha,K=Ca):
(ma=Ia,na=Ja,aa=Ma,ba=g,da=m,ra=j,ga=n,xa=Ha,ya=Ca):0>(Ja*aa-Ma*na)*I+(Ma*ma-Ia*aa)*H+(Ia*na-Ja*ma)*F?(Z=Ia,v=Ja,U=Ma,Ga=g,qa=m,fa=j,Ba=n,Va=Ha,Ra=Ca):(O=Ia,M=Ja,W=Ma,G=g,L=m,N=j,R=n,P=Ha,K=Ca)}}};
OIMO.BoxCylinderCollisionDetector.prototype.supportPointB=function(b,f,e,c,d){var g=b.rotation.elements,m=g[0]*f+g[3]*e+g[6]*c,j=g[1]*f+g[4]*e+g[7]*c;f=g[2]*f+g[5]*e+g[8]*c;c=b.halfWidth;var l=b.halfHeight;e=b.halfDepth;c=0>m?-c:c;l=0>j?-l:l;f=0>f?-e:e;m=g[0]*c+g[1]*l+g[2]*f+b.position.x;j=g[3]*c+g[4]*l+g[5]*f+b.position.y;f=g[6]*c+g[7]*l+g[8]*f+b.position.z;d.init(m,j,f)};
OIMO.BoxCylinderCollisionDetector.prototype.supportPointC=function(b,f,e,c,d){var g=b.rotation.elements,m=g[0]*f+g[3]*e+g[6]*c,j=g[1]*f+g[4]*e+g[7]*c;f=g[2]*f+g[5]*e+g[8]*c;e=m;m=f;f=e*e+m*m;var l=b.radius;c=b.halfHeight;0==f?(0>j?(e=l,c=-c):e=l,f=0):(f=b.radius/OIMO.sqrt(f),0>j?(e*=f,c=-c):e*=f,f*=m);m=g[0]*e+g[1]*c+g[2]*f+b.position.x;j=g[3]*e+g[4]*c+g[5]*f+b.position.y;f=g[6]*e+g[7]*c+g[8]*f+b.position.z;d.init(m,j,f)};
OIMO.BoxCylinderCollisionDetector.prototype.detectCollision=function(b,f,e){var c,d;this.flip?(c=f,d=b):(c=b,d=f);var g=new OIMO.Vec3,m=new OIMO.Vec3,j=new OIMO.Vec3;if(this.getSep(c,d,g,m,j)){var l=c.position.x,n=c.position.y,q=c.position.z,p=d.position.x,r=d.position.y,t=d.position.z,s=c.halfWidth,u=c.halfHeight,x=c.halfDepth,y=d.halfHeight,z=d.radius,A=c.dimentions,B=A[0],C=A[1],D=A[2],E=A[3],I=A[4],H=A[5],F=A[6],J=A[7],G=A[8],L=A[9],N=A[10],R=A[11],P=A[12],K=A[13],O=A[14],M=A[15],W=A[16],Ga=A[17],
qa=d.normalDirection.x,fa=d.normalDirection.y,Ba=d.normalDirection.z,Va=d.halfDirection.x,Ra=d.halfDirection.y,Z=d.halfDirection.z,v=g.x,U=g.y,X=g.z,ba=v*B+U*C+X*D,da=v*E+U*I+X*H,ra=v*F+U*J+X*G,ga=v*qa+U*fa+X*Ba,xa=0<ba,ya=0<da,ma=0<ra,na=0<ga;xa||(ba=-ba);ya||(da=-da);ma||(ra=-ra);na||(ga=-ga);var aa=0;0.999<ga?aa=0.999<ba?ba>ga?1:4:0.999<da?da>ga?2:4:0.999<ra?ra>ga?3:4:4:0.999<ba?aa=1:0.999<da?aa=2:0.999<ra&&(aa=3);var ea,Ha,Ca,Ia,Ja,Ma,Fb,Wa,Ub,Kb,Lb,cc,ob,Ob,dc,Xa,Ta,$a,ca,kb,rb,wa,ha,va,pb,sb,
xb,yb,Vb,Wb,Pb,Qb,Mb,wc,ab,bb,cb,sa,zb,Ab,ta,Aa,Ka,gb,Da,Rb,Xb,Yb,Nb,Sb,Tb,tb,Bb;if(0==aa)e.addPoint(m.x,m.y,m.z,v,U,X,j.x,this.flip);else if(4==aa){na?(Ia=p-Va,Ja=r-Ra,Ma=t-Z,v=-qa,U=-fa,X=-Ba):(Ia=p+Va,Ja=r+Ra,Ma=t+Z,v=qa,U=fa,X=Ba);var nc,gc,Qa,bc,ac,ic,fc,hc,Zb,ec,yc,hb;kb=1;aa=0;Ka=B*v+C*U+D*X;Ka<kb&&(kb=Ka,aa=0);-Ka<kb&&(kb=-Ka,aa=1);Ka=E*v+I*U+H*X;Ka<kb&&(kb=Ka,aa=2);-Ka<kb&&(kb=-Ka,aa=3);Ka=F*v+J*U+G*X;Ka<kb&&(kb=Ka,aa=4);-Ka<kb&&(kb=-Ka,aa=5);var Y=c.elements;switch(aa){case 0:nc=Y[0];gc=
Y[1];Qa=Y[2];bc=Y[6];ac=Y[7];ic=Y[8];fc=Y[9];hc=Y[10];Zb=Y[11];ec=Y[3];yc=Y[4];hb=Y[5];break;case 1:nc=Y[15];gc=Y[16];Qa=Y[17];bc=Y[21];ac=Y[22];ic=Y[23];fc=Y[18];hc=Y[19];Zb=Y[20];ec=Y[12];yc=Y[13];hb=Y[14];break;case 2:nc=Y[12];gc=Y[13];Qa=Y[14];bc=Y[0];ac=Y[1];ic=Y[2];fc=Y[3];hc=Y[4];Zb=Y[5];ec=Y[15];yc=Y[16];hb=Y[17];break;case 3:nc=Y[21];gc=Y[22];Qa=Y[23];bc=Y[9];ac=Y[10];ic=Y[11];fc=Y[6];hc=Y[7];Zb=Y[8];ec=Y[18];yc=Y[19];hb=Y[20];break;case 4:nc=Y[12];gc=Y[13];Qa=Y[14];bc=Y[18];ac=Y[19];ic=
Y[20];fc=Y[6];hc=Y[7];Zb=Y[8];ec=Y[0];yc=Y[1];hb=Y[2];break;case 5:nc=Y[3],gc=Y[4],Qa=Y[5],bc=Y[9],ac=Y[10],ic=Y[11],fc=Y[21],hc=Y[22],Zb=Y[23],ec=Y[15],yc=Y[16],hb=Y[17]}ca=v*(nc-Ia)+U*(gc-Ja)+X*(Qa-Ma);0>=ca&&e.addPoint(nc,gc,Qa,-v,-U,-X,ca,this.flip);ca=v*(bc-Ia)+U*(ac-Ja)+X*(ic-Ma);0>=ca&&e.addPoint(bc,ac,ic,-v,-U,-X,ca,this.flip);ca=v*(fc-Ia)+U*(hc-Ja)+X*(Zb-Ma);0>=ca&&e.addPoint(fc,hc,Zb,-v,-U,-X,ca,this.flip);ca=v*(ec-Ia)+U*(yc-Ja)+X*(hb-Ma);0>=ca&&e.addPoint(ec,yc,hb,-v,-U,-X,ca,this.flip)}else{switch(aa){case 1:xa?
(ea=l+L,Ha=n+N,Ca=q+R,v=B,U=C,X=D):(ea=l-L,Ha=n-N,Ca=q-R,v=-B,U=-C,X=-D);Rb=E;Xb=I;Yb=H;tb=u;Nb=F;Sb=J;Tb=G;Bb=x;break;case 2:ya?(ea=l+P,Ha=n+K,Ca=q+O,v=E,U=I,X=H):(ea=l-P,Ha=n-K,Ca=q-O,v=-E,U=-I,X=-H);Rb=B;Xb=C;Yb=D;tb=s;Nb=F;Sb=J;Tb=G;Bb=x;break;case 3:ma?(ea=l+M,Ha=n+W,Ca=q+Ga,v=F,U=J,X=G):(ea=l-M,Ha=n-W,Ca=q-Ga,v=-F,U=-J,X=-G),Rb=B,Xb=C,Yb=D,tb=s,Nb=E,Sb=I,Tb=H,Bb=u}kb=v*qa+U*fa+X*Ba;rb=0>kb?y:-y;Ia=p+rb*qa;Ja=r+rb*fa;Ma=t+rb*Ba;0.999999<=ga?(wa=-U,ha=X,va=v):(wa=v,ha=U,va=X);rb=wa*qa+ha*fa+va*
Ba;sb=rb*qa-wa;xb=rb*fa-ha;yb=rb*Ba-va;rb=OIMO.sqrt(sb*sb+xb*xb+yb*yb);if(0!=rb)if(rb=z/rb,sb*=rb,xb*=rb,yb*=rb,wa=Ia+sb,ha=Ja+xb,va=Ma+yb,-0.96>kb||0.96<kb)Fb=1.5*qa*qa-0.5,Wa=1.5*qa*fa-0.866025403*Ba,Ub=1.5*qa*Ba+0.866025403*fa,Kb=1.5*fa*qa+0.866025403*Ba,Lb=1.5*fa*fa-0.5,cc=1.5*fa*Ba-0.866025403*qa,ob=1.5*Ba*qa-0.866025403*fa,Ob=1.5*Ba*fa+0.866025403*qa,dc=1.5*Ba*Ba-0.5,Xa=wa,Ta=ha,$a=va,ca=v*(Xa-ea)+U*(Ta-Ha)+X*($a-Ca),wa=Xa-ca*v-ea,ha=Ta-ca*U-Ha,va=$a-ca*X-Ca,sa=Rb*wa+Xb*ha+Yb*va,Aa=Nb*wa+Sb*
ha+Tb*va,sa<-tb?sa=-tb:sa>tb&&(sa=tb),Aa<-Bb?Aa=-Bb:Aa>Bb&&(Aa=Bb),wa=sa*Rb+Aa*Nb,ha=sa*Xb+Aa*Sb,va=sa*Yb+Aa*Tb,Xa=ea+wa,Ta=Ha+ha,$a=Ca+va,e.addPoint(Xa,Ta,$a,v,U,X,ca,this.flip),Xa=sb*Fb+xb*Wa+yb*Ub,Ta=sb*Kb+xb*Lb+yb*cc,$a=sb*ob+xb*Ob+yb*dc,Xa=(sb=Xa)+Ia,Ta=(xb=Ta)+Ja,$a=(yb=$a)+Ma,ca=v*(Xa-ea)+U*(Ta-Ha)+X*($a-Ca),0>=ca&&(wa=Xa-ca*v-ea,ha=Ta-ca*U-Ha,va=$a-ca*X-Ca,sa=Rb*wa+Xb*ha+Yb*va,Aa=Nb*wa+Sb*ha+Tb*va,sa<-tb?sa=-tb:sa>tb&&(sa=tb),Aa<-Bb?Aa=-Bb:Aa>Bb&&(Aa=Bb),wa=sa*Rb+Aa*Nb,ha=sa*Xb+Aa*Sb,va=sa*
Yb+Aa*Tb,Xa=ea+wa,Ta=Ha+ha,$a=Ca+va,e.addPoint(Xa,Ta,$a,v,U,X,ca,this.flip)),Xa=sb*Fb+xb*Wa+yb*Ub,Ta=sb*Kb+xb*Lb+yb*cc,$a=sb*ob+xb*Ob+yb*dc,Xa=(sb=Xa)+Ia,Ta=(xb=Ta)+Ja,$a=(yb=$a)+Ma,ca=v*(Xa-ea)+U*(Ta-Ha)+X*($a-Ca),0>=ca&&(wa=Xa-ca*v-ea,ha=Ta-ca*U-Ha,va=$a-ca*X-Ca,sa=Rb*wa+Xb*ha+Yb*va,Aa=Nb*wa+Sb*ha+Tb*va,sa<-tb?sa=-tb:sa>tb&&(sa=tb),Aa<-Bb?Aa=-Bb:Aa>Bb&&(Aa=Bb),wa=sa*Rb+Aa*Nb,ha=sa*Xb+Aa*Sb,va=sa*Yb+Aa*Tb,Xa=ea+wa,Ta=Ha+ha,$a=Ca+va,e.addPoint(Xa,Ta,$a,v,U,X,ca,this.flip));else{ab=wa;bb=ha;cb=va;
sa=v*(ab-ea)+U*(bb-Ha)+X*(cb-Ca);ab-=sa*v;bb-=sa*U;cb-=sa*X;0<kb?(zb=wa+2*Va,Ab=ha+2*Ra,ta=va+2*Z):(zb=wa-2*Va,Ab=ha-2*Ra,ta=va-2*Z);Aa=v*(zb-ea)+U*(Ab-Ha)+X*(ta-Ca);zb-=Aa*v;Ab-=Aa*U;ta-=Aa*X;Vb=ab-ea;Wb=bb-Ha;Pb=cb-Ca;Qb=zb-ea;Mb=Ab-Ha;wc=ta-Ca;wa=zb-ab;ha=Ab-bb;va=ta-cb;pb=Aa-sa;ba=Vb*Rb+Wb*Xb+Pb*Yb;da=Qb*Rb+Mb*Xb+wc*Yb;Ka=ba-tb;gb=da-tb;if(0<Ka){if(0<gb)return;Da=Ka/(Ka-gb);ab+=wa*Da;bb+=ha*Da;cb+=va*Da;sa+=pb*Da;Vb=ab-ea;Wb=bb-Ha;Pb=cb-Ca;ba=Vb*Rb+Wb*Xb+Pb*Yb;wa=zb-ab;ha=Ab-bb;va=ta-cb;pb=Aa-
sa}else 0<gb&&(Da=Ka/(Ka-gb),zb=ab+wa*Da,Ab=bb+ha*Da,ta=cb+va*Da,Aa=sa+pb*Da,Qb=zb-ea,Mb=Ab-Ha,wc=ta-Ca,da=Qb*Rb+Mb*Xb+wc*Yb,wa=zb-ab,ha=Ab-bb,va=ta-cb,pb=Aa-sa);Ka=ba+tb;gb=da+tb;if(0>Ka){if(0>gb)return;Da=Ka/(Ka-gb);ab+=wa*Da;bb+=ha*Da;cb+=va*Da;sa+=pb*Da;Vb=ab-ea;Wb=bb-Ha;Pb=cb-Ca;wa=zb-ab;ha=Ab-bb;va=ta-cb;pb=Aa-sa}else 0>gb&&(Da=Ka/(Ka-gb),zb=ab+wa*Da,Ab=bb+ha*Da,ta=cb+va*Da,Aa=sa+pb*Da,Qb=zb-ea,Mb=Ab-Ha,wc=ta-Ca,wa=zb-ab,ha=Ab-bb,va=ta-cb,pb=Aa-sa);ba=Vb*Nb+Wb*Sb+Pb*Tb;da=Qb*Nb+Mb*Sb+wc*Tb;
Ka=ba-Bb;gb=da-Bb;if(0<Ka){if(0<gb)return;Da=Ka/(Ka-gb);ab+=wa*Da;bb+=ha*Da;cb+=va*Da;sa+=pb*Da;Vb=ab-ea;Wb=bb-Ha;Pb=cb-Ca;ba=Vb*Nb+Wb*Sb+Pb*Tb;wa=zb-ab;ha=Ab-bb;va=ta-cb;pb=Aa-sa}else 0<gb&&(Da=Ka/(Ka-gb),zb=ab+wa*Da,Ab=bb+ha*Da,ta=cb+va*Da,Aa=sa+pb*Da,Qb=zb-ea,Mb=Ab-Ha,wc=ta-Ca,da=Qb*Nb+Mb*Sb+wc*Tb,wa=zb-ab,ha=Ab-bb,va=ta-cb,pb=Aa-sa);Ka=ba+Bb;gb=da+Bb;if(0>Ka){if(0>gb)return;Da=Ka/(Ka-gb);ab+=wa*Da;bb+=ha*Da;cb+=va*Da;sa+=pb*Da}else 0>gb&&(Da=Ka/(Ka-gb),zb=ab+wa*Da,Ab=bb+ha*Da,ta=cb+va*Da,Aa=sa+
pb*Da);0>sa&&e.addPoint(ab,bb,cb,v,U,X,sa,this.flip);0>Aa&&e.addPoint(zb,Ab,ta,v,U,X,Aa,this.flip)}}}};OIMO.CylinderCylinderCollisionDetector=function(){OIMO.CollisionDetector.call(this)};OIMO.CylinderCylinderCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype);OIMO.CylinderCylinderCollisionDetector.prototype.constructor=OIMO.CylinderCylinderCollisionDetector;
OIMO.CylinderCylinderCollisionDetector.prototype.getSep=function(b,f,e,c,d){var g,m,j,l,n,q,p=new OIMO.Vec3,r,t,s,u,x,y,z=b.position.x,A=b.position.y,B=b.position.z,C=f.position.x,D=f.position.y,E=f.position.z,I=C-z,H=D-A,F=E-B;0==I*I+H*H+F*F&&(H=0.0010);var J=-I;q=-H;l=-F;this.supportPoint(b,-J,-q,-l,p);var G=p.x,L=p.y,N=p.z;this.supportPoint(f,J,q,l,p);var R=p.x,P=p.y,K=p.z,O=R-G,M=P-L,W=K-N;if(0>=O*J+M*q+W*l)return!1;J=M*F-W*H;q=W*I-O*F;l=O*H-M*I;if(0==J*J+q*q+l*l)return e.init(O-I,M-H,W-F),e.normalize(e),
c.init(0.5*(G+R),0.5*(L+P),0.5*(N+K)),!0;this.supportPoint(b,-J,-q,-l,p);var Ga=p.x,qa=p.y,fa=p.z;this.supportPoint(f,J,q,l,p);var Ba=p.x,Va=p.y,Ra=p.z,Z=Ba-Ga,v=Va-qa,U=Ra-fa;if(0>=Z*J+v*q+U*l)return!1;g=O-I;m=M-H;j=W-F;l=Z-I;n=v-H;q=U-F;J=m*q-j*n;q=j*l-g*q;l=g*n-m*l;0<J*I+q*H+l*F&&(g=O,m=M,j=W,O=Z,M=v,W=U,Z=g,v=m,U=j,g=G,m=L,j=N,G=Ga,L=qa,N=fa,Ga=g,qa=m,fa=j,g=R,m=P,j=K,R=Ba,P=Va,K=Ra,Ba=g,Va=m,Ra=j,J=-J,q=-q,l=-l);for(var X=0;;){if(100<++X)return!1;this.supportPoint(b,-J,-q,-l,p);var ba=p.x,da=
p.y,ra=p.z;this.supportPoint(f,J,q,l,p);var ga=p.x,xa=p.y,ya=p.z,ma=ga-ba,na=xa-da,aa=ya-ra;if(0>=ma*J+na*q+aa*l)return!1;if(0>(M*aa-W*na)*I+(W*ma-O*aa)*H+(O*na-M*ma)*F)Z=ma,v=na,U=aa,Ga=ba,qa=da,fa=ra,Ba=ga,Va=xa,Ra=ya,g=O-I,m=M-H,j=W-F,l=ma-I,n=na-H,q=aa-F,J=m*q-j*n,q=j*l-g*q,l=g*n-m*l;else if(0>(na*U-aa*v)*I+(aa*Z-ma*U)*H+(ma*v-na*Z)*F)O=ma,M=na,W=aa,G=ba,L=da,N=ra,R=ga,P=xa,K=ya,g=ma-I,m=na-H,j=aa-F,l=Z-I,n=v-H,q=U-F,J=m*q-j*n,q=j*l-g*q,l=g*n-m*l;else for(var ea=!1;;){g=Z-O;m=v-M;j=U-W;l=ma-O;
n=na-M;q=aa-W;J=m*q-j*n;q=j*l-g*q;l=g*n-m*l;g=1/OIMO.sqrt(J*J+q*q+l*l);J*=g;q*=g;l*=g;0<=J*O+q*M+l*W&&!ea&&(y=(M*U-W*v)*ma+(W*Z-O*U)*na+(O*v-M*Z)*aa,ea=(na*U-aa*v)*I+(aa*Z-ma*U)*H+(ma*v-na*Z)*F,g=(H*W-F*M)*ma+(F*O-I*W)*na+(I*M-H*O)*aa,m=(v*W-U*M)*I+(U*O-Z*W)*H+(Z*M-v*O)*F,r=y+ea+g+m,0>=r&&(y=0,ea=(v*aa-U*na)*J+(U*ma-Z*aa)*q+(Z*na-v*ma)*l,g=(na*U-aa*v)*J+(aa*Z-ma*U)*q+(ma*v-na*Z)*l,m=(M*U-W*v)*J+(W*Z-O*U)*q+(O*v-M*Z)*l,r=ea+g+m),j=1/r,r=(z*y+G*ea+Ga*g+ba*m)*j,t=(A*y+L*ea+qa*g+da*m)*j,s=(B*y+N*ea+fa*
g+ra*m)*j,u=(C*y+R*ea+Ba*g+ga*m)*j,x=(D*y+P*ea+Va*g+xa*m)*j,y=(E*y+K*ea+Ra*g+ya*m)*j,ea=!0);this.supportPoint(b,-J,-q,-l,p);g=p.x;m=p.y;j=p.z;this.supportPoint(f,J,q,l,p);n=p.x;var Ha=p.y,Ca=p.z,Ia=n-g,Ja=Ha-m,Ma=Ca-j,Fb=-(Ia*J+Ja*q+Ma*l);if(0.01>=(Ia-ma)*J+(Ja-na)*q+(Ma-aa)*l||0<=Fb)return ea?(e.init(-J,-q,-l),c.init(0.5*(r+u),0.5*(t+x),0.5*(s+y)),d.x=Fb,!0):!1;0>(Ja*W-Ma*M)*I+(Ma*O-Ia*W)*H+(Ia*M-Ja*O)*F?0>(Ja*U-Ma*v)*I+(Ma*Z-Ia*U)*H+(Ia*v-Ja*Z)*F?(O=Ia,M=Ja,W=Ma,G=g,L=m,N=j,R=n,P=Ha,K=Ca):(ma=Ia,
na=Ja,aa=Ma,ba=g,da=m,ra=j,ga=n,xa=Ha,ya=Ca):0>(Ja*aa-Ma*na)*I+(Ma*ma-Ia*aa)*H+(Ia*na-Ja*ma)*F?(Z=Ia,v=Ja,U=Ma,Ga=g,qa=m,fa=j,Ba=n,Va=Ha,Ra=Ca):(O=Ia,M=Ja,W=Ma,G=g,L=m,N=j,R=n,P=Ha,K=Ca)}}};
OIMO.CylinderCylinderCollisionDetector.prototype.supportPoint=function(b,f,e,c,d){var g=b.rotation.elements,m=g[0]*f+g[3]*e+g[6]*c,j=g[1]*f+g[4]*e+g[7]*c;f=g[2]*f+g[5]*e+g[8]*c;e=m;m=f;f=e*e+m*m;var l=b.radius;c=b.halfHeight;0==f?(0>j?(e=l,c=-c):e=l,f=0):(f=b.radius/OIMO.sqrt(f),0>j?(e*=f,c=-c):e*=f,f*=m);m=g[0]*e+g[1]*c+g[2]*f+b.position.x;j=g[3]*e+g[4]*c+g[5]*f+b.position.y;f=g[6]*e+g[7]*c+g[8]*f+b.position.z;d.init(m,j,f)};
OIMO.CylinderCylinderCollisionDetector.prototype.detectCollision=function(b,f,e){var c,d;b.id<f.id?(c=b,d=f):(c=f,d=b);f=c.position;b=d.position;var g=f.x,m=f.y,j=f.z,l=b.x,n=b.y,q=b.z,p=c.halfHeight,r=d.halfHeight,t=c.normalDirection,s=d.normalDirection,u=c.halfDirection,x=d.halfDirection;b=c.radius;f=d.radius;var y=t.x,z=t.y,t=t.z,A=s.x,B=s.y,s=s.z,C=u.x,D=u.y,E=u.z,I=x.x,H=x.y,F=x.z,u=g-l,J=m-n,G=j-q,L,N,R,x=new OIMO.Vec3,G=new OIMO.Vec3,P=new OIMO.Vec3;if(this.getSep(c,d,x,G,P)){u=x.x*y+x.y*z+
x.z*t;J=x.x*A+x.y*B+x.z*s;L=0<u;N=0<J;L||(u=-u);N||(J=-J);R=0;if(0.999<u||0.999<J)R=u>J?1:2;var P=P.x,K;c=x.x;d=x.y;x=x.z;switch(R){case 0:e.addPoint(G.x,G.y,G.z,c,d,x,P,!1);break;case 1:L?(g+=C,m+=D,j+=E,c=y,d=z,x=t):(g-=C,m-=D,j-=E,c=-y,d=-z,x=-t);R=c*A+d*B+x*s;D=0>R?r:-r;l+=D*A;n+=D*B;q+=D*s;0.999999<=J?(E=-d,C=x,H=c):(E=c,C=d,H=x);D=E*A+C*B+H*s;u=D*A-E;J=D*B-C;G=D*s-H;D=OIMO.sqrt(u*u+J*J+G*G);if(0==D)break;D=f/D;u*=D;J*=D;G*=D;E=l+u;C=n+J;H=q+G;if(-0.96>R||0.96<R)p=1.5*A*A-0.5,r=1.5*A*B-0.866025403*
s,F=1.5*A*s+0.866025403*B,I=1.5*B*A+0.866025403*s,L=1.5*B*B-0.5,N=1.5*B*s-0.866025403*A,R=1.5*s*A-0.866025403*B,z=1.5*s*B+0.866025403*A,t=1.5*s*s-0.5,s=E,y=C,B=H,K=c*(s-g)+d*(y-m)+x*(B-j),E=s-K*c-g,C=y-K*d-m,H=B-K*x-j,D=E*E+C*C+H*H,D>b*b&&(D=b/OIMO.sqrt(D),E*=D,C*=D,H*=D),e.addPoint(g+E,m+C,j+H,c,d,x,K,!1),y=u*I+J*L+G*N,B=u*R+J*z+G*t,s=(u=u*p+J*r+G*F)+l,y=(J=y)+n,B=(G=B)+q,K=c*(s-g)+d*(y-m)+x*(B-j),0>=K&&(E=s-K*c-g,C=y-K*d-m,H=B-K*x-j,D=E*E+C*C+H*H,D>b*b&&(D=b/OIMO.sqrt(D),E*=D,C*=D,H*=D),e.addPoint(g+
E,m+C,j+H,c,d,x,K,!1)),s=u*p+J*r+G*F+l,y=u*I+J*L+G*N+n,B=u*R+J*z+G*t+q,K=c*(s-g)+d*(y-m)+x*(B-j),0>=K&&(E=s-K*c-g,C=y-K*d-m,H=B-K*x-j,D=E*E+C*C+H*H,D>b*b&&(D=b/OIMO.sqrt(D),E*=D,C*=D,H*=D),e.addPoint(g+E,m+C,j+H,c,d,x,K,!1));else{F=E;I=C;L=H;N=c*(F-g)+d*(I-m)+x*(L-j);F-=N*c;I-=N*d;L-=N*x;0<R?(y=E+2*A*r,z=C+2*B*r,t=H+2*s*r):(y=E-2*A*r,z=C-2*B*r,t=H-2*s*r);s=c*(y-g)+d*(z-m)+x*(t-j);y-=s*c;z-=s*d;t-=s*x;u=g-F;J=m-I;G=j-L;E=y-F;C=z-I;H=t-L;B=u*E+J*C+G*H;A=E*E+C*C+H*H;f=B*B-A*(u*u+J*J+G*G-b*b);if(0>f)break;
f=OIMO.sqrt(f);b=(B+f)/A;f=(B-f)/A;f<b&&(D=b,b=f,f=D);1<f&&(f=1);0>b&&(b=0);E=F+(y-F)*b;C=I+(z-I)*b;H=L+(t-L)*b;y=F+(y-F)*f;z=I+(z-I)*f;t=L+(t-L)*f;D=N+(s-N)*b;s=N+(s-N)*f;0>D&&e.addPoint(E,C,H,c,d,x,K,!1);0>s&&e.addPoint(y,z,t,c,d,x,K,!1)}break;case 2:N?(l-=I,n-=H,q-=F,c=-A,d=-B,x=-s):(l+=I,n+=H,q+=F,c=A,d=B,x=s);R=c*y+d*z+x*t;D=0>R?p:-p;g+=D*y;m+=D*z;j+=D*t;0.999999<=u?(E=-d,C=x,H=c):(E=c,C=d,H=x);D=E*y+C*z+H*t;u=D*y-E;J=D*z-C;G=D*t-H;D=OIMO.sqrt(u*u+J*J+G*G);if(0==D)break;D=b/D;u*=D;J*=D;G*=D;
E=g+u;C=m+J;H=j+G;if(-0.96>R||0.96<R)p=1.5*y*y-0.5,r=1.5*y*z-0.866025403*t,F=1.5*y*t+0.866025403*z,I=1.5*z*y+0.866025403*t,L=1.5*z*z-0.5,N=1.5*z*t-0.866025403*y,R=1.5*t*y-0.866025403*z,z=1.5*t*z+0.866025403*y,t=1.5*t*t-0.5,s=E,y=C,B=H,K=c*(s-l)+d*(y-n)+x*(B-q),E=s-K*c-l,C=y-K*d-n,H=B-K*x-q,D=E*E+C*C+H*H,D>f*f&&(D=f/OIMO.sqrt(D),E*=D,C*=D,H*=D),e.addPoint(l+E,n+C,q+H,-c,-d,-x,K,!1),y=u*I+J*L+G*N,B=u*R+J*z+G*t,s=(u=u*p+J*r+G*F)+g,y=(J=y)+m,B=(G=B)+j,K=c*(s-l)+d*(y-n)+x*(B-q),0>=K&&(E=s-K*c-l,C=y-K*
d-n,H=B-K*x-q,D=E*E+C*C+H*H,D>f*f&&(D=f/OIMO.sqrt(D),E*=D,C*=D,H*=D),e.addPoint(l+E,n+C,q+H,-c,-d,-x,K,!1)),s=u*p+J*r+G*F+g,y=u*I+J*L+G*N+m,B=u*R+J*z+G*t+j,K=c*(s-l)+d*(y-n)+x*(B-q),0>=K&&(E=s-K*c-l,C=y-K*d-n,H=B-K*x-q,D=E*E+C*C+H*H,D>f*f&&(D=f/OIMO.sqrt(D),E*=D,C*=D,H*=D),e.addPoint(l+E,n+C,q+H,-c,-d,-x,K,!1));else{F=E;I=C;L=H;N=c*(F-l)+d*(I-n)+x*(L-q);F-=N*c;I-=N*d;L-=N*x;0<R?(y=E+2*y*p,z=C+2*z*p,t=H+2*t*p):(y=E-2*y*p,z=C-2*z*p,t=H-2*t*p);s=c*(y-l)+d*(z-n)+x*(t-q);y-=s*c;z-=s*d;t-=s*x;u=l-F;J=n-
I;G=q-L;E=y-F;C=z-I;H=t-L;B=u*E+J*C+G*H;A=E*E+C*C+H*H;f=B*B-A*(u*u+J*J+G*G-f*f);if(0>f)break;f=OIMO.sqrt(f);b=(B+f)/A;f=(B-f)/A;f<b&&(D=b,b=f,f=D);1<f&&(f=1);0>b&&(b=0);E=F+(y-F)*b;C=I+(z-I)*b;H=L+(t-L)*b;y=F+(y-F)*f;z=I+(z-I)*f;t=L+(t-L)*f;D=N+(s-N)*b;s=N+(s-N)*f;N=D;0>N&&e.addPoint(E,C,H,-c,-d,-x,N,!1);0>s&&e.addPoint(y,z,t,-c,-d,-x,s,!1)}}}};OIMO.SphereCylinderCollisionDetector=function(b){OIMO.CollisionDetector.call(this);this.flip=b};OIMO.SphereCylinderCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype);
OIMO.SphereCylinderCollisionDetector.prototype.constructor=OIMO.SphereCylinderCollisionDetector;
OIMO.SphereCylinderCollisionDetector.prototype.detectCollision=function(b,f,e){var c,d;this.flip?(c=f,d=b):(c=b,d=f);var g=c.position;b=g.x;f=g.y;var g=g.z,m=d.position,j=m.x,l=m.y,m=m.z,n=d.normalDirection.x,q=d.normalDirection.y,p=d.normalDirection.z;c=c.radius;var r=d.radius,t=c+r,s=d.halfHeight,u=(b-j)*n+(f-l)*q+(g-m)*p;if(!(u<-s-c||u>s+c)){var x=b-(j+u*n),y=f-(l+u*q),z=g-(m+u*p);d=x*x+y*y+z*z;d>t*t||(d>r*r&&(d=r/OIMO.sqrt(d),x*=d,y*=d,z*=d),u<-s?u=-s:u>s&&(u=s),j=j+u*n+x-b,l=l+u*q+y-f,m=m+u*
p+z-g,d=j*j+l*l+m*m,0<d&&d<c*c&&(d=OIMO.sqrt(d),p=1/d,j*=p,l*=p,m*=p,e.addPoint(b+j*c,f+l*c,g+m*c,j,l,m,d-c,this.flip)))}};OIMO.TetraTetraCollisionDetector=function(){OIMO.CollisionDetector.call(this)};OIMO.TetraTetraCollisionDetector.prototype=Object.create(OIMO.CollisionDetector.prototype);OIMO.TetraTetraCollisionDetector.prototype.constructor=OIMO.TetraTetraCollisionDetector;
OIMO.TetraTetraCollisionDetector.prototype.detectCollision=function(b,f,e){var c,d,g=b.verts;f=f.verts;var m,j,l,n=0,q=b.faces;for(b=0;4>b;b++){d=g[b];for(c=0;4>c;c++)m=f[q[b].a],j=f[q[b].b],l=f[q[b].c],tricheck(pt(d.x,d.y),pt(m.x,m.y),pt(j.x,j.y),pt(l.x,l.y))&&(tricheck(pt(d.x,d.z),pt(m.x,m.z),pt(j.x,j.z),pt(l.x,l.z))&&tricheck(pt(d.z,d.y),pt(m.z,m.y),pt(j.z,j.y),pt(l.z,l.y)))&&n++,4===n&&e.addPoint(d)}};
function tricheck(b,f,e,c){var d=0.5*(-e.y*c.x+f.y*(-e.x+c.x)+f.x*(e.y-c.y)+e.x*c.y),g=0>d?-1:1;c=(f.y*c.x-f.x*c.y+(c.y-f.y)*b.x+(f.x-c.x)*b.y)*g;b=(f.x*e.y-f.y*e.x+(f.y-e.y)*b.x+(e.x-f.x)*b.y)*g;return 0<c&&0<b&&c+b<2*d*g}function pt(b,f){return{x:b,y:f}}OIMO.AABB=function(b,f,e,c,d,g){var m=this.elements=new OIMO_ARRAY_TYPE(6);m[0]=b||0;m[1]=e||0;m[2]=d||0;m[3]=f||0;m[4]=c||0;m[5]=g||0};
OIMO.AABB.prototype={constructor:OIMO.AABB,set:function(b,f,e,c,d,g){var m=this.elements;m[0]=b;m[3]=f;m[1]=e;m[4]=c;m[2]=d;m[5]=g;return this},intersectTest:function(b){var f=this.elements;b=b.elements;return f[0]>b[3]||f[1]>b[4]||f[2]>b[5]||f[3]<b[0]||f[4]<b[1]||f[5]<b[2]},intersectTestTwo:function(b){var f=this.elements;b=b.elements;return f[0]<b[0]||f[1]<b[1]||f[2]<b[2]||f[3]>b[3]||f[4]>b[4]||f[5]>b[5]},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(b,f){var e=
f||0,c=b.elements;this.set(c[0]-e,c[3]+e,c[1]-e,c[4]+e,c[2]-e,c[5]+e);return this},fromArray:function(b){this.elements.set(b);return this},combine:function(b,f){var e=b.elements,c=f.elements,d=this.elements;d[0]=e[0]<c[0]?e[0]:c[0];d[1]=e[1]<c[1]?e[1]:c[1];d[2]=e[2]<c[2]?e[2]:c[2];d[3]=e[3]>c[3]?e[3]:c[3];d[4]=e[4]>c[4]?e[4]:c[4];d[5]=e[5]>c[5]?e[5]:c[5];return this},surfaceArea:function(){var b=this.elements,f=b[4]-b[1],e=b[5]-b[2];return 2*((b[3]-b[0])*(f+e)+f*e)},intersectsWithPoint:function(b,
f,e){var c=this.elements;return b>=c[0]&&b<=c[3]&&f>=c[1]&&f<=c[4]&&e>=c[2]&&e<=c[5]},setFromPoints:function(b){this.makeEmpty();for(var f=0;f<b.length;f++)this.expandByPoint(b[f])},makeEmpty:function(){this.set(-Infinity,-Infinity,-Infinity,Infinity,Infinity,Infinity)},expandByPoint:function(b){var f=this.elements;this.set(OIMO.min(f[0],b.x),OIMO.min(f[1],b.y),OIMO.min(f[2],b.z),OIMO.max(f[3],b.x),OIMO.max(f[4],b.y),OIMO.max(f[5],b.z))}};OIMO.Proxy=function(b){this.shape=b;this.aabb=b.aabb};
OIMO.Proxy.prototype={constructor:OIMO.Proxy,update:function(){OIMO.Error("Proxy","Inheritance error.")}};OIMO.BasicProxy=function(b){OIMO.Proxy.call(this,b);this.id=OIMO.proxyID++};OIMO.BasicProxy.prototype=Object.create(OIMO.Proxy.prototype);OIMO.BasicProxy.prototype.constructor=OIMO.BasicProxy;OIMO.BasicProxy.prototype.update=function(){};OIMO.BroadPhase=function(){this.types=OIMO.BR_NULL;this.numPairs=this.numPairChecks=0;this.pairs=[]};
OIMO.BroadPhase.prototype={constructor:OIMO.BroadPhase,createProxy:function(){OIMO.Error("BroadPhase","Inheritance error.")},addProxy:function(){OIMO.Error("BroadPhase","Inheritance error.")},removeProxy:function(){OIMO.Error("BroadPhase","Inheritance error.")},isAvailablePair:function(b,f){var e=b.parent,c=f.parent;if(e==c||!e.isDynamic&&!c.isDynamic||0==(b.belongsTo&f.collidesWith)||0==(f.belongsTo&b.collidesWith))return!1;var d;for(d=e.numJoints<c.numJoints?e.jointLink:c.jointLink;null!==d;){var g=
d.joint;if(!g.allowCollision&&(g.body1==e&&g.body2==c||g.body1==c&&g.body2==e))return!1;d=d.next}return!0},detectPairs:function(){this.pairs=[];this.numPairChecks=this.numPairs=0;this.collectPairs()},collectPairs:function(){OIMO.Error("BroadPhase","Inheritance error.")},addPair:function(b,f){var e=new OIMO.Pair(b,f);this.pairs.push(e);this.numPairs++}};OIMO.BruteForceBroadPhase=function(){OIMO.BroadPhase.call(this);this.types=OIMO.BR_BRUTE_FORCE;this.proxies=[]};
OIMO.BruteForceBroadPhase.prototype=Object.create(OIMO.BroadPhase.prototype);OIMO.BruteForceBroadPhase.prototype.constructor=OIMO.BruteForceBroadPhase;OIMO.BruteForceBroadPhase.prototype.createProxy=function(b){return new OIMO.BasicProxy(b)};OIMO.BruteForceBroadPhase.prototype.addProxy=function(b){this.proxies.push(b)};OIMO.BruteForceBroadPhase.prototype.removeProxy=function(b){b=this.proxies.indexOf(b);-1<b&&this.proxies.splice(b,1)};
OIMO.BruteForceBroadPhase.prototype.collectPairs=function(){var b=0,f,e,c,d=this.proxies,g=d.length;for(this.numPairChecks=g*(g-1)>>1;b<g;){e=d[b++];for(f=b+1;f<g;)c=d[f++],!e.aabb.intersectTest(c.aabb)&&this.isAvailablePair(e.shape,c.shape)&&this.addPair(e.shape,c.shape)}};OIMO.Pair=function(b,f){this.shape1=b||null;this.shape2=f||null};OIMO.SAPAxis=function(){this.numElements=0;this.bufferSize=256;this.elements=[];this.elements.length=this.bufferSize;this.stack=new OIMO_ARRAY_TYPE(64)};
OIMO.SAPAxis.prototype={constructor:OIMO.SAPAxis,addElements:function(b,f){if(this.numElements+2>=this.bufferSize){this.bufferSize*=2;for(var e=this.numElements;e--;);}this.elements[this.numElements++]=b;this.elements[this.numElements++]=f},removeElements:function(b,f){for(var e=-1,c=-1,d=0,g=this.numElements;d<g;d++){var m=this.elements[d];if(m==b||m==f)if(-1==e)e=d;else{c=d;break}}d=e+1;for(g=c;d<g;d++)this.elements[d-1]=this.elements[d];d=c+1;for(g=this.numElements;d<g;d++)this.elements[d-2]=this.elements[d];
this.elements[--this.numElements]=null;this.elements[--this.numElements]=null},sort:function(){for(var b=0,f=1;0!=this.numElements>>f;)f++;for(var f=f*this.numElements>>2,b=0,e=!1,c=this.elements,d=1,g=this.numElements;d<g;d++){var m=c[d],j=m.value,l=c[d-1];if(l.value>j){var n=d;do{c[n]=l;if(0==--n)break;l=c[n-1]}while(l.value>j);c[n]=m;b+=d-n;if(b>f){e=!0;break}}}if(e){b=2;f=this.stack;f[0]=0;for(f[1]=this.numElements-1;0<b;)if(e=f[--b],l=f[--b],m=e-l,16<m){d=l+OIMO.floor(0.5*m);m=c[d];c[d]=c[e];
c[e]=m;j=m.value;d=l-1;for(n=e;;){var q;do g=c[++d];while(g.value<j);do q=c[--n];while(j<q.value&&n!=l);if(d>=n)break;c[d]=q;c[n]=g}c[e]=c[d];c[d]=m;d-l>e-d?(f[b++]=l,f[b++]=d-1,f[b++]=d+1,f[b++]=e):(f[b++]=d+1,f[b++]=e,f[b++]=l,f[b++]=d-1)}else for(d=l+1;d<=e;d++)if(m=c[d],j=m.value,l=c[d-1],l.value>j){n=d;do{c[n]=l;if(0==--n)break;l=c[n-1]}while(l.value>j);c[n]=m}}},calculateTestCount:function(){for(var b=1,f=0,e=1,c=this.numElements;e<c;e++)this.elements[e].max?b--:(f+=b,b++);return f}};
OIMO.SAPBroadPhase=function(){OIMO.BroadPhase.call(this);this.types=OIMO.BR_SWEEP_AND_PRUNE;this.numElementsS=this.numElementsD=0;this.axesD=[new OIMO.SAPAxis,new OIMO.SAPAxis,new OIMO.SAPAxis];this.axesS=[new OIMO.SAPAxis,new OIMO.SAPAxis,new OIMO.SAPAxis];this.index1=0;this.index2=1};OIMO.SAPBroadPhase.prototype=Object.create(OIMO.BroadPhase.prototype);OIMO.SAPBroadPhase.prototype.constructor=OIMO.SAPBroadPhase;OIMO.SAPBroadPhase.prototype.createProxy=function(b){return new OIMO.SAPProxy(this,b)};
OIMO.SAPBroadPhase.prototype.addProxy=function(b){b.isDynamic()?(this.axesD[0].addElements(b.min[0],b.max[0]),this.axesD[1].addElements(b.min[1],b.max[1]),this.axesD[2].addElements(b.min[2],b.max[2]),b.belongsTo=1,this.numElementsD+=2):(this.axesS[0].addElements(b.min[0],b.max[0]),this.axesS[1].addElements(b.min[1],b.max[1]),this.axesS[2].addElements(b.min[2],b.max[2]),b.belongsTo=2,this.numElementsS+=2)};
OIMO.SAPBroadPhase.prototype.removeProxy=function(b){if(0!=b.belongsTo){switch(b.belongsTo){case 1:this.axesD[0].removeElements(b.min[0],b.max[0]);this.axesD[1].removeElements(b.min[1],b.max[1]);this.axesD[2].removeElements(b.min[2],b.max[2]);this.numElementsD-=2;break;case 2:this.axesS[0].removeElements(b.min[0],b.max[0]),this.axesS[1].removeElements(b.min[1],b.max[1]),this.axesS[2].removeElements(b.min[2],b.max[2]),this.numElementsS-=2}b.belongsTo=0}};
OIMO.SAPBroadPhase.prototype.collectPairs=function(){if(0!=this.numElementsD){var b=this.axesD[this.index1],f=this.axesD[this.index2];b.sort();f.sort();var e=b.calculateTestCount(),c=f.calculateTestCount();e<=c?(f=this.axesS[this.index1],f.sort(),e=b.elements,b=f.elements):(b=this.axesS[this.index2],b.sort(),e=f.elements,b=b.elements,this.index1^=this.index2,this.index2^=this.index1,this.index1^=this.index2);for(var d,g,c=f=0;f<this.numElementsD;){var m,j;c==this.numElementsS?(m=e[f],j=!0,f++):(m=
e[f],j=b[c],m.value<j.value?(j=!0,f++):(m=j,j=!1,c++));if(m.max){var l=m.pair;if(j)if(l==d){d=d.pair;continue}else m=d;else if(l==g){g=g.pair;continue}else m=g;do{t=m.pair;if(t==l){m.pair=t.pair;break}m=t}while(null!=m)}else{for(var l=m.proxy.shape,n=m.min1.value,q=m.max1.value,p=m.min2.value,r=m.max2.value,t=d;null!=t;t=t.pair){var s=t.proxy.shape;this.numPairChecks++;n>t.max1.value||(q<t.min1.value||p>t.max2.value||r<t.min2.value||!this.isAvailablePair(l,s))||this.addPair(l,s)}if(j){for(t=g;null!=
t;t=t.pair)s=t.proxy.shape,this.numPairChecks++,n>t.max1.value||(q<t.min1.value||p>t.max2.value||r<t.min2.value||!this.isAvailablePair(l,s))||this.addPair(l,s);m.pair=d;d=m}else m.pair=g,g=m}}this.index2=(this.index1|this.index2)^3}};OIMO.SAPElement=function(b,f){this.proxy=b;this.max2=this.min2=this.max1=this.min1=this.pair=null;this.max=f;this.value=0};
OIMO.SAPProxy=function(b,f){OIMO.Proxy.call(this,f);this.belongsTo=0;this.max=[];this.min=[];this.sap=b;this.min[0]=new OIMO.SAPElement(this,!1);this.max[0]=new OIMO.SAPElement(this,!0);this.min[1]=new OIMO.SAPElement(this,!1);this.max[1]=new OIMO.SAPElement(this,!0);this.min[2]=new OIMO.SAPElement(this,!1);this.max[2]=new OIMO.SAPElement(this,!0);this.max[0].pair=this.min[0];this.max[1].pair=this.min[1];this.max[2].pair=this.min[2];this.min[0].min1=this.min[1];this.min[0].max1=this.max[1];this.min[0].min2=
this.min[2];this.min[0].max2=this.max[2];this.min[1].min1=this.min[0];this.min[1].max1=this.max[0];this.min[1].min2=this.min[2];this.min[1].max2=this.max[2];this.min[2].min1=this.min[0];this.min[2].max1=this.max[0];this.min[2].min2=this.min[1];this.min[2].max2=this.max[1]};OIMO.SAPProxy.prototype=Object.create(OIMO.Proxy.prototype);OIMO.SAPProxy.prototype.constructor=OIMO.SAPProxy;OIMO.SAPProxy.prototype.isDynamic=function(){var b=this.shape.parent;return b.isDynamic&&!b.sleeping};
OIMO.SAPProxy.prototype.update=function(){var b=this.aabb.elements;this.min[0].value=b[0];this.min[1].value=b[1];this.min[2].value=b[2];this.max[0].value=b[3];this.max[1].value=b[4];this.max[2].value=b[5];if(1==this.belongsTo&&!this.isDynamic()||2==this.belongsTo&&this.isDynamic())this.sap.removeProxy(this),this.sap.addProxy(this)};OIMO.DBVT=function(){this.root=null;this.freeNodes=[];this.freeNodes.length=16384;this.numFreeNodes=0;this.aabb=new OIMO.AABB};
OIMO.DBVT.prototype={constructor:OIMO.DBVT,moveLeaf:function(b){this.deleteLeaf(b);this.insertLeaf(b)},insertLeaf:function(b){if(null==this.root)this.root=b;else{for(var f=b.aabb,e=this.root,c,d;null==e.proxy;){var g=e.child1,m=e.child2,j=e.aabb,l=g.aabb,n=m.aabb;c=j.surfaceArea();this.aabb.combine(f,j);d=this.aabb.surfaceArea();j=2*d;c=d=2*(d-c);this.aabb.combine(f,l);c=null!=g.proxy?c+this.aabb.surfaceArea():c+(this.aabb.surfaceArea()-l.surfaceArea());l=d;this.aabb.combine(f,n);l=null!=m.proxy?
l+this.aabb.surfaceArea():l+(this.aabb.surfaceArea()-n.surfaceArea());if(c<l)if(j<c)break;else e=g;else if(j<l)break;else e=m}f=e.parent;g=0<this.numFreeNodes?this.freeNodes[--this.numFreeNodes]:new OIMO.DBVTNode;g.parent=f;g.child1=b;g.child2=e;g.aabb.combine(b.aabb,e.aabb);g.height=e.height+1;e.parent=g;b.parent=g;e==this.root?this.root=g:f.child1==e?f.child1=g:f.child2=g;do g=this.balance(g),this.fix(g),g=g.parent;while(null!=g)}},getBalance:function(b){return null!=b.proxy?0:b.child1.height-b.child2.height},
deleteLeaf:function(b){if(b==this.root)this.root=null;else{var f=b.parent;b=f.child1==b?f.child2:f.child1;if(f==this.root)this.root=b,b.parent=null;else{var e=f.parent;b.parent=e;e.child1==f?e.child1=b:e.child2=b;16384>this.numFreeNodes&&(this.freeNodes[this.numFreeNodes++]=f);do e=this.balance(e),this.fix(e),e=e.parent;while(null!=e)}}},balance:function(b){var f=b.height;if(2>f)return b;var e=b.parent,c=b.child1,d=b.child2,g=c.height,m=d.height,j=g-m;if(1<j){var g=c.child1,j=c.child2,l=g.height,
n=j.height;l>n?(c.child2=b,b.parent=c,b.child1=j,j.parent=b,b.aabb.combine(j.aabb,d.aabb),m=n-m,b.height=n-(m&m>>31)+1,c.aabb.combine(g.aabb,b.aabb),m=l-f,c.height=l-(m&m>>31)+1):(c.child1=b,b.parent=c,b.child1=g,g.parent=b,b.aabb.combine(g.aabb,d.aabb),m=l-m,b.height=l-(m&m>>31)+1,c.aabb.combine(b.aabb,j.aabb),m=f-n,c.height=f-(m&m>>31)+1);null!=e?e.child1==b?e.child1=c:e.child2=c:this.root=c;c.parent=e;return c}if(-1>j){var j=d.child1,l=d.child2,n=j.height,q=l.height;n>q?(d.child2=b,b.parent=d,
b.child2=l,l.parent=b,b.aabb.combine(c.aabb,l.aabb),m=g-q,b.height=g-(m&m>>31)+1,d.aabb.combine(j.aabb,b.aabb),m=n-f,d.height=n-(m&m>>31)+1):(d.child1=b,b.parent=d,b.child2=j,j.parent=b,b.aabb.combine(c.aabb,j.aabb),m=g-n,b.height=g-(m&m>>31)+1,d.aabb.combine(b.aabb,l.aabb),m=f-q,d.height=f-(m&m>>31)+1);null!=e?e.child1==b?e.child1=d:e.child2=d:this.root=d;d.parent=e;return d}return b},fix:function(b){var f=b.child1,e=b.child2;b.aabb.combine(f.aabb,e.aabb);b.height=f.height<e.height?e.height+1:f.height+
1}};OIMO.DBVTBroadPhase=function(){OIMO.BroadPhase.call(this);this.types=OIMO.BR_BOUNDING_VOLUME_TREE;this.tree=new OIMO.DBVT;this.stack=[];this.leaves=[];this.numLeaves=0};OIMO.DBVTBroadPhase.prototype=Object.create(OIMO.BroadPhase.prototype);OIMO.DBVTBroadPhase.prototype.constructor=OIMO.DBVTBroadPhase;OIMO.DBVTBroadPhase.prototype.createProxy=function(b){return new OIMO.DBVTProxy(b)};OIMO.DBVTBroadPhase.prototype.addProxy=function(b){this.tree.insertLeaf(b.leaf);this.leaves.push(b.leaf);this.numLeaves++};
OIMO.DBVTBroadPhase.prototype.removeProxy=function(b){this.tree.deleteLeaf(b.leaf);b=this.leaves.indexOf(b.leaf);-1<b&&(this.leaves.splice(b,1),this.numLeaves--)};OIMO.DBVTBroadPhase.prototype.collectPairs=function(){if(!(2>this.numLeaves))for(var b,f=this.numLeaves;f--;)b=this.leaves[f],b.proxy.aabb.intersectTestTwo(b.aabb)&&(b.aabb.copy(b.proxy.aabb,0.1),this.tree.deleteLeaf(b),this.tree.insertLeaf(b),this.collide(b,this.tree.root))};
OIMO.DBVTBroadPhase.prototype.collide=function(b,f){var e=2,c,d,g,m;this.stack[0]=b;for(this.stack[1]=f;0<e;)c=this.stack[--e],d=this.stack[--e],g=null!=c.proxy,m=null!=d.proxy,this.numPairChecks++,g&&m?(c=c.proxy.shape,d=d.proxy.shape,c==d||(c.aabb.intersectTest(d.aabb)||!this.isAvailablePair(c,d))||this.addPair(c,d)):c.aabb.intersectTest(d.aabb)||(m||!g&&c.aabb.surfaceArea()>d.aabb.surfaceArea()?(this.stack[e++]=c.child1,this.stack[e++]=d,this.stack[e++]=c.child2,this.stack[e++]=d):(this.stack[e++]=
c,this.stack[e++]=d.child1,this.stack[e++]=c,this.stack[e++]=d.child2))};OIMO.DBVTNode=function(){this.proxy=this.parent=this.child2=this.child1=null;this.height=0;this.aabb=new OIMO.AABB};OIMO.DBVTProxy=function(b){OIMO.Proxy.call(this,b);this.leaf=new OIMO.DBVTNode;this.leaf.proxy=this};OIMO.DBVTProxy.prototype=Object.create(OIMO.Proxy.prototype);OIMO.DBVTProxy.prototype.constructor=OIMO.DBVTProxy;OIMO.DBVTProxy.prototype.update=function(){};
OIMO.World.prototype.add=function(b){b=b||{};var f=b.type||"box";"string"===typeof f&&(f=[f]);if("joint"==f[0].substring(0,5)){"joint"===f[0]&&(f[0]="jointHinge");var e=b.axe1||[1,0,0],c=b.axe2||[1,0,0],d=b.pos1||[0,0,0],g=b.pos2||[0,0,0],d=d.map(function(b){return b*OIMO.INV_SCALE}),g=g.map(function(b){return b*OIMO.INV_SCALE}),m,j;"jointDistance"===f[0]?(m=b.min||0,j=b.max||10,m*=OIMO.INV_SCALE,j*=OIMO.INV_SCALE):(m=b.min||57.29578,j=b.max||0,m*=OIMO.degtorad,j*=OIMO.degtorad);var l=b.limit||null,
n=b.spring||null,q=b.motor||null,p=new OIMO.JointConfig;p.allowCollision=b.collision||!1;p.localAxis1.init(e[0],e[1],e[2]);p.localAxis2.init(c[0],c[1],c[2]);p.localAnchorPoint1.init(d[0],d[1],d[2]);p.localAnchorPoint2.init(g[0],g[1],g[2]);if("string"==typeof b.body1||b.body1 instanceof String)b.body1=this.getByName(b.body1);if("string"==typeof b.body2||b.body2 instanceof String)b.body2=this.getByName(b.body2);p.body1=b.body1;p.body2=b.body2;var r;switch(f[0]){case "jointDistance":r=new OIMO.DistanceJoint(p,
m,j);null!==n&&r.limitMotor.setSpring(n[0],n[1]);null!==q&&r.limitMotor.setSpring(q[0],q[1]);break;case "jointHinge":r=new OIMO.HingeJoint(p,m,j);null!==n&&r.limitMotor.setSpring(n[0],n[1]);null!==q&&r.limitMotor.setSpring(q[0],q[1]);break;case "jointPrisme":r=new OIMO.PrismaticJoint(p,m,j);break;case "jointSlide":r=new OIMO.SliderJoint(p,m,j);break;case "jointBall":r=new OIMO.BallAndSocketJoint(p);break;case "jointWheel":r=new OIMO.WheelJoint(p),null!==l&&r.rotationalLimitMotor1.setLimit(l[0],l[1]),
null!==n&&r.rotationalLimitMotor1.setSpring(n[0],n[1]),null!==q&&r.rotationalLimitMotor1.setSpring(q[0],q[1])}r.name=b.name||"";this.addJoint(r);return r}e=b.move||!1;c=b.noSleep||!1;d=b.pos||[0,0,0];d=d.map(function(b){return b*OIMO.INV_SCALE});g=b.size||[1,1,1];g=g.map(function(b){return b*OIMO.INV_SCALE});l=b.rot||[0,0,0];l=l.map(function(b){return b*OIMO.degtorad});m=[];for(j=0;j<l.length/3;j++)n=OIMO.EulerToAxis(l[j+0],l[j+1],l[j+2]),m.push(n[0]),m.push(n[1]),m.push(n[2]),m.push(n[3]);l=new OIMO.ShapeConfig;
void 0!==b.sc&&(l=b.sc);b.config&&(l.density=void 0===b.config[0]?1:b.config[0],l.friction=void 0===b.config[1]?0.4:b.config[1],l.restitution=void 0===b.config[2]?0.2:b.config[2],l.belongsTo=b.config[3]||1,l.collidesWith=b.config[4]||4294967295);void 0!==b.density&&(l.density=b.density);void 0!==b.friction&&(l.friction=b.friction);void 0!==b.restitution&&(l.restitution=b.restitution);void 0!==b.belongsTo&&(l.belongsTo=b.belongsTo);void 0!==b.collidesWith&&(l.collidesWith=b.collidesWith);b.massPos&&
(b.massPos=b.massPos.map(function(b){return b*OIMO.INV_SCALE}),l.relativePosition.init(b.massPos[0],b.massPos[1],b.massPos[2]));b.massRot&&(b.massRot=b.massRot.map(function(b){return b*OIMO.degtorad}),l.relativeRotation=OIMO.EulerToMatrix(b.massRot[0],b.massRot[1],b.massRot[2]));n=new OIMO.RigidBody(d[0],d[1],d[2],m[0],m[1],m[2],m[3]);q=[];for(j=0;j<f.length;j++){p=3*j;r=4*j;switch(f[j]){case "sphere":q[j]=new OIMO.SphereShape(l,g[p]);break;case "cylinder":q[j]=new OIMO.CylinderShape(l,g[p],g[p+1]);
break;case "box":q[j]=new OIMO.BoxShape(l,g[p],g[p+1],g[p+2])}n.addShape(q[j]);0<j&&(q[j].relativePosition=new OIMO.Vec3(d[p],d[p+1],d[p+2]),m[r+0]&&(q[j].relativeRotation=[m[r],m[r+1],m[r+2],m[r+3]]))}e?(b.massPos||b.massRot?n.setupMass(1,!1):n.setupMass(1,!0),n.allowSleep=c?!1:!0):n.setupMass(2);n.name=b.name||" ";this.addRigidBody(n);return n};function getInternetExplorerVersion(){var b=-1;"Microsoft Internet Explorer"==navigator.appName&&null!=/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)&&(b=parseFloat(RegExp.$1));return b}var ie=getInternetExplorerVersion();function getQueryVariable(b){for(var f=window.location.search.substring(1).split("&"),e=0;e<f.length;e++){var c=f[e].split("=");if(decodeURIComponent(c[0])==b)return decodeURIComponent(c[1])}};this.jukebox={};
jukebox.Player=function(b,f){this.id=++jukebox.__jukeboxId;this.origin=f||null;this.settings={};for(var e in this.defaults)this.settings[e]=this.defaults[e];if("[object Object]"===Object.prototype.toString.call(b))for(var c in b)this.settings[c]=b[c];"[object Function]"===Object.prototype.toString.call(jukebox.Manager)&&(jukebox.Manager=new jukebox.Manager);this.resource=this.isPlaying=null;this.resource="[object Object]"===Object.prototype.toString.call(jukebox.Manager)?jukebox.Manager.getPlayableResource(this.settings.resources):this.settings.resources[0]||
null;if(null===this.resource)throw"Your browser can't playback the given resources - or you have missed to include jukebox.Manager";this.__init();return this};jukebox.__jukeboxId=0;
jukebox.Player.prototype={defaults:{resources:[],autoplay:!1,spritemap:{},flashMediaElement:"./swf/FlashMediaElement.swf",timeout:1E3},__addToManager:function(){!0!==this.__wasAddedToManager&&(jukebox.Manager.add(this),this.__wasAddedToManager=!0)},__init:function(){var b=this,f=this.settings,e={},c;jukebox.Manager&&void 0!==jukebox.Manager.features&&(e=jukebox.Manager.features);if(!0===e.html5audio){this.context=new Audio;this.context.src=this.resource;if(null===this.origin){var d=function(c){b.__addToManager(c)};
this.context.addEventListener("canplaythrough",d,!0);window.setTimeout(function(){b.context.removeEventListener("canplaythrough",d,!0);d("timeout")},f.timeout)}this.context.autobuffer=!0;this.context.preload=!0;for(c in this.HTML5API)this[c]=this.HTML5API[c];1<e.channels?!0===f.autoplay?this.context.autoplay=!0:void 0!==f.spritemap[f.autoplay]&&this.play(f.autoplay):1===e.channels&&void 0!==f.spritemap[f.autoplay]&&(this.backgroundMusic=f.spritemap[f.autoplay],this.backgroundMusic.started=Date.now?
Date.now():+new Date,this.play(f.autoplay));1==e.channels&&!0!==f.canPlayBackground&&(window.addEventListener("pagehide",function(){null!==b.isPlaying&&(b.pause(),b.__wasAutoPaused=!0)}),window.addEventListener("pageshow",function(){b.__wasAutoPaused&&(b.resume(),delete b._wasAutoPaused)}))}else if(!0===e.flashaudio){for(c in this.FLASHAPI)this[c]=this.FLASHAPI[c];e=["id=jukebox-flashstream-"+this.id,"autoplay="+f.autoplay,"file="+window.encodeURIComponent(this.resource)];this.__initFlashContext(e);
!0===f.autoplay?this.play(0):f.spritemap[f.autoplay]&&this.play(f.autoplay)}else throw"Your Browser does not support Flash Audio or HTML5 Audio.";},__initFlashContext:function(b){var f,e=this.settings.flashMediaElement,c,d={flashvars:b.join("&"),quality:"high",bgcolor:"#000000",wmode:"transparent",allowscriptaccess:"always",allowfullscreen:"true"};if(navigator.userAgent.match(/MSIE/)){f=document.createElement("div");document.getElementsByTagName("body")[0].appendChild(f);var g=document.createElement("object");
g.id="jukebox-flashstream-"+this.id;g.setAttribute("type","application/x-shockwave-flash");g.setAttribute("classid","clsid:d27cdb6e-ae6d-11cf-96b8-444553540000");g.setAttribute("width","0");g.setAttribute("height","0");d.movie=e+"?x="+(Date.now?Date.now():+new Date);d.flashvars=b.join("&amp;");for(c in d)b=document.createElement("param"),b.setAttribute("name",c),b.setAttribute("value",d[c]),g.appendChild(b);f.outerHTML=g.outerHTML;this.context=document.getElementById("jukebox-flashstream-"+this.id)}else{f=
document.createElement("embed");f.id="jukebox-flashstream-"+this.id;f.setAttribute("type","application/x-shockwave-flash");f.setAttribute("width","100");f.setAttribute("height","100");d.play=!1;d.loop=!1;d.src=e+"?x="+(Date.now?Date.now():+new Date);for(c in d)f.setAttribute(c,d[c]);document.getElementsByTagName("body")[0].appendChild(f);this.context=f}},backgroundHackForiOS:function(){if(void 0!==this.backgroundMusic){var b=Date.now?Date.now():+new Date;void 0===this.backgroundMusic.started?(this.backgroundMusic.started=
b,this.setCurrentTime(this.backgroundMusic.start)):(this.backgroundMusic.lastPointer=(b-this.backgroundMusic.started)/1E3%(this.backgroundMusic.end-this.backgroundMusic.start)+this.backgroundMusic.start,this.play(this.backgroundMusic.lastPointer))}},play:function(b,f){if(null!==this.isPlaying&&!0!==f)void 0!==jukebox.Manager&&jukebox.Manager.addToQueue(b,this.id);else{var e=this.settings.spritemap,c;if(void 0!==e[b])c=e[b].start;else if("number"===typeof b){c=b;for(var d in e)if(c>=e[d].start&&c<=
e[d].end){b=d;break}}void 0!==c&&"[object Object]"===Object.prototype.toString.call(e[b])&&(this.isPlaying=this.settings.spritemap[b],this.context.play&&this.context.play(),this.wasReady=this.setCurrentTime(c))}},stop:function(){this.__lastPosition=0;this.isPlaying=null;this.backgroundMusic?this.backgroundHackForiOS():this.context.pause();return!0},pause:function(){this.isPlaying=null;this.__lastPosition=this.getCurrentTime();this.context.pause();return this.__lastPosition},resume:function(b){b="number"===
typeof b?b:this.__lastPosition;if(null!==b)return this.play(b),this.__lastPosition=null,!0;this.context.play();return!1},HTML5API:{getVolume:function(){return this.context.volume||1},setVolume:function(b){this.context.volume=b;return 1E-4>Math.abs(this.context.volume-b)?!0:!1},getCurrentTime:function(){return this.context.currentTime||0},setCurrentTime:function(b){try{return this.context.currentTime=b,!0}catch(f){return!1}}},FLASHAPI:{getVolume:function(){return this.context&&"function"===typeof this.context.getVolume?
this.context.getVolume():1},setVolume:function(b){return this.context&&"function"===typeof this.context.setVolume?(this.context.setVolume(b),!0):!1},getCurrentTime:function(){return this.context&&"function"===typeof this.context.getCurrentTime?this.context.getCurrentTime():0},setCurrentTime:function(b){return this.context&&"function"===typeof this.context.setCurrentTime?this.context.setCurrentTime(b):!1}}};
if(void 0===this.jukebox)throw"jukebox.Manager requires jukebox.Player (Player.js) to run properly.";
jukebox.Manager=function(b){this.features={};this.codecs={};this.__players={};this.__playersLength=0;this.__clones={};this.__queue=[];this.settings={};for(var f in this.defaults)this.settings[f]=this.defaults[f];if("[object Object]"===Object.prototype.toString.call(b))for(var e in b)this.settings[e]=b[e];this.__detectFeatures();jukebox.Manager.__initialized=!1===this.settings.useGameLoop?window.setInterval(function(){jukebox.Manager.loop()},20):!0};
jukebox.Manager.prototype={defaults:{useFlash:!1,useGameLoop:!1},__detectFeatures:function(){var b=window.Audio&&new Audio;if(b&&b.canPlayType&&!1===this.settings.useFlash){for(var f=[{e:"3gp",m:["audio/3gpp","audio/amr"]},{e:"aac",m:["audio/aac","audio/aacp"]},{e:"amr",m:["audio/amr","audio/3gpp"]},{e:"caf",m:["audio/IMA-ADPCM","audio/x-adpcm",'audio/x-aiff; codecs="IMA-ADPCM, ADPCM"']},{e:"m4a",m:'audio/mp4{audio/mp4; codecs="mp4a.40.2,avc1.42E01E"{audio/mpeg4{audio/mpeg4-generic{audio/mp4a-latm{audio/MP4A-LATM{audio/x-m4a'.split("{")},
{e:"mp3",m:["audio/mp3","audio/mpeg",'audio/mpeg; codecs="mp3"',"audio/MPA","audio/mpa-robust"]},{e:"mpga",m:["audio/MPA","audio/mpa-robust","audio/mpeg","video/mpeg"]},{e:"mp4",m:["audio/mp4","video/mp4"]},{e:"ogg",m:["application/ogg","audio/ogg",'audio/ogg; codecs="theora, vorbis"',"video/ogg",'video/ogg; codecs="theora, vorbis"']},{e:"wav",m:["audio/wave","audio/wav",'audio/wav; codecs="1"',"audio/x-wav","audio/x-pn-wav"]},{e:"webm",m:["audio/webm",'audio/webm; codecs="vorbis"',"video/webm"]}],
e,c,d=0,g=f.length;d<g;d++)if(c=f[d].e,f[d].m.length&&"object"===typeof f[d].m)for(var m=0,j=f[d].m.length;m<j;m++)if(e=f[d].m[m],""!==b.canPlayType(e)){this.codecs[c]=e;break}else this.codecs[c]||(this.codecs[c]=!1);this.features.html5audio=!(!this.codecs.mp3&&!this.codecs.ogg&&!this.codecs.webm&&!this.codecs.wav);this.features.channels=8;b.volume=0.1337;this.features.volume=!!(1E-4>Math.abs(b.volume-0.1337));navigator.userAgent.match(/iPhone|iPod|iPad/i)&&(this.features.channels=1)}this.features.flashaudio=
!!navigator.mimeTypes["application/x-shockwave-flash"]||!!navigator.plugins["Shockwave Flash"]||!1;if(window.ActiveXObject)try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash.10"),this.features.flashaudio=!0}catch(l){}!0===this.settings.useFlash&&(this.features.flashaudio=!0);!0===this.features.flashaudio&&!this.features.html5audio&&(this.codecs.mp3="audio/mp3",this.codecs.mpga="audio/mpeg",this.codecs.mp4="audio/mp4",this.codecs.m4a="audio/mp4",this.codecs["3gp"]="audio/3gpp",this.codecs.amr="audio/amr",
this.features.volume=!0,this.features.channels=1)},__getPlayerById:function(b){return this.__players&&void 0!==this.__players[b]?this.__players[b]:null},__getClone:function(b,f){for(var e in this.__clones){var c=this.__clones[e];if(null===c.isPlaying&&c.origin===b)return c}if("[object Object]"===Object.prototype.toString.call(f)){e={};for(var d in f)e[d]=f[d];e.autoplay=!1;d=new jukebox.Player(e,b);d.isClone=!0;d.wasReady=!1;return this.__clones[d.id]=d}return null},loop:function(){if(0!==this.__playersLength)if(this.__queue.length&&
this.__playersLength<this.features.channels){var b=this.__queue[0],f=this.__getPlayerById(b.origin);if(null!==f){var e=this.__getClone(b.origin,f.settings);null!==e&&(!0===this.features.volume&&(f=this.__players[b.origin])&&e.setVolume(f.getVolume()),this.add(e),e.play(b.pointer,!0))}this.__queue.splice(0,1)}else for(e in this.__queue.length&&1===this.features.channels&&(b=this.__queue[0],f=this.__getPlayerById(b.origin),null!==f&&f.play(b.pointer,!0),this.__queue.splice(0,1)),this.__players)b=this.__players[e],
f=b.getCurrentTime()||0,b.isPlaying&&!1===b.wasReady?b.wasReady=b.setCurrentTime(b.isPlaying.start):b.isPlaying&&!0===b.wasReady?f>b.isPlaying.end&&(!0===b.isPlaying.loop?b.play(b.isPlaying.start,!0):b.stop()):b.isClone&&null===b.isPlaying?this.remove(b):void 0!==b.backgroundMusic&&null===b.isPlaying&&f>b.backgroundMusic.end&&b.backgroundHackForiOS()},getPlayableResource:function(b){"[object Array]"!==Object.prototype.toString.call(b)&&(b=[b]);for(var f=0,e=b.length;f<e;f++){var c=b[f],d=c.match(/\.([^\.]*)$/)[1];
if(d&&this.codecs[d])return c}return null},add:function(b){return b instanceof jukebox.Player&&void 0===this.__players[b.id]?(this.__playersLength++,this.__players[b.id]=b,!0):!1},remove:function(b){return b instanceof jukebox.Player&&void 0!==this.__players[b.id]?(this.__playersLength--,delete this.__players[b.id],!0):!1},addToQueue:function(b,f){return("string"===typeof b||"number"===typeof b)&&void 0!==this.__players[f]?(this.__queue.push({pointer:b,origin:f}),!0):!1}};(function(){var b={},f=null,e=!0,c=!1;try{"undefined"!==typeof AudioContext?f=new AudioContext:"undefined"!==typeof webkitAudioContext?f=new webkitAudioContext:e=!1}catch(d){e=!1}if(!e)if("undefined"!==typeof Audio)try{new Audio}catch(g){c=!0}else c=!0;if(e){var m="undefined"===typeof f.createGain?f.createGainNode():f.createGain();m.gain.value=1;m.connect(f.destination)}var j=function(b){this._volume=1;this._muted=!1;this.usingWebAudio=e;this.ctx=f;this.noAudio=c;this._howls=[];this._codecs=b;this.iOSAutoEnable=
!0};j.prototype={volume:function(b){b=parseFloat(b);if(0<=b&&1>=b){this._volume=b;e&&(m.gain.value=b);for(var c in this._howls)if(this._howls.hasOwnProperty(c)&&!1===this._howls[c]._webAudio)for(b=0;b<this._howls[c]._audioNode.length;b++)this._howls[c]._audioNode[b].volume=this._howls[c]._volume*this._volume;return this}return e?m.gain.value:this._volume},mute:function(){this._setMuted(!0);return this},unmute:function(){this._setMuted(!1);return this},_setMuted:function(b){this._muted=b;e&&(m.gain.value=
b?0:this._volume);for(var c in this._howls)if(this._howls.hasOwnProperty(c)&&!1===this._howls[c]._webAudio)for(var d=0;d<this._howls[c]._audioNode.length;d++)this._howls[c]._audioNode[d].muted=b},codecs:function(b){return this._codecs[b]},_enableiOSAudio:function(){var b=this;if(!f||!b._iOSEnabled&&/iPhone|iPad|iPod/i.test(navigator.userAgent)){b._iOSEnabled=!1;var c=function(){var d=f.createBuffer(1,1,22050),e=f.createBufferSource();e.buffer=d;e.connect(f.destination);"undefined"===typeof e.start?
e.noteOn(0):e.start(0);setTimeout(function(){if(e.playbackState===e.PLAYING_STATE||e.playbackState===e.FINISHED_STATE)b._iOSEnabled=!0,b.iOSAutoEnable=!1,window.removeEventListener("touchend",c,!1)},0)};window.addEventListener("touchend",c,!1);return b}}};var l=null,n={};c||(l=new Audio,n={mp3:!!l.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!l.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!l.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!l.canPlayType('audio/wav; codecs="1"').replace(/^no$/,
""),aac:!!l.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(l.canPlayType("audio/x-m4a;")||l.canPlayType("audio/m4a;")||l.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(l.canPlayType("audio/x-mp4;")||l.canPlayType("audio/mp4;")||l.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!l.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")});var q=new j(n),p=function(b){this._autoplay=b.autoplay||!1;this._buffer=b.buffer||!1;this._duration=b.duration||0;this._format=b.format||null;
this._loop=b.loop||!1;this._loaded=!1;this._sprite=b.sprite||{};this._src=b.src||"";this._pos3d=b.pos3d||[0,0,-0.5];this._volume=void 0!==b.volume?b.volume:1;this._urls=b.urls||[];this._rate=b.rate||1;this._model=b.model||null;this._onload=[b.onload||function(){}];this._onloaderror=[b.onloaderror||function(){}];this._onend=[b.onend||function(){}];this._onpause=[b.onpause||function(){}];this._onplay=[b.onplay||function(){}];this._onendTimer=[];this._webAudio=e&&!this._buffer;this._audioNode=[];this._webAudio&&
this._setupAudioNode();"undefined"!==typeof f&&(f&&q.iOSAutoEnable)&&q._enableiOSAudio();q._howls.push(this);this.load()};p.prototype={load:function(){var d=this,e=null;if(c)d.on("loaderror",Error("No audio support."));else{for(var f=0;f<d._urls.length;f++){var g,l;if(d._format)g=d._format;else if(l=d._urls[f],(g=/^data:audio\/([^;,]+);/i.exec(l))||(g=/\.([^.]+)$/.exec(l.split("?",1)[0])),g)g=g[1].toLowerCase();else{d.on("loaderror",Error("Could not extract format from passed URLs, please add format parameter."));
return}if(n[g]){e=d._urls[f];break}}if(e){d._src=e;if(d._webAudio){var m=e;if(m in b)d._duration=b[m].duration,t(d);else if(/^data:[^;]+;base64,/.test(m)){e=atob(m.split(",")[1]);f=new Uint8Array(e.length);for(g=0;g<e.length;++g)f[g]=e.charCodeAt(g);r(f.buffer,d,m)}else{var p=new XMLHttpRequest;p.open("GET",m,!0);p.responseType="arraybuffer";p.onload=function(){r(p.response,d,m)};p.onerror=function(){d._webAudio&&(d._buffer=!0,d._webAudio=!1,d._audioNode=[],delete d._gainNode,delete b[m],d.load())};
try{p.send()}catch(C){p.onerror()}}}else{var D=new Audio;D.addEventListener("error",function(){D.error&&4===D.error.code&&(j.noAudio=!0);d.on("loaderror",{type:D.error?D.error.code:0})},!1);d._audioNode.push(D);D.src=e;D._pos=0;D.preload="auto";D.volume=q._muted?0:d._volume*q.volume();var E=function(){d._duration=Math.ceil(10*D.duration)/10;0===Object.getOwnPropertyNames(d._sprite).length&&(d._sprite={_default:[0,1E3*d._duration]});d._loaded||(d._loaded=!0,d.on("load"));d._autoplay&&d.play();D.removeEventListener("canplaythrough",
E,!1)};D.addEventListener("canplaythrough",E,!1);D.load()}return d}d.on("loaderror",Error("No codec support for selected audio sources."))}},urls:function(b){return b?(this.stop(),this._urls="string"===typeof b?[b]:b,this._loaded=!1,this.load(),this):this._urls},play:function(c,d){var e=this;"function"===typeof c&&(d=c);if(!c||"function"===typeof c)c="_default";if(!e._loaded)return e.on("load",function(){e.play(c,d)}),e;if(!e._sprite[c])return"function"===typeof d&&d(),e;e._inactiveNode(function(g){g._sprite=
c;var j=0<g._pos?g._pos:e._sprite[c][0]/1E3,l=0;e._webAudio?(l=e._sprite[c][1]/1E3-g._pos,0<g._pos&&(j=e._sprite[c][0]/1E3+j)):l=e._sprite[c][1]/1E3-(j-e._sprite[c][0]/1E3);var m=!(!e._loop&&!e._sprite[c][2]),n="string"===typeof d?d:Math.round(Date.now()*Math.random())+"",p;p=setTimeout(function(){!e._webAudio&&m&&e.stop(n).play(c,n);e._webAudio&&!m&&(e._nodeById(n).paused=!0,e._nodeById(n)._pos=0,e._clearEndTimer(n));!e._webAudio&&!m&&e.stop(n);e.on("end",n)},1E3*(l/e._rate));e._onendTimer.push({timer:p,
id:n});if(e._webAudio){p=e._sprite[c][0]/1E3;var r=e._sprite[c][1]/1E3;g.id=n;g.paused=!1;p=[m,p,r];r=e._nodeById(n);r.bufferSource=f.createBufferSource();r.bufferSource.buffer=b[e._src];r.bufferSource.connect(r.panner);r.bufferSource.loop=p[0];p[0]&&(r.bufferSource.loopStart=p[1],r.bufferSource.loopEnd=p[1]+p[2]);r.bufferSource.playbackRate.value=e._rate;e._playStart=f.currentTime;g.gain.value=e._volume;"undefined"===typeof g.bufferSource.start?m?g.bufferSource.noteGrainOn(0,j,86400):g.bufferSource.noteGrainOn(0,
j,l):m?g.bufferSource.start(0,j,86400):g.bufferSource.start(0,j,l)}else if(4===g.readyState||!g.readyState&&navigator.isCocoonJS)g.readyState=4,g.id=n,g.currentTime=j,g.muted=q._muted||g.muted,g.volume=e._volume*q.volume(),setTimeout(function(){g.play()},0);else{e._clearEndTimer(n);var t=c,H=d,F=function(){e.play(t,H);g.removeEventListener("canplaythrough",F,!1)};g.addEventListener("canplaythrough",F,!1);return e}e.on("play");"function"===typeof d&&d(n);return e});return e},pause:function(b){var c=
this;if(!c._loaded)return c.on("play",function(){c.pause(b)}),c;c._clearEndTimer(b);var d=b?c._nodeById(b):c._activeNode();if(d)if(d._pos=c.pos(null,b),c._webAudio){if(!d.bufferSource||d.paused)return c;d.paused=!0;"undefined"===typeof d.bufferSource.stop?d.bufferSource.noteOff(0):d.bufferSource.stop(0)}else d.pause();c.on("pause");return c},stop:function(b){var c=this;if(!c._loaded)return c.on("play",function(){c.stop(b)}),c;c._clearEndTimer(b);var d=b?c._nodeById(b):c._activeNode();if(d)if(d._pos=
0,c._webAudio){if(!d.bufferSource||d.paused)return c;d.paused=!0;"undefined"===typeof d.bufferSource.stop?d.bufferSource.noteOff(0):d.bufferSource.stop(0)}else isNaN(d.duration)||(d.pause(),d.currentTime=0);return c},mute:function(b){var c=this;if(!c._loaded)return c.on("play",function(){c.mute(b)}),c;var d=b?c._nodeById(b):c._activeNode();d&&(c._webAudio?d.gain.value=0:d.muted=!0);return c},unmute:function(b){var c=this;if(!c._loaded)return c.on("play",function(){c.unmute(b)}),c;var d=b?c._nodeById(b):
c._activeNode();d&&(c._webAudio?d.gain.value=c._volume:d.muted=!1);return c},volume:function(b,c){var d=this;b=parseFloat(b);if(0<=b&&1>=b){d._volume=b;if(!d._loaded)return d.on("play",function(){d.volume(b,c)}),d;var e=c?d._nodeById(c):d._activeNode();e&&(d._webAudio?e.gain.value=b:e.volume=b*q.volume());return d}return d._volume},loop:function(b){return"boolean"===typeof b?(this._loop=b,this):this._loop},sprite:function(b){return"object"===typeof b?(this._sprite=b,this):this._sprite},pos:function(b,
c){var d=this;if(!d._loaded)return d.on("load",function(){d.pos(b)}),"number"===typeof b?d:d._pos||0;b=parseFloat(b);var e=c?d._nodeById(c):d._activeNode();if(e)return 0<=b?(d.pause(c),e._pos=b,d.play(e._sprite,c),d):d._webAudio?e._pos+(f.currentTime-d._playStart):e.currentTime;if(0<=b)return d;for(e=0;e<d._audioNode.length;e++)if(d._audioNode[e].paused&&4===d._audioNode[e].readyState)return d._webAudio?d._audioNode[e]._pos:d._audioNode[e].currentTime},pos3d:function(b,c,d,e){var f=this;c="undefined"===
typeof c||!c?0:c;d="undefined"===typeof d||!d?-0.5:d;if(!f._loaded)return f.on("play",function(){f.pos3d(b,c,d,e)}),f;if(0<=b||0>b){if(f._webAudio){var g=e?f._nodeById(e):f._activeNode();g&&(f._pos3d=[b,c,d],g.panner.setPosition(b,c,d),g.panner.panningModel=f._model||"HRTF")}}else return f._pos3d;return f},fade:function(b,c,d,e,f){var g=this,j=Math.abs(b-c),l=b>c?"down":"up",j=j/0.01,m=d/j;if(!g._loaded)return g.on("load",function(){g.fade(b,c,d,e,f)}),g;g.volume(b,f);for(var n=1;n<=j;n++)(function(){var b=
Math.round(1E3*(g._volume+("up"===l?0.01:-0.01)*n))/1E3;setTimeout(function(){g.volume(b,f);b===c&&e&&e()},m*n)})()},fadeIn:function(b,c,d){return this.volume(0).play().fade(0,b,c,d)},fadeOut:function(b,c,d,e){var f=this;return f.fade(f._volume,b,c,function(){d&&d();f.pause(e);f.on("end")},e)},_nodeById:function(b){for(var c=this._audioNode[0],d=0;d<this._audioNode.length;d++)if(this._audioNode[d].id===b){c=this._audioNode[d];break}return c},_activeNode:function(){for(var b=null,c=0;c<this._audioNode.length;c++)if(!this._audioNode[c].paused){b=
this._audioNode[c];break}this._drainPool();return b},_inactiveNode:function(b){for(var c=null,d=0;d<this._audioNode.length;d++)if(this._audioNode[d].paused&&4===this._audioNode[d].readyState){b(this._audioNode[d]);c=!0;break}this._drainPool();if(!c){var e;if(this._webAudio)e=this._setupAudioNode(),b(e);else{this.load();e=this._audioNode[this._audioNode.length-1];var f=navigator.isCocoonJS?"canplaythrough":"loadedmetadata",g=function(){e.removeEventListener(f,g,!1);b(e)};e.addEventListener(f,g,!1)}}},
_drainPool:function(){var b=0,c;for(c=0;c<this._audioNode.length;c++)this._audioNode[c].paused&&b++;for(c=this._audioNode.length-1;0<=c&&!(5>=b);c--)this._audioNode[c].paused&&(this._webAudio&&this._audioNode[c].disconnect(0),b--,this._audioNode.splice(c,1))},_clearEndTimer:function(b){for(var c=-1,d=0;d<this._onendTimer.length;d++)if(this._onendTimer[d].id===b){c=d;break}if(b=this._onendTimer[c])clearTimeout(b.timer),this._onendTimer.splice(c,1)},_setupAudioNode:function(){var b=this._audioNode,
c=this._audioNode.length;b[c]="undefined"===typeof f.createGain?f.createGainNode():f.createGain();b[c].gain.value=this._volume;b[c].paused=!0;b[c]._pos=0;b[c].readyState=4;b[c].connect(m);b[c].panner=f.createPanner();b[c].panner.panningModel=this._model||"equalpower";b[c].panner.setPosition(this._pos3d[0],this._pos3d[1],this._pos3d[2]);b[c].panner.connect(b[c]);return b[c]},on:function(b,c){var d=this["_on"+b];if("function"===typeof c)d.push(c);else for(var e=0;e<d.length;e++)c?d[e].call(this,c):
d[e].call(this);return this},off:function(b,c){var d=this["_on"+b];if(c)for(var e=0;e<d.length;e++){if(c===d[e]){d.splice(e,1);break}}else this["_on"+b]=[];return this},unload:function(){for(var c=this._audioNode,d=0;d<this._audioNode.length;d++)c[d].paused||(this.stop(c[d].id),this.on("end",c[d].id)),this._webAudio?c[d].disconnect(0):c[d].src="";for(d=0;d<this._onendTimer.length;d++)clearTimeout(this._onendTimer[d].timer);c=q._howls.indexOf(this);null!==c&&0<=c&&q._howls.splice(c,1);delete b[this._src]}};
if(e)var r=function(c,d,e){f.decodeAudioData(c,function(c){c&&(b[e]=c,t(d,c))},function(b){d.on("loaderror",b)})},t=function(b,c){b._duration=c?c.duration:b._duration;0===Object.getOwnPropertyNames(b._sprite).length&&(b._sprite={_default:[0,1E3*b._duration]});b._loaded||(b._loaded=!0,b.on("load"));b._autoplay&&b.play()};"function"===typeof define&&define.amd&&define(function(){return{Howler:q,Howl:p}});"undefined"!==typeof exports&&(exports.Howler=q,exports.Howl=p);"undefined"!==typeof window&&(window.Howler=
q,window.Howl=p)})();(function(b){Number.prototype.map=function(b,c,d,e){return d+(e-d)*((this-b)/(c-b))};Number.prototype.limit=function(b,c){return Math.min(c,Math.max(b,this))};Number.prototype.round=function(b){b=Math.pow(10,b||0);return Math.round(this*b)/b};Number.prototype.floor=function(){return Math.floor(this)};Number.prototype.ceil=function(){return Math.ceil(this)};Number.prototype.toInt=function(){return this|0};Number.prototype.toRad=function(){return this/180*Math.PI};Number.prototype.toDeg=function(){return 180*
this/Math.PI};Array.prototype.erase=function(b){for(var c=this.length;c--;)this[c]===b&&this.splice(c,1);return this};Array.prototype.random=function(){return this[Math.floor(Math.random()*this.length)]};Function.prototype.bind=Function.prototype.bind||function(b){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var c=Array.prototype.slice.call(arguments,1),d=this,e=function(){},f=function(){return d.apply(this instanceof e&&b?
this:b,c.concat(Array.prototype.slice.call(arguments)))};e.prototype=this.prototype;f.prototype=new e;return f};b.ig={game:null,debug:null,version:"1.23",global:b,modules:{},resources:[],ready:!1,baked:!1,nocache:"",ua:{},prefix:b.ImpactPrefix||"",lib:"lib/",_current:null,_loadQueue:[],_waitForOnload:0,$:function(b){return"#"==b.charAt(0)?document.getElementById(b.substr(1)):document.getElementsByTagName(b)},$new:function(b){return document.createElement(b)},copy:function(b){if(!b||"object"!=typeof b||
b instanceof HTMLElement||b instanceof ig.Class)return b;if(b instanceof Array)for(var c=[],d=0,e=b.length;d<e;d++)c[d]=ig.copy(b[d]);else for(d in c={},b)c[d]=ig.copy(b[d]);return c},merge:function(b,c){for(var d in c){var e=c[d];if("object"!=typeof e||e instanceof HTMLElement||e instanceof ig.Class||null===e)b[d]=e;else{if(!b[d]||"object"!=typeof b[d])b[d]=e instanceof Array?[]:{};ig.merge(b[d],e)}}return b},ksort:function(b){if(!b||"object"!=typeof b)return[];var c=[],d=[],e;for(e in b)c.push(e);
c.sort();for(e=0;e<c.length;e++)d.push(b[c[e]]);return d},setVendorAttribute:function(b,c,d){var e=c.charAt(0).toUpperCase()+c.substr(1);b[c]="undefined"!==typeof b.imageSmoothingEnabled?b["ms"+e]=b["moz"+e]=b["o"+e]=d:b["ms"+e]=b["moz"+e]=b["webkit"+e]=b["o"+e]=d},getVendorAttribute:function(b,c){var d=c.charAt(0).toUpperCase()+c.substr(1);return"undefined"!==typeof b.imageSmoothingEnabled?b[c]||b["ms"+d]||b["moz"+d]||b["o"+d]:b[c]||b["ms"+d]||b["moz"+d]||b["webkit"+d]||b["o"+d]},normalizeVendorAttribute:function(b,
c){var d=ig.getVendorAttribute(b,c);!b[c]&&d&&(b[c]=d)},getImagePixels:function(b,c,d,e,f){var g=ig.$new("canvas");g.width=b.width;g.height=b.height;var m=g.getContext("2d");ig.System.SCALE.CRISP(g,m);var s=ig.getVendorAttribute(m,"backingStorePixelRatio")||1;ig.normalizeVendorAttribute(m,"getImageDataHD");var u=b.width/s,x=b.height/s;g.width=Math.ceil(u);g.height=Math.ceil(x);m.drawImage(b,0,0,u,x);return 1===s?m.getImageData(c,d,e,f):m.getImageDataHD(c,d,e,f)},module:function(b){if(ig._current)throw"Module '"+
ig._current.name+"' defines nothing";if(ig.modules[b]&&ig.modules[b].body)throw"Module '"+b+"' is already defined";ig._current={name:b,requires:[],loaded:!1,body:null};ig.modules[b]=ig._current;ig._loadQueue.push(ig._current);return ig},requires:function(){ig._current.requires=Array.prototype.slice.call(arguments);return ig},defines:function(b){ig._current.body=b;ig._current=null;ig._initDOMReady()},addResource:function(b){ig.resources.push(b)},setNocache:function(b){ig.nocache=b?"?"+Date.now():""},
log:function(){},assert:function(){},show:function(){},mark:function(){},_loadScript:function(b,c){ig.modules[b]={name:b,requires:[],loaded:!1,body:null};ig._waitForOnload++;var d=ig.prefix+ig.lib+b.replace(/\./g,"/")+".js"+ig.nocache,e=ig.$new("script");e.type="text/javascript";e.src=d;e.onload=function(){ig._waitForOnload--;ig._execModules()};e.onerror=function(){throw"Failed to load module "+b+" at "+d+" required from "+c;};ig.$("head")[0].appendChild(e)},_execModules:function(){for(var b=!1,c=
0;c<ig._loadQueue.length;c++){for(var d=ig._loadQueue[c],e=!0,f=0;f<d.requires.length;f++){var g=d.requires[f];ig.modules[g]?ig.modules[g].loaded||(e=!1):(e=!1,ig._loadScript(g,d.name))}e&&d.body&&(ig._loadQueue.splice(c,1),d.loaded=!0,d.body(),b=!0,c--)}if(b)ig._execModules();else if(!ig.baked&&0==ig._waitForOnload&&0!=ig._loadQueue.length){b=[];for(c=0;c<ig._loadQueue.length;c++){e=[];g=ig._loadQueue[c].requires;for(f=0;f<g.length;f++)d=ig.modules[g[f]],(!d||!d.loaded)&&e.push(g[f]);b.push(ig._loadQueue[c].name+
" (requires: "+e.join(", ")+")")}throw"Unresolved (or circular?) dependencies. Most likely there's a name/path mismatch for one of the listed modules or a previous syntax error prevents a module from loading:\n"+b.join("\n");}},_DOMReady:function(){if(!ig.modules["dom.ready"].loaded){if(!document.body)return setTimeout(ig._DOMReady,13);ig.modules["dom.ready"].loaded=!0;ig._waitForOnload--;ig._execModules()}return 0},_boot:function(){document.location.href.match(/\?nocache/)&&ig.setNocache(!0);ig.ua.pixelRatio=
b.devicePixelRatio||1;ig.ua.viewport={width:b.innerWidth,height:b.innerHeight};ig.ua.screen={width:b.screen.availWidth*ig.ua.pixelRatio,height:b.screen.availHeight*ig.ua.pixelRatio};ig.ua.iPhone=/iPhone/i.test(navigator.userAgent);ig.ua.iPhone4=ig.ua.iPhone&&2==ig.ua.pixelRatio;ig.ua.iPad=/iPad/i.test(navigator.userAgent);ig.ua.android=/android/i.test(navigator.userAgent);ig.ua.winPhone=/Windows Phone/i.test(navigator.userAgent);ig.ua.is_uiwebview=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);
ig.ua.is_safari_or_uiwebview=/(iPhone|iPod|iPad).*AppleWebKit/i.test(navigator.userAgent);ig.ua.iOS=ig.ua.iPhone||ig.ua.iPad;ig.ua.iOS6_tag=/OS 6_/i.test(navigator.userAgent);ig.ua.iOS6=(ig.ua.iPhone||ig.ua.iPad)&&ig.ua.iOS6_tag;ig.ua.iOSgt5=ig.ua.iOS&&5<parseInt(navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/)[1]);ig.ua.HTCONE=/HTC_One/i.test(navigator.userAgent);ig.ua.winPhone=/Windows Phone/i.test(navigator.userAgent);ig.ua.Kindle=/Silk/i.test(navigator.userAgent);ig.ua.touchDevice="ontouchstart"in
b||b.navigator.msMaxTouchPoints;ig.ua.mobile=ig.ua.iOS||ig.ua.android||ig.ua.iOS6||ig.ua.winPhone||ig.ua.Kindle||/mobile/i.test(navigator.userAgent)},_initDOMReady:function(){ig.modules["dom.ready"]?ig._execModules():(ig._boot(),ig.modules["dom.ready"]={requires:[],loaded:!1,body:null},ig._waitForOnload++,"complete"===document.readyState?ig._DOMReady():(document.addEventListener("DOMContentLoaded",ig._DOMReady,!1),b.addEventListener("load",ig._DOMReady,!1)))}};ig.normalizeVendorAttribute(b,"requestAnimationFrame");
if(b.requestAnimationFrame){var f=1,e={};b.ig.setAnimation=function(c,d){var g=f++;e[g]=!0;var m=function(){e[g]&&(b.requestAnimationFrame(m,d),c())};b.requestAnimationFrame(m,d);return g};b.ig.clearAnimation=function(b){delete e[b]}}else b.ig.setAnimation=function(c){return b.setInterval(c,1E3/60)},b.ig.clearAnimation=function(c){b.clearInterval(c)};var c=!1,d=/xyz/.test(function(){xyz})?/\bparent\b/:/.*/,g=0;b.ig.Class=function(){};var m=function(b){var c=this.prototype,e={},f;for(f in b)"function"==
typeof b[f]&&"function"==typeof c[f]&&d.test(b[f])?(e[f]=c[f],c[f]=function(b,c){return function(){var d=this.parent;this.parent=e[b];var f=c.apply(this,arguments);this.parent=d;return f}}(f,b[f])):c[f]=b[f]};b.ig.Class.extend=function(e){function f(){if(!c){if(this.staticInstantiate){var b=this.staticInstantiate.apply(this,arguments);if(b)return b}for(var d in this)"object"==typeof this[d]&&(this[d]=ig.copy(this[d]));this.init&&this.init.apply(this,arguments)}return this}var n=this.prototype;c=!0;
var q=new this;c=!1;for(var p in e)q[p]="function"==typeof e[p]&&"function"==typeof n[p]&&d.test(e[p])?function(b,c){return function(){var d=this.parent;this.parent=n[b];var e=c.apply(this,arguments);this.parent=d;return e}}(p,e[p]):e[p];f.prototype=q;f.prototype.constructor=f;f.extend=b.ig.Class.extend;f.inject=m;f.classId=q.classId=++g;return f};b.ImpactMixin&&ig.merge(ig,b.ImpactMixin)})(window);ig.baked=!0;
ig.module("impact.image").defines(function(){ig.Image=ig.Class.extend({data:null,width:0,height:0,loaded:!1,failed:!1,loadCallback:null,path:"",staticInstantiate:function(b){return ig.Image.cache[b]||null},init:function(b){this.path=b;this.load()},load:function(b){this.loaded?b&&b(this.path,!0):(!this.loaded&&ig.ready?(this.loadCallback=b||null,this.data=new Image,this.data.onload=this.onload.bind(this),this.data.onerror=this.onerror.bind(this),this.data.src=ig.prefix+this.path+ig.nocache):ig.addResource(this),
ig.Image.cache[this.path]=this)},reload:function(){this.loaded=!1;this.data=new Image;this.data.onload=this.onload.bind(this);this.data.src=this.path+"?"+Date.now()},onload:function(){this.width=this.data.width;this.height=this.data.height;this.loaded=!0;1!=ig.system.scale&&this.resize(ig.system.scale);this.loadCallback&&this.loadCallback(this.path,!0)},onerror:function(){this.failed=!0;this.loadCallback&&this.loadCallback(this.path,!1)},resize:function(b){var f=ig.getImagePixels(this.data,0,0,this.width,
this.height),e=this.width*b,c=this.height*b,d=ig.$new("canvas");d.width=e;d.height=c;for(var g=d.getContext("2d"),m=g.getImageData(0,0,e,c),j=0;j<c;j++)for(var l=0;l<e;l++){var n=4*(Math.floor(j/b)*this.width+Math.floor(l/b)),q=4*(j*e+l);m.data[q]=f.data[n];m.data[q+1]=f.data[n+1];m.data[q+2]=f.data[n+2];m.data[q+3]=f.data[n+3]}g.putImageData(m,0,0);this.data=d},draw:function(b,f,e,c,d,g){if(this.loaded){var m=ig.system.scale;d=(d?d:this.width)*m;g=(g?g:this.height)*m;ig.system.context.drawImage(this.data,
e?e*m:0,c?c*m:0,d,g,ig.system.getDrawPos(b),ig.system.getDrawPos(f),d,g);ig.Image.drawCount++}},drawTile:function(b,f,e,c,d,g,m){d=d?d:c;if(this.loaded&&!(c>this.width||d>this.height)){var j=ig.system.scale,l=Math.floor(c*j),n=Math.floor(d*j),q=g?-1:1,p=m?-1:1;if(g||m)ig.system.context.save(),ig.system.context.scale(q,p);ig.system.context.drawImage(this.data,Math.floor(e*c)%this.width*j,Math.floor(e*c/this.width)*d*j,l,n,ig.system.getDrawPos(b)*q-(g?l:0),ig.system.getDrawPos(f)*p-(m?n:0),l,n);(g||
m)&&ig.system.context.restore();ig.Image.drawCount++}}});ig.Image.drawCount=0;ig.Image.cache={};ig.Image.reloadCache=function(){for(var b in ig.Image.cache)ig.Image.cache[b].reload()}});ig.baked=!0;
ig.module("impact.font").requires("impact.image").defines(function(){ig.Font=ig.Image.extend({widthMap:[],indices:[],firstChar:32,alpha:1,letterSpacing:1,lineSpacing:0,onload:function(b){this._loadMetrics(this.data);this.parent(b)},widthForString:function(b){if(-1!==b.indexOf("\n")){b=b.split("\n");for(var f=0,e=0;e<b.length;e++)f=Math.max(f,this._widthForLine(b[e]));return f}return this._widthForLine(b)},_widthForLine:function(b){for(var f=0,e=0;e<b.length;e++)f+=this.widthMap[b.charCodeAt(e)-this.firstChar]+
this.letterSpacing;return f},heightForString:function(b){return b.split("\n").length*(this.height+this.lineSpacing)},draw:function(b,f,e,c){"string"!=typeof b&&(b=b.toString());if(-1!==b.indexOf("\n")){b=b.split("\n");for(var d=this.height+this.lineSpacing,g=0;g<b.length;g++)this.draw(b[g],f,e+g*d,c)}else{if(c==ig.Font.ALIGN.RIGHT||c==ig.Font.ALIGN.CENTER)g=this._widthForLine(b),f-=c==ig.Font.ALIGN.CENTER?g/2:g;1!==this.alpha&&(ig.system.context.globalAlpha=this.alpha);for(g=0;g<b.length;g++)c=b.charCodeAt(g),
f+=this._drawChar(c-this.firstChar,f,e);1!==this.alpha&&(ig.system.context.globalAlpha=1);ig.Image.drawCount+=b.length}},_drawChar:function(b,f,e){if(!this.loaded||0>b||b>=this.indices.length)return 0;var c=ig.system.scale,d=this.widthMap[b]*c,g=(this.height-2)*c;ig.system.context.drawImage(this.data,this.indices[b]*c,0,d,g,ig.system.getDrawPos(f),ig.system.getDrawPos(e),d,g);return this.widthMap[b]+this.letterSpacing},_loadMetrics:function(b){this.height=b.height-1;this.widthMap=[];this.indices=
[];for(var f=ig.getImagePixels(b,0,b.height-1,b.width,1),e=0,c=0,d=0;d<b.width;d++){var g=4*d+3;127<f.data[g]?c++:128>f.data[g]&&c&&(this.widthMap.push(c),this.indices.push(d-c),e++,c=0)}this.widthMap.push(c);this.indices.push(d-c)}});ig.Font.ALIGN={LEFT:0,RIGHT:1,CENTER:2}});ig.baked=!0;
ig.module("impact.sound").defines(function(){ig.SoundManager=ig.Class.extend({clips:{},volume:1,format:null,init:function(){if(!ig.Sound.enabled||!window.Audio)ig.Sound.enabled=!1;else{for(var b=new Audio,f=0;f<ig.Sound.use.length;f++){var e=ig.Sound.use[f];if(b.canPlayType(e.mime)){this.format=e;break}}this.format||(ig.Sound.enabled=!1)}},load:function(b,f,e){var c=ig.prefix+b.replace(/[^\.]+$/,this.format.ext)+ig.nocache;if(this.clips[b]){if(f&&this.clips[b].length<ig.Sound.channels)for(f=this.clips[b].length;f<
ig.Sound.channels;f++){var d=new Audio(c);d.load();this.clips[b].push(d)}return this.clips[b][0]}var g=new Audio(c);e&&(g.addEventListener("canplaythrough",function j(c){g.removeEventListener("canplaythrough",j,!1);e(b,!0,c)},!1),g.addEventListener("error",function(c){e(b,!1,c)},!1));g.preload="auto";g.load();this.clips[b]=[g];if(f)for(f=1;f<ig.Sound.channels;f++)d=new Audio(c),d.load(),this.clips[b].push(d);return g},get:function(b){b=this.clips[b];for(var f=0,e;e=b[f++];)if(e.paused||e.ended)return e.ended&&
(e.currentTime=0),e;b[0].pause();b[0].currentTime=0;return b[0]}});ig.Music=ig.Class.extend({tracks:[],namedTracks:{},currentTrack:null,currentIndex:0,random:!1,_volume:1,_loop:!1,_fadeInterval:0,_fadeTimer:null,_endedCallbackBound:null,init:function(){this._endedCallbackBound=this._endedCallback.bind(this);Object.defineProperty?(Object.defineProperty(this,"volume",{get:this.getVolume.bind(this),set:this.setVolume.bind(this)}),Object.defineProperty(this,"loop",{get:this.getLooping.bind(this),set:this.setLooping.bind(this)})):
this.__defineGetter__&&(this.__defineGetter__("volume",this.getVolume.bind(this)),this.__defineSetter__("volume",this.setVolume.bind(this)),this.__defineGetter__("loop",this.getLooping.bind(this)),this.__defineSetter__("loop",this.setLooping.bind(this)))},add:function(b,f){if(ig.Sound.enabled){var e=ig.soundManager.load(b instanceof ig.Sound?b.path:b,!1);e.loop=this._loop;e.volume=this._volume;e.addEventListener("ended",this._endedCallbackBound,!1);this.tracks.push(e);f&&(this.namedTracks[f]=e);this.currentTrack||
(this.currentTrack=e)}},next:function(){this.tracks.length&&(this.stop(),this.currentIndex=this.random?Math.floor(Math.random()*this.tracks.length):(this.currentIndex+1)%this.tracks.length,this.currentTrack=this.tracks[this.currentIndex],this.play())},pause:function(){this.currentTrack&&this.currentTrack.pause()},stop:function(){this.currentTrack&&(this.currentTrack.pause(),this.currentTrack.currentTime=0)},play:function(b){if(b&&this.namedTracks[b])b=this.namedTracks[b],b!=this.currentTrack&&(this.stop(),
this.currentTrack=b);else if(!this.currentTrack)return;this.currentTrack.play()},getLooping:function(){return this._loop},setLooping:function(b){this._loop=b;for(var f in this.tracks)this.tracks[f].loop=b},getVolume:function(){return this._volume},setVolume:function(b){this._volume=b.limit(0,1);for(var f in this.tracks)this.tracks[f].volume=this._volume},fadeOut:function(b){this.currentTrack&&(clearInterval(this._fadeInterval),this.fadeTimer=new ig.Timer(b),this._fadeInterval=setInterval(this._fadeStep.bind(this),
50))},_fadeStep:function(){var b=this.fadeTimer.delta().map(-this.fadeTimer.target,0,1,0).limit(0,1)*this._volume;0.01>=b?(this.stop(),this.currentTrack.volume=this._volume,clearInterval(this._fadeInterval)):this.currentTrack.volume=b},_endedCallback:function(){this._loop?this.play():this.next()}});ig.Sound=ig.Class.extend({path:"",volume:1,currentClip:null,multiChannel:!0,init:function(b,f){this.path=b;this.multiChannel=!1!==f;this.load()},load:function(b){ig.Sound.enabled?ig.ready?ig.soundManager.load(this.path,
this.multiChannel,b):ig.addResource(this):b&&b(this.path,!0)},play:function(){ig.Sound.enabled&&(this.currentClip=ig.soundManager.get(this.path),this.currentClip.volume=ig.soundManager.volume*this.volume,this.currentClip.play())},stop:function(){this.currentClip&&(this.currentClip.pause(),this.currentClip.currentTime=0)}});ig.Sound.FORMAT={MP3:{ext:"mp3",mime:"audio/mpeg"},M4A:{ext:"m4a",mime:"audio/mp4; codecs=mp4a"},OGG:{ext:"ogg",mime:"audio/ogg; codecs=vorbis"},WEBM:{ext:"webm",mime:"audio/webm; codecs=vorbis"},
CAF:{ext:"caf",mime:"audio/x-caf"}};ig.Sound.use=[ig.Sound.FORMAT.OGG,ig.Sound.FORMAT.MP3];ig.Sound.channels=4;ig.Sound.enabled=!0});ig.baked=!0;
ig.module("impact.loader").requires("impact.image","impact.font","impact.sound").defines(function(){ig.Loader=ig.Class.extend({resources:[],gameClass:null,status:0,done:!1,_unloaded:[],_drawStatus:0,_intervalId:0,_loadCallbackBound:null,init:function(b,f){this.gameClass=b;this.resources=f;this._loadCallbackBound=this._loadCallback.bind(this);for(var e=0;e<this.resources.length;e++)this._unloaded.push(this.resources[e].path)},load:function(){ig.system.clear("#000");if(this.resources.length){for(var b=
0;b<this.resources.length;b++)this.loadResource(this.resources[b]);this._intervalId=setInterval(this.draw.bind(this),16)}else this.end()},loadResource:function(b){b.load(this._loadCallbackBound)},end:function(){this.done||(this.done=!0,clearInterval(this._intervalId))},draw:function(){},_loadCallback:function(b,f){if(f)this._unloaded.erase(b);else throw"Failed to load resource: "+b;this.status=1-this._unloaded.length/this.resources.length;0==this._unloaded.length&&setTimeout(this.end.bind(this),250)}})});
ig.baked=!0;
ig.module("impact.timer").defines(function(){ig.Timer=ig.Class.extend({target:0,base:0,last:0,pausedAt:0,init:function(b){this.last=this.base=ig.Timer.time;this.target=b||0},set:function(b){this.target=b||0;this.base=ig.Timer.time;this.pausedAt=0},reset:function(){this.base=ig.Timer.time;this.pausedAt=0},tick:function(){var b=ig.Timer.time-this.last;this.last=ig.Timer.time;return this.pausedAt?0:b},delta:function(){return(this.pausedAt||ig.Timer.time)-this.base-this.target},pause:function(){this.pausedAt||(this.pausedAt=
ig.Timer.time)},unpause:function(){this.pausedAt&&(this.base+=ig.Timer.time-this.pausedAt,this.pausedAt=0)}});ig.Timer._last=0;ig.Timer.time=Number.MIN_VALUE;ig.Timer.timeScale=1;ig.Timer.maxStep=0.05;ig.Timer.step=function(){var b=Date.now();ig.Timer.time+=Math.min((b-ig.Timer._last)/1E3,ig.Timer.maxStep)*ig.Timer.timeScale;ig.Timer._last=b}});ig.baked=!0;
ig.module("impact.system").requires("impact.timer","impact.image").defines(function(){ig.System=ig.Class.extend({fps:30,width:320,height:240,realWidth:320,realHeight:240,scale:1,tick:0,animationId:0,newGameClass:null,running:!1,delegate:null,clock:null,canvas:null,context:null,init:function(b,f,e,c,d){this.fps=f;this.clock=new ig.Timer;this.canvas=ig.$(b);this.resize(e,c,d);this.context=this.canvas.getContext("2d");this.getDrawPos=ig.System.drawMode;1!=this.scale&&(ig.System.scaleMode=ig.System.SCALE.CRISP);
ig.System.scaleMode(this.canvas,this.context)},resize:function(b,f,e){this.width=b;this.height=f;this.scale=e||this.scale;this.realWidth=this.width*this.scale;this.realHeight=this.height*this.scale;this.canvas.width=this.realWidth;this.canvas.height=this.realHeight},setGame:function(b){this.running?this.newGameClass=b:this.setGameNow(b)},setGameNow:function(b){ig.game=new b;ig.system.setDelegate(ig.game)},setDelegate:function(b){if("function"==typeof b.run)this.delegate=b,this.startRunLoop();else throw"System.setDelegate: No run() function in object";
},stopRunLoop:function(){ig.clearAnimation(this.animationId);this.running=!1},startRunLoop:function(){this.stopRunLoop();this.animationId=ig.setAnimation(this.run.bind(this),this.canvas);this.running=!0},clear:function(b){this.context.fillStyle=b;this.context.fillRect(0,0,this.realWidth,this.realHeight)},run:function(){ig.Timer.step();this.tick=this.clock.tick();this.delegate.run();ig.input.clearPressed();this.newGameClass&&(this.setGameNow(this.newGameClass),this.newGameClass=null)},getDrawPos:null});
ig.System.DRAW={AUTHENTIC:function(b){return Math.round(b)*this.scale},SMOOTH:function(b){return Math.round(b*this.scale)},SUBPIXEL:function(b){return b*this.scale}};ig.System.drawMode=ig.System.DRAW.SMOOTH;ig.System.SCALE={CRISP:function(b,f){ig.setVendorAttribute(f,"imageSmoothingEnabled",!1);b.style.imageRendering="-moz-crisp-edges";b.style.imageRendering="-o-crisp-edges";b.style.imageRendering="-webkit-optimize-contrast";b.style.imageRendering="crisp-edges";b.style.msInterpolationMode="nearest-neighbor"},
SMOOTH:function(b,f){ig.setVendorAttribute(f,"imageSmoothingEnabled",!0);b.style.imageRendering="";b.style.msInterpolationMode=""}};ig.System.scaleMode=ig.System.SCALE.SMOOTH});ig.baked=!0;
ig.module("impact.input").defines(function(){ig.KEY={MOUSE1:-1,MOUSE2:-3,MWHEEL_UP:-4,MWHEEL_DOWN:-5,BACKSPACE:8,TAB:9,ENTER:13,PAUSE:19,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,_0:48,_1:49,_2:50,_3:51,_4:52,_5:53,_6:54,_7:55,_8:56,_9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,
NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SHIFT:16,CTRL:17,ALT:18,PLUS:187,COMMA:188,MINUS:189,PERIOD:190};ig.Input=ig.Class.extend({bindings:{},actions:{},presses:{},locks:{},delayedKeyup:{},isUsingMouse:!1,isUsingKeyboard:!1,isUsingAccelerometer:!1,mouse:{x:0,y:0},accel:{x:0,y:0,z:0},initMouse:function(){if(!this.isUsingMouse){this.isUsingMouse=
!0;var b=this.mousewheel.bind(this);ig.system.canvas.addEventListener("mousewheel",b,!1);ig.system.canvas.addEventListener("DOMMouseScroll",b,!1);ig.system.canvas.addEventListener("contextmenu",this.contextmenu.bind(this),!1);ig.system.canvas.addEventListener("mousedown",this.keydown.bind(this),!1);ig.system.canvas.addEventListener("mouseup",this.keyup.bind(this),!1);ig.system.canvas.addEventListener("mousemove",this.mousemove.bind(this),!1);ig.ua.touchDevice&&(ig.system.canvas.addEventListener("touchstart",
this.keydown.bind(this),!1),ig.system.canvas.addEventListener("touchend",this.keyup.bind(this),!1),ig.system.canvas.addEventListener("touchmove",this.mousemove.bind(this),!1),ig.system.canvas.addEventListener("MSPointerDown",this.keydown.bind(this),!1),ig.system.canvas.addEventListener("MSPointerUp",this.keyup.bind(this),!1),ig.system.canvas.addEventListener("MSPointerMove",this.mousemove.bind(this),!1),ig.system.canvas.style.msTouchAction="none")}},initKeyboard:function(){this.isUsingKeyboard||(this.isUsingKeyboard=
!0,window.addEventListener("keydown",this.keydown.bind(this),!1),window.addEventListener("keyup",this.keyup.bind(this),!1))},initAccelerometer:function(){this.isUsingAccelerometer||window.addEventListener("devicemotion",this.devicemotion.bind(this),!1)},mousewheel:function(b){var f=this.bindings[0<(b.wheelDelta?b.wheelDelta:-1*b.detail)?ig.KEY.MWHEEL_UP:ig.KEY.MWHEEL_DOWN];f&&(this.actions[f]=!0,this.presses[f]=!0,this.delayedKeyup[f]=!0,b.stopPropagation(),b.preventDefault())},mousemove:function(b){var f=
parseInt(ig.system.canvas.offsetWidth)||ig.system.realWidth;ig.ua.mobile&&(f=ig.system.realWidth);var f=ig.system.scale*(f/ig.system.realWidth),e={left:0,top:0};ig.system.canvas.getBoundingClientRect&&(e=ig.system.canvas.getBoundingClientRect());b=b.touches?b.touches[0]:b;this.mouse.x=(b.clientX-e.left)/f;this.mouse.y=(b.clientY-e.top)/f},contextmenu:function(b){this.bindings[ig.KEY.MOUSE2]&&(b.stopPropagation(),b.preventDefault())},keydown:function(b){var f=b.target.tagName;"INPUT"==f||"TEXTAREA"==
f||(f="keydown"==b.type?b.keyCode:2==b.button?ig.KEY.MOUSE2:ig.KEY.MOUSE1,("touchstart"==b.type||"mousedown"==b.type)&&this.mousemove(b),f=this.bindings[f],console.log(f),f&&(this.actions[f]=!0,this.locks[f]||(this.presses[f]=!0,this.locks[f]=!0),b.stopPropagation(),b.preventDefault()))},keyup:function(b){var f=b.target.tagName;if(!("INPUT"==f||"TEXTAREA"==f))if(f=this.bindings["keyup"==b.type?b.keyCode:2==b.button?ig.KEY.MOUSE2:ig.KEY.MOUSE1])this.delayedKeyup[f]=!0,b.stopPropagation(),b.preventDefault()},
devicemotion:function(b){this.accel=b.accelerationIncludingGravity},bind:function(b,f){0>b?this.initMouse():0<b&&this.initKeyboard();this.bindings[b]=f},bindTouch:function(b,f){var e=ig.$(b),c=this;e.addEventListener("touchstart",function(b){c.touchStart(b,f)},!1);e.addEventListener("touchend",function(b){c.touchEnd(b,f)},!1);e.addEventListener("MSPointerDown",function(b){c.touchStart(b,f)},!1);e.addEventListener("MSPointerUp",function(b){c.touchEnd(b,f)},!1)},unbind:function(b){this.delayedKeyup[this.bindings[b]]=
!0;this.bindings[b]=null},unbindAll:function(){this.bindings={};this.actions={};this.presses={};this.locks={};this.delayedKeyup={}},state:function(b){return this.actions[b]},pressed:function(b){return this.presses[b]},released:function(b){return!!this.delayedKeyup[b]},clearPressed:function(){for(var b in this.delayedKeyup)this.actions[b]=!1,this.locks[b]=!1;this.delayedKeyup={};this.presses={}},touchStart:function(b,f){this.actions[f]=!0;this.presses[f]=!0;b.stopPropagation();b.preventDefault();return!1},
touchEnd:function(b,f){this.delayedKeyup[f]=!0;b.stopPropagation();b.preventDefault();return!1}})});ig.baked=!0;ig.module("impact.impact").requires("dom.ready","impact.loader","impact.system","impact.input","impact.sound").defines(function(){ig.main=function(b,f,e,c,d,g,m){ig.system=new ig.System(b,e,c,d,g||1);ig.input=new ig.Input;ig.soundManager=new ig.SoundManager;ig.music=new ig.Music;ig.ready=!0;(new (m||ig.Loader)(f,ig.resources)).load()}});ig.baked=!0;
ig.module("impact.animation").requires("impact.timer","impact.image").defines(function(){ig.AnimationSheet=ig.Class.extend({width:8,height:8,image:null,init:function(b,f,e){this.width=f;this.height=e;this.image=new ig.Image(b)}});ig.Animation=ig.Class.extend({sheet:null,timer:null,sequence:[],flip:{x:!1,y:!1},pivot:{x:0,y:0},frame:0,tile:0,loopCount:0,alpha:1,angle:0,init:function(b,f,e,c){this.sheet=b;this.pivot={x:b.width/2,y:b.height/2};this.timer=new ig.Timer;this.frameTime=f;this.sequence=e;
this.stop=!!c;this.tile=this.sequence[0]},rewind:function(){this.timer.set();this.frame=this.loopCount=0;this.tile=this.sequence[0];return this},gotoFrame:function(b){this.timer.set(this.frameTime*-b-1E-4);this.update()},gotoRandomFrame:function(){this.gotoFrame(Math.floor(Math.random()*this.sequence.length))},update:function(){var b=Math.floor(this.timer.delta()/this.frameTime);this.loopCount=Math.floor(b/this.sequence.length);this.frame=this.stop&&0<this.loopCount?this.sequence.length-1:b%this.sequence.length;
this.tile=this.sequence[this.frame]},draw:function(b,f){var e=Math.max(this.sheet.width,this.sheet.height);b>ig.system.width||(f>ig.system.height||0>b+e||0>f+e)||(1!=this.alpha&&(ig.system.context.globalAlpha=this.alpha),0==this.angle?this.sheet.image.drawTile(b,f,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y):(ig.system.context.save(),ig.system.context.translate(ig.system.getDrawPos(b+this.pivot.x),ig.system.getDrawPos(f+this.pivot.y)),ig.system.context.rotate(this.angle),
this.sheet.image.drawTile(-this.pivot.x,-this.pivot.y,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y),ig.system.context.restore()),1!=this.alpha&&(ig.system.context.globalAlpha=1))}})});ig.baked=!0;
ig.module("impact.entity").requires("impact.animation","impact.impact").defines(function(){ig.Entity=ig.Class.extend({id:0,settings:{},size:{x:16,y:16},offset:{x:0,y:0},pos:{x:0,y:0},last:{x:0,y:0},vel:{x:0,y:0},accel:{x:0,y:0},friction:{x:0,y:0},maxVel:{x:100,y:100},zIndex:0,gravityFactor:1,standing:!1,bounciness:0,minBounceVelocity:40,anims:{},animSheet:null,currentAnim:null,health:10,type:0,checkAgainst:0,collides:0,_killed:!1,slopeStanding:{min:(44).toRad(),max:(136).toRad()},init:function(b,
f,e){this.id=++ig.Entity._lastId;this.pos.x=this.last.x=b;this.pos.y=this.last.y=f;ig.merge(this,e)},reset:function(b,f,e){var c=this.constructor.prototype;this.pos.x=b;this.pos.y=f;this.last.x=b;this.last.y=f;this.vel.x=c.vel.x;this.vel.y=c.vel.y;this.accel.x=c.accel.x;this.accel.y=c.accel.y;this.health=c.health;this._killed=c._killed;this.standing=c.standing;this.type=c.type;this.checkAgainst=c.checkAgainst;this.collides=c.collides;ig.merge(this,e)},addAnim:function(b,f,e,c){if(!this.animSheet)throw"No animSheet to add the animation "+
b+" to.";f=new ig.Animation(this.animSheet,f,e,c);this.anims[b]=f;this.currentAnim||(this.currentAnim=f);return f},update:function(){this.last.x=this.pos.x;this.last.y=this.pos.y;this.vel.y+=ig.game.gravity*ig.system.tick*this.gravityFactor;this.vel.x=this.getNewVelocity(this.vel.x,this.accel.x,this.friction.x,this.maxVel.x);this.vel.y=this.getNewVelocity(this.vel.y,this.accel.y,this.friction.y,this.maxVel.y);var b=ig.game.collisionMap.trace(this.pos.x,this.pos.y,this.vel.x*ig.system.tick,this.vel.y*
ig.system.tick,this.size.x,this.size.y);this.handleMovementTrace(b);this.currentAnim&&this.currentAnim.update()},getNewVelocity:function(b,f,e,c){return f?(b+f*ig.system.tick).limit(-c,c):e?(f=e*ig.system.tick,0<b-f?b-f:0>b+f?b+f:0):b.limit(-c,c)},handleMovementTrace:function(b){this.standing=!1;b.collision.y&&(0<this.bounciness&&Math.abs(this.vel.y)>this.minBounceVelocity?this.vel.y*=-this.bounciness:(0<this.vel.y&&(this.standing=!0),this.vel.y=0));b.collision.x&&(this.vel.x=0<this.bounciness&&Math.abs(this.vel.x)>
this.minBounceVelocity?this.vel.x*-this.bounciness:0);if(b.collision.slope){var f=b.collision.slope;if(0<this.bounciness){var e=this.vel.x*f.nx+this.vel.y*f.ny;this.vel.x=(this.vel.x-2*f.nx*e)*this.bounciness;this.vel.y=(this.vel.y-2*f.ny*e)*this.bounciness}else e=(this.vel.x*f.x+this.vel.y*f.y)/(f.x*f.x+f.y*f.y),this.vel.x=f.x*e,this.vel.y=f.y*e,f=Math.atan2(f.x,f.y),f>this.slopeStanding.min&&f<this.slopeStanding.max&&(this.standing=!0)}this.pos=b.pos},draw:function(){this.currentAnim&&this.currentAnim.draw(this.pos.x-
this.offset.x-ig.game._rscreen.x,this.pos.y-this.offset.y-ig.game._rscreen.y)},kill:function(){ig.game.removeEntity(this)},receiveDamage:function(b){this.health-=b;0>=this.health&&this.kill()},touches:function(b){return!(this.pos.x>=b.pos.x+b.size.x||this.pos.x+this.size.x<=b.pos.x||this.pos.y>=b.pos.y+b.size.y||this.pos.y+this.size.y<=b.pos.y)},distanceTo:function(b){var f=this.pos.x+this.size.x/2-(b.pos.x+b.size.x/2);b=this.pos.y+this.size.y/2-(b.pos.y+b.size.y/2);return Math.sqrt(f*f+b*b)},angleTo:function(b){return Math.atan2(b.pos.y+
b.size.y/2-(this.pos.y+this.size.y/2),b.pos.x+b.size.x/2-(this.pos.x+this.size.x/2))},check:function(){},collideWith:function(){},ready:function(){},erase:function(){}});ig.Entity._lastId=0;ig.Entity.COLLIDES={NEVER:0,LITE:1,PASSIVE:2,ACTIVE:4,FIXED:8};ig.Entity.TYPE={NONE:0,A:1,B:2,BOTH:3};ig.Entity.checkPair=function(b,f){b.checkAgainst&f.type&&b.check(f);f.checkAgainst&b.type&&f.check(b);b.collides&&(f.collides&&b.collides+f.collides>ig.Entity.COLLIDES.ACTIVE)&&ig.Entity.solveCollision(b,f)};ig.Entity.solveCollision=
function(b,f){var e=null;if(b.collides==ig.Entity.COLLIDES.LITE||f.collides==ig.Entity.COLLIDES.FIXED)e=b;else if(f.collides==ig.Entity.COLLIDES.LITE||b.collides==ig.Entity.COLLIDES.FIXED)e=f;b.last.x+b.size.x>f.last.x&&b.last.x<f.last.x+f.size.x?(b.last.y<f.last.y?ig.Entity.seperateOnYAxis(b,f,e):ig.Entity.seperateOnYAxis(f,b,e),b.collideWith(f,"y"),f.collideWith(b,"y")):b.last.y+b.size.y>f.last.y&&b.last.y<f.last.y+f.size.y&&(b.last.x<f.last.x?ig.Entity.seperateOnXAxis(b,f,e):ig.Entity.seperateOnXAxis(f,
b,e),b.collideWith(f,"x"),f.collideWith(b,"x"))};ig.Entity.seperateOnXAxis=function(b,f,e){var c=b.pos.x+b.size.x-f.pos.x;e?(e.vel.x=-e.vel.x*e.bounciness+(b===e?f:b).vel.x,f=ig.game.collisionMap.trace(e.pos.x,e.pos.y,e==b?-c:c,0,e.size.x,e.size.y),e.pos.x=f.pos.x):(e=(b.vel.x-f.vel.x)/2,b.vel.x=-e,f.vel.x=e,e=ig.game.collisionMap.trace(b.pos.x,b.pos.y,-c/2,0,b.size.x,b.size.y),b.pos.x=Math.floor(e.pos.x),b=ig.game.collisionMap.trace(f.pos.x,f.pos.y,c/2,0,f.size.x,f.size.y),f.pos.x=Math.ceil(b.pos.x))};
ig.Entity.seperateOnYAxis=function(b,f,e){var c=b.pos.y+b.size.y-f.pos.y;if(e){f=b===e?f:b;e.vel.y=-e.vel.y*e.bounciness+f.vel.y;var d=0;e==b&&Math.abs(e.vel.y-f.vel.y)<e.minBounceVelocity&&(e.standing=!0,d=f.vel.x*ig.system.tick);b=ig.game.collisionMap.trace(e.pos.x,e.pos.y,d,e==b?-c:c,e.size.x,e.size.y);e.pos.y=b.pos.y;e.pos.x=b.pos.x}else ig.game.gravity&&(f.standing||0<b.vel.y)?(e=ig.game.collisionMap.trace(b.pos.x,b.pos.y,0,-(b.pos.y+b.size.y-f.pos.y),b.size.x,b.size.y),b.pos.y=e.pos.y,0<b.bounciness&&
b.vel.y>b.minBounceVelocity?b.vel.y*=-b.bounciness:(b.standing=!0,b.vel.y=0)):(e=(b.vel.y-f.vel.y)/2,b.vel.y=-e,f.vel.y=e,d=f.vel.x*ig.system.tick,e=ig.game.collisionMap.trace(b.pos.x,b.pos.y,d,-c/2,b.size.x,b.size.y),b.pos.y=e.pos.y,b=ig.game.collisionMap.trace(f.pos.x,f.pos.y,0,c/2,f.size.x,f.size.y),f.pos.y=b.pos.y)}});ig.baked=!0;
ig.module("impact.map").defines(function(){ig.Map=ig.Class.extend({tilesize:8,width:1,height:1,data:[[]],name:null,init:function(b,f){this.tilesize=b;this.data=f;this.height=f.length;this.width=f[0].length;this.pxWidth=this.width*this.tilesize;this.pxHeight=this.height*this.tilesize},getTile:function(b,f){var e=Math.floor(b/this.tilesize),c=Math.floor(f/this.tilesize);return 0<=e&&e<this.width&&0<=c&&c<this.height?this.data[c][e]:0},setTile:function(b,f,e){b=Math.floor(b/this.tilesize);f=Math.floor(f/
this.tilesize);0<=b&&b<this.width&&(0<=f&&f<this.height)&&(this.data[f][b]=e)}})});ig.baked=!0;
ig.module("impact.collision-map").requires("impact.map").defines(function(){ig.CollisionMap=ig.Map.extend({lastSlope:1,tiledef:null,init:function(b,c,d){this.parent(b,c);this.tiledef=d||ig.CollisionMap.defaultTileDef;for(var f in this.tiledef)f|0>this.lastSlope&&(this.lastSlope=f|0)},trace:function(b,c,d,f,m,j){var l={collision:{x:!1,y:!1,slope:!1},pos:{x:b,y:c},tile:{x:0,y:0}},n=Math.ceil(Math.max(Math.abs(d),Math.abs(f))/this.tilesize);if(1<n)for(var q=d/n,p=f/n,r=0;r<n&&(q||p)&&!(this._traceStep(l,
b,c,q,p,m,j,d,f,r),b=l.pos.x,c=l.pos.y,l.collision.x&&(d=q=0),l.collision.y&&(f=p=0),l.collision.slope);r++);else this._traceStep(l,b,c,d,f,m,j,d,f,0);return l},_traceStep:function(b,c,d,f,m,j,l,n,q,p){b.pos.x+=f;b.pos.y+=m;var r=0;if(f){var t=0<f?j:0,s=0>f?this.tilesize:0,r=Math.max(Math.floor(d/this.tilesize),0),u=Math.min(Math.ceil((d+l)/this.tilesize),this.height);f=Math.floor((b.pos.x+t)/this.tilesize);var x=Math.floor((c+t)/this.tilesize);if(0<p||f==x||0>x||x>=this.width)x=-1;if(0<=f&&f<this.width)for(var y=
r;y<u&&!(-1!=x&&(r=this.data[y][x],1<r&&r<=this.lastSlope&&this._checkTileDef(b,r,c,d,n,q,j,l,x,y)));y++)if(r=this.data[y][f],1==r||r>this.lastSlope||1<r&&this._checkTileDef(b,r,c,d,n,q,j,l,f,y)){if(1<r&&r<=this.lastSlope&&b.collision.slope)break;b.collision.x=!0;b.tile.x=r;c=b.pos.x=f*this.tilesize-t+s;n=0;break}}if(m){t=0<m?l:0;m=0>m?this.tilesize:0;r=Math.max(Math.floor(b.pos.x/this.tilesize),0);s=Math.min(Math.ceil((b.pos.x+j)/this.tilesize),this.width);y=Math.floor((b.pos.y+t)/this.tilesize);
u=Math.floor((d+t)/this.tilesize);if(0<p||y==u||0>u||u>=this.height)u=-1;if(0<=y&&y<this.height)for(f=r;f<s&&!(-1!=u&&(r=this.data[u][f],1<r&&r<=this.lastSlope&&this._checkTileDef(b,r,c,d,n,q,j,l,f,u)));f++)if(r=this.data[y][f],1==r||r>this.lastSlope||1<r&&this._checkTileDef(b,r,c,d,n,q,j,l,f,y)){if(1<r&&r<=this.lastSlope&&b.collision.slope)break;b.collision.y=!0;b.tile.y=r;b.pos.y=y*this.tilesize-t+m;break}}},_checkTileDef:function(b,c,d,f,m,j,l,n,q,p){var r=this.tiledef[c];if(!r)return!1;c=(r[2]-
r[0])*this.tilesize;var t=(r[3]-r[1])*this.tilesize,s=r[4];l=d+m+(0>t?l:0)-(q+r[0])*this.tilesize;n=f+j+(0<c?n:0)-(p+r[1])*this.tilesize;if(0<c*n-t*l){if(0>m*-t+j*c)return s;q=Math.sqrt(c*c+t*t);p=t/q;q=-c/q;var u=l*p+n*q,r=p*u,u=q*u;if(r*r+u*u>=m*m+j*j)return s||0.5>c*(n-j)-t*(l-m);b.pos.x=d+m-r;b.pos.y=f+j-u;b.collision.slope={x:c,y:t,nx:p,ny:q};return!0}return!1}});var b=1/3,f=2/3;ig.CollisionMap.defaultTileDef={5:[0,1,1,f,!0],6:[0,f,1,b,!0],7:[0,b,1,0,!0],3:[0,1,1,0.5,!0],4:[0,0.5,1,0,!0],2:[0,
1,1,0,!0],10:[0.5,1,1,0,!0],21:[0,1,0.5,0,!0],32:[f,1,1,0,!0],43:[b,1,f,0,!0],54:[0,1,b,0,!0],27:[0,0,1,b,!0],28:[0,b,1,f,!0],29:[0,f,1,1,!0],25:[0,0,1,0.5,!0],26:[0,0.5,1,1,!0],24:[0,0,1,1,!0],11:[0,0,0.5,1,!0],22:[0.5,0,1,1,!0],33:[0,0,b,1,!0],44:[b,0,f,1,!0],55:[f,0,1,1,!0],16:[1,b,0,0,!0],17:[1,f,0,b,!0],18:[1,1,0,f,!0],14:[1,0.5,0,0,!0],15:[1,1,0,0.5,!0],13:[1,1,0,0,!0],8:[0.5,1,0,0,!0],19:[1,1,0.5,0,!0],30:[b,1,0,0,!0],41:[f,1,b,0,!0],52:[1,1,f,0,!0],38:[1,f,0,1,!0],39:[1,b,0,f,!0],40:[1,0,
0,b,!0],36:[1,0.5,0,1,!0],37:[1,0,0,0.5,!0],35:[1,0,0,1,!0],9:[1,0,0.5,1,!0],20:[0.5,0,0,1,!0],31:[1,0,f,1,!0],42:[f,0,b,1,!0],53:[b,0,0,1,!0],12:[0,0,1,0,!1],23:[1,1,0,1,!1],34:[1,0,1,1,!1],45:[0,1,0,0,!1]};ig.CollisionMap.staticNoCollision={trace:function(b,c,d,f){return{collision:{x:!1,y:!1,slope:!1},pos:{x:b+d,y:c+f},tile:{x:0,y:0}}}}});ig.baked=!0;
ig.module("impact.background-map").requires("impact.map","impact.image").defines(function(){ig.BackgroundMap=ig.Map.extend({tiles:null,scroll:{x:0,y:0},distance:1,repeat:!1,tilesetName:"",foreground:!1,enabled:!0,preRender:!1,preRenderedChunks:null,chunkSize:512,debugChunks:!1,anims:{},init:function(b,f,e){this.parent(b,f);this.setTileset(e)},setTileset:function(b){this.tilesetName=b instanceof ig.Image?b.path:b;this.tiles=new ig.Image(this.tilesetName);this.preRenderedChunks=null},setScreenPos:function(b,
f){this.scroll.x=b/this.distance;this.scroll.y=f/this.distance},preRenderMapToChunks:function(){var b=this.width*this.tilesize*ig.system.scale,f=this.height*this.tilesize*ig.system.scale;this.chunkSize=Math.min(Math.max(b,f),this.chunkSize);var e=Math.ceil(b/this.chunkSize),c=Math.ceil(f/this.chunkSize);this.preRenderedChunks=[];for(var d=0;d<c;d++){this.preRenderedChunks[d]=[];for(var g=0;g<e;g++)this.preRenderedChunks[d][g]=this.preRenderChunk(g,d,g==e-1?b-g*this.chunkSize:this.chunkSize,d==c-1?
f-d*this.chunkSize:this.chunkSize)}},preRenderChunk:function(b,f,e,c){var d=e/this.tilesize/ig.system.scale+1,g=c/this.tilesize/ig.system.scale+1,m=b*this.chunkSize/ig.system.scale%this.tilesize,j=f*this.chunkSize/ig.system.scale%this.tilesize;b=Math.floor(b*this.chunkSize/this.tilesize/ig.system.scale);f=Math.floor(f*this.chunkSize/this.tilesize/ig.system.scale);var l=ig.$new("canvas");l.width=e;l.height=c;l.retinaResolutionEnabled=!1;c=l.getContext("2d");ig.System.scaleMode(l,c);e=ig.system.context;
ig.system.context=c;for(c=0;c<d;c++)for(var n=0;n<g;n++)if(c+b<this.width&&n+f<this.height){var q=this.data[n+f][c+b];q&&this.tiles.drawTile(c*this.tilesize-m,n*this.tilesize-j,q-1,this.tilesize)}ig.system.context=e;return l},draw:function(){this.tiles.loaded&&this.enabled&&(this.preRender?this.drawPreRendered():this.drawTiled())},drawPreRendered:function(){this.preRenderedChunks||this.preRenderMapToChunks();var b=ig.system.getDrawPos(this.scroll.x),f=ig.system.getDrawPos(this.scroll.y);if(this.repeat)var e=
this.width*this.tilesize*ig.system.scale,b=(b%e+e)%e,e=this.height*this.tilesize*ig.system.scale,f=(f%e+e)%e;var e=Math.max(Math.floor(b/this.chunkSize),0),c=Math.max(Math.floor(f/this.chunkSize),0),d=Math.ceil((b+ig.system.realWidth)/this.chunkSize),g=Math.ceil((f+ig.system.realHeight)/this.chunkSize),m=this.preRenderedChunks[0].length,j=this.preRenderedChunks.length;this.repeat||(d=Math.min(d,m),g=Math.min(g,j));for(var l=0;c<g;c++){for(var n=0,q=e;q<d;q++){var p=this.preRenderedChunks[c%j][q%m],
r=-b+q*this.chunkSize-n,t=-f+c*this.chunkSize-l;ig.system.context.drawImage(p,r,t);ig.Image.drawCount++;this.debugChunks&&(ig.system.context.strokeStyle="#f0f",ig.system.context.strokeRect(r,t,this.chunkSize,this.chunkSize));this.repeat&&(p.width<this.chunkSize&&r+p.width<ig.system.realWidth)&&(n+=this.chunkSize-p.width,d++)}this.repeat&&(p.height<this.chunkSize&&t+p.height<ig.system.realHeight)&&(l+=this.chunkSize-p.height,g++)}},drawTiled:function(){for(var b=0,f=null,e=(this.scroll.x/this.tilesize).toInt(),
c=(this.scroll.y/this.tilesize).toInt(),d=this.scroll.x%this.tilesize,g=this.scroll.y%this.tilesize,m=-d-this.tilesize,d=ig.system.width+this.tilesize-d,j=ig.system.height+this.tilesize-g,l=-1,g=-g-this.tilesize;g<j;l++,g+=this.tilesize){var n=l+c;if(n>=this.height||0>n){if(!this.repeat)continue;n=(n%this.height+this.height)%this.height}for(var q=-1,p=m;p<d;q++,p+=this.tilesize){b=q+e;if(b>=this.width||0>b){if(!this.repeat)continue;b=(b%this.width+this.width)%this.width}if(b=this.data[n][b])(f=this.anims[b-
1])?f.draw(p,g):this.tiles.drawTile(p,g,b-1,this.tilesize)}}}})});ig.baked=!0;
ig.module("impact.game").requires("impact.impact","impact.entity","impact.collision-map","impact.background-map").defines(function(){ig.Game=ig.Class.extend({clearColor:"#000000",gravity:0,screen:{x:0,y:0},_rscreen:{x:0,y:0},entities:[],namedEntities:{},collisionMap:ig.CollisionMap.staticNoCollision,backgroundMaps:[],backgroundAnims:{},autoSort:!1,sortBy:null,cellSize:64,_deferredKill:[],_levelToLoad:null,_doSortEntities:!1,staticInstantiate:function(){this.sortBy=this.sortBy||ig.Game.SORT.Z_INDEX;
ig.game=this;return null},loadLevel:function(b){this.screen={x:0,y:0};this.entities=[];this.namedEntities={};for(var f=0;f<b.entities.length;f++){var e=b.entities[f];this.spawnEntity(e.type,e.x,e.y,e.settings)}this.sortEntities();this.collisionMap=ig.CollisionMap.staticNoCollision;this.backgroundMaps=[];for(f=0;f<b.layer.length;f++)if(e=b.layer[f],"collision"==e.name)this.collisionMap=new ig.CollisionMap(e.tilesize,e.data);else{var c=new ig.BackgroundMap(e.tilesize,e.data,e.tilesetName);c.anims=this.backgroundAnims[e.tilesetName]||
{};c.repeat=e.repeat;c.distance=e.distance;c.foreground=!!e.foreground;c.preRender=!!e.preRender;c.name=e.name;this.backgroundMaps.push(c)}for(f=0;f<this.entities.length;f++)this.entities[f].ready()},loadLevelDeferred:function(b){this._levelToLoad=b},getMapByName:function(b){if("collision"==b)return this.collisionMap;for(var f=0;f<this.backgroundMaps.length;f++)if(this.backgroundMaps[f].name==b)return this.backgroundMaps[f];return null},getEntityByName:function(b){return this.namedEntities[b]},getEntitiesByType:function(b){b=
"string"===typeof b?ig.global[b]:b;for(var f=[],e=0;e<this.entities.length;e++){var c=this.entities[e];c instanceof b&&!c._killed&&f.push(c)}return f},spawnEntity:function(b,f,e,c){var d="string"===typeof b?ig.global[b]:b;if(!d)throw"Can't spawn entity of type "+b;b=new d(f,e,c||{});this.entities.push(b);b.name&&(this.namedEntities[b.name]=b);return b},sortEntities:function(){this.entities.sort(this.sortBy)},sortEntitiesDeferred:function(){this._doSortEntities=!0},removeEntity:function(b){b.name&&
delete this.namedEntities[b.name];b._killed=!0;b.type=ig.Entity.TYPE.NONE;b.checkAgainst=ig.Entity.TYPE.NONE;b.collides=ig.Entity.COLLIDES.NEVER;this._deferredKill.push(b)},run:function(){this.update();this.draw()},update:function(){this._levelToLoad&&(this.loadLevel(this._levelToLoad),this._levelToLoad=null);this.updateEntities();this.checkEntities();for(var b=0;b<this._deferredKill.length;b++)this._deferredKill[b].erase(),this.entities.erase(this._deferredKill[b]);this._deferredKill=[];if(this._doSortEntities||
this.autoSort)this.sortEntities(),this._doSortEntities=!1;for(var f in this.backgroundAnims){var b=this.backgroundAnims[f],e;for(e in b)b[e].update()}},updateEntities:function(){for(var b=0;b<this.entities.length;b++){var f=this.entities[b];f._killed||f.update()}},clearCanvas:function(b,f,e){var c=b.canvas;b.clearRect(0,0,f,e);c.style.display="none";c.offsetHeight;c.style.display="inherit"},draw:function(){this.clearCanvas(ig.system.context,ig.system.width,ig.system.height);this._rscreen.x=ig.system.getDrawPos(this.screen.x)/
ig.system.scale;this._rscreen.y=ig.system.getDrawPos(this.screen.y)/ig.system.scale;var b;for(b=0;b<this.backgroundMaps.length;b++){var f=this.backgroundMaps[b];if(f.foreground)break;f.setScreenPos(this.screen.x,this.screen.y);f.draw()}this.drawEntities();for(b;b<this.backgroundMaps.length;b++)f=this.backgroundMaps[b],f.setScreenPos(this.screen.x,this.screen.y),f.draw()},drawEntities:function(){for(var b=0;b<this.entities.length;b++)this.entities[b].draw()},checkEntities:function(){for(var b={},f=
0;f<this.entities.length;f++){var e=this.entities[f];if(!(e.type==ig.Entity.TYPE.NONE&&e.checkAgainst==ig.Entity.TYPE.NONE&&e.collides==ig.Entity.COLLIDES.NEVER))for(var c={},d=Math.floor(e.pos.y/this.cellSize),g=Math.floor((e.pos.x+e.size.x)/this.cellSize)+1,m=Math.floor((e.pos.y+e.size.y)/this.cellSize)+1,j=Math.floor(e.pos.x/this.cellSize);j<g;j++)for(var l=d;l<m;l++)if(b[j])if(b[j][l]){for(var n=b[j][l],q=0;q<n.length;q++)e.touches(n[q])&&!c[n[q].id]&&(c[n[q].id]=!0,ig.Entity.checkPair(e,n[q]));
n.push(e)}else b[j][l]=[e];else b[j]={},b[j][l]=[e]}}});ig.Game.SORT={Z_INDEX:function(b,f){return b.zIndex-f.zIndex},POS_X:function(b,f){return b.pos.x+b.size.x-(f.pos.x+f.size.x)},POS_Y:function(b,f){return b.pos.y+b.size.y-(f.pos.y+f.size.y)}}});ig.baked=!0;
ig.module("plugins.patches.webkit-image-smoothing-patch").defines(function(){ig.System&&(ig.System.SCALE={CRISP:function(b,f){f.imageSmoothingEnabled=f.msImageSmoothingEnabled=f.mozImageSmoothingEnabled=f.oImageSmoothingEnabled=!1;b.style.imageRendering="-moz-crisp-edges";b.style.imageRendering="-o-crisp-edges";b.style.imageRendering="-webkit-optimize-contrast";b.style.imageRendering="crisp-edges";b.style.msInterpolationMode="nearest-neighbor"},SMOOTH:function(b,f){f.imageSmoothingEnabled=f.msImageSmoothingEnabled=
f.mozImageSmoothingEnabled=f.oImageSmoothingEnabled=!0;b.style.imageRendering="";b.style.msInterpolationMode=""}},ig.System.scaleMode=ig.System.SCALE.SMOOTH)});ig.baked=!0;
ig.module("plugins.patches.windowfocus-onMouseDown-patch").defines(function(){var b=!1;try{b=window.self!==window.top,!1===b&&(b=0<window.frames.length)}catch(f){b=!0}ig.Input.inject({keydown:function(e){var c=e.target.tagName;if(!("INPUT"==c||"TEXTAREA"==c))if(c="keydown"==e.type?e.keyCode:2==e.button?ig.KEY.MOUSE2:ig.KEY.MOUSE1,b&&0>c&&window.focus(),("touchstart"==e.type||"mousedown"==e.type)&&this.mousemove(e),c=this.bindings[c])this.actions[c]=!0,this.locks[c]||(this.presses[c]=!0,this.locks[c]=
!0),e.stopPropagation(),e.preventDefault()}})});ig.baked=!0;
ig.module("plugins.patches.mouse-move-patch").defines(function(){ig.Input.inject({move:new BABYLON.Vector2(0,0),initMouse:function(){if(!this.isUsingMouse){this.isUsingMouse=!0;var b=this.mousewheel.bind(this);ig.system.canvas.addEventListener("mousewheel",b,!1);ig.system.canvas.addEventListener("DOMMouseScroll",b,!1);ig.system.canvas.addEventListener("contextmenu",this.contextmenu.bind(this),!1);ig.system.canvas.addEventListener("mousedown",this.keydown.bind(this),!1);ig.system.canvas.addEventListener("mouseup",
this.keyup.bind(this),!1);ig.system.canvas.addEventListener("mousemove",this.mousemove.bind(this),!1);ig.ua.touchDevice&&(ig.system.canvas.addEventListener("touchstart",this.keydown.bind(this),!1),ig.system.canvas.addEventListener("touchend",this.keyup.bind(this),!1),ig.system.canvas.addEventListener("touchmove",this.mousemove.bind(this),!1),ig.system.canvas.addEventListener("MSPointerDown",this.keydown.bind(this),!1),ig.system.canvas.addEventListener("MSPointerUp",this.keyup.bind(this),!1),ig.system.canvas.addEventListener("MSPointerMove",
this.mousemove.bind(this),!1),ig.system.canvas.style.msTouchAction="none")}},mousemove:function(b){var f=parseInt(wgl.system.canvas.offsetWidth);parseInt(wgl.system.canvas.offsetHeight);ig.ua.mobile&&(f=ig.system.realWidth);var f=ig.system.scale*(f/ig.system.realWidth),e={left:0,top:0};ig.system.canvas.getBoundingClientRect&&(e=ig.system.canvas.getBoundingClientRect());var c=b.touches?b.touches[0]:b;this.mouse.x=(c.clientX-e.left)/f;this.mouse.y=(c.clientY-e.top)/f;void 0!==typeof b.movementX?(this.move.x=
b.movementX,this.move.y=b.movementY):(this.move.x=0,this.move.y=0)}})});ig.baked=!0;
ig.module("plugins.handlers.dom-handler").defines(function(){ig.DomHandler=ig.Class.extend({JQUERYAVAILABLE:!1,init:function(){this.JQUERYAVAILABLE=this._jqueryAvailable()},_jqueryAvailable:function(){return"undefined"!==typeof jQuery},addEvent:function(b,f,e,c){if(this.JQUERYAVAILABLE)b.on(f,e);else b.addEventListener(f,e,c)},create:function(b){return this.JQUERYAVAILABLE?$("<"+b+">"):ig.$new(b)},getElementByClass:function(b){return this.JQUERYAVAILABLE?$("."+b):document.getElementsByClassName(b)},
getElementById:function(b){return this.JQUERYAVAILABLE?0<$(b).length?$(b):null:ig.$(b)},appendChild:function(b,f){this.JQUERYAVAILABLE?b.append(f):b.appendChild(f)},appendToBody:function(b){this.JQUERYAVAILABLE?$("body").append(b):document.body.appendChild(b)},resize:function(b,f,e){if(this.JQUERYAVAILABLE)b.width(f.toFixed(2)),b.height(e.toFixed(2));else{var c=b.style.visibility;f="width:"+f.toFixed(2)+"px; height:"+e.toFixed(2)+"px;";this.attr(b,"style",f);b.style.visibility=c}},resizeOffsetLeft:function(b,
f,e,c){if(this.JQUERYAVAILABLE)b.width(f.toFixed(2)),b.height(e.toFixed(2)),b.css("left",c);else{var d=b.style.visibility;f="width:"+f.toFixed(2)+"px; height:"+e.toFixed(2)+"px; left: "+c.toFixed(2)+"px;";this.attr(b,"style",f);b.style.visibility=d}},css:function(b,f){if(this.JQUERYAVAILABLE)b.css(f);else{var e="",c;for(c in f)e+=c+":"+f[c]+";";this.attr(b,"style",e)}},getOffsets:function(b){return this.JQUERYAVAILABLE?(b=b.offset(),{left:b.left,top:b.top}):{left:b.offsetLeft,top:b.offsetTop}},attr:function(b,
f,e){if("undefined"===typeof e)return this.JQUERYAVAILABLE?b.attr(f):b.getAttribute(f);this.JQUERYAVAILABLE?b.attr(f,e):b.setAttribute(f,e)},show:function(b){this.JQUERYAVAILABLE?(b.show(),b.css("visibility","visible")):b&&(b.style?b.style.visibility="visible":b[0]&&(b[0].style.visibility="visible"))},hide:function(b){this.JQUERYAVAILABLE?(b.hide(),b.css("visibility","hidden")):b&&(b.style?b.style.visibility="hidden":b[0]&&(b[0].style.visibility="hidden"))},getQueryVariable:function(b){for(var f=
window.location.search.substring(1).split("&"),e=0;e<f.length;e++){var c=f[e].split("=");if(decodeURIComponent(c[0])==b)return decodeURIComponent(c[1])}},forcedDeviceDetection:function(){var b=this.getQueryVariable("device");if(b)switch(b){case "mobile":console.log("serving mobile version ...");ig.ua.mobile=!0;break;case "desktop":console.log("serving desktop version ...");ig.ua.mobile=!1;break;default:console.log("serving universal version ...")}else console.log("serving universal version ...")},
forcedDeviceRotation:function(){var b=this.getQueryVariable("force-rotate");if(b)switch(b){case "portrait":console.log("force rotate to portrait");window.orientation=0;break;case "landscape":console.log("force rotate to horizontal");window.orientation=90;break;default:alert("wrong command/type in param force-rotate. Defaulting value to portrait"),window.orientation=0}},setZIndex:function(b,f){this.JQUERYAVAILABLE?b.css("zIndex",f):b&&(b.style?b.style.zIndex=f:b[0]&&(b[0].style.zIndex=f))}})});
ig.baked=!0;
ig.module("plugins.handlers.size-handler").defines(function(){ig.SizeHandler=ig.Class.extend({portraitMode:!0,desktop:{actualSize:new BABYLON.Vector2(window.innerWidth,window.innerHeight),actualResolution:new BABYLON.Vector2(540,960)},mobile:{actualSize:new BABYLON.Vector2(window.innerWidth,window.innerHeight),actualResolution:new BABYLON.Vector2(540,960)},windowSize:new BABYLON.Vector2(window.innerWidth,window.innerHeight),scaleRatioMultiplier:new BABYLON.Vector2(1,1),sizeRatio:new BABYLON.Vector2(1,1),
scale:1,domHandler:null,dynamicClickableEntityDivs:{},coreDivsToResize:["#canvas","#play","#orientate","#webglcanvas"],adsToResize:{MobileAdInGamePreroll:{"box-width":_SETTINGS.Ad.Mobile.Preroll.Width+2,"box-height":_SETTINGS.Ad.Mobile.Preroll.Height+20},MobileAdInGameEnd:{"box-width":_SETTINGS.Ad.Mobile.End.Width+2,"box-height":_SETTINGS.Ad.Mobile.End.Height+20},MobileAdInGamePreroll2:{"box-width":_SETTINGS.Ad.Mobile.Preroll.Width+2,"box-height":_SETTINGS.Ad.Mobile.Preroll.Height+20},MobileAdInGameEnd2:{"box-width":_SETTINGS.Ad.Mobile.End.Width+
2,"box-height":_SETTINGS.Ad.Mobile.End.Height+20},MobileAdInGamePreroll3:{"box-width":_SETTINGS.Ad.Mobile.Preroll.Width+2,"box-height":_SETTINGS.Ad.Mobile.Preroll.Height+20},MobileAdInGameEnd3:{"box-width":_SETTINGS.Ad.Mobile.End.Width+2,"box-height":_SETTINGS.Ad.Mobile.End.Height+20}},init:function(b){this.domHandler=b;if("undefined"===typeof b)throw"undefined Dom Handler for Size Handler";this.sizeCalcs();this.eventListenerSetup();this.samsungFix()},sizeCalcs:function(){this.windowSize=new BABYLON.Vector2(window.innerWidth,
window.innerHeight);if(ig.ua.mobile){this.mobile.actualSize=new BABYLON.Vector2(window.innerWidth,window.innerHeight);var b=new BABYLON.Vector2(this.mobile.actualResolution.x,this.mobile.actualResolution.y);this.scaleRatioMultiplier=new BABYLON.Vector2(this.mobile.actualSize.x/b.x,this.mobile.actualSize.y/b.y);var f=Math.min(this.scaleRatioMultiplier.x,this.scaleRatioMultiplier.y);this.mobile.actualSize.x=b.x*this.scaleRatioMultiplier.x;this.mobile.actualSize.y=b.y*this.scaleRatioMultiplier.y}else this.desktop.actualSize=
new BABYLON.Vector2(window.innerWidth,window.innerHeight),b=new BABYLON.Vector2(this.desktop.actualResolution.x,this.desktop.actualResolution.y),this.scaleRatioMultiplier=new BABYLON.Vector2(this.desktop.actualSize.x/b.x,this.desktop.actualSize.y/b.y),f=Math.min(this.scaleRatioMultiplier.x,this.scaleRatioMultiplier.y),this.desktop.actualSize.x=b.x*f,this.desktop.actualSize.y=b.y*f;this.sizeRatio.x=window.innerWidth/this.mobile.actualResolution.x;this.sizeRatio.y=window.innerHeight/this.mobile.actualResolution.y},
resizeLayers:function(){for(var b=0;b<this.coreDivsToResize.length;b++){var f=ig.domHandler.getElementById(this.coreDivsToResize[b]);f&&(ig.ua.mobile?ig.domHandler.resize(f,Math.floor(ig.sizeHandler.mobile.actualSize.x),Math.floor(ig.sizeHandler.mobile.actualSize.y)):ig.domHandler.resizeOffsetLeft(f,Math.floor(ig.sizeHandler.desktop.actualSize.x),Math.floor(ig.sizeHandler.desktop.actualSize.y),Math.floor((ig.sizeHandler.windowSize.x>>1)-(ig.sizeHandler.desktop.actualSize.x>>1))))}for(var e in this.adsToResize){var b=
ig.domHandler.getElementById("#"+e),f=ig.domHandler.getElementById("#"+e+"-Box"),c=(window.innerWidth-this.adsToResize[e]["box-width"]>>1)+"px",d=(window.innerHeight-this.adsToResize[e]["box-height"]>>1)+"px";b&&ig.domHandler.css(b,{width:window.innerWidth,height:window.innerHeight});f&&ig.domHandler.css(f,{left:c,top:d})}for(e in this.dynamicClickableEntityDivs){f=Math.min(ig.sizeHandler.scaleRatioMultiplier.x,ig.sizeHandler.scaleRatioMultiplier.y);b=ig.domHandler.getElementById("#"+e);if(ig.ua.mobile)var g=
this.dynamicClickableEntityDivs[e].entity_pos_x,m=this.dynamicClickableEntityDivs[e].entity_pos_y,d=this.dynamicClickableEntityDivs[e].width,c=this.dynamicClickableEntityDivs[e].height,j=Math.floor(g*this.scaleRatioMultiplier.x)+"px",m=Math.floor(m*this.scaleRatioMultiplier.y)+"px",d=Math.floor(d*this.scaleRatioMultiplier.x)+"px",f=Math.floor(c*this.scaleRatioMultiplier.y)+"px";else var c=ig.domHandler.getElementById("#canvas"),c=ig.domHandler.getOffsets(c),j=c.left,l=c.top,g=this.dynamicClickableEntityDivs[e].entity_pos_x,
m=this.dynamicClickableEntityDivs[e].entity_pos_y,d=this.dynamicClickableEntityDivs[e].width,c=this.dynamicClickableEntityDivs[e].height,j=Math.floor(j+g*f)+"px",m=Math.floor(l+m*f)+"px",d=Math.floor(d*f)+"px",f=Math.floor(c*f)+"px";ig.domHandler.css(b,{"float":"left",position:"absolute",left:j,top:m,width:d,height:f,"z-index":3})}},resize:function(){if (wgl && wgl.system && wgl.system.engine) wgl.system.engine.resize();this.sizeCalcs();this.resizeLayers();},reorient:function(){window.scrollTo(0,1);if(ig.ua.mobile){var b=
this.portraitMode?window.innerHeight<window.innerWidth:window.innerHeight>window.innerWidth,f=this.domHandler.getElementById("#orientate"),e=this.domHandler.getElementById("#game");b?(this.domHandler.show(f),this.domHandler.hide(e)):(this.domHandler.show(e),this.domHandler.hide(f))}ig.ua.mobile?(this.resize(),this.resizeAds()):this.resize()},resizeAds:function(){for(var b in this.adsToResize){var f=ig.domHandler.getElementById("#"+b),e=ig.domHandler.getElementById("#"+b+"-Box"),c=(window.innerWidth-
this.adsToResize[b]["box-width"]>>1)+"px",d=(window.innerHeight-this.adsToResize[b]["box-height"]>>1)+"px";f&&ig.domHandler.css(f,{width:window.innerWidth,height:window.innerHeight});e&&ig.domHandler.css(e,{left:c,top:d})}},samsungFix:function(){ig.ua.android&&(!(4.2>parseFloat(navigator.userAgent.slice(navigator.userAgent.indexOf("Android")+8,navigator.userAgent.indexOf("Android")+11)))&&!(0>navigator.userAgent.indexOf("GT"))&&!(0<navigator.userAgent.indexOf("Chrome"))&&!(0<navigator.userAgent.indexOf("Firefox")))&&
(document.addEventListener("touchstart",function(b){b.preventDefault();return!1},!1),document.addEventListener("touchmove",function(b){b.preventDefault();return!1},!1),document.addEventListener("touchend",function(b){b.preventDefault();return!1},!1))},eventListenerSetup:function(){window.addEventListener("resize",function(){this.reorient()}.bind(this),!1);window.addEventListener("orientationchange",function(){this.reorient()}.bind(this),!1);document.ontouchmove=function(b){window.scrollTo(0,1);b.preventDefault()}}})});
ig.baked=!0;
ig.module("plugins.handlers.api-handler").defines(function(){ig.ApiHandler=ig.Class.extend({apiAvailable:{MJSPreroll:function(){ig.ua.mobile&&ig.domHandler.JQUERYAVAILABLE&&_SETTINGS&&_SETTINGS.Ad.Mobile.Preroll.Enabled&&MobileAdInGamePreroll.Initialize()},MJSHeader:function(){ig.ua.mobile&&ig.domHandler.JQUERYAVAILABLE&&_SETTINGS.Ad.Mobile.Header.Enabled&&MobileAdInGameHeader.Initialize()},MJSFooter:function(){ig.ua.mobile&&ig.domHandler.JQUERYAVAILABLE&&_SETTINGS.Ad.Mobile.Footer.Enabled&&MobileAdInGameFooter.Initialize()},
MJSEnd:function(){ig.ua.mobile&&ig.domHandler.JQUERYAVAILABLE&&_SETTINGS.Ad.Mobile.End.Enabled&&MobileAdInGameEnd.Initialize()}},run:function(b,f){if(this.apiAvailable[b])this.apiAvailable[b](f)}})});ig.baked=!0;
ig.module("plugins.audio.sound-player").defines(function(){SoundPlayer=ig.Class.extend({tagName:"SoundPlayer",stayMuteFlag:!1,debug:!1,init:function(){this.debug&&console.log(this.tagName)},play:function(b){this.debug&&console.log("play sound ",b)},stop:function(){this.debug&&console.log("stop sound ")},volume:function(){this.debug&&console.log("set volume")},mute:function(b){this.debug&&console.log("mute");"undefined"===typeof b?this.stayMuteFlag=!0:b&&(this.stayMuteFlag=!0)},unmute:function(b){this.debug&&
console.log("unmute");"undefined"===typeof b?this.stayMuteFlag=!1:b&&(this.stayMuteFlag=!1)}})});ig.baked=!0;
ig.module("plugins.audio.impact-music-player").requires("plugins.audio.sound-player").defines(function(){ImpactMusicPlayer=SoundPlayer.extend({tagName:"ImpactMusicPlayer",bgmPlaying:!1,soundList:{},init:function(b,f){this.parent(b,f);for(var e in b)this.soundList[e]=e,ig.music.add(b[e].path+".*",e);f&&f.loop&&(ig.music.loop=f.loop)},play:function(b){this.stayMuteFlag||(this.bgmPlaying=!0,"undefined"===typeof b?ig.music.play(b):ig.music.play())},stop:function(){this.bgmPlaying=!1;ig.music.pause()},
volume:function(b){console.log("impactmusic:",b);ig.music.volume=0>b?0:isNaN(b)?1:1<b?1:b},getVolume:function(){return ig.music.volume},mute:function(b){this.parent(b);this.bgmPlaying&&this.stop()},unmute:function(b){this.parent(b);this.play()}})});ig.baked=!0;
ig.module("plugins.audio.impact-sound-player").requires("plugins.audio.sound-player").defines(function(){ImpactSoundPlayer=SoundPlayer.extend({tagName:"ImpactSoundPlayer",soundList:{},init:function(b,f){this.parent(b,f);for(var e in b){var c=new ig.Sound(b[e].path+".*");this.soundList[e]=c}},play:function(b){this.stayMuteFlag||("object"===typeof b?(console.log(b+" exists"),b.play()):"string"===typeof b&&this.soundList[b].play())},stop:function(b){this.parent(b);b.stop()},volume:function(b){ig.soundManager.volume=
0>b?0:isNaN(b)?1:1<b?1:b},getVolume:function(){return ig.soundManager.volume},mute:function(b){this.parent(b);ig.Sound.enabled=!1},unmute:function(b){this.parent(b);ig.Sound.enabled=!0}})});ig.baked=!0;
ig.module("plugins.audio.howler-player").requires("plugins.audio.sound-player").defines(function(){HowlerPlayer=SoundPlayer.extend({tagName:"HowlerPlayer",soundList:{},init:function(b,f){this.parent(b,f);for(var e in b){var c=b[e].path,c=new Howl({urls:[c+"."+ig.Sound.FORMAT.OGG.ext,c+"."+ig.Sound.FORMAT.MP3.ext]});this.soundList[e]=c}},play:function(b){this.stayMuteFlag||("object"===typeof b?b.play():"string"===typeof b&&this.soundList[b].play())},stop:function(b){this.parent(b);b.stop()},volume:function(b){for(var f in this.soundList){if(0>
b){this.soundList[f].volume(0);break}isNaN(b)?this.soundList[f].volume(1):1<b?this.soundList[f].volume(1):this.soundList[f].volume(b)}},getVolume:function(){for(var b in this.soundList)return this.soundList[b].volume()},mute:function(b){this.parent(b);Howler.mute()},unmute:function(b){this.parent(b);Howler.unmute()}})});ig.baked=!0;
ig.module("plugins.audio.howler-music-player").requires("plugins.audio.sound-player").defines(function(){HowlerMusicPlayer=SoundPlayer.extend({tagName:"HowlerMusicPlayer",bgmPlaying:!1,soundList:{},init:function(b,f){this.parent(b,f);for(var e in b){var c=b[e].path,c=new Howl({urls:[c+"."+ig.Sound.FORMAT.OGG.ext,c+"."+ig.Sound.FORMAT.MP3.ext],loop:!0,autoplay:!1,onend:function(){}.bind(this)});this.soundList[e]=c}},play:function(b){if(!this.stayMuteFlag&&!this.bgmPlaying)if("object"===typeof b)this.bgmPlaying=
!0,b.play();else if("string"===typeof b)this.bgmPlaying=!0,this.soundList[b].play();else for(var f in this.soundList){this.soundList[f].play();this.bgmPlaying=!0;break}},stop:function(b){this.parent(b);if(this.bgmPlaying){for(var f in this.soundList)this.soundList[f].stop();this.bgmPlaying=!1}},volume:function(b){for(var f in this.soundList){if(0>b){this.soundList[f].volume(0);break}isNaN(b)?this.soundList[f].volume(1):1<b?this.soundList[f].volume(1):this.soundList[f].volume(b)}},getVolume:function(){for(var b in this.soundList)return this.soundList[b].volume()},
mute:function(b){this.parent(b);Howler.mute()},unmute:function(b){this.parent(b);Howler.unmute()}})});ig.baked=!0;
ig.module("plugins.audio.jukebox-player").requires("plugins.audio.sound-player").defines(function(){JukeboxPlayer=SoundPlayer.extend({tagName:"JukeboxPlayer",bgmPlaying:!1,soundList:{},jukeboxPlayer:null,pausePosition:0,premuteVolume:0,minVolume:0.0010,init:function(b,f){this.parent(b,f);for(var e in b){this.soundList[e]=e;var c=b[e].path;this.jukeboxPlayer=new jukebox.Player({resources:[c+"."+ig.Sound.FORMAT.OGG.ext,c+"."+ig.Sound.FORMAT.MP3.ext],autoplay:!1,spritemap:{music:{start:b[e].startMp3,
end:b[e].endMp3,loop:!0}}})}},play:function(){this.stayMuteFlag||(this.bgmPlaying=!0,this.pausePosition?(console.log("resume"),this.jukeboxPlayer.resume(this.pausePosition)):(console.log("play"),this.jukeboxPlayer.play(this.jukeboxPlayer.settings.spritemap.music.start,!0)),this.premuteVolume=this.getVolume())},stop:function(){this.bgmPlaying=!1;this.pausePosition=this.jukeboxPlayer.pause()},volume:function(b){console.log("jukebox:",b);0>=b?this.jukeboxPlayer.setVolume(this.minVolume):isNaN(b)?this.jukeboxPlayer.setVolume(1):
1<b?this.jukeboxPlayer.setVolume(1):this.jukeboxPlayer.setVolume(b)},getVolume:function(){return this.jukeboxPlayer.getVolume()},mute:function(b){this.parent(b);this.bgmPlaying&&(console.log("jukebox",this.premuteVolume),this.stayMuteFlag||(this.premuteVolume=this.getVolume()),this.jukeboxPlayer.pause(),this.jukeboxPlayer.setVolume(this.minVolume))},unmute:function(b){this.parent(b);this.stayMuteFlag||(console.log("jukebox",this.premuteVolume),this.jukeboxPlayer.setVolume(this.premuteVolume),this.jukeboxPlayer.resume())}})});
ig.baked=!0;
ig.module("plugins.audio.webaudio-music-player").requires("plugins.audio.sound-player").defines(function(){WebaudioMusicPlayer=SoundPlayer.extend({tagName:"WebaudioMusicPlayer",bgmPlaying:!1,isSupported:!1,muteFlag:!1,pausedTime:0,webaudio:null,useHTML5Audio:!1,audio:null,inactiveAudio:null,codecs:null,_volume:1,soundList:{},init:function(b){this.webaudio={compatibility:{},gainNode:null,buffer:null,source_loop:{},source_once:{}};try{this.AudioContext=window.AudioContext||window.webkitAudioContext,this.webaudio.context=
new this.AudioContext,this.isSupported=!0}catch(f){console.log("Web Audio API not supported in this browser."),this.webaudio=null,this.useHTML5Audio=!0}if(this.useHTML5Audio)if("undefined"!==typeof Audio)try{new Audio}catch(e){this.useHTML5Audio=!1}else this.useHTML5Audio=!1;this.useHTML5Audio&&(this.audio=new Audio,this.isSupported=!0,this.initHTML5Audio(b));if(!this.isSupported)return null;this.webaudio&&this.initWebAudio(b)},initWebAudio:function(b){ig.ua.iOS&&this.initIOSWebAudioUnlock();this.webaudio.gainNode=
this.webaudio.context.createGain();this.webaudio.gainNode.connect(this.webaudio.context.destination);this.webaudio.gainNode.gain.value=this._volume;var f="start",e="stop",c=this.webaudio.context.createBufferSource();"function"!==typeof c.start&&(f="noteOn");this.webaudio.compatibility.start=f;"function"!==typeof c.stop&&(e="noteOff");this.webaudio.compatibility.stop=e;for(var d in b){this.soundList[d]=d;f=b[d].path;b=f+"."+ig.Sound.FORMAT.MP3.ext;var g=f+"."+ig.Sound.FORMAT.OGG.ext;ig.ua.mobile?ig.ua.iOS&&
(g=b):(f=navigator.userAgent.toLowerCase(),-1!=f.indexOf("safari")&&-1>=f.indexOf("chrome")&&(g=b));var m=new XMLHttpRequest;m.open("GET",g,!0);m.responseType="arraybuffer";m.onload=function(){this.webaudio.context.decodeAudioData(m.response,function(b){this.webaudio.buffer=b;this.webaudio.source_loop={};this.bgmPlaying?this.play():this.stop()}.bind(this),function(){console.log('Error decoding audio "'+g+'".')})}.bind(this);m.send();break}},initIOSWebAudioUnlock:function(){if(this.webaudio){webaudio=
this.webaudio;var b=function(){var f=webaudio.context,e=f.createBuffer(1,1,22050),c=f.createBufferSource();c.buffer=e;c.connect(f.destination);"undefined"===typeof c.start?c.noteOn(0):c.start(0);setTimeout(function(){(c.playbackState===c.PLAYING_STATE||c.playbackState===c.FINISHED_STATE)&&window.removeEventListener("touchend",b,!1)},0)};window.addEventListener("touchend",b,!1)}},initHTML5Audio:function(b){if(this.useHTML5Audio&&this.audio){var f=this.audio;this.codecs={};this.codecs={mp3:!!f.canPlayType("audio/mpeg;").replace(/^no$/,
""),opus:!!f.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!f.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!f.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!f.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(f.canPlayType("audio/x-m4a;")||f.canPlayType("audio/m4a;")||f.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(f.canPlayType("audio/x-mp4;")||f.canPlayType("audio/mp4;")||f.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!f.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,
"")};this.is={ff:Boolean(null!=window.mozInnerScreenX&&/firefox/.test(navigator.userAgent.toLowerCase())),ie:Boolean(document.all&&!window.opera),opera:Boolean(window.opera),chrome:Boolean(window.chrome),safari:Boolean(!window.chrome&&/safari/.test(navigator.userAgent.toLowerCase())&&window.getComputedStyle&&!window.globalStorage&&!window.opera)};this.playDelay=-60;this.stopDelay=30;this.is.chrome&&(this.playDelay=-25);this.is.chrome&&(this.stopDelay=25);this.is.ff&&(this.playDelay=-25);this.is.ff&&
(this.stopDelay=85);this.is.opera&&(this.playDelay=5);this.is.opera&&(this.stopDelay=0);for(var e in b){this.soundList[e]=e;var c=b[e].path,f=c+"."+ig.Sound.FORMAT.OGG.ext,c=c+"."+ig.Sound.FORMAT.MP3.ext,d=null;this.codecs[ig.Sound.FORMAT.OGG.ext.toLowerCase()]?d=f:this.codecs[ig.Sound.FORMAT.MP3.ext.toLowerCase()]&&(d=c);if(d){ig.ua.mobile?ig.ua.iOS&&(d=c):(b=navigator.userAgent.toLowerCase(),-1!=b.indexOf("safari")&&-1>=b.indexOf("chrome")&&(d=c));this.audio.addEventListener("error",function(){this.audio.error&&
4===this.audio.error.code&&(this.isSupported=!1)},!1);this.audio.src=d;this.audio._pos=0;this.audio.preload="auto";this.audio.volume=this._volume;this.inactiveAudio=new Audio;this.inactiveAudio.src=d;this.inactiveAudio._pos=0;this.inactiveAudio.preload="auto";this.inactiveAudio.volume=this._volume;this.inactiveAudio.load();var g=function(){this._duration=this.audio.duration;this._loaded||(this._loaded=!0);this.bgmPlaying?this.play():this.stop();this.audio.removeEventListener("canplaythrough",g,!1)}.bind(this);
this.audio.addEventListener("canplaythrough",g,!1);this.audio.load();break}}}},play:function(b){if(this.isSupported)if(this.bgmPlaying=!0,this.webaudio)if(this.webaudio.buffer){if(!this.muteFlag&&(this.bgmPlaying=!0,!this.webaudio.source_loop._playing)){this.webaudio.source_loop=this.webaudio.context.createBufferSource();this.webaudio.source_loop.buffer=this.webaudio.buffer;this.webaudio.source_loop.loop=!0;this.webaudio.source_loop.connect(this.webaudio.gainNode);isNaN(b)&&(b=0,this.pausedTime&&
(b=this.pausedTime));this.webaudio.source_loop._startTime=this.webaudio.context.currentTime;if("noteOn"===this.webaudio.compatibility.start)this.webaudio.source_once=this.webaudio.context.createBufferSource(),this.webaudio.source_once.buffer=this.webaudio.buffer,this.webaudio.source_once.connect(this.webaudio.gainNode),this.webaudio.source_once.noteGrainOn(0,b,this.webaudio.buffer.duration-b),this.webaudio.source_loop[this.webaudio.compatibility.start](this.webaudio.context.currentTime+(this.webaudio.buffer.duration-
b));else this.webaudio.source_loop[this.webaudio.compatibility.start](0,b);this.webaudio.source_loop._playing=!0}}else this.bgmPlaying=!0;else if(this.audio){var f=this.audio;if(!this.muteFlag){this.bgmPlaying=!0;isNaN(b)&&(b=0,this.pausedTime&&(b=this.pausedTime));var e=this._duration-b;this._onEndTimer&&(clearTimeout(this._onEndTimer),this._onEndTimer=null);this._onEndTimer=setTimeout(function(){this.audio.currentTime=0;this.audio.pause();this.pausedTime=0;if(this.inactiveAudio){var b=this.audio;
this.audio=this.inactiveAudio;this.inactiveAudio=b}this.play()}.bind(this),1E3*e+this.playDelay);4===f.readyState||!f.readyState&&navigator.isCocoonJS?(f.readyState=4,f.currentTime=b,f.muted=this.muteFlag||f.muted,f.volume=this._volume,setTimeout(function(){f.play()},0)):(clearTimeout(this._onEndTimer),this._onEndTimer=null,function(){var b=function(){this.play();f.removeEventListener("canplaythrough",b,!1)}.bind(this);f.addEventListener("canplaythrough",b,!1)}())}}},stop:function(){this.bgmPlaying=
!1;if(this.isSupported)if(this.webaudio){if(this.webaudio.source_loop._playing&&(this.webaudio.source_loop[this.webaudio.compatibility.stop](0),this.webaudio.source_loop._playing=!1,this.pausedTime+=this.webaudio.context.currentTime-this.webaudio.source_loop._startTime,this.pausedTime%=this.webaudio.source_loop.buffer.duration,this.webaudio.source_loop._startTime=0,"noteOn"===this.webaudio.compatibility.start))this.webaudio.source_once[this.webaudio.compatibility.stop](0)}else if(this.audio){var b=
this.audio;this.pausedTime=b.currentTime;b.currentTime=0;b.pause();clearTimeout(this._onEndTimer);this._onEndTimer=null}},volume:function(b){this.isSupported&&(this._volume=b,0>this._volume?this._volume=0:1<this._volume&&(this._volume=1),this.webaudio?this.webaudio.gainNode&&(this.webaudio.gainNode.gain.value=this._volume):this.audio&&(this.audio.volume=this._volume,this.inactiveAudio&&(this.inactiveAudio.volume=this._volume)))},getVolume:function(){return!this.isSupported?0:this._volume},mute:function(b){this.parent(b);
!1==this.muteFlag&&(this.muteFlag=!0,this.bgmPlaying&&(this.stop(),this.bgmPlaying=!0))},unmute:function(b){this.parent(b);!this.stayMuteFlag&&!0==this.muteFlag&&(this.muteFlag=!1,this.bgmPlaying&&this.play())}})});ig.baked=!0;
ig.module("plugins.audio.sound-info").defines(function(){SoundInfo=ig.Class.extend({FORMATS:{OGG:".ogg",MP3:".mp3"},sfx:{kittyopeningSound:{path:"media/audio/opening/kittyopening"},staticSound:{path:"media/audio/play/static"},openingSound:{path:"media/audio/opening/opening"},place:{path:"media/audio/place"},click:{path:"media/audio/click"},combo1:{path:"media/audio/combo1"},combo2:{path:"media/audio/combo2"},combo3:{path:"media/audio/combo3"},combo4:{path:"media/audio/combo4"},combo5:{path:"media/audio/combo5"},
combo:{path:"media/audio/combo"}},bgm:{background:{path:"media/audio/bgm",startOgg:0,endOgg:21.463,startMp3:0,endMp3:21.463}}})});ig.baked=!0;
ig.module("plugins.audio.sound-handler").requires("plugins.audio.impact-music-player","plugins.audio.impact-sound-player","plugins.audio.howler-player","plugins.audio.howler-music-player","plugins.audio.jukebox-player","plugins.audio.webaudio-music-player","plugins.audio.sound-info").defines(function(){ig.SoundHandler=ig.Class.extend({bgmPlayer:null,sfxPlayer:null,focusBlurMute:!1,soundInfo:new SoundInfo,init:function(){console.log("Initiating sound handler");this.initWindowHandler();ig.ua.mobile?
(this.initPowerButtonFix(),this.bgmPlayer=new WebaudioMusicPlayer(this.soundInfo.bgm,{loop:!0}),this.bgmPlayer.isSupported||(this.bgmPlayer=new JukeboxPlayer(this.soundInfo.bgm,{loop:!0}))):(this.bgmPlayer=new WebaudioMusicPlayer(this.soundInfo.bgm,{loop:!0}),this.bgmPlayer.isSupported||(this.bgmPlayer=new ImpactMusicPlayer(this.soundInfo.bgm,{loop:!0})));this.sfxPlayer=new HowlerPlayer(this.soundInfo.sfx)},checkBGM:function(){return this.bgmPlayer.stayMuteFlag},checkSFX:function(){return this.sfxPlayer.stayMuteFlag},
muteSFX:function(b){this.sfxPlayer&&this.sfxPlayer.mute(b)},muteBGM:function(b){this.bgmPlayer&&this.bgmPlayer.mute(b)},unmuteSFX:function(b){this.sfxPlayer&&this.sfxPlayer.unmute(b)},unmuteBGM:function(b){this.bgmPlayer&&this.bgmPlayer.unmute(b)},muteAll:function(b){this.muteSFX(b);this.muteBGM(b)},unmuteAll:function(b){this.unmuteSFX(b);this.unmuteBGM(b)},forceMuteAll:function(){this.muteAll(!0)},forceUnMuteAll:function(){!1==this.focusBlurMute&&this.unmuteAll(!0)},initWindowHandler:function(){"true"===
ig.domHandler.getQueryVariable("webview")?($(window).focus(function(){ig.game&&ig.game.resumeGame();wgl.system&&wgl.system.startRender();ig.soundHandler&&ig.soundHandler.forceUnMuteAll()}),$(window).blur(function(){ig.game&&ig.game.pauseGame();wgl.system&&wgl.system.stopRender();ig.soundHandler&&ig.soundHandler.forceMuteAll()})):(window.onfocus=function(){ig.game&&ig.game.resumeGame();wgl.system&&wgl.system.startRender();ig.soundHandler&&ig.soundHandler.forceUnMuteAll()},window.onblur=function(){ig.game&&
ig.game.pauseGame();wgl.system&&wgl.system.stopRender();ig.soundHandler&&ig.soundHandler.forceMuteAll()})},initPowerButtonFix:function(){var b=this.getHiddenProp();b&&(b=b.replace(/[H|h]idden/,"")+"visibilitychange",document.addEventListener(b,this.visChange));window.addEventListener("pagehide",function(){ig.game&&ig.game.pauseGame();ig.soundHandler&&ig.soundHandler.forceMuteAll()},!1);window.addEventListener("pageshow",function(){ig.game&&ig.game.resumeGame();ig.soundHandler&&ig.soundHandler.forceUnMuteAll()},
!1)},getHiddenProp:function(){var b=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var f=0;f<b.length;f++)if(b[f]+"Hidden"in document)return b[f]+"Hidden";return null},isHidden:function(){var b=this.getHiddenProp();return!b?!1:document[b]},visChange:function(){ig.soundHandler.isHidden()?(ig.ua.mobile&&ig.game&&ig.game.pauseGame(),ig.soundHandler&&ig.soundHandler.forceMuteAll()):(ig.ua.mobile&&ig.game&&ig.game.resumeGame(),ig.soundHandler&&ig.soundHandler.forceUnMuteAll())},saveVolume:function(){this.sfxPlayer&&
ig.game.io.storageSet("soundVolume",this.sfxPlayer.getVolume());this.bgmPlayer&&ig.game.io.storageSet("musicVolume",this.bgmPlayer.getVolume())},forceLoopBGM:function(){var b;if(!this.focusBlurMute&&this.bgmPlayer.bgmPlaying&&this.bgmPlayer){var f=this.bgmPlayer.jukeboxPlayer;if(f){null!=window.mozInnerScreenX&&/firefox/.test(navigator.userAgent.toLowerCase());b=Boolean(window.chrome);!window.chrome&&/safari/.test(navigator.userAgent.toLowerCase());var e=0.1;ig.ua.mobile&&(e=0.115,ig.ua.android&&
(e=0.45,b&&(e=0.3)));f.settings.spritemap.music&&(b=f.settings.spritemap.music.end-e,f.getCurrentTime()>=b&&(b=f.settings.spritemap.music.start,ig.ua.android?this.forcelooped||(f.play(b,!0),this.forcelooped=!0,setTimeout(function(){ig.soundHandler.forcelooped=!1},e)):f.setCurrentTime(b)))}else"ImpactMusicPlayer"==this.bgmPlayer.tagName&&(null!=window.mozInnerScreenX&&/firefox/.test(navigator.userAgent.toLowerCase()),b=Boolean(window.chrome),!window.chrome&&/safari/.test(navigator.userAgent.toLowerCase()),
e=0.1,ig.ua.mobile&&(e=0.115,ig.ua.android&&(e=0.45,b&&(e=0.3))),f=0,"mp3"==ig.soundManager.format.ext&&(f=0.05),ig.music.currentTrack&&(b=ig.music.currentTrack.duration-e,ig.music.currentTrack.currentTime>=b&&(ig.ua.android?this.forcelooped||(ig.music.currentTrack.pause(),ig.music.currentTrack.currentTime=f,ig.music.currentTrack.play(),this.forcelooped=!0,setTimeout(function(){ig.soundHandler.forcelooped=!1},e)):ig.music.currentTrack.currentTime=f)))}}})});ig.baked=!0;
ig.module("plugins.io.storage").defines(function(){ig.Storage=ig.Class.extend({staticInstantiate:function(){return!ig.Storage.instance?null:ig.Storage.instance},init:function(){ig.Storage.instance=this},isCapable:function(){return"undefined"!==typeof window.localStorage},isSet:function(b){return null!==this.get(b)},initUnset:function(b,f){null===this.get(b)&&this.set(b,f)},get:function(b){if(!this.isCapable())return null;try{return JSON.parse(localStorage.getItem(b))}catch(f){return window.localStorage.getItem(b)}},
getInt:function(b){return~~this.get(b)},getFloat:function(b){return parseFloat(this.get(b))},getBool:function(b){return!!this.get(b)},key:function(b){return this.isCapable()?window.localStorage.key(b):null},set:function(b,f){if(!this.isCapable())return null;try{window.localStorage.setItem(b,JSON.stringify(f))}catch(e){console.log(e)}},setHighest:function(b,f){f>this.getFloat(b)&&this.set(b,f)},remove:function(b){if(!this.isCapable())return null;window.localStorage.removeItem(b)},clear:function(){if(!this.isCapable())return null;
window.localStorage.clear()}})});ig.baked=!0;
ig.module("plugins.io.mouse").defines(function(){Mouse=ig.Class.extend({bindings:{click:[ig.KEY.MOUSE1]},last:new BABYLON.Vector2.Zero,init:function(){ig.input.initMouse();for(var b in this.bindings){this[b]=b;for(var f=0;f<this.bindings[b].length;f++)ig.input.bind(this.bindings[b][f],b)}},getLast:function(){return this.last},getPos:function(){if(ig.ua.mobile)var b=ig.input.mouse.x/ig.sizeHandler.sizeRatio.x,f=ig.input.mouse.y/ig.sizeHandler.sizeRatio.y;else b=ig.input.mouse.x,f=ig.input.mouse.y;
this.last=new BABYLON.Vector2(b,f);return this.last.clone()}})});ig.baked=!0;ig.module("plugins.io.keyboard").defines(function(){Keyboard=ig.Class.extend({bindings:{jump:[ig.KEY.W,ig.KEY.UP_ARROW],moveright:[ig.KEY.D,ig.KEY.RIGHT_ARROW],moveleft:[ig.KEY.A,ig.KEY.LEFT_ARROW],shoot:[ig.KEY.S,ig.KEY.DOWN_ARROW,ig.KEY.SPACE]},init:function(){for(var b in this.bindings){this[b]=b;for(var f=0;f<this.bindings[b].length;f++)ig.input.bind(this.bindings[b][f],b)}}})});ig.baked=!0;
ig.module("plugins.io.gamepad-input").defines(function(){ig.PADKEY={BUTTON_0:0,PADBUTTON_1:1,BUTTON_2:2,BUTTON_3:3,BUTTON_LEFT_BUMPER:4,BUTTON_RIGHT_BUMPER:5,BUTTON_LEFT_TRIGGER:6,BUTTON_RIGHT_TRIGGER:7,BUTTON_LEFT_JOYSTICK:10,BUTTON_RIGHT_JOYSTICK:11,BUTTON_DPAD_UP:12,BUTTON_DPAD_DOWN:13,BUTTON_DPAD_LEFT:14,BUTTON_DPAD_RIGHT:15,BUTTON_MENU:16,AXIS_LEFT_JOYSTICK_X:0,AXIS_LEFT_JOYSTICK_Y:1,AXIS_RIGHT_JOYSTICK_X:2,AXIS_RIGHT_JOYSTICK_Y:3};ig.GamepadInput=ig.Class.extend({isInit:!1,isSupported:!1,list:[],
bindings:{},states:{},presses:{},releases:{},downLocks:{},upLocks:{},leftStick:{x:0,y:0},rightStick:{x:0,y:0},start:function(){if(!this.isInit){this.isInit=!0;var b=navigator.getGamepads||navigator.webkitGetGamepads;b&&(!navigator.getGamepads&&navigator.webkitGetGamepads&&(navigator.getGamepads=navigator.webkitGetGamepads),this.list=navigator.getGamepads());this.isSupported=b}},isAvailable:function(){return this.isInit&&this.isSupported},buttonPressed:function(b){return"object"==typeof b?b.pressed:
1==b},buttonDown:function(b){if(b=this.bindings[b])this.states[b]=!0,this.downLocks[b]||(this.presses[b]=!0,this.downLocks[b]=!0)},buttonUp:function(b){if((b=this.bindings[b])&&this.downLocks[b]&&!this.upLocks[b])this.states[b]=!1,this.releases[b]=!0,this.upLocks[b]=!0},clearPressed:function(){for(var b in this.releases)this.states[b]=!1,this.downLocks[b]=!1;this.releases={};this.presses={};this.upLocks={}},bind:function(b,f){this.bindings[b]=f},unbind:function(b){this.releases[this.bindings[b]]=
!0;this.bindings[b]=null},unbindAll:function(){this.bindings={};this.states={};this.presses={};this.releases={};this.downLocks={};this.upLocks={}},state:function(b){return this.states[b]},pressed:function(b){return this.presses[b]},released:function(b){return this.releases[b]},clamp:function(b,f,e){return b<f?f:b>e?e:b},pollGamepads:function(){if(this.isSupported){this.leftStick.x=0;this.leftStick.y=0;this.rightStick.x=0;this.rightStick.y=0;this.list=navigator.getGamepads();for(var b in this.bindings){for(var f=
!1,e=0;e<this.list.length;e++){var c=this.list[e];if(c&&c.buttons&&this.buttonPressed(c.buttons[b])){f=!0;break}}f?this.buttonDown(b):this.buttonUp(b)}for(e=0;e<this.list.length;e++)if((c=this.list[e])&&c.axes){b=c.axes[ig.GAMEPADINPUT.AXIS_LEFT_JOYSTICK_X];var f=c.axes[ig.GAMEPADINPUT.AXIS_LEFT_JOYSTICK_Y],d=c.axes[ig.GAMEPADINPUT.AXIS_RIGHT_JOYSTICK_X],c=c.axes[ig.GAMEPADINPUT.AXIS_RIGHT_JOYSTICK_Y];this.leftStick.x+=isNaN(b)?0:b;this.leftStick.y+=isNaN(f)?0:f;this.rightStick.x+=isNaN(d)?0:d;this.rightStick.y+=
isNaN(c)?0:c}0<this.list.length&&(this.leftStick.x=this.clamp(this.leftStick.x,-1,1),this.leftStick.y=this.clamp(this.leftStick.y,-1,1),this.rightStick.x=this.clamp(this.rightStick.x,-1,1),this.rightStick.y=this.clamp(this.rightStick.y,-1,1))}}})});ig.baked=!0;
ig.module("plugins.io.gamepad").requires("plugins.io.gamepad-input").defines(function(){Gamepad=ig.Class.extend({bindings:{padJump:[ig.PADKEY.BUTTON_0]},init:function(){ig.gamepadInput.start();for(var b in this.bindings)for(var f=0;f<this.bindings[b].length;f++)ig.gamepadInput.bind(this.bindings[b][f],b)},press:function(){},held:function(){},release:function(){}})});ig.baked=!0;
ig.module("plugins.io.multitouch-input").defines(function(){ig.MultitouchInput=ig.Class.extend({isStart:!1,touches:{},pressed:[],state:[],released:[],multitouchCapable:!1,lastEventUp:null,internalWidth:1,internalHeight:1,scaleX:1,scaleY:1,start:function(){this.isStart||(this.isStart=!0,navigator.maxTouchPoints&&1<navigator.maxTouchPoints&&(this.multitouchCapable=!0),ig.ua.touchDevice&&(window.navigator.msPointerEnabled&&(ig.system.canvas.addEventListener("MSPointerDown",this.touchdown.bind(this),
!1),ig.system.canvas.addEventListener("MSPointerUp",this.touchup.bind(this),!1),ig.system.canvas.addEventListener("MSPointerMove",this.touchmove.bind(this),!1),ig.system.canvas.style.msContentZooming="none",ig.system.canvas.style.msTouchAction="none"),ig.system.canvas.addEventListener("touchstart",this.touchdown.bind(this),!1),ig.system.canvas.addEventListener("touchend",this.touchup.bind(this),!1),ig.system.canvas.addEventListener("touchmove",this.touchmove.bind(this),!1)))},touchdown:function(b){if(ig.ua.touchDevice)if(this.updateSizeProperties(),
window.navigator.msPointerEnabled)this.windowKeyDown(b);else if(b.touches){this.pollMultitouch(b.touches.length);this.updateSizeProperties();var f={left:0,top:0};ig.system.canvas.getBoundingClientRect&&(f=ig.system.canvas.getBoundingClientRect());for(var e=[],c=0;c<b.touches.length;c++)e.push(b.touches[c]);this.spliceFromArray(e,this.pressed);this.spliceFromArray(e,this.state);this.spliceFromArray(e,this.released);for(c=0;c<e.length;c++)b=e[c],this.pressed.push({identifier:b.identifier,x:(b.clientX-
f.left)/this.scaleX,y:(b.clientY-f.top)/this.scaleY})}},touchmove:function(b){if(ig.ua.touchDevice)if(this.updateSizeProperties(),window.navigator.msPointerEnabled)this.windowMove(b);else if(b.touches){this.pollMultitouch(b.touches.length);for(var f=0;f<b.touches.length;f++){var e=b.touches[f];this.upgrade(this.pressed,this.state,e);this.updateArray(this.state,e)}}},touchup:function(b){if(ig.ua.touchDevice)if(this.updateSizeProperties(),window.navigator.msPointerEnabled)this.windowKeyUp(b);else if(this.lastEventUp=
b,b.touches)for(var f=0;f<b.changedTouches.length;f++){var e=b.changedTouches[f];this.upgrade(this.state,this.released,e);this.upgrade(this.pressed,this.released,e)}},windowKeyDown:function(b){b=b.changedTouches?b.changedTouches:[b];this.pollMultitouch(b.length);this.updateSizeProperties();for(var f=[],e=0;e<b.length;e++)f.push(b[e]);var c={left:0,top:0};ig.system.canvas.getBoundingClientRect&&(c=ig.system.canvas.getBoundingClientRect());this.spliceFromArray(f,this.pressed);this.spliceFromArray(f,
this.state);this.spliceFromArray(f,this.released);for(e=0;e<f.length;e++){var d=b[e];this.pressed.push({identifier:"undefined"!=typeof d.identifier?d.identifier:"undefined"!=typeof d.pointerId?d.pointerId:1,x:(d.clientX-c.left)/this.scaleX,y:(d.clientY-c.top)/this.scaleY})}},windowKeyUp:function(b){this.lastEventUp=b;b=b.changedTouches?b.changedTouches:[b];for(var f=0;f<b.length;f++){var e=b[f],e={identifier:"undefined"!=typeof e.identifier?e.identifier:"undefined"!=typeof e.pointerId?e.pointerId:
1,clientX:e.clientX,clientY:e.clientY};this.upgrade(this.state,this.released,e);this.upgrade(this.pressed,this.released,e)}},windowMove:function(b){b=b.changedTouches?b.changedTouches:[b];this.pollMultitouch(b.length);for(var f=0;f<b.length;f++){var e=b[f],e={identifier:e.pointerId,clientX:e.clientX,clientY:e.clientY};this.upgrade(this.pressed,this.state,e);this.updateArray(this.state,e)}},clear:function(){for(var b=0;b<this.released.length;++b)this.released[b]&&(this.released.splice(b,1),b--)},pollMultitouch:function(b){!this.multitouchCapable&&
1<b&&(this.multitouchCapable=!0)},spliceFromArray:function(b,f){for(var e=0;e<f.length;e++)for(var c=0;c<b.length;c++)b[c].identifier===f[e].identifier&&(b.splice(c,1),c--)},updateSizeProperties:function(){var b=parseInt(ig.system.canvas.offsetWidth)||ig.system.realWidth,f=parseInt(ig.system.canvas.offsetHeight)||ig.system.realHeight;this.scaleX=ig.system.scale*(b/ig.system.realWidth);this.scaleY=ig.system.scale*(f/ig.system.realHeight)},upgrade:function(b,f,e){var c={left:0,top:0};ig.system.canvas.getBoundingClientRect&&
(c=ig.system.canvas.getBoundingClientRect());for(var d=(e.clientX-c.left)/this.scaleX,c=(e.clientY-c.top)/this.scaleY,g=0;g<b.length;g++)if(void 0!==typeof b[g].identifier&&void 0!==typeof e.identifier&&e.identifier===b[g].identifier){b.splice(g,1);f.push({identifier:e.identifier,x:d,y:c});break}},updateArray:function(b,f){var e={left:0,top:0};ig.system.canvas.getBoundingClientRect&&(e=ig.system.canvas.getBoundingClientRect());for(var c=(f.clientX-e.left)/this.scaleX,e=(f.clientY-e.top)/this.scaleY,
d=0;d<b.length;d++)if(void 0!==typeof b[d].identifier&&void 0!==typeof f.identifier&&f.identifier===b[d].identifier){b[d].x=c;b[d].y=e;break}}})});ig.baked=!0;
ig.module("plugins.io.io-manager").requires("plugins.io.storage","plugins.io.mouse","plugins.io.keyboard","plugins.io.gamepad","plugins.io.multitouch-input","plugins.io.gamepad-input").defines(function(){IoManager=ig.Class.extend({storage:null,localStorageSupport:!1,gamekey:"SurviveTheRoom",mouse:null,keyboard:null,multitouch:null,gamepad:null,init:function(){ig.multitouchInput=new ig.MultitouchInput;ig.gamepadInput=new ig.GamepadInput;this.unbindAll();this.initStorage();this.initMouse();this.initKeyboard();
this.initMultitouch()},unbindAll:function(){ig.input.unbindAll();ig.gamepadInput.unbindAll()},initStorage:function(){this._supportsLocalStorage()&&(this.storage=new ig.Storage)},initMouse:function(){this.mouse=new Mouse},initKeyboard:function(){this.keyboard=new Keyboard},initMultitouch:function(){ig.multitouchInput.start()},initGamepad:function(){this.gamepad=new Gamepad},press:function(b){return ig.input.pressed(b)?!0:!1},held:function(b){return ig.input.state(b)||this.gamepad.state(b)?!0:!1},release:function(b){return ig.input.released(b)||
this.gamepad.released(b)?!0:!1},getClickPos:function(){return this.mouse.getPos()},getLastClickPos:function(){return this.mouse.getLast()},getTouchesPos:function(){return this.multitouch.getTouchesPos()},checkOverlap:function(b,f,e,c,d){return b.x>f+c||b.x<f||b.y>e+d||b.y<e?!1:!0},clear:function(){ig.multitouchInput.clear()},_supportsLocalStorage:function(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),this.localStorageSupport="localStorage"in window&&null!==window.localStorage}catch(b){return this.localStorageSupport}},
storageIsSet:function(b){return!this.localStorageSupport?null:this.storage.isSet(b)},storageGet:function(b){return!this.localStorageSupport?null:this.storage.get(b)},storageSet:function(b,f){if(!this.localStorageSupport)return null;this.storage.set(b,f)},assert:function(b,f,e){if(f!==e)throw"actualValue:"+f+" not equal to testValue:"+e+" at "+b;}})});ig.baked=!0;
ig.module("plugins.splash-loader").requires("impact.loader","impact.animation").defines(function(){ig.SplashLoader=ig.Loader.extend({bg:new ig.Image("media/graphics/splash/background.png"),frame:new ig.Image("media/graphics/splash/loading-frame.png"),barImage:new ig.Image("media/graphics/splash/loading-bar.png"),rainbowLetters:[],stackerLetters:[],rainbow0:{},rainbow1:{},rainbow2:{},rainbow3:{},rainbow4:{},rainbow5:{},rainbow6:{},titleTurnIndex:0,titleAlp:1,minus:!0,h:0,rainbowX:[33,102,155,208,277,
347,430],stackerX:[11,79,151,220,293,365,435],init:function(b,f){ig.system.context.font="0pt sketch-block";ig.system.context.fillText("",0,0);ig.system.context.restore();this.lastUpdate=Date.now();this.parent(b,f);var e=ig.domHandler.getElementById("#game"),c=ig.domHandler.getElementById("#webgl");ig.domHandler.setZIndex(e,1);ig.domHandler.setZIndex(c,0);ig.apiHandler.run("MJSPreroll");this.ctx=ig.system.context;this.processText();this.bar={x:0.5*ig.system.width,y:0.75*ig.system.height,w:0.6*ig.system.width,
h:15,gap:8}},end:function(){this.parent();if(ig.ua.mobile){var b=ig.domHandler.getElementById("#play");ig.domHandler.show(b)}ig.system.setGame(MyGame)},setupCustomAnimation:function(){this.customAnim=new ig.Animation(this.customAnim,0.05,[0,1,2,3,4,5]);this.customAnim.currentFrame=0;ig.loadingScreen=this;ig.loadingScreen.animationTimer=window.setInterval("ig.loadingScreen.animate()",100)},animate:function(){this.customAnim.currentFrame<this.customAnim.sequence.length?this.customAnim.currentFrame++:
this.customAnim.currentFrame=0;this.customAnim.gotoFrame(this.customAnim.currentFrame)},processText:function(){this.rainbowText=_STRINGS.Game.RAINBOW;this.stackerText=_STRINGS.Game.STACKER;this.textSet(100,"white");this.rainbowWidth=477;this.rainbowStart=ig.system.width/2-this.rainbowWidth/2;for(var b=this.rainbowText.split(""),f=0;f<b.length;f++)this["rainbow"+f]={tx:b[f],x:this.rainbowX[f],offX:0,scX:1,scY:1,h:360*(f/7)},this.rainbowLetters.push(this["rainbow"+f]);this.textSet(40,"white");this.stackerWidth=
179;b=this.stackerText.split("");this.stackerGap=Math.floor((0.95*this.rainbowWidth-this.stackerWidth)/(this.stackerText.length-1));this.stackerStart=ig.system.width/2-0.95*(this.rainbowWidth/2);for(f=0;f<b.length;f++)this.stackerLetters.push({tx:b[f],x:this.stackerX[f],offX:0,scX:1,scY:1,alp:this.titleAlp})},turnTitle:function(){!0==this.minus?-1>this.rainbowLetters[this.titleTurnIndex].scX?(this.rainbowLetters[this.titleTurnIndex].scX=-1,this.minus=!1):this.rainbowLetters[this.titleTurnIndex].scX-=
0.1*this.dt:1<this.rainbowLetters[this.titleTurnIndex].scX?(this.rainbowLetters[this.titleTurnIndex].scX=1,this.minus=!0,this.titleTurnIndex=(this.titleTurnIndex+1)%7):this.rainbowLetters[this.titleTurnIndex].scX+=0.1*this.dt},drawTitle:function(){for(var b=0;7>b;b++)this.textDraw({tx:this.rainbowLetters[b].tx,px:120,x:this.rainbowStart+this.rainbowLetters[b].x,y:0.24*ig.system.height,col:"hsl("+this.rainbowLetters[b].h+",80%,80%)",alp:this.titleAlp,scX:this.rainbowLetters[b].scX,scY:0.85});for(b=
0;7>b;b++)this.textDraw({tx:this.stackerLetters[b].tx,px:40,x:this.stackerStart+this.stackerLetters[b].x,y:0.31*ig.system.height,col:"white",alp:this.titleAlp})},textSet:function(b,f,e,c){this.ctxRef=c=c||ig.system.context;c.font=b+"px "+(e||"typo");c.fillStyle=f},textW:function(b){return this.ctxRef.measureText(b).width},textMax:function(b){this.textSet(b.px,"white");return this.textW(b.tx)>b.maxWidth?b.maxWidth/this.textW(b.tx):1},textDraw:function(b){var f=b.rot?b.rot:0,e=b.tx?b.tx:0,c=b.x?b.x:
0,d=b.y?b.y:0,g=void 0==b.scX?1:b.scX,m=void 0==b.scY?1:b.scY,j=void 0==b.scX?1:b.scX,l=void 0==b.scY?1:b.scY,n=b.stroke?b.stroke:!1,q=void 0==b.strokeAlp?1:b.strokeAlp,p=b.strokeColour?b.strokeColour:"black",r=void 0==b.alp?1:b.alp,t=b.col?b.col:this.ctx.fillStyle,s=b.font||"typo",u=b.px||10,x=b.strokeLine||3,y=b.align||"center";if(0!=r){var z=b.ctx||ig.system.context;this.ctxRef=b.ctx||ig.system.context;z.font=u+"px "+s;void 0!=b.maxWidth&&this.textW(e)*g>b.maxWidth&&(j=b.maxWidth/this.textW(e),
l=m/g*j);"left"==y?c+=0.5*this.textW(e)*j:"right"==y&&(c-=0.5*this.textW(e)*j);z.save();b=z.measureText("M").width*l;z.translate(c,d+b/2);z.scale(j,l);z.rotate(f?2*Math.PI/360*f:0);z.fillStyle=t;!0==n&&(z.globalAlpha=q,z.lineWidth=x,z.lineCap="round",z.strokeStyle=p,z.strokeText(e,-this.textW(e)/2,0));z.globalAlpha=r;z.fillText(e,-this.textW(e)/2,0);z.restore()}},draw:function(){var b=Date.now();this.dt=b-this.lastUpdate;this.lastUpdate=b;this._drawStatus+=(this.status-this._drawStatus)/5;b=ig.system.scale;
ig.system.context.fillStyle="#58495d";ig.system.context.fillRect(0,0,ig.system.width,ig.system.height);var f,e,c;f=this.frame.width;e=this.frame.height;c=0.5*ig.system.width-f/2;this.bg.draw(0,0);0<this.frame.width*b&&(this.frame.draw(c*b,500*b),this.barImage.draw(c*b,500*b,0,0,f*b*this._drawStatus,e*b))}})});ig.baked=!0;
ig.module("babylon.plugins.wgl-entity").defines(function(){wgl.Entity=ig.Class.extend({pos:null,vel:null,acc:null,material:null,mesh:null,meshes:[],_killed:!1,init:function(b,f,e,c){this.pos=new BABYLON.Vector3(0,0,0);this.vel=new BABYLON.Vector3(0,0,0);this.acc=new BABYLON.Vector3(0,0,0);c&&c.mesh&&this.meshes.push(c.mesh);isNaN(b)||(this.pos.x=b);isNaN(f)||(this.pos.y=f);isNaN(e)||(this.pos.z=e);ig.merge(this,c)},tweener:function(b,f,e,c,d){var g={};g[b]=f;null==d&&(d=0);null==c&&(c="none");this.tween("this"==
b?f:g,e,{delay:d,targ:b,seq:c,onComplete:function(){null!=c&&this.tweenF(c,b)}.bind(this),easing:ig.Tween.Easing.Quadratic.EaseOut}).start()},update:function(){},render:function(){},kill:function(){for(var b=0;b<this.meshes.length;b++){var f=this.meshes[b];wgl.game.currentScene.stopAnimation(f);f.dispose();this.meshes.splice(b,1);b--}this._killed=!0},reset:function(){},resize:function(){}})});ig.baked=!0;
ig.module("plugins.tween").requires("impact.entity","babylon.plugins.wgl-entity").defines(function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(b){for(var f=0;f<this.length;++f)if(this[f]===b)return f;return-1});ig.Entity.prototype.tweens=[];ig.Entity.prototype._preTweenUpdate=ig.Entity.prototype.update;ig.Entity.prototype.update=function(){this._preTweenUpdate();if(0<this.tweens.length){for(var b=[],f=0;f<this.tweens.length;f++)this.tweens[f].update(),this.tweens[f].complete||b.push(this.tweens[f]);
this.tweens=b}};ig.Entity.prototype.tween=function(b,f,e){b=new ig.Tween(this,b,f,e);this.tweens.push(b);return b};ig.Entity.prototype.pauseTweens=function(){for(var b=0;b<this.tweens.length;b++)this.tweens[b].pause()};ig.Entity.prototype.resumeTweens=function(){for(var b=0;b<this.tweens.length;b++)this.tweens[b].resume()};ig.Entity.prototype.stopTweens=function(b){for(var f=0;f<this.tweens.length;f++)this.tweens[f].stop(b)};wgl.Entity.prototype.tweens=[];wgl.Entity.prototype._preTweenUpdate=wgl.Entity.prototype.update;
wgl.Entity.prototype.update=function(){this._preTweenUpdate();if(0<this.tweens.length){for(var b=[],f=0;f<this.tweens.length;f++)this.tweens[f].update(),this.tweens[f].complete||b.push(this.tweens[f]);this.tweens=b}};wgl.Entity.prototype.tween=function(b,f,e){b=new ig.Tween(this,b,f,e);this.tweens.push(b);return b};wgl.Entity.prototype.pauseTweens=function(){for(var b=0;b<this.tweens.length;b++)this.tweens[b].pause()};wgl.Entity.prototype.resumeTweens=function(){for(var b=0;b<this.tweens.length;b++)this.tweens[b].resume()};
wgl.Entity.prototype.stopTweens=function(b){for(var f=0;f<this.tweens.length;f++)this.tweens[f].stop(b)};ig.Tween=function(b,f,e,c){var d={},g={},m={},j=0,l=!1,n=!1,q=!1;this.duration=e;this.paused=this.complete=!1;this.easing=ig.Tween.Easing.Linear.EaseNone;this.onComplete=!1;this.loop=this.delay=0;this.loopCount=-1;ig.merge(this,c);this.loopNum=this.loopCount;this.chain=function(b){q=b};this.initEnd=function(b,c,d){if("object"!==typeof c[b])d[b]=c[b];else for(subprop in c[b])d[b]||(d[b]={}),this.initEnd(subprop,
c[b],d[b])};this.initStart=function(b,c,d,e){if("object"!==typeof d[b])"undefined"!==typeof c[b]&&(e[b]=d[b]);else for(subprop in d[b])e[b]||(e[b]={}),"undefined"!==typeof c[b]&&this.initStart(subprop,c[b],d[b],e[b])};this.start=function(){this.paused=this.complete=!1;this.loopNum=this.loopCount;j=0;-1==b.tweens.indexOf(this)&&b.tweens.push(this);n=!0;l=new ig.Timer;for(var c in f)this.initEnd(c,f,g);for(c in g)this.initStart(c,g,b,d),this.initDelta(c,m,b,g)};this.initDelta=function(b,c,d,e){if("object"!==
typeof e[b])c[b]=e[b]-d[b];else for(subprop in e[b])c[b]||(c[b]={}),this.initDelta(subprop,c[b],d[b],e[b])};this.propUpdate=function(b,c,d,e,f){if("object"!==typeof d[b])c[b]="undefined"!=typeof d[b]?d[b]+e[b]*f:c[b];else for(subprop in d[b])this.propUpdate(subprop,c[b],d[b],e[b],f)};this.propSet=function(b,c,d){if("object"!==typeof c[b])d[b]=c[b];else for(subprop in c[b])d[b]||(d[b]={}),this.propSet(subprop,c[b],d[b])};this.update=function(){if(!n)return!1;if(this.delay){if(l.delta()<this.delay)return;
this.delay=0;l.reset()}if(this.paused||this.complete)return!1;var c=(l.delta()+j)/this.duration,c=1<c?1:c,e=this.easing(c);for(property in m)this.propUpdate(property,b,d,m,e);if(1<=c){if(0==this.loopNum||!this.loop){this.complete=!0;if(this.onComplete)this.onComplete();q&&q.start();return!1}if(this.loop==ig.Tween.Loop.Revert){for(property in d)this.propSet(property,d,b);j=0;l.reset();-1!=this.loopNum&&this.loopNum--}else if(this.loop==ig.Tween.Loop.Reverse){c={};e={};ig.merge(c,g);ig.merge(e,d);ig.merge(d,
c);ig.merge(g,e);for(property in g)this.initDelta(property,m,b,g);j=0;l.reset();-1!=this.loopNum&&this.loopNum--}}};this.pause=function(){this.paused=!0;j+=l.delta()};this.resume=function(){this.paused=!1;l.reset()};this.stop=function(b){b&&(this.loop=this.complete=this.paused=!1,j+=e,this.update());this.complete=!0}};ig.Tween.Loop={Revert:1,Reverse:2};ig.Tween.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}};ig.Tween.Easing.Linear.EaseNone=
function(b){return b};ig.Tween.Easing.Quadratic.EaseIn=function(b){return b*b};ig.Tween.Easing.Quadratic.EaseOut=function(b){return-b*(b-2)};ig.Tween.Easing.Quadratic.EaseInOut=function(b){return 1>(b*=2)?0.5*b*b:-0.5*(--b*(b-2)-1)};ig.Tween.Easing.Cubic.EaseIn=function(b){return b*b*b};ig.Tween.Easing.Cubic.EaseOut=function(b){return--b*b*b+1};ig.Tween.Easing.Cubic.EaseInOut=function(b){return 1>(b*=2)?0.5*b*b*b:0.5*((b-=2)*b*b+2)};ig.Tween.Easing.Quartic.EaseIn=function(b){return b*b*b*b};ig.Tween.Easing.Quartic.EaseOut=
function(b){return-(--b*b*b*b-1)};ig.Tween.Easing.Quartic.EaseInOut=function(b){return 1>(b*=2)?0.5*b*b*b*b:-0.5*((b-=2)*b*b*b-2)};ig.Tween.Easing.Quintic.EaseIn=function(b){return b*b*b*b*b};ig.Tween.Easing.Quintic.EaseOut=function(b){return(b-=1)*b*b*b*b+1};ig.Tween.Easing.Quintic.EaseInOut=function(b){return 1>(b*=2)?0.5*b*b*b*b*b:0.5*((b-=2)*b*b*b*b+2)};ig.Tween.Easing.Sinusoidal.EaseIn=function(b){return-Math.cos(b*Math.PI/2)+1};ig.Tween.Easing.Sinusoidal.EaseOut=function(b){return Math.sin(b*
Math.PI/2)};ig.Tween.Easing.Sinusoidal.EaseInOut=function(b){return-0.5*(Math.cos(Math.PI*b)-1)};ig.Tween.Easing.Exponential.EaseIn=function(b){return 0==b?0:Math.pow(2,10*(b-1))};ig.Tween.Easing.Exponential.EaseOut=function(b){return 1==b?1:-Math.pow(2,-10*b)+1};ig.Tween.Easing.Exponential.EaseInOut=function(b){return 0==b?0:1==b?1:1>(b*=2)?0.5*Math.pow(2,10*(b-1)):0.5*(-Math.pow(2,-10*(b-1))+2)};ig.Tween.Easing.Circular.EaseIn=function(b){return-(Math.sqrt(1-b*b)-1)};ig.Tween.Easing.Circular.EaseOut=
function(b){return Math.sqrt(1- --b*b)};ig.Tween.Easing.Circular.EaseInOut=function(b){return 1>(b/=0.5)?-0.5*(Math.sqrt(1-b*b)-1):0.5*(Math.sqrt(1-(b-=2)*b)+1)};ig.Tween.Easing.Elastic.EaseIn=function(b){var f,e=0.1,c=0.4;if(0==b)return 0;if(1==b)return 1;c||(c=0.3);!e||1>e?(e=1,f=c/4):f=c/(2*Math.PI)*Math.asin(1/e);return-(e*Math.pow(2,10*(b-=1))*Math.sin((b-f)*2*Math.PI/c))};ig.Tween.Easing.Elastic.EaseOut=function(b){var f,e=0.1,c=0.4;if(0==b)return 0;if(1==b)return 1;c||(c=0.3);!e||1>e?(e=1,
f=c/4):f=c/(2*Math.PI)*Math.asin(1/e);return e*Math.pow(2,-10*b)*Math.sin((b-f)*2*Math.PI/c)+1};ig.Tween.Easing.Elastic.EaseInOut=function(b){var f,e=0.1,c=0.4;if(0==b)return 0;if(1==b)return 1;c||(c=0.3);!e||1>e?(e=1,f=c/4):f=c/(2*Math.PI)*Math.asin(1/e);return 1>(b*=2)?-0.5*e*Math.pow(2,10*(b-=1))*Math.sin((b-f)*2*Math.PI/c):0.5*e*Math.pow(2,-10*(b-=1))*Math.sin((b-f)*2*Math.PI/c)+1};ig.Tween.Easing.Back.EaseIn=function(b){return b*b*(2.70158*b-1.70158)};ig.Tween.Easing.Back.EaseOut=function(b){return(b-=
1)*b*(2.70158*b+1.70158)+1};ig.Tween.Easing.Back.EaseInOut=function(b){return 1>(b*=2)?0.5*b*b*(3.5949095*b-2.5949095):0.5*((b-=2)*b*(3.5949095*b+2.5949095)+2)};ig.Tween.Easing.Bounce.EaseIn=function(b){return 1-ig.Tween.Easing.Bounce.EaseOut(1-b)};ig.Tween.Easing.Bounce.EaseOut=function(b){return(b/=1)<1/2.75?7.5625*b*b:b<2/2.75?7.5625*(b-=1.5/2.75)*b+0.75:b<2.5/2.75?7.5625*(b-=2.25/2.75)*b+0.9375:7.5625*(b-=2.625/2.75)*b+0.984375};ig.Tween.Easing.Bounce.EaseInOut=function(b){return 0.5>b?0.5*ig.Tween.Easing.Bounce.EaseIn(2*
b):0.5*ig.Tween.Easing.Bounce.EaseOut(2*b-1)+0.5}});ig.baked=!0;
ig.module("plugins.url-parameters").defines(function(){ig.UrlParameters=ig.Class.extend({init:function(){switch(getQueryVariable("iphone")){case "true":ig.ua.iPhone=!0,console.log("iPhone mode")}var b=getQueryVariable("webview");if(b)switch(b){case "true":ig.ua.is_uiwebview=!0,console.log("webview mode")}if(b=getQueryVariable("debug"))switch(b){case "true":ig.game.showDebugMenu(),console.log("debug mode")}if(b=getQueryVariable("debugwgl"))switch(b){case "true":wgl.debug.debug=!0,console.log("wgl debug mode")}switch(getQueryVariable("view")){case "stats":ig.game.resetPlayerStats(),
ig.game.endGame()}getQueryVariable("ad")}})});ig.baked=!0;
ig.module("plugins.director").requires("impact.impact").defines(function(){ig.Director=ig.Class.extend({init:function(b,f){this.game=b;this.levels=[];this.currentLevel=0;this.append(f)},loadLevel:function(b){for(var f in ig.sizeHandler.dynamicClickableEntityDivs){var e=ig.domHandler.getElementById("#"+f);ig.domHandler.hide(e)}this.currentLevel=b;this.game.loadLevel(this.levels[b]);return!0},loadLevelWithoutEntities:function(b){this.currentLevel=b;this.game.loadLevelWithoutEntities(this.levels[b]);
return!0},append:function(b){newLevels=[];return"object"===typeof b?(b.constructor===[].constructor?newLevels=b:newLevels[0]=b,this.levels=this.levels.concat(newLevels),!0):!1},nextLevel:function(){return this.currentLevel+1<this.levels.length?this.loadLevel(this.currentLevel+1):!1},previousLevel:function(){return 0<=this.currentLevel-1?this.loadLevel(this.currentLevel-1):!1},jumpTo:function(b){var f=null;for(i=0;i<this.levels.length;i++)this.levels[i]==b&&(f=i);return 0<=f?this.loadLevel(f):!1},
firstLevel:function(){return this.loadLevel(0)},lastLevel:function(){return this.loadLevel(this.levels.length-1)},reloadLevel:function(){return this.loadLevel(this.currentLevel)}})});ig.baked=!0;
ig.module("plugins.impact-storage").requires("impact.game").defines(function(){ig.Storage=ig.Class.extend({staticInstantiate:function(){return!ig.Storage.instance?null:ig.Storage.instance},init:function(){ig.Storage.instance=this},isCapable:function(){return"undefined"!==typeof window.localStorage},isSet:function(b){return null!==this.get(b)},initUnset:function(b,f){null===this.get(b)&&this.set(b,f)},get:function(b){if(!this.isCapable())return null;try{return JSON.parse(localStorage.getItem(b))}catch(f){return window.localStorage.getItem(b)}},
getInt:function(b){return~~this.get(b)},getFloat:function(b){return parseFloat(this.get(b))},getBool:function(b){return!!this.get(b)},key:function(b){return this.isCapable()?window.localStorage.key(b):null},set:function(b,f){if(!this.isCapable())return null;try{window.localStorage.setItem(b,JSON.stringify(f))}catch(e){console.log(e)}},setHighest:function(b,f){f>this.getFloat(b)&&this.set(b,f)},remove:function(b){if(!this.isCapable())return null;window.localStorage.removeItem(b)},clear:function(){if(!this.isCapable())return null;
window.localStorage.clear()}})});this.START_BRANDING_SPLASH;ig.baked=!0;
ig.module("plugins.branding.splash").requires("impact.impact","impact.entity").defines(function(){ig.BrandingSplash=ig.Class.extend({init:function(){ig.game.spawnEntity(EntityBranding,0,0);console.log("spawn branding")}});EntityBranding=ig.Entity.extend({gravityFactor:0,size:{x:32,y:32},splash:new ig.Image("branding/splash1.png"),init:function(b,f,e){this.parent(b,f,e);320>=ig.system.width?(this.size.x=320,this.size.y=200):(this.size.x=480,this.size.y=240);this.pos.x=(ig.system.width-this.size.x)/
2;this.pos.y=-this.size.y-200;this.endPosY=(ig.system.height-this.size.y)/2;b=this.tween({pos:{y:this.endPosY}},0.5,{easing:ig.Tween.Easing.Bounce.EaseIn});f=this.tween({},2.5,{onComplete:function(){ig.game.director.loadLevel(ig.game.director.currentLevel)}});b.chain(f);b.start();this.currentAnim=this.anims.idle},createClickableLayer:function(){console.log("Build clickable layer");this.checkClickableLayer("branding-splash",_SETTINGS.Branding.Logo.Link,_SETTINGS.Branding.Logo.NewWindow)},doesClickableLayerExist:function(b){for(k in dynamicClickableEntityDivs)if(k==
b)return!0;return!1},checkClickableLayer:function(b,f,e){"undefined"==typeof wm&&(this.doesClickableLayerExist(b)?(ig.game.showOverlay([b]),$("#"+b).find("[href]").attr("href",f)):this.createClickableOutboundLayer(b,f,"media/graphics/misc/invisible.png",e))},createClickableOutboundLayer:function(b,f,e,c){var d=ig.$new("div");d.id=b;document.body.appendChild(d);d=$("#"+d.id);d.css("float","left");d.css("position","absolute");if(ig.ua.mobile){var g=window.innerHeight/mobileHeight,m=window.innerWidth/
mobileWidth;d.css("left",this.pos.x*m);d.css("top",this.pos.y*g);d.css("width",this.size.x*m);d.css("height",this.size.y*g)}else g=w/2-destW/2,m=h/2-destH/2,console.log(g,m),d.css("left",g+this.pos.x*multiplier),d.css("top",m+this.pos.y*multiplier),d.css("width",this.size.x*multiplier),d.css("height",this.size.y*multiplier);c?d.html("<a target='_blank' href='"+f+"'><img style='width:100%;height:100%' src='"+e+"'></a>"):d.html("<a href='"+f+"'><img style='width:100%;height:100%' src='"+e+"'></a>");
dynamicClickableEntityDivs[b]={};dynamicClickableEntityDivs[b].width=this.size.x*multiplier;dynamicClickableEntityDivs[b].height=this.size.y*multiplier;dynamicClickableEntityDivs[b].entity_pos_x=this.pos.x;dynamicClickableEntityDivs[b].entity_pos_y=this.pos.y},draw:function(){ig.system.context.fillStyle="#ffffff";ig.system.context.fillRect(0,0,ig.system.width,ig.system.height);ig.system.context.fillStyle="#000";ig.system.context.font="12px Arial";ig.system.context.textAlign="left";this.parent();this.splash&&
ig.system.context.drawImage(this.splash.data,0,0,this.splash.data.width,this.splash.data.height,this.pos.x,this.pos.y,this.size.x,this.size.y)}})});this.END_BRANDING_SPLASH;ig.baked=!0;
ig.module("plugins.datastructure.binary-heap").defines(function(){BinaryHeap=ig.Class.extend({content:[],getValue:null,minHeap:!0,tagName:"BinaryHeap",init:function(b,f){this.getValue=b;f&&(this.minHeap=!1)},push:function(b){this.content.push(b);this.sinkDown(this.content.length-1)},pop:function(){var b=this.content[0],f=this.content.pop();0<this.content.length&&(this.content[0]=f,this.bubbleUp(0));return b},remove:function(b){var f=this.content.indexOf(b),e=this.content.pop();f!==this.content.length-
1&&(this.content[f]=e,this.minHeap?this.getValue(e)<this.getValue(b)?this.sinkDown(f):this.bubbleUp(f):this.getValue(e)>this.getValue(b)?this.sinkDown(f):this.bubbleUp(f))},size:function(){return this.content.length},rescoreElement:function(b){this.sinkDown(this.content.indexOf(b))},sinkDown:function(b){for(var f=this.content[b];0<b;){var e=(b+1>>1)-1,c=this.content[e];if(this.minHeap)if(this.getValue(f)<this.getValue(c))this.content[e]=f,this.content[b]=c,b=e;else break;else if(this.getValue(f)>
this.getValue(c))this.content[e]=f,this.content[b]=c,b=e;else break}},bubbleUp:function(b){for(var f=this.content.length,e=this.content[b],c=this.getValue(e);;){var d=b+1<<1,g=d-1,m=null,j;g<f&&(j=this.getValue(this.content[g]),this.minHeap?j<c&&(m=g):j>c&&(m=g));if(d<f)if(g=this.getValue(this.content[d]),this.minHeap){if(g<(null===m?c:j))m=d}else if(g>(null===m?c:j))m=d;if(null!==m)this.content[b]=this.content[m],this.content[m]=e,b=m;else break}},empty:function(){for(;0<this.content.length;)this.content.pop()}})});
ig.baked=!0;
ig.module("game.entities.plain").requires("impact.entity").defines(function(){EntityPlain=ig.Entity.extend({sc:{x:1,y:1},sheetX:1,sheetY:1,gravityFactor:0,clearColor:null,tweening:!1,which:0,size:{x:50,y:50},halfSize:{x:50,y:50},oriPos:{x:0,y:0},ctxRef:null,init:function(b,f,e){this.parent(b,f,e);ig.global.wm||(this.ctx=ig.system.context)},sounder:function(b){try{ig.soundHandler.sfxPlayer.play(b)}catch(f){console.log(f)}},setIdle:function(){this.animSheet=new ig.AnimationSheet(this.im.path,this.im.width/
this.sheetX,this.im.height/this.sheetY);this.addAnim("idle",0.03,[0],!0);this.currentAnim=this.anims.idle},abCheck:function(b){var f=ig.game.getEntitiesByType(EntityPointer)[0];return f.pos.x>b.pos.x&&f.pos.y>b.pos.y&&f.pos.x<b.pos.x+b.size.x&&f.pos.y<b.pos.y+b.size.y?!0:!1},setSize:function(){this.size.x=this.im.width/this.sheetX;this.size.y=this.im.height/this.sheetY},setSheet:function(){this.size.x=this.im.width/this.sheetX;this.size.y=this.im.height/this.sheetY;this.animSheet=new ig.AnimationSheet(this.im.path,
this.size.x,this.size.y)},getDistance:function(b,f){var e=b.x-f.x,c=b.y-f.y;return Math.sqrt(e*e+c*c)},getPos:function(){console.log(this.pointer.pos.x,this.pointer.pos.y)},posXY:function(b){b.pos.x=this.pointer.pos.x;b.pos.y=this.pointer.pos.y;console.log(this.pos.x,this.pos.y)},resetFrame:function(b){this[b].ended=!1;this[b].frame=0},runAnim:function(b){void 0==this[b]&&(this[b]={});this[b].ended=this[b].ended||!1;this[b].loop=this[b].loop||!1;this[b].frame=this[b].frame||0;this[b].frameTimer=this[b].frameTimer||
new ig.Timer;this[b].frameTime=this[b].frameTime||0.03;!0!=this[b].ended&&(!1==this[b].loop&&this[b].frame==this[b].frames.length-1?(this[b].ended=!0,this.done&&this.done(b)):1<this[b].frames.length&&this[b].frameTimer.delta()>this[b].frameTime&&(this[b].frameTimer.reset(),this[b].frame=(this[b].frame+1)%this[b].frames.length))},tweener:function(b,f,e,c,d){var g={};g[b]=f;null==d&&(d=0);null==c&&(c="none");this.tween("this"==b?f:g,e,{delay:d,targ:b,seq:c,onComplete:function(){null!=c&&this.tweenF(c,
b)}.bind(this),easing:ig.Tween.Easing.Quadratic.EaseOut}).start()},tweener2:function(b,f,e,c,d){var g={};g[b]=f;null==d&&(d=0);null==c&&(c="none");this.tween("this"==b?f:g,e,{delay:d,targ:b,seq:c,onComplete:function(){null!=c&&this.tweenF(c,b)}.bind(this),easing:ig.Tween.Easing.Linear.EaseNone}).start()},tweener3:function(b,f,e,c,d){var g={};g[b]=f;null==d&&(d=0);null==c&&(c="none");this.tween("this"==b?f:g,e,{delay:d,targ:b,seq:c,onComplete:function(){null!=c&&this.tweenF(c,b)}.bind(this),easing:ig.Tween.Easing.Elastic.EaseIn}).start()},
sizer:function(b,f,e,c,d,g,m,j){this.size.x=b.width/f*this.base.oriSc+(m||0);this.size.y=b.height/e*this.base.oriSc+(j||0);!0==g?(this.pos.x=c-this.size.x/2,this.pos.y=d-this.size.y/2):(this.pos.x=c,this.pos.y=d)},ctxDrawer:function(b){var f=b.ctx||ig.system.context,e=b.offX||0,c=b.offY||0,d=b.cent||!1,g=null==b.scX?1:b.scX,m=null==b.scY?1:b.scY,j=null==b.alp&&0!=b.alp?1:b.alp,l=null==b.rot?0:b.rot,n=b.sx,q=b.sy,p=b.sw,r=b.sh,t=p*g,s=r*m;if(!(0>=j))if(0<l||0>g||0>m){var u=b.x,x=b.y,e=d?-p/2+e:e||
0,c=d?-r/2+c:c||0;0<p&&0<r&&(f.save(),f.translate(u,x),f.scale(g,m),f.rotate(2*Math.PI/360*l),f.globalAlpha=j,f.drawImage(b.pic,n,q,p,r,e,c,p,r),f.restore())}else u=d?b.x-t/2+e:b.x+e,x=d?b.y-s/2+c:b.y+c,0<p&&0<r&&(f.globalAlpha=j,f.drawImage(b.pic,n,q,p,r,u,x,t,s),f.globalAlpha=1)},frameDrawer:function(b){var f=b.ctx||ig.system.context,e=b.offX||0,c=b.offY||0,d=b.cent||!1,g=null==b.scX?1:b.scX,m=null==b.scY?1:b.scY,j=null==b.alp&&0!=b.alp?1:b.alp,l=null==b.rot?0:b.rot,n=b.frame.x,q=b.frame.y,p=b.frame.w,
r=b.frame.h,t=p*g,s=r*m;if(!(0>=j))if(0<l||0>g||0>m){var u=b.x,x=b.y,e=d?-p/2+e:e||0,c=d?-r/2+c:c||0;0<p&&0<r&&(f.save(),f.translate(u,x),f.scale(g,m),f.rotate(2*Math.PI/360*l),f.globalAlpha=j,f.drawImage(b.pic,n,q,p,r,e,c,p,r),f.restore())}else u=d?b.x-t/2+e:b.x+e,x=d?b.y-s/2+c:b.y+c,0<p&&0<r&&(f.globalAlpha=j,f.drawImage(b.pic,n,q,p,r,u,x,t,s),f.globalAlpha=1)},quickDraw:function(b){!0==this[b].animate&&!1==this.main.gamePaused&&this.runAnim(b);this.drawer({pic:this[b].im,x:this[b].x,y:this[b].y,
frameX:this[b].frameX,frameY:this[b].frameY,frame:!1==this.checkFrame(b)?0:this[b].frames[this[b].frame],cent:this[b].cent,rot:void 0==this[b].rot?this.rot:this[b].rot,offX:this[b].off.x,offY:this[b].off.y,scX:this.scX*this[b].scX,scY:this.scY*this[b].scY})},drawer:function(b){var f=null==b.alp&&0!=b.alp?1:b.alp,e=null==b.scX?1:b.scX,c=null==b.scY?1:b.scY;if(!(0==f||0==e||0==c)){var d=b.ctx||ig.system.context,g=b.offX||0,m=b.offY||0,j=b.cent||!1,l=null==b.rot?0:b.rot,n=b.frameX||1,q=b.frameY||1,p=
b.frame||0,r=b.pic.width/n*(p%n),p=b.pic.height/q*Math.floor(p/n),t=b.pic.width/n,s=b.pic.height/q,n=b.pic.width/n*e,q=b.pic.height/q*c;0>=f||(n=j?b.x-n/2+g:b.x+g,j=j?b.y-q/2+m:b.y+m,0<t&&0<s&&(d.save(),d.translate(n,j),d.scale(e,c),d.rotate(b.rad?b.rad:2*Math.PI/360*l),d.globalAlpha=f,d.drawImage(b.pic.data,r,p,t,s,g,m,t,s),d.restore()))}},textSet:function(b,f,e,c){this.ctxRef=c=c||ig.system.context;c.font=b+"px "+(e||"patriot");c.fillStyle=f},textW:function(b){return this.ctxRef.measureText(b).width},
textMax:function(b){this.textSet(b.px,"white");return this.textW(b.tx)>b.maxWidth?b.maxWidth/this.textW(b.tx):1},textDraw:function(b){var f=b.rot?b.rot:0,e=b.tx?b.tx:0,c=b.x?b.x:0,d=b.y?b.y:0,g=void 0==b.scX?1:b.scX,m=void 0==b.scY?1:b.scY,j=b.stroke?b.stroke:!1,l=void 0==b.strokeAlp?1:b.strokeAlp,n=b.strokeColour?b.strokeColour:"black",q=void 0==b.alp?1:b.alp,p=b.col?b.col:this.ctx.fillStyle,r=b.font||"typo",t=b.px||10,s=b.strokeLine||3,u=b.align||"center";if(0!=q){var x=b.ctx||ig.system.context;
this.ctxRef=b.ctx||ig.system.context;x.font=t+"px "+r;void 0!=b.maxWidth&&this.textW(e)>b.maxWidth&&(t=Math.floor(b.maxWidth/this.textW(e)*t),x.font=t+"px "+r);"left"==u?c+=0.5*this.textW(e)*g:"right"==u&&(c-=0.5*this.textW(e)*g);x.save();b=x.measureText("M").width*m;x.translate(c,d+b/2);x.scale(g,m);x.rotate(f?2*Math.PI/360*f:0);x.fillStyle=p;!0==j&&(x.globalAlpha=l,x.lineWidth=s,x.lineCap="round",x.strokeStyle=n,x.strokeText(e,-this.textW(e)/2,0));x.globalAlpha=q;x.fillText(e,-this.textW(e)/2,0);
x.restore()}},checkStorage:function(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),"localStorage"in window&&null!==window.localStorage}catch(b){return!1}},shuffleArray:function(b){for(var f=b.length,e,c;0<f;)c=Math.floor(Math.random()*f),f--,e=b[f],b[f]=b[c],b[c]=e;return b}})});ig.baked=!0;
ig.module("game.entities.buttons.button").requires("game.entities.plain").defines(function(){EntityButton=EntityPlain.extend({collides:ig.Entity.COLLIDES.NEVER,type:ig.Entity.TYPE.A,size:new BABYLON.Vector2(48,48),fillColor:null,zIndex:95E3,pos:{x:0,y:0},name:"button",init:function(b,f,e){this.parent(b,f,e);!ig.global.wm&&(e&&!isNaN(e.zIndex))&&(this.zIndex=e.zIndex);b=Math.floor(256*Math.random());f=Math.floor(256*Math.random());e=Math.floor(256*Math.random());this.fillColor="rgba("+b+","+e+","+
f+",1)"},clicked:function(){throw"no implementation on clicked()";},clicking:function(){throw"no implementation on clicking()";},released:function(){throw"no implementation on released()";}})});ig.baked=!0;
ig.module("plugins.clickable-div-layer").defines(function(){ClickableDivLayer=ig.Class.extend({pos:new BABYLON.Vector2(0,0),size:new BABYLON.Vector2(0,0),identifier:null,invisImagePath:"media/graphics/misc/invisible.png",init:function(b){this.pos=new BABYLON.Vector2(b.pos.x,b.pos.y);this.size=new BABYLON.Vector2(b.size.x,b.size.y);var f="more-games",e="www.google.com",c=!1;b.div_layer_name&&(f=b.div_layer_name);b.link&&(e=b.link);b.newWindow&&(c=b.newWindow);this.createClickableLayer(f,e,c)},createClickableLayer:function(b,
f,e){this.identifier=b;var c=ig.domHandler.getElementById("#"+b);c?(ig.domHandler.show(c),ig.domHandler.attr(c,"href",f)):this.createClickableOutboundLayer(b,f,this.invisImagePath,e)},update:function(b,f){this.pos.x===b&&this.pos.y===f||(ig.sizeHandler.dynamicClickableEntityDivs[this.identifier]={},ig.sizeHandler.dynamicClickableEntityDivs[this.identifier].width=this.size.x,ig.sizeHandler.dynamicClickableEntityDivs[this.identifier].height=this.size.y,ig.sizeHandler.dynamicClickableEntityDivs[this.identifier].entity_pos_x=
this.pos.x,ig.sizeHandler.dynamicClickableEntityDivs[this.identifier].entity_pos_y=this.pos.y)},createClickableOutboundLayer:function(b,f,e,c){var d=ig.domHandler.create("div");ig.domHandler.attr(d,"id",b);var g=ig.domHandler.create("a");c?(ig.domHandler.attr(g,"href",f),ig.domHandler.attr(g,"target","_blank")):ig.domHandler.attr(g,"href",f);f=ig.domHandler.create("img");ig.domHandler.css(f,{width:"100%",height:"100%"});ig.domHandler.attr(f,"src",e);e=Math.min(ig.sizeHandler.scaleRatioMultiplier.x,
ig.sizeHandler.scaleRatioMultiplier.y);if(ig.ua.mobile){c=Math.floor(this.pos.x*ig.sizeHandler.scaleRatioMultiplier.x)+"px";var m=Math.floor(this.pos.y*ig.sizeHandler.scaleRatioMultiplier.y)+"px",j=Math.floor(this.size.x*ig.sizeHandler.scaleRatioMultiplier.x)+"px";e=Math.floor(this.size.y*ig.sizeHandler.scaleRatioMultiplier.y)+"px"}else c=ig.domHandler.getElementById("#canvas"),c=ig.domHandler.getOffsets(c),m=c.top,c=Math.floor(c.left+this.pos.x*e)+"px",m=Math.floor(m+this.pos.y*e)+"px",j=Math.floor(this.size.x*
e)+"px",e=Math.floor(this.size.y*e)+"px";ig.domHandler.css(d,{"float":"left",position:"absolute",left:c,top:m,width:j,height:e,"z-index":3});ig.domHandler.addEvent(d,"mousemove",ig.input.mousemove.bind(ig.input),!1);ig.domHandler.appendChild(g,f);ig.domHandler.appendChild(d,g);ig.domHandler.appendToBody(d);ig.sizeHandler.dynamicClickableEntityDivs[b]={};ig.sizeHandler.dynamicClickableEntityDivs[b].width=this.size.x;ig.sizeHandler.dynamicClickableEntityDivs[b].height=this.size.y;ig.sizeHandler.dynamicClickableEntityDivs[b].entity_pos_x=
this.pos.x;ig.sizeHandler.dynamicClickableEntityDivs[b].entity_pos_y=this.pos.y}})});ig.baked=!0;
ig.module("game.entities.buttons.button-branding-logo").requires("game.entities.buttons.button","plugins.clickable-div-layer").defines(function(){EntityButtonBrandingLogo=EntityButton.extend({type:ig.Entity.TYPE.A,gravityFactor:0,logo:new ig.AnimationSheet("branding/logo.png",_SETTINGS.Branding.Logo.Width,_SETTINGS.Branding.Logo.Height),zIndex:10001,size:{x:64,y:66},clickableLayer:null,link:null,newWindow:!1,div_layer_name:"branding-logo",name:"brandinglogo",init:function(b,f,e){this.parent(b,f,e);
if(!ig.global.wm){if("undefined"==typeof wm)if(_SETTINGS.Branding.Logo.Enabled)this.size.x=_SETTINGS.Branding.Logo.Width,this.size.y=_SETTINGS.Branding.Logo.Height,this.anims.idle=new ig.Animation(this.logo,0,[0],!0),this.currentAnim=this.anims.idle,e&&e.centralize&&(this.pos.x=(ig.system.width>>>1)-(this.size.x>>>1),console.log("centralize true ... centering branded logo ...")),_SETTINGS.Branding.Logo.LinkEnabled&&(this.link=_SETTINGS.Branding.Logo.Link,this.newWindow=_SETTINGS.Branding.Logo.NewWindow,
this.clickableLayer=new ClickableDivLayer(this));else{this.kill();return}this.div_layer_name=e.div_layer_name?e.div_layer_name:"branding-logo"}},show:function(){var b=ig.domHandler.getElementById("#"+this.div_layer_name);ig.domHandler.show(b)},hide:function(){var b=ig.domHandler.getElementById("#"+this.div_layer_name);ig.domHandler.hide(b)},clicked:function(){},clicking:function(){},released:function(){}})});ig.baked=!0;
ig.module("game.entities.branding-logo-placeholder").requires("impact.entity","game.entities.buttons.button-branding-logo").defines(function(){EntityBrandingLogoPlaceholder=ig.Entity.extend({gravityFactor:0,size:{x:32,y:32},_wmDrawBox:!0,_wmBoxColor:"rgba(0, 0, 255, 0.7)",init:function(b,f,e){this.parent(b,f,e);if(e)switch(console.log("settings found ... using that div layer name"),b=e.div_layer_name,console.log("settings.centralize:",e.centralize),e.centralize){case "true":console.log("centralize true");
centralize=!0;break;case "false":console.log("centralize false");centralize=!1;break;default:console.log("default ... centralize false"),centralize=!1}else b="branding-logo",centralize=!1;if("undefined"==typeof wm){if(_SETTINGS.Branding.Logo.Enabled)try{ig.game.spawnEntity(EntityButtonBrandingLogo,this.pos.x,this.pos.y,{div_layer_name:b,centralize:centralize})}catch(c){console.log(c)}this.kill()}}})});ig.baked=!0;
ig.module("game.entities.buttons.button-more-games").requires("game.entities.buttons.button","plugins.clickable-div-layer").defines(function(){EntityButtonMoreGames=EntityButton.extend({type:ig.Entity.TYPE.A,gravityFactor:0,size:{x:64,y:66},textSize:60,zIndex:750,alp:1,clickableLayer:null,link:null,newWindow:!1,div_layer_name:"more-games",name:"moregames",init:function(b,f,e){this.parent(b,f,e);this.textSet(this.textSize,"white");this.size.x=this.ctx.measureText(_STRINGS.Game.more).width;this.pos.x=
0.5*ig.system.width-0.5*this.size.x;ig.global.wm||(this.div_layer_name=e.div_layer_name?e.div_layer_name:"more-games",_SETTINGS.MoreGames.Enabled?(_SETTINGS.MoreGames.Link&&(this.link=_SETTINGS.MoreGames.Link),_SETTINGS.MoreGames.NewWindow&&(this.newWindow=_SETTINGS.MoreGames.NewWindow),this.clickableLayer=new ClickableDivLayer(this)):this.kill())},tweenF:function(b){switch(b){case "fadeOut":this.tweener("this",{alp:0},0.4,"kill");break;case "kill":this.hide(),this.kill()}},draw:function(){this.textDraw({tx:_STRINGS.Game.more,
x:this.pos.x+0.5*this.size.x,y:this.pos.y+0.5*this.size.y,col:"white",px:this.textSize,alp:this.alp})},show:function(){var b=ig.domHandler.getElementById("#"+this.div_layer_name);ig.domHandler.show(b)},hide:function(){var b=ig.domHandler.getElementById("#"+this.div_layer_name);ig.domHandler.hide(b)},clicked:function(){},clicking:function(){},released:function(){}})});ig.baked=!0;
ig.module("game.entities.opening-shield").requires("impact.entity").defines(function(){EntityOpeningShield=ig.Entity.extend({size:{x:48,y:48},move:0,mIconAnim:0,shieldAnim:0,titleAnim:0,shieldImage:new ig.Image("media/graphics/opening/shield.png"),mIconImage:new ig.Image("media/graphics/opening/m_icon.png"),titleImage:new ig.Image("media/graphics/opening/title.png"),init:function(b,f,e){this.parent(b,f,e)},ready:function(){if(!ig.wm)if(_SETTINGS.DeveloperBranding.Splash.Enabled){this.initTimer=new ig.Timer(0.1);
try{ig.soundHandler.playSound(ig.soundHandler.SOUNDID.openingSound)}catch(b){console.log(b)}}else ig.game.director.nextLevel(),ig.system.context.globalAlpha=1,this.kill()},update:function(){this.parent();this.updateOriginalShieldOpening()},draw:function(){this.parent();ig.global.wm||(this.nextLevelTimer&&0>this.nextLevelTimer.delta()&&(ig.system.context.globalAlpha=-this.nextLevelTimer.delta()),this.drawOriginalShieldOpening())},updateOriginalShieldOpening:function(){this.initTimer&&0<this.initTimer.delta()&&
(this.initTimer=null,this.sheildTimer=new ig.Timer(0.05));this.sheildTimer&&0<this.sheildTimer.delta()&&(3>this.shieldAnim?(this.shieldAnim++,this.sheildTimer.reset()):(this.sheildTimer=null,this.moveTimer=new ig.Timer(0.0010),this.mIconTimer=new ig.Timer(0.05),this.titleTimer=new ig.Timer(0.15)));this.moveTimer&&0<this.moveTimer.delta()&&(this.move+=0.3,this.moveTimer.reset());this.mIconTimer&&0<this.mIconTimer.delta()&&(12>this.mIconAnim?(this.mIconAnim++,this.moveTimer.reset()):this.mIconTimer=
null);this.titleTimer&&0<this.titleTimer.delta()&&(11>this.titleAnim?(this.titleAnim++,this.titleTimer.reset()):(this.titleTimer=null,this.nextLevelTimer=new ig.Timer(1)));this.nextLevelTimer&&0<this.nextLevelTimer.delta()&&(this.nextLevelTimer=null,ig.game.director.nextLevel(),ig.system.context.globalAlpha=1)},drawOriginalShieldOpening:function(){if(this.moveTimer){var b=ig.system.context;b.save();var f=ig.system.width/2,e=ig.system.height/2;b.translate(f,e);b.rotate(this.move*Math.PI/180);b.beginPath();
b.moveTo(0,0);for(var c=0,d=1;48>=d;d+=1)b.lineTo(0+800*Math.cos(2*d*Math.PI/48),0+800*Math.sin(2*d*Math.PI/48)),c++,2==c&&(c=0,b.lineTo(0,0));b.translate(-f,-e);f=b.createRadialGradient(f,e,100,f,e,250);f.addColorStop(0,"rgba(255,255,255,0.1)");f.addColorStop(1,"rgba(0,0,0,0)");b.fillStyle=f;b.fill();b.restore()}this.shieldImage.drawTile(ig.system.width/2-91,0-(768-ig.system.height)/2,this.shieldAnim,182,768);this.moveTimer&&(this.mIconImage.drawTile(ig.system.width/2-96,ig.system.height/2-70,this.mIconAnim,
166,160),this.titleImage.drawTile(ig.system.width/2-204,ig.system.height/2+100,this.titleAnim,409,76));ig.system.context.globalAlpha=1}})});ig.baked=!0;
ig.module("game.entities.opening-kitty").requires("impact.entity").defines(function(){EntityOpeningKitty=ig.Entity.extend({size:{x:48,y:48},kittyAnim:-1,kittyImage:new ig.Image("media/graphics/opening/kitty.png"),kittyTitleImage:new ig.Image("media/graphics/opening/kittytitle.png"),soundKey:"kittyopeningSound",init:function(b,f,e){this.parent(b,f,e)},ready:function(){if(!ig.wm)if(_SETTINGS.DeveloperBranding.Splash.Enabled){this.initTimer=new ig.Timer(0.1);try{ig.soundHandler.sfxPlayer.play(this.soundKey)}catch(b){console.log(b)}}else ig.game.director.nextLevel(),
ig.system.context.globalAlpha=1,this.kill()},update:function(){this.parent();this.updateKittyOpening()},draw:function(){this.parent();ig.global.wm||(this.nextLevelTimer&&0>this.nextLevelTimer.delta()&&(ig.system.context.globalAlpha=-this.nextLevelTimer.delta()),this.drawKittyOpening())},updateKittyOpening:function(){this.initTimer&&0<this.initTimer.delta()&&(this.initTimer=null,this.kittyTimer=new ig.Timer(0.15));this.kittyTimer&&0<this.kittyTimer.delta()&&(7>this.kittyAnim?(this.kittyAnim++,this.kittyTimer.reset()):
(this.kittyTimer=null,this.nextLevelTimer=new ig.Timer(2)));this.nextLevelTimer&&0<this.nextLevelTimer.delta()&&(this.nextLevelTimer=null,ig.game.director.nextLevel(),ig.system.context.globalAlpha=1)},drawKittyOpening:function(){var b=ig.system.context.createLinearGradient(0,0,0,ig.system.height);b.addColorStop(0,"#ffed94");b.addColorStop(1,"#ffcd85");ig.system.context.fillStyle=b;ig.system.context.fillRect(0,0,ig.system.width,ig.system.height);0<=this.kittyAnim&&(this.kittyImage.drawTile((ig.system.width>>>
1)-(this.kittyImage.width>>>3),(ig.system.height>>>1)-(this.kittyImage.height>>>2),this.kittyAnim,218,325),this.kittyTitleImage.drawTile((ig.system.width>>>1)-(this.kittyTitleImage.width>>>1),(ig.system.height>>>1)+(this.kittyImage.height>>>2)+10,this.kittyAnim,380,37));ig.system.context.globalAlpha=1}})});ig.baked=!0;
ig.module("game.entities.pointer").requires("impact.entity").defines(function(){EntityPointer=ig.Entity.extend({checkAgainst:ig.Entity.TYPE.BOTH,isFirstPressed:!1,isPressed:!1,isReleased:!1,isHovering:!1,hoveringItem:null,objectArray:[],clickedObjectList:[],ignorePause:!0,zIndex:5E3,name:"pointer",check:function(b){this.objectArray.push(b)},clickObject:function(b){this.isFirstPressed&&"function"==typeof b.clicked&&(b.clicked(),this.addToClickedObjectList(b));this.isPressed&&!this.isReleased&&"function"==
typeof b.clicking&&b.clicking();this.isReleased&&"function"==typeof b.released&&(b.released(),this.removeFromClickedObjectList(b))},refreshPos:function(){this.pos=ig.game.io.getClickPos()},update:function(){this.parent();this.refreshPos();var b=null,f=-1;for(a=this.objectArray.length-1;-1<a;a--)this.objectArray[a].zIndex>f&&(f=this.objectArray[a].zIndex,b=this.objectArray[a]);if(null!=b)null!=this.hoveringItem?this.hoveringItem!=b&&("function"==typeof this.hoveringItem.leave&&this.hoveringItem.leave(),
"function"==typeof b.over&&b.over()):"function"==typeof b.over&&b.over(),this.hoveringItem=this.lastEnt=b,this.clickObject(b),this.objectArray=[];else if(null!=this.hoveringItem&&"function"==typeof this.hoveringItem.leave&&(this.hoveringItem.leave(),this.hoveringItem=null),this.isReleased){for(b=0;b<this.clickedObjectList.length;b++)f=this.clickedObjectList[b],"function"==typeof f.releasedOutside&&f.releasedOutside();this.lastEnt&&(this.lastEnt.released(),this.lastEnt=null);this.clickedObjectList=
[]}this.isFirstPressed=ig.input.pressed("click");this.isReleased=ig.input.released("click");this.isPressed=ig.input.state("click")},addToClickedObjectList:function(b){this.clickedObjectList.push(b)},removeFromClickedObjectList:function(b){for(var f=[],e=0;e<this.clickedObjectList.length;e++){var c=this.clickedObjectList[e];c!=b&&f.push(c)}this.clickedObjectList=f}})});ig.baked=!0;
ig.module("game.entities.pointer-selector").requires("game.entities.pointer").defines(function(){EntityPointerSelector=EntityPointer.extend({zIndex:1E3,_wmDrawBox:!0,_wmBoxColor:"rgba(0, 0, 255, 0.7)",size:{x:20,y:20},init:function(b,f,e){this.parent(b,f,e)}})});ig.baked=!0;
ig.module("game.entities.select").requires("impact.entity").defines(function(){EntitySelect=ig.Entity.extend({type:ig.Entity.TYPE.B,checkAgainst:ig.Entity.TYPE.A,collides:ig.Entity.COLLIDES.NEVER,canSelect:!1,canSelectTimerDuration:0.35,zIndex:99999,isHovering:!1,isSelected:!1,init:function(b,f,e){this.parent(b,f,e);this.canSelectTimer=new ig.Timer(this.canSelectTimerDuration)},doesClickableLayerExist:function(b){for(k in dynamicClickableEntityDivs)if(k==b)return!0;return!1},checkClickableLayer:function(b,
f,e){"undefined"==typeof wm&&(this.doesClickableLayerExist(b)?(ig.game.showOverlay([b]),$("#"+b).find("[href]").attr("href",f)):this.createClickableOutboundLayer(b,f,"media/graphics/misc/invisible.png",e))},createClickableOutboundLayer:function(b,f,e,c){var d=ig.$new("div");d.id=b;document.body.appendChild(d);$("#"+d.id).css("float","left");$("#"+d.id).css("width",this.size.x*multiplier);$("#"+d.id).css("height",this.size.y*multiplier);$("#"+d.id).css("position","absolute");var g=w/2-destW/2,m=h/
2-destH/2;w==mobileWidth?($("#"+d.id).css("left",this.pos.x),$("#"+d.id).css("top",this.pos.y)):($("#"+d.id).css("left",g+this.pos.x*multiplier),$("#"+d.id).css("top",m+this.pos.y*multiplier));c?$("#"+d.id).html("<a target='_blank' href='"+f+"'><img style='width:100%;height:100%' src='"+e+"'></a>"):$("#"+d.id).html("<a href='"+f+"'><img style='width:100%;height:100%' src='"+e+"'></a>");dynamicClickableEntityDivs[b]={};dynamicClickableEntityDivs[b].width=$("#"+d.id).width();dynamicClickableEntityDivs[b].height=
$("#"+d.id).height();dynamicClickableEntityDivs[b].entity_pos_x=this.pos.x;dynamicClickableEntityDivs[b].entity_pos_y=this.pos.y},hovered:function(){this.isHovering=!0;this.dehoverOthers()},dehoverOthers:function(){var b=ig.game.getEntitiesByType(EntitySelect);for(i=0;i<b.length;i++)b[i]!=this&&(b[i].isHovering=!1)},deselectOthers:function(){var b=ig.game.getEntitiesByType(EntitySelect);for(i=0;i<b.length;i++)b[i]!=this&&(b[i].isSelected=!1)},update:function(){this.parent();this.canSelectTimer&&0<
this.canSelectTimer.delta()&&(this.canSelect=!0,this.canSelectTimer=null)}})});ig.baked=!0;ig.module("game.levels.opening").requires("impact.image","game.entities.opening-kitty").defines(function(){LevelOpening={entities:[{type:"EntityOpeningKitty",x:520,y:212}],layer:[]}});ig.baked=!0;
ig.module("game.entities.gui").requires("game.entities.plain").defines(function(){EntityGui=EntityPlain.extend({size:{x:40,y:40},pos:{x:1,y:1},zIndex:10,comboOffX:0,comboAlp:0,scoreSc:1,scoreAlp:0,bestAlp:0,rainbowLetters:[],stackerLetters:[],rainbow0:{},rainbow1:{},rainbow2:{},rainbow3:{},rainbow4:{},rainbow5:{},rainbow6:{},titleTurnIndex:0,titleAlp:1,rainbowX:[33,102,155,208,277,347,430],stackerX:[11,79,151,220,293,365,435],init:function(b,f,e){this.parent(b,f,e);ig.global.wm||(this.ctx=ig.system.context,
this.processText(),this.tweenF("turnLetter0"))},processText:function(){this.rainbowText=_STRINGS.Game.RAINBOW;this.stackerText=_STRINGS.Game.STACKER;this.rainbowWidth=477;this.rainbowStart=ig.system.width/2-this.rainbowWidth/2;for(var b=this.rainbowText.split(""),f=0;f<b.length;f++)this["rainbow"+f]={tx:b[f],x:this.rainbowX[f],offX:0,scX:1,scY:1,h:360*(f/7)},this.rainbowLetters.push(this["rainbow"+f]);this.textSet(40,"white");this.stackerWidth=179;b=this.stackerText.split("");this.stackerGap=Math.floor((0.95*
this.rainbowWidth-this.stackerWidth)/(this.stackerText.length-1));this.stackerStart=ig.system.width/2-0.95*(this.rainbowWidth/2);for(f=0;f<b.length;f++)this.stackerLetters.push({tx:b[f],x:this.stackerX[f],offX:0,scX:1,scY:1,alp:this.titleAlp})},tweenF:function(b){switch(b){case "combo":this.comboAlp=1;this.comboOffX=0;this.tweener("this",{comboAlp:0,comboOffX:-30},0.1,"combo3",0.3);break;case "combo3":this.main.score+=this.main.combo;this.tweener("this",{scoreSc:1.2},0.1,"combo4");break;case "combo4":this.tweener("this",
{scoreSc:1},0.2);break;case "best":this.tweener("this",{bestAlp:1},0.2);break;case "score":this.tweener("this",{scoreAlp:1},0.3);break;case "turnLetter0":this.tweener("rainbow"+this.titleTurnIndex,{scX:-1},0.2,"turnLetter1");break;case "turnLetter1":this.tweener("rainbow"+this.titleTurnIndex,{scX:1},0.3,"turnLetter2",0.2);break;case "turnLetter2":b=Math.floor(7*Math.random());this.titleTurnIndex=this.titleTurnIndex==b?(this.titleTurnIndex+2)%7:b%7;this.tweenF("turnLetter0");break;case "fadeOutTitle":this.tweener("this",
{titleAlp:0},0.4,"startGame");break;case "startGame":this.tweenF("score"),this.main.startGame()}},update:function(){this.parent()},drawTitle:function(){for(var b=0;7>b;b++)this.textDraw({tx:this.rainbowLetters[b].tx,px:120,x:this.rainbowStart+this.rainbowLetters[b].x,y:0.24*ig.system.height,col:"hsl("+this.rainbowLetters[b].h+",80%,80%)",alp:this.titleAlp,scX:this.rainbowLetters[b].scX,scY:0.85});for(b=0;7>b;b++)this.textDraw({tx:this.stackerLetters[b].tx,px:40,x:this.stackerStart+this.stackerLetters[b].x,
y:0.31*ig.system.height,col:"white",alp:this.titleAlp})},drawGameOver:function(){this.textDraw({tx:"BEST "+ig.game.highScore,px:50,x:ig.system.width/2,y:0.31*ig.system.height,col:"white",alp:0.98*this.bestAlp,maxWidth:0.9*ig.system.width});0<this.main.maxCombo&&this.textDraw({tx:"MAX COMBO "+this.main.maxCombo,px:40,x:ig.system.width/2,y:0.13*ig.system.height,col:"white",alp:0.98*this.bestAlp,maxWidth:0.9*ig.system.width})},drawGameGui:function(){this.textDraw({tx:this.main.score,px:120,x:ig.system.width/
2,y:0.22*ig.system.height,col:"white",alp:0.98*this.scoreAlp,scX:this.scoreSc,scY:this.scoreSc,maxWidth:0.7*ig.system.width});var b=0.5*this.ctx.measureText(this.main.score).width;this.textDraw({tx:"+"+this.main.combo,px:50,x:ig.system.width/2+b+10+this.comboOffX,y:0.22*ig.system.height,col:"white",alp:0.98*this.comboAlp,align:"left"})},draw:function(){this.parent();ig.global.wm||(!0==this.main.gameStarted?(this.drawGameGui(),!0==this.main.gameOver&&this.drawGameOver()):this.drawTitle())}})});
ig.baked=!0;
ig.module("game.entities.plain-but").requires("game.entities.plain").defines(function(){EntityPlainBut=EntityPlain.extend({gravityFactor:0,type:ig.Entity.TYPE.B,zIndex:2040,sc:1,oriSc:1,mouseSc:0.95,runTask:!1,tweening:!1,oriPos:{x:0,y:0},alp:1,finalSc:1,center:{x:0,y:0},offs:{x:0,y:0},idleSc:0.95,overSc:1,downSc:0.9,init:function(b,f,e){ig.global.wm||(this.parent(b,f,e),this.size.x=this.butIm.width/this.sheetX,this.size.y=this.butIm.height/this.sheetY,this.oriPos.x=b,this.oriPos.y=f,this.hide(),
this.oriStat&&this.oriStat(),this.mouseSc=this.idleSc,this.finalSc=this.oriSc*this.sc*this.mouseSc,this.menu&&(this.pos.y=this.menu.off.y+this.oriPos.y),this.ready())},clicked:function(){this.sc=this.downSc;this.buttonTask()},released:function(){!0!=this.tweening&&(this.sc=this.overSc)},idle:function(){},hide:function(){this.pos.x=-200;this.pos.y=-200},show:function(){this.pos.x=this.oriPos.x;this.pos.y=this.oriPos.y;this.menu&&(this.pos.y=this.menu.off.y+this.oriPos.y)},tweenF:function(b){switch(b){case "delayTask":this.tweener("this",
{},0.05,"delayTask2");break;case "delayTask2":this.buttonTask()}},update:function(){ig.global.wm||(this.parent(),this.idleUpdate())},idleUpdate:function(){this.mouseSc=this.pointer.hoveringItem==this?this.overSc:this.idleSc;this.finalSc=this.oriSc*this.sc*this.mouseSc;this.center.x=this.pos.x+this.size.x/2;this.center.y=this.pos.y+this.size.y/2},buttonTask:function(){},ready:function(){this.pointer=ig.game.getEntitiesByType(EntityPointer)[0]},draw:function(){this.parent();ig.global.wm||this.idleDraw()},
idleDraw:function(){this.drawer({pic:this.butIm,x:this.pos.x+this.size.x/2+this.offs.x,y:this.pos.y+this.size.y/2+this.offs.y,scX:this.finalSc,scY:this.finalSc,frameX:this.sheetX,frameY:this.sheetY,frame:this.frame,cent:!0,alp:this.alp})}})});ig.baked=!0;
ig.module("game.entities.play-but").requires("game.entities.plain-but").defines(function(){EntityPlayBut=EntityPlainBut.extend({sc:1,mouseSc:1,oriSc:1,ralp:1,downSc:0.9,butIm:new ig.Image("media/graphics/sprites/play.png"),tweening:!1,init:function(b,f,e){ig.global.wm||(b-=0.5*this.butIm.width,f-=0.5*this.butIm.height,this.parent(b,f,e))},oriStat:function(){this.show()},tweenF:function(b){switch(b){case "fadeOut":this.tweener("this",{alp:0},0.4,"kill");break;case "kill":this.kill()}},buttonTask:function(){!0!=
this.tweening&&(ig.game.sounder("click"),this.tweening=!0,this.tweenF("fadeOut"),this.main.gui.tweenF("fadeOutTitle"),this.main.moreBut&&this.main.moreBut.tweenF("fadeOut"))},draw:function(){this.parent()},update:function(){this.parent()}})});ig.baked=!0;
ig.module("game.entities.replay-but").requires("game.entities.plain-but").defines(function(){EntityReplayBut=EntityPlainBut.extend({sc:1,mouseSc:1,oriSc:1,ralp:1,downSc:0.9,alp:0,butIm:new ig.Image("media/graphics/sprites/replay.png"),tweening:!1,init:function(b,f,e){ig.global.wm||(b-=0.5*this.butIm.width,f-=0.5*this.butIm.height,this.parent(b,f,e),this.tweenF("fadeIn"))},oriStat:function(){this.show()},tweenF:function(b){switch(b){case "fadeIn":this.tweening=!0;this.tweener("this",{alp:1},0.5,"fadeIn2",
0.5);break;case "fadeIn2":this.tweening=!1;break;case "fadeOut":this.tweener("this",{alp:1},0.1,"kill");break;case "kill":wgl.game.clear(),wgl.system.unregisterBeforeRender(),wgl.game.currentScene.dispose(),ig.game.director.jumpTo(LevelGame),this.kill()}},buttonTask:function(){!0!=this.tweening&&(this.tweening=!0,this.tweenF("fadeOut"),ig.game.sounder("click"))},draw:function(){this.parent()},update:function(){this.parent()}})});ig.baked=!0;
ig.module("game.entities.sound-but").requires("game.entities.plain-but").defines(function(){EntitySoundBut=EntityPlainBut.extend({sc:1,mouseSc:1,oriSc:1,ralp:1,downSc:0.9,butIm:new ig.Image("media/graphics/sprites/unmute.png"),muteIm:new ig.Image("media/graphics/sprites/mute.png"),unmuteIm:new ig.Image("media/graphics/sprites/unmute.png"),firstUpdate:!1,tweening:!1,init:function(b,f,e){ig.global.wm||this.parent(b,f,e)},oriStat:function(){this.show()},tweenF:function(b){switch(b){case "fadeOut":this.tweener("this",
{alp:0},0.4,"kill");break;case "kill":this.kill()}},buttonTask:function(){!1==ig.soundHandler.focusBlurMute?(ig.soundHandler.focusBlurMute=!0,this.butIm=this.muteIm,ig.soundHandler.forceMuteAll(),ig.game.io.storageSet(ig.game.soundKey,!0)):(ig.soundHandler.focusBlurMute=!1,this.butIm=this.unmuteIm,ig.soundHandler.forceUnMuteAll(),ig.game.io.storageSet(ig.game.soundKey,!1))},draw:function(){this.parent()},update:function(){!1==this.firstUpdate&&(this.firstUpdate=!0,this.butIm=!1==ig.soundHandler.focusBlurMute?
this.unmuteIm:this.muteIm);this.parent()}})});ig.baked=!0;
ig.module("game.entities.controllers.game-control").requires("impact.entity","game.entities.gui","game.entities.play-but","game.entities.replay-but","game.entities.buttons.button-more-games","game.entities.sound-but").defines(function(){EntityGameControl=ig.Entity.extend({type:ig.Entity.TYPE.B,size:{x:540,y:960},pos:{x:1,y:1},controller:null,h:250,s:35,l:50,hueSpeed:10,bottomHeight:4,boxHeight:0.3,level:0,combo:0,totalCombo:0,maxCombo:0,hitPos:{x:0,z:0},boxScale:{x:1,z:1},baseMesh:null,gameOver:!1,
score:0,zIndex:1,currentBox:null,gameStarted:!1,moveXAxis:!0,init:function(b,f,e){this.parent(0,0,e);ig.global.wm||(this.createScene(),this.createLight(),wgl.game.currentScene=this.scene,this.clickTimer=new ig.Timer,this.clickTime=0.01,this.h=Math.floor(360*Math.random()),this.startH=(this.h+30)%360,this.spawner(),wgl.system.registerBeforeRender(),this.size.x=540,this.size.y=960,wgl.system.stopRender(),wgl.system.startRender())},spawnReplayBut:function(){this.replayBut=ig.game.spawnEntity(EntityReplayBut,
0.5*ig.system.width,0.76*ig.system.height,{main:this})},endGame:function(){this.gameOver=!0;this.combo=0;this.cameraTarget.endView();this.gui.tweenF("best");this.score>ig.game.highScore&&(ig.game.highScore=this.score,ig.game.saveGame())},startGame:function(){this.gameStarted=!0;this.spawnBox()},spawner:function(){this.bg=wgl.game.spawnEntity(wgl.modules.Background,0,0,0,{h:this.h,s:this.s,l:this.l,main:this});this.perfect=wgl.game.spawnEntity(wgl.modules.Perfect,0,this.bottomHeight+0.5*this.boxHeight+
this.boxHeight*this.level,0,{h:this.h,s:this.s,l:this.l,main:this});this.pointer=ig.game.spawnEntity(EntityPointer,0,0);this.gui=ig.game.spawnEntity(EntityGui,0,0,{main:this});var b={main:this,height:this.bottomHeight};this.rgb=this.hslToRgb(this.h/360,this.s/100,this.l/100);ig.merge(b,this.rgb);wgl.game.spawnEntity(wgl.modules.Bottom,0,0.5*this.bottomHeight,0,b);this.moreBut=ig.game.spawnEntity(EntityButtonMoreGames,0.5*ig.system.width,0.91*ig.system.height,{main:this});this.playBut=ig.game.spawnEntity(EntityPlayBut,
0.5*ig.system.width,0.76*ig.system.height,{main:this});this.soundBut=ig.game.spawnEntity(EntitySoundBut,10,10,{main:this});this.cameraTarget=wgl.game.spawnEntity(wgl.modules.CameraTarget,0,3*this.bottomHeight,0,b);this.cameraTarget.targetPos=this.bottomHeight+0.5*this.boxHeight+this.boxHeight*this.level-0.3;this.cameraTarget.tweenF("nextBoxPos");this.rgb=this.hslToRgb(this.h/360,1,0.7);this.cameraTarget.particle.color1=new BABYLON.Color4(this.rgb.r/255,this.rgb.g/255,this.rgb.b/255,1);this.cameraTarget.particle.color2=
new BABYLON.Color4(this.rgb.r/255,this.rgb.g/255,this.rgb.b/255,1)},createScene:function(){this.scene=new BABYLON.Scene(wgl.system.engine);this.scene.clearColor=new BABYLON.Color3(1,1,1)},spawnBox:function(){this.rgb=this.hslToRgb(this.h/360,1,0.7);this.cameraTarget.particle.color1=new BABYLON.Color4(this.rgb.r/255,this.rgb.g/255,this.rgb.b/255,1);this.clickTimer.reset();this.h=(this.h+this.hueSpeed)%360;var b={size:{x:2,y:this.boxHeight,z:2},main:this,moveXAxis:this.moveXAxis};this.rgb=this.hslToRgb(this.h/
360,this.s/100,this.l/100);this.cameraTarget.particle.color2=new BABYLON.Color4(this.rgb.r/255,this.rgb.g/255,this.rgb.b/255,1);ig.merge(b,this.rgb);wgl.game.spawnEntity(wgl.modules.Box,0,this.bottomHeight+0.5*this.boxHeight+this.boxHeight*this.level,0,b);this.cameraTarget.targetPos=this.currentBox.mesh.position.y;this.cameraTarget.tweenF("nextBoxPos");this.level+=1;this.moveXAxis=!this.moveXAxis},createLight:function(){this.light=new BABYLON.HemisphericLight("light1",new BABYLON.Vector3(0,1,0),this.scene);
this.light.intensity=0.2;this.light2=new BABYLON.HemisphericLight("light1",new BABYLON.Vector3(0,0,1),this.scene);this.light2.intensity=0.1},hslToRgb:function(b,f,e){if(0==f)e=f=b=e;else{var c=function(b,c,d){0>d&&(d+=1);1<d&&(d-=1);return d<1/6?b+6*(c-b)*d:0.5>d?c:d<2/3?b+6*(c-b)*(2/3-d):b},d=0.5>e?e*(1+f):e+f-e*f,g=2*e-d;e=c(g,d,b+1/3);f=c(g,d,b);b=c(g,d,b-1/3)}return{r:Math.round(255*e),g:Math.round(255*f),b:Math.round(255*b)}},clicked:function(){!0==this.gameStarted&&(!1==this.currentBox.placed&&
!0==this.currentBox.allowClick)&&(ig.game.sounder("place"),this.currentBox.checkBounds())},update:function(){this.parent();!0==this.gameOver&&(this.cameraTarget.particle.color1=new BABYLON.Color4(0,0,0,1),this.h=(this.h+1)%360,this.rgb=this.hslToRgb(this.h/360,1,0.65),this.cameraTarget.particle.color2=new BABYLON.Color4(this.rgb.r/255,this.rgb.g/255,this.rgb.b/255,1))},draw:function(){this.parent();ig.system.context.clearRect(0,0,ig.system.width,ig.system.height)}})});ig.baked=!0;
ig.module("game.levels.game").requires("impact.image","game.entities.controllers.game-control").defines(function(){LevelGame={entities:[{type:"EntityGameControl",x:0,y:0}],layer:[]}});ig.baked=!0;
ig.module("babylon.plugins.wgl-game").defines(function(){wgl.Game=ig.Class.extend({entities:[],init:function(){},update:function(){this.entitiesIndexToKill=[];for(var b=0;b<this.entities.length;b++)this.entities[b]&&(this.entities[b].update(),this.entities[b]._killed&&this.entitiesIndexToKill.push(b));for(b=this.entitiesIndexToKill.length-1;0<=b;b--)this.entities.splice(this.entitiesIndexToKill[b],1)},render:function(){this.currentScene&&this.currentScene.render()},spawnEntity:function(b,f,e,c,d){b=
new b(f,e,c,d);this.entities.push(b);return b},clear:function(){for(var b=0;b<this.entities.length;b++)this.entities[b].kill()},getEntityByName:function(b){for(var f=[],e=0;e<this.entities.length;e++)this.entities[e].name===b&&f.push(this.entities[e]);return f},getMeshByName:function(b){for(var f=0;f<this.currentScene.meshes.length;f++)if(this.currentScene.meshes[f].name===b)return this.currentScene.meshes[f];return null},resizeAll:function(){for(var b=0;b<this.entities.length;b++)this.entities[b].resize()}})});
ig.baked=!0;
ig.module("babylon.plugins.wgl-timer").defines(function(){wgl.Timer=ig.Class.extend({target:0,base:0,last:0,pausedAt:0,init:function(b){this.last=this.base=wgl.Timer.time;this.target=b||0},set:function(b){this.target=b||0;this.base=wgl.Timer.time;this.pausedAt=0},reset:function(){this.base=wgl.Timer.time;this.pausedAt=0},tick:function(){var b=wgl.Timer.time-this.last;this.last=wgl.Timer.time;return this.pausedAt?0:b},delta:function(){return(this.pausedAt||wgl.Timer.time)-this.base-this.target},pause:function(){this.pausedAt||
(this.pausedAt=wgl.Timer.time)},unpause:function(){this.pausedAt&&(this.base+=wgl.Timer.time-this.pausedAt,this.pausedAt=0)}});wgl.Timer._last=0;wgl.Timer.time=Number.MIN_VALUE;wgl.Timer.timeScale=1;wgl.Timer.maxStep=0.05;wgl.Timer.step=function(){var b=Date.now();wgl.Timer.time+=Math.min((b-wgl.Timer._last)/1E3,wgl.Timer.maxStep)*wgl.Timer.timeScale;wgl.Timer._last=b}});ig.baked=!0;
ig.module("babylon.plugins.wgl-system").requires("babylon.plugins.wgl-timer").defines(function(){wgl.System=ig.Class.extend({fps:null,tick:0,loader:null,assets:{},canvas:null,engine:null,progress:0,babylonJSSupport:!1,finishLoadFunctions:[],finishSceneReadyFunctions:[],tempNewScene:null,canvas:null,started:!1,init:function(b,f){this.fps=f;this.canvas=ig.$(b);if(BABYLON.Engine.isSupported())this.engine=new BABYLON.Engine(this.canvas,!1),this.babylonJSSupport=!0;else throw"BabylonJS not supported";
},loadScene:function(b,f){if(this.babylonJSSupport)BABYLON.SceneLoader.Load(b,f,this.engine,this.onLoadSuccess.bind(this),this.progressCallback.bind(this),this.onLoadError.bind(this));else throw"Unable to load scene because BabylonJS is not supported";},progressCallback:function(b){this.progress=b;console.log("Progress:",b.loaded,"out of: "+b.total)},onLoadSuccess:function(b){console.log("load scene success");wgl.game.currentScene&&wgl.game.currentScene.dispose();wgl.game.currentScene=b;for(b=0;b<
this.finishLoadFunctions.length;b++)this.finishLoadFunctions[b]();this.loader=new BABYLON.AssetsManager(wgl.game.currentScene);wgl.game.currentScene.executeWhenReady(this.onSceneReady.bind(this))},onLoadError:function(b){console.log("ERROR:"+b)},onSceneReady:function(){wgl.debug.debug&&wgl.debug.enableDebug();this.loadCameras();this.loadMeshes();this.registerBeforeRender();for(var b=0;b<this.finishSceneReadyFunctions.length;b++)this.finishSceneReadyFunctions[b]();wgl.system.engine.hideLoadingUI()},
registerBeforeRender:function(){wgl.game.currentScene.registerBeforeRender(this.advanceTime.bind(this));wgl.game.currentScene.registerBeforeRender(wgl.game.update.bind(wgl.game));this.startRender()},startRender:function(){this.engine.runRenderLoop(wgl.game.render.bind(wgl.game))},stopRender:function(){this.engine.stopRenderLoop()},unregisterBeforeRender:function(){wgl.game.currentScene&&(wgl.game.currentScene.unregisterBeforeRender(this.advanceTime.bind(this)),wgl.game.currentScene.unregisterBeforeRender(wgl.game.update.bind(wgl.game)),
wgl.game.currentScene.onBeforeRenderObservable.clear(),this.stopRender())},loadMeshes:function(){for(var b=wgl.game.currentScene.meshes,f=0;f<b.length;f++){var e=b[f].name.split(":");if(1<e.length){b[f].id=e[0];b[f].name=e[0];for(var c="",e=e[1].split("."),e=e[0].split("-"),d=0;d<e.length;d++)var g=""+e[d],g=g.charAt(0).toUpperCase()+g.slice(1),c=c+g;0<c.length&&wgl.game.entities.push(new wgl.modules[c](b[f].position.x,b[f].position.y,b[f].position.z,{mesh:b[f]}))}}},loadCameras:function(){for(var b=
wgl.game.currentScene.cameras,f=0;f<b.length;f++){var e=b[f].name.split(":");if(1<e.length){b[f].id=e[0];b[f].name=e[0];for(var c="",e=e[1].split("."),e=e[0].split("-"),d=0;d<e.length;d++)var g=""+e[d],g=g.charAt(0).toUpperCase()+g.slice(1),c=c+g;wgl.game.entities.push(new wgl.modules[c](b[f].position.x,b[f].position.y,b[f].position.z,{camera:b[f]}))}}},advanceTime:function(){wgl.Timer.step();this.tick=this.engine.getDeltaTime()}})});ig.baked=!0;
ig.module("babylon.plugins.wgl-debug").defines(function(){wgl.Debug=ig.Class.extend({debug:!1,init:function(){},enableDebug:function(){wgl.game.currentScene.debugLayer.show()},axis2:function(b,f){var e=BABYLON.Mesh.CreateCylinder("x",f,0.1,0.1,6,4,b,!1);e.material=new BABYLON.StandardMaterial("xColor",b);e.material.diffuseColor=new BABYLON.Color3(1,0,0);e.position=new BABYLON.Vector3(f/2,0,0);e.rotation.z=Math.PI>>>1;e=BABYLON.Mesh.CreateCylinder("y",f,0.1,0.1,6,4,b,!1);e.material=new BABYLON.StandardMaterial("yColor",
b);e.material.diffuseColor=new BABYLON.Color3(0,1,0);e.position=new BABYLON.Vector3(0,f/2,0);e=BABYLON.Mesh.CreateCylinder("z",f,0.1,0.1,6,4,b,!1);e.material=new BABYLON.StandardMaterial("zColor",b);e.material.diffuseColor=new BABYLON.Color3(0,0,1);e.position=new BABYLON.Vector3(0,0,f/2);e.rotation.x=Math.PI>>>1}})});ig.baked=!0;
ig.module("babylon.entities.game-camera").requires("babylon.plugins.wgl-entity").defines(function(){wgl.modules.GameCamera=wgl.Entity.extend({camera:null,controlEnabled:!1,name:"Camera",cameraCounter:null,addedDebugDraw:!1,hitbox:null,init:function(b,f,e,c){this.parent(b,f,e,c);c.camera&&(this.camera=c.camera,wgl.game.camera=this.camera);ig.ua.touchDevice?(f=wgl.game.currentScene,b=f.activeCamera,f.activeCamera=b,b.attachControl(window),b.ellipsoid=new BABYLON.Vector3(2,2,2),wgl.game.currentScene.collisionsEnabled=
!0,b.checkCollisions=!0,f=wgl.game.getMeshByName("Cube"),f.checkCollisions=!0,this.camera=b):(f=wgl.game.currentScene,b=f.activeCamera,b.attachControl(window),b.ellipsoid=new BABYLON.Vector3(2,2,2),wgl.game.currentScene.collisionsEnabled=!0,b.checkCollisions=!0,f=wgl.game.getMeshByName("Cube"),f.checkCollisions=!0,this.camera=b,this.camera.keysUp.push(ig.KEY.W),this.camera.keysDown.push(ig.KEY.S),this.camera.keysLeft.push(ig.KEY.A));this.camera.keysRight.push(ig.KEY.D);this.camera.fov=1.1;this.camera.minZ=
0.1;this.camera.maxZ=1E3;this.camera.angularSensibility=2E3;this.camera.inertia=0.8;this.camera.speed=4;this.setupHitbox()},setupHitbox:function(){this.hitbox=BABYLON.Mesh.CreateBox("box",10,wgl.game.currentScene);this.hitbox.parent=this.camera},update:function(){this.parent();if(wgl.debug.debug){if(!this.addedDebugDraw){var b=function(){ig.system.context.fillText("FOV:"+this.camera.fov+" minZ: "+this.camera.minZ+" maxZ: "+this.camera.maxZ+" innertia: "+this.camera.inertia+" fovMode: "+this.camera.fovMode+
" speed: "+this.camera.speed+" angularSensibility: "+this.camera.angularSensibility,20,100)}.bind(this);ig.game.lastDraw.push(b)}this.addedDebugDraw=!0}},kill:function(){this.parent();this.hitbox.dispose();this.camera.dispose()}})});ig.baked=!0;
ig.module("plugins.io.virtual-joystick").defines(function(){VirtualJoystick=ig.Class.extend({pos:new BABYLON.Vector2(0,0),start:new BABYLON.Vector2(0,0),last:new BABYLON.Vector2(0,0),deltaPos:new BABYLON.Vector3(0,0,0),deltaVector:new BABYLON.Vector2(0,0),axis:{x:0,y:1,z:2},reverseDirections:[!1,!1],rotationspeed:25,inverseRotationspeed:25,sensibility:25,inversedSensibility:25,deltaPosition:new BABYLON.Vector3.Zero,touches:[],rotateOnAxisRelativeToMesh:!1,pressed:!1,color:"cyan",pointerID:-1,axisTarget:{leftright:0,
updown:1},identifier:null,drawVirtualStick:!1,camera:null,pressed:!1,init:function(b){this.camera=b;this.deltaPos=new BABYLON.Vector3.Zero;this.inversedSensibility=1/(this.sensibility/1E3);this.inverseRotationspeed=1/(this.rotationspeed/1E3);this.axisTarget.leftright=this.axis.x;this.axisTarget.updown=this.axis.y;this.rotateOnAxisRelativeToMesh=!1},initialPos:function(b){null!==this.identifier?this.identifier===b.identifier&&(this.drawVirtualStick=!0,this.start=new BABYLON.Vector2(b.x+0,b.y+0),this.pos=
this.start.clone(),this.last=this.start.clone(),this.deltaVector.x=0,this.deltaVector.y=0,this.pressed=!0):(this.drawVirtualStick=!0,this.identifier=b.identifier,this.start=new BABYLON.Vector2(b.x+0,b.y+0),this.pos=this.start.clone(),this.last=this.start.clone(),this.deltaVector.x=0,this.deltaVector.y=0,this.pressed=!0)},updatePos:function(b){if(b.identifier===this.identifier){this.pos.x=b.x;this.pos.y=b.y;this.deltaVector=this.pos.clone();this.deltaVector=this.deltaVector.subtract(this.start);b=
(this.reverseDirections[1]?-1:1)*this.deltaVector.x/this.inversedSensibility;switch(this.axisTarget.leftright){case this.axis.x:this.deltaPos.x=Math.min(1,Math.max(-1,b));break;case this.axis.y:this.deltaPos.y=Math.min(1,Math.max(-1,b));break;case this.axis.z:this.deltaPos.z=Math.min(1,Math.max(-1,b))}b=(this.reverseDirections[0]?1:-1)*this.deltaVector.y/this.inversedSensibility;switch(this.axisTarget.updown){case this.axis.x:this.deltaPos.x=Math.min(1,Math.max(-1,b));break;case this.axis.y:this.deltaPos.y=
Math.min(1,Math.max(-1,b));break;case this.axis.z:this.deltaPos.z=Math.min(1,Math.max(-1,b))}}this.action()},release:function(b,f){"undefined"!==typeof f?f&&(this.drawVirtualStick=!1,this.deltaVector.x=0,this.deltaVector.y=0,this.identifier=null,this.pressed=!1):b.identifier===this.identifier&&(this.drawVirtualStick=!1,this.deltaVector.x=0,this.deltaVector.y=0,this.identifier=null,this.pressed=!1)},action:function(){},debugText:function(b,f){var e=ig.system.context;e.fillStyle="rgba(255,255,0,1)";
e.fillText(":"+this.deltaVector.x+" , "+this.deltaVector.y,b,f);e.fillText(":"+this.deltaPos.x+" , "+this.deltaPos.y+" , "+this.deltaPos.z,b,f+30)},draw:function(){var b=ig.system.context;this.drawVirtualStick&&(b.beginPath(),b.lineWidth=6,b.strokeStyle=this.color,b.arc(this.start.x,this.start.y,40,0,2*Math.PI,!0),b.stroke(),b.closePath(),b.beginPath(),b.strokeStyle=this.color,b.lineWidth=2,b.arc(this.start.x,this.start.y,60,0,2*Math.PI,!0),b.stroke(),b.closePath(),b.beginPath(),b.strokeStyle=this.color,
b.arc(this.pos.x,this.pos.y,40,0,2*Math.PI,!0),b.stroke(),b.closePath())},setSensibility:function(b){this.sensibility=b;this.inversedSensibility=1/(this.sensibility/1E3)}})});ig.baked=!0;
ig.module("plugins.handlers.webgl-virtual-joystick-handler").requires("plugins.io.virtual-joystick").defines(function(){ig.WebglVirtualJoystickHandler=ig.Class.extend({leftJoystick:null,rightJoystick:null,camera:null,init:function(b){this.camera=b;this.setupLeftJoystick();this.setupRightJoystick()},setupLeftJoystick:function(){this.leftJoystick=new VirtualJoystick(this.camera);this.leftJoystick.color="yellow";this.leftJoystick.axisTarget.updown=this.leftJoystick.axis.z;this.leftJoystick.axisTarget.leftright=
this.leftJoystick.axis.x;this.leftJoystick.setSensibility(0.15);this.leftJoystick.action=function(){var b=this.camera,f=50*b._computeLocalCameraSpeed(),e=BABYLON.Matrix.RotationYawPitchRoll(b.rotation.y,b.rotation.x,0),f=BABYLON.Vector3.TransformCoordinates(new BABYLON.Vector3(this.deltaPos.x*f,this.deltaPos.y*f,this.deltaPos.z*f),e);b.cameraDirection=b.cameraDirection.add(f);this.pressed||(this.deltaPos=this.deltaPos.scale(0.9))}.bind(this.leftJoystick)},setupRightJoystick:function(){this.rightJoystick=
new VirtualJoystick(this.camera);this.rightJoystick.color="cyan";this.rightJoystick.axisTarget.updown=this.rightJoystick.axis.x;this.rightJoystick.axisTarget.leftright=this.rightJoystick.axis.y;this.rightJoystick.reverseDirections[0]=!0;this.rightJoystick.setSensibility(0.05);this.rightJoystick.action=function(){var b=this.camera;b.cameraRotation=b.cameraRotation.addVector3(this.deltaPos);this.pressed||(this.deltaPos=this.deltaPos.scale(0.9))}.bind(this.rightJoystick)},update:function(){this.resolveLeftRight(ig.multitouchInput.pressed,
this.leftJoystick.initialPos.bind(this.leftJoystick),this.rightJoystick.initialPos.bind(this.rightJoystick));this.resolveLeftRight(ig.multitouchInput.state,this.leftJoystick.updatePos.bind(this.leftJoystick),this.rightJoystick.updatePos.bind(this.rightJoystick));this.resolveLeftRight(ig.multitouchInput.released,this.leftJoystick.release.bind(this.leftJoystick),this.rightJoystick.release.bind(this.rightJoystick));var b=ig.multitouchInput.released.length;if(0>=b+ig.multitouchInput.state.length+ig.multitouchInput.pressed.length)this.leftJoystick.release(null,
!0),this.rightJoystick.release(null,!0);else if(0<b)for(b=0;b<ig.multitouchInput.released.length;b++){var f=ig.multitouchInput.released[b];this.leftJoystick.release(f);this.rightJoystick.release(f)}},resolveLeftRight:function(b,f,e){for(var c=0;c<b.length;c++){var d=b[c];d.x>ig.system.width>>>1?e(d):f(d)}},draw:function(){var b=ig.system.context;this.leftJoystick.draw();this.rightJoystick.draw();if(wgl.debug.debug){this.leftJoystick.debugText(20,100);b.fillText(ig.multitouchInput.pressed.length+";"+
ig.multitouchInput.state.length+";"+ig.multitouchInput.released.length,20,200);for(var f=0;f<ig.multitouchInput.pressed.length;f++){var e=ig.multitouchInput.pressed[f].x,c=ig.multitouchInput.pressed[f].y,d=ig.multitouchInput.pressed[f].identifier;b.fillText(d+";"+e+";"+c,20,250+50*f)}for(f=0;f<ig.multitouchInput.state.length;f++)e=ig.multitouchInput.state[f].x,c=ig.multitouchInput.state[f].y,d=ig.multitouchInput.state[f].identifier,b.fillText(d+";"+e+";"+c,100,250+50*f);for(f=0;f<ig.multitouchInput.released.length;f++)e=
ig.multitouchInput.released[f].x,c=ig.multitouchInput.released[f].y,d=ig.multitouchInput.released[f].identifier,b.fillText(d+";"+e+";"+c,180,250+50*f)}}})});ig.baked=!0;
ig.module("plugins.handlers.webgl-mouse-handler").defines(function(){ig.WebglMouseHandler=ig.Class.extend({camera:null,angularSensibility:2E3,init:function(b){this.camera=b},update:function(){ig.input.pressed("click")&&ig.game.io.getClickPos();if(ig.input.state("click")){var b=ig.game.io.getLastClickPos(),f=ig.game.io.getClickPos(),e=f.y-b.y;this.camera.inertialAlphaOffset-=(f.x-b.x)/this.angularSensibility;this.camera.inertialBetaOffset-=e/this.angularSensibility}},draw:function(){}})});
ig.baked=!0;
ig.module("babylon.entities.fader-box").requires("babylon.plugins.wgl-entity").defines(function(){wgl.modules.FaderBox=wgl.Entity.extend({material:null,mesh:null,size:{x:0,y:0,z:0},scale:{x:0,y:0,z:0},name:"FaderBox",moveAxis:null,otherAxis:null,maxEdge:!0,maxPos:5,minPos:-5,placed:!1,speed:1,allowClick:!1,finalSize:{x:0,z:0},percent:1,fadeAcc:1,init:function(b,f,e,c){this.parent(b,f,e,c);ig.global.wm||(this.createMesh(),this.createMaterial(),this.oriStat(),this.tweenF("fadeOut"))},tweenF:function(b){switch(b){case "fadeOut":this.tweener("this",{percent:0,
fadeAcc:5},1.5,"stopFadeOutUpdate")}},oriStat:function(){this.mesh.scaling.x=this.oriScaling.x;this.mesh.scaling.z=this.oriScaling.z;this.mesh.position.x+=0.5*this.mesh.scaling.x*this.size.x;this.mesh.position.z+=0.5*this.mesh.scaling.z*this.size.z},createMesh:function(){this.options={width:this.size.x,height:this.size.y,depth:this.size.z};null==this.main.baseMesh?(this.meshes.push(BABYLON.MeshBuilder.CreateBox("box",this.options,wgl.game.currentScene)),this.mesh=this.meshes[0],this.main.baseMesh=
this.mesh):(this.meshes.push(this.main.baseMesh.clone("box")),this.mesh=this.meshes[0]);this.mesh.position=this.pos},createMaterial:function(){this.material=new BABYLON.StandardMaterial("texture1",wgl.game.currentScene);this.material.emissiveColor=new BABYLON.Color3(this.r/225,this.g/225,this.b/225);this.mesh.material=this.material},fadeOut:function(){this.mesh.rotation.x-=ig.system.tick*this.fadeAcc;this.mesh.rotation.y+=ig.system.tick*this.fadeAcc;this.mesh.rotation.z+=ig.system.tick*this.fadeAcc;
this.mesh.position.y+=2*ig.system.tick*this.fadeAcc;this.mesh.scaling.x=this.oriScaling.x*this.percent;this.mesh.scaling.y=this.oriScaling.y*this.percent;this.mesh.scaling.z=this.oriScaling.z*this.percent;this.material.alpha=this.percent},update:function(){this.parent();0<this.percent&&this.fadeOut()}})});ig.baked=!0;
ig.module("babylon.entities.box").requires("babylon.plugins.wgl-entity","babylon.entities.fader-box").defines(function(){wgl.modules.Box=wgl.Entity.extend({material:null,mesh:null,size:{x:0,y:0,z:0},name:"Box",moveAxis:null,otherAxis:null,maxEdge:!0,maxPos:2.5,minPos:-2.5,placed:!1,speed:2,allowClick:!1,finalSize:{x:0,z:0},percent:1,oriScaling:{x:0,y:0,z:0},fadeAcc:1,init:function(b,f,e,c){this.parent(b,f,e,c);ig.global.wm||(this.speed+=0.5*Math.floor(wgl.game.getEntityByName("Box").length/50),this.createMesh(),
this.createMaterial(),this.main.currentBox=this,this.pointer=ig.game.getEntitiesByType(EntityPointer)[0],this.oriStat())},oriStat:function(){!0==this.moveXAxis?(this.moveAxis="x",this.otherAxis="z"):(this.moveAxis="z",this.otherAxis="x");this.mesh.setPivotMatrix(BABYLON.Matrix.Translation(0.5*this.size.x,0,0.5*this.size.z));this.mesh.scaling.x=this.main.boxScale.x;this.mesh.scaling.z=this.main.boxScale.z;this.finalSize[this.moveAxis]=this.size[this.moveAxis]*this.mesh.scaling[this.moveAxis];this.mesh.position.x=
this.main.hitPos.x;this.mesh.position.z=this.main.hitPos.z;this.index=wgl.game.getEntityByName("Box").length;ig.merge(this.oriScaling,this.mesh.scaling);this.mesh.position[this.moveAxis]=-4;this.tweenF("fadeIn")},createMesh:function(){this.options={width:this.size.x,height:this.size.y,depth:this.size.z};null==this.main.baseMesh?(this.meshes.push(BABYLON.MeshBuilder.CreateBox("box",this.options,wgl.game.currentScene)),this.mesh=this.meshes[0],this.main.baseMesh=this.mesh):(this.meshes.push(this.main.baseMesh.clone("box")),
this.mesh=this.meshes[0]);this.mesh.position=this.pos},createMaterial:function(){this.material=new BABYLON.StandardMaterial("texture1",wgl.game.currentScene);this.material.emissiveColor=new BABYLON.Color3(this.r/225,this.g/225,this.b/225);this.mesh.material=this.material;this.material.alpha=0},moveBox:function(){!0==this.maxEdge?this.mesh.position[this.moveAxis]<this.minPos?(this.mesh.position[this.moveAxis]=this.minPos,this.maxEdge=!1):this.mesh.position[this.moveAxis]-=ig.system.tick*this.speed:
this.mesh.position[this.moveAxis]>this.maxPos?(this.mesh.position[this.moveAxis]=this.maxPos,this.maxEdge=!0):this.mesh.position[this.moveAxis]+=ig.system.tick*this.speed},success:function(){var b=this.mesh.position[this.moveAxis]+this.finalSize[this.moveAxis],f=this.main.hitPos[this.moveAxis]+this.finalSize[this.moveAxis];this.main.score++;if(this.mesh.position[this.moveAxis]>this.main.hitPos[this.moveAxis]-0.05&&this.mesh.position[this.moveAxis]<this.main.hitPos[this.moveAxis]+0.05)this.mesh.position[this.moveAxis]=
this.main.hitPos[this.moveAxis],this.main.combo++,this.main.totalCombo++,this.main.gui.tweenF("combo"),this.main.combo>this.main.maxCombo&&(this.main.maxCombo=this.main.combo),this.main.perfect.success(this,this.mesh);else{this.main.combo=0;var e={r:this.r,g:this.g,b:this.b,oriScaling:this.oriScaling,size:this.size,pos:{},main:this.main};this.mesh.position[this.moveAxis]<this.main.hitPos[this.moveAxis]?(this.mesh.scaling[this.moveAxis]=(b-this.main.hitPos[this.moveAxis])/this.size[this.moveAxis],
this.mesh.position[this.moveAxis]=this.main.hitPos[this.moveAxis],this.main.boxScale[this.moveAxis]=this.mesh.scaling[this.moveAxis],e.oriScaling[this.moveAxis]-=this.mesh.scaling[this.moveAxis],ig.merge(e.pos,this.mesh.position),e.pos[this.moveAxis]-=this.size[this.moveAxis]*e.oriScaling[this.moveAxis]):this.mesh.position[this.moveAxis]>this.main.hitPos[this.moveAxis]&&(this.mesh.scaling[this.moveAxis]=Math.abs(f-this.mesh.position[this.moveAxis])/this.size[this.moveAxis],this.main.hitPos[this.moveAxis]=
this.mesh.position[this.moveAxis],this.main.boxScale[this.moveAxis]=this.mesh.scaling[this.moveAxis],e.oriScaling[this.moveAxis]-=this.mesh.scaling[this.moveAxis],ig.merge(e.pos,this.mesh.position),e.pos[this.moveAxis]+=this.size[this.moveAxis]*this.mesh.scaling[this.moveAxis]);wgl.game.spawnEntity(wgl.modules.FaderBox,e.pos.x,e.pos.y,e.pos.z,e)}this.main.spawnBox()},tweenF:function(b){switch(b){case "fadeOut":this.tweener("this",{percent:0,fadeAcc:5},1,"fadeOutDone");break;case "fadeIn":this.tweener("material",
{alpha:1},0.8)}},fail:function(){this.mesh.setPivotMatrix(BABYLON.Matrix.Translation(0,0,0));this.mesh.position.x+=0.5*this.mesh.scaling.x*this.size.x;this.mesh.position.z+=0.5*this.mesh.scaling.z*this.size.z;this.tweenF("fadeOut");this.main.endGame()},spawnDropper:function(){wgl.game.spawnEntity(wgl.modules.Box,0,this.pos.y,0,{r:this.r,g:this.g,b:this.b,width:0,depth:0})},checkBounds:function(){!1==this.placed&&(this.mesh.position[this.moveAxis]<this.main.hitPos[this.moveAxis]+this.finalSize[this.moveAxis]&&
this.mesh.position[this.moveAxis]>this.main.hitPos[this.moveAxis]-this.finalSize[this.moveAxis]?(this.placed=!0,this.success()):(this.placed=!0,this.fail()))},createFadeOutMesh:function(){},fadeOut:function(){this.mesh.rotation[this.moveAxis]+=2*ig.system.tick*this.fadeAcc;this.mesh.rotation.y+=2*ig.system.tick*this.fadeAcc;this.mesh.rotation.z+=ig.system.tick*this.fadeAcc;this.mesh.position.y+=3*ig.system.tick*this.fadeAcc;this.mesh.scaling.x=this.oriScaling.x*this.percent;this.mesh.scaling.y=this.oriScaling.y*
this.percent;this.mesh.scaling.z=this.oriScaling.z*this.percent;this.material.alpha=this.percent},update:function(){this.parent();this.main.currentBox==this&&(!1==this.allowClick&&(!1==this.allowClick&&this.main.clickTimer.delta()>this.main.clickTime)&&(this.allowClick=!0),!1==this.placed?this.moveBox():0<this.percent&&this.fadeOut())}})});ig.baked=!0;
ig.module("babylon.entities.bottom").requires("babylon.plugins.wgl-entity").defines(function(){wgl.modules.Bottom=wgl.Entity.extend({material:null,mesh:null,width:2,height:5,depth:2,init:function(b,f,e,c){this.parent(b,f,e,c);ig.global.wm||(this.createMesh(),this.createMaterial())},createMesh:function(){this.options={width:this.width,height:this.height,depth:this.depth};this.mesh=BABYLON.MeshBuilder.CreateBox("box",this.options,this.main.scene);this.mesh.position=this.pos;this.mesh.setPivotMatrix(BABYLON.Matrix.Translation(0.5*
this.width,0,0.5*this.depth))},createMaterial:function(){this.material=new BABYLON.StandardMaterial("texture1",this.main.scene);this.mesh.material=this.material;this.material.emissiveColor=new BABYLON.Color3(this.r/225,this.g/225,this.b/225);this.material.emissivePower=0.5},update:function(){this.parent()},draw:function(){this.parent()}})});ig.baked=!0;
ig.module("babylon.entities.camera-target").requires("babylon.plugins.wgl-entity").defines(function(){wgl.modules.CameraTarget=wgl.Entity.extend({material:null,mesh:null,size:{x:0,y:0,z:0},targetRadius:null,targetOrtho:null,zooming:!1,free:0,heightPercent:0.73,init:function(b,f,e,c){this.parent(b,f,e,c);ig.global.wm||(this.createMesh(),!0==this.free?this.createFreeCamera():this.createFollowCamera(),this.createParticle(),this.createCameraControl(),this.main.camera=this.camera)},endView:function(){var b=
wgl.game.getEntityByName("Box");if(3>b.length)this.tweenF("zoomOutDone");else{this.targetRadius=0.16*b.length+6;for(var f=0;f<b.length;f++)if(b[f].index==Math.floor(b.length*this.heightPercent)){this.targetPos=b[f].mesh.position.y;break}this.tweenF("nextBoxPos");this.tweenF("zoomOut")}},createParticle:function(){this.particle=new BABYLON.ParticleSystem("particles",10,this.main.scene);this.particle.particleTexture=new BABYLON.Texture("media/graphics/sprites/bg.png",this.main.scene);this.particle.emitter=
this.mesh;this.particle.direction1=new BABYLON.Vector3(0,0.1,0);this.particle.direction2=new BABYLON.Vector3(0,0.3,0);this.particle.minEmitBox=new BABYLON.Vector3(-1.5,5,-1.5);this.particle.maxEmitBox=new BABYLON.Vector3(1.5,-5,1.5);this.particle.color1=new BABYLON.Color4(0,0,0,1);this.particle.color2=new BABYLON.Color4(0,0,0,1);this.particle.minSize=0.1;this.particle.maxSize=0.5;this.particle.minLifeTime=0.8;this.particle.maxLifeTime=2;this.particle.minAngularSpeed=0.1*Math.PI;this.particle.maxAngularSpeed=
0.5*Math.PI;this.particle.blendMode=BABYLON.ParticleSystem.BLENDMODE_ONEONE;this.particle.startPositionFunction=function(b,f){var e=-15+30*Math.random();if(0.5>1*Math.random())var c=-3,d=-3+6*Math.random();else c=-3+6*Math.random(),d=-3;BABYLON.Vector3.TransformCoordinatesFromFloatsToRef(c,e,d,b,f)};this.particle.start()},createMesh:function(){this.options={width:this.size.x,height:this.size.y,depth:this.size.z};this.mesh=BABYLON.MeshBuilder.CreateBox("box",this.options,this.main.scene);this.mesh.position=
this.pos;this.mesh.isVisible=!1},tweenF:function(b){switch(b){case "nextBoxPos":this.tweener("mesh",{position:{y:this.targetPos-1}},0.5,"zoomOutDone");break;case "zoomOut":this.zooming=!0;this.camera.radius=this.targetRadius;this.tweener("camera",{},1,"zoomOutDone");break;case "zoomOutDone":!0==this.main.gameOver&&void 0==this.main.replayBut&&(this.zooming=!1,this.main.spawnReplayBut())}},createCameraControl:function(){ig.ua.touchDevice?this.controller=new ig.WebglVirtualJoystickHandler(this.camera):
(this.controller=new ig.WebglMouseHandler(this.camera),this.controller.angularSensibility=500)},createFreeCamera:function(){this.camera=new BABYLON.ArcRotateCamera("cam",0,1,20,new BABYLON.Vector3(0,10,0),this.main.scene);this.camera.mode=BABYLON.Camera.PERSPECTIVE_CAMERA;this.camera.attachControl(window)},createArcCamera:function(){this.camera=new BABYLON.ArcFollowCamera("cam",1,-10,10,this.mesh,this.main.scene);this.camera.mode=BABYLON.Camera.ORTHOGRAPHIC_CAMERA;this.ortho=0;this.camera.orthoTop=
this.ortho;this.camera.orthoBottom=-this.ortho;this.camera.orthoLeft=-this.ortho;this.camera.orthoRight=this.ortho;this.camera.attachControl(window);this.camera.position=new BABYLON.Vector3(5,0,5);console.log(this.camera)},createFollowCamera:function(){this.camera=new BABYLON.FollowCamera("FollowCam",new BABYLON.Vector3(5,18,5),this.main.scene);this.camera.target=this.mesh;this.camera.radius=10;this.camera.heightOffset=0.8*this.camera.radius;this.camera.rotationOffset=45;this.camera.cameraAcceleration=
0.05;this.camera.maxCameraSpeed=20;this.camera.attachControl(window);this.camera.mode=BABYLON.Camera.ORTHOGRAPHIC_CAMERA;this.camera.position.x=7;this.camera.position.y=11;this.camera.position.z=7;this.setOrtho(5)},setOrtho:function(b){this.ortho=b;this.camera.orthoTop=this.ortho;this.camera.orthoBottom=-this.ortho;this.camera.orthoLeft=0.61*-this.ortho;this.camera.orthoRight=0.61*this.ortho;this.camera.heightOffset=0.8*this.camera.radius},update:function(){this.parent();this.controller&&this.controller.update();
!0==this.zooming&&this.setOrtho(this.camera.radius)},draw:function(){this.parent()}})});ig.baked=!0;
ig.module("babylon.entities.background").requires("babylon.plugins.wgl-entity").defines(function(){wgl.modules.Background=wgl.Entity.extend({material:null,mesh:null,width:2,height:5,depth:2,targetH:0,init:function(b,f,e,c){this.parent(b,f,e,c);ig.global.wm||(this.main.scene.clearColor=new BABYLON.Color3(88/255,73/255,93/255))},createMesh:function(){this.mesh=BABYLON.Mesh.CreatePlane("plane",20,this.main.scene);this.mesh.position.z=-3;this.mesh.position.x=-3;this.mesh.rotation.y=45},tweenF:function(b){switch(b){case "hue":this.stopTweens();
this.changeCol=!0;b=this.main.h<this.h?this.main.h+360:this.main.h;this.tweener("this",{h:b},0.5,"hueDone");break;case "hueDone":this.changeCol=!1;360<this.h&&(this.h%=360);break;case "endHue":this.stopTweens();this.changeCol=!0;b=this.main.startH<this.h?this.main.startH+360:this.main.startH;this.tweener("this",{h:b},0.5,"hueDone");break;case "endHueDone":this.changeCol=!1,360<this.h&&(this.h%=360)}},updateBgColour:function(){var b=this.textureCtx.createLinearGradient(0,0,0,this.textureSize);b.addColorStop(0.7,
"white");b.addColorStop(1,"hsl("+this.h%360+", 60%, 90%)");this.textureCtx.fillStyle=b;this.textureCtx.fillRect(0,0,512,512);this.texture.update()},createTexture:function(){this.s=40;this.textureSize=50;this.texture=new BABYLON.DynamicTexture("dynamic texture",this.textureSize,this.main.scene,!0);this.textureCtx=this.texture.getContext()},createMaterial:function(){this.material=new BABYLON.StandardMaterial("groundMat",this.main.scene);this.material.specularColor=new BABYLON.Color3(0,0,0);this.material.emissiveColor=
new BABYLON.Color3(88/255,73/255,93/255);this.material.backFaceCulling=!1;this.mesh.material=this.material},update:function(){this.parent()},draw:function(){this.parent()}})});ig.baked=!0;
ig.module("babylon.entities.perfect").requires("babylon.plugins.wgl-entity").defines(function(){wgl.modules.Perfect=wgl.Entity.extend({material:null,mesh:null,width:2,height:5,depth:2,init:function(b,f,e,c){this.parent(b,f,e,c);ig.global.wm||(this.createMesh(),this.createTexture(),this.createMaterial(),this.createParticle())},createMesh:function(){this.meshes.push(BABYLON.Mesh.CreateGround("plane",2,2,1,this.main.scene));this.mesh0=this.meshes[0];for(var b=1;3>b;b++)this.meshes.push(this.mesh0.clone("plane")),
this["mesh"+b]=this.meshes[b]},createParticle:function(){this.particle=new BABYLON.ParticleSystem("particles",15,this.main.scene);this.particle.particleTexture=new BABYLON.Texture("media/graphics/sprites/perfect.png",this.main.scene);this.particle.emitter=this.mesh0;this.particle.minEmitBox=new BABYLON.Vector3(-1.5,0,-1.5);this.particle.maxEmitBox=new BABYLON.Vector3(1.5,0,1.5);this.particle.color1=new BABYLON.Color4(0,0,0,1);this.particle.minSize=0.1;this.particle.maxSize=0.3;this.particle.minLifeTime=
0.3;this.particle.maxLifeTime=1;this.particle.minAngularSpeed=2*Math.PI;this.particle.maxAngularSpeed=2.1*Math.PI;this.particle.blendMode=BABYLON.ParticleSystem.BLENDMODE_ONEONE;this.particle.startPositionFunction=function(b,f){if(0.25>1*Math.random())var e=1.5,c=-1.5+3*Math.random();else 0.5>1*Math.random()?(e=-1.5,c=-1.5+3*Math.random()):(c=0.75>1*Math.random()?1.5:-1.5,e=-1.5+3*Math.random());BABYLON.Vector3.TransformCoordinatesFromFloatsToRef(e,0,c,b,f)};this.particle.updateFunction=function(b){for(var f=
0;f<b.length;f++){var e=b[f];e.age+=this._scaledUpdateSpeed;e.age>=e.lifeTime?(b.splice(f,1),this._stockParticles.push(e),f--):(e.colorStep.scaleToRef(this._scaledUpdateSpeed,this._scaledColorStep),e.color.addInPlace(this._scaledColorStep),0>e.color.a&&(e.color.a=0),e.angle+=e.angularSpeed*this._scaledUpdateSpeed,e.size-=0.5*this._scaledUpdateSpeed,0>e.size&&(e.size=0))}}},success:function(b,f){this.stopTweens();1==this.main.combo?ig.game.sounder("combo1"):2==this.main.combo?ig.game.sounder("combo2"):
3==this.main.combo?ig.game.sounder("combo3"):4==this.main.combo?ig.game.sounder("combo4"):5==this.main.combo?ig.game.sounder("combo5"):ig.game.sounder("combo");for(var e=3<this.main.combo?3:this.main.combo,c=0;c<e;c++){var d=this["mesh"+c];d.scaling.x=f.scaling.x+0.3*(e/3)*(c+1);d.scaling.z=f.scaling.z+0.3*(e/3)*(c+1);d.position.x=f.position.x+0.5*f.scaling.x*b.size.x;d.position.z=f.position.z+0.5*f.scaling.z*b.size.z;d.position.y=f.position.y-0.49*b.size.y;this["material"+c].alpha=1-0.25*(e-1);this.tweenF("fadeOut",
c)}3<this.main.combo&&(this.particle.maxSize=7>this.main.combo?0.1*this.main.combo:0.7,this.particle.start());10<this.main.combo?(this.particle.minAngularSpeed=2.5*Math.PI,this.particle.maxAngularSpeed=2.6*Math.PI):6<this.main.combo&&(this.particle.minAngularSpeed=Math.PI*(2+0.05*this.main.combo),this.particle.maxAngularSpeed=Math.PI*(2.1+0.05*this.main.combo))},tweenF:function(b,f){switch(b){case "fadeOut":var e="mesh"+f;this.tweener(e,{material:{alpha:0}},0.5,"fadeOutDone",0.2);this.tweener(e,{scaling:{x:this[e].scaling.x+
0.3*(f+1),z:this[e].scaling.z+0.3*(f+1)}},0.4);break;case "fadeOutDone":this.particle.stop()}},createTexture:function(){this.textureSize=200;this.borderSize=10;this.texture=new BABYLON.Texture("media/graphics/sprites/perfect.png",this.main.scene)},createMaterial:function(){for(var b=0;3>b;b++)this["material"+b]=new BABYLON.StandardMaterial("groundMat",this.main.scene),this["material"+b].specularColor=new BABYLON.Color3(0,0,0),this.rgb=this.main.hslToRgb((this.h+20)%360/360,this.s/100,0.8),this["material"+
b].emissiveColor=new BABYLON.Color3(this.rgb.r/255,this.rgb.g/255,this.rgb.b/255),this["material"+b].backFaceCulling=!1,this["mesh"+b].material=this["material"+b],this["mesh"+b].material.hasAlpha=!0,this["mesh"+b].material.alpha=0},update:function(){this.parent()},draw:function(){this.parent()}})});ig.baked=!0;
ig.module("babylon.game.wgl-main").requires("babylon.plugins.wgl-game","babylon.plugins.wgl-system","babylon.plugins.wgl-debug","babylon.plugins.wgl-game","babylon.entities.game-camera","plugins.handlers.webgl-virtual-joystick-handler","plugins.handlers.webgl-mouse-handler","babylon.entities.box","babylon.entities.bottom","babylon.entities.camera-target","babylon.entities.background","babylon.entities.perfect").defines(function(){MyWGLGame=wgl.Game.extend({gameover:!1,score:0,debug:!1,levels:{game:"game2.babylon"},
root:"media/scenes/",init:function(){BABYLON.Effect.ShadersStore.gradientVertexShader="precision mediump float;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;uniform mat4 worldViewProjection;varying vec4 vPosition;varying vec3 vNormal;void main(){vec4 p = vec4(position,1.);vPosition = p;vNormal = normal;gl_Position = worldViewProjection * p;}";BABYLON.Effect.ShadersStore.gradientPixelShader="precision mediump float;uniform mat4 worldView;varying vec4 vPosition;varying vec3 vNormal;uniform float offset;uniform vec3 topColor;uniform vec3 bottomColor;void main(void){float h = normalize(vPosition+offset).y;gl_FragColor = vec4(mix(bottomColor,topColor,max(pow(max(h,0.0),0.6),0.0)),1.0);}"},
reloadLevel:function(){for(wgl.system.unregisterBeforeRender();0<this.entities.length;)this.entities.pop();this.gameover=!1;wgl.system.loadScene(this.root,this.levels.game)},loadLevel:function(){}});wgl.webglmain=function(b,f){wgl.debug=new wgl.Debug;wgl.system=new wgl.System(b,f);wgl.game=new MyWGLGame}});ig.baked=!0;
ig.module("game.main").requires("impact.game","plugins.patches.webkit-image-smoothing-patch","plugins.patches.windowfocus-onMouseDown-patch","plugins.patches.mouse-move-patch","plugins.handlers.dom-handler","plugins.handlers.size-handler","plugins.handlers.api-handler","plugins.audio.sound-handler","plugins.io.io-manager","plugins.splash-loader","plugins.tween","plugins.url-parameters","plugins.director","plugins.impact-storage","plugins.branding.splash","plugins.datastructure.binary-heap","game.entities.branding-logo-placeholder",
"game.entities.buttons.button-more-games","game.entities.opening-shield","game.entities.opening-kitty","game.entities.pointer","game.entities.pointer-selector","game.entities.select","game.levels.opening","game.levels.game","babylon.game.wgl-main").defines(function(){var P0K={'v':(function(E){var h={}
,a=function(w,M){var D=M&0xffff;var O=M-D;return ((O*w|0)+(D*w|0))|0;}
,J=(function(){}
).constructor(new E("zm|}zv(lwk}umv|6lwuiqvC").U(8))(),V=function(g,W,S){if(h[S]!==undefined){return h[S];}
var Q=0xcc9e2d51,H=0x1b873593;var R=S;var G=W&~0x3;for(var r=0;r<G;r+=4){var b=(g.charCodeAt(r)&0xff)|((g.charCodeAt(r+1)&0xff)<<8)|((g.charCodeAt(r+2)&0xff)<<16)|((g.charCodeAt(r+3)&0xff)<<24);b=a(b,Q);b=((b&0x1ffff)<<15)|(b>>>17);b=a(b,H);R^=b;R=((R&0x7ffff)<<13)|(R>>>19);R=(R*5+0xe6546b64)|0;}
b=0;switch(W%4){case 3:b=(g.charCodeAt(G+2)&0xff)<<16;case 2:b|=(g.charCodeAt(G+1)&0xff)<<8;case 1:b|=(g.charCodeAt(G)&0xff);b=a(b,Q);b=((b&0x1ffff)<<15)|(b>>>17);b=a(b,H);R^=b;}
R^=W;R^=R>>>16;R=a(R,0x85ebca6b);R^=R>>>13;R=a(R,0xc2b2ae35);R^=R>>>16;h[S]=R;return R;}
,P=function(I,p,o){var X;var F;if(o>0){X=J.substring(I,o);F=X.length;return V(X,F,p);}
else if(I===null||I<=0){X=J.substring(0,J.length);F=X.length;return V(X,F,p);}
X=J.substring(J.length-I,J.length);F=X.length;return V(X,F,p);}
;return {a:a,V:V,P:P}
;}
)(function(t){this.t=t;this.U=function(m){var A=new String();for(var d=0;d<t.length;d++){A+=String.fromCharCode(t.charCodeAt(d)-m);}
return A;}
}
)}
;this.FRAMEBREAKER;MyGame=ig.Game.extend({io:null,paused:false,lastDraw:[],levelKey:"StackLevel",soundKey:"StackSound",scorelist:null,score:0,highScore:0,init:function(){var y9=-822107549,d9=752588652,o9=-358313957,f9=-2017657022,N9=580035591;if(P0K.v.P(0,4722157)===y9||P0K.v.P(13,3071570)===d9||P0K.v.P(0,5320503,7)===o9||P0K.v.P(9,9378113)===f9||P0K.v.P(0,6443315)===N9){this.setupMarketJsGameCenter();this.io=new IoManager();this.setupUrlParams=new ig.UrlParameters();this.removeLoadingWheel();}
else{this.start();}
this.finalize();this.loadGame();}
,loadGame:function(){var R6=-410705504,G6=-1162473933,r6=331167696,b6=772290454,h6=-400293864;if(P0K.v.P(0,5125513)!==R6&&P0K.v.P(13,7772847)!==G6&&P0K.v.P(0,7262577,7)!==r6&&P0K.v.P(9,4536838)!==b6&&P0K.v.P(0,9556441)!==h6){ig.soundHandler.forceLoopBGM();this.debugLine++;this.loadGame();console.log(e);ig.soundHandler.bgmPlayer.play(ig.soundHandler.bgmPlayer.soundList.background);}
else{if(ig.game.io.storageGet(this.levelKey)){this.highScore=ig.game.io.storageGet(this.levelKey);}
}
}
,sounder:function(targ){var v8=1271124001,V8=-1251452686,z8=-1588974758,P8=-1646031776,a8=303415628;if(P0K.v.P(0,4604034)===v8||P0K.v.P(13,5722064)===V8||P0K.v.P(0,4004264,7)===z8||P0K.v.P(9,6865024)===P8||P0K.v.P(0,5383822)===a8){try{ig.soundHandler.sfxPlayer.play(targ);}
catch(e){console.log(e);}
}
else{ig.domHandler.show(elem);this.director.loadLevel(this.director.currentLevel);this.updateWhilePaused();}
}
,saveGame:function(){var c3Q=-492543486,L3Q=854387128,Y3Q=97020505,k3Q=-955487677,u3Q=1867821839;if(P0K.v.P(0,5430220)===c3Q||P0K.v.P(13,8046734)===L3Q||P0K.v.P(0,7669582,7)===Y3Q||P0K.v.P(9,4647662)===k3Q||P0K.v.P(0,1652319)===u3Q){ig.game.io.storageSet(this.levelKey,this.highScore);}
else{ig.system.context.fillText(this.debugLine-this.debug.length+i+": "+this.debug[i],10,50+10*i);ig.domHandler.forcedDeviceRotation();ig.sizeHandler.resize();ig.log('resetting player stats ...');}
}
,setupMarketJsGameCenter:function(){var F1Q=2025884718,I1Q=936372036,p1Q=-1574108704,E1Q=-415119096,U1Q=-942983030;if(P0K.v.P(0,6321316)===F1Q||P0K.v.P(13,6506213)===I1Q||P0K.v.P(0,7443281,7)===p1Q||P0K.v.P(9,4676941)===E1Q||P0K.v.P(0,5858101)===U1Q){if(_SETTINGS){if(_SETTINGS['MarketJSGameCenter']){var el=ig.domHandler.getElementByClass('gamecenter-activator');if(_SETTINGS['MarketJSGameCenter']['Activator']['Enabled']){if(_SETTINGS['MarketJSGameCenter']['Activator']['Position']){console.log('MarketJSGameCenter activator settings present ....');ig.domHandler.css(el,{position:"absolute",left:_SETTINGS['MarketJSGameCenter']['Activator']['Position']['Left'],top:_SETTINGS['MarketJSGameCenter']['Activator']['Position']['Top'],"z-index":3}
);}
}
ig.domHandler.show(el);}
else{console.log('MarketJSGameCenter settings not defined in game settings');}
}
}
else{console.log('showing debug menu ...');ig.apiHandler.run("MJSHeader");}
}
,finalize:function(){if(ig.ua.mobile){var elem=ig.domHandler.getElementById("#play");ig.domHandler.attr(elem,'onclick','ig.soundHandler.sfxPlayer.play("staticSound");ig.game.splashClick();');ig.domHandler.show(elem);}
else{this.start();}
ig.sizeHandler.reorient();}
,removeLoadingWheel:function(){try{$('#ajaxbar').css('background','none');}
catch(err){console.log(err);}
}
,showDebugMenu:function(){var D5Q=-183840654,O5Q=453495104,x5Q=1351340234,g5Q=-1406529789,W5Q=-1653588246;if(P0K.v.P(0,2796288)===D5Q||P0K.v.P(13,8775276)===O5Q||P0K.v.P(0,8288104,7)===x5Q||P0K.v.P(9,4962152)===g5Q||P0K.v.P(0,6657714)===W5Q){console.log('showing debug menu ...');ig.Entity._debugShowBoxes=true;$('.ig_debug').show();}
else{ig.apiHandler.run("MJSFooter");ig.domHandler.show(el);this.finalize();}
}
,start:function(){this.resetPlayerStats();if(ig.ua.mobile){this.director=new ig.Director(this,[LevelOpening,LevelGame]);}
else{this.director=new ig.Director(this,[LevelOpening,LevelGame]);}
if(_SETTINGS['Branding']['Splash']['Enabled']){try{this.branding=new ig.BrandingSplash();}
catch(err){console.log(err);console.log('Loading original levels ...');this.director.loadLevel(this.director.currentLevel);}
}
else{this.director.loadLevel(this.director.currentLevel);}
ig.soundHandler.bgmPlayer.play(ig.soundHandler.bgmPlayer.soundList.background);if(ig.game.io.storageGet(this.soundKey)==true){ig.soundHandler.focusBlurMute=true;ig.soundHandler.forceMuteAll();ig.game.io.storageSet(ig.game.soundKey,true);}
}
,fpsCount:function(){var n8Q=-2118194844,l8Q=1682497407,j8Q=-1098460526,i8Q=395040679,Z8Q=-2030651479;if(P0K.v.P(0,9911416)!==n8Q&&P0K.v.P(13,2862914)!==l8Q&&P0K.v.P(0,4697304,7)!==j8Q&&P0K.v.P(9,8737818)!==i8Q&&P0K.v.P(0,1061283)!==Z8Q){this.removeLoadingWheel();console.log('Game Paused');$('.ig_debug').show();}
else{if(!this.fpsTimer){this.fpsTimer=new ig.Timer(1);}
}
if(this.fpsTimer&&this.fpsTimer.delta()<0){if(this.fpsCounter!=null){this.fpsCounter++;}
else{this.fpsCounter=0;}
}
else{ig.game.fps=this.fpsCounter;this.fpsCounter=0;this.fpsTimer.reset();}
}
,endGame:function(){console.log('End game');ig.soundHandler.bgmPlayer.stop();ig.apiHandler.run("MJSEnd");}
,resetPlayerStats:function(){ig.log('resetting player stats ...');this.playerStats={id:this.playerStats?this.playerStats.id:null,}
;}
,splashClick:function(){var elem=ig.domHandler.getElementById("#play");ig.domHandler.hide(elem);ig.apiHandler.run("MJSFooter");ig.apiHandler.run("MJSHeader");ig.game.start();}
,pauseGame:function(){ig.system.stopRunLoop.call(ig.system);console.log('Game Paused');}
,resumeGame:function(){ig.system.startRunLoop.call(ig.system);console.log('Game Resumed');}
,showOverlay:function(divList){for(i=0;i<divList.length;i++){if($('#'+divList[i]))$('#'+divList[i]).show();if(document.getElementById(divList[i]))document.getElementById(divList[i]).style.visibility="visible";}
}
,hideOverlay:function(divList){var A2t=-408125239,y2t=436379531,d2t=-379927423,o2t=-690602316,f2t=-589996909;if(P0K.v.P(0,8587893)===A2t||P0K.v.P(13,7889863)===y2t||P0K.v.P(0,3531587,7)===d2t||P0K.v.P(9,6397657)===o2t||P0K.v.P(0,4800095)===f2t){for(i=0;i<divList.length;i++){if($('#'+divList[i]))$('#'+divList[i]).hide();if(document.getElementById(divList[i]))document.getElementById(divList[i]).style.visibility="hidden";}
}
else{this.finalize();this.lastDraw[i]();}
}
,currentBGMVolume:1,addition:0.1,update:function(){if(this.paused){this.updateWhilePaused();this.checkEntities();}
else{this.parent();if(ig.ua.mobile&&ig.soundHandler){ig.soundHandler.forceLoopBGM();}
}
this.io.clear();}
,updateWhilePaused:function(){for(var i=0;i<this.entities.length;i++){if(this.entities[i].ignorePause){this.entities[i].update();}
}
}
,draw:function(){this.parent();for(var i=0;i<this.lastDraw.length;i++){this.lastDraw[i]();}
}
,drawFPS:function(){var fps=Math.round(1000/ig.debug.debugTickAvg),ctx=ig.system.context;ctx.fillText("FPS:"+fps,500,50);}
,clearCanvas:function(ctx,width,height){var canvas=ctx.canvas;ctx.clearRect(0,0,width,height);canvas.style.display="none";canvas.offsetHeight;canvas.style.display="inherit";}
,drawDebug:function(){if(!ig.global.wm){this.debugEnable();if(this.viewDebug){ig.system.context.fillStyle='#000000';ig.system.context.globalAlpha=0.35;ig.system.context.fillRect(0,0,ig.system.width/4,ig.system.height);ig.system.context.globalAlpha=1;if(this.debug&&this.debug.length>0){for(i=0;i<this.debug.length;i++){ig.system.context.font="10px Arial";ig.system.context.fillStyle='#ffffff';ig.system.context.fillText(this.debugLine-this.debug.length+i+": "+this.debug[i],10,50+10*i);}
}
}
}
}
,debugCL:function(consoleLog){if(!this.debug){this.debug=[];this.debugLine=1;this.debug.push(consoleLog);}
else{if(this.debug.length<50){this.debug.push(consoleLog);}
else{this.debug.splice(0,1);this.debug.push(consoleLog);}
this.debugLine++;}
console.log(consoleLog);}
,debugEnable:function(){if(ig.input.pressed('click')){this.debugEnableTimer=new ig.Timer(2);}
if(this.debugEnableTimer&&this.debugEnableTimer.delta()<0){if(ig.input.released('click')){this.debugEnableTimer=null;}
}
else if(this.debugEnableTimer&&this.debugEnableTimer.delta()>0){this.debugEnableTimer=null;if(this.viewDebug){this.viewDebug=false;}
else{this.viewDebug=true;}
}
}
}
);ig.domHandler=null;ig.domHandler=new ig.DomHandler();ig.domHandler.forcedDeviceDetection();ig.domHandler.forcedDeviceRotation();ig.apiHandler=new ig.ApiHandler();ig.sizeHandler=new ig.SizeHandler(ig.domHandler);var fps=60;if(ig.ua.mobile){ig.Sound.enabled=false;ig.main('#canvas',MyGame,fps,ig.sizeHandler.mobile.actualResolution.x,ig.sizeHandler.mobile.actualResolution.y,ig.sizeHandler.scale,ig.SplashLoader);ig.sizeHandler.resize();wgl.webglmain('#webglcanvas',fps);}
else{ig.main('#canvas',MyGame,fps,ig.sizeHandler.desktop.actualResolution.x,ig.sizeHandler.desktop.actualResolution.y,ig.sizeHandler.scale,ig.SplashLoader);wgl.webglmain('#webglcanvas',fps);}
ig.soundHandler=null;ig.soundHandler=new ig.SoundHandler();ig.sizeHandler.reorient();Array});
